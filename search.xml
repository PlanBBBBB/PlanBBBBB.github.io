<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>æ·±ä¿¡æœç¬”è¯•</title>
      <link href="/2024/06/19/%E9%9D%A2%E7%BB%8F-%E6%B7%B1%E4%BF%A1%E6%9C%8D%E7%AC%94%E8%AF%95/"/>
      <url>/2024/06/19/%E9%9D%A2%E7%BB%8F-%E6%B7%B1%E4%BF%A1%E6%9C%8D%E7%AC%94%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>4é“ç¼–ç¨‹é¢˜å¤ªéš¾äº†ã€‚ã€‚ä¼°è®¡åˆæŒ‚äº†</p><p>å‰é¢çš„å¡«ç©ºé¢˜è¿˜å¥½ï¼Œåˆè€ƒäº†äºŒå‰æ ‘çš„ä¸­åºéå†å’Œååºéå†å¾—åˆ°å‰åºéå†ç»“æœï¼Œè€ƒäº†å†’æ³¡å’Œå †æ’åºç­‰</p><h1 id="ç¼–ç¨‹é¢˜"><a href="#ç¼–ç¨‹é¢˜" class="headerlink" title="ç¼–ç¨‹é¢˜"></a>ç¼–ç¨‹é¢˜</h1><h2 id="ç¬¬ä¸€é¢˜"><a href="#ç¬¬ä¸€é¢˜" class="headerlink" title="ç¬¬ä¸€é¢˜"></a>ç¬¬ä¸€é¢˜</h2><p><img src="/../assets/%E9%9D%A2%E7%BB%8F-%E6%B7%B1%E4%BF%A1%E6%9C%8D%E7%AC%94%E8%AF%95/image-20240619123114785.png" alt="image-20240619123114785"></p><p>è¿™é¢˜æ€ä¹ˆéƒ½åªå‡ºæ¥75%ã€‚ã€‚ã€‚ã€‚ã€‚</p><h2 id="ç¬¬äºŒé¢˜"><a href="#ç¬¬äºŒé¢˜" class="headerlink" title="ç¬¬äºŒé¢˜"></a>ç¬¬äºŒé¢˜</h2><p><img src="/../assets/%E9%9D%A2%E7%BB%8F-%E6%B7%B1%E4%BF%A1%E6%9C%8D%E7%AC%94%E8%AF%95/image-20240619123045191.png" alt="image-20240619123045191"></p><p><img src="/../assets/%E9%9D%A2%E7%BB%8F-%E6%B7%B1%E4%BF%A1%E6%9C%8D%E7%AC%94%E8%AF%95/image-20240619123056251.png" alt="image-20240619123056251"></p><h2 id="ç¬¬ä¸‰é¢˜"><a href="#ç¬¬ä¸‰é¢˜" class="headerlink" title="ç¬¬ä¸‰é¢˜"></a>ç¬¬ä¸‰é¢˜</h2><p><img src="/../assets/%E9%9D%A2%E7%BB%8F-%E6%B7%B1%E4%BF%A1%E6%9C%8D%E7%AC%94%E8%AF%95/image-20240619123126717.png" alt="image-20240619123126717"></p><p><img src="/../assets/%E9%9D%A2%E7%BB%8F-%E6%B7%B1%E4%BF%A1%E6%9C%8D%E7%AC%94%E8%AF%95/image-20240619123137570.png" alt="image-20240619123137570"></p><h2 id="ç¬¬å››é¢˜"><a href="#ç¬¬å››é¢˜" class="headerlink" title="ç¬¬å››é¢˜"></a>ç¬¬å››é¢˜</h2><p><img src="/../assets/%E9%9D%A2%E7%BB%8F-%E6%B7%B1%E4%BF%A1%E6%9C%8D%E7%AC%94%E8%AF%95/image-20240619123146080.png" alt="image-20240619123146080"></p><p><img src="/../assets/%E9%9D%A2%E7%BB%8F-%E6%B7%B1%E4%BF%A1%E6%9C%8D%E7%AC%94%E8%AF%95/image-20240619123153978.png" alt="image-20240619123153978"></p><p>![å±å¹•æˆªå›¾ 2024-06-18 205253](..&#x2F;assets&#x2F;é¢ç»-æ·±ä¿¡æœç¬”è¯•&#x2F;å±å¹•æˆªå›¾ 2024-06-18 205253.png)</p>]]></content>
      
      
      <categories>
          
          <category> é¢ç» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¹¿å·å®‰éš½ç¬”è¯•+é¢è¯•</title>
      <link href="/2024/06/18/%E9%9D%A2%E7%BB%8F-%E5%B9%BF%E5%B7%9E%E5%AE%89%E9%9A%BD%E7%AC%94%E8%AF%95+%E9%9D%A2%E8%AF%95/"/>
      <url>/2024/06/18/%E9%9D%A2%E7%BB%8F-%E5%B9%BF%E5%B7%9E%E5%AE%89%E9%9A%BD%E7%AC%94%E8%AF%95+%E9%9D%A2%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>å·²æŒ‚ï¼Œæ˜¯ä¸ªè´å£³å¤–åŒ…</p><h1 id="å®ä¹ "><a href="#å®ä¹ " class="headerlink" title="å®ä¹ "></a>å®ä¹ </h1><p>åŠ¨æ€æ•°æ®æºåˆ‡æ¢ï¼ŒåŠ¨æ€åŠ è§£å¯†ï¼ŒåŠ¨æ€æ•°æ®æƒé™ï¼Œäººå·¥å®¢æœ</p><h1 id="é¡¹ç›®"><a href="#é¡¹ç›®" class="headerlink" title="é¡¹ç›®"></a>é¡¹ç›®</h1><p>ä¸è®°å¾—äº†ï¼Œæ²¡é—®ä»€ä¹ˆé¡¹ç›®</p><h1 id="å…«è‚¡"><a href="#å…«è‚¡" class="headerlink" title="å…«è‚¡"></a>å…«è‚¡</h1><p>åŸºæœ¬è¿˜æ˜¯mysqlçš„å¸¸è§å…«è‚¡</p><h1 id="ç¬”è¯•"><a href="#ç¬”è¯•" class="headerlink" title="ç¬”è¯•"></a>ç¬”è¯•</h1><h2 id="MYSQL"><a href="#MYSQL" class="headerlink" title="MYSQL"></a>MYSQL</h2><p>è®¾è®¡ä¸€ä¸ªå‘˜å·¥è¡¨å’Œä¸€ä¸ªéƒ¨é—¨è¡¨ï¼Œå…¶ä¸­ä¸€ä¸ªè¡Œåˆ—è½¬æ¢çš„ä¸ä¼š</p><p><img src="/../assets/%E9%9D%A2%E7%BB%8F-%E5%B9%BF%E5%B7%9E%E5%AE%89%E9%9A%BD%E7%AC%94%E8%AF%95+%E9%9D%A2%E8%AF%95/Snipaste_2024-06-19_12-06-21.png" alt="Snipaste_2024-06-19_12-06-21"></p><p>æš‚æ—¶è¿˜æ˜¯ä¸ä¼šã€‚ã€‚ã€‚ã€‚</p><h2 id="StringBufferå’ŒStringçš„åŒºåˆ«"><a href="#StringBufferå’ŒStringçš„åŒºåˆ«" class="headerlink" title="StringBufferå’ŒStringçš„åŒºåˆ«"></a>StringBufferå’ŒStringçš„åŒºåˆ«</h2><p><code>StringBuffer</code>å’Œ<code>String</code>æ˜¯Javaä¸­å¤„ç†å­—ç¬¦ä¸²çš„ä¸¤ç§ä¸åŒç±»å‹ï¼Œä¸»è¦åŒºåˆ«åœ¨äºå¯å˜æ€§ã€çº¿ç¨‹å®‰å…¨æ€§ä»¥åŠæ€§èƒ½æ–¹é¢ã€‚</p><ol><li>å¯å˜æ€§ (Mutability)</li></ol><ul><li><p>**<code>String</code>**ï¼š</p><ul><li><code>String</code>å¯¹è±¡æ˜¯<strong>ä¸å¯å˜</strong>çš„ã€‚ä¸€æ—¦åˆ›å»ºäº†ä¸€ä¸ª<code>String</code>å¯¹è±¡ï¼Œå®ƒçš„å€¼å°±ä¸èƒ½è¢«æ”¹å˜ã€‚ä»»ä½•ä¿®æ”¹<code>String</code>å€¼çš„æ“ä½œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„<code>String</code>å¯¹è±¡ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">str = str + <span class="string">&quot; World&quot;</span>; <span class="comment">// åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„Stringå¯¹è±¡</span></span><br></pre></td></tr></table></figure></li><li><p>**<code>StringBuffer</code>**ï¼š</p><ul><li><code>StringBuffer</code>å¯¹è±¡æ˜¯<strong>å¯å˜</strong>çš„ã€‚å®ƒå…è®¸åœ¨ä¸åˆ›å»ºæ–°å¯¹è±¡çš„æƒ…å†µä¸‹ä¿®æ”¹å­—ç¬¦ä¸²çš„å†…å®¹ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot; World&quot;</span>); <span class="comment">// ä¿®æ”¹äº†åŒä¸€ä¸ªStringBufferå¯¹è±¡</span></span><br></pre></td></tr></table></figure></li></ul><ol start="2"><li>çº¿ç¨‹å®‰å…¨æ€§ (Thread Safety)</li></ol><ul><li><p>**<code>String</code>**ï¼š</p><ul><li><code>String</code>æ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„ï¼Œå› ä¸ºå®ƒæ˜¯ä¸å¯å˜çš„ã€‚å¤šä¸ªçº¿ç¨‹å¯ä»¥å®‰å…¨åœ°å…±äº«åŒä¸€ä¸ª<code>String</code>å¯¹è±¡è€Œä¸éœ€è¦åŒæ­¥ã€‚</li></ul></li><li><p>**<code>StringBuffer</code>**ï¼š</p><ul><li><code>StringBuffer</code>æ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„ã€‚å®ƒçš„æ‰€æœ‰å…¬å…±æ–¹æ³•éƒ½æ˜¯åŒæ­¥çš„ï¼Œç¡®ä¿äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„å®‰å…¨æ€§ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot; World&quot;</span>); <span class="comment">// çº¿ç¨‹å®‰å…¨</span></span><br></pre></td></tr></table></figure></li></ul><ol start="3"><li>æ€§èƒ½ (Performance)</li></ol><ul><li><p>**<code>String</code>**ï¼š</p><ul><li>å› ä¸º<code>String</code>æ˜¯ä¸å¯å˜çš„ï¼Œæ¯æ¬¡å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ“ä½œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„<code>String</code>å¯¹è±¡ï¼Œè¿™å¯èƒ½å¯¼è‡´è¾ƒå¤šçš„å†…å­˜æ¶ˆè€—å’Œè¾ƒå·®çš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨è¿›è¡Œå¤§é‡å­—ç¬¦ä¸²æ“ä½œæ—¶ã€‚</li></ul></li><li><p>**<code>StringBuffer</code>**ï¼š</p><ul><li><code>StringBuffer</code>ç”±äºæ˜¯å¯å˜çš„ï¼Œä¸”æ–¹æ³•æ˜¯åŒæ­¥çš„ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­æ€§èƒ½æ¯”<code>String</code>å¥½ã€‚ä½†æ˜¯ç”±äºåŒæ­¥æœºåˆ¶ï¼Œå•çº¿ç¨‹ç¯å¢ƒä¸­çš„æ€§èƒ½å¯èƒ½ä¸å¦‚<code>StringBuilder</code>ï¼ˆåé¢ä¼šæåˆ°ï¼‰ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">    sb.append(<span class="string">&quot; World&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ol start="4"><li>ä½¿ç”¨åœºæ™¯</li></ol><ul><li><p>**<code>String</code>**ï¼š</p><ul><li>é€‚ç”¨äºå°‘é‡çš„ã€å¯¹å­—ç¬¦ä¸²ä¸é¢‘ç¹ä¿®æ”¹çš„åœºæ™¯ï¼Œä¾‹å¦‚å®šä¹‰å¸¸é‡ã€å°‘é‡æ‹¼æ¥æ“ä½œç­‰ã€‚</li></ul></li><li><p>**<code>StringBuffer</code>**ï¼š</p><ul><li>é€‚ç”¨äºéœ€è¦é¢‘ç¹ä¿®æ”¹å­—ç¬¦ä¸²ä¸”åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨çš„åœºæ™¯ï¼Œä¾‹å¦‚æ„å»ºå¤æ‚å­—ç¬¦ä¸²ã€åœ¨å¤šçº¿ç¨‹åº”ç”¨ä¸­ç´¯ç§¯å­—ç¬¦ä¸²å†…å®¹ç­‰ã€‚</li></ul></li></ul><ol start="5"><li><code>StringBuilder</code>çš„æ¯”è¾ƒ</li></ol><p>å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªä¸<code>StringBuffer</code>ç±»ä¼¼çš„ç±»ï¼Œå«åš<code>StringBuilder</code>ï¼Œå®ƒä¹Ÿæ˜¯å¯å˜çš„ï¼Œä½†å®ƒä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><ul><li><p>**<code>StringBuilder</code>**ï¼š</p><ul><li><code>StringBuilder</code>ä¸<code>StringBuffer</code>å‡ ä¹ç›¸åŒï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯<code>StringBuilder</code>çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯éåŒæ­¥çš„ï¼Œå› æ­¤å®ƒåœ¨å•çº¿ç¨‹ç¯å¢ƒä¸­æ¯”<code>StringBuffer</code>æ€§èƒ½æ›´å¥½ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">sb.append(<span class="string">&quot; World&quot;</span>); <span class="comment">// éçº¿ç¨‹å®‰å…¨ï¼Œä½†æ€§èƒ½æ›´å¥½</span></span><br></pre></td></tr></table></figure></li></ul><p>æ€»ç»“ï¼š</p><ul><li>**<code>String</code>**ï¼šä¸å¯å˜ã€çº¿ç¨‹å®‰å…¨ã€é€‚ç”¨äºå°‘é‡å­—ç¬¦ä¸²æ“ä½œã€‚</li><li>**<code>StringBuffer</code>**ï¼šå¯å˜ã€çº¿ç¨‹å®‰å…¨ã€é€‚ç”¨äºå¤šçº¿ç¨‹ç¯å¢ƒä¸­é¢‘ç¹ä¿®æ”¹å­—ç¬¦ä¸²çš„åœºæ™¯ã€‚</li><li>**<code>StringBuilder</code>**ï¼šå¯å˜ã€éçº¿ç¨‹å®‰å…¨ã€é€‚ç”¨äºå•çº¿ç¨‹ç¯å¢ƒä¸­é¢‘ç¹ä¿®æ”¹å­—ç¬¦ä¸²çš„åœºæ™¯ã€‚</li></ul><p>é€‰æ‹©ä½¿ç”¨å“ªä¸ªç±»å–å†³äºå…·ä½“çš„ä½¿ç”¨åœºæ™¯å’Œæ€§èƒ½éœ€æ±‚ã€‚</p><h2 id="æ·±æ‹·è´å’Œæµ…æ‹·è´çš„åŒºåˆ«"><a href="#æ·±æ‹·è´å’Œæµ…æ‹·è´çš„åŒºåˆ«" class="headerlink" title="æ·±æ‹·è´å’Œæµ…æ‹·è´çš„åŒºåˆ«"></a>æ·±æ‹·è´å’Œæµ…æ‹·è´çš„åŒºåˆ«</h2><blockquote><p><strong>å¼•ç”¨å…³ç³»</strong>ï¼š</p><ul><li><strong>æµ…æ‹·è´</strong>ï¼šæ–°å¯¹è±¡ä¸åŸå¯¹è±¡å…±äº«åµŒå¥—å¯¹è±¡çš„å¼•ç”¨ã€‚</li><li><strong>æ·±æ‹·è´</strong>ï¼šæ–°å¯¹è±¡åŒ…å«ä¸åŸå¯¹è±¡å®Œå…¨ç‹¬ç«‹çš„åµŒå¥—å¯¹è±¡ã€‚</li></ul></blockquote><h2 id="bootstrap-ymlå’Œapplication-ymlçš„åŒºåˆ«"><a href="#bootstrap-ymlå’Œapplication-ymlçš„åŒºåˆ«" class="headerlink" title="bootstrap.ymlå’Œapplication.ymlçš„åŒºåˆ«"></a>bootstrap.ymlå’Œapplication.ymlçš„åŒºåˆ«</h2><h2 id="çº¿ç¨‹çš„-Xsså‚æ•°æ˜¯ä»€ä¹ˆæ„æ€"><a href="#çº¿ç¨‹çš„-Xsså‚æ•°æ˜¯ä»€ä¹ˆæ„æ€" class="headerlink" title="çº¿ç¨‹çš„-Xsså‚æ•°æ˜¯ä»€ä¹ˆæ„æ€"></a>çº¿ç¨‹çš„-Xsså‚æ•°æ˜¯ä»€ä¹ˆæ„æ€</h2><blockquote><p><code>-Xss</code>å‚æ•°æ˜¯JVMï¼ˆJava Virtual Machineï¼‰çš„ä¸€ä¸ªé€‰é¡¹ï¼Œç”¨äºè®¾ç½®æ¯ä¸ªçº¿ç¨‹çš„æ ˆå¤§å°ã€‚çº¿ç¨‹æ ˆç”¨äºå­˜å‚¨æ–¹æ³•è°ƒç”¨å¸§ã€å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆç­‰ä¿¡æ¯ã€‚å½“ä½ åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ—¶ï¼ŒJVMä¼šä¸ºè¿™ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªæ ˆï¼Œç”¨æ¥ä¿å­˜è¯¥çº¿ç¨‹è¿è¡Œæ—¶çš„æ‰€æœ‰å¿…è¦ä¿¡æ¯ã€‚</p></blockquote><h2 id="mapï¼Œlistï¼Œsetçš„åŒºåˆ«ï¼Œhashmapå’Œhashtableçš„åŒºåˆ«"><a href="#mapï¼Œlistï¼Œsetçš„åŒºåˆ«ï¼Œhashmapå’Œhashtableçš„åŒºåˆ«" class="headerlink" title="mapï¼Œlistï¼Œsetçš„åŒºåˆ«ï¼Œhashmapå’Œhashtableçš„åŒºåˆ«"></a>mapï¼Œlistï¼Œsetçš„åŒºåˆ«ï¼Œhashmapå’Œhashtableçš„åŒºåˆ«</h2>]]></content>
      
      
      <categories>
          
          <category> é¢ç» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è¯• </tag>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµ·é¶…ç§‘æŠ€é¢è¯•</title>
      <link href="/2024/06/18/%E9%9D%A2%E7%BB%8F-%E6%B5%B7%E9%B6%85%E7%A7%91%E6%8A%80%E9%9D%A2%E8%AF%95/"/>
      <url>/2024/06/18/%E9%9D%A2%E7%BB%8F-%E6%B5%B7%E9%B6%85%E7%A7%91%E6%8A%80%E9%9D%A2%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>å·²è¿‡ğŸ˜</p><h1 id="å®ä¹ "><a href="#å®ä¹ " class="headerlink" title="å®ä¹ "></a>å®ä¹ </h1><p>â­â­â­SaaSå¹³å°ï¼Œé—®æˆ‘åˆ‡æ¢åˆ°ä¸åŒçœçš„åŸŸåè·³è½¬ï¼Œç­”äº†nginxå»è¿›è¡Œé…ç½®è·¯ç”±</p><p>å…¶å®è¿™é‡Œè®°é”™äº†ï¼Œåº”è¯¥æ˜¯åœ¨ç»Ÿä¸€çš„æ–°ç”Ÿæˆçš„é…ç½®åå°çš„ç»Ÿä¸€urlåé¢åŠ¨æ€çš„æ‹¼æ¥ä¸Šç±»ä¼¼äºdataSourseè¿™æ ·çš„æ•°æ®æºä¿¡æ¯ï¼Œç„¶åå‰ç«¯å†å¯¹è¿™ä¸ªæ–°çš„åŠ ä¸Šç±»ä¼¼äºæ•°æ®æºçš„urlå»è¿›è¡Œè§£æï¼Œè§£å¯†ï¼Œè¿™æ ·å°±èƒ½å¾—çŸ¥æ˜¯å“ªä¸ªçœçš„ã€‚</p><p>â­â­â­åƒè¿™æ ·çš„ä¸€ä¸ªSaaSå¹³å°ï¼Œå¦‚æœæœ‰ä¸€ä¸ªç¬¬ä¸‰æ–¹æ¥å£ï¼Œä»–å¹¶ä¸æƒ³åƒæŸä¸ªçœä»½é‚£æ ·è¿˜è¦æ³¨å†Œä¸ºå…¶ä¸­çš„ä¸€ä¸ªç§Ÿæˆ·ï¼Œä»–åªæƒ³è°ƒç”¨ä¸€ä¸‹æ¥å£ï¼Œè¿™æ ·è¦æ€ä¹ˆå¤„ç†ï¼Ÿ</p><blockquote><p>ç°åœ¨æ€»ç»“ä¸€ä¸‹å¯ä»¥æœ‰å…¬å…±ç§Ÿæˆ·ï¼ŒåŒ¿åç§Ÿæˆ·è¿™æ ·çš„è®¾è®¡ï¼Œæˆ–è€…åœ¨APIç½‘å…³å±‚åšå¤„ç†ï¼Œæˆ–è€…æ˜¯ä¸´æ—¶ä»¤ç‰Œæˆ–è€…ç±»ä¼¼JWTä¹‹ç±»çš„éƒ½å¯ä»¥å®ç°ã€‚</p></blockquote><p>è¿˜æœ‰<strong>åŠ¨æ€æ•°æ®æºåˆ‡æ¢</strong>å’Œ<strong>åŠ¨æ€åŠ è§£å¯†</strong>å’Œäººå·¥å®¢æœ</p><h1 id="é¡¹ç›®"><a href="#é¡¹ç›®" class="headerlink" title="é¡¹ç›®"></a>é¡¹ç›®</h1><p>é—®äº†RPCçš„å®ç°åŸç†</p><h1 id="å…«è‚¡"><a href="#å…«è‚¡" class="headerlink" title="å…«è‚¡"></a>å…«è‚¡</h1><p>æˆ‘æåˆ°äº†çº¿ç¨‹æ± ï¼Œè¿˜æœ‰mysqlçš„ä¸€äº›åŸºç¡€å…«è‚¡</p>]]></content>
      
      
      <categories>
          
          <category> é¢ç» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¹¿å‘Šæ¨èç³»ç»Ÿ</title>
      <link href="/2024/06/06/Project-%E5%B9%BF%E5%91%8A%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/"/>
      <url>/2024/06/06/Project-%E5%B9%BF%E5%91%8A%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¨èç³»ç»Ÿçš„æ•´ä½“æµç¨‹"><a href="#æ¨èç³»ç»Ÿçš„æ•´ä½“æµç¨‹" class="headerlink" title="æ¨èç³»ç»Ÿçš„æ•´ä½“æµç¨‹"></a>æ¨èç³»ç»Ÿçš„æ•´ä½“æµç¨‹</h1><p>ç»“åˆå¬å›å’Œé‡æ’ï¼Œå¹¿å‘Šæ¨èç³»ç»Ÿçš„æ•´ä½“æµç¨‹é€šå¸¸å¦‚ä¸‹ï¼š</p><ol><li><strong>å¬å›é˜¶æ®µ</strong>ï¼šä»å¹¿å‘Šåº“ä¸­å¬å›ä¸€éƒ¨åˆ†ç›¸å…³å¹¿å‘Šï¼Œä¿è¯è¦†ç›–èŒƒå›´å’Œå¤šæ ·æ€§ã€‚</li><li><strong>åˆæ­¥è¿‡æ»¤</strong>ï¼šåº”ç”¨ä¸€äº›åŸºæœ¬çš„è¿‡æ»¤è§„åˆ™ï¼ˆå¦‚å¹¿å‘Šåˆè§„æ€§æ£€æŸ¥ã€é»‘åå•è¿‡æ»¤ï¼‰å¯¹å¬å›çš„å¹¿å‘Šè¿›è¡Œåˆæ­¥ç­›é€‰ã€‚</li><li><strong>ç‰¹å¾å·¥ç¨‹</strong>ï¼šæå–ç”¨æˆ·ç‰¹å¾ã€å¹¿å‘Šç‰¹å¾å’Œä¸Šä¸‹æ–‡ç‰¹å¾ï¼Œä¸ºé‡æ’æ¨¡å‹æä¾›è¾“å…¥ã€‚</li><li><strong>é‡æ’é˜¶æ®µ</strong>ï¼šåˆ©ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹æˆ–è§„åˆ™å¯¹å€™é€‰å¹¿å‘Šè¿›è¡Œæ‰“åˆ†å’Œæ’åºï¼Œç”Ÿæˆæœ€ç»ˆçš„æ¨èåˆ—è¡¨ã€‚</li><li><strong>åœ¨çº¿å±•ç¤º</strong>ï¼šå°†æ¨èç»“æœå±•ç¤ºç»™ç”¨æˆ·ï¼Œå¹¶æ”¶é›†ç”¨æˆ·åé¦ˆï¼ˆå¦‚ç‚¹å‡»ã€æµè§ˆã€è´­ä¹°ï¼‰ï¼Œä¸ºåç»­çš„æ¨èæä¾›æ•°æ®æ”¯æŒã€‚</li></ol><h1 id="å¹¿å‘Šæ¨èç³»ç»Ÿä¸šåŠ¡æµç¨‹"><a href="#å¹¿å‘Šæ¨èç³»ç»Ÿä¸šåŠ¡æµç¨‹" class="headerlink" title="å¹¿å‘Šæ¨èç³»ç»Ÿä¸šåŠ¡æµç¨‹"></a>å¹¿å‘Šæ¨èç³»ç»Ÿä¸šåŠ¡æµç¨‹</h1><p>å¹¿å‘Šæ¨èç³»ç»Ÿçš„ä¸šåŠ¡æµç¨‹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªä¸»è¦éƒ¨åˆ†ï¼šå¹¿å‘ŠæŠ•æ”¾ã€ç”¨æˆ·è¡Œä¸ºé‡‡é›†ä¸åˆ†æã€æ¨èç®—æ³•çš„æ‰§è¡Œå’Œå¹¿å‘Šå±•ç¤ºã€‚æ¯ä¸ªéƒ¨åˆ†éƒ½æœ‰å„è‡ªçš„åŠŸèƒ½å’Œæµç¨‹ã€‚</p><h2 id="1-å¹¿å‘ŠæŠ•æ”¾"><a href="#1-å¹¿å‘ŠæŠ•æ”¾" class="headerlink" title="1. å¹¿å‘ŠæŠ•æ”¾"></a>1. å¹¿å‘ŠæŠ•æ”¾</h2><p><strong>å¹¿å‘Šå•†ç«¯æ“ä½œ</strong>ï¼š</p><ul><li><strong>å¹¿å‘Šå•†æ³¨å†Œå’Œç™»å½•</strong>ï¼šå¹¿å‘Šå•†éœ€è¦åœ¨ç³»ç»Ÿä¸­æ³¨å†Œè´¦æˆ·å¹¶ç™»å½•ã€‚</li><li><strong>åˆ›å»ºå¹¿å‘Š</strong>ï¼šå¹¿å‘Šå•†å¯ä»¥åœ¨ç³»ç»Ÿä¸­åˆ›å»ºå¹¿å‘Šï¼Œè®¾ç½®å¹¿å‘Šçš„åŸºæœ¬ä¿¡æ¯ï¼ˆå¦‚æ ‡é¢˜ã€æè¿°ã€å›¾ç‰‡ç­‰ï¼‰ã€æŠ•æ”¾ç­–ç•¥ï¼ˆå¦‚å—ä¼—ã€é¢„ç®—ã€æŠ•æ”¾æ—¶é—´ç­‰ï¼‰ã€‚</li><li><strong>å®¡æ ¸å’Œå‘å¸ƒ</strong>ï¼šå¹¿å‘Šæäº¤åï¼Œéœ€è¦ç»è¿‡ç³»ç»Ÿç®¡ç†å‘˜çš„å®¡æ ¸ï¼Œé€šè¿‡åæ‰èƒ½å‘å¸ƒã€‚</li></ul><p><strong>åå°ç®¡ç†ç«¯æ“ä½œ</strong>ï¼š</p><ul><li><strong>å®¡æ ¸å¹¿å‘Š</strong>ï¼šç®¡ç†å‘˜å®¡æ ¸å¹¿å‘Šå†…å®¹ï¼Œç¡®ä¿ç¬¦åˆå¹³å°è§„å®šã€‚</li><li><strong>å¹¿å‘Šç®¡ç†</strong>ï¼šç®¡ç†å‘˜å¯ä»¥å¯¹å¹¿å‘Šè¿›è¡Œç®¡ç†ï¼ŒåŒ…æ‹¬ä¸‹çº¿ä¸åˆè§„å¹¿å‘Šã€è°ƒæ•´æŠ•æ”¾ç­–ç•¥ç­‰ã€‚</li></ul><h2 id="2-ç”¨æˆ·è¡Œä¸ºé‡‡é›†ä¸åˆ†æ"><a href="#2-ç”¨æˆ·è¡Œä¸ºé‡‡é›†ä¸åˆ†æ" class="headerlink" title="2. ç”¨æˆ·è¡Œä¸ºé‡‡é›†ä¸åˆ†æ"></a>2. ç”¨æˆ·è¡Œä¸ºé‡‡é›†ä¸åˆ†æ</h2><p><strong>ç”¨æˆ·ç«¯æ“ä½œ</strong>ï¼š</p><ul><li><strong>ç”¨æˆ·æµè§ˆå¹¿å‘Š</strong>ï¼šç”¨æˆ·åœ¨æµè§ˆç½‘é¡µæˆ–ä½¿ç”¨åº”ç”¨æ—¶ï¼Œä¼šçœ‹åˆ°ç³»ç»Ÿæ¨èçš„å¹¿å‘Šã€‚</li><li><strong>ç”¨æˆ·åé¦ˆå’Œäº’åŠ¨</strong>ï¼šç”¨æˆ·å¯ä»¥ç‚¹å‡»ã€å–œæ¬¢ã€ä¸å–œæ¬¢æˆ–è·³è¿‡å¹¿å‘Šï¼Œè¿™äº›è¡Œä¸ºä¼šè¢«ç³»ç»Ÿè®°å½•ä¸‹æ¥ã€‚</li></ul><p><strong>åå°æ•°æ®å¤„ç†</strong>ï¼š</p><ul><li><strong>è¡Œä¸ºæ•°æ®é‡‡é›†</strong>ï¼šç³»ç»Ÿå®æ—¶æ”¶é›†ç”¨æˆ·çš„è¡Œä¸ºæ•°æ®ï¼ŒåŒ…æ‹¬ç‚¹å‡»ã€æµè§ˆã€åé¦ˆç­‰ä¿¡æ¯ã€‚</li><li><strong>æ•°æ®å­˜å‚¨ä¸å¤„ç†</strong>ï¼šè¡Œä¸ºæ•°æ®ä¼šå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå¹¶è¿›è¡Œé¢„å¤„ç†ï¼Œå¦‚å»é‡ã€æ¸…æ´—ç­‰ã€‚</li></ul><h2 id="3-æ¨èç®—æ³•çš„æ‰§è¡Œ"><a href="#3-æ¨èç®—æ³•çš„æ‰§è¡Œ" class="headerlink" title="3. æ¨èç®—æ³•çš„æ‰§è¡Œ"></a>3. æ¨èç®—æ³•çš„æ‰§è¡Œ</h2><p><strong>æ¨èå¼•æ“æ“ä½œ</strong>ï¼š</p><ul><li><strong>æ•°æ®è¾“å…¥</strong>ï¼šæ¨èå¼•æ“ä»æ•°æ®åº“ä¸­è·å–ç”¨æˆ·è¡Œä¸ºæ•°æ®å’Œå¹¿å‘Šä¿¡æ¯ã€‚</li><li><strong>ç®—æ³•é€‰æ‹©</strong>ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚å’Œç³»ç»ŸçŠ¶æ€ï¼Œé€‰æ‹©é€‚å½“çš„æ¨èç®—æ³•ï¼ˆå¦‚åŸºäºå†…å®¹ã€ååŒè¿‡æ»¤ã€çŸ©é˜µåˆ†è§£ç­‰ï¼‰ã€‚</li><li><strong>ç”Ÿæˆæ¨è</strong>ï¼šæ‰§è¡Œæ¨èç®—æ³•ï¼Œç”Ÿæˆä¸ªæ€§åŒ–çš„å¹¿å‘Šæ¨èåˆ—è¡¨ã€‚</li><li><strong>å¤šæ ·æ€§å’Œæ¢ç´¢æœºåˆ¶</strong>ï¼šåœ¨æ¨èåˆ—è¡¨ä¸­å¼•å…¥å¤šæ ·æ€§å’Œæ¢ç´¢æœºåˆ¶ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚</li></ul><h2 id="4-å¹¿å‘Šå±•ç¤º"><a href="#4-å¹¿å‘Šå±•ç¤º" class="headerlink" title="4. å¹¿å‘Šå±•ç¤º"></a>4. å¹¿å‘Šå±•ç¤º</h2><p><strong>ç”¨æˆ·ç«¯å±•ç¤º</strong>ï¼š</p><ul><li><strong>å±•ç¤ºå¹¿å‘Š</strong>ï¼šç³»ç»Ÿå°†ç”Ÿæˆçš„å¹¿å‘Šæ¨èåˆ—è¡¨å±•ç¤ºç»™ç”¨æˆ·ï¼Œå¹¿å‘Šå±•ç¤ºçš„é¡ºåºå’Œå†…å®¹ä¼šæ ¹æ®æ¨èç»“æœåŠ¨æ€è°ƒæ•´ã€‚</li><li><strong>è®°å½•æ›å…‰</strong>ï¼šç³»ç»Ÿä¼šè®°å½•å¹¿å‘Šçš„æ›å…‰æ¬¡æ•°ï¼Œä»¥ä¾¿è¿›è¡Œåç»­çš„åˆ†æå’Œä¼˜åŒ–ã€‚</li></ul><p><strong>åå°å¤„ç†</strong>ï¼š</p><ul><li><strong>æ›å…‰é¢‘æ¬¡æ§åˆ¶</strong>ï¼šæ§åˆ¶å¹¿å‘Šçš„æ›å…‰é¢‘æ¬¡ï¼Œé˜²æ­¢åŒä¸€å¹¿å‘Šè¿‡åº¦å±•ç¤ºã€‚</li><li><strong>ä½ç½®å½’ä¸€åŒ–å¤„ç†</strong>ï¼šå¯¹å¹¿å‘Šå±•ç¤ºçš„ä½ç½®è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œç¡®ä¿æ¨èç»“æœçš„å…¬å¹³æ€§ã€‚</li></ul><h2 id="5-æ•°æ®åˆ†æä¸ä¼˜åŒ–"><a href="#5-æ•°æ®åˆ†æä¸ä¼˜åŒ–" class="headerlink" title="5. æ•°æ®åˆ†æä¸ä¼˜åŒ–"></a>5. æ•°æ®åˆ†æä¸ä¼˜åŒ–</h2><p><strong>åå°ç®¡ç†ç«¯</strong>ï¼š</p><ul><li><strong>æ•ˆæœåˆ†æ</strong>ï¼šç³»ç»Ÿå¯¹å¹¿å‘Šçš„å±•ç¤ºæ•ˆæœè¿›è¡Œåˆ†æï¼Œç”Ÿæˆå„ç§æŠ¥è¡¨ï¼Œå¦‚ç‚¹å‡»ç‡ã€è½¬åŒ–ç‡ç­‰ã€‚</li><li><strong>åé¦ˆä¼˜åŒ–</strong>ï¼šæ ¹æ®å¹¿å‘Šæ•ˆæœå’Œç”¨æˆ·åé¦ˆï¼Œä¸æ–­ä¼˜åŒ–æ¨èç®—æ³•å’ŒæŠ•æ”¾ç­–ç•¥ã€‚</li></ul><h1 id="ç³»ç»Ÿæ¶æ„ä¸æŠ€æœ¯å®ç°"><a href="#ç³»ç»Ÿæ¶æ„ä¸æŠ€æœ¯å®ç°" class="headerlink" title="ç³»ç»Ÿæ¶æ„ä¸æŠ€æœ¯å®ç°"></a>ç³»ç»Ÿæ¶æ„ä¸æŠ€æœ¯å®ç°</h1><p><strong>æŠ€æœ¯æ ˆ</strong>ï¼š</p><ul><li><strong>åç«¯æ¡†æ¶</strong>ï¼šSpring Bootã€Spring Cloud</li><li><strong>æ•°æ®å­˜å‚¨</strong>ï¼šMySQLã€Redisã€MinIO</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šRabbitMQ</li><li><strong>ä»»åŠ¡è°ƒåº¦</strong>ï¼šXXL-Job</li><li><strong>æ¨èç®—æ³•</strong>ï¼šåŸºäºååŒè¿‡æ»¤ã€å†…å®¹è¿‡æ»¤ã€çŸ©é˜µåˆ†è§£ç­‰æŠ€æœ¯</li></ul><p><strong>ç³»ç»Ÿæ¶æ„</strong>ï¼š</p><ul><li><strong>ç”¨æˆ·æ¨¡å—</strong>ï¼šå¤„ç†ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€æƒé™ç®¡ç†ç­‰åŠŸèƒ½ã€‚</li><li><strong>å¹¿å‘Šæ¨¡å—</strong>ï¼šç®¡ç†å¹¿å‘Šçš„åˆ›å»ºã€å®¡æ ¸ã€å‘å¸ƒã€è°ƒåº¦ç­‰åŠŸèƒ½ã€‚</li><li><strong>æ¨èå¼•æ“æ¨¡å—</strong>ï¼šè´Ÿè´£æ‰§è¡Œæ¨èç®—æ³•ï¼Œç”Ÿæˆä¸ªæ€§åŒ–æ¨èç»“æœã€‚</li><li><strong>æ•°æ®åˆ†ææ¨¡å—</strong>ï¼šè¿›è¡Œæ•°æ®é‡‡é›†ã€é¢„å¤„ç†ã€åˆ†æå’ŒæŠ¥è¡¨ç”Ÿæˆã€‚</li><li><strong>ä¸­é—´ä»¶æ¨¡å—</strong>ï¼šåŒ…æ‹¬æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRabbitMQï¼‰å’Œä»»åŠ¡è°ƒåº¦ï¼ˆXXL-Jobï¼‰ï¼Œç”¨äºå¼‚æ­¥å¤„ç†å’Œåˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†ã€‚</li></ul><h2 id="æµç¨‹ç¤ºæ„å›¾"><a href="#æµç¨‹ç¤ºæ„å›¾" class="headerlink" title="æµç¨‹ç¤ºæ„å›¾"></a>æµç¨‹ç¤ºæ„å›¾</h2><p>ä»¥ä¸‹æ˜¯å¹¿å‘Šæ¨èç³»ç»Ÿçš„æµç¨‹ç¤ºæ„å›¾ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+           +------------------+           +-----------------+</span><br><span class="line">|   å¹¿å‘Šå•†ç«¯æ“ä½œ    |           |  åå°ç®¡ç†ç«¯æ“ä½œ  |           |     ç”¨æˆ·ç«¯æ“ä½œ   |</span><br><span class="line">+-------------------+           +------------------+           +-----------------+</span><br><span class="line">| - æ³¨å†Œå’Œç™»å½•      |           | - å®¡æ ¸å¹¿å‘Š       |           | - æµè§ˆå¹¿å‘Š      |</span><br><span class="line">| - åˆ›å»ºå¹¿å‘Š        |           | - å¹¿å‘Šç®¡ç†       |           | - åé¦ˆå’Œäº’åŠ¨    |</span><br><span class="line">| - è®¾ç½®æŠ•æ”¾ç­–ç•¥    |           | - æ•°æ®åˆ†æ       |           +-----------------+</span><br><span class="line">+-------------------+           +------------------+           |     ç³»ç»Ÿå¤„ç†     |</span><br><span class="line">           |                             |                              |</span><br><span class="line">           v                             v                              v</span><br><span class="line">+------------------+            +------------------+          +------------------+</span><br><span class="line">|   è¡Œä¸ºæ•°æ®é‡‡é›†   |------------|   æ¨èç®—æ³•æ‰§è¡Œ   |----------|  å¹¿å‘Šå±•ç¤ºä¸è®°å½•  |</span><br><span class="line">+------------------+            +------------------+          +------------------+</span><br><span class="line">           |                             |                              |</span><br><span class="line">           v                             v                              v</span><br><span class="line">+------------------+            +------------------+          +------------------+</span><br><span class="line">|   æ•°æ®å­˜å‚¨ä¸å¤„ç† |------------|   æ•ˆæœåˆ†æä¸ä¼˜åŒ– |----------|    æ•°æ®ä¸€è‡´æ€§    |</span><br><span class="line">+------------------+            +------------------+          +------------------+</span><br></pre></td></tr></table></figure><h1 id="æ¨èç®—æ³•å®ç°"><a href="#æ¨èç®—æ³•å®ç°" class="headerlink" title="æ¨èç®—æ³•å®ç°"></a>æ¨èç®—æ³•å®ç°</h1><h2 id="åŸºäºå†…å®¹çš„æ¨èç®—æ³•"><a href="#åŸºäºå†…å®¹çš„æ¨èç®—æ³•" class="headerlink" title="åŸºäºå†…å®¹çš„æ¨èç®—æ³•"></a>åŸºäºå†…å®¹çš„æ¨èç®—æ³•</h2><h3 id="å®ç°æ€è·¯"><a href="#å®ç°æ€è·¯" class="headerlink" title="å®ç°æ€è·¯"></a>å®ç°æ€è·¯</h3><p>å‡è®¾ç”¨æˆ·çš„å…´è¶£å’Œå¹¿å‘Šçš„å…³é”®è¯å¦‚ä¸‹ï¼š</p><ul><li>ç”¨æˆ·å…´è¶£ï¼š<code>[&quot;sports&quot;, &quot;music&quot;, &quot;movies&quot;]</code></li><li>å¹¿å‘Šå…³é”®è¯ï¼š<code>[&quot;movies&quot;, &quot;technology&quot;, &quot;sports&quot;]</code></li></ul><p><strong>æ­¥éª¤</strong>ï¼š</p><ol><li><strong>è®¡ç®—äº¤é›†ï¼ˆå…±åŒå…³é”®è¯ï¼‰</strong>ï¼š<ul><li>å…±åŒå…³é”®è¯ï¼š<code>[&quot;sports&quot;, &quot;movies&quot;]</code></li><li>å…±åŒå…³é”®è¯æ•°é‡ï¼š2</li></ul></li><li><strong>è®¡ç®—å¹¶é›†ï¼ˆæ‰€æœ‰å…³é”®è¯ï¼‰</strong>ï¼š<ul><li>å¹¶é›†ï¼š<code>[&quot;sports&quot;, &quot;music&quot;, &quot;movies&quot;, &quot;technology&quot;]</code></li><li>å¹¶é›†å¤§å°ï¼š4</li></ul></li><li><strong>è®¡ç®—ç›¸ä¼¼åº¦</strong>ï¼š<ul><li>ç›¸ä¼¼åº¦ &#x3D; å…±åŒå…³é”®è¯æ•°é‡ &#x2F; å¹¶é›†å¤§å° &#x3D; 2 &#x2F; 4 &#x3D; 0.5</li></ul></li></ol><h3 id="è§£é‡Š"><a href="#è§£é‡Š" class="headerlink" title="è§£é‡Š"></a>è§£é‡Š</h3><p>è¿™ç§è®¡ç®—æ–¹æ³•å®é™…ä¸Šæ˜¯ä¸€ç§ç®€å•çš„ç›¸ä¼¼åº¦åº¦é‡ï¼Œç±»ä¼¼äºJaccardç›¸ä¼¼ç³»æ•°ï¼Œç”¨äºè¡¡é‡ä¸¤ä¸ªé›†åˆçš„ç›¸ä¼¼ç¨‹åº¦ã€‚Jaccardç›¸ä¼¼ç³»æ•°çš„å®šä¹‰æ˜¯ä¸¤ä¸ªé›†åˆäº¤é›†çš„å¤§å°é™¤ä»¥ä¸¤ä¸ªé›†åˆå¹¶é›†çš„å¤§å°ï¼Œå³ï¼š</p><p>Jaccardç›¸ä¼¼ç³»æ•°&#x3D;âˆ£Aâˆ©Bâˆ£âˆ£AâˆªBâˆ£\text{Jaccardç›¸ä¼¼ç³»æ•°} &#x3D; \frac{|A \cap B|}{|A \cup B|}Jaccardç›¸ä¼¼ç³»æ•°&#x3D;âˆ£AâˆªBâˆ£âˆ£Aâˆ©Bâˆ£</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”¨æˆ·çš„å…´è¶£å’Œå¹¿å‘Šçš„å…³é”®è¯çš„Jaccardç›¸ä¼¼ç³»æ•°ä¸º0.5ï¼Œè¡¨ç¤ºå®ƒä»¬çš„ç›¸ä¼¼åº¦ä¸º50%ã€‚</p><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŸºäºå†…å®¹æ¨è</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Ad&gt; <span class="title function_">recommendAdsByContent</span><span class="params">(User user, <span class="type">int</span> numRecommendations)</span> &#123;</span><br><span class="line">        List&lt;String&gt; userInterests = getUserInterests(user);</span><br><span class="line">        List&lt;Ad&gt; allAds = getAllAds();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸ºæ¯ä¸ªå¹¿å‘Šè®¡ç®—ç›¸ä¼¼åº¦</span></span><br><span class="line">        Map&lt;Ad, Double&gt; adSimilarityMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Ad ad : allAds) &#123;</span><br><span class="line">            List&lt;String&gt; adKeywords = getAdKeywords(ad);</span><br><span class="line">            <span class="type">double</span> <span class="variable">similarity</span> <span class="operator">=</span> calculateSimilarity(userInterests, adKeywords);</span><br><span class="line">            adSimilarityMap.put(ad, similarity);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŒ‰ç›¸ä¼¼åº¦æ’åºå¹¶è·å–æœ€ç›¸ä¼¼çš„å¹¿å‘Š</span></span><br><span class="line">        <span class="keyword">return</span> adSimilarityMap.entrySet().stream()</span><br><span class="line">                .sorted(Map.Entry.&lt;Ad, Double&gt;comparingByValue().reversed())</span><br><span class="line">                .limit(numRecommendations)</span><br><span class="line">                .map(Map.Entry::getKey)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—ç›¸ä¼¼åº¦</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">calculateSimilarity</span><span class="params">(List&lt;String&gt; userInterests, List&lt;String&gt; adKeywords)</span> &#123;</span><br><span class="line">        Set&lt;String&gt; commonKeywords = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(userInterests);</span><br><span class="line">        commonKeywords.retainAll(adKeywords);</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">double</span>) commonKeywords.size() / (userInterests.size() + adKeywords.size());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–ç”¨æˆ·çš„å…´è¶£åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; <span class="title function_">getUserInterests</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.asList(user.getInterest().split(<span class="string">&quot;,&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å¹¿å‘Šåˆ—è¡¨ï¼ˆä»ç¼“å­˜/æ•°æ®åº“ä¸­è·å–ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Ad&gt; <span class="title function_">getAllAds</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonStr</span> <span class="operator">=</span> RedisUtil.get(RedisConstant.AD);</span><br><span class="line">        List&lt;Ad&gt; list = JSONArray.parseArray(jsonStr, Ad.class);</span><br><span class="line">        <span class="keyword">if</span> (ValidateUtil.isBlank(list)) &#123;</span><br><span class="line">            List&lt;Ad&gt; list1 = adMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">            CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">                <span class="type">JSONArray</span> <span class="variable">from</span> <span class="operator">=</span> JSONArray.from(list1);</span><br><span class="line">                RedisUtil.set(RedisConstant.AD, from.toJSONString(JSONWriter.Feature.WriteMapNullValue));</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> list1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å¹¿å‘Šçš„å…³é”®è¯åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; <span class="title function_">getAdKeywords</span><span class="params">(Ad ad)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.asList(ad.getKeywords().split(<span class="string">&quot;,&quot;</span>));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="ååŒè¿‡æ»¤ç®—æ³•"><a href="#ååŒè¿‡æ»¤ç®—æ³•" class="headerlink" title="ååŒè¿‡æ»¤ç®—æ³•"></a>ååŒè¿‡æ»¤ç®—æ³•</h2><p>ååŒè¿‡æ»¤ç®—æ³•çš„åŸºæœ¬æ€è·¯æ˜¯é€šè¿‡åˆ†æç”¨æˆ·ä¸ç”¨æˆ·ä¹‹é—´æˆ–ç‰©å“ä¸ç‰©å“ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼Œæ¥æ¨èç”¨æˆ·å¯èƒ½æ„Ÿå…´è¶£çš„ç‰©å“ã€‚ååŒè¿‡æ»¤ç®—æ³•ä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼šåŸºäºç”¨æˆ·çš„ååŒè¿‡æ»¤å’ŒåŸºäºç‰©å“çš„ååŒè¿‡æ»¤ã€‚</p><blockquote><p>æˆ‘è¿™é‡Œå®ç°çš„æ˜¯åŸºäºç”¨æˆ·çš„ååŒè¿‡æ»¤ç®—æ³•</p></blockquote><h3 id="å®ç°æ€è·¯-1"><a href="#å®ç°æ€è·¯-1" class="headerlink" title="å®ç°æ€è·¯"></a>å®ç°æ€è·¯</h3><ol><li><strong>è·å–æ‰€æœ‰ç”¨æˆ·è¡Œä¸ºæ•°æ®</strong>ï¼š ä»ç¼“å­˜æˆ–æ•°æ®åº“ä¸­è·å–æ‰€æœ‰ç”¨æˆ·çš„è¡Œä¸ºæ•°æ®ï¼ˆUserBehaviorï¼‰ï¼Œå³ç”¨æˆ·å¯¹å¹¿å‘Šçš„ç‚¹å‡»æˆ–æµè§ˆè®°å½•ã€‚</li><li><strong>æ„å»ºç”¨æˆ·å¹¿å‘Šæ˜ å°„</strong>ï¼š æ ¹æ®ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼Œæ„å»ºä¸€ä¸ªç”¨æˆ·å¹¿å‘Šæ˜ å°„ï¼ˆuserAdMapï¼‰ï¼Œå³æ¯ä¸ªç”¨æˆ·å¯¹åº”çš„å¹¿å‘Šåˆ—è¡¨ã€‚</li><li><strong>è®¡ç®—ç”¨æˆ·ç›¸ä¼¼åº¦</strong>ï¼š ä½¿ç”¨Jaccardç›¸ä¼¼ç³»æ•°è®¡ç®—å½“å‰ç”¨æˆ·ä¸å…¶ä»–ç”¨æˆ·ä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚ç›¸ä¼¼åº¦è¶Šé«˜ï¼Œè¡¨ç¤ºä¸¤ä¸ªç”¨æˆ·çš„å…´è¶£è¶Šç›¸ä¼¼ã€‚</li><li><strong>æ‰¾åˆ°æœ€ç›¸ä¼¼çš„ç”¨æˆ·</strong>ï¼š æ‰¾å‡ºä¸å½“å‰ç”¨æˆ·æœ€ç›¸ä¼¼çš„ä¸€ç»„ç”¨æˆ·ï¼ˆé‚»å±…ç”¨æˆ·ï¼‰ã€‚</li><li><strong>ç”Ÿæˆæ¨èå¹¿å‘Šåˆ—è¡¨</strong>ï¼š æ ¹æ®é‚»å±…ç”¨æˆ·çš„å¹¿å‘Šåˆ—è¡¨ï¼Œç”Ÿæˆä¸€ä¸ªå¹¿å‘Šæ¨èåˆ—è¡¨ã€‚</li><li><strong>è¿”å›æ¨èå¹¿å‘Š</strong>ï¼š è¿”å›æœ€ç»ˆçš„æ¨èå¹¿å‘Šåˆ—è¡¨ã€‚</li></ol><h3 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŸºäºååŒè¿‡æ»¤æ¨è</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Ad&gt; <span class="title function_">recommendAdsByCollaborativeFiltering</span><span class="params">(User user, <span class="type">int</span> numRecommendations)</span> &#123;</span><br><span class="line">        List&lt;UserBehavior&gt; allUserBehaviors = getAllUserBehaviors();</span><br><span class="line">        Map&lt;String, List&lt;String&gt;&gt; userAdMap = getUserAdMap(allUserBehaviors);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¡ç®—ä¸å½“å‰ç”¨æˆ·çš„ç›¸ä¼¼åº¦</span></span><br><span class="line">        Map&lt;String, Double&gt; userSimilarityMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (String otherUserId : userAdMap.keySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!otherUserId.equals(user.getId())) &#123;</span><br><span class="line">                <span class="type">double</span> <span class="variable">similarity</span> <span class="operator">=</span> calculateUserSimilarity(user.getId(), otherUserId, userAdMap);</span><br><span class="line">                userSimilarityMap.put(otherUserId, similarity);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰¾åˆ°æœ€ç›¸ä¼¼çš„ç”¨æˆ·</span></span><br><span class="line">        List&lt;String&gt; similarUsers = userSimilarityMap.entrySet().stream()</span><br><span class="line">                .sorted(Map.Entry.&lt;String, Double&gt;comparingByValue().reversed())</span><br><span class="line">                .limit(numRecommendations)</span><br><span class="line">                .map(Map.Entry::getKey)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¨èè¿™äº›ç”¨æˆ·å–œæ¬¢çš„å¹¿å‘Š</span></span><br><span class="line">        Set&lt;String&gt; recommendedAdIds = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (String similarUserId : similarUsers) &#123;</span><br><span class="line">            recommendedAdIds.addAll(userAdMap.get(similarUserId));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æ¨èçš„å¹¿å‘Šåˆ—è¡¨</span></span><br><span class="line">        List&lt;Ad&gt; recommendedAds = recommendedAdIds.stream()</span><br><span class="line">                .map(<span class="built_in">this</span>::getAdById)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> recommendedAds.stream().limit(numRecommendations).collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—ç”¨æˆ·ç›¸ä¼¼åº¦ï¼ˆåŸºäºJaccardç›¸ä¼¼ç³»æ•°ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">calculateUserSimilarity</span><span class="params">(String userId1, String userId2, Map&lt;String, List&lt;String&gt;&gt; userAdMap)</span> &#123;</span><br><span class="line">        Set&lt;String&gt; user1Ads = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(userAdMap.get(userId1));</span><br><span class="line">        Set&lt;String&gt; user2Ads = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(userAdMap.get(userId2));</span><br><span class="line"></span><br><span class="line">        Set&lt;String&gt; intersection = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(user1Ads);</span><br><span class="line">        intersection.retainAll(user2Ads);</span><br><span class="line"></span><br><span class="line">        Set&lt;String&gt; union = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(user1Ads);</span><br><span class="line">        union.addAll(user2Ads);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (<span class="type">double</span>) intersection.size() / union.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æ‰€æœ‰ç”¨æˆ·çš„è¡Œä¸ºæ•°æ®</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;UserBehavior&gt; <span class="title function_">getAllUserBehaviors</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ä»ç¼“å­˜æˆ–æ•°æ®åº“è·å–ç”¨æˆ·è¡Œä¸ºæ•°æ®</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonStr</span> <span class="operator">=</span> RedisUtil.get(RedisConstant.USER_BEHAVIOR);</span><br><span class="line">        List&lt;UserBehavior&gt; list = JSONArray.parseArray(jsonStr, UserBehavior.class);</span><br><span class="line">        <span class="keyword">if</span> (ValidateUtil.isBlank(list)) &#123;</span><br><span class="line">            List&lt;UserBehavior&gt; list1 = userBehaviorMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">            CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">                <span class="type">JSONArray</span> <span class="variable">from</span> <span class="operator">=</span> JSONArray.from(list1);</span><br><span class="line">                RedisUtil.set(RedisConstant.USER_BEHAVIOR, from.toJSONString(JSONWriter.Feature.WriteMapNullValue));</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> list1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–ç”¨æˆ·å¹¿å‘Šæ˜ å°„</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, List&lt;String&gt;&gt; <span class="title function_">getUserAdMap</span><span class="params">(List&lt;UserBehavior&gt; allUserBehaviors)</span> &#123;</span><br><span class="line">        Map&lt;String, List&lt;String&gt;&gt; userAdMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (UserBehavior behavior : allUserBehaviors) &#123;</span><br><span class="line">            userAdMap.computeIfAbsent(behavior.getUserId(), k -&gt; <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;()).add(behavior.getAdId());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> userAdMap;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="SVDç®—æ³•"><a href="#SVDç®—æ³•" class="headerlink" title="SVDç®—æ³•"></a>SVDç®—æ³•</h2><h3 id="å®ç°æ€è·¯-2"><a href="#å®ç°æ€è·¯-2" class="headerlink" title="å®ç°æ€è·¯"></a>å®ç°æ€è·¯</h3><ol><li><strong>è·å–ç”¨æˆ·è¡Œä¸ºæ•°æ®</strong>ï¼š ä»ç¼“å­˜æˆ–æ•°æ®åº“ä¸­è·å–æ‰€æœ‰ç”¨æˆ·çš„è¡Œä¸ºæ•°æ®ï¼ˆUserBehaviorï¼‰ï¼Œå³ç”¨æˆ·å¯¹å¹¿å‘Šçš„ç‚¹å‡»æˆ–æµè§ˆè®°å½•ã€‚</li><li><strong>æ„å»ºç”¨æˆ·å¹¿å‘Šæ˜ å°„</strong>ï¼š æ ¹æ®ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼Œæ„å»ºä¸€ä¸ªç”¨æˆ·å¹¿å‘Šæ˜ å°„ï¼ˆuserAdMapï¼‰ï¼Œå³æ¯ä¸ªç”¨æˆ·å¯¹åº”çš„å¹¿å‘Šåˆ—è¡¨ã€‚</li><li><strong>æ„å»ºç”¨æˆ·-å¹¿å‘ŠçŸ©é˜µ</strong>ï¼š å°†ç”¨æˆ·å¹¿å‘Šæ˜ å°„è½¬æ¢ä¸ºç”¨æˆ·-å¹¿å‘ŠçŸ©é˜µï¼Œå…¶ä¸­è¡Œä»£è¡¨ç”¨æˆ·ï¼Œåˆ—ä»£è¡¨å¹¿å‘Šï¼ŒçŸ©é˜µä¸­çš„å€¼è¡¨ç¤ºç”¨æˆ·æ˜¯å¦ä¸è¯¥å¹¿å‘Šæœ‰è¿‡äº’åŠ¨ï¼ˆä¾‹å¦‚ç‚¹å‡»æˆ–æµè§ˆï¼‰ã€‚</li><li><strong>è®¡ç®—SVDåˆ†è§£</strong>ï¼š ä½¿ç”¨SVDï¼ˆSingular Value Decompositionï¼Œå¥‡å¼‚å€¼åˆ†è§£ï¼‰å¯¹ç”¨æˆ·-å¹¿å‘ŠçŸ©é˜µè¿›è¡Œåˆ†è§£ï¼Œå¾—åˆ°ç”¨æˆ·ç‰¹å¾çŸ©é˜µã€å¥‡å¼‚å€¼çŸ©é˜µå’Œå¹¿å‘Šç‰¹å¾çŸ©é˜µã€‚</li><li><strong>é‡æ„çŸ©é˜µ</strong>ï¼š ä½¿ç”¨å‰kä¸ªå¥‡å¼‚å€¼å’Œç›¸åº”çš„ç‰¹å¾çŸ©é˜µæ¥é‡æ„ç”¨æˆ·-å¹¿å‘ŠçŸ©é˜µçš„è¿‘ä¼¼çŸ©é˜µã€‚</li><li><strong>ç”Ÿæˆæ¨èå¹¿å‘Šåˆ—è¡¨</strong>ï¼š æ ¹æ®é‡æ„çš„çŸ©é˜µï¼Œä¸ºæ¯ä¸ªç”¨æˆ·ç”Ÿæˆæ¨èå¹¿å‘Šåˆ—è¡¨ã€‚</li></ol><h3 id="ä»£ç å®ç°-2"><a href="#ä»£ç å®ç°-2" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŸºäºSVDç®—æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Ad&gt; <span class="title function_">recommendAdsBySVD</span><span class="params">(User user, <span class="type">int</span> numRecommendations)</span> &#123;</span><br><span class="line">        List&lt;UserBehavior&gt; allUserBehaviors = getAllUserBehaviors();</span><br><span class="line">        Map&lt;String, List&lt;String&gt;&gt; userAdMap = getUserAdMap(allUserBehaviors);</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; userIds = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(userAdMap.keySet());</span><br><span class="line">        List&lt;String&gt; adIds = getAllAds().stream()</span><br><span class="line">                .map(Ad::getId)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="type">double</span>[][] data = buildUserAdMatrix(userAdMap, userIds, adIds);</span><br><span class="line">        <span class="type">SVDRecommendation</span> <span class="variable">svdRec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SVDRecommendation</span>(data, userIds, adIds);</span><br><span class="line">        List&lt;String&gt; recommendedAdIds = svdRec.recommend(user.getId(), numRecommendations);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> recommendedAdIds.stream()</span><br><span class="line">                .map(<span class="built_in">this</span>::getAdById)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„å»ºç”¨æˆ·-å¹¿å‘ŠçŸ©é˜µ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span>[][] buildUserAdMatrix(Map&lt;String, List&lt;String&gt;&gt; userAdMap, List&lt;String&gt; userIds, List&lt;String&gt; adIds) &#123;</span><br><span class="line">        <span class="type">double</span>[][] data = <span class="keyword">new</span> <span class="title class_">double</span>[userIds.size()][adIds.size()];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; userIds.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; adIds.size(); j++) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> userIds.get(i);</span><br><span class="line">                <span class="type">String</span> <span class="variable">adId</span> <span class="operator">=</span> adIds.get(j);</span><br><span class="line">                data[i][j] = userAdMap.getOrDefault(userId, Collections.emptyList()).contains(adId) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SVDRecommendation</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RealMatrix userAdMatrix;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; userIds;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; adIds;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SVDRecommendation</span><span class="params">(<span class="type">double</span>[][] data, List&lt;String&gt; userIds, List&lt;String&gt; adIds)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userAdMatrix = MatrixUtils.createRealMatrix(data);</span><br><span class="line">        <span class="built_in">this</span>.userIds = userIds;</span><br><span class="line">        <span class="built_in">this</span>.adIds = adIds;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> RealMatrix <span class="title function_">computeSVD</span><span class="params">(<span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="type">SingularValueDecomposition</span> <span class="variable">svd</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingularValueDecomposition</span>(userAdMatrix);</span><br><span class="line">        <span class="type">RealMatrix</span> <span class="variable">U</span> <span class="operator">=</span> svd.getU();</span><br><span class="line">        <span class="type">RealMatrix</span> <span class="variable">S</span> <span class="operator">=</span> MatrixUtils.createRealDiagonalMatrix(Arrays.copyOfRange(svd.getSingularValues(), <span class="number">0</span>, k));</span><br><span class="line">        <span class="type">RealMatrix</span> <span class="variable">V</span> <span class="operator">=</span> svd.getVT();</span><br><span class="line">        <span class="type">RealMatrix</span> <span class="variable">U_k</span> <span class="operator">=</span> U.getSubMatrix(<span class="number">0</span>, U.getRowDimension() - <span class="number">1</span>, <span class="number">0</span>, k - <span class="number">1</span>);</span><br><span class="line">        <span class="type">RealMatrix</span> <span class="variable">V_k</span> <span class="operator">=</span> V.getSubMatrix(<span class="number">0</span>, k - <span class="number">1</span>, <span class="number">0</span>, V.getColumnDimension() - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> U_k.multiply(S).multiply(V_k);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">recommend</span><span class="params">(String userId, <span class="type">int</span> numRecommendations)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">userIndex</span> <span class="operator">=</span> userIds.indexOf(userId);</span><br><span class="line">        <span class="type">RealMatrix</span> <span class="variable">predictedMatrix</span> <span class="operator">=</span> computeSVD(<span class="number">10</span>);</span><br><span class="line">        <span class="type">double</span>[] userRatings = predictedMatrix.getRow(userIndex);</span><br><span class="line"></span><br><span class="line">        List&lt;Map.Entry&lt;Integer, Double&gt;&gt; adRatings = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; userRatings.length; i++) &#123;</span><br><span class="line">            adRatings.add(<span class="keyword">new</span> <span class="title class_">AbstractMap</span>.SimpleEntry&lt;&gt;(i, userRatings[i]));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        adRatings.sort((e1, e2) -&gt; Double.compare(e2.getValue(), e1.getValue()));</span><br><span class="line">        List&lt;String&gt; recommendedAds = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; numRecommendations &amp;&amp; i &lt; adRatings.size(); i++) &#123;</span><br><span class="line">            recommendedAds.add(adIds.get(adRatings.get(i).getKey()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> recommendedAds;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½ç½®å½’ä¸€åŒ–å’Œæ›å…‰é¢‘æ¬¡æ§åˆ¶ç®—æ³•"><a href="#ä½ç½®å½’ä¸€åŒ–å’Œæ›å…‰é¢‘æ¬¡æ§åˆ¶ç®—æ³•" class="headerlink" title="ä½ç½®å½’ä¸€åŒ–å’Œæ›å…‰é¢‘æ¬¡æ§åˆ¶ç®—æ³•"></a>ä½ç½®å½’ä¸€åŒ–å’Œæ›å…‰é¢‘æ¬¡æ§åˆ¶ç®—æ³•</h2><h3 id="å®ç°æ€è·¯-3"><a href="#å®ç°æ€è·¯-3" class="headerlink" title="å®ç°æ€è·¯"></a>å®ç°æ€è·¯</h3><ol><li><p><strong>è·å–ç”¨æˆ·å…´è¶£æ•°æ®</strong>ï¼š ä»ç³»ç»Ÿä¸­è·å–ç”¨æˆ·çš„å…´è¶£æ•°æ®ï¼Œä¾‹å¦‚ç”¨æˆ·å–œæ¬¢çš„å¹¿å‘Šç±»åˆ«æˆ–å…³é”®è¯ã€‚</p></li><li><p><strong>è·å–æ‰€æœ‰å¹¿å‘Šæ•°æ®</strong>ï¼š è·å–ç³»ç»Ÿä¸­æ‰€æœ‰å¹¿å‘Šçš„æ•°æ®ï¼ŒåŒ…æ‹¬å¹¿å‘Šçš„å…³é”®è¯ã€ä½ç½®å’Œæ›å…‰æ¬¡æ•°ç­‰ä¿¡æ¯ã€‚</p></li><li><p><strong>è®¡ç®—å¹¿å‘Šçš„ç»¼åˆæƒé‡</strong>ï¼š ä¸ºæ¯ä¸ªå¹¿å‘Šè®¡ç®—ç»¼åˆæƒé‡ï¼Œè¯¥æƒé‡ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šå¹¿å‘Šä¸ç”¨æˆ·å…´è¶£çš„ç›¸ä¼¼åº¦ã€å¹¿å‘Šçš„ä½ç½®æƒé‡ã€å¹¿å‘Šçš„æ›å…‰æƒé‡ã€‚</p></li><li><p><strong>æ ¹æ®ç»¼åˆæƒé‡æ’åºå¹¿å‘Š</strong>ï¼š å°†æ‰€æœ‰å¹¿å‘ŠæŒ‰ç…§ç»¼åˆæƒé‡æ’åºï¼Œé€‰æ‹©æƒé‡æœ€é«˜çš„å¹¿å‘Šä½œä¸ºæ¨èç»“æœã€‚</p></li></ol><h3 id="ä»£ç å®ç°-3"><a href="#ä»£ç å®ç°-3" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŸºäºä½ç½®å½’ä¸€åŒ–å’Œæ›å…‰é¢‘æ¬¡æ§åˆ¶ç®—æ³•å®ç°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Ad&gt; <span class="title function_">recommendAdsByPositionAndExposure</span><span class="params">(User user, <span class="type">int</span> numRecommendations)</span> &#123;</span><br><span class="line">        List&lt;String&gt; userInterests = getUserInterests(user);</span><br><span class="line">        List&lt;Ad&gt; allAds = getAllAds();</span><br><span class="line">        <span class="type">double</span> <span class="variable">maxPosition</span> <span class="operator">=</span> allAds.stream().mapToDouble(Ad::getPosition).max().orElse(<span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸ºæ¯ä¸ªå¹¿å‘Šè®¡ç®—ç»¼åˆæƒé‡</span></span><br><span class="line">        Map&lt;Ad, Double&gt; adWeightMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Ad ad : allAds) &#123;</span><br><span class="line">            List&lt;String&gt; adKeywords = getAdKeywords(ad);</span><br><span class="line">            <span class="type">double</span> <span class="variable">similarity</span> <span class="operator">=</span> calculateSimilarity(userInterests, adKeywords);</span><br><span class="line">            <span class="type">double</span> <span class="variable">positionWeight</span> <span class="operator">=</span> getPositionWeight(ad.getPosition(), maxPosition);</span><br><span class="line">            <span class="type">double</span> <span class="variable">exposureWeight</span> <span class="operator">=</span> getExposureWeight(ad.getExposureCount());</span><br><span class="line">            <span class="type">double</span> <span class="variable">totalWeight</span> <span class="operator">=</span> similarity * positionWeight * exposureWeight;</span><br><span class="line">            adWeightMap.put(ad, totalWeight);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŒ‰ç»¼åˆæƒé‡æ’åºå¹¶è·å–æœ€é«˜æƒé‡çš„å¹¿å‘Š</span></span><br><span class="line">        <span class="keyword">return</span> adWeightMap.entrySet().stream()</span><br><span class="line">                .sorted(Map.Entry.&lt;Ad, Double&gt;comparingByValue().reversed())</span><br><span class="line">                .limit(numRecommendations)</span><br><span class="line">                .map(Map.Entry::getKey)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—ä½ç½®æƒé‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">getPositionWeight</span><span class="params">(<span class="type">double</span> position, <span class="type">double</span> maxPosition)</span> &#123;</span><br><span class="line">        <span class="comment">// çº¿æ€§å½’ä¸€åŒ–ï¼Œä½ç½®å€¼è¶Šå°æƒé‡è¶Šé«˜</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1.0</span> - (position / maxPosition);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—æ›å…‰æƒé‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">getExposureWeight</span><span class="params">(<span class="type">int</span> exposureCount)</span> &#123;</span><br><span class="line">        <span class="comment">// æ›å…‰é¢‘æ¬¡æ§åˆ¶ï¼Œå‡è®¾æ›å…‰æ¬¡æ•°è¶Šå¤šæƒé‡è¶Šä½</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1.0</span> / (<span class="number">1.0</span> + Math.log(<span class="number">1</span> + exposureCount));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="å¤šæ ·æ€§å’Œæ¢ç´¢æœºåˆ¶"><a href="#å¤šæ ·æ€§å’Œæ¢ç´¢æœºåˆ¶" class="headerlink" title="å¤šæ ·æ€§å’Œæ¢ç´¢æœºåˆ¶"></a>å¤šæ ·æ€§å’Œæ¢ç´¢æœºåˆ¶</h2><h3 id="å®ç°æ€è·¯-4"><a href="#å®ç°æ€è·¯-4" class="headerlink" title="å®ç°æ€è·¯"></a>å®ç°æ€è·¯</h3><ol><li><p><strong>è·å–ç”¨æˆ·è¡Œä¸ºæ•°æ®</strong>ï¼šé¦–å…ˆé€šè¿‡è°ƒç”¨<code>getAllUserBehaviors()</code>æ–¹æ³•è·å–æ‰€æœ‰ç”¨æˆ·çš„è¡Œä¸ºæ•°æ®ï¼Œè¿™äº›è¡Œä¸ºæ•°æ®åŒ…æ‹¬ç”¨æˆ·å¯¹å¹¿å‘Šçš„æµè§ˆã€ç‚¹å‡»ç­‰æ“ä½œã€‚</p></li><li><p><strong>åˆå§‹åŒ–å·²çœ‹è¿‡çš„å¹¿å‘Šç±»å‹é›†åˆ</strong>ï¼šåˆ›å»ºä¸€ä¸ªç©ºçš„<code>HashSet</code>ç”¨äºå­˜å‚¨å·²ç»æ¨èè¿‡çš„å¹¿å‘Šç±»å‹ï¼Œç¡®ä¿åç»­æ¨èçš„å¹¿å‘Šç±»å‹æ˜¯å¤šæ ·çš„ã€‚</p></li><li><p><strong>åˆ›å»ºæœ€ç»ˆè¿”å›çš„å¹¿å‘Šåˆ—è¡¨</strong>ï¼šåˆå§‹åŒ–ä¸€ä¸ªç©ºçš„<code>ArrayList</code>ç”¨äºå­˜å‚¨æœ€ç»ˆçš„æ¨èå¹¿å‘Šåˆ—è¡¨<code>diverseAds</code>ã€‚</p></li><li><p><strong>éšæœºæ•°ç”Ÿæˆå™¨</strong>ï¼šåˆ›å»ºä¸€ä¸ª<code>Random</code>å¯¹è±¡ï¼Œç”¨äºç”Ÿæˆéšæœºæ•°ï¼Œåç»­ç”¨äºæ§åˆ¶æ¢ç´¢æœºåˆ¶çš„æ¦‚ç‡ã€‚</p></li><li><p><strong>è®¡ç®—ç”¨æˆ·å¯¹æ¯ä¸ªå¹¿å‘Šç±»å‹çš„å…´è¶£åº¦</strong>ï¼šè°ƒç”¨<code>calculateCategoryInterest()</code>æ–¹æ³•ï¼Œä¼ å…¥ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼Œè®¡ç®—ç”¨æˆ·å¯¹æ¯ä¸ªå¹¿å‘Šç±»å‹çš„å…´è¶£åº¦ï¼Œè¿”å›ä¸€ä¸ª<code>Map&lt;String, Double&gt;</code>ï¼Œå…¶ä¸­é”®æ˜¯å¹¿å‘Šç±»å‹ï¼Œå€¼æ˜¯ç”¨æˆ·å¯¹è¯¥å¹¿å‘Šç±»å‹çš„å…´è¶£åº¦ã€‚</p></li><li><p><strong>éå†æ¨èçš„å¹¿å‘Šåˆ—è¡¨</strong>ï¼šå¯¹æ¨èçš„æ¯ä¸ªå¹¿å‘Šè¿›è¡Œéå†ï¼Œåˆ¤æ–­æ˜¯å¦å·²ç»æ¨èè¿‡è¯¥å¹¿å‘Šç±»å‹ã€‚</p></li><li><p><strong>æ ¹æ®ç”¨æˆ·å¯¹å¹¿å‘Šç±»åˆ«çš„å…´è¶£åº¦åŠ¨æ€è°ƒæ•´æ¢ç´¢æ¦‚ç‡</strong>ï¼šè°ƒç”¨<code>getExploreProbability()</code>æ–¹æ³•ï¼Œæ ¹æ®ç”¨æˆ·å¯¹å¹¿å‘Šç±»åˆ«çš„å…´è¶£åº¦ï¼ŒåŠ¨æ€è°ƒæ•´æ¢ç´¢æ¦‚ç‡ã€‚å¦‚æœç”¨æˆ·å¯¹è¯¥å¹¿å‘Šç±»åˆ«çš„å…´è¶£åº¦è¶Šé«˜ï¼Œæ¢ç´¢æ¦‚ç‡è¶Šä½ï¼Œæœ€ä½ä¸º10%ã€‚</p></li><li><p><strong>æ¢ç´¢æœºåˆ¶</strong>ï¼šä½¿ç”¨éšæœºæ•°ç”Ÿæˆå™¨ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œå¦‚æœè¯¥éšæœºæ•°å°äºæ¢ç´¢æ¦‚ç‡ï¼Œåˆ™å°†å½“å‰å¹¿å‘ŠåŠ å…¥åˆ°æœ€ç»ˆæ¨èåˆ—è¡¨ä¸­ï¼Œä»è€Œå®ç°æ¢ç´¢æœºåˆ¶ã€‚</p></li><li><p><strong>å¡«è¡¥æ¨èåˆ—è¡¨</strong>ï¼šå¦‚æœå¤šæ ·æ€§ä¸å¤Ÿï¼Œç»§ç»­ä»æ¨èåˆ—è¡¨ä¸­å¡«å……å¹¿å‘Šï¼Œç›´åˆ°è¾¾åˆ°æŒ‡å®šæ•°é‡ã€‚</p></li><li><p><strong>è¿”å›æœ€ç»ˆæ¨èåˆ—è¡¨</strong>ï¼šè¿”å›æœ€ç»ˆçš„æ¨èå¹¿å‘Šåˆ—è¡¨<code>diverseAds</code>ã€‚</p></li></ol><p>é€šè¿‡ä»¥ä¸Šé€»è¾‘ï¼Œè¿™æ®µä»£ç èƒ½å¤Ÿæ ¹æ®ç”¨æˆ·çš„è¡Œä¸ºæ•°æ®è®¡ç®—ç”¨æˆ·å¯¹ä¸åŒå¹¿å‘Šç±»å‹çš„å…´è¶£åº¦ï¼Œç„¶åæ ¹æ®å…´è¶£åº¦åŠ¨æ€è°ƒæ•´æ¢ç´¢æ¦‚ç‡ï¼Œä»è€Œå¢åŠ æ¨èç»“æœçš„å¤šæ ·æ€§å’Œæ¢ç´¢æœºåˆ¶ã€‚</p><h3 id="ä»£ç å®ç°-4"><a href="#ä»£ç å®ç°-4" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¢åŠ æ¨èç»“æœçš„å¤šæ ·æ€§å’Œæ¢ç´¢æœºåˆ¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Ad&gt; <span class="title function_">addDiversityAndExploration</span><span class="params">(List&lt;Ad&gt; recommendedAds, <span class="type">int</span> numRecommendations)</span> &#123;</span><br><span class="line">        List&lt;UserBehavior&gt; behaviorList = getAllUserBehaviors();</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–å·²çœ‹è¿‡çš„å¹¿å‘Šç±»å‹é›†åˆ</span></span><br><span class="line">        Set&lt;String&gt; seenCategories = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// æœ€ç»ˆè¿”å›çš„å¹¿å‘Šåˆ—è¡¨</span></span><br><span class="line">        List&lt;Ad&gt; diverseAds = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¡ç®—ç”¨æˆ·å¯¹æ¯ä¸ªå¹¿å‘Šç±»å‹çš„å…´è¶£åº¦</span></span><br><span class="line">        Map&lt;String, Double&gt; categoryInterestMap = calculateCategoryInterest(behaviorList);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Ad ad : recommendedAds) &#123;</span><br><span class="line">            <span class="keyword">if</span> (diverseAds.size() &gt;= numRecommendations) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> ad.getType();</span><br><span class="line">            <span class="keyword">if</span> (!seenCategories.contains(type)) &#123;</span><br><span class="line">                diverseAds.add(ad);</span><br><span class="line">                seenCategories.add(type);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// æ ¹æ®ç”¨æˆ·å¯¹è¯¥ç±»åˆ«çš„å…´è¶£åº¦åŠ¨æ€è°ƒæ•´æ¢ç´¢æ¦‚ç‡</span></span><br><span class="line">                <span class="type">double</span> <span class="variable">exploreProbability</span> <span class="operator">=</span> getExploreProbability(type, categoryInterestMap);</span><br><span class="line">                <span class="keyword">if</span> (random.nextDouble() &lt; exploreProbability) &#123;</span><br><span class="line">                    diverseAds.add(ad);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœå¤šæ ·æ€§ä¸å¤Ÿï¼Œå¡«è¡¥æ¨èåˆ—è¡¨</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (diverseAds.size() &lt; numRecommendations &amp;&amp; i &lt; recommendedAds.size()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!diverseAds.contains(recommendedAds.get(i))) &#123;</span><br><span class="line">                diverseAds.add(recommendedAds.get(i));</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> diverseAds;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®ç”¨æˆ·å¯¹å¹¿å‘Šç±»åˆ«çš„å…´è¶£åº¦åŠ¨æ€è°ƒæ•´æ¢ç´¢æ¦‚ç‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">getExploreProbability</span><span class="params">(String category, Map&lt;String, Double&gt; categoryInterestMap)</span> &#123;</span><br><span class="line">        <span class="type">double</span> <span class="variable">interest</span> <span class="operator">=</span> categoryInterestMap.getOrDefault(category, <span class="number">0.0</span>);</span><br><span class="line">        <span class="comment">// å‡è®¾å…´è¶£åº¦è¶Šé«˜ï¼Œæ¢ç´¢æ¦‚ç‡è¶Šä½ï¼Œæœ€ä½ä¸º10%</span></span><br><span class="line">        <span class="keyword">return</span> Math.max(<span class="number">0.1</span>, <span class="number">1.0</span> - interest);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—ç”¨æˆ·å¯¹æ¯ä¸ªå¹¿å‘Šç±»å‹çš„å…´è¶£åº¦</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Double&gt; <span class="title function_">calculateCategoryInterest</span><span class="params">(List&lt;UserBehavior&gt; behaviorList)</span> &#123;</span><br><span class="line">        Map&lt;String, Double&gt; categoryInterestMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Map&lt;String, Integer&gt; categoryCountMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (UserBehavior behavior : behaviorList) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">adId</span> <span class="operator">=</span> behavior.getAdId();</span><br><span class="line">            <span class="type">Ad</span> <span class="variable">ad</span> <span class="operator">=</span> getAdById(adId);</span><br><span class="line">            <span class="type">String</span> <span class="variable">category</span> <span class="operator">=</span> ad.getType();</span><br><span class="line">            categoryCountMap.put(category, categoryCountMap.getOrDefault(category, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Integer&gt; entry : categoryCountMap.entrySet()) &#123;</span><br><span class="line">            categoryInterestMap.put(entry.getKey(), entry.getValue() / (<span class="type">double</span>) behaviorList.size());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> categoryInterestMap;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1 id="éœ€è¦è§£å†³çš„é—®é¢˜"><a href="#éœ€è¦è§£å†³çš„é—®é¢˜" class="headerlink" title="éœ€è¦è§£å†³çš„é—®é¢˜"></a>éœ€è¦è§£å†³çš„é—®é¢˜</h1><p>ä¸‹é¢æ˜¯é’ˆå¯¹å†·å¯åŠ¨é—®é¢˜ã€æ•°æ®ç¨€ç–é—®é¢˜ã€é¢„ä¼°åå·®é—®é¢˜å’Œå¤šæ ·æ€§é—®é¢˜çš„å…¶ä»–è§£å†³æ–¹æ¡ˆï¼š</p><h2 id="å†·å¯åŠ¨é—®é¢˜"><a href="#å†·å¯åŠ¨é—®é¢˜" class="headerlink" title="å†·å¯åŠ¨é—®é¢˜"></a>å†·å¯åŠ¨é—®é¢˜</h2><ol><li><p><strong>åŸºäºäººå£ç»Ÿè®¡å­¦ç‰¹å¾çš„æ¨è</strong>ï¼š</p><ul><li>åˆ©ç”¨ç”¨æˆ·çš„å¹´é¾„ã€æ€§åˆ«ã€åœ°ç†ä½ç½®ç­‰äººå£ç»Ÿè®¡å­¦ç‰¹å¾è¿›è¡Œåˆæ­¥æ¨èã€‚</li><li>ä¾‹å¦‚ï¼Œæ–°ç”¨æˆ·åˆšæ³¨å†Œæ—¶ï¼Œå¯ä»¥æ ¹æ®ä¸å…¶ç›¸ä¼¼ç‰¹å¾çš„ç”¨æˆ·æ¨èå¹¿å‘Šã€‚</li></ul></li><li><p><strong>ä½¿ç”¨ç¤¾äº¤ç½‘ç»œæ•°æ®</strong>ï¼š</p><ul><li>åˆ©ç”¨ç”¨æˆ·çš„ç¤¾äº¤ç½‘ç»œæ•°æ®ï¼ˆå¦‚æœ‹å‹ã€å…³æ³¨è€…ï¼‰è¿›è¡Œæ¨èã€‚</li><li>ä¾‹å¦‚ï¼Œæ–°ç”¨æˆ·å¯ä»¥æ”¶åˆ°å…¶å¥½å‹å–œæ¬¢çš„å¹¿å‘Šæ¨èã€‚</li></ul></li><li><p><strong>çƒ­é—¨å¹¿å‘Šæ¨è</strong>ï¼š</p><ul><li>æ¨èå½“å‰çƒ­é—¨çš„ã€å—æ¬¢è¿çš„å¹¿å‘Šç»™æ–°ç”¨æˆ·ã€‚</li><li>è¿™ç§æ–¹å¼ç¡®ä¿æ–°ç”¨æˆ·çœ‹åˆ°çš„å¹¿å‘Šæ˜¯å½“å‰æµè¡Œçš„ï¼Œå¯èƒ½æœ‰è¾ƒé«˜çš„æ¥å—åº¦ã€‚</li></ul></li><li><p><strong>æ¢ç´¢æ€§æ¨è</strong>ï¼š</p><ul><li>éšæœºæ¨èä¸€äº›å¹¿å‘Šä»¥è·å–ç”¨æˆ·çš„åå¥½åé¦ˆã€‚</li><li>é€šè¿‡è§‚å¯Ÿç”¨æˆ·çš„ç‚¹å‡»å’Œæµè§ˆè¡Œä¸ºé€æ­¥äº†è§£å…¶å…´è¶£ã€‚</li></ul></li></ol><h2 id="æ•°æ®ç¨€ç–é—®é¢˜"><a href="#æ•°æ®ç¨€ç–é—®é¢˜" class="headerlink" title="æ•°æ®ç¨€ç–é—®é¢˜"></a>æ•°æ®ç¨€ç–é—®é¢˜</h2><ol><li><p><strong>åŸºäºé‚»åŸŸçš„æ–¹æ³•</strong>ï¼š</p><ul><li>ä½¿ç”¨KNNï¼ˆK-Nearest Neighborsï¼‰ç®—æ³•ï¼Œé€šè¿‡æ‰¾åˆ°ä¸ç”¨æˆ·ç›¸ä¼¼çš„å…¶ä»–ç”¨æˆ·æ¥å¡«è¡¥æ•°æ®ç¨€ç–åŒºåŸŸã€‚</li><li>é€šè¿‡è®¡ç®—ç”¨æˆ·ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œé¢„æµ‹ç”¨æˆ·å¯¹æœªè¯„åˆ†å¹¿å‘Šçš„è¯„åˆ†ã€‚</li></ul></li><li><p><strong>åŸºäºæ·±åº¦å­¦ä¹ çš„æ–¹æ³•</strong>ï¼š</p><ul><li>ä½¿ç”¨ç¥ç»ç½‘ç»œè¿›è¡Œæ¨èï¼Œä¾‹å¦‚Autoencodersã€æ·±åº¦çŸ©é˜µåˆ†è§£ï¼ˆDeep Matrix Factorizationï¼‰ç­‰ã€‚</li><li>è¿™äº›æ–¹æ³•å¯ä»¥é€šè¿‡å­¦ä¹ éšå«ç‰¹å¾æ¥å¡«è¡¥æ•°æ®ç¨€ç–é—®é¢˜ã€‚</li></ul></li><li><p><strong>é›†æˆæ–¹æ³•</strong>ï¼š</p><ul><li>å°†å¤šç§æ¨èç®—æ³•ç»„åˆåœ¨ä¸€èµ·ï¼Œä¾‹å¦‚ååŒè¿‡æ»¤ä¸åŸºäºå†…å®¹çš„æ¨èç»“åˆã€‚</li><li>è¿™ç§æ–¹æ³•å¯ä»¥ç»¼åˆä¸åŒç®—æ³•çš„ä¼˜ç‚¹ï¼Œæé«˜æ¨èçš„è¦†ç›–ç‡å’Œå‡†ç¡®æ€§ã€‚</li></ul></li></ol><h2 id="é¢„ä¼°åå·®é—®é¢˜"><a href="#é¢„ä¼°åå·®é—®é¢˜" class="headerlink" title="é¢„ä¼°åå·®é—®é¢˜"></a>é¢„ä¼°åå·®é—®é¢˜</h2><ol><li><p><strong>å½’ä¸€åŒ–å¤„ç†</strong>ï¼š</p><ul><li>å¯¹ä½ç½®ã€æ—¶é—´ç­‰å½±å“å› ç´ è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œä¾‹å¦‚å°†å¹¿å‘Šä½ç½®æ ‡å‡†åŒ–åˆ°åŒä¸€å°ºåº¦ã€‚</li><li>ä½¿ç”¨Min-Maxå½’ä¸€åŒ–æˆ–Z-scoreå½’ä¸€åŒ–æ¥å¹³è¡¡ä¸åŒç‰¹å¾çš„å½±å“ã€‚</li></ul></li><li><p><strong>å¤šä»»åŠ¡å­¦ä¹ </strong>ï¼š</p><ul><li>ä½¿ç”¨å¤šä»»åŠ¡å­¦ä¹ æ–¹æ³•ï¼ŒåŒæ—¶å­¦ä¹ ç”¨æˆ·åå¥½å’Œå¹¿å‘Šå±•ç¤ºä½ç½®çš„å½±å“ã€‚</li><li>é€šè¿‡å…±äº«ç½‘ç»œå‚æ•°ï¼Œæé«˜æ¨¡å‹å¯¹åå·®çš„é²æ£’æ€§ã€‚</li></ul></li><li><p><strong>å› å­åˆ†è§£æœºï¼ˆFactorization Machinesï¼‰</strong>ï¼š</p><ul><li>ä½¿ç”¨å› å­åˆ†è§£æœºå»ºæ¨¡é«˜é˜¶äº¤äº’ç‰¹å¾ï¼Œå¯ä»¥æ•æ‰å¹¿å‘Šä¸ä½ç½®ã€æ›å…‰ç­‰ç‰¹å¾çš„å¤æ‚å…³ç³»ã€‚</li><li>å› å­åˆ†è§£æœºèƒ½å¤ŸåŒæ—¶å¤„ç†ç¨€ç–æ•°æ®å’Œå¤šç§äº¤äº’ç‰¹å¾ã€‚</li></ul></li></ol><h2 id="å¤šæ ·æ€§é—®é¢˜"><a href="#å¤šæ ·æ€§é—®é¢˜" class="headerlink" title="å¤šæ ·æ€§é—®é¢˜"></a>å¤šæ ·æ€§é—®é¢˜</h2><ol><li><p><strong>åŸºäºè¦†ç›–çš„æ¨è</strong>ï¼š</p><ul><li>ç¡®ä¿æ¨èç»“æœè¦†ç›–ç”¨æˆ·çš„ä¸åŒå…´è¶£é¢†åŸŸã€‚</li><li>ä½¿ç”¨å¤šæ ·æ€§æŒ‡æ ‡ï¼ˆå¦‚Intra-List Diversityï¼‰æ¥è¯„ä¼°å’Œä¼˜åŒ–æ¨èç»“æœçš„å¤šæ ·æ€§ã€‚</li></ul></li><li><p><strong>åŸºäºæ¢æµ‹ä¸åˆ©ç”¨ï¼ˆExplore-Exploitï¼‰ç­–ç•¥</strong>ï¼š</p><ul><li>ä½¿ç”¨UCBï¼ˆUpper Confidence Boundï¼‰ç®—æ³•æˆ–Îµ-greedyç­–ç•¥åœ¨æ¢ç´¢æ–°å¹¿å‘Šå’Œåˆ©ç”¨å·²æœ‰ç”¨æˆ·åå¥½ä¹‹é—´è¿›è¡Œå¹³è¡¡ã€‚</li><li>è¿™ç§ç­–ç•¥èƒ½å¤Ÿåœ¨æ¨èçƒ­é—¨å¹¿å‘Šçš„åŒæ—¶ï¼Œä¸æ–­å°è¯•æ–°çš„å¹¿å‘Šä»¥æå‡å¤šæ ·æ€§ã€‚</li></ul></li><li><p><strong>åŸºäºåˆ†å±‚æ¨è</strong>ï¼š</p><ul><li>å°†å¹¿å‘ŠæŒ‰ç…§ä¸åŒç±»åˆ«æˆ–ä¸»é¢˜è¿›è¡Œåˆ†å±‚æ¨èï¼Œç¡®ä¿æ¯ä¸ªç±»åˆ«æˆ–ä¸»é¢˜çš„å¹¿å‘Šéƒ½æœ‰æœºä¼šè¢«æ¨èã€‚</li><li>ä¾‹å¦‚ï¼Œä¸ºç”¨æˆ·æ¨èä¸åŒç±»å‹çš„å¹¿å‘Šï¼ˆå¦‚æŠ€æœ¯ã€å¨±ä¹ã€è´­ç‰©ç­‰ï¼‰ä»¥å¢åŠ å¤šæ ·æ€§ã€‚</li></ul></li><li><p><strong>åŸºäºç”¨æˆ·åé¦ˆçš„åŠ¨æ€è°ƒæ•´</strong>ï¼š</p><ul><li>æ ¹æ®ç”¨æˆ·çš„å³æ—¶åé¦ˆåŠ¨æ€è°ƒæ•´æ¨èç»“æœï¼Œæé«˜æ¨èçš„å¤šæ ·æ€§å’Œæ–°é¢–æ€§ã€‚</li><li>é€šè¿‡å®æ—¶ç›‘æ§ç”¨æˆ·çš„ç‚¹å‡»å’Œæµè§ˆè¡Œä¸ºï¼Œä¸æ–­ä¼˜åŒ–æ¨èç­–ç•¥ã€‚</li></ul></li></ol><p>è¿™äº›æ–¹æ³•å’Œç­–ç•¥å¯ä»¥è¿›ä¸€æ­¥è§£å†³å†·å¯åŠ¨é—®é¢˜ã€æ•°æ®ç¨€ç–é—®é¢˜ã€é¢„ä¼°åå·®é—®é¢˜å’Œå¤šæ ·æ€§é—®é¢˜ï¼Œæå‡å¹¿å‘Šæ¨èç³»ç»Ÿçš„æ•´ä½“æ•ˆæœã€‚</p><h1 id="ä½•æ—¶åº”è¯¥ä½¿ç”¨å“ªç§æ¨èç®—æ³•"><a href="#ä½•æ—¶åº”è¯¥ä½¿ç”¨å“ªç§æ¨èç®—æ³•" class="headerlink" title="ä½•æ—¶åº”è¯¥ä½¿ç”¨å“ªç§æ¨èç®—æ³•"></a>ä½•æ—¶åº”è¯¥ä½¿ç”¨å“ªç§æ¨èç®—æ³•</h1><p>äº†è§£ä½•æ—¶åº”è¯¥ä½¿ç”¨å“ªç§æ¨èç®—æ³•æ˜¯ä¸€ä¸ªå…³é”®é—®é¢˜ï¼Œå› ä¸ºå®ƒç›´æ¥å½±å“åˆ°æ¨èç³»ç»Ÿçš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æŒ‡å¯¼æ–¹é’ˆï¼Œä»¥ç¡®å®šä½•æ—¶ä½¿ç”¨ç‰¹å®šçš„æ¨èç®—æ³•ï¼š</p><ol><li><strong>åŸºäºå†…å®¹çš„æ¨èç®—æ³•</strong>ï¼šé€‚ç”¨äºç”¨æˆ·çš„å…´è¶£ç›¸å¯¹ç¨³å®šï¼Œè€Œä¸”ç‰©å“çš„å±æ€§ä¿¡æ¯å®¹æ˜“è·å–çš„æƒ…å†µã€‚å½“ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯å’Œå–œå¥½æ˜ç¡®ä¸”ç¨³å®šæ—¶ï¼ŒåŸºäºå†…å®¹çš„æ¨èç®—æ³•å¯ä»¥ä¸ºç”¨æˆ·æä¾›ä¸ªæ€§åŒ–çš„æ¨èã€‚</li><li><strong>ååŒè¿‡æ»¤æ¨èç®—æ³•</strong>ï¼šé€‚ç”¨äºç”¨æˆ·çš„å…´è¶£éšæ—¶é—´å˜åŒ–ï¼Œä¸”ç‰©å“ä¹‹é—´çš„å…³ç³»è¾ƒä¸ºé‡è¦çš„æƒ…å†µã€‚å½“ç³»ç»Ÿå…·æœ‰å¤§é‡ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼Œä¸”ç”¨æˆ·ä¹‹é—´çš„ç›¸ä¼¼æ€§è¾ƒé«˜æ—¶ï¼ŒååŒè¿‡æ»¤ç®—æ³•å¯ä»¥æœ‰æ•ˆåœ°æ•æ‰ç”¨æˆ·çš„å…´è¶£åå¥½ï¼Œå¹¶ä¸ºç”¨æˆ·æ¨èä¸å…¶ç›¸ä¼¼çš„ç‰©å“ã€‚</li><li><strong>SVDï¼ˆå¥‡å¼‚å€¼åˆ†è§£ï¼‰æ¨èç®—æ³•</strong>ï¼šé€‚ç”¨äºæ•°æ®ç¨€ç–ã€éšå¼åé¦ˆè¾ƒå¤šçš„æƒ…å†µã€‚å½“ç³»ç»Ÿå…·æœ‰å¤§é‡ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼Œä½†æ˜¯è¿™äº›æ•°æ®å¾€å¾€æ˜¯ä¸å®Œæ•´çš„ã€ç¨€ç–çš„æ—¶ï¼ŒSVDç­‰çŸ©é˜µåˆ†è§£ç®—æ³•å¯ä»¥é€šè¿‡å¡«å……ç¼ºå¤±å€¼ï¼Œæé«˜æ¨èçš„å‡†ç¡®æ€§ã€‚</li><li><strong>ä½ç½®å½’ä¸€åŒ–å’Œæ›å…‰é¢‘ç‡æ§åˆ¶ç®—æ³•</strong>ï¼šé€‚ç”¨äºæ¨èåˆ—è¡¨ä¸­ä½ç½®åå·®å’Œæ›å…‰é¢‘ç‡åå·®è¾ƒå¤§çš„æƒ…å†µã€‚å½“æ¨èç³»ç»Ÿä¸­å­˜åœ¨ä½ç½®åå·®å’Œæ›å…‰é¢‘ç‡åå·®ï¼Œå¯¼è‡´éƒ¨åˆ†ç‰©å“è¿‡åº¦æ›å…‰ï¼Œè€Œå…¶ä»–ç‰©å“åˆ™å¾ˆå°‘è¢«æ›å…‰æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä½ç½®å½’ä¸€åŒ–å’Œæ›å…‰é¢‘ç‡æ§åˆ¶ç®—æ³•æ¥è°ƒæ•´æ¨èç»“æœï¼Œæé«˜æ¨èçš„å…¬å¹³æ€§å’Œå‡†ç¡®æ€§ã€‚</li></ol><h1 id="ç›¸å…³æ–‡ç« "><a href="#ç›¸å…³æ–‡ç« " class="headerlink" title="ç›¸å…³æ–‡ç« "></a>ç›¸å…³æ–‡ç« </h1><p><a href="https://blog.csdn.net/abcdefg90876/article/details/122974669">https://blog.csdn.net/abcdefg90876/article/details/122974669</a></p><p>ç³»åˆ—ï¼š<a href="https://mp.weixin.qq.com/s?__biz=MzAxMjM2MTY0OQ==&mid=2650474085&idx=1&sn=17460980cce45dbac2045d5a784adefc&chksm=83bcacbbb4cb25ad2e842df7af56b4dc5fab32b2f450e0295ca7c62a2434322483285e0cc689&scene=21#wechat_redirect">https://mp.weixin.qq.com/s?__biz=MzAxMjM2MTY0OQ==&amp;mid=2650474085&amp;idx=1&amp;sn=17460980cce45dbac2045d5a784adefc&amp;chksm=83bcacbbb4cb25ad2e842df7af56b4dc5fab32b2f450e0295ca7c62a2434322483285e0cc689&amp;scene=21#wechat_redirect</a></p>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>äº’è¸¢åŠŸèƒ½</title>
      <link href="/2024/06/04/Work-%E4%BA%92%E8%B8%A2%E5%8A%9F%E8%83%BD/"/>
      <url>/2024/06/04/Work-%E4%BA%92%E8%B8%A2%E5%8A%9F%E8%83%BD/</url>
      
        <content type="html"><![CDATA[<h1 id="åŠŸèƒ½æè¿°"><a href="#åŠŸèƒ½æè¿°" class="headerlink" title="åŠŸèƒ½æè¿°"></a>åŠŸèƒ½æè¿°</h1><p>äº’è¸¢åŠŸèƒ½æŒ‡çš„æ˜¯åŒä¸€ä¸ªè´¦å·ï¼Œåœ¨ä¸åŒçš„æµè§ˆå™¨ç™»å½•ä¹‹åï¼Œå…ˆç™»å½•çš„ä¼šè¢«åç™»å½•çš„è¸¢ä¸‹çº¿ã€‚</p><h1 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h1><p>æœ¬è´¨ä¸Šæ˜¯æ¯æ¬¡ç™»å½•ä¹‹åä¼šä¿å­˜åŒ…å«å½“å‰æ—¶é—´çš„redisçš„keyï¼Œä¸‹æ¬¡ç™»å½•è¿›æ¥ä¹‹åï¼Œé¦–å…ˆæ˜¯åˆ é™¤æ‰€æœ‰å‰ç¼€æ˜¯ç”¨æˆ·idçš„keyï¼Œå…¶æ¬¡æ˜¯ä»¥ç”¨æˆ·idå’Œå½“å‰æ—¶é—´è¿›è¡ŒåŠ å¯†å¾—åˆ°æœ€æ–°çš„keyï¼Œå¹¶å­˜å…¥redisä¸­ã€‚</p><p>æ¯æ¬¡è°ƒç”¨æ–¹æ³•ä¼šç»è¿‡æ‹¦æˆªå™¨ï¼Œæ‹¦æˆªå™¨ä¼šé€šè¿‡è§£å¯†è¯·æ±‚å¤´é‡Œçš„tokenå»åˆ¤æ–­redisæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™å±äºæ˜¯ä¸‹çº¿äº†ã€‚</p><p>åŒä¸€æµè§ˆå™¨å› ä¸ºä¼šæ›¿æ¢è¯·æ±‚å¤´ä¸­çš„tokenï¼Œæ•…åŒä¸€æµè§ˆå™¨å†æ¬¡ç™»å½•å¹¶ä¸ä¼šè¸¢ä¸‹çº¿ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Work </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>RPCç›¸å…³çŸ¥è¯†</title>
      <link href="/2024/06/03/Study-RPC/"/>
      <url>/2024/06/03/Study-RPC/</url>
      
        <content type="html"><![CDATA[<h3 id="RPCï¼ˆRemote-Procedure-Callï¼‰ç†è§£"><a href="#RPCï¼ˆRemote-Procedure-Callï¼‰ç†è§£" class="headerlink" title="RPCï¼ˆRemote Procedure Callï¼‰ç†è§£"></a>RPCï¼ˆRemote Procedure Callï¼‰ç†è§£</h3><p>RPCï¼ˆRemote Procedure Callï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰æ˜¯ä¸€ç§é€šè¿‡ç½‘ç»œä»è¿œç¨‹è®¡ç®—æœºç¨‹åºä¸Šæ‰§è¡Œå‡½æ•°æˆ–è¿‡ç¨‹çš„åè®®ã€‚å®ƒä½¿å¾—è°ƒç”¨è¿œç¨‹æœåŠ¡å°±åƒè°ƒç”¨æœ¬åœ°æœåŠ¡ä¸€æ ·ç®€å•ï¼Œè€Œä¸éœ€è¦å…³å¿ƒåº•å±‚ç½‘ç»œé€šä¿¡çš„ç»†èŠ‚ã€‚RPC çš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p><ol><li><strong>é€æ˜æ€§</strong>ï¼šè°ƒç”¨è€…ä¸éœ€è¦å…³å¿ƒè¢«è°ƒç”¨è€…çš„ä½ç½®ã€é€šè®¯ç»†èŠ‚ï¼Œè°ƒç”¨è¿œç¨‹æœåŠ¡å’Œè°ƒç”¨æœ¬åœ°æœåŠ¡å‡ ä¹ä¸€æ ·ã€‚</li><li><strong>æ•ˆç‡</strong>ï¼šç›¸å¯¹äºç›´æ¥çš„ç½‘ç»œé€šä¿¡ï¼Œå¦‚ Socket ç¼–ç¨‹ï¼ŒRPC æä¾›äº†æ›´é«˜çº§åˆ«çš„æŠ½è±¡ï¼Œä½¿å¼€å‘å˜å¾—æ›´åŠ å®¹æ˜“å’Œé«˜æ•ˆã€‚</li><li><strong>è¯­è¨€æ— å…³æ€§</strong>ï¼šå¾ˆå¤š RPC æ¡†æ¶ï¼ˆå¦‚ gRPCï¼‰æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼Œä½¿å¾—ä¸åŒè¯­è¨€ç¼–å†™çš„æœåŠ¡ä¹‹é—´å¯ä»¥äº’æ“ä½œã€‚</li></ol><h3 id="RPCçš„å·¥ä½œåŸç†"><a href="#RPCçš„å·¥ä½œåŸç†" class="headerlink" title="RPCçš„å·¥ä½œåŸç†"></a>RPCçš„å·¥ä½œåŸç†</h3><p>RPC çš„å·¥ä½œåŸç†ä¸»è¦æ¶‰åŠä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li><strong>å®¢æˆ·ç«¯è¯·æ±‚</strong>ï¼šå®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªè¿œç¨‹è°ƒç”¨è¯·æ±‚ã€‚</li><li><strong>åºåˆ—åŒ–</strong>ï¼šå°†è¯·æ±‚å‚æ•°åºåˆ—åŒ–ï¼ˆç¼–ç ï¼‰æˆèƒ½å¤Ÿé€šè¿‡ç½‘ç»œä¼ è¾“çš„æ ¼å¼ã€‚</li><li><strong>ç½‘ç»œä¼ è¾“</strong>ï¼šé€šè¿‡ç½‘ç»œå°†è¯·æ±‚å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚</li><li><strong>æœåŠ¡ç«¯å¤„ç†</strong>ï¼šæœåŠ¡å™¨æ¥æ”¶è¯·æ±‚å¹¶å°†è¯·æ±‚ååºåˆ—åŒ–ï¼ˆè§£ç ï¼‰ï¼Œç„¶åè°ƒç”¨ç›¸åº”çš„æœåŠ¡æˆ–æ–¹æ³•ã€‚</li><li><strong>ç»“æœè¿”å›</strong>ï¼šæœåŠ¡å™¨å°†æ‰§è¡Œç»“æœåºåˆ—åŒ–åï¼Œé€šè¿‡ç½‘ç»œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li><li><strong>å®¢æˆ·ç«¯å¤„ç†ç»“æœ</strong>ï¼šå®¢æˆ·ç«¯æ¥æ”¶åˆ°ç»“æœå¹¶ååºåˆ—åŒ–ï¼Œæœ€åå¾—åˆ°è°ƒç”¨ç»“æœã€‚</li></ol><h3 id="RPC-ä¼šç”¨åˆ°åå°„å—ï¼Ÿ"><a href="#RPC-ä¼šç”¨åˆ°åå°„å—ï¼Ÿ" class="headerlink" title="RPC ä¼šç”¨åˆ°åå°„å—ï¼Ÿ"></a>RPC ä¼šç”¨åˆ°åå°„å—ï¼Ÿ</h3><p>RPC æœ¬èº«å¹¶ä¸ä¾èµ–äºåå°„ï¼Œä½†åœ¨æŸäº›å®ç°ä¸­ä¼šä½¿ç”¨åå°„ã€‚åå°„æ˜¯ä¸€ç§åœ¨è¿è¡Œæ—¶åŠ¨æ€è·å–ç±»å‹ä¿¡æ¯æˆ–æ“ä½œå¯¹è±¡çš„èƒ½åŠ›ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½ä½¿ç”¨åå°„çš„åœºæ™¯ï¼š</p><ol><li><strong>åŠ¨æ€ä»£ç†</strong>ï¼šåœ¨æŸäº› RPC æ¡†æ¶ä¸­ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨åŠ¨æ€ä»£ç†ï¼ˆåŸºäºåå°„ï¼‰æ¥ç®€åŒ–è°ƒç”¨ã€‚ä¾‹å¦‚ï¼ŒJava çš„ RMIï¼ˆRemote Method Invocationï¼‰å’Œ gRPC çš„æŸäº›å®ç°éƒ½ä¼šä½¿ç”¨åå°„æ¥åŠ¨æ€ç”Ÿæˆä»£ç†å¯¹è±¡ã€‚</li><li><strong>åºåˆ—åŒ–å’Œååºåˆ—åŒ–</strong>ï¼šæŸäº›æ¡†æ¶åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä½¿ç”¨åå°„æ¥è‡ªåŠ¨æ˜ å°„å¯¹è±¡çš„å­—æ®µå’Œæ–¹æ³•ã€‚ä¾‹å¦‚ï¼ŒJava çš„åºåˆ—åŒ–æœºåˆ¶ä»¥åŠä¸€äº› JSON åºåˆ—åŒ–åº“ä¼šä½¿ç”¨åå°„æ¥å¤„ç†å¯¹è±¡çš„å­—æ®µã€‚</li><li><strong>æ–¹æ³•è°ƒç”¨</strong>ï¼šåœ¨æœåŠ¡ç«¯ï¼Œå½“æ¥æ”¶åˆ°ä¸€ä¸ªè°ƒç”¨è¯·æ±‚åï¼Œæ¡†æ¶å¯èƒ½ä¼šä½¿ç”¨åå°„æ¥è°ƒç”¨å®é™…çš„æ–¹æ³•ã€‚è¿™ç§æ–¹å¼èƒ½å¤Ÿè®©æœåŠ¡ç«¯å¤„ç†æ›´åŠ é€šç”¨ï¼Œè€Œä¸éœ€è¦ä¸ºæ¯ä¸€ä¸ªæœåŠ¡ç¼–å†™ç‰¹å®šçš„è°ƒç”¨é€»è¾‘ã€‚</li></ol><p>æ€»ç»“æ¥è¯´ï¼Œè™½ç„¶åå°„ä¸æ˜¯ RPC å¿…é¡»çš„ï¼Œä½†å®ƒåœ¨å¾ˆå¤š RPC æ¡†æ¶ä¸­æ‰®æ¼”äº†é‡è¦è§’è‰²ï¼Œä½¿å¾—æ¡†æ¶æ›´å…·çµæ´»æ€§å’ŒåŠ¨æ€æ€§ã€‚ä¸åŒçš„ RPC å®ç°å¯èƒ½ä¼šé‡‡ç”¨ä¸åŒçš„æ–¹å¼ï¼Œå…·ä½“æ˜¯å¦ä½¿ç”¨åå°„å–å†³äºæ¡†æ¶çš„è®¾è®¡å’Œå®ç°ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RPC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµ·é¶…ç§‘æŠ€ç¬”è¯•</title>
      <link href="/2024/06/03/%E9%9D%A2%E7%BB%8F-%E6%B5%B7%E9%B6%85%E7%A7%91%E6%8A%80%E7%AC%94%E8%AF%95/"/>
      <url>/2024/06/03/%E9%9D%A2%E7%BB%8F-%E6%B5%B7%E9%B6%85%E7%A7%91%E6%8A%80%E7%AC%94%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>è®°2024&#x2F;6&#x2F;3ç¬”è¯•</p><h1 id="ç¬”è¯•é¢˜"><a href="#ç¬”è¯•é¢˜" class="headerlink" title="ç¬”è¯•é¢˜"></a>ç¬”è¯•é¢˜</h1><ol><li>bootstrap.propertieså’Œapplication.propertiesçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</li></ol><blockquote><p><strong><code>bootstrap.properties</code></strong> å’Œ <strong><code>application.properties</code></strong> éƒ½æ˜¯ Spring Boot ä¸­ç”¨äºé…ç½®åº”ç”¨ç¨‹åºçš„æ–‡ä»¶ï¼Œä½†å®ƒä»¬æœ‰ä¸€äº›å…³é”®çš„åŒºåˆ«ï¼š</p><ul><li><strong>åŠ è½½æ—¶æœºä¸åŒ</strong>ï¼š</li><li><code>bootstrap.properties</code> åœ¨åº”ç”¨ç¨‹åºçš„å¼•å¯¼é˜¶æ®µåŠ è½½ï¼Œæ¯” <code>application.properties</code> å…ˆåŠ è½½ã€‚è¿™æ„å‘³ç€ <code>bootstrap.properties</code> ä¸­çš„é…ç½®å¯ä»¥è¦†ç›– <code>application.properties</code> ä¸­çš„é…ç½®ã€‚</li><li><code>application.properties</code> åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡åˆ›å»ºä¹‹å‰åŠ è½½ã€‚</li><li><strong>ç”¨é€”ä¸åŒ</strong>ï¼š</li><li><code>bootstrap.properties</code> é€šå¸¸ç”¨äºé…ç½®éœ€è¦åœ¨å¼•å¯¼é˜¶æ®µåŠ è½½çš„å±æ€§ï¼Œä¾‹å¦‚å¤–éƒ¨é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Spring Cloud Configï¼‰çš„è¿æ¥ä¿¡æ¯ã€‚</li><li><code>application.properties</code> ç”¨äºé…ç½®åº”ç”¨ç¨‹åºçš„å¤§éƒ¨åˆ†è®¾ç½®ã€‚</li></ul></blockquote><ol start="2"><li>nacosçš„é…ç½®æ˜¯å¦æ˜¯å®æ—¶ç”Ÿæ•ˆçš„</li></ol><blockquote><p>Nacos çš„é…ç½®æ˜¯æ”¯æŒå®æ—¶ç”Ÿæ•ˆçš„ã€‚Nacos é€šè¿‡ä»¥ä¸‹æœºåˆ¶å®ç°é…ç½®çš„å®æ—¶ç”Ÿæ•ˆï¼š</p><ul><li><strong>é•¿è½®è¯¢æœºåˆ¶</strong>ï¼šå®¢æˆ·ç«¯ä¼šä»¥é•¿è½®è¯¢çš„æ–¹å¼å‘ Nacos æœåŠ¡å™¨è¯·æ±‚é…ç½®å˜æ›´ã€‚å½“é…ç½®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒæœåŠ¡å™¨ä¼šç«‹å³è¿”å›å˜æ›´ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°å˜æ›´ä¿¡æ¯åå¯ä»¥ç«‹å³åº”ç”¨æ–°é…ç½®ã€‚</li><li><strong>åŠ¨æ€åˆ·æ–°</strong>ï¼šç»“åˆ Spring Cloud Alibaba Nacos é…ç½®ä¸­å¿ƒçš„ä½¿ç”¨ï¼Œå€ŸåŠ© Spring çš„ <code>@RefreshScope</code> æ³¨è§£ï¼Œå¯ä»¥åœ¨é…ç½®å˜æ›´æ—¶åŠ¨æ€åˆ·æ–° Spring Beanï¼Œä½¿å¾—æ–°é…ç½®å®æ—¶ç”Ÿæ•ˆã€‚</li></ul></blockquote><ol start="3"><li>springmvcçš„åŸç†å’Œæ‰§è¡Œæµç¨‹</li></ol><blockquote><p>Spring MVCï¼ˆModel-View-Controllerï¼‰çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><strong>æ¥æ”¶è¯·æ±‚</strong>ï¼šç”¨æˆ·é€šè¿‡æµè§ˆå™¨å‘é€è¯·æ±‚ï¼ŒServlet å®¹å™¨ï¼ˆå¦‚ Tomcatï¼‰æ¥æ”¶è¯·æ±‚ã€‚</li><li><strong>åˆ†å‘è¯·æ±‚</strong>ï¼šè¯·æ±‚ç”± Servlet å®¹å™¨è½¬å‘ç»™ DispatcherServletï¼ˆå‰ç«¯æ§åˆ¶å™¨ï¼‰ã€‚</li><li><strong>HandlerMapping</strong>ï¼šDispatcherServlet æ ¹æ®è¯·æ±‚ URL è°ƒç”¨ HandlerMapping æ¥æ‰¾åˆ°å¯¹åº”çš„å¤„ç†å™¨ï¼ˆControllerï¼‰ã€‚</li><li><strong>HandlerAdapter</strong>ï¼šDispatcherServlet è°ƒç”¨ HandlerAdapter ä»¥é€‚é…å¤„ç†å™¨çš„æ‰§è¡Œã€‚</li><li><strong>å¤„ç†è¯·æ±‚</strong>ï¼šå…·ä½“çš„å¤„ç†å™¨ï¼ˆControllerï¼‰æ‰§è¡Œé€»è¾‘å¤„ç†ï¼Œå¹¶è¿”å›ä¸€ä¸ª ModelAndView å¯¹è±¡ã€‚</li><li><strong>è§†å›¾è§£æ</strong>ï¼šDispatcherServlet ä½¿ç”¨ ViewResolver å°†é€»è¾‘è§†å›¾åè§£æä¸ºå…·ä½“çš„ Viewï¼ˆè§†å›¾ï¼‰ã€‚</li><li><strong>æ¸²æŸ“è§†å›¾</strong>ï¼šView æ¸²æŸ“æ¨¡å‹æ•°æ®å¹¶ç”Ÿæˆæœ€ç»ˆçš„ HTML å“åº”ã€‚</li><li><strong>è¿”å›å“åº”</strong>ï¼šDispatcherServlet å°†ç”Ÿæˆçš„ HTML å“åº”è¿”å›ç»™ Servlet å®¹å™¨ï¼Œæœ€ç»ˆå“åº”ç”¨æˆ·ã€‚</li></ol></blockquote><p><img src="/../assets/%E9%9D%A2%E7%BB%8F-%E6%B5%B7%E9%B6%85%E7%A7%91%E6%8A%80%E7%AC%94%E8%AF%95/image-20240603201412912.png" alt="image-20240603201412912"></p><ol start="4"><li>å¾®æœåŠ¡ä¸­æ˜¯å¦‚ä½•ä¼ é€’ç”¨æˆ·ä¿¡æ¯çš„</li></ol><blockquote><p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä¼ é€’ç”¨æˆ·ä¿¡æ¯çš„å¸¸è§æ–¹æ³•åŒ…æ‹¬ï¼š</p><ul><li><strong>JWTï¼ˆJSON Web Tokenï¼‰</strong>ï¼šå®¢æˆ·ç«¯åœ¨åˆæ¬¡è®¤è¯æˆåŠŸåè·å– JWTï¼Œå¹¶åœ¨æ¯æ¬¡è¯·æ±‚æ—¶å°†å…¶æ”¾åœ¨è¯·æ±‚å¤´ä¸­ä¼ é€’ç»™å¾®æœåŠ¡ã€‚å¾®æœåŠ¡é€šè¿‡è§£æ JWT éªŒè¯ç”¨æˆ·èº«ä»½ã€‚</li><li><strong>Session</strong>ï¼šä½¿ç”¨åˆ†å¸ƒå¼ Sessionï¼Œå°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åœ¨ Redis ç­‰ç¼“å­˜ä¸­ï¼Œå¾®æœåŠ¡é€šè¿‡ Session ID è·å–ç”¨æˆ·ä¿¡æ¯ã€‚</li><li><strong>API Gateway</strong>ï¼šåœ¨ API Gateway ä¸­å¤„ç†ç”¨æˆ·è®¤è¯ï¼Œå¹¶å°†ç”¨æˆ·ä¿¡æ¯é€šè¿‡è¯·æ±‚å¤´æˆ–ä¸Šä¸‹æ–‡ä¼ é€’ç»™åç«¯å¾®æœåŠ¡ã€‚</li><li><strong>OAuth2</strong>ï¼šä½¿ç”¨ OAuth2 æˆæƒæ¡†æ¶ï¼Œé€šè¿‡ Access Token ä¼ é€’ç”¨æˆ·ä¿¡æ¯ã€‚</li></ul></blockquote><ol start="5"><li>mybatisï¼špagehelperå’Œmybatisplusçš„åˆ†é¡µçš„åŸç†</li></ol><blockquote><ul><li><strong>PageHelper</strong>ï¼š</li><li>PageHelper æ˜¯ä¸€ä¸ª MyBatis çš„åˆ†é¡µæ’ä»¶ï¼Œé€šè¿‡æ‹¦æˆª SQL æ‰§è¡Œï¼Œåœ¨ SQL æ‰§è¡Œå‰å¢åŠ åˆ†é¡µè¯­å¥ï¼ˆå¦‚ LIMIT å­å¥ï¼‰ã€‚</li><li>ä½¿ç”¨æ–¹æ³•ï¼šåœ¨æŸ¥è¯¢æ–¹æ³•å‰è°ƒç”¨ <code>PageHelper.startPage(pageNum, pageSize)</code> æ¥è®¾ç½®åˆ†é¡µå‚æ•°ï¼Œç„¶åæ‰§è¡ŒæŸ¥è¯¢ã€‚</li><li><strong>MyBatis-Plus</strong>ï¼š</li><li>MyBatis-Plus æä¾›äº† <code>Page</code> å¯¹è±¡ï¼Œé€šè¿‡åˆ†é¡µæŸ¥è¯¢æ–¹æ³•å°†åˆ†é¡µå‚æ•°ï¼ˆå¦‚å½“å‰é¡µç å’Œæ¯é¡µå¤§å°ï¼‰ä¼ é€’ç»™ Mapperã€‚</li><li>ä½¿ç”¨æ–¹æ³•ï¼šåœ¨ Mapper æ–¹æ³•ä¸­ä½¿ç”¨ <code>IPage</code> å‚æ•°ï¼Œå¹¶åœ¨æ–¹æ³•ä¸­ä¼ é€’ <code>Page</code> å¯¹è±¡æ¥å®ç°åˆ†é¡µã€‚</li></ul></blockquote><ol start="6"><li>#{}  å’Œ  ${}çš„åŒºåˆ«</li></ol><blockquote><ul><li>**<code>#&#123;&#125;</code>**ï¼šå ä½ç¬¦æ–¹å¼ï¼Œä¼šä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥é˜²æ­¢ SQL æ³¨å…¥ã€‚ä½¿ç”¨ <code>#&#123;&#125;</code> æ—¶ï¼ŒMyBatis ä¼šåœ¨ SQL è¯­å¥ä¸­ç”Ÿæˆå ä½ç¬¦ <code>?</code>ï¼Œå¹¶åœ¨æ‰§è¡Œå‰å°†å‚æ•°å®‰å…¨åœ°è®¾ç½®åˆ° SQL è¯­å¥ä¸­ã€‚</li></ul> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE name = #&#123;name&#125;</span><br></pre></td></tr></table></figure><p> ç­‰æ•ˆäºï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> ?</span><br></pre></td></tr></table></figure><ul><li>**<code>$&#123;&#125;</code>**ï¼šæ‹¼æ¥æ–¹å¼ï¼Œä¼šç›´æ¥å°†å‚æ•°å€¼æ‹¼æ¥åˆ° SQL è¯­å¥ä¸­ï¼Œä¸ä¼šé˜²æ­¢ SQL æ³¨å…¥é£é™©ã€‚ä½¿ç”¨ <code>$&#123;&#125;</code> æ—¶ï¼ŒMyBatis ä¼šå°†å‚æ•°çš„å€¼ç›´æ¥æ‹¼æ¥åˆ° SQL è¯­å¥ä¸­ã€‚</li></ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> $&#123;name&#125;</span><br></pre></td></tr></table></figure><p> å¦‚æœ <code>name</code> çš„å€¼æ˜¯ â€œJohnâ€ï¼Œåˆ™ç­‰æ•ˆäºï¼š</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;John&#x27;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>$&#123;&#125;</code> æ—¶è¦ç‰¹åˆ«å°å¿ƒï¼Œé¿å… SQL æ³¨å…¥æ”»å‡»ã€‚é€šå¸¸å»ºè®®ä½¿ç”¨ <code>#&#123;&#125;</code> æ¥ä¿è¯ SQL å®‰å…¨æ€§ã€‚</p></blockquote><ol start="7"><li><p>ä¸€é“sql</p></li><li><p>ä¸€é“äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦</p></li><li><p>é¡¹ç›®ä¸­é‡åˆ°çš„æŒ‘æˆ˜å’Œå¦‚ä½•è§£å†³</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> é¢ç» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå¹¶å‘ç¼–ç¨‹</title>
      <link href="/2024/06/01/Study-Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
      <url>/2024/06/01/Study-Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æœ¬ç¯‡æ–‡ç« å­¦ä¹ è‡ªï¼š<a href="https://space.bilibili.com/2035553929/channel/collectiondetail?sid=196389&spm_id_from=333.788.0.0">https://space.bilibili.com/2035553929/channel/collectiondetail?sid=196389&amp;spm_id_from=333.788.0.0</a></p><h1 id="çº¿ç¨‹çŠ¶æ€"><a href="#çº¿ç¨‹çŠ¶æ€" class="headerlink" title="çº¿ç¨‹çŠ¶æ€"></a>çº¿ç¨‹çŠ¶æ€</h1><p><img src="/../assets/Study-Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/image-20240602170410365.png" alt="image-20240602170410365"></p><h1 id="sleepæ–¹æ³•å’Œyieldæ–¹æ³•"><a href="#sleepæ–¹æ³•å’Œyieldæ–¹æ³•" class="headerlink" title="sleepæ–¹æ³•å’Œyieldæ–¹æ³•"></a>sleepæ–¹æ³•å’Œyieldæ–¹æ³•</h1><p>å…±åŒç‚¹ï¼šéƒ½ä¼šä½¿å¾—å½“å‰çº¿ç¨‹é‡Šæ”¾cpuèµ„æºï¼Œè®©å…¶ä»–çº¿ç¨‹æ¥è¿è¡Œ</p><p>ä¸åŒç‚¹ï¼šè°ƒç”¨sleepæ–¹æ³•åï¼Œçº¿ç¨‹è¿›å…¥time_waitingçŠ¶æ€ï¼Œæ­¤æ—¶ä¸å»äº‰æŠ¢cpuï¼Œè€Œè°ƒç”¨yieldæ–¹æ³•è¿›å…¥readyçŠ¶æ€ï¼Œä¼šå»æŠ¢å cpu</p><h1 id="å†…å­˜å±éšœ"><a href="#å†…å­˜å±éšœ" class="headerlink" title="å†…å­˜å±éšœ"></a>å†…å­˜å±éšœ</h1><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>å†…å­˜å±éšœ:  æ˜¯ä¸€ç§ <strong>å±éšœæŒ‡ä»¤</strong>ï¼Œå®ƒä½¿å¾— CPU æˆ–ç¼–è¯‘å™¨ å¯¹ <strong>å±éšœæŒ‡ä»¤çš„å‰ å’Œå</strong> æ‰€å‘å‡ºçš„å†…å­˜æ“ä½œ æ‰§è¡Œä¸€ä¸ªæ’åºçš„çº¦æŸã€‚ ä¹Ÿå«å†…å­˜æ …æ  æˆ– æ …æ æŒ‡ä»¤</p><h2 id="å†…å­˜å±éšœçš„èƒ½åŠ›"><a href="#å†…å­˜å±éšœçš„èƒ½åŠ›" class="headerlink" title="å†…å­˜å±éšœçš„èƒ½åŠ›"></a>å†…å­˜å±éšœçš„èƒ½åŠ›</h2><ol><li>é˜»æ­¢å±éšœä¸¤è¾¹çš„æŒ‡ä»¤é‡æ’åº</li><li>å†™æ•°æ®çš„æ—¶å€™ åŠ äº†å±éšœçš„è¯ï¼Œå¼ºåˆ¶æŠŠå†™ç¼“å†²åŒºçš„æ•°æ®åˆ·å›åˆ°ä¸»å†…å­˜ä¸­</li><li>è¯»æ•°æ®çš„æ—¶å€™ åŠ äº†å±éšœçš„è¯ï¼Œè®©å·¥ä½œå†…å­˜&#x2F;CPUé«˜é€Ÿç¼“å­˜å½“ä¸­ç¼“å­˜çš„æ•°æ®å¤±æ•ˆï¼Œé‡æ–°åˆ°ä¸»å†…å­˜ä¸­è·å–æ–°çš„æ•°æ®</li></ol><h2 id="åŸºæœ¬åˆ†ç±»"><a href="#åŸºæœ¬åˆ†ç±»" class="headerlink" title="åŸºæœ¬åˆ†ç±»"></a>åŸºæœ¬åˆ†ç±»</h2><ol><li>è¯»å±éšœ: Load Barrier <mark><strong>åœ¨è¯»æŒ‡ä»¤ä¹‹å‰</strong></mark>æ’å…¥è¯»å±éšœï¼Œè®©å·¥ä½œå†…å­˜&#x2F;CPU é«˜é€Ÿç¼“å­˜å½“ä¸­ç¼“å­˜çš„æ•°æ®å¤±æ•ˆï¼Œé‡æ–°åˆ°ä¸»å†…å­˜ä¸­è·å–æ–°çš„æ•°æ®</li><li>å†™å±éšœ: Store Barrier : <mark><strong>åœ¨å†™æŒ‡ä»¤ä¹‹å</strong></mark>æ’å…¥å†™å±éšœï¼Œå¼ºåˆ¶æŠŠå†™ç¼“å†²åŒºçš„æ•°æ®åˆ·å›åˆ°ä¸»å†…å­˜ä¸­</li></ol><h2 id="é‡æ’åºå’Œå†…å­˜å±éšœ"><a href="#é‡æ’åºå’Œå†…å­˜å±éšœ" class="headerlink" title="é‡æ’åºå’Œå†…å­˜å±éšœ"></a>é‡æ’åºå’Œå†…å­˜å±éšœ</h2><ol><li><p>é‡æ’åºå¯èƒ½ä¼šç»™ç¨‹åºå¸¦æ¥é—®é¢˜ï¼Œå› æ­¤ï¼Œæœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›å‘Šè¯‰JVMï¼Œè¿™é‡Œä¸éœ€è¦æ’åº</p><p>JVM æœ¬èº«ä¸ºäº†ä¿è¯å¯è§æ€§:</p></li><li><p>å¯¹äºç¼–è¯‘å™¨çš„é‡æ’åºï¼ŒJMM ä¼šæ ¹æ®é‡æ’åºçš„è§„åˆ™ï¼Œç¦æ­¢ç‰¹å®šç±»å‹çš„ç¼–è¯‘å™¨é‡æ’åº</p></li><li><p>å¯¹äºå¤„ç†å™¨çš„é‡æ’åºï¼ŒJava ç¼–è¯‘å™¨åœ¨ç”ŸæˆæŒ‡ä»¤åºåˆ—çš„ é€‚å½“ä½ç½®ï¼Œ<strong>æ’å…¥å†…å­˜å±éšœæŒ‡ä»¤</strong>ï¼Œæ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨æ’åº</p></li></ol><h2 id="JMMçš„å†…å­˜å±éšœ"><a href="#JMMçš„å†…å­˜å±éšœ" class="headerlink" title="JMMçš„å†…å­˜å±éšœ"></a>JMMçš„å†…å­˜å±éšœ</h2><p><code>LoadLoad Barriers</code> : Loadl; LoadLoad; Load2+<br>            ç¦æ­¢é‡æ’åº:è®¿é—® Load2 çš„è¯»å–æ“ä½œä¸€å®š ä¸ä¼šé‡æ’åˆ° Lad1ä¹‹å‰<br>            ä¿è¯ Load2 åœ¨è¯»å–çš„æ—¶å€™ï¼Œè‡ªå·±ç¼“å­˜å†…åˆ°ç›¸åº”æ•°æ®å¤±æ•ˆï¼ŒLoad2 ä¼šå»ä¸»å†…å­˜ä¸­è·å–æœ€æ–°çš„æ•°æ®</p><p><code>LoadStore Barriers</code> :Load1; LoadStore; Store2+<br>            ç¦æ­¢é‡æ’åº:ä¸€å®šæ˜¯ Load1 è¯»å–æ•°æ®å®Œæˆåï¼Œæ‰èƒ½è®© Store2 åŠå…¶ä¹‹åçš„å†™å‡ºæ“ä½œçš„æ•°æ®ï¼Œè¢«å…¶å®ƒçº¿ç¨‹çœ‹åˆ°ã€‚</p><p><code>StoreStore Barriers</code> :Store1; StoreStore; Store2<br>            ç¦æ­¢é‡æ’åº:ä¸€å®šæ˜¯ Store1çš„æ•°æ®å†™å‡ºåˆ°ä¸»å†…å­˜å®Œæˆåï¼Œæ‰èƒ½è®©Store2åŠå…¶ä¹‹åçš„å†™å‡ºæ“ä½œçš„æ•°æ®ï¼Œè¢«å…¶å®ƒçº¿ç¨‹çœ‹åˆ°ã€‚<br>            ä¿è¯Store1 æŒ‡ä»¤å†™å‡ºå»çš„æ•°æ®ï¼Œä¼šå¼ºåˆ¶è¢«åˆ·æ–°å›ä¸»å†…å­˜ä¸­</p><p><code>StoreLoad Barriers</code> :Storel;StoreLoad; Load2<br>            ç¦æ­¢é‡æ’åº:ä¸€å®šæ˜¯ Store1çš„æ•°æ®å†™å‡ºåˆ°ä¸»å†…å­˜å®Œæˆåï¼Œæ‰èƒ½è®©Load2 æ¥è¯»å–æ•°æ®<br>            <mark><strong>åŒæ—¶ä¿è¯ï¼š</strong></mark> å¼ºåˆ¶æŠŠå†™ç¼“å†²åŒºçš„æ•°æ®åˆ·å›åˆ°ä¸»å†…å­˜ä¸­<br>                                    è®©å·¥ä½œå†…å­˜&#x2F;CPU é«˜é€Ÿç¼“å­˜å½“ä¸­ç¼“å­˜çš„æ•°æ®å¤±æ•ˆï¼Œé‡æ–°åˆ°ä¸»å†…å­˜ä¸­è·å–æ–°çš„æ•°æ®</p><h2 id="ä¸ºä»€ä¹ˆè¯´-StoreLoadBarriers-æ˜¯æœ€é‡çš„"><a href="#ä¸ºä»€ä¹ˆè¯´-StoreLoadBarriers-æ˜¯æœ€é‡çš„" class="headerlink" title="ä¸ºä»€ä¹ˆè¯´ StoreLoadBarriers æ˜¯æœ€é‡çš„?"></a>ä¸ºä»€ä¹ˆè¯´ StoreLoadBarriers æ˜¯æœ€é‡çš„?</h2><p>é‡: å°±æ˜¯è·Ÿå†…å­˜äº¤äº’æ¬¡æ•°å¤šï¼Œäº¤äº’å»¶è¿Ÿè¾ƒå¤§ã€æ¶ˆè€—èµ„æºè¾ƒå¤šã€‚</p><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><p>è¿™äº›å±éšœæŒ‡ä»¤å¹¶ä¸æ˜¯å¤„ç†å™¨çœŸå®çš„æ‰§è¡ŒæŒ‡ä»¤ï¼Œä»–ä»¬åªæ˜¯JMM å®šä¹‰å‡ºæ¥çš„è·¨å¹³å°çš„æŒ‡ä»¤ã€‚</p><p>å› ä¸ºä¸åŒç¡¬ä»¶å®ç°å†…å­˜å±éšœçš„æ–¹å¼å¹¶ä¸ç›¸åŒï¼ŒJMM ä¸ºäº†å±è”½è¿™ç§åº•å±‚ç¡¬ä»¶å¹³å°çš„ä¸åŒï¼ŒæŠ½è±¡å‡ºäº†è¿™äº›å†…å­˜å±éšœæŒ‡ä»¤ï¼Œåœ¨è¿è¡Œçš„æ—¶å€™ï¼Œç”±JVM æ¥ä¸ºä¸åŒçš„å¹³å°ç”Ÿæˆç›¸åº”çš„æœºå™¨ç ã€‚</p><p>è¿™äº›å†…å­˜å±éšœæŒ‡ä»¤ï¼Œåœ¨ä¸åŒçš„ç¡¬ä»¶å¹³å°ä¸Šï¼Œå¯èƒ½ä¼šåšä¸€äº›ä¼˜åŒ–ï¼Œä»è€Œåªæ”¯æŒéƒ¨åˆ†çš„JMMçš„å†…å­˜å±éšœæŒ‡ä»¤ã€‚</p><p>åœ¨x86 æœºå™¨ä¸Šï¼Œå°±åªæœ‰ StoreLoadBarricrs æ˜¯æœ‰æ•ˆçš„ï¼Œå…¶å®ƒçš„éƒ½ä¸æ”¯æŒï¼Œè¢«æ›¿æ¢æˆ nopï¼Œä¹Ÿå°±æ˜¯ç©ºæ“ä½œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¹¶å‘ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¬¢èšæ—¶ä»£é¢è¯•</title>
      <link href="/2024/05/30/%E9%9D%A2%E7%BB%8F-%E6%AC%A2%E8%81%9A%E6%97%B6%E4%BB%A3%E9%9D%A2%E8%AF%95/"/>
      <url>/2024/05/30/%E9%9D%A2%E7%BB%8F-%E6%AC%A2%E8%81%9A%E6%97%B6%E4%BB%A3%E9%9D%A2%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p>è®° 2024&#x2F;5&#x2F;30 æ¬¢èšæ—¶ä»£ç¬”è¯•ï¼Œå…«è‚¡ç››å®´</p><h1 id="å®ä¹ "><a href="#å®ä¹ " class="headerlink" title="å®ä¹ "></a>å®ä¹ </h1><ol><li>åŠ¨æ€æ•°æ®æºåˆ‡æ¢ï¼Œè®²è§£å…·ä½“æµç¨‹ï¼Œæ–°åŠ å…¥ä¸€ä¸ªçœå¦‚ä½•å…·ä½“å®ç°</li><li>äººå·¥å®¢æœMQTTå…·ä½“å¦‚ä½•å®ç°æµç¨‹</li><li>çº¿ç¨‹å®‰å…¨é—®é¢˜è§£å†³åœºæ™¯æ–¹æ¡ˆ</li></ol><h1 id="é¡¹ç›®"><a href="#é¡¹ç›®" class="headerlink" title="é¡¹ç›®"></a>é¡¹ç›®</h1><ol><li>rabbitmqå®ç°å»¶è¿Ÿé˜Ÿåˆ—ä¸‹å•å¼•å…¥åˆ°å…«è‚¡</li></ol><h1 id="å…«è‚¡"><a href="#å…«è‚¡" class="headerlink" title="å…«è‚¡"></a>å…«è‚¡</h1><ol><li><p>è®¡ç®—æœºç½‘ç»œï¼šè¾“å…¥ä¸€ä¸ªurlçš„æ•´ä¸ªæµç¨‹ï¼Œhttpsåšäº†ä»€ä¹ˆï¼Œtcpæ‹¥å¡æ§åˆ¶ï¼Œæµé‡æ§åˆ¶ï¼Œè¶…æ—¶é‡ä¼ ï¼Œå¯é ä¼ è¾“ï¼Œtcpå’ŒudpåŒºåˆ«ï¼Œå¯¹åº”çš„ä¸åŒåœºæ™¯ï¼Œåœ¨å¾®ä¿¡è§†é¢‘é€šè¯ä¸­tcpå’Œudpçš„åº”ç”¨æ˜¯ä»€ä¹ˆ</p></li><li><p>æ“ä½œç³»ç»Ÿï¼šè¿›ç¨‹ä¸çº¿ç¨‹åŒºåˆ«ï¼Œè™šæ‹Ÿå†…å­˜å’ŒçœŸå®ç‰©ç†å†…å­˜çš„æ˜ å°„ç­‰</p></li><li><p>jvmå†…å­˜ç»“æ„</p></li><li><p>å¹¶å‘ç¼–ç¨‹ï¼šå¤šçº¿ç¨‹ï¼Œçº¿ç¨‹æ± ï¼ŒAQSï¼Œæ‚²è§‚é”å’Œä¹è§‚é”</p></li><li><p>MySQLï¼šMySQLåº•å±‚æ•°æ®ç»“æ„ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨B+æ ‘ï¼Œè”åˆç´¢å¼•ï¼Œèšé›†ç´¢å¼•å’Œéèšé›†ç´¢å¼•ï¼Œå›è¡¨æŸ¥è¯¢ï¼Œexplainå…³é”®å­—ï¼Œç´¢å¼•ä¼˜åŒ–ï¼Œæ…¢æ¥å£å¦‚ä½•æ’æŸ¥ï¼Œçº¿ä¸Šæ’æŸ¥æ—¥å¿—æ–¹å¼</p></li><li><p>rabbitmqæ¶ˆæ¯çš„å¯é æ€§å¦‚ä½•å®ç°ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯æ¶ˆè´¹ä¸é‡å¤</p></li></ol><h1 id="ç›¸å…³è¡¥å……é—®ç­”"><a href="#ç›¸å…³è¡¥å……é—®ç­”" class="headerlink" title="ç›¸å…³è¡¥å……é—®ç­”"></a>ç›¸å…³è¡¥å……é—®ç­”</h1><h2 id="åœ¨å¾®ä¿¡è§†é¢‘é€šè¯ä¸­tcpå’Œudpçš„åº”ç”¨æ˜¯ä»€ä¹ˆ"><a href="#åœ¨å¾®ä¿¡è§†é¢‘é€šè¯ä¸­tcpå’Œudpçš„åº”ç”¨æ˜¯ä»€ä¹ˆ" class="headerlink" title="åœ¨å¾®ä¿¡è§†é¢‘é€šè¯ä¸­tcpå’Œudpçš„åº”ç”¨æ˜¯ä»€ä¹ˆ"></a>åœ¨å¾®ä¿¡è§†é¢‘é€šè¯ä¸­tcpå’Œudpçš„åº”ç”¨æ˜¯ä»€ä¹ˆ</h2><p>åœ¨è§†é¢‘èŠå¤©åº”ç”¨ä¸­ï¼ŒTCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰å’ŒUDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰éƒ½æœ‰å…¶ç‰¹å®šçš„åº”ç”¨åœºæ™¯ï¼ŒåŸºäºå®ƒä»¬å„è‡ªçš„ç‰¹ç‚¹ã€‚ä¸‹é¢æ˜¯è¿™ä¸¤ç§åè®®åœ¨è§†é¢‘èŠå¤©ä¸­çš„å…·ä½“åº”ç”¨åœºæ™¯ï¼š</p><h3 id="UDP-åœ¨è§†é¢‘èŠå¤©ä¸­çš„åº”ç”¨"><a href="#UDP-åœ¨è§†é¢‘èŠå¤©ä¸­çš„åº”ç”¨" class="headerlink" title="UDP åœ¨è§†é¢‘èŠå¤©ä¸­çš„åº”ç”¨"></a>UDP åœ¨è§†é¢‘èŠå¤©ä¸­çš„åº”ç”¨</h3><ol><li><strong>è§†é¢‘å’ŒéŸ³é¢‘æ•°æ®ä¼ è¾“</strong>ï¼š<ul><li><strong>å®æ—¶æ€§</strong>ï¼šè§†é¢‘èŠå¤©å¯¹å®æ—¶æ€§è¦æ±‚å¾ˆé«˜ï¼ŒUDPä¼ è¾“ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œä¹Ÿæ²¡æœ‰ç¡®è®¤æœºåˆ¶ï¼Œæ•°æ®åŒ…ä¸€æ—¦å‘é€å°±ä¸ä¼šè¢«é‡ä¼ ï¼Œè¿™æ ·å¯ä»¥é™ä½å»¶è¿Ÿã€‚</li><li><strong>å®¹é”™æ€§</strong>ï¼šè§†é¢‘å’ŒéŸ³é¢‘æµå¯¹äºå°‘é‡çš„æ•°æ®ä¸¢å¤±å…·æœ‰å®¹é”™æ€§ï¼Œå¶å°”ä¸¢å¤±å‡ ä¸ªæ•°æ®åŒ…ä¸ä¼šæ˜¾è‘—å½±å“ç”¨æˆ·ä½“éªŒã€‚</li><li><strong>æ•ˆç‡</strong>ï¼šUDPå¤´éƒ¨è¾ƒå°ï¼Œä¼ è¾“æ•ˆç‡é«˜ï¼Œé€‚åˆé¢‘ç¹ã€å¤§é‡çš„å°æ•°æ®åŒ…ä¼ è¾“ï¼Œå¦‚è§†é¢‘å¸§å’ŒéŸ³é¢‘æ ·æœ¬ã€‚</li></ul></li></ol><h3 id="TCP-åœ¨è§†é¢‘èŠå¤©ä¸­çš„åº”ç”¨"><a href="#TCP-åœ¨è§†é¢‘èŠå¤©ä¸­çš„åº”ç”¨" class="headerlink" title="TCP åœ¨è§†é¢‘èŠå¤©ä¸­çš„åº”ç”¨"></a>TCP åœ¨è§†é¢‘èŠå¤©ä¸­çš„åº”ç”¨</h3><ol><li><p><strong>ä¿¡ä»¤å’Œæ§åˆ¶ä¿¡æ¯</strong>ï¼š</p><ul><li><strong>å¯é æ€§</strong>ï¼šTCPæä¾›å¯é çš„æ•°æ®ä¼ è¾“ï¼Œé€šè¿‡ç¡®è®¤æœºåˆ¶å’Œé‡ä¼ ä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œé¡ºåºã€‚è¿™å¯¹äºè§†é¢‘èŠå¤©ä¸­çš„ä¿¡ä»¤ï¼ˆå¦‚å‘¼å«å»ºç«‹ã€æŒ‚æ–­ã€ä¼šè¯å‚æ•°åå•†ç­‰ï¼‰éå¸¸é‡è¦ï¼Œå› ä¸ºè¿™äº›ä¿¡æ¯å¿…é¡»å‡†ç¡®æ— è¯¯åœ°ä¼ è¾“ã€‚</li><li><strong>æœ‰åºæ€§</strong>ï¼šTCPç¡®ä¿æ•°æ®æŒ‰é¡ºåºåˆ°è¾¾ï¼Œå¯¹äºéœ€è¦é¡ºåºå¤„ç†çš„æ§åˆ¶ä¿¡æ¯éå¸¸å…³é”®ã€‚</li></ul></li><li><p><strong>åˆå§‹è¿æ¥å»ºç«‹</strong>ï¼š</p><ul><li><strong>æ¡æ‰‹è¿‡ç¨‹</strong>ï¼šåœ¨è§†é¢‘èŠå¤©å¼€å§‹æ—¶ï¼ŒTCPå¯ä»¥ç”¨äºå»ºç«‹å’Œåå•†è¿æ¥å‚æ•°ï¼Œä¾‹å¦‚é€šè¿‡HTTPæˆ–HTTPSåè®®æ¥è¿›è¡Œèº«ä»½éªŒè¯å’Œä¼ è¾“åŠ å¯†å¯†é’¥ç­‰ä¿¡æ¯ã€‚</li></ul></li></ol><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li><strong>UDP</strong> ä¸»è¦ç”¨äºä¼ è¾“å®æ—¶æ€§è¦æ±‚é«˜çš„è§†é¢‘å’ŒéŸ³é¢‘æ•°æ®ï¼Œå› ä¸ºå®ƒä¼ è¾“é€Ÿåº¦å¿«ã€å»¶è¿Ÿä½ï¼Œå¹¶ä¸”èƒ½å®¹å¿éƒ¨åˆ†æ•°æ®ä¸¢å¤±ã€‚</li><li><strong>TCP</strong> åˆ™ç”¨äºä¼ è¾“ä¿¡ä»¤å’Œæ§åˆ¶ä¿¡æ¯ï¼Œéœ€è¦å¯é æ€§å’Œæœ‰åºæ€§ä¿éšœçš„åœ°æ–¹ï¼Œç¡®ä¿è§†é¢‘èŠå¤©çš„æ§åˆ¶éƒ¨åˆ†èƒ½å¤Ÿå‡†ç¡®æ— è¯¯åœ°è¿›è¡Œã€‚</li></ul><p>è¿™ç§åˆ†å·¥åˆ©ç”¨äº†ä¸¤ç§åè®®å„è‡ªçš„ä¼˜åŠ¿ï¼Œä½¿å¾—è§†é¢‘èŠå¤©åº”ç”¨æ—¢èƒ½ä¿è¯å®æ—¶æ€§å’Œæµç•…åº¦ï¼Œåˆèƒ½ç¡®ä¿è¿æ¥å’Œæ§åˆ¶ä¿¡æ¯çš„å¯é ä¼ è¾“ã€‚</p><p>5&#x2F;31 å‡‰ç»äº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é¢ç» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®æƒé™</title>
      <link href="/2024/05/21/Work-%E6%95%B0%E6%8D%AE%E6%9D%83%E9%99%90/"/>
      <url>/2024/05/21/Work-%E6%95%B0%E6%8D%AE%E6%9D%83%E9%99%90/</url>
      
        <content type="html"><![CDATA[<h1 id="æ•°æ®æƒé™"><a href="#æ•°æ®æƒé™" class="headerlink" title="æ•°æ®æƒé™"></a>æ•°æ®æƒé™</h1><p>é¡¹ç›®å¯åŠ¨æ—¶å°†æ•°æ®æƒé™è¡¨åŠ å…¥redisä¸­ï¼Œå› ä¸ºå¾ˆå¤šæ¥å£éƒ½éœ€è¦è®¾ç½®æ•°æ®æƒé™ï¼Œæ•…æé«˜å“åº”æ€§èƒ½ã€‚</p><p>å¯¹äºæ¯ä¸ªæ–°è¿›æ¥çš„çº¿ç¨‹ï¼Œå¦‚æœä¸éœ€è¦æ•°æ®æƒé™çš„é…ç½®ï¼Œé‚£ä¹ˆå…ˆå¯¹å½“å‰çº¿ç¨‹è®¾ç½®ä¸éœ€è¦æ•°æ®æƒé™ï¼Œè¿™é‡Œåšçš„å¤„ç†æ˜¯åœ¨è¯¥çº¿ç¨‹è°ƒç”¨çš„é‚£ä¸ªæ¥å£çš„æ–¹æ³•é‡Œï¼Œåœ¨è¿™ä¸ªæ–¹æ³•<mark>è°ƒç”¨æ•°æ®åº“æ“ä½œå‰</mark>ï¼Œå…ˆåœ¨threadlocalä¸­åŠ å…¥ä¸€ä¸ªnotSqlPowerçš„æ ‡è¯†ã€‚</p><p>å½“è¿›è¡Œæ•°æ®åº“æ“ä½œçš„æ—¶å€™ï¼Œé…ç½®å¥½çš„mybatisæ‹¦æˆªå™¨æ‹¦æˆªåˆ°prepareæ–¹æ³•ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦æ˜¯selectæ–¹æ³•ï¼Œå¦‚æœä¸æ˜¯åˆ™æ”¾è¡Œï¼Œå¦‚æœæ˜¯æŸ¥è¯¢æ–¹æ³•ï¼Œåˆ™å†åˆ¤æ–­æ˜¯å¦æœ‰threadlocalä¸­çš„notSqlPoweræ ‡è¯†ï¼Œè‹¥å­˜åœ¨æ ‡è¯†åˆ™è¯æ˜æ— éœ€è¿›è¡Œæ•°æ®æƒé™ï¼Œè‹¥å­˜åœ¨åˆ™ç»§ç»­ã€‚è‹¥æ ¹æ®ç™»å½•åå­˜æ”¾çš„threadlocalä¸­çš„ç”¨æˆ·ä¿¡æ¯ï¼Œè‹¥æ˜¯è¶…çº§ç®¡ç†å‘˜åˆ™æ— éœ€æ•°æ®æƒé™ã€‚</p><p>ç”¨æˆ·åœ¨ç™»å½•å°†è¯¥ç”¨æˆ·çš„æƒé™ä¿¡æ¯å­˜å…¥redisä¸­ï¼Œå…¶å®å°±æ˜¯ç»´æŠ¤è¿™ä¸ªç”¨æˆ·æ‰€å±çš„å…¬å¸ä¿¡æ¯ï¼Œä»–çš„è§’è‰²å¯¹åº”çš„æƒé™ä¿¡æ¯ï¼Œéƒ½æ˜¯ç”¨ä¸€ä¸ªhashmapå»æ”¶é›†èµ·æ¥ï¼Œç„¶åå­˜å…¥åˆ°redisé‡Œæ–¹ä¾¿åç»­ä½¿ç”¨ã€‚</p><p>è·å–åˆ°åŸå§‹çš„sqlï¼ŒéšååŠ¨æ€æ‹¼æ¥ä¸Šå¯¹åº”çš„å…¬å¸ï¼Œå…¬è·¯**<mark>ï¼ˆå³ç®¡ç†é«˜é€Ÿæƒé™å’Œç®¡ç†å•ä½æƒé™ï¼‰</mark>**ç­‰ä¿¡æ¯åœ¨sqlçš„whereæ¡ä»¶åå’Œè¿æ¥æ¡ä»¶åé¢</p><p>å…·ä½“å®ç°ï¼š</p><p>redisçš„keyä¸ºâ€road_qr_data_tableâ€ï¼Œå­˜çš„æ˜¯ä¸‹é¢è¿™ä¸ªè¡¨çš„ä¿¡æ¯</p><p>sys_data_table</p><p>æŸ¥è¯¢ç”¨æˆ·å…·æœ‰çš„å…·ä½“æƒé™ç”¨ä¸‹é¢ä¸‰å¼ è¡¨ï¼š</p><p>sys_userroleï¼Œsys_data_typeï¼Œuser_data_type</p><p>ç”¨æˆ·è§’è‰²è¡¨ï¼ˆsys_userroleï¼‰ï¼šä¸»è¦æ˜¯ç®¡ç†ç”¨æˆ·å’Œè§’è‰²çš„å¯¹åº”å…³ç³»</p><p>æ•°æ®æƒé™ç»“æ„è¡¨ï¼ˆsys_data_typeï¼‰ï¼šç”¨äºå­˜å‚¨å­˜åœ¨å“ªäº›æ•°æ®æƒé™ï¼Œå³æ•°æ®æƒé™çš„ç±»å‹ï¼Œå½“å‰åªæœ‰é«˜é€Ÿå’Œå…¬å¸ä¸¤ç§ç±»å‹ï¼Œå³æœ‰æ•ˆçš„æ•°æ®åªæœ‰ä¸¤æ¡</p><p>ç”¨æˆ·æ•°æ®æƒé™è¡¨ï¼ˆuser_data_typeï¼‰ï¼šç”¨äºå­˜æ”¾æ¯æ¡æ•°æ®ä¸ºå‘˜å·¥idï¼Œè§’è‰²idï¼Œç±»å‹idï¼Œæ•°æ®id**<mark>ï¼ˆç‰¹æŒ‡å…¬å¸idæˆ–è€…æ˜¯é«˜é€Ÿidï¼‰</mark>**</p><p>é€šè¿‡è¿™ä¸‰å¼ è¡¨ï¼Œèƒ½å¾—å‡ºå½“å‰è¿™ä¸ªç”¨æˆ·æ‰€å…·æœ‰çš„å…¬å¸å’Œé«˜é€Ÿçš„ä¸€ä¸ªåˆ—è¡¨ï¼š</p><p>ä¸¾ä¾‹è¯´æ˜ï¼š</p><p>å…¬å¸-å…¬å¸id1</p><p>å…¬å¸-å…¬å¸id2</p><p>é«˜é€Ÿ-é«˜é€Ÿid1</p><p>é«˜é€Ÿ-é«˜é€Ÿid2</p><p>é«˜é€Ÿ-é«˜é€Ÿid3</p><p>ç±»ä¼¼äºä¸Šé¢çš„è¿™æ ·ä¸€ä¸ªåˆ—è¡¨</p><p>æŸ¥è¯¢åˆ°è¿™æ ·ä¸€ä¸ªåˆ—è¡¨ä¹‹åï¼Œå¯ä»¥è½¬æ¢ä¸ºMap&lt;String, List<String>&gt;è¿™æ ·çš„ç»“æ„ï¼Œç„¶åå­˜å…¥redisé‡Œï¼Œkeyä¸ºä¸€ä¸ªç»Ÿä¸€å‰ç¼€åŠ ä¸Šç”¨æˆ·idã€‚</p><p>å…·ä½“æµç¨‹æ˜¯è§£æå¾—åˆ°åŸå§‹çš„sqlï¼Œç„¶ååˆ¤æ–­æ˜¯å¦æœ‰åµŒå¥—çš„å­æŸ¥è¯¢</p><p>å¦‚æœæœ‰ï¼Œåˆ™å•ç‹¬å°†å­æŸ¥è¯¢æå–å‡ºæ¥è½¬æ¢ä¸ºSelectï¼Œå¹¶å°†ï¼Ÿï¼Ÿï¼Ÿ</p><p>æ ¹æ®æŸ¥åˆ°çš„hashmapçš„æ•°æ®åˆ†åˆ«å°†æ¡ä»¶æ‹¼æ¥åˆ°onå’Œwhereçš„æ¡ä»¶ä¸Šï¼Œæ„é€ æˆæ–°çš„sqlè¯­å¥å¹¶è¿”å›ã€‚</p><h1 id="åˆ†é¡µ"><a href="#åˆ†é¡µ" class="headerlink" title="åˆ†é¡µ"></a>åˆ†é¡µ</h1><p>åˆ†é¡µçš„é“ç†ä¹Ÿæ˜¯åŒç†ï¼Œéƒ½æ˜¯è‡ªå®šä¹‰ä¸€ä¸ªæ‹¦æˆªå™¨å»æ‹¦æˆªè¦æ‰§è¡Œçš„sqlï¼Œå¦‚æœæ˜¯selectå°±æ‹¦æˆªä¸‹æ¥ï¼Œæ ¹æ®è‡ªå®šä¹‰çš„æ³¨è§£åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ†é¡µï¼Œå¦‚æœéœ€è¦åˆ†é¡µåˆ™åŠ¨æ€æ‹¼æ¥sqlåˆ°åé¢</p><p>å…·ä½“æ˜¯åœ¨è¯·æ±‚çš„æ—¶å€™å°±å°†limitçš„ä¸¤ä¸ªå‚æ•°å°±å·²ç»ä¿å­˜åˆ°äº†threadlocalä¸­ï¼Œå¦‚æœæ²¡æœ‰åˆ™é»˜è®¤ä¸º1ï¼Œ10ï¼Œç„¶ååœ¨å°†è¿™ä¸¤ä¸ªå‚æ•°åŠ¨æ€æ‹¼æ¥åˆ°åŸå§‹sqlåé¢</p>]]></content>
      
      
      <categories>
          
          <category> Work </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®æƒé™ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼</title>
      <link href="/2024/05/14/Study-%E5%88%86%E5%B8%83%E5%BC%8F/"/>
      <url>/2024/05/14/Study-%E5%88%86%E5%B8%83%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h1><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><h2 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h2><p><a href="https://www.cnblogs.com/crazymakercircle/p/14504520.html">https://www.cnblogs.com/crazymakercircle/p/14504520.html</a></p><p><a href="https://chat.openai.com/share/171027a7-3621-4ded-bab1-895c7f2ac141">https://chat.openai.com/share/171027a7-3621-4ded-bab1-895c7f2ac141</a></p><h1 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h1><p><a href="https://juejin.cn/post/6844904041659498509#heading-3">https://juejin.cn/post/6844904041659498509#heading-3</a></p>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ƒç‰›äº‘ç¬”è¯•</title>
      <link href="/2024/05/06/%E9%9D%A2%E7%BB%8F-%E4%B8%83%E7%89%9B%E4%BA%91%E7%AC%94%E8%AF%95/"/>
      <url>/2024/05/06/%E9%9D%A2%E7%BB%8F-%E4%B8%83%E7%89%9B%E4%BA%91%E7%AC%94%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æœ¬æ¬¡è€ƒå¯Ÿçš„æé†’ä¸ºåé“å•é€‰é¢˜ï¼Œäº”é“ä¸å®šé¡¹é€‰æ‹©ï¼Œä¸‰é“ç¼–ç¨‹é¢˜ï¼Œä¸‰é“ç¼–ç¨‹é¢˜éš¾åº¦éƒ½ä¸é«˜ï¼Œä½†æ˜¯äºŒå‰æ ‘å¾ˆä¹…æ²¡åšäº†ä¸ä¼šäº†ï¼Œä¸”ç¬¬ä¸€é“ç¼–ç¨‹é¢˜å› ä¸ºä¸€ä¸ªå°ç»†èŠ‚æµªè´¹å¾ˆå¤šæ—¶é—´ã€‚</p><p>é€‰æ‹©é¢˜ä¸»è¦è€ƒæ•°æ®ç»“æ„ï¼Œå°¤å…¶æ˜¯æ ˆè€ƒçš„å¾ˆå¤šï¼Œ<mark>æ’åº</mark>ä¹Ÿè€ƒçš„å¾ˆå¤šï¼Œä¸”è€ƒçš„å¾ˆç»†ï¼Œå…¶æ¬¡æ˜¯æ“ä½œç³»ç»Ÿå’Œè®¡ç½‘ã€‚</p><h1 id="ç¼–ç¨‹é¢˜"><a href="#ç¼–ç¨‹é¢˜" class="headerlink" title="ç¼–ç¨‹é¢˜"></a>ç¼–ç¨‹é¢˜</h1><h2 id="ç¬¬ä¸€é¢˜"><a href="#ç¬¬ä¸€é¢˜" class="headerlink" title="ç¬¬ä¸€é¢˜"></a>ç¬¬ä¸€é¢˜</h2><p>çŸ©é˜µé¢˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ArrayList&lt;ArrayList&lt;Integer&gt;&gt; <span class="title function_">setZeroes</span><span class="params">(ArrayList&lt;ArrayList&lt;Integer&gt;&gt; matrix)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> matrix.size();</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> matrix.get(<span class="number">0</span>).size();</span><br><span class="line">    <span class="type">int</span>[][] res = <span class="keyword">new</span> <span class="title class_">int</span>[m][n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            res[i][j] = matrix.get(i).get(j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    HashSet&lt;Integer&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!set.contains(j) &amp;&amp; res[i][j] == <span class="number">0</span>) &#123;</span><br><span class="line">                change(res, i, j, m, n);</span><br><span class="line">                set.add(j);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ArrayList&lt;ArrayList&lt;Integer&gt;&gt; lists = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">        ArrayList&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            list.add(res[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">        lists.add(list);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> lists;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">change</span><span class="params">(<span class="type">int</span>[][] res, <span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span> m, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; m; k++) &#123;</span><br><span class="line">        res[k][j] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; n; k++) &#123;</span><br><span class="line">        res[i][k] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¬¬äºŒé¢˜"><a href="#ç¬¬äºŒé¢˜" class="headerlink" title="ç¬¬äºŒé¢˜"></a>ç¬¬äºŒé¢˜</h2><p>æŸ¥æ‰¾æœ€è¿‘çš„äºŒå‰æ ‘å…¬å…±ç¥–å…ˆï¼ŒåŠ›æ‰£åŸé¢˜ï¼Œå¿˜äº†æ€ä¹ˆåšã€‚ã€‚ã€‚ã€‚ã€‚</p><h2 id="ç¬¬ä¸‰é¢˜"><a href="#ç¬¬ä¸‰é¢˜" class="headerlink" title="ç¬¬ä¸‰é¢˜"></a>ç¬¬ä¸‰é¢˜</h2><p>æ‰“å®¶åŠ«èˆâ…¡ï¼ŒåŠ›æ‰£åŸé¢˜ï¼Œä½†æ˜¯æˆ‘é€šè¿‡ç”¨ä¾‹åªæœ‰80%</p><p>æˆ‘çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxWine</span><span class="params">(<span class="type">int</span>[] weights)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (weights == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (weights.length == <span class="number">1</span>) <span class="keyword">return</span> weights[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (weights.length == <span class="number">2</span>) <span class="keyword">return</span> Math.max(weights[<span class="number">0</span>], weights[<span class="number">1</span>]);</span><br><span class="line">        <span class="type">int</span>[] dp1 = <span class="keyword">new</span> <span class="title class_">int</span>[weights.length - <span class="number">1</span>];</span><br><span class="line">        dp1[<span class="number">0</span>] = weights[<span class="number">0</span>];</span><br><span class="line">        dp1[<span class="number">1</span>] = Math.max(weights[<span class="number">0</span>], weights[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt; dp1.length; i++) &#123;</span><br><span class="line">            dp1[i] = Math.max(dp1[i - <span class="number">2</span>] + weights[i], dp1[i - <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] dp2 = <span class="keyword">new</span> <span class="title class_">int</span>[weights.length];</span><br><span class="line">        dp2[<span class="number">1</span>] = weights[<span class="number">1</span>];</span><br><span class="line">        dp2[<span class="number">2</span>] = Math.max(weights[<span class="number">1</span>], weights[<span class="number">2</span>]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">3</span>; i &lt; dp2.length; i++) &#123;</span><br><span class="line">            dp2[i] = Math.max(dp2[i - <span class="number">2</span>] + weights[i], dp2[i - <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Math.max(dp1[dp1.length - <span class="number">1</span>], dp2[dp2.length - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é¢ç» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RabbitMQå­¦ä¹ </title>
      <link href="/2024/05/05/Study-RabbitMQ%E5%AD%A6%E4%B9%A0/"/>
      <url>/2024/05/05/Study-RabbitMQ%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æœ¬ç¯‡æ–‡ç« å–è‡ªé»‘é©¬ç¨‹åºå‘˜ï¼š<a href="https://www.bilibili.com/video/BV1LQ4y127n4/?p=67&spm_id_from=333.1007.top_right_bar_window_history.content.click&vd_source=fa7ba4ae353f08f1d08d1bb24528e96c">https://www.bilibili.com/video/BV1LQ4y127n4/?p=67&amp;spm_id_from=333.1007.top_right_bar_window_history.content.click&amp;vd_source=fa7ba4ae353f08f1d08d1bb24528e96c</a></p><h1 id="1-åˆè¯†MQ"><a href="#1-åˆè¯†MQ" class="headerlink" title="1.åˆè¯†MQ"></a>1.åˆè¯†MQ</h1><h2 id="1-1-åŒæ­¥å’Œå¼‚æ­¥é€šè®¯"><a href="#1-1-åŒæ­¥å’Œå¼‚æ­¥é€šè®¯" class="headerlink" title="1.1.åŒæ­¥å’Œå¼‚æ­¥é€šè®¯"></a>1.1.åŒæ­¥å’Œå¼‚æ­¥é€šè®¯</h2><p>å¾®æœåŠ¡é—´é€šè®¯æœ‰åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ–¹å¼ï¼š</p><p>åŒæ­¥é€šè®¯ï¼šå°±åƒæ‰“ç”µè¯ï¼Œéœ€è¦å®æ—¶å“åº”ã€‚</p><p>å¼‚æ­¥é€šè®¯ï¼šå°±åƒå‘é‚®ä»¶ï¼Œä¸éœ€è¦é©¬ä¸Šå›å¤ã€‚</p><p><img src="/../assets/RabbitMQ%E5%AD%A6%E4%B9%A0/image-20210717161939695.png" alt="image-20210717161939695"></p><p>ä¸¤ç§æ–¹å¼å„æœ‰ä¼˜åŠ£ï¼Œæ‰“ç”µè¯å¯ä»¥ç«‹å³å¾—åˆ°å“åº”ï¼Œä½†æ˜¯ä½ å´ä¸èƒ½è·Ÿå¤šä¸ªäººåŒæ—¶é€šè¯ã€‚å‘é€é‚®ä»¶å¯ä»¥åŒæ—¶ä¸å¤šä¸ªäººæ”¶å‘é‚®ä»¶ï¼Œä½†æ˜¯å¾€å¾€å“åº”ä¼šæœ‰å»¶è¿Ÿã€‚</p><h3 id="1-1-1-åŒæ­¥é€šè®¯"><a href="#1-1-1-åŒæ­¥é€šè®¯" class="headerlink" title="1.1.1.åŒæ­¥é€šè®¯"></a>1.1.1.åŒæ­¥é€šè®¯</h3><p>æˆ‘ä»¬ä¹‹å‰å­¦ä¹ çš„Feignè°ƒç”¨å°±å±äºåŒæ­¥æ–¹å¼ï¼Œè™½ç„¶è°ƒç”¨å¯ä»¥å®æ—¶å¾—åˆ°ç»“æœï¼Œä½†å­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š</p><p><img src="/../assets/RabbitMQ%E5%AD%A6%E4%B9%A0/image-20210717162004285.png" alt="image-20210717162004285"></p><p>æ€»ç»“ï¼š</p><p>åŒæ­¥è°ƒç”¨çš„ä¼˜ç‚¹ï¼š</p><ul><li>æ—¶æ•ˆæ€§è¾ƒå¼ºï¼Œå¯ä»¥ç«‹å³å¾—åˆ°ç»“æœ</li></ul><p>åŒæ­¥è°ƒç”¨çš„é—®é¢˜ï¼š</p><ul><li>è€¦åˆåº¦é«˜</li><li>æ€§èƒ½å’Œååèƒ½åŠ›ä¸‹é™</li><li>æœ‰é¢å¤–çš„èµ„æºæ¶ˆè€—</li><li>æœ‰çº§è”å¤±è´¥é—®é¢˜</li></ul><h3 id="1-1-2-å¼‚æ­¥é€šè®¯"><a href="#1-1-2-å¼‚æ­¥é€šè®¯" class="headerlink" title="1.1.2.å¼‚æ­¥é€šè®¯"></a>1.1.2.å¼‚æ­¥é€šè®¯</h3><p>å¼‚æ­¥è°ƒç”¨åˆ™å¯ä»¥é¿å…ä¸Šè¿°é—®é¢˜ï¼š</p><p>æˆ‘ä»¬ä»¥è´­ä¹°å•†å“ä¸ºä¾‹ï¼Œç”¨æˆ·æ”¯ä»˜åéœ€è¦è°ƒç”¨è®¢å•æœåŠ¡å®Œæˆè®¢å•çŠ¶æ€ä¿®æ”¹ï¼Œè°ƒç”¨ç‰©æµæœåŠ¡ï¼Œä»ä»“åº“åˆ†é…å“åº”çš„åº“å­˜å¹¶å‡†å¤‡å‘è´§ã€‚</p><p>åœ¨äº‹ä»¶æ¨¡å¼ä¸­ï¼Œæ”¯ä»˜æœåŠ¡æ˜¯äº‹ä»¶å‘å¸ƒè€…ï¼ˆpublisherï¼‰ï¼Œåœ¨æ”¯ä»˜å®Œæˆååªéœ€è¦å‘å¸ƒä¸€ä¸ªæ”¯ä»˜æˆåŠŸçš„äº‹ä»¶ï¼ˆeventï¼‰ï¼Œäº‹ä»¶ä¸­å¸¦ä¸Šè®¢å•idã€‚</p><p>è®¢å•æœåŠ¡å’Œç‰©æµæœåŠ¡æ˜¯äº‹ä»¶è®¢é˜…è€…ï¼ˆConsumerï¼‰ï¼Œè®¢é˜…æ”¯ä»˜æˆåŠŸçš„äº‹ä»¶ï¼Œç›‘å¬åˆ°äº‹ä»¶åå®Œæˆè‡ªå·±ä¸šåŠ¡å³å¯ã€‚</p><p>ä¸ºäº†è§£é™¤äº‹ä»¶å‘å¸ƒè€…ä¸è®¢é˜…è€…ä¹‹é—´çš„è€¦åˆï¼Œä¸¤è€…å¹¶ä¸æ˜¯ç›´æ¥é€šä¿¡ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªä¸­é—´äººï¼ˆBrokerï¼‰ã€‚å‘å¸ƒè€…å‘å¸ƒäº‹ä»¶åˆ°Brokerï¼Œä¸å…³å¿ƒè°æ¥è®¢é˜…äº‹ä»¶ã€‚è®¢é˜…è€…ä»Brokerè®¢é˜…äº‹ä»¶ï¼Œä¸å…³å¿ƒè°å‘æ¥çš„æ¶ˆæ¯ã€‚</p><p><img src="/../assets/RabbitMQ%E5%AD%A6%E4%B9%A0/image-20210422095356088.png" alt="image-20210422095356088"></p><p>Broker æ˜¯ä¸€ä¸ªåƒæ•°æ®æ€»çº¿ä¸€æ ·çš„ä¸œè¥¿ï¼Œæ‰€æœ‰çš„æœåŠ¡è¦æ¥æ”¶æ•°æ®å’Œå‘é€æ•°æ®éƒ½å‘åˆ°è¿™ä¸ªæ€»çº¿ä¸Šï¼Œè¿™ä¸ªæ€»çº¿å°±åƒåè®®ä¸€æ ·ï¼Œè®©æœåŠ¡é—´çš„é€šè®¯å˜å¾—æ ‡å‡†å’Œå¯æ§ã€‚</p><p>å¥½å¤„ï¼š</p><ul><li><p>ååé‡æå‡ï¼šæ— éœ€ç­‰å¾…è®¢é˜…è€…å¤„ç†å®Œæˆï¼Œå“åº”æ›´å¿«é€Ÿ</p></li><li><p>æ•…éšœéš”ç¦»ï¼šæœåŠ¡æ²¡æœ‰ç›´æ¥è°ƒç”¨ï¼Œä¸å­˜åœ¨çº§è”å¤±è´¥é—®é¢˜</p></li><li><p>è°ƒç”¨é—´æ²¡æœ‰é˜»å¡ï¼Œä¸ä¼šé€ æˆæ— æ•ˆçš„èµ„æºå ç”¨</p></li><li><p>è€¦åˆåº¦æä½ï¼Œæ¯ä¸ªæœåŠ¡éƒ½å¯ä»¥çµæ´»æ’æ‹”ï¼Œå¯æ›¿æ¢</p></li><li><p>æµé‡å‰Šå³°ï¼šä¸ç®¡å‘å¸ƒäº‹ä»¶çš„æµé‡æ³¢åŠ¨å¤šå¤§ï¼Œéƒ½ç”±Brokeræ¥æ”¶ï¼Œè®¢é˜…è€…å¯ä»¥æŒ‰ç…§è‡ªå·±çš„é€Ÿåº¦å»å¤„ç†äº‹ä»¶</p></li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>æ¶æ„å¤æ‚äº†ï¼Œä¸šåŠ¡æ²¡æœ‰æ˜æ˜¾çš„æµç¨‹çº¿ï¼Œä¸å¥½ç®¡ç†</li><li>éœ€è¦ä¾èµ–äºBrokerçš„å¯é ã€å®‰å…¨ã€æ€§èƒ½</li></ul><p>å¥½åœ¨ç°åœ¨å¼€æºè½¯ä»¶æˆ–äº‘å¹³å°ä¸Š Broker çš„è½¯ä»¶æ˜¯éå¸¸æˆç†Ÿçš„ï¼Œæ¯”è¾ƒå¸¸è§çš„ä¸€ç§å°±æ˜¯æˆ‘ä»¬ä»Šå¤©è¦å­¦ä¹ çš„MQæŠ€æœ¯ã€‚</p><h2 id="1-2-æŠ€æœ¯å¯¹æ¯”ï¼š"><a href="#1-2-æŠ€æœ¯å¯¹æ¯”ï¼š" class="headerlink" title="1.2.æŠ€æœ¯å¯¹æ¯”ï¼š"></a>1.2.æŠ€æœ¯å¯¹æ¯”ï¼š</h2><p>MQï¼Œä¸­æ–‡æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessageQueueï¼‰ï¼Œå­—é¢æ¥çœ‹å°±æ˜¯å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—ã€‚ä¹Ÿå°±æ˜¯äº‹ä»¶é©±åŠ¨æ¶æ„ä¸­çš„Brokerã€‚</p><p>æ¯”è¾ƒå¸¸è§çš„MQå®ç°ï¼š</p><ul><li>ActiveMQ</li><li>RabbitMQ</li><li>RocketMQ</li><li>Kafka</li></ul><p>å‡ ç§å¸¸è§MQçš„å¯¹æ¯”ï¼š</p><table><thead><tr><th></th><th><strong>RabbitMQ</strong></th><th><strong>ActiveMQ</strong></th><th><strong>RocketMQ</strong></th><th><strong>Kafka</strong></th></tr></thead><tbody><tr><td>å…¬å¸&#x2F;ç¤¾åŒº</td><td>Rabbit</td><td>Apache</td><td>é˜¿é‡Œ</td><td>Apache</td></tr><tr><td>å¼€å‘è¯­è¨€</td><td>Erlang</td><td>Java</td><td>Java</td><td>Scala&amp;Java</td></tr><tr><td>åè®®æ”¯æŒ</td><td>AMQPï¼ŒXMPPï¼ŒSMTPï¼ŒSTOMP</td><td>OpenWire,STOMPï¼ŒREST,XMPP,AMQP</td><td>è‡ªå®šä¹‰åè®®</td><td>è‡ªå®šä¹‰åè®®</td></tr><tr><td>å¯ç”¨æ€§</td><td>é«˜</td><td>ä¸€èˆ¬</td><td>é«˜</td><td>é«˜</td></tr><tr><td>å•æœºååé‡</td><td>ä¸€èˆ¬</td><td>å·®</td><td>é«˜</td><td>éå¸¸é«˜</td></tr><tr><td>æ¶ˆæ¯å»¶è¿Ÿ</td><td>å¾®ç§’çº§</td><td>æ¯«ç§’çº§</td><td>æ¯«ç§’çº§</td><td>æ¯«ç§’ä»¥å†…</td></tr><tr><td>æ¶ˆæ¯å¯é æ€§</td><td>é«˜</td><td>ä¸€èˆ¬</td><td>é«˜</td><td>ä¸€èˆ¬</td></tr></tbody></table><p>è¿½æ±‚å¯ç”¨æ€§ï¼šKafkaã€ RocketMQ ã€RabbitMQ</p><p>è¿½æ±‚å¯é æ€§ï¼šRabbitMQã€RocketMQ</p><p>è¿½æ±‚ååèƒ½åŠ›ï¼šRocketMQã€Kafka</p><p>è¿½æ±‚æ¶ˆæ¯ä½å»¶è¿Ÿï¼šRabbitMQã€Kafka</p><h1 id="2-å¿«é€Ÿå…¥é—¨"><a href="#2-å¿«é€Ÿå…¥é—¨" class="headerlink" title="2.å¿«é€Ÿå…¥é—¨"></a>2.å¿«é€Ÿå…¥é—¨</h1><h2 id="2-1-å®‰è£…RabbitMQ"><a href="#2-1-å®‰è£…RabbitMQ" class="headerlink" title="2.1.å®‰è£…RabbitMQ"></a>2.1.å®‰è£…RabbitMQ</h2><p>MQçš„åŸºæœ¬ç»“æ„ï¼š</p><p><img src="/../assets/RabbitMQ%E5%AD%A6%E4%B9%A0/image-20210717162752376.png" alt="image-20210717162752376"></p><p>RabbitMQä¸­çš„ä¸€äº›è§’è‰²ï¼š</p><ul><li>publisherï¼šç”Ÿäº§è€…</li><li>consumerï¼šæ¶ˆè´¹è€…</li><li>exchangeä¸ªï¼šäº¤æ¢æœºï¼Œè´Ÿè´£æ¶ˆæ¯è·¯ç”±</li><li>queueï¼šé˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯</li><li>virtualHostï¼šè™šæ‹Ÿä¸»æœºï¼Œéš”ç¦»ä¸åŒç§Ÿæˆ·çš„exchangeã€queueã€æ¶ˆæ¯çš„éš”ç¦»</li></ul><h2 id="2-2-RabbitMQæ¶ˆæ¯æ¨¡å‹"><a href="#2-2-RabbitMQæ¶ˆæ¯æ¨¡å‹" class="headerlink" title="2.2.RabbitMQæ¶ˆæ¯æ¨¡å‹"></a>2.2.RabbitMQæ¶ˆæ¯æ¨¡å‹</h2><p>RabbitMQå®˜æ–¹æä¾›äº†5ä¸ªä¸åŒçš„Demoç¤ºä¾‹ï¼Œå¯¹åº”äº†ä¸åŒçš„æ¶ˆæ¯æ¨¡å‹ï¼š</p><p><img src="/../assets/RabbitMQ%E5%AD%A6%E4%B9%A0/image-20210717163332646.png" alt="image-20210717163332646"></p><h1 id="3-SpringAMQP"><a href="#3-SpringAMQP" class="headerlink" title="3.SpringAMQP"></a>3.SpringAMQP</h1><p>SpringAMQPæ˜¯åŸºäºRabbitMQå°è£…çš„ä¸€å¥—æ¨¡æ¿ï¼Œå¹¶ä¸”è¿˜åˆ©ç”¨SpringBootå¯¹å…¶å®ç°äº†è‡ªåŠ¨è£…é…ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚</p><p>SpringAmqpçš„å®˜æ–¹åœ°å€ï¼š<a href="https://spring.io/projects/spring-amqp">https://spring.io/projects/spring-amqp</a></p><p><img src="/../assets/RabbitMQ%E5%AD%A6%E4%B9%A0/image-20210717164024967.png" alt="image-20210717164024967"></p><p><img src="/../assets/RabbitMQ%E5%AD%A6%E4%B9%A0/image-20210717164038678.png" alt="image-20210717164038678"></p><p>SpringAMQPæä¾›äº†ä¸‰ä¸ªåŠŸèƒ½ï¼š</p><ul><li>è‡ªåŠ¨å£°æ˜é˜Ÿåˆ—ã€äº¤æ¢æœºåŠå…¶ç»‘å®šå…³ç³»</li><li>åŸºäºæ³¨è§£çš„ç›‘å¬å™¨æ¨¡å¼ï¼Œå¼‚æ­¥æ¥æ”¶æ¶ˆæ¯</li><li>å°è£…äº†RabbitTemplateå·¥å…·ï¼Œç”¨äºå‘é€æ¶ˆæ¯</li></ul><h2 id="3-1-Basic-Queue-ç®€å•é˜Ÿåˆ—æ¨¡å‹"><a href="#3-1-Basic-Queue-ç®€å•é˜Ÿåˆ—æ¨¡å‹" class="headerlink" title="3.1.Basic Queue ç®€å•é˜Ÿåˆ—æ¨¡å‹"></a>3.1.Basic Queue ç®€å•é˜Ÿåˆ—æ¨¡å‹</h2><p>åœ¨çˆ¶å·¥ç¨‹mq-demoä¸­å¼•å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--AMQPä¾èµ–ï¼ŒåŒ…å«RabbitMQ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-1-1-æ¶ˆæ¯å‘é€"><a href="#3-1-1-æ¶ˆæ¯å‘é€" class="headerlink" title="3.1.1.æ¶ˆæ¯å‘é€"></a>3.1.1.æ¶ˆæ¯å‘é€</h3><p>é¦–å…ˆé…ç½®MQåœ°å€ï¼Œåœ¨publisheræœåŠ¡çš„application.ymlä¸­æ·»åŠ é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span> <span class="comment"># ä¸»æœºå</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># ç«¯å£</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span> <span class="comment"># è™šæ‹Ÿä¸»æœº</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">itcast</span> <span class="comment"># ç”¨æˆ·å</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123321</span> <span class="comment"># å¯†ç </span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨publisheræœåŠ¡ä¸­ç¼–å†™æµ‹è¯•ç±»SpringAmqpTestï¼Œå¹¶åˆ©ç”¨RabbitTemplateå®ç°æ¶ˆæ¯å‘é€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.mq.spring;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringAmqpTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSimpleQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—åç§°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">        <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, spring amqp!&quot;</span>;</span><br><span class="line">        <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">        rabbitTemplate.convertAndSend(queueName, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-1-2-æ¶ˆæ¯æ¥æ”¶"><a href="#3-1-2-æ¶ˆæ¯æ¥æ”¶" class="headerlink" title="3.1.2.æ¶ˆæ¯æ¥æ”¶"></a>3.1.2.æ¶ˆæ¯æ¥æ”¶</h3><p>é¦–å…ˆé…ç½®MQåœ°å€ï¼Œåœ¨consumeræœåŠ¡çš„application.ymlä¸­æ·»åŠ é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span> <span class="comment"># ä¸»æœºå</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># ç«¯å£</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span> <span class="comment"># è™šæ‹Ÿä¸»æœº</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">itcast</span> <span class="comment"># ç”¨æˆ·å</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123321</span> <span class="comment"># å¯†ç </span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨consumeræœåŠ¡çš„<code>cn.itcast.mq.listener</code>åŒ…ä¸­æ–°å»ºä¸€ä¸ªç±»SpringRabbitListenerï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.mq.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringRabbitListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenSimpleQueueMessage</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;spring æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-1-3-æµ‹è¯•"><a href="#3-1-3-æµ‹è¯•" class="headerlink" title="3.1.3.æµ‹è¯•"></a>3.1.3.æµ‹è¯•</h3><p>å¯åŠ¨consumeræœåŠ¡ï¼Œç„¶ååœ¨publisheræœåŠ¡ä¸­è¿è¡Œæµ‹è¯•ä»£ç ï¼Œå‘é€MQæ¶ˆæ¯</p><h2 id="3-2-WorkQueue"><a href="#3-2-WorkQueue" class="headerlink" title="3.2.WorkQueue"></a>3.2.WorkQueue</h2><p>Work queuesï¼Œä¹Ÿè¢«ç§°ä¸ºï¼ˆTask queuesï¼‰ï¼Œä»»åŠ¡æ¨¡å‹ã€‚ç®€å•æ¥è¯´å°±æ˜¯<strong>è®©å¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå…±åŒæ¶ˆè´¹é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</strong>ã€‚</p><p><img src="/../assets/RabbitMQ%E5%AD%A6%E4%B9%A0/image-20210717164238910.png" alt="image-20210717164238910"></p><p>å½“æ¶ˆæ¯å¤„ç†æ¯”è¾ƒè€—æ—¶çš„æ—¶å€™ï¼Œå¯èƒ½ç”Ÿäº§æ¶ˆæ¯çš„é€Ÿåº¦ä¼šè¿œè¿œå¤§äºæ¶ˆæ¯çš„æ¶ˆè´¹é€Ÿåº¦ã€‚é•¿æ­¤ä»¥å¾€ï¼Œæ¶ˆæ¯å°±ä¼šå †ç§¯è¶Šæ¥è¶Šå¤šï¼Œæ— æ³•åŠæ—¶å¤„ç†ã€‚</p><p>æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨work æ¨¡å‹ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å…±åŒå¤„ç†æ¶ˆæ¯å¤„ç†ï¼Œé€Ÿåº¦å°±èƒ½å¤§å¤§æé«˜äº†ã€‚</p><h3 id="3-2-1-æ¶ˆæ¯å‘é€"><a href="#3-2-1-æ¶ˆæ¯å‘é€" class="headerlink" title="3.2.1.æ¶ˆæ¯å‘é€"></a>3.2.1.æ¶ˆæ¯å‘é€</h3><p>è¿™æ¬¡æˆ‘ä»¬å¾ªç¯å‘é€ï¼Œæ¨¡æ‹Ÿå¤§é‡æ¶ˆæ¯å †ç§¯ç°è±¡ã€‚</p><p>åœ¨publisheræœåŠ¡ä¸­çš„SpringAmqpTestç±»ä¸­æ·»åŠ ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * workQueue</span></span><br><span class="line"><span class="comment">     * å‘é˜Ÿåˆ—ä¸­ä¸åœå‘é€æ¶ˆæ¯ï¼Œæ¨¡æ‹Ÿæ¶ˆæ¯å †ç§¯ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWorkQueue</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, message_&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">        rabbitTemplate.convertAndSend(queueName, message + i);</span><br><span class="line">        Thread.sleep(<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-2-æ¶ˆæ¯æ¥æ”¶"><a href="#3-2-2-æ¶ˆæ¯æ¥æ”¶" class="headerlink" title="3.2.2.æ¶ˆæ¯æ¥æ”¶"></a>3.2.2.æ¶ˆæ¯æ¥æ”¶</h3><p>è¦æ¨¡æ‹Ÿå¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œæˆ‘ä»¬åœ¨consumeræœåŠ¡çš„SpringRabbitListenerä¸­æ·»åŠ 2ä¸ªæ–°çš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenWorkQueue1</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span> + LocalTime.now());</span><br><span class="line">    Thread.sleep(<span class="number">20</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenWorkQueue2</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.err.println(<span class="string">&quot;æ¶ˆè´¹è€…2........æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span> + LocalTime.now());</span><br><span class="line">    Thread.sleep(<span class="number">200</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°è¿™ä¸ªæ¶ˆè´¹è€…sleepäº†1000ç§’ï¼Œæ¨¡æ‹Ÿä»»åŠ¡è€—æ—¶ã€‚</p><h3 id="3-2-3-æµ‹è¯•"><a href="#3-2-3-æµ‹è¯•" class="headerlink" title="3.2.3.æµ‹è¯•"></a>3.2.3.æµ‹è¯•</h3><p>å¯åŠ¨ConsumerApplicationåï¼Œåœ¨æ‰§è¡ŒpublisheræœåŠ¡ä¸­åˆšåˆšç¼–å†™çš„å‘é€æµ‹è¯•æ–¹æ³•testWorkQueueã€‚</p><p>å¯ä»¥çœ‹åˆ°æ¶ˆè´¹è€…1å¾ˆå¿«å®Œæˆäº†è‡ªå·±çš„25æ¡æ¶ˆæ¯ã€‚æ¶ˆè´¹è€…2å´åœ¨ç¼“æ…¢çš„å¤„ç†è‡ªå·±çš„25æ¡æ¶ˆæ¯ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´æ¶ˆæ¯æ˜¯å¹³å‡åˆ†é…ç»™æ¯ä¸ªæ¶ˆè´¹è€…ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åˆ°æ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›ã€‚è¿™æ ·æ˜¾ç„¶æ˜¯æœ‰é—®é¢˜çš„ã€‚</p><h3 id="3-2-4-èƒ½è€…å¤šåŠ³"><a href="#3-2-4-èƒ½è€…å¤šåŠ³" class="headerlink" title="3.2.4.èƒ½è€…å¤šåŠ³"></a>3.2.4.èƒ½è€…å¤šåŠ³</h3><p>åœ¨springä¸­æœ‰ä¸€ä¸ªç®€å•çš„é…ç½®ï¼Œå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬ä¿®æ”¹consumeræœåŠ¡çš„application.ymlæ–‡ä»¶ï¼Œæ·»åŠ é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">prefetch:</span> <span class="number">1</span> <span class="comment"># æ¯æ¬¡åªèƒ½è·å–ä¸€æ¡æ¶ˆæ¯ï¼Œå¤„ç†å®Œæˆæ‰èƒ½è·å–ä¸‹ä¸€ä¸ªæ¶ˆæ¯</span></span><br></pre></td></tr></table></figure><h3 id="3-2-5-æ€»ç»“"><a href="#3-2-5-æ€»ç»“" class="headerlink" title="3.2.5.æ€»ç»“"></a>3.2.5.æ€»ç»“</h3><p>Workæ¨¡å‹çš„ä½¿ç”¨ï¼š</p><ul><li>å¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼ŒåŒä¸€æ¡æ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†</li><li>é€šè¿‡è®¾ç½®prefetchæ¥æ§åˆ¶æ¶ˆè´¹è€…é¢„å–çš„æ¶ˆæ¯æ•°é‡</li></ul><h2 id="3-3-å‘å¸ƒ-è®¢é˜…"><a href="#3-3-å‘å¸ƒ-è®¢é˜…" class="headerlink" title="3.3.å‘å¸ƒ&#x2F;è®¢é˜…"></a>3.3.å‘å¸ƒ&#x2F;è®¢é˜…</h2><p>å‘å¸ƒè®¢é˜…çš„æ¨¡å‹å¦‚å›¾ï¼š</p><p><img src="/../assets/RabbitMQ%E5%AD%A6%E4%B9%A0/image-20210717165309625.png" alt="image-20210717165309625"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è®¢é˜…æ¨¡å‹ä¸­ï¼Œå¤šäº†ä¸€ä¸ªexchangeè§’è‰²ï¼Œè€Œä¸”è¿‡ç¨‹ç•¥æœ‰å˜åŒ–ï¼š</p><ul><li>Publisherï¼šç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯è¦å‘é€æ¶ˆæ¯çš„ç¨‹åºï¼Œä½†æ˜¯ä¸å†å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯å‘ç»™Xï¼ˆäº¤æ¢æœºï¼‰</li><li>Exchangeï¼šäº¤æ¢æœºï¼Œå›¾ä¸­çš„Xã€‚ä¸€æ–¹é¢ï¼Œæ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ã€‚å¦ä¸€æ–¹é¢ï¼ŒçŸ¥é“å¦‚ä½•å¤„ç†æ¶ˆæ¯ï¼Œä¾‹å¦‚é€’äº¤ç»™æŸä¸ªç‰¹åˆ«é˜Ÿåˆ—ã€é€’äº¤ç»™æ‰€æœ‰é˜Ÿåˆ—ã€æˆ–æ˜¯å°†æ¶ˆæ¯ä¸¢å¼ƒã€‚åˆ°åº•å¦‚ä½•æ“ä½œï¼Œå–å†³äºExchangeçš„ç±»å‹ã€‚Exchangeæœ‰ä»¥ä¸‹3ç§ç±»å‹ï¼š<ul><li>Fanoutï¼šå¹¿æ’­ï¼Œå°†æ¶ˆæ¯äº¤ç»™æ‰€æœ‰ç»‘å®šåˆ°äº¤æ¢æœºçš„é˜Ÿåˆ—</li><li>Directï¼šå®šå‘ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆæŒ‡å®šrouting key çš„é˜Ÿåˆ—</li><li>Topicï¼šé€šé…ç¬¦ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆrouting patternï¼ˆè·¯ç”±æ¨¡å¼ï¼‰ çš„é˜Ÿåˆ—</li></ul></li><li>Consumerï¼šæ¶ˆè´¹è€…ï¼Œä¸ä»¥å‰ä¸€æ ·ï¼Œè®¢é˜…é˜Ÿåˆ—ï¼Œæ²¡æœ‰å˜åŒ–</li><li>Queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿä¸ä»¥å‰ä¸€æ ·ï¼Œæ¥æ”¶æ¶ˆæ¯ã€ç¼“å­˜æ¶ˆæ¯ã€‚</li></ul><p><strong>Exchangeï¼ˆäº¤æ¢æœºï¼‰åªè´Ÿè´£è½¬å‘æ¶ˆæ¯ï¼Œä¸å…·å¤‡å­˜å‚¨æ¶ˆæ¯çš„èƒ½åŠ›</strong>ï¼Œå› æ­¤å¦‚æœæ²¡æœ‰ä»»ä½•é˜Ÿåˆ—ä¸Exchangeç»‘å®šï¼Œæˆ–è€…æ²¡æœ‰ç¬¦åˆè·¯ç”±è§„åˆ™çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šä¸¢å¤±ï¼</p><h2 id="3-4-Fanout"><a href="#3-4-Fanout" class="headerlink" title="3.4.Fanout"></a>3.4.Fanout</h2><p>Fanoutï¼Œè‹±æ–‡ç¿»è¯‘æ˜¯æ‰‡å‡ºï¼Œæˆ‘è§‰å¾—åœ¨MQä¸­å«å¹¿æ’­æ›´åˆé€‚ã€‚</p><p><img src="/../assets/RabbitMQ%E5%AD%A6%E4%B9%A0/image-20210717165438225.png" alt="image-20210717165438225"></p><p>åœ¨å¹¿æ’­æ¨¡å¼ä¸‹ï¼Œæ¶ˆæ¯å‘é€æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>1ï¼‰  å¯ä»¥æœ‰å¤šä¸ªé˜Ÿåˆ—</li><li>2ï¼‰  æ¯ä¸ªé˜Ÿåˆ—éƒ½è¦ç»‘å®šåˆ°Exchangeï¼ˆäº¤æ¢æœºï¼‰</li><li>3ï¼‰  ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œåªèƒ½å‘é€åˆ°äº¤æ¢æœºï¼Œäº¤æ¢æœºæ¥å†³å®šè¦å‘ç»™å“ªä¸ªé˜Ÿåˆ—ï¼Œç”Ÿäº§è€…æ— æ³•å†³å®š</li><li>4ï¼‰  äº¤æ¢æœºæŠŠæ¶ˆæ¯å‘é€ç»™ç»‘å®šè¿‡çš„æ‰€æœ‰é˜Ÿåˆ—</li><li>5ï¼‰  è®¢é˜…é˜Ÿåˆ—çš„æ¶ˆè´¹è€…éƒ½èƒ½æ‹¿åˆ°æ¶ˆæ¯</li></ul><p>æˆ‘ä»¬çš„è®¡åˆ’æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ªäº¤æ¢æœº itcast.fanoutï¼Œç±»å‹æ˜¯Fanout</li><li>åˆ›å»ºä¸¤ä¸ªé˜Ÿåˆ—fanout.queue1å’Œfanout.queue2ï¼Œç»‘å®šåˆ°äº¤æ¢æœºitcast.fanout</li></ul><p><img src="/../assets/RabbitMQ%E5%AD%A6%E4%B9%A0/image-20210717165509466.png" alt="image-20210717165509466"></p><h3 id="3-4-1-å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº"><a href="#3-4-1-å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº" class="headerlink" title="3.4.1.å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº"></a>3.4.1.å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº</h3><p>Springæä¾›äº†ä¸€ä¸ªæ¥å£Exchangeï¼Œæ¥è¡¨ç¤ºæ‰€æœ‰ä¸åŒç±»å‹çš„äº¤æ¢æœºï¼š</p><p><img src="/../assets/RabbitMQ%E5%AD%A6%E4%B9%A0/image-20210717165552676.png" alt="image-20210717165552676"></p><p>åœ¨consumerä¸­åˆ›å»ºä¸€ä¸ªç±»ï¼Œå£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.mq.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Binding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.BindingBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.FanoutExchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FanoutConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Fanoutç±»å‹äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FanoutExchange <span class="title function_">fanoutExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FanoutExchange</span>(<span class="string">&quot;itcast.fanout&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¬¬1ä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">fanoutQueue1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;fanout.queue1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue1</span><span class="params">(Queue fanoutQueue1, FanoutExchange fanoutExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(fanoutQueue1).to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¬¬2ä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">fanoutQueue2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;fanout.queue2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue2</span><span class="params">(Queue fanoutQueue2, FanoutExchange fanoutExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(fanoutQueue2).to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-2-æ¶ˆæ¯å‘é€"><a href="#3-4-2-æ¶ˆæ¯å‘é€" class="headerlink" title="3.4.2.æ¶ˆæ¯å‘é€"></a>3.4.2.æ¶ˆæ¯å‘é€</h3><p>åœ¨publisheræœåŠ¡çš„SpringAmqpTestç±»ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFanoutExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;itcast.fanout&quot;</span>;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, everyone!&quot;</span>;</span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-3-æ¶ˆæ¯æ¥æ”¶"><a href="#3-4-3-æ¶ˆæ¯æ¥æ”¶" class="headerlink" title="3.4.3.æ¶ˆæ¯æ¥æ”¶"></a>3.4.3.æ¶ˆæ¯æ¥æ”¶</h3><p>åœ¨consumeræœåŠ¡çš„SpringRabbitListenerä¸­æ·»åŠ ä¸¤ä¸ªæ–¹æ³•ï¼Œä½œä¸ºæ¶ˆè´¹è€…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;fanout.queue1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenFanoutQueue1</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°Fanoutæ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;fanout.queue2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenFanoutQueue2</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…2æ¥æ”¶åˆ°Fanoutæ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-4-æ€»ç»“"><a href="#3-4-4-æ€»ç»“" class="headerlink" title="3.4.4.æ€»ç»“"></a>3.4.4.æ€»ç»“</h3><p>äº¤æ¢æœºçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>æ¥æ”¶publisherå‘é€çš„æ¶ˆæ¯</li><li>å°†æ¶ˆæ¯æŒ‰ç…§è§„åˆ™è·¯ç”±åˆ°ä¸ä¹‹ç»‘å®šçš„é˜Ÿåˆ—</li><li>ä¸èƒ½ç¼“å­˜æ¶ˆæ¯ï¼Œè·¯ç”±å¤±è´¥ï¼Œæ¶ˆæ¯ä¸¢å¤±</li><li>FanoutExchangeçš„ä¼šå°†æ¶ˆæ¯è·¯ç”±åˆ°æ¯ä¸ªç»‘å®šçš„é˜Ÿåˆ—</li></ul><p>å£°æ˜é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šå…³ç³»çš„Beanæ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>Queue</li><li>FanoutExchange</li><li>Binding</li></ul><h2 id="3-5-Direct"><a href="#3-5-Direct" class="headerlink" title="3.5.Direct"></a>3.5.Direct</h2><p>åœ¨Fanoutæ¨¡å¼ä¸­ï¼Œä¸€æ¡æ¶ˆæ¯ï¼Œä¼šè¢«æ‰€æœ‰è®¢é˜…çš„é˜Ÿåˆ—éƒ½æ¶ˆè´¹ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸åŒçš„æ¶ˆæ¯è¢«ä¸åŒçš„é˜Ÿåˆ—æ¶ˆè´¹ã€‚è¿™æ—¶å°±è¦ç”¨åˆ°Directç±»å‹çš„Exchangeã€‚</p><p><img src="/../assets/RabbitMQ%E5%AD%A6%E4%B9%A0/image-20210717170041447.png" alt="image-20210717170041447"></p><p> åœ¨Directæ¨¡å‹ä¸‹ï¼š</p><ul><li>é˜Ÿåˆ—ä¸äº¤æ¢æœºçš„ç»‘å®šï¼Œä¸èƒ½æ˜¯ä»»æ„ç»‘å®šäº†ï¼Œè€Œæ˜¯è¦æŒ‡å®šä¸€ä¸ª<code>RoutingKey</code>ï¼ˆè·¯ç”±keyï¼‰</li><li>æ¶ˆæ¯çš„å‘é€æ–¹åœ¨ å‘ Exchangeå‘é€æ¶ˆæ¯æ—¶ï¼Œä¹Ÿå¿…é¡»æŒ‡å®šæ¶ˆæ¯çš„ <code>RoutingKey</code>ã€‚</li><li>Exchangeä¸å†æŠŠæ¶ˆæ¯äº¤ç»™æ¯ä¸€ä¸ªç»‘å®šçš„é˜Ÿåˆ—ï¼Œè€Œæ˜¯æ ¹æ®æ¶ˆæ¯çš„<code>Routing Key</code>è¿›è¡Œåˆ¤æ–­ï¼Œåªæœ‰é˜Ÿåˆ—çš„<code>Routingkey</code>ä¸æ¶ˆæ¯çš„ <code>Routing key</code>å®Œå…¨ä¸€è‡´ï¼Œæ‰ä¼šæ¥æ”¶åˆ°æ¶ˆæ¯</li></ul><p><strong>æ¡ˆä¾‹éœ€æ±‚å¦‚ä¸‹</strong>ï¼š</p><ol><li><p>åˆ©ç”¨@RabbitListenerå£°æ˜Exchangeã€Queueã€RoutingKey</p></li><li><p>åœ¨consumeræœåŠ¡ä¸­ï¼Œç¼–å†™ä¸¤ä¸ªæ¶ˆè´¹è€…æ–¹æ³•ï¼Œåˆ†åˆ«ç›‘å¬direct.queue1å’Œdirect.queue2</p></li><li><p>åœ¨publisherä¸­ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼Œå‘itcast. directå‘é€æ¶ˆæ¯</p></li></ol><p><img src="/../assets/RabbitMQ%E5%AD%A6%E4%B9%A0/image-20210717170223317.png" alt="image-20210717170223317"></p><h3 id="3-5-1-åŸºäºæ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº"><a href="#3-5-1-åŸºäºæ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº" class="headerlink" title="3.5.1.åŸºäºæ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº"></a>3.5.1.åŸºäºæ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº</h3><p>åŸºäº@Beançš„æ–¹å¼å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºæ¯”è¾ƒéº»çƒ¦ï¼ŒSpringè¿˜æä¾›äº†åŸºäºæ³¨è§£æ–¹å¼æ¥å£°æ˜ã€‚</p><p>åœ¨consumerçš„SpringRabbitListenerä¸­æ·»åŠ ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼ŒåŒæ—¶åŸºäºæ³¨è§£æ¥å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;direct.queue1&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;itcast.direct&quot;, type = ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">    key = &#123;&quot;red&quot;, &quot;blue&quot;&#125;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue1</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…æ¥æ”¶åˆ°direct.queue1çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;direct.queue2&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;itcast.direct&quot;, type = ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">    key = &#123;&quot;red&quot;, &quot;yellow&quot;&#125;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue2</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…æ¥æ”¶åˆ°direct.queue2çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-5-2-æ¶ˆæ¯å‘é€"><a href="#3-5-2-æ¶ˆæ¯å‘é€" class="headerlink" title="3.5.2.æ¶ˆæ¯å‘é€"></a>3.5.2.æ¶ˆæ¯å‘é€</h3><p>åœ¨publisheræœåŠ¡çš„SpringAmqpTestç±»ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendDirectExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;itcast.direct&quot;</span>;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;çº¢è‰²è­¦æŠ¥ï¼æ—¥æœ¬ä¹±æ’æ ¸åºŸæ°´ï¼Œå¯¼è‡´æµ·æ´‹ç”Ÿç‰©å˜å¼‚ï¼ŒæƒŠç°å“¥æ–¯æ‹‰ï¼&quot;</span>;</span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;red&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-5-3-æ€»ç»“"><a href="#3-5-3-æ€»ç»“" class="headerlink" title="3.5.3.æ€»ç»“"></a>3.5.3.æ€»ç»“</h3><p>æè¿°ä¸‹Directäº¤æ¢æœºä¸Fanoutäº¤æ¢æœºçš„å·®å¼‚ï¼Ÿ</p><ul><li>Fanoutäº¤æ¢æœºå°†æ¶ˆæ¯è·¯ç”±ç»™æ¯ä¸€ä¸ªä¸ä¹‹ç»‘å®šçš„é˜Ÿåˆ—</li><li>Directäº¤æ¢æœºæ ¹æ®RoutingKeyåˆ¤æ–­è·¯ç”±ç»™å“ªä¸ªé˜Ÿåˆ—</li><li>å¦‚æœå¤šä¸ªé˜Ÿåˆ—å…·æœ‰ç›¸åŒçš„RoutingKeyï¼Œåˆ™ä¸FanoutåŠŸèƒ½ç±»ä¼¼</li></ul><p>åŸºäº@RabbitListeneræ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºæœ‰å“ªäº›å¸¸è§æ³¨è§£ï¼Ÿ</p><ul><li>@Queue</li><li>@Exchange</li></ul><h2 id="3-6-Topic"><a href="#3-6-Topic" class="headerlink" title="3.6.Topic"></a>3.6.Topic</h2><h3 id="3-6-1-è¯´æ˜"><a href="#3-6-1-è¯´æ˜" class="headerlink" title="3.6.1.è¯´æ˜"></a>3.6.1.è¯´æ˜</h3><p><code>Topic</code>ç±»å‹çš„<code>Exchange</code>ä¸<code>Direct</code>ç›¸æ¯”ï¼Œéƒ½æ˜¯å¯ä»¥æ ¹æ®<code>RoutingKey</code>æŠŠæ¶ˆæ¯è·¯ç”±åˆ°ä¸åŒçš„é˜Ÿåˆ—ã€‚åªä¸è¿‡<code>Topic</code>ç±»å‹<code>Exchange</code>å¯ä»¥è®©é˜Ÿåˆ—åœ¨ç»‘å®š<code>Routing key</code> çš„æ—¶å€™ä½¿ç”¨é€šé…ç¬¦ï¼</p><p><code>Routingkey</code> ä¸€èˆ¬éƒ½æ˜¯æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯ç»„æˆï¼Œå¤šä¸ªå•è¯ä¹‹é—´ä»¥â€.â€åˆ†å‰²ï¼Œä¾‹å¦‚ï¼š <code>item.insert</code></p><p> é€šé…ç¬¦è§„åˆ™ï¼š</p><p><code>#</code>ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¯</p><p><code>*</code>ï¼šåŒ¹é…ä¸å¤šä¸å°‘æ°å¥½1ä¸ªè¯</p><p>ä¸¾ä¾‹ï¼š</p><p><code>item.#</code>ï¼šèƒ½å¤ŸåŒ¹é…<code>item.spu.insert</code> æˆ–è€… <code>item.spu</code></p><p><code>item.*</code>ï¼šåªèƒ½åŒ¹é…<code>item.spu</code></p><p>â€‹     </p><p>å›¾ç¤ºï¼š</p><p> <img src="/../assets/RabbitMQ%E5%AD%A6%E4%B9%A0/image-20210717170705380.png" alt="image-20210717170705380"></p><p>è§£é‡Šï¼š</p><ul><li>Queue1ï¼šç»‘å®šçš„æ˜¯<code>china.#</code> ï¼Œå› æ­¤å‡¡æ˜¯ä»¥ <code>china.</code>å¼€å¤´çš„<code>routing key</code> éƒ½ä¼šè¢«åŒ¹é…åˆ°ã€‚åŒ…æ‹¬china.newså’Œchina.weather</li><li>Queue2ï¼šç»‘å®šçš„æ˜¯<code>#.news</code> ï¼Œå› æ­¤å‡¡æ˜¯ä»¥ <code>.news</code>ç»“å°¾çš„ <code>routing key</code> éƒ½ä¼šè¢«åŒ¹é…ã€‚åŒ…æ‹¬china.newså’Œjapan.news</li></ul><p>æ¡ˆä¾‹éœ€æ±‚ï¼š</p><p>å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p><ol><li><p>å¹¶åˆ©ç”¨@RabbitListenerå£°æ˜Exchangeã€Queueã€RoutingKey</p></li><li><p>åœ¨consumeræœåŠ¡ä¸­ï¼Œç¼–å†™ä¸¤ä¸ªæ¶ˆè´¹è€…æ–¹æ³•ï¼Œåˆ†åˆ«ç›‘å¬topic.queue1å’Œtopic.queue2</p></li><li><p>åœ¨publisherä¸­ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼Œå‘itcast. topicå‘é€æ¶ˆæ¯</p></li></ol><p><img src="/../assets/RabbitMQ%E5%AD%A6%E4%B9%A0/image-20210717170829229.png" alt="image-20210717170829229"></p><h3 id="3-6-2-æ¶ˆæ¯å‘é€"><a href="#3-6-2-æ¶ˆæ¯å‘é€" class="headerlink" title="3.6.2.æ¶ˆæ¯å‘é€"></a>3.6.2.æ¶ˆæ¯å‘é€</h3><p>åœ¨publisheræœåŠ¡çš„SpringAmqpTestç±»ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * topicExchange</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendTopicExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;itcast.topic&quot;</span>;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;å–œæŠ¥ï¼å­™æ‚Ÿç©ºå¤§æˆ˜å“¥æ–¯æ‹‰ï¼Œèƒœ!&quot;</span>;</span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;china.news&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-6-3-æ¶ˆæ¯æ¥æ”¶"><a href="#3-6-3-æ¶ˆæ¯æ¥æ”¶" class="headerlink" title="3.6.3.æ¶ˆæ¯æ¥æ”¶"></a>3.6.3.æ¶ˆæ¯æ¥æ”¶</h3><p>åœ¨consumeræœåŠ¡çš„SpringRabbitListenerä¸­æ·»åŠ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;topic.queue1&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;itcast.topic&quot;, type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">    key = &quot;china.#&quot;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue1</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…æ¥æ”¶åˆ°topic.queue1çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;topic.queue2&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;itcast.topic&quot;, type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">    key = &quot;#.news&quot;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue2</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…æ¥æ”¶åˆ°topic.queue2çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-6-4-æ€»ç»“"><a href="#3-6-4-æ€»ç»“" class="headerlink" title="3.6.4.æ€»ç»“"></a>3.6.4.æ€»ç»“</h3><p>æè¿°ä¸‹Directäº¤æ¢æœºä¸Topicäº¤æ¢æœºçš„å·®å¼‚ï¼Ÿ</p><ul><li>Topicäº¤æ¢æœºæ¥æ”¶çš„æ¶ˆæ¯RoutingKeyå¿…é¡»æ˜¯å¤šä¸ªå•è¯ï¼Œä»¥ <code>**.**</code> åˆ†å‰²</li><li>Topicäº¤æ¢æœºä¸é˜Ÿåˆ—ç»‘å®šæ—¶çš„bindingKeyå¯ä»¥æŒ‡å®šé€šé…ç¬¦</li><li><code>#</code>ï¼šä»£è¡¨0ä¸ªæˆ–å¤šä¸ªè¯</li><li><code>*</code>ï¼šä»£è¡¨1ä¸ªè¯</li></ul><h2 id="3-7-æ¶ˆæ¯è½¬æ¢å™¨"><a href="#3-7-æ¶ˆæ¯è½¬æ¢å™¨" class="headerlink" title="3.7.æ¶ˆæ¯è½¬æ¢å™¨"></a>3.7.æ¶ˆæ¯è½¬æ¢å™¨</h2><p>ä¹‹å‰è¯´è¿‡ï¼ŒSpringä¼šæŠŠä½ å‘é€çš„æ¶ˆæ¯åºåˆ—åŒ–ä¸ºå­—èŠ‚å‘é€ç»™MQï¼Œæ¥æ”¶æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¿˜ä¼šæŠŠå­—èŠ‚ååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡ã€‚</p><p><img src="/../assets/RabbitMQ%E5%AD%A6%E4%B9%A0/image-20200525170410401.png" alt="image-20200525170410401"></p><p>åªä¸è¿‡ï¼Œé»˜è®¤æƒ…å†µä¸‹Springé‡‡ç”¨çš„åºåˆ—åŒ–æ–¹å¼æ˜¯JDKåºåˆ—åŒ–ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒJDKåºåˆ—åŒ–å­˜åœ¨ä¸‹åˆ—é—®é¢˜ï¼š</p><ul><li>æ•°æ®ä½“ç§¯è¿‡å¤§</li><li>æœ‰å®‰å…¨æ¼æ´</li><li>å¯è¯»æ€§å·®</li></ul><p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ã€‚</p><h3 id="3-7-1-æµ‹è¯•é»˜è®¤è½¬æ¢å™¨"><a href="#3-7-1-æµ‹è¯•é»˜è®¤è½¬æ¢å™¨" class="headerlink" title="3.7.1.æµ‹è¯•é»˜è®¤è½¬æ¢å™¨"></a>3.7.1.æµ‹è¯•é»˜è®¤è½¬æ¢å™¨</h3><p>æˆ‘ä»¬ä¿®æ”¹æ¶ˆæ¯å‘é€çš„ä»£ç ï¼Œå‘é€ä¸€ä¸ªMapå¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendMap</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// å‡†å¤‡æ¶ˆæ¯</span></span><br><span class="line">    Map&lt;String,Object&gt; msg = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    msg.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Jack&quot;</span>);</span><br><span class="line">    msg.put(<span class="string">&quot;age&quot;</span>, <span class="number">21</span>);</span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;simple.queue&quot;</span>,<span class="string">&quot;&quot;</span>, msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœæ­¢consumeræœåŠ¡</p><p>å‘é€æ¶ˆæ¯åæŸ¥çœ‹æ§åˆ¶å°ï¼š</p><p><img src="/../assets/RabbitMQ%E5%AD%A6%E4%B9%A0/image-20210422232835363.png" alt="image-20210422232835363"></p><h3 id="3-7-2-é…ç½®JSONè½¬æ¢å™¨"><a href="#3-7-2-é…ç½®JSONè½¬æ¢å™¨" class="headerlink" title="3.7.2.é…ç½®JSONè½¬æ¢å™¨"></a>3.7.2.é…ç½®JSONè½¬æ¢å™¨</h3><p>æ˜¾ç„¶ï¼ŒJDKåºåˆ—åŒ–æ–¹å¼å¹¶ä¸åˆé€‚ã€‚æˆ‘ä»¬å¸Œæœ›æ¶ˆæ¯ä½“çš„ä½“ç§¯æ›´å°ã€å¯è¯»æ€§æ›´é«˜ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨JSONæ–¹å¼æ¥åšåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p><p>åœ¨publisherå’Œconsumerä¸¤ä¸ªæœåŠ¡ä¸­éƒ½å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®æ¶ˆæ¯è½¬æ¢å™¨ã€‚</p><p>åœ¨å¯åŠ¨ç±»ä¸­æ·»åŠ ä¸€ä¸ªBeanå³å¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MessageConverter <span class="title function_">jsonMessageConverter</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonMessageConverter</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Bç«™ç¬”è¯•</title>
      <link href="/2024/04/28/%E9%9D%A2%E7%BB%8F-B%E7%AB%99%E7%AC%94%E8%AF%95/"/>
      <url>/2024/04/28/%E9%9D%A2%E7%BB%8F-B%E7%AB%99%E7%AC%94%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æœ¬æ¬¡bç«™ç¬”è¯•ä¸æ­¢ä¸‹é¢çš„ä¸¤é“ç®—æ³•ï¼Œè¿˜æœ‰å‰é¢çš„é€‰æ‹©é¢˜ï¼Œè€ƒçš„æ“ä½œç³»ç»Ÿï¼ŒäºŒå‰æ ‘ï¼ŒJVMï¼Œè¿˜æœ‰å¹¶å‘è¿™å››ä¸ªè€ƒçš„å¾ˆæ·±ã€‚</p><p>é¢˜è§£å‚è€ƒè‡ªï¼š<a href="https://mp.weixin.qq.com/s?__biz=MzkyNTQ3NDAzNw==&mid=2247488721&idx=1&sn=dacebc056808f640b4d09de337e55d79&chksm=c1c7594bf6b0d05d7477561feb542e198d57f8aa901bbc160f6782a79a13ce6b2ab8a2c59fb3&scene=178&cur_album_id=2887532096360136706#rd">https://mp.weixin.qq.com/s?__biz=MzkyNTQ3NDAzNw==&amp;mid=2247488721&amp;idx=1&amp;sn=dacebc056808f640b4d09de337e55d79&amp;chksm=c1c7594bf6b0d05d7477561feb542e198d57f8aa901bbc160f6782a79a13ce6b2ab8a2c59fb3&amp;scene=178&amp;cur_album_id=2887532096360136706#rd</a></p><h1 id="ç¬¬ä¸€é¢˜"><a href="#ç¬¬ä¸€é¢˜" class="headerlink" title="ç¬¬ä¸€é¢˜"></a>ç¬¬ä¸€é¢˜</h1><h2 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>é’ç‰›å°å­¦ä¸€å¹´ä¸€åº¦çš„å…­ä¸€å„¿ç«¥èŠ‚å¼€å§‹äº†ã€‚ç°åœ¨ç‰›ç‰›ä»¬å›´æˆä¸€åœˆååœ¨è‰åœ°ä¸Šï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬æŠŠç‰›ç‰›ä»¬ç¼–å·ä¸ºç‰›1,ç‰›2,ç‰›3,ç‰›nã€‚</p><p>å…¶ä¸­ç‰›1ä¸ç‰›2ç›¸é‚»ï¼Œç‰›2ä¸ç‰›3ç›¸é‚»ï¼Œç‰›nå’Œç‰›1ç›¸é‚»ã€‚</p><p>ä¸ºäº†æ›´å¥½çš„å®‰æ’æ¥ä¸‹æ¥çš„æ´»åŠ¨ï¼Œç‰›è€å¸ˆå¾ˆå¥½å¥‡:ä»è¿™äº›ç‰›ä¸­é€‰å‡ºå‡ åªç›¸é‚»çš„ç‰›ï¼Œæ€»å…±æœ‰å¤šå°‘ç§ä¸åŒçš„æ–¹æ¡ˆï¼Ÿ</p><h2 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h2><p><strong>åŸºæœ¬æ€è·¯</strong>ï¼šè§‚å¯Ÿé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—ä»nå¤´ç‰›ä¸­é€‰å‡ºè‹¥å¹²å¤´ç›¸é‚»çš„ç‰›çš„æ–¹æ¡ˆæ•°ã€‚ç”±äºç‰›æ˜¯å›´æˆä¸€åœˆçš„ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä»ä»»æ„ä¸€å¤´ç‰›å¼€å§‹æ•°ã€‚</p><p><strong>åˆ†è§£é—®é¢˜</strong>ï¼š</p><ul><li><strong>ä¸ç‰¹æ®Šçš„æ–¹æ¡ˆ</strong>ï¼šé¦–å…ˆè€ƒè™‘æ‰€æœ‰çš„ç‰›éƒ½ä¸åŒæ—¶è¢«é€‰ä¸­çš„æƒ…å†µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä»»æ„ä¸€å¤´ç‰›ä½œä¸ºèµ·ç‚¹ï¼ˆæœ‰nç§é€‰æ‹©ï¼‰ï¼Œç„¶åé€‰æ‹©ä»è¿™å¤´ç‰›å¼€å§‹çš„ä»»æ„è¿ç»­æ•°é‡çš„ç‰›ï¼ˆ1åˆ°n-1ç§é€‰æ‹©ï¼Œå› ä¸ºå¦‚æœé€‰æ‹©äº†nå¤´ï¼Œé‚£å°±æ˜¯ç‰¹æ®Šæƒ…å†µäº†ï¼‰ã€‚å› æ­¤ï¼Œè¿™éƒ¨åˆ†çš„æ–¹æ¡ˆæ•°ä¸º (n *(n-1)ã€‚</li><li><strong>ç‰¹æ®Šæ–¹æ¡ˆ</strong>ï¼šæ‰€æœ‰çš„ç‰›éƒ½è¢«é€‰ä¸­çš„æƒ…å†µã€‚è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ¡ˆï¼Œå› ä¸ºä¸ç®¡ä»å“ªå¤´ç‰›å¼€å§‹æ•°ï¼Œé€‰å‡ºçš„éƒ½æ˜¯å…¨éƒ¨çš„ç‰›ã€‚è¿™ç§æƒ…å†µä¸‹åªæœ‰1ç§æ–¹æ¡ˆã€‚</li></ul><p><strong>æ€»ç»“æ–¹æ¡ˆæ•°</strong>ï¼šå°†ä¸Šè¿°ä¸¤ç§æƒ…å†µç›¸åŠ ï¼Œå¾—åˆ°çš„æ€»æ–¹æ¡ˆæ•°å°±æ˜¯ n*(n-1)+1ã€‚</p><h2 id="æ­£ç¡®ä»£ç "><a href="#æ­£ç¡®ä»£ç " class="headerlink" title="æ­£ç¡®ä»£ç "></a>æ­£ç¡®ä»£ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">~~~</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ç¬¬äºŒé¢˜</span><br><span class="line"></span><br><span class="line">## é¢˜ç›®æè¿°</span><br><span class="line"></span><br><span class="line">ç»™å‡ºä¸€ä¸ªé•¿åº¦ä¸ºnçš„å­—ç¬¦ä¸²så’Œä¸€ä¸ªæ•´æ•°kï¼Œç°åœ¨è¯·ä½ ä¾æ¬¡æŒ‰ç…§**i= <span class="number">1</span>,<span class="number">2</span>,.....n-k+<span class="number">1</span>**çš„é¡ºåºæ±‚å‡ºä»¥ä¸‹æ“ä½œå¾—åˆ°çš„å­—ç¬¦ä¸²å°†å­—ç¬¦ä¸²**s**çš„ç¬¬**i**ä¸ªå­—ç¬¦è‡³ç¬¬**i+k- <span class="number">1</span>**ä¹‹é—´çš„æ‰€æœ‰å­—ç¬¦ç¿»è½¬ã€‚ æ±‚å‡ºæœ€ç»ˆçŠ¶æ€çš„å­—ç¬¦ä¸²ã€‚ ä¾‹å¦‚:næ˜¯<span class="number">5</span>ï¼Œæ˜¯<span class="number">3</span>ï¼Œsæ˜¯<span class="string">&quot;hello&quot;</span>ã€‚ i=<span class="number">1</span>æ—¶ï¼Œç¿»è½¬[<span class="number">1</span>,<span class="number">3</span>]ä¹‹é—´çš„å­—ç¬¦,å¾—åˆ°<span class="string">&quot;lehlo&quot;</span> i=<span class="number">2</span>æ—¶ï¼Œç¿»è½¬ [<span class="number">2</span>,<span class="number">4</span>]ä¹‹é—´çš„å­—ç¬¦,å¾—åˆ°<span class="string">&quot;llheo&quot;</span> i=<span class="number">3</span>æ—¶ï¼Œç¿»è½¬ [<span class="number">3</span>,<span class="number">5</span>]ä¹‹é—´çš„å­—ç¬¦ï¼Œå¾—åˆ°<span class="string">&quot;lloeh&quot;</span> å› æ­¤ï¼Œæœ€ç»ˆçš„sä¸º<span class="string">&quot;lloeh&quot;</span>ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## è§£é¢˜æ€è·¯</span><br><span class="line"></span><br><span class="line">æˆ‘ä¸€å¼€å§‹å°±æ˜¯é€ä¸ªéå†çš„</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æˆ‘çš„é”™è¯¯å†™æ³•ã€‚ã€‚ã€‚ã€‚ã€‚ï¼ˆè¿™ä¹ˆéå†ä¼šè¶…æ—¶çš„.........ï¼‰</span><br><span class="line"></span><br><span class="line">~~~java</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> sc.nextInt();</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> sc.nextInt();</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> sc.next();</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> n - k + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= count; i++) &#123;</span><br><span class="line">            s = change(i, i + k - <span class="number">1</span>, s);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">change</span><span class="params">(<span class="type">int</span> left, <span class="type">int</span> right, String s)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">leftStr</span> <span class="operator">=</span> s.substring(<span class="number">0</span>, left - <span class="number">1</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">changeStr</span> <span class="operator">=</span> s.substring(left - <span class="number">1</span>, right);</span><br><span class="line">        <span class="type">String</span> <span class="variable">rightStr</span> <span class="operator">=</span> s.substring(right);</span><br><span class="line">        changeStr = change2(changeStr);</span><br><span class="line">        <span class="keyword">return</span> leftStr + changeStr + rightStr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">change2</span><span class="params">(String changeStr)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>, right = changeStr.length() - <span class="number">1</span>;</span><br><span class="line">        <span class="type">char</span>[] chars = changeStr.toCharArray();</span><br><span class="line">        <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> chars[left];</span><br><span class="line">            chars[left] = chars[right];</span><br><span class="line">            chars[right] = c;</span><br><span class="line">            left++;</span><br><span class="line">            right--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> String.valueOf(chars);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ­£ç¡®ä»£ç -1"><a href="#æ­£ç¡®ä»£ç -1" class="headerlink" title="æ­£ç¡®ä»£ç "></a>æ­£ç¡®ä»£ç </h2>]]></content>
      
      
      <categories>
          
          <category> é¢ç» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¾å›¢ç¬”è¯•</title>
      <link href="/2024/04/26/%E9%9D%A2%E7%BB%8F-%E7%BE%8E%E5%9B%A2%E7%AC%94%E8%AF%95/"/>
      <url>/2024/04/26/%E9%9D%A2%E7%BB%8F-%E7%BE%8E%E5%9B%A2%E7%AC%94%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¬¬ä¸€é¢˜"><a href="#ç¬¬ä¸€é¢˜" class="headerlink" title="ç¬¬ä¸€é¢˜"></a>ç¬¬ä¸€é¢˜</h1><h2 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>è¾“å…¥ä¸€ä¸ªæ•°nï¼Œè¦æ±‚æ„é€ ä¸€ä¸ªé•¿åº¦ä¸ºnçš„æ•°ç»„ï¼Œæ”¹æ•°ç»„éœ€è¦å®Œæˆä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ol><li>æ‰€æœ‰å…ƒç´ ä¸èƒ½å…¨éƒ¨ç›¸åŒ</li><li>æ‰€æœ‰å…ƒç´ ä¸èƒ½å…¨éƒ¨ä¸ç›¸åŒ</li></ol><blockquote><p>è¾“å…¥çš„næœ€å°éƒ½æ˜¯3</p></blockquote><h2 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h2><p>æ„é€ ä¸€ä¸ªæ•°ç»„ï¼Œå‰ä¸¤ä¸ªå…ƒç´ ä¸º1ï¼Œåé¢çš„æ‰€æœ‰å…ƒç´ éƒ½æ— 2å³å¯ã€‚</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">~~~</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ç¬¬äºŒé¢˜</span><br><span class="line"></span><br><span class="line">## é¢˜ç›®æè¿°</span><br><span class="line"></span><br><span class="line">è¾“å…¥ä¸€ä¸ªéé›¶çš„æ•°ï¼Œè‡³å°‘æ˜¯ä¸¤ä½æ•°ï¼Œè¦æ±‚å°†è¿™ä¸ªæ•°è¿›è¡Œæ‹†åˆ†ï¼Œæ‹†åˆ†å‡ºæ¥å¾—åˆ°çš„ä¸¤ä¸ªæ•°ç›¸åŠ ï¼Œè¿”å›ç›¸åŠ çš„æœ€å¤§å€¼ã€‚</span><br><span class="line"></span><br><span class="line">ç”¨ä¾‹ï¼š</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> è¾“å…¥<span class="number">10</span>ï¼Œæ‹†åˆ†å¾—åˆ°<span class="number">1</span>å’Œ<span class="number">0</span>ç›¸åŠ å¾—<span class="number">1</span>ï¼Œ<span class="number">1</span>æœ€å¤§åˆ™è¾“å‡º<span class="number">1</span>ï¼›</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> è¾“å…¥-<span class="number">918</span>ï¼Œæ‹†åˆ†å¾—åˆ°-<span class="number">9</span>å’Œ<span class="number">18</span>ï¼Œç›¸åŠ å¾—åˆ°<span class="number">9</span>æœ€å¤§ï¼Œè¾“å‡º<span class="number">9</span>ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## è§£é¢˜æ€è·¯</span><br><span class="line"></span><br><span class="line">å¯ä»¥åˆ†æ­£æ•°å’Œè´Ÿæ•°è¿›è¡Œè®¨è®ºï¼š</span><br><span class="line"></span><br><span class="line">å¦‚æœæ˜¯è´Ÿæ•°ï¼Œå–ç¬¬ä¸€ä½çš„æ•°ä¸è´Ÿå·ç›¸è¿èƒ½å¾—åˆ°æœ€å°çš„è´Ÿæ•°ï¼Œæ­¤æ—¶åŠ ä¸Šé™¤ç¬¬ä¸€ä½çš„åé¢çš„æ•°å³æ˜¯æœ€å¤§å€¼ï¼›</span><br><span class="line"></span><br><span class="line">å¦‚æœæ˜¯æ­£æ•°ï¼Œåˆ™æœ‰ä¸¤ç§æƒ…å†µï¼Œç¬¬ä¸€ç§æ˜¯å–ç¬¬ä¸€ä½çš„æ•°å’Œåé¢æ‰€æœ‰ä½çš„æ•°ç›¸åŠ ï¼Œç¬¬äºŒç§æ˜¯å–æœ€åä¸€ä½çš„æ•°å’Œå‰é¢çš„é™¤äº†æœ€åä¸€ä½çš„æ•°ç›¸åŠ ï¼Œä¸¤ä¸ªå€¼æ¯”è¾ƒå–æœ€å¤§å€¼å³å¯ã€‚</span><br><span class="line"></span><br><span class="line">&gt; åŸå› ï¼šä¸€ä¸ªæ•°ä½æ•°è¶Šå¤§ä»–å°±è¶Šå¤§ï¼Œè¿™é‡Œåè€Œä¸åº”è¯¥å–ä¸­é—´ä½æ¥éš”å¼€ç›¸åŠ ï¼Œä¾‹å¦‚<span class="number">1111199999</span>è¿™ä¸ªæ•°ï¼Œä»ä¸­é—´æ‹†å¼€å¾—åˆ°ä¸¤ä¸ªäº”ä½æ•°ç›¸åŠ æœ€å¤šåªèƒ½æ˜¯å…­ä½æ•°ï¼Œè€ŒæŒ‰ä¸Šé¢çš„æ–¹å¼å°±æ˜¯ä¹ä½æ•°äº†ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## ä»£ç </span><br><span class="line"></span><br><span class="line">~~~Java</span><br></pre></td></tr></table></figure><h1 id="ç¬¬ä¸‰é¢˜"><a href="#ç¬¬ä¸‰é¢˜" class="headerlink" title="ç¬¬ä¸‰é¢˜"></a>ç¬¬ä¸‰é¢˜</h1><h2 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>è¾“å…¥ä¸€ä¸ªçŸ©é˜µï¼Œå¯»æ‰¾ç”±ç›¸é‚»çš„å››ä¸ªå…ƒç´ ç»„æˆçš„æ­£æ–¹å½¢çš„å››ä¸ªæ•°ï¼Œè‹¥è¿™å››ä¸ªæ•°ç›¸ç­‰ï¼Œåˆ™countåŠ ä¸€ï¼Œæœ€åè¾“å‡ºcountã€‚</p><h2 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h2><p>ä¸¤å±‚éå†ï¼Œåˆ¤æ–­å½“å‰ä½ç½®çš„å³è¾¹ï¼Œä¸‹è¾¹å’Œå³ä¸‹è§’çš„æ•°æ˜¯å¦éƒ½å®Œå…¨ä¸€è‡´ï¼Œè®¡æ•°å³å¯ã€‚</p><h2 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h1 id="ç¬¬å››é¢˜"><a href="#ç¬¬å››é¢˜" class="headerlink" title="ç¬¬å››é¢˜"></a>ç¬¬å››é¢˜</h1><h2 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>è®°ä¸å¾—äº†ï¼Œæ˜¯æ ‘ï¼Œä½†æˆ‘ä¸ä¼šacmæ¨¡å¼ä¸‹åˆ›å»ºæ ‘</p><h1 id="ç¬¬äº”é¢˜"><a href="#ç¬¬äº”é¢˜" class="headerlink" title="ç¬¬äº”é¢˜"></a>ç¬¬äº”é¢˜</h1><h2 id="é¢˜ç›®æè¿°-3"><a href="#é¢˜ç›®æè¿°-3" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>å›¾ã€‚ã€‚ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é¢ç» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vueå­¦ä¹ </title>
      <link href="/2024/03/24/Study-Vue/"/>
      <url>/2024/03/24/Study-Vue/</url>
      
        <content type="html"><![CDATA[<p><img src="/../assets/Study-Vue/image-20240324220355647.png" alt="image-20240324220355647"></p>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ™ºå­¦è½©é¡¹ç›®æ€»ç»“</title>
      <link href="/2024/03/09/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/"/>
      <url>/2024/03/09/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»‹ç»é¡¹ç›®"><a href="#ä»‹ç»é¡¹ç›®" class="headerlink" title="ä»‹ç»é¡¹ç›®"></a>ä»‹ç»é¡¹ç›®</h1><p>æ™ºå­¦è½©åœ¨çº¿æ•™è‚²é¡¹ç›®æ˜¯ä¸€ä¸ªB2B2Cçš„åœ¨çº¿æ•™è‚²å¹³å°ï¼Œæœ¬é¡¹ç›®åŒ…æ‹¬äº†ç”¨æˆ·ç«¯ã€æœºæ„ç«¯ã€è¿è¥ç«¯ã€‚</p><p>æ ¸å¿ƒæ¨¡å—åŒ…æ‹¬ï¼šå†…å®¹ç®¡ç†ã€åª’èµ„ç®¡ç†ã€è¯¾ç¨‹æœç´¢ã€è®¢å•æ”¯ä»˜ã€é€‰è¯¾ç®¡ç†ã€è®¤è¯æˆæƒç­‰ã€‚</p><p>é¡¹ç›®é‡‡ç”¨å‰åç«¯åˆ†ç¦»çš„æŠ€æœ¯æ¶æ„ï¼Œä½¿ç”¨Spring CloudæŠ€æœ¯æ ˆæ„å»ºå¾®æœåŠ¡ï¼Œæ•°æ®åº“é‡‡ç”¨MySQLï¼Œè¿˜ä½¿ç”¨äº†Redisã€RabbitMQã€Elasticsearchç­‰æŠ€æœ¯ã€‚</p><h1 id="é¡¹ç›®æŠ€æœ¯æ¶æ„ç›¸å…³"><a href="#é¡¹ç›®æŠ€æœ¯æ¶æ„ç›¸å…³" class="headerlink" title="é¡¹ç›®æŠ€æœ¯æ¶æ„ç›¸å…³"></a>é¡¹ç›®æŠ€æœ¯æ¶æ„ç›¸å…³</h1><h2 id="é¡¹ç›®é‡‡ç”¨ä»€ä¹ˆæŠ€æœ¯æ¶æ„"><a href="#é¡¹ç›®é‡‡ç”¨ä»€ä¹ˆæŠ€æœ¯æ¶æ„" class="headerlink" title="é¡¹ç›®é‡‡ç”¨ä»€ä¹ˆæŠ€æœ¯æ¶æ„"></a>é¡¹ç›®é‡‡ç”¨ä»€ä¹ˆæŠ€æœ¯æ¶æ„</h2><p>é¡¹ç›®é‡‡ç”¨å‰åç«¯åˆ†ç¦»çš„æŠ€æœ¯æ¶æ„ï¼Œä½¿ç”¨Spring CloudæŠ€æœ¯æ ˆæ„å»ºå¾®æœåŠ¡ï¼Œæ•°æ®åº“é‡‡ç”¨MySQLï¼Œè¿˜ä½¿ç”¨äº†Nacosã€Spring Cloud Gatewayã€Redisã€RabbitMQã€Elasticsearchã€XXL-Jobç­‰æŠ€æœ¯ã€‚</p><h3 id="Gatewayæ€ä¹ˆç”¨çš„ï¼Ÿ"><a href="#Gatewayæ€ä¹ˆç”¨çš„ï¼Ÿ" class="headerlink" title="Gatewayæ€ä¹ˆç”¨çš„ï¼Ÿ"></a>Gatewayæ€ä¹ˆç”¨çš„ï¼Ÿ</h3><p>æœ¬é¡¹ç›®ä½¿ç”¨Spring Cloud Gatewayä½œç”¨ç½‘å…³ï¼Œç½‘å…³çš„ä½œç”¨æ˜¯è´Ÿè½½å‡è¡¡ã€è·¯ç”±è½¬å‘ï¼Œè§ä¸‹å›¾ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.006.png"></p><p>å‰ç«¯è¯·æ±‚åˆ°Nginxï¼Œé€šè¿‡è´Ÿè½½å‡è¡¡åˆ°Gatewayç½‘å…³ï¼Œé€šè¿‡ç½‘å…³å°†è¯·æ±‚è½¬å‘è‡³å„ä¸ªå¾®æœåŠ¡ã€‚</p><p>ç½‘å…³è¿›è¡Œè·¯ç”±æ—¶éœ€è¦çŸ¥é“æ¯ä¸ªå¾®æœåŠ¡å®ä¾‹çš„åœ°å€ï¼Œç½‘å…³ä»nacosè¯»å–æœåŠ¡åœ°å€ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.007.png"></p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>å¾®æœåŠ¡å¯åŠ¨ï¼Œå°†è‡ªå·±æ³¨å†Œåˆ°Nacosï¼ŒNacosè®°å½•äº†å„å¾®æœåŠ¡å®ä¾‹çš„åœ°å€ã€‚</p></li><li><p>ç½‘å…³ä»Nacosè¯»å–æœåŠ¡åˆ—è¡¨ï¼ŒåŒ…æ‹¬æœåŠ¡åç§°ã€æœåŠ¡åœ°å€ç­‰ã€‚</p></li><li><p>è¯·æ±‚åˆ°è¾¾ç½‘å…³ï¼Œç½‘å…³å°†è¯·æ±‚è·¯ç”±åˆ°å…·ä½“çš„å¾®æœåŠ¡ã€‚</p></li></ol><p>æœ¬é¡¹ç›®ç½‘å…³è¿˜å…·æœ‰<strong>ç»Ÿä¸€é‰´æƒ</strong>åŠŸèƒ½ï¼š</p><ol><li>ç½‘ç«™ç™½åå•</li></ol><p>åœ¨ç™½åå•çš„ä¸­çš„åœ°å€ä¸è¿›è¡Œèº«ä»½æ ¡éªŒç›´æ¥æ”¾è¡Œã€‚</p><ol start="2"><li>èº«ä»½æ ¡éªŒ</li></ol><p>æ ¡éªŒè¯·æ±‚ä¸­jwtä»¤ç‰Œçš„åˆæ³•æ€§ï¼Œä»¤ç‰Œåˆæ³•åˆ™ç»§ç»­è®¿é—®ï¼Œå¦åˆ™æ‹’ç»è®¿é—®ã€‚</p><h3 id="Redisæ€ä¹ˆç”¨çš„ï¼Ÿ"><a href="#Redisæ€ä¹ˆç”¨çš„ï¼Ÿ" class="headerlink" title="Redisæ€ä¹ˆç”¨çš„ï¼Ÿ"></a>Redisæ€ä¹ˆç”¨çš„ï¼Ÿ</h3><p>é¡¹ç›®ä¸­ä½¿ç”¨Redisç¼“å­˜ä»¥ä¸‹ä¿¡æ¯ï¼Œæ¯ç§ç±»å‹çš„ä¿¡æ¯ç¼“å­˜æ—¶é—´ä¸åŒï¼š</p><ol><li><p>éªŒè¯ç </p></li><li><p>è¯¾ç¨‹å‘å¸ƒä¿¡æ¯</p></li><li><p>è¯¾ç¨‹è§†é¢‘ä¿¡æ¯</p></li><li><p><strong>æˆ‘çš„è¯¾ç¨‹</strong></p></li><li><p>æˆ‘çš„è®¢å•</p></li></ol><p>é¡¹ç›®ä½¿ç”¨Redissonå®ç°åˆ†å¸ƒå¼é”ï¼Œé¿å…è¯¾ç¨‹æŸ¥è¯¢ç­‰å…¬å¼€æ¥å£å‡ºç°ç¼“å­˜å‡»ç©¿é—®é¢˜ã€‚</p><h3 id="RabbitMQæ€ä¹ˆç”¨çš„ï¼Ÿ"><a href="#RabbitMQæ€ä¹ˆç”¨çš„ï¼Ÿ" class="headerlink" title="RabbitMQæ€ä¹ˆç”¨çš„ï¼Ÿ"></a>RabbitMQæ€ä¹ˆç”¨çš„ï¼Ÿ</h3><p>æ¶ˆæ¯é˜Ÿåˆ—åœ¨æœ¬é¡¹ç›®ç”¨äº<strong>è®¢å•æœåŠ¡</strong>ï¼Œæ”¯ä»˜æˆåŠŸé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å°†ç»“æœé€šçŸ¥ç»™å…¶å®ƒå¾®æœåŠ¡ã€‚</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/image-20240309224758558.png" alt="image-20240309224758558"></p><p>è®¢å•æœåŠ¡å®Œæˆæ”¯ä»˜åå°†æ”¯ä»˜ç»“æœå‘ç»™æ¯ä¸€ä¸ªä¸è®¢å•æœåŠ¡å¯¹æ¥çš„å¾®æœåŠ¡ï¼Œè®¢å•æœåŠ¡å°†æ¶ˆæ¯å‘ç»™äº¤æ¢æœºï¼Œç”±äº¤æ¢æœºå¹¿æ’­æ¶ˆæ¯ï¼Œæ¯ä¸ªè®¢é˜…æ¶ˆæ¯çš„å¾®æœåŠ¡éƒ½å¯ä»¥æ¥æ”¶åˆ°æ”¯ä»˜ç»“æœ.</p><p>å¾®æœåŠ¡æ”¶åˆ°æ”¯ä»˜ç»“æœæ ¹æ®è®¢å•çš„ç±»å‹å»æ›´æ–°è‡ªå·±çš„ä¸šåŠ¡æ•°æ®ã€‚</p><h3 id="Elasticsearchæ€ä¹ˆç”¨çš„ï¼Ÿ"><a href="#Elasticsearchæ€ä¹ˆç”¨çš„ï¼Ÿ" class="headerlink" title="Elasticsearchæ€ä¹ˆç”¨çš„ï¼Ÿ"></a>Elasticsearchæ€ä¹ˆç”¨çš„ï¼Ÿ</h3><p>æœ¬é¡¹ç›®ä½¿ç”¨Elasticsearchå¯¹è¯¾ç¨‹å‘å¸ƒä¿¡æ¯è¿›è¡Œç´¢å¼•å’Œæœç´¢ã€‚</p><ol><li><p>é¦–å…ˆåˆ›å»ºè¯¾ç¨‹ä¿¡æ¯çš„ç´¢å¼•</p></li><li><p>å®šä¹‰ç´¢å¼•ã€æœç´¢æ¥å£ã€‚</p></li></ol><blockquote><p>è¯¾ç¨‹å‘å¸ƒç”±å†…å®¹ç®¡ç†æœåŠ¡è¿œç¨‹è°ƒç”¨æœç´¢æœåŠ¡æ·»åŠ ç´¢å¼•æ¥å£å°†è¯¾ç¨‹ä¿¡æ¯æ·»åŠ è‡³ESç´¢å¼•åº“ã€‚</p><p>è¯¾ç¨‹ä¸‹æ¶ç”±å†…å®¹ç®¡ç†æœåŠ¡è¿œç¨‹è°ƒç”¨æœç´¢æœåŠ¡åˆ é™¤ç´¢å¼•æ¥å£å°†è¯¾ç¨‹ä¿¡æ¯ä»ESç´¢å¼•åº“åˆ é™¤ã€‚</p></blockquote><ol start="3"><li>è¯¾ç¨‹æœç´¢æ¥å£ä½¿ç”¨äº†å¸ƒå°”æŸ¥è¯¢ã€èšåˆæœç´¢ã€è¿‡æ»¤å™¨ã€é«˜äº®æ˜¾ç¤ºç­‰åŠŸèƒ½ã€‚</li></ol><h3 id="XXL-Jobæ€ä¹ˆç”¨çš„ï¼Ÿ"><a href="#XXL-Jobæ€ä¹ˆç”¨çš„ï¼Ÿ" class="headerlink" title="XXL-Jobæ€ä¹ˆç”¨çš„ï¼Ÿ"></a>XXL-Jobæ€ä¹ˆç”¨çš„ï¼Ÿ</h3><p>é¦–å…ˆè¯´XXL-JOBçš„å·¥ä½œæµç¨‹ï¼Œç„¶åè¯´æœ¬é¡¹ç›®ä½¿ç”¨XXL-JOBå…·ä½“æ–¹æ¡ˆã€‚</p><p>1 XXL-JOBçš„å·¥ä½œæµç¨‹</p><p>XXL-JOBåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æœåŠ¡ç”±è°ƒç”¨ä¸­å¿ƒå’Œæ‰§è¡Œå™¨ç»„æˆï¼Œè°ƒç”¨ä¸­å¿ƒè´Ÿè´£æŒ‰ä»»åŠ¡è°ƒåº¦ç­–ç•¥å‘æ‰§è¡Œå™¨ä¸‹å‘ä»»åŠ¡ï¼Œæ‰§è¡Œå™¨è´Ÿè´£æ¥æ”¶ä»»åŠ¡æ‰§è¡Œä»»åŠ¡ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.009.png"></p><p>1ï¼‰åœ¨å¾®æœåŠ¡é…ç½®æ‰§è¡Œå™¨åç§°ã€ç«¯å£ï¼Œå¯åŠ¨å¾®æœåŠ¡åæ‰§è¡Œå™¨å‘è°ƒç”¨ä¸­å¿ƒæ³¨å†Œã€‚</p><p>å¯é€šè¿‡è°ƒåº¦ä¸­å¿ƒé¡µé¢æŸ¥è¯¢æ‰§è¡Œå™¨æ˜¯å¦æ³¨å†ŒæˆåŠŸ</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.010.png"></p><p>2ï¼‰åœ¨å¾®æœåŠ¡å®šä¹‰ä»»åŠ¡æ–¹æ³•</p><p>ä¸‹è¾¹æ˜¯è¯¾ç¨‹å‘å¸ƒä»»åŠ¡çš„ç¤ºä¾‹</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.011.png"></p><p>3ï¼‰åœ¨è°ƒç”¨ä¸­å¿ƒé…ç½®ä»»åŠ¡è°ƒåº¦ç­–ç•¥</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.012.png"></p><p>4ï¼‰å¯åŠ¨ä»»åŠ¡è¿›è¡Œä»»åŠ¡è°ƒåº¦ã€‚</p><p>2ã€æœ¬é¡¹ç›®ä½¿ç”¨XXL-JOBçš„å…·ä½“æ–¹æ¡ˆ</p><p>æœ¬é¡¹ç›®ä½¿ç”¨XXL-JOBå®Œæˆè¯¾ç¨‹å‘å¸ƒæ•°æ®åŒæ­¥ã€æ”¯ä»˜ç»“æœé€šçŸ¥ç­‰ä»»åŠ¡ã€‚</p><p>ä¸‹è¾¹ä»¥è§†é¢‘å¤„ç†ä»»åŠ¡ä¸ºä¾‹è¯´æ˜ï¼š</p><p>\1) è°ƒåº¦ä¸­å¿ƒé‡‡ç”¨åˆ†ç‰‡å¹¿æ’­æ–¹å¼ä¸‹å‘ä»»åŠ¡</p><p>æ‰§è¡Œå™¨éƒ¨ç½²åœ¨å¤šä¸ªå¾®æœåŠ¡å®ä¾‹ï¼Œæ”¶åˆ°ä»»åŠ¡ä»æ•°æ®åº“è¯»å–å¾…å¤„ç†ä»»åŠ¡åˆ—è¡¨ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.013.png"></p><p>æ¯ä¸ªæ‰§è¡Œå™¨æ”¶åˆ°å¹¿æ’­ä»»åŠ¡æœ‰ä¸¤ä¸ªå‚æ•°ï¼šåˆ†ç‰‡æ€»æ•°ã€åˆ†ç‰‡åºå·ã€‚æ¯ä¸ªæ‰§è¡Œå™¨ä»æ•°æ®è¡¨å–ä»»åŠ¡æ—¶å¯ä»¥è®©ä»»åŠ¡id æ¨¡ä¸Š åˆ†ç‰‡æ€»æ•°ï¼Œå¦‚æœç­‰äºåˆ†ç‰‡åºå·åˆ™æ‰§è¡Œæ­¤ä»»åŠ¡ã€‚</p><p>ä¸Šè¾¹ä¸¤ä¸ªæ‰§è¡Œå™¨å®ä¾‹çš„åˆ†ç‰‡æ€»æ•°ä¸º2ï¼Œåºå·ä¸º0ã€1ï¼Œä»ä»»åŠ¡1å¼€å§‹ï¼Œå¦‚ä¸‹ï¼š</p><p>1  %  2 &#x3D; 1    æ‰§è¡Œå™¨2æ‰§è¡Œ</p><p>2  %  2 &#x3D;  0    æ‰§è¡Œå™¨1æ‰§è¡Œ</p><p>3  %  2 &#x3D;  1     æ‰§è¡Œå™¨2æ‰§è¡Œ</p><p>2ï¼‰å¾—åˆ°å¾…å¤„ç†ä»»åŠ¡å¯åŠ¨å¤šä»»åŠ¡è¿›è¡Œä»»åŠ¡å¤„ç†</p><p>ä¸‹å›¾æ˜¯è§†é¢‘ä¸Šä¼ åŠå¤„ç†çš„ä¸šåŠ¡æµç¨‹ï¼š</p><p>ä¸Šä¼ è§†é¢‘æˆåŠŸå‘è§†é¢‘å¤„ç†å¾…å¤„ç†è¡¨æ·»åŠ è®°å½•</p><p>ç”±äºè°ƒåº¦ä¸­å¿ƒè¿›è¡Œä»»åŠ¡è°ƒåº¦ï¼Œæ‰§è¡Œå™¨ä»æ•°æ®åº“æŸ¥è¯¢å¾…å¤„ç†ä»»åŠ¡ï¼Œå¯åŠ¨å¤šçº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚</p><p><strong>2.10 å¦‚ä½•ä¿è¯ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œ?</strong></p><p>1ã€æ‰§è¡Œå™¨æ”¶åˆ°ä½œä¸šåˆ†ç‰‡å¹¿æ’­ï¼Œè®¡ç®— ä»»åŠ¡id æ¨¡ä¸Š åˆ†ç‰‡æ€»æ•°çš„ç»“æœï¼Œç­‰äºåˆ†ç‰‡åºå·ä»»åŠ¡å»æ‰§è¡Œï¼Œè¿™é‡Œä¿è¯äº†ä¸åŒçš„æ‰§è¡Œå™¨æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ã€‚</p><p>2ã€é…ç½®è°ƒåº¦è¿‡æœŸç­–ç•¥ï¼Œé¿å…åŒä¸€ä¸ªæ‰§è¡Œå™¨å¤šæ¬¡é‡å¤æ‰§è¡ŒåŒä¸€ä¸ªä»»åŠ¡</p><p>è°ƒåº¦è¿‡æœŸç­–ç•¥å¦‚ä¸‹ï¼š<br><code>        </code>- å¿½ç•¥ï¼šè°ƒåº¦è¿‡æœŸåï¼Œå¿½ç•¥è¿‡æœŸçš„ä»»åŠ¡ï¼Œä»å½“å‰æ—¶é—´å¼€å§‹é‡æ–°è®¡ç®—ä¸‹æ¬¡è§¦å‘æ—¶é—´ï¼›<br><code>        </code>- ç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼šè°ƒåº¦è¿‡æœŸåï¼Œç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä»å½“å‰æ—¶é—´å¼€å§‹é‡æ–°è®¡ç®—ä¸‹æ¬¡è§¦å‘æ—¶é—´ï¼›<br><code>    </code>- é˜»å¡å¤„ç†ç­–ç•¥ï¼šè°ƒåº¦è¿‡äºå¯†é›†æ‰§è¡Œå™¨æ¥ä¸åŠå¤„ç†æ—¶çš„å¤„ç†ç­–ç•¥ï¼›</p><p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©å¿½ç•¥ï¼Œå¦‚æœç«‹å³æ‰§è¡Œä¸€æ¬¡å¯èƒ½ä¼šé‡å¤è°ƒåº¦ã€‚</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.015.png"></p><p>å…¶æ¬¡ï¼Œå†çœ‹é˜»å¡å¤„ç†ç­–ç•¥ï¼Œé˜»å¡å¤„ç†ç­–ç•¥å°±æ˜¯å½“å‰æ‰§è¡Œå™¨æ­£åœ¨æ‰§è¡Œä»»åŠ¡è¿˜æ²¡æœ‰ç»“æŸæ—¶è°ƒåº¦æ—¶é—´åˆ°è¾¾åˆ°ï¼Œæ­¤æ—¶è¯¥å¦‚ä½•å¤„ç†ã€‚</p><p>æŸ¥çœ‹æ–‡æ¡£å¦‚ä¸‹ï¼š<br><code>        </code>å•æœºä¸²è¡Œï¼ˆé»˜è®¤ï¼‰ï¼šè°ƒåº¦è¯·æ±‚è¿›å…¥å•æœºæ‰§è¡Œå™¨åï¼Œè°ƒåº¦è¯·æ±‚è¿›å…¥FIFOé˜Ÿåˆ—å¹¶ä»¥ä¸²è¡Œæ–¹å¼è¿è¡Œï¼›<br><code>        </code>ä¸¢å¼ƒåç»­è°ƒåº¦ï¼šè°ƒåº¦è¯·æ±‚è¿›å…¥å•æœºæ‰§è¡Œå™¨åï¼Œå‘ç°æ‰§è¡Œå™¨å­˜åœ¨è¿è¡Œçš„è°ƒåº¦ä»»åŠ¡ï¼Œæœ¬æ¬¡è¯·æ±‚å°†ä¼šè¢«ä¸¢å¼ƒå¹¶æ ‡è®°ä¸ºå¤±è´¥ï¼›<br><code>        </code>è¦†ç›–ä¹‹å‰è°ƒåº¦ï¼šè°ƒåº¦è¯·æ±‚è¿›å…¥å•æœºæ‰§è¡Œå™¨åï¼Œå‘ç°æ‰§è¡Œå™¨å­˜åœ¨è¿è¡Œçš„è°ƒåº¦ä»»åŠ¡ï¼Œå°†ä¼šç»ˆæ­¢è¿è¡Œä¸­çš„è°ƒåº¦ä»»åŠ¡å¹¶æ¸…ç©ºé˜Ÿåˆ—ï¼Œç„¶åè¿è¡Œæœ¬åœ°è°ƒåº¦ä»»åŠ¡ï¼›</p><p>è¿™é‡Œé€‰æ‹© ä¸¢å¼ƒåç»­è°ƒåº¦ï¼Œé¿å…é‡å¤è°ƒåº¦ã€‚</p><p>3ã€ä¿è¯ä»»åŠ¡å¤„ç†çš„å¹‚ç­‰æ€§</p><p>å¹‚ç­‰æ€§æ˜¯ä¸ºäº†è§£å†³é‡å¤æäº¤é—®é¢˜ï¼Œæ¯”å¦‚ï¼šæ¶æ„åˆ·å•ï¼Œé‡å¤æ”¯ä»˜ç­‰ã€‚</p><p>è§£å†³å¹‚ç­‰æ€§å¸¸ç”¨çš„æ–¹æ¡ˆï¼š</p><p>1ï¼‰æ•°æ®åº“çº¦æŸï¼Œæ¯”å¦‚ï¼šå”¯ä¸€ç´¢å¼•ï¼Œä¸»é”®ã€‚</p><p>2ï¼‰ä¹è§‚é”ï¼Œå¸¸ç”¨äºæ•°æ®åº“ï¼Œæ›´æ–°æ•°æ®æ—¶æ ¹æ®ä¹è§‚é”çŠ¶æ€å»æ›´æ–°ã€‚</p><p>3ï¼‰å”¯ä¸€åºåˆ—å·ï¼Œæ“ä½œä¼ é€’ä¸€ä¸ªå”¯ä¸€åºåˆ—å·ï¼Œæ“ä½œæ—¶åˆ¤æ–­ä¸è¯¥åºåˆ—å·ç›¸ç­‰åˆ™æ‰§è¡Œã€‚</p><p>è¿™é‡Œæˆ‘ä»¬åœ¨æ•°æ®åº“è§†é¢‘å¤„ç†è¡¨ä¸­æ·»åŠ å¤„ç†çŠ¶æ€å­—æ®µï¼Œè§†é¢‘å¤„ç†å®Œæˆæ›´æ–°çŠ¶æ€ä¸ºå®Œæˆï¼Œæ‰§è¡Œè§†é¢‘å¤„ç†å‰åˆ¤æ–­çŠ¶æ€æ˜¯å¦å®Œæˆï¼Œå¦‚æœå®Œæˆåˆ™ä¸å†å¤„ç†ã€‚</p><h3 id="æ¥å£å¼‚å¸¸å¦‚ä½•å¤„ç†ï¼Ÿ"><a href="#æ¥å£å¼‚å¸¸å¦‚ä½•å¤„ç†ï¼Ÿ" class="headerlink" title="æ¥å£å¼‚å¸¸å¦‚ä½•å¤„ç†ï¼Ÿ"></a>æ¥å£å¼‚å¸¸å¦‚ä½•å¤„ç†ï¼Ÿ</h3><p>æ¥å£åœ¨è¿‡ç¨‹ä¸­å­˜åœ¨å¼‚å¸¸ç”±ç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨è¿›è¡Œå¤„ç†ã€‚</p><p>1ã€å¤„ç†è‡ªå®šä¹‰å¼‚å¸¸</p><p>ç¨‹åºåœ¨ç¼–å†™ä»£ç æ—¶æ ¹æ®æ ¡éªŒç»“æœä¸»åŠ¨æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ç±»Exceptionçš„å¯¹è±¡ï¼Œå¹¶ç¼–å†™è¯¦ç»†çš„å¼‚å¸¸ä¿¡æ¯ï¼Œå¼‚å¸¸å¤„ç†å™¨æ•è·å¼‚å¸¸ä¿¡æ¯è®°å½•å¼‚å¸¸æ—¥å¿—å¹¶å“åº”ç»™ç”¨æˆ·ã€‚</p><p>2ã€å¤„ç†æœªçŸ¥å¼‚å¸¸</p><p>æ¥å£æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸€äº›è¿è¡Œæ—¶å¼‚å¸¸ä¹Ÿä¼šç”±å¼‚å¸¸å¤„ç†å™¨ç»Ÿä¸€æ•è·ï¼Œè®°å½•å¼‚å¸¸æ—¥å¿—ï¼Œç»Ÿä¸€å“åº”ç»™ç”¨æˆ·500é”™è¯¯åŠç»Ÿä¸€çš„å¼‚å¸¸ä¿¡æ¯ã€‚</p><p>å¼‚å¸¸å¤„ç†å™¨ä½¿ç”¨æ§åˆ¶å™¨å¢åŠ æ³¨è§£@ControllerAdviceå’Œå¼‚å¸¸å¤„ç†æ³¨è§£@ExceptionHandleræ¥å®ç°ã€‚</p><h3 id="å¾®æœåŠ¡ä¹‹é—´æ¥å£å¦‚ä½•è°ƒç”¨ï¼Ÿ"><a href="#å¾®æœåŠ¡ä¹‹é—´æ¥å£å¦‚ä½•è°ƒç”¨ï¼Ÿ" class="headerlink" title="å¾®æœåŠ¡ä¹‹é—´æ¥å£å¦‚ä½•è°ƒç”¨ï¼Ÿ"></a>å¾®æœåŠ¡ä¹‹é—´æ¥å£å¦‚ä½•è°ƒç”¨ï¼Ÿ</h3><p>å¾®æœåŠ¡ä¹‹é—´ä½¿ç”¨Feignè¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½å°†è‡ªå·±æ³¨å†Œåˆ°äº†æœåŠ¡æ³¨å†Œä¸­å¿ƒnacosä¸­ï¼Œå¾®æœåŠ¡åœ¨è¿œç¨‹è°ƒç”¨æ—¶ä¼šä»æœåŠ¡æ³¨å†Œä¸­å¿ƒæ‰¾åˆ°ç›®æ ‡æœåŠ¡çš„åœ°å€è¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚</p><p>å½“ç›®æ ‡æœåŠ¡å¼‚å¸¸åœ¨è¿œç¨‹è°ƒç”¨æ—¶å‘ç”Ÿç†”æ–­ï¼Œæ­¤æ—¶è°ƒç”¨æ–¹è¦å®šä¹‰é™çº§æ–¹æ³•ä¿è¯è¯·æ±‚å¿«é€Ÿå“åº”ã€‚</p><p>é¡¹ç›®ä¸­ä½¿ç”¨FeignClientçš„fallbackFactory ç¼–å†™é™çº§æ–¹æ³•ï¼Œä½¿ç”¨fallbackFactory çš„å¥½å¤„å¯ä»¥è·å–å‘ç”Ÿç†”æ–­çš„å¼‚å¸¸ä¿¡æ¯ã€‚</p><p><strong>2.15 ä»€ä¹ˆæ˜¯ç†”æ–­é™çº§ï¼Ÿ</strong></p><p>ç†”æ–­ï¼š</p><p>å½“ä¸‹æ¸¸æœåŠ¡å¼‚å¸¸è€Œæ–­å¼€ä¸ä¸Šæ¸¸æœåŠ¡çš„äº¤äº’ï¼Œå®ƒå°±ç›¸å½“äºä¿é™©ä¸ï¼Œä¸‹æ¸¸æœåŠ¡å¼‚å¸¸è§¦å‘äº†ç†”æ–­ï¼Œä»è€Œä¿è¯ä¸Šæ¸¸æœåŠ¡ä¸å—å½±å“ã€‚</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.018.png"></p><p>é™çº§ï¼š</p><p>å½“ä¸‹æ¸¸æœåŠ¡å¼‚å¸¸è§¦å‘ç†”æ–­åï¼Œä¸Šæ¸¸æœåŠ¡å°±ä¸å†å»è°ƒç”¨å¼‚å¸¸çš„å¾®æœåŠ¡è€Œæ˜¯æ‰§è¡Œäº†é™çº§å¤„ç†é€»è¾‘ï¼Œè¿™ä¸ªé™çº§å¤„ç†é€»è¾‘å¯ä»¥æ˜¯æœ¬åœ°ä¸€ä¸ªå•ç‹¬çš„æ–¹æ³•ã€‚</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.019.png"></p><p>ä¸¤è€…éƒ½æ˜¯ä¸ºäº†ä¿æŠ¤ç³»ç»Ÿï¼Œç†”æ–­æ˜¯å½“ä¸‹æ¸¸æœåŠ¡å¼‚å¸¸æ—¶ä¸€ç§ä¿æŠ¤ç³»ç»Ÿçš„æ‰‹æ®µï¼Œé™çº§æ˜¯ç†”æ–­åä¸Šæ¸¸æœåŠ¡å¤„ç†ç†”æ–­çš„æ–¹æ³•ã€‚</p><p>é¡¹ç›®ä¸­ä½¿ç”¨FeignClientçš„fallbackFactory ç¼–å†™é™çº§æ–¹æ³•ï¼Œä½¿ç”¨fallbackFactory çš„å¥½å¤„å¯ä»¥è·å–å‘ç”Ÿç†”æ–­çš„å¼‚å¸¸ä¿¡æ¯ã€‚</p><p>å¦‚ä¸‹ä»£ç ç¤ºä¾‹ï¼š</p><p>å®šä¹‰FeignClientæ¥å£æ—¶æŒ‡å®šfallbackFactory ã€‚</p><table><thead><tr><th align="left">Java<br>@FeignClient(value &#x3D; â€œmedia-apiâ€,fallbackFactory &#x3D; MediaServiceClientFallbackFactory.class)</th></tr></thead></table><p>å®šä¹‰fallbackFactory ï¼š</p><table><thead><tr><th align="left">Java<br><br>@Slf4j<br>@Component<br>public class MediaServiceClientFallbackFactory implements FallbackFactory<MediaServiceClient> {<br><code>    </code>@Override<br><code>    </code>public MediaServiceClient create(Throwable throwable) {<br><code>        </code>return new MediaServiceClient(){<br><code>            </code>@Override<br><code>            </code>public String uploadFile(MultipartFile upload, String folder, String objectName) {<br><code>                </code><em>log</em>.error(â€œè¿œç¨‹è°ƒç”¨åª’èµ„ç®¡ç†æœåŠ¡ç†”æ–­å¼‚å¸¸ï¼š{}â€,throwable);<br><code>                </code>return null;<br><code>            </code>}<br><code>        </code>};<br><code>    </code>}<br>}</th></tr></thead></table><p><strong>2.16 å¦‚ä½•è§£å†³å¾®æœåŠ¡é›ªå´©?</strong></p><p>ä»€ä¹ˆæ˜¯é›ªå´©æ•ˆåº”ï¼Ÿ</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.020.png"></p><p>å¾®æœåŠ¡çš„é›ªå´©æ•ˆåº”è¡¨ç°åœ¨æœåŠ¡ä¸æœåŠ¡ä¹‹é—´è°ƒç”¨ï¼Œå½“å…¶ä¸­ä¸€ä¸ªæœåŠ¡æ— æ³•æä¾›æœåŠ¡å¯èƒ½å¯¼è‡´å…¶å®ƒæœåŠ¡ä¹Ÿæ­»æ‰ï¼Œæ¯”å¦‚ï¼šæœåŠ¡Bè°ƒç”¨æœåŠ¡Aï¼Œç”±äºAæœåŠ¡å¼‚å¸¸å¯¼è‡´BæœåŠ¡å“åº”ç¼“æ…¢ï¼Œæœ€åBã€Cç­‰æœåŠ¡éƒ½ä¸å¯ç”¨ï¼Œåƒè¿™æ ·ç”±ä¸€ä¸ªæœåŠ¡æ‰€å¼•èµ·çš„ä¸€è¿ä¸²çš„å¤šä¸ªæœåŠ¡æ— æ³•æä¾›æœåŠ¡å³æ˜¯å¾®æœåŠ¡çš„é›ªå´©æ•ˆåº”ã€‚</p><p>å¦‚ä½•è§£å†³å¾®æœåŠ¡é›ªå´©æ•ˆåº”ï¼Ÿ</p><p>å‘ç”ŸæœåŠ¡ç­‰å¾…çš„åŸå› å¯èƒ½æ˜¯Feignçš„è¯·æ±‚è¶…æ—¶è¿‡é•¿ï¼Œä¹Ÿå¯èƒ½æ˜¯Tomcatçš„çº¿ç¨‹ç”¨å®Œï¼Œè§£å†³å‰è€…åªè¦é…ç½®Feignçš„è¿æ¥è¶…æ—¶æ—¶é•¿å°ä¸€äº›å³å¯ï¼Œè§£å†³åè€…åˆ™éœ€è¦çº¿ç¨‹éš”ç¦»ï¼Œç»™é«˜å¹¶å‘çš„æ–¹æ³•è®¾ç½®è‡ªå·±çš„ä¸“å±çº¿ç¨‹æ± ï¼Œè¿™æ ·å½“é«˜å¹¶å‘åˆ°æ¥å…¶å®ƒçš„æ¥å£ä¸å—é«˜å¹¶å‘æ–¹æ³•çš„å½±å“ã€‚</p><p>å¦å¤–åœ¨è¿˜å¯ä»¥ä»ä»¥ä¸‹æ–¹é¢å»é¢„é˜²å¾®æœåŠ¡é›ªå´©ï¼š</p><p>1ã€ç†”æ–­</p><p>å½“ç›®æ ‡æœåŠ¡æ— æ³•è¯·æ±‚å¯ä»¥é€šè¿‡ç†”æ–­å°†é“¾è·¯æ–­å¼€ã€‚</p><p>ä½¿ç”¨histrixæ¡†æ¶å®ç°ã€‚</p><p>2ã€é™çº§</p><p>å½“ç†”æ–­å‘ç”Ÿèµ°é™çº§æ–¹æ³•å¯ä»¥è¿”å›é¢„å…ˆè®¾ç½®çš„æ•°æ®ã€‚</p><p>ä½¿ç”¨histrixæ¡†æ¶å®ç°ã€‚</p><p>3ã€é™æµ</p><p>å¯¹äºé«˜å¹¶å‘è¯·æ±‚çš„æ¥å£è¦è¿›è¡Œé™æµï¼Œé¿å…æ— é™åˆ¶çš„è¯·æ±‚å‹åŠ›å…¨éƒ¨åˆ°è¾¾ç³»ç»Ÿã€‚</p><p>é™æµçš„æ–¹æ³•å¯ä»¥ç”¨nginxå®ç°ï¼Œä¹Ÿå¯ä»¥ç”¨sentinelç­‰ä¸­é—´ä»¶ã€‚</p><h1 id="ä¸šåŠ¡æµç¨‹ä¸æŠ€æœ¯æ–¹æ¡ˆ"><a href="#ä¸šåŠ¡æµç¨‹ä¸æŠ€æœ¯æ–¹æ¡ˆ" class="headerlink" title="ä¸šåŠ¡æµç¨‹ä¸æŠ€æœ¯æ–¹æ¡ˆ"></a>ä¸šåŠ¡æµç¨‹ä¸æŠ€æœ¯æ–¹æ¡ˆ</h1><h2 id="å†…å®¹ç®¡ç†æ¨¡å—"><a href="#å†…å®¹ç®¡ç†æ¨¡å—" class="headerlink" title="å†…å®¹ç®¡ç†æ¨¡å—"></a>å†…å®¹ç®¡ç†æ¨¡å—</h2><p><strong>3.1.1 æ•´ä½“ä¸šåŠ¡æµç¨‹</strong></p><p>å†…å®¹ç®¡ç†ç”±æ•™å­¦æœºæ„äººå‘˜å’Œå¹³å°çš„è¿è¥äººå‘˜å…±åŒå®Œæˆã€‚</p><p>æ•™å­¦æœºæ„äººå‘˜çš„ä¸šåŠ¡æµç¨‹å¦‚ä¸‹ï¼š</p><p>1ã€ç™»å½•æ•™å­¦æœºæ„ã€‚</p><p>2ã€ç»´æŠ¤è¯¾ç¨‹ä¿¡æ¯ï¼Œæ·»åŠ ä¸€é—¨è¯¾ç¨‹éœ€è¦ç¼–è¾‘è¯¾ç¨‹çš„åŸºæœ¬ä¿¡æ¯ã€ä¸Šä¼ è¯¾ç¨‹å›¾ç‰‡ã€è¯¾ç¨‹è¥é”€ä¿¡æ¯ã€è¯¾ç¨‹è®¡åˆ’ã€ä¸Šä¼ è¯¾ç¨‹è§†é¢‘ã€è¯¾ç¨‹å¸ˆèµ„ä¿¡æ¯ç­‰å†…å®¹ã€‚</p><p>3ã€è¯¾ç¨‹ä¿¡æ¯ç¼–è¾‘å®Œæˆï¼Œé€šè¿‡è¯¾ç¨‹é¢„è§ˆç¡®è®¤æ— è¯¯åæäº¤è¯¾ç¨‹å®¡æ ¸ã€‚</p><p>4ã€å¾…è¿è¥äººå‘˜è¯¾ç¨‹å®¡æ ¸é€šè¿‡åæ–¹å¯è¿›è¡Œè¯¾ç¨‹å‘å¸ƒã€‚</p><p>è¿è¥äººå‘˜çš„ä¸šåŠ¡æµç¨‹å¦‚ä¸‹ï¼š</p><p>1ã€æŸ¥è¯¢å¾…å®¡æ ¸çš„è¯¾ç¨‹ä¿¡æ¯ã€‚</p><p>2ã€å®¡æ ¸è¯¾ç¨‹ä¿¡æ¯ã€‚</p><p>3ã€æäº¤å®¡æ ¸ç»“æœã€‚</p><p>è¯¾ç¨‹ä»æ·»åŠ åˆ°å‘å¸ƒçš„æ•´ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.021.png"></p><p><strong>3.1.2 æµç¨‹æ§åˆ¶æ–¹æ¡ˆ</strong></p><p>å¦‚ä½•æ§åˆ¶è¯¾ç¨‹å®¡æ ¸é€šè¿‡æ‰å¯ä»¥å‘å¸ƒè¯¾ç¨‹å‘¢ï¼Ÿ</p><p>åœ¨è¯¾ç¨‹åŸºæœ¬è¡¨course_baseè¡¨è®¾ç½®è¯¾ç¨‹å®¡æ ¸çŠ¶æ€å­—æ®µï¼ŒåŒ…æ‹¬ï¼šæœªæäº¤ã€å·²æäº¤(æœªå®¡æ ¸)ã€å®¡æ ¸é€šè¿‡ã€å®¡æ ¸ä¸é€šè¿‡ã€‚</p><p>ä¸‹è¾¹æ˜¯è¯¾ç¨‹çŠ¶æ€çš„è½¬åŒ–å…³ç³»ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.022.png"></p><p>è¯´æ˜å¦‚ä¸‹ï¼š</p><p>1ã€ä¸€é—¨è¯¾ç¨‹æ–°å¢åå®ƒçš„å®¡æ ¸çŠ¶ä¸ºâ€æœªæäº¤â€œï¼Œå‘å¸ƒçŠ¶æ€ä¸ºâ€æœªå‘å¸ƒâ€œã€‚</p><p>2ã€è¯¾ç¨‹ä¿¡æ¯ç¼–è¾‘å®Œæˆï¼Œæ•™å­¦æœºæ„äººå‘˜æ‰§è¡Œâ€æäº¤å®¡æ ¸â€œæ“ä½œã€‚æ­¤æ—¶è¯¾ç¨‹çš„å®¡æ ¸çŠ¶æ€ä¸ºâ€å·²æäº¤â€œã€‚</p><p>3ã€å½“è¯¾ç¨‹çŠ¶æ€ä¸ºå·²æäº¤æ—¶è¿è¥å¹³å°äººå‘˜å¯¹è¯¾ç¨‹è¿›è¡Œå®¡æ ¸ã€‚</p><p>4ã€è¿è¥å¹³å°äººå‘˜å®¡æ ¸è¯¾ç¨‹ï¼Œç»“æœæœ‰ä¸¤ä¸ªï¼šå®¡æ ¸é€šè¿‡ã€å®¡æ ¸ä¸é€šè¿‡ã€‚</p><p>5ã€è¯¾ç¨‹å®¡æ ¸è¿‡åä¸ç®¡çŠ¶æ€æ˜¯é€šè¿‡è¿˜æ˜¯ä¸é€šè¿‡ï¼Œæ•™å­¦æœºæ„å¯ä»¥å†æ¬¡ä¿®æ”¹è¯¾ç¨‹å¹¶æäº¤å®¡æ ¸ï¼Œæ­¤æ—¶è¯¾ç¨‹çŠ¶æ€ä¸ºâ€å·²æäº¤â€œã€‚æ­¤æ—¶è¿è¥å¹³å°äººå‘˜å†æ¬¡å®¡æ ¸è¯¾ç¨‹ã€‚</p><p>6ã€è¯¾ç¨‹å®¡æ ¸é€šè¿‡ï¼Œæ•™å­¦æœºæ„äººå‘˜å¯ä»¥å‘å¸ƒè¯¾ç¨‹ï¼Œå‘å¸ƒæˆåŠŸåè¯¾ç¨‹çš„å‘å¸ƒçŠ¶æ€ä¸ºâ€å·²å‘å¸ƒâ€œã€‚</p><p>7ã€è¯¾ç¨‹å‘å¸ƒåé€šè¿‡â€ä¸‹æ¶â€œæ“ä½œå¯ä»¥æ›´æ”¹è¯¾ç¨‹å‘å¸ƒçŠ¶æ€ä¸ºâ€ä¸‹æ¶â€œ</p><p>8ã€è¯¾ç¨‹ä¸‹æ¶åé€šè¿‡â€ä¸Šæ¶â€œæ“ä½œå¯ä»¥å†æ¬¡å‘å¸ƒè¯¾ç¨‹ï¼Œä¸Šæ¶åè¯¾ç¨‹å‘å¸ƒçŠ¶æ€ä¸ºâ€œå‘å¸ƒâ€ã€‚</p><p><strong>3.1.3 è¯¾ç¨‹å®¡æ ¸æµç¨‹</strong></p><p>æ•™å­¦æœºæ„æäº¤è¯¾ç¨‹å®¡æ ¸åï¼Œå¹³å°è¿è¥äººå‘˜ç™»å½•è¿è¥å¹³å°æŸ¥è¯¢å¾…å®¡æ ¸çš„è®°å½•ã€‚</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.023.png"></p><p>å…·ä½“å®¡æ ¸çš„è¿‡ç¨‹ä¸è¯¾ç¨‹é¢„è§ˆçš„è¿‡ç¨‹ç±»ä¼¼ï¼Œè¿è¥äººå‘˜æŸ¥çœ‹è¯¾ç¨‹ä¿¡æ¯ã€è¯¾ç¨‹è§†é¢‘ç­‰å†…å®¹ã€‚</p><p>å¦‚æœå­˜åœ¨é—®é¢˜åˆ™å®¡æ ¸ä¸é€šè¿‡ï¼Œå¹¶é™„ä¸Šå®¡æ ¸ä¸é€šè¿‡çš„åŸå› ä¾›æ•™å­¦æœºæ„äººå‘˜æŸ¥çœ‹ã€‚</p><p>å¦‚æœè¯¾ç¨‹å†…å®¹æ²¡æœ‰è¿è§„ä¿¡æ¯ä¸”è¯¾ç¨‹å†…å®¹å…¨é¢åˆ™å®¡æ ¸é€šè¿‡ã€‚</p><p>è¯¾ç¨‹å®¡æ ¸é€šè¿‡åæ•™å­¦æœºæ„å‘å¸ƒè¯¾ç¨‹æˆåŠŸã€‚</p><p><strong>3.1.4 è¯¾ç¨‹å‘å¸ƒåˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ</strong></p><p>è¯¾ç¨‹å‘å¸ƒæ“ä½œåï¼Œå…ˆæ›´æ–°æ•°æ®åº“ä¸­çš„è¯¾ç¨‹å‘å¸ƒçŠ¶æ€ï¼Œæ›´æ–°åå‘redisã€elasticsearchã€MinIOå†™è¯¾ç¨‹ä¿¡æ¯ï¼Œè¿™é‡Œå­˜åœ¨åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œåªè¦åœ¨ä¸€å®šæ—¶é—´å†…æœ€ç»ˆå‘redisã€elasticsearchã€MinIOå†™æ•°æ®æˆåŠŸå³å¯ï¼Œæ‰€ä»¥è¯¾ç¨‹å‘å¸ƒæ»¡è¶³APå³å¯ï¼Œä¿è¯å¯ç”¨æ€§å®ç°æœ€ç»ˆæ•°æ®ä¸€è‡´æ€§ã€‚</p><p>åˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶çš„æ–¹æ¡ˆé‡‡ç”¨æœ¬åœ°æ¶ˆæ¯è¡¨åŠ ä»»åŠ¡è°ƒåº¦çš„æ–¹æ¡ˆï¼Œä¸‹å›¾æ˜¯å…·ä½“çš„æŠ€æœ¯æ–¹æ¡ˆï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.024.png"></p><p>1ã€åœ¨å†…å®¹ç®¡ç†æœåŠ¡çš„æ•°æ®åº“ä¸­æ·»åŠ ä¸€ä¸ªæ¶ˆæ¯è¡¨ï¼Œæ¶ˆæ¯è¡¨å’Œè¯¾ç¨‹å‘å¸ƒè¡¨åœ¨åŒä¸€ä¸ªæ•°æ®åº“ã€‚</p><p>2ã€ç‚¹å‡»è¯¾ç¨‹å‘å¸ƒé€šè¿‡æœ¬åœ°äº‹åŠ¡å‘è¯¾ç¨‹å‘å¸ƒè¡¨å†™å…¥è¯¾ç¨‹å‘å¸ƒä¿¡æ¯ï¼ŒåŒæ—¶å‘æ¶ˆæ¯è¡¨å†™è¯¾ç¨‹å‘å¸ƒçš„æ¶ˆæ¯ã€‚ä¸¤æ¡è®°å½•ä¿è¯åŒæ—¶å­˜åœ¨æˆ–åŒæ—¶ä¸å­˜åœ¨ã€‚</p><p>3ã€å¯åŠ¨ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿå®šæ—¶è°ƒåº¦å†…å®¹ç®¡ç†æœåŠ¡å»å®šæ—¶æ‰«ææ¶ˆæ¯è¡¨çš„è®°å½•ã€‚</p><p>4ã€å½“æ‰«æåˆ°è¯¾ç¨‹å‘å¸ƒçš„æ¶ˆæ¯æ—¶å³å¼€å§‹å®Œæˆå‘redisã€elasticsearchã€MinIOåŒæ­¥æ•°æ®çš„æ“ä½œã€‚</p><p>5ã€åŒæ­¥æ•°æ®çš„ä»»åŠ¡å®Œæˆååˆ é™¤æ¶ˆæ¯è¡¨è®°å½•ã€‚</p><p>ä¸‹å›¾æ˜¯è¯¾ç¨‹å‘å¸ƒæ“ä½œçš„æµç¨‹ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.025.png"></p><p>1ã€æ‰§è¡Œå‘å¸ƒæ“ä½œï¼Œå†…å®¹ç®¡ç†æœåŠ¡å­˜å‚¨è¯¾ç¨‹å‘å¸ƒè¡¨çš„åŒæ—¶å‘æ¶ˆæ¯è¡¨æ·»åŠ ä¸€æ¡â€œè¯¾ç¨‹å‘å¸ƒä»»åŠ¡â€ã€‚è¿™é‡Œä½¿ç”¨æœ¬åœ°äº‹åŠ¡ä¿è¯è¯¾ç¨‹å‘å¸ƒä¿¡æ¯ä¿å­˜æˆåŠŸï¼ŒåŒæ—¶æ¶ˆæ¯è¡¨ä¹Ÿä¿å­˜æˆåŠŸã€‚</p><p>2ã€ä»»åŠ¡è°ƒåº¦æœåŠ¡å®šæ—¶è°ƒåº¦å†…å®¹ç®¡ç†æœåŠ¡æ‰«ææ¶ˆæ¯è¡¨ï¼Œç”±äºè¯¾ç¨‹å‘å¸ƒæ“ä½œåå‘æ¶ˆæ¯è¡¨æ’å…¥ä¸€æ¡è¯¾ç¨‹å‘å¸ƒä»»åŠ¡ï¼Œæ­¤æ—¶æ‰«æåˆ°ä¸€æ¡ä»»åŠ¡ã€‚</p><p>3ã€æ‹¿åˆ°ä»»åŠ¡å¼€å§‹æ‰§è¡Œä»»åŠ¡ï¼Œåˆ†åˆ«å‘redisã€elasticsearchåŠæ–‡ä»¶ç³»ç»Ÿå­˜å‚¨æ•°æ®ã€‚</p><p>4ã€ä»»åŠ¡å®Œæˆååˆ é™¤æ¶ˆæ¯è¡¨è®°å½•ã€‚</p><p><strong>3.1.5 è¯¾ç¨‹å‘å¸ƒä»»åŠ¡è°ƒåº¦æ–¹æ¡ˆ</strong></p><p>ç”±xxl-jobè°ƒåº¦ä¸­å¿ƒæ ¹æ®ä»»åŠ¡ç­–ç•¥é€šè¿‡åˆ†ç‰‡å¹¿æ’­çš„æ¨¡å¼ä¸‹å‘ä»»åŠ¡åˆ°æ‰§è¡Œå™¨ï¼Œæ‰§è¡Œå™¨æ‰«ææœ¬åœ°æ¶ˆæ¯è¡¨ä¸­çš„æœªå¤„ç†çš„æ¶ˆæ¯(ä»»åŠ¡)ï¼Œé€šè¿‡å¤šçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡ä¸ºä¸€é—¨è¯¾ç¨‹çš„å‘å¸ƒä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæˆåˆ é™¤æœ¬åœ°æ¶ˆæ¯è¡¨çš„è®°å½•ã€‚</p><h3 id="é¡µé¢é™æ€åŒ–æ–¹æ¡ˆ"><a href="#é¡µé¢é™æ€åŒ–æ–¹æ¡ˆ" class="headerlink" title="é¡µé¢é™æ€åŒ–æ–¹æ¡ˆ"></a>é¡µé¢é™æ€åŒ–æ–¹æ¡ˆ</h3><p>è¯¾ç¨‹ä¿¡æ¯é¡µé¢çš„è®¿é—®é‡è¾ƒå¤§ï¼Œå¹¶ä¸”è¯¾ç¨‹ä¿¡æ¯å‘å¸ƒååœ¨ä¸€æ®µæ—¶é—´ä¸ä¼šä¿®æ”¹ï¼Œè¿™é‡Œä½¿ç”¨Freemarkeré™æ€åŒ–æŠ€æœ¯å°†è¯¾ç¨‹ä¿¡æ¯é¡µé¢é™æ€åŒ–ï¼Œæå‰ç”Ÿæˆhtmlé¡µé¢å¹¶é€šè¿‡åª’èµ„ç®¡ç†æ¨¡å—çš„æ–‡ä»¶æœåŠ¡ä¸Šä¼ åˆ°æ–‡ä»¶ç³»ç»Ÿï¼Œç”¨æˆ·æµè§ˆè¯¾ç¨‹ä¿¡æ¯é¡µé¢é€šè¿‡åˆ†å¸ƒæ–‡ä»¶ç³»ç»Ÿæµè§ˆï¼Œæé«˜äº†è¯¾ç¨‹ä¿¡æ¯é¡µé¢è®¿é—®æ€§èƒ½ã€‚</p><h3 id="è¯¾ç¨‹æœç´¢æ–¹æ¡ˆ"><a href="#è¯¾ç¨‹æœç´¢æ–¹æ¡ˆ" class="headerlink" title="è¯¾ç¨‹æœç´¢æ–¹æ¡ˆ"></a>è¯¾ç¨‹æœç´¢æ–¹æ¡ˆ</h3><p>æœ¬é¡¹ç›®ä½¿ç”¨Elasticsearchå¯¹è¯¾ç¨‹å‘å¸ƒä¿¡æ¯è¿›è¡Œç´¢å¼•å’Œæœç´¢ã€‚</p><h2 id="åª’èµ„ç®¡ç†æ¨¡å—"><a href="#åª’èµ„ç®¡ç†æ¨¡å—" class="headerlink" title="åª’èµ„ç®¡ç†æ¨¡å—"></a>åª’èµ„ç®¡ç†æ¨¡å—</h2><h3 id="æ–­ç‚¹ç»­ä¼ æµç¨‹"><a href="#æ–­ç‚¹ç»­ä¼ æµç¨‹" class="headerlink" title="æ–­ç‚¹ç»­ä¼ æµç¨‹"></a>æ–­ç‚¹ç»­ä¼ æµç¨‹</h3><p>ä¸‹å›¾æ˜¯å¤§æ–‡ä»¶ä¸Šä¼ çš„æ•´ä½“æµç¨‹ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.026.png"></p><ol><li><p>å‰ç«¯ä¸Šä¼ æ–‡ä»¶å‰è¯·æ±‚åª’èµ„æ¥å£å±‚æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå·²ç»å­˜åœ¨åˆ™ä¸å†ä¸Šä¼ ã€‚</p></li><li><p>å¦‚æœæ–‡ä»¶åœ¨ç³»ç»Ÿä¸å­˜åœ¨åˆ™å‰ç«¯å¼€å§‹ä¸Šä¼ ï¼Œé¦–å…ˆå¯¹è§†é¢‘æ–‡ä»¶è¿›è¡Œåˆ†å—</p></li><li><p>å‰ç«¯åˆ†å—è¿›è¡Œä¸Šä¼ ï¼Œä¸Šä¼ å‰é¦–å…ˆæ£€æŸ¥åˆ†å—æ˜¯å¦ä¸Šä¼ ï¼Œå¦‚å·²ä¸Šä¼ åˆ™ä¸å†ä¸Šä¼ ï¼Œå¦‚æœæœªä¸Šä¼ åˆ™å¼€å§‹ä¸Šä¼ åˆ†å—ã€‚</p></li><li><p>å‰ç«¯è¯·æ±‚åª’èµ„ç®¡ç†æ¥å£å±‚è¯·æ±‚ä¸Šä¼ åˆ†å—ã€‚</p></li><li><p>æ¥å£å±‚è¯·æ±‚æœåŠ¡å±‚ä¸Šä¼ åˆ†å—ã€‚</p></li><li><p>æœåŠ¡ç«¯å°†åˆ†å—ä¿¡æ¯ä¸Šä¼ åˆ°MinIOã€‚</p></li><li><p>å‰ç«¯å°†åˆ†å—ä¸Šä¼ å®Œæ¯•è¯·æ±‚æ¥å£å±‚åˆå¹¶åˆ†å—ã€‚</p></li><li><p>æ¥å£å±‚è¯·æ±‚æœåŠ¡å±‚åˆå¹¶åˆ†å—ã€‚</p></li><li><p>æœåŠ¡å±‚æ ¹æ®æ–‡ä»¶ä¿¡æ¯æ‰¾åˆ°MinIOä¸­çš„åˆ†å—æ–‡ä»¶ï¼Œä¸‹è½½åˆ°æœ¬åœ°ä¸´æ—¶ç›®å½•ï¼Œå°†æ‰€æœ‰åˆ†å—ä¸‹è½½å®Œæ¯•åå¼€å§‹åˆå¹¶ ã€‚</p></li><li><p>åˆå¹¶å®Œæˆå°†åˆå¹¶åçš„æ–‡ä»¶ä¸Šä¼ åˆ°MinIOã€‚</p></li></ol><h3 id="ä»»åŠ¡è°ƒåº¦è§†é¢‘å¤„ç†æµç¨‹"><a href="#ä»»åŠ¡è°ƒåº¦è§†é¢‘å¤„ç†æµç¨‹" class="headerlink" title="ä»»åŠ¡è°ƒåº¦è§†é¢‘å¤„ç†æµç¨‹"></a>ä»»åŠ¡è°ƒåº¦è§†é¢‘å¤„ç†æµç¨‹</h3><p>è§†é¢‘ä¸Šä¼ åŠå¤„ç†çš„ä¸šåŠ¡æµç¨‹å¦‚ä¸‹ï¼š</p><p>ä¸Šä¼ è§†é¢‘æˆåŠŸå‘è§†é¢‘å¤„ç†å¾…å¤„ç†è¡¨æ·»åŠ è®°å½•ã€‚</p><p>è§†é¢‘å¤„ç†çš„è¯¦ç»†æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.027.png"></p><p>1ã€ä»»åŠ¡è°ƒåº¦ä¸­å¿ƒå¹¿æ’­ä½œä¸šåˆ†ç‰‡ã€‚</p><p>2ã€æ‰§è¡Œå™¨æ”¶åˆ°å¹¿æ’­ä½œä¸šåˆ†ç‰‡ï¼Œä»æ•°æ®åº“è¯»å–å¾…å¤„ç†ä»»åŠ¡ã€‚</p><p>3ã€æ‰§è¡Œå™¨æ ¹æ®ä»»åŠ¡å†…å®¹ä»MinIOä¸‹è½½è¦å¤„ç†çš„æ–‡ä»¶ã€‚</p><p>4ã€æ‰§è¡Œå™¨å¯åŠ¨å¤šçº¿ç¨‹å»å¤„ç†ä»»åŠ¡ã€‚</p><p>5ã€ä»»åŠ¡å¤„ç†å®Œæˆï¼Œä¸Šä¼ å¤„ç†åçš„è§†é¢‘åˆ°MinIOã€‚</p><p>6ã€å°†æ›´æ–°ä»»åŠ¡å¤„ç†ç»“æœï¼Œå¦‚æœè§†é¢‘å¤„ç†å®Œæˆé™¤äº†æ›´æ–°ä»»åŠ¡å¤„ç†ç»“æœä»¥å¤–è¿˜è¦å°†æ–‡ä»¶çš„è®¿é—®åœ°å€æ›´æ–°è‡³ä»»åŠ¡å¤„ç†è¡¨åŠæ–‡ä»¶è¡¨ä¸­ï¼Œæœ€åå°†ä»»åŠ¡å®Œæˆè®°å½•å†™å…¥å†å²è¡¨ã€‚</p><p><strong>3.1.3 æ–‡ä»¶æœåŠ¡è®¿é—®æ–¹æ¡ˆ</strong></p><p>åœ¨çº¿æ’æ”¾è¯¾ç¨‹è§†é¢‘ï¼Œè¯¾ç¨‹å›¾ç‰‡ã€è§†é¢‘è¿™äº›éƒ½åœ¨MinIOæ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ï¼Œç»Ÿä¸€ç”±Nginxä»£ç†ï¼Œé€šè¿‡æ–‡ä»¶æœåŠ¡åŸŸåç»Ÿä¸€è®¿é—®ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.028.png"></p><p>åœ¨nginxé…ç½®æ–‡ä»¶æœåŠ¡çš„äºŒçº§åŸŸå</p><table><thead><tr><th align="left">Java<br><code>   </code>server {<br><code>        </code>listen       80;<br><code>        </code>server_name  file.xuecheng-plus.com;<br>        â€¦.</th></tr></thead></table><h2 id="è®¤è¯æˆæƒæ¨¡å—"><a href="#è®¤è¯æˆæƒæ¨¡å—" class="headerlink" title="è®¤è¯æˆæƒæ¨¡å—"></a>è®¤è¯æˆæƒæ¨¡å—</h2><p><strong>3.3.1 è®¤è¯æµç¨‹</strong></p><p>ä¸‹å›¾æ˜¯æœ¬é¡¹ç›®çš„è®¤è¯æµç¨‹ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.029.png"></p><p>1ã€æä¾›ç»Ÿä¸€è®¤è¯å…¥å£ã€‚</p><p>2ã€å‰ç«¯è¯·æ±‚è®¤è¯ï¼Œè®¤è¯é€šè¿‡é¢å‘jwtä»¤ç‰Œè¿”ç»™å‰ç«¯</p><p>3ã€å‰ç«¯æºå¸¦jwtä»¤ç‰Œé€šè¿‡ç½‘å…³è®¿é—®å¾®æœåŠ¡ã€‚</p><p>4ã€ç½‘å…³è´Ÿè´£æ ¡éªŒjwtä»¤ç‰Œçš„åˆæ³•æ€§ï¼Œå¾®æœåŠ¡è´Ÿè´£è¿›è¡Œæˆæƒã€‚</p><p><strong>3.3.2 ç½‘å…³ç»Ÿä¸€é‰´æƒåšä»€ä¹ˆ?</strong></p><p>æ‰€æœ‰è®¿é—®å¾®æœåŠ¡çš„è¯·æ±‚éƒ½è¦ç»è¿‡ç½‘å…³ï¼Œåœ¨ç½‘å…³è¿›è¡Œç”¨æˆ·èº«ä»½çš„è®¤è¯å¯ä»¥å°†å¾ˆå¤šéæ³•çš„è¯·æ±‚æ‹¦æˆªåˆ°å¾®æœåŠ¡ä»¥å¤–ï¼Œè¿™å«åšç½‘å…³é‰´æƒã€‚</p><p>ä¸‹è¾¹éœ€è¦æ˜ç¡®ç½‘å…³é‰´æƒçš„èŒè´£ï¼š</p><p>1ã€ç½‘ç«™ç™½åå•ç»´æŠ¤</p><p>é’ˆå¯¹ä¸ç”¨è®¤è¯çš„URLå…¨éƒ¨æ”¾è¡Œã€‚</p><p>2ã€æ ¡éªŒjwtçš„åˆæ³•æ€§ã€‚</p><p>é™¤äº†ç™½åå•å‰©ä¸‹çš„å°±æ˜¯éœ€è¦è®¤è¯çš„è¯·æ±‚ï¼Œç½‘å…³éœ€è¦éªŒè¯jwtçš„åˆæ³•æ€§ï¼Œjwtåˆæ³•åˆ™è¯´æ˜ç”¨æˆ·èº«ä»½åˆæ³•ï¼Œå¦åˆ™è¯´æ˜èº«ä»½ä¸åˆæ³•åˆ™æ‹’ç»ç»§ç»­è®¿é—®ã€‚</p><p>3ã€ç½‘å…³ä¸è´Ÿè´£æˆæƒï¼Œæˆæƒåœ¨å„ä¸ªå¾®æœåŠ¡è¿›è¡Œï¼Œå› ä¸ºå¾®æœåŠ¡æœ€æ¸…æ¥šç”¨æˆ·æœ‰å“ªäº›æƒé™è®¿é—®å“ªäº›æ¥å£ã€‚</p><p><strong>3.3.3 ä»€ä¹ˆæ˜¯OAuth2</strong></p><p>OAUTHåè®®ä¸ºç”¨æˆ·èµ„æºçš„æˆæƒæä¾›äº†ä¸€ä¸ªå®‰å…¨çš„ã€å¼€æ”¾è€Œåˆç®€æ˜“çš„æ ‡å‡†ï¼ŒOauthåè®®ç›®å‰å‘å±•åˆ°2.0ç‰ˆæœ¬ï¼Œ1.0ç‰ˆæœ¬è¿‡äºå¤æ‚ï¼Œ2.0ç‰ˆæœ¬å·²å¾—åˆ°å¹¿æ³›åº”ç”¨ï¼Œé€šå¸¸ä¸€äº›å¤§å¹³å°å¦‚å¾®ä¿¡ã€æ”¯ä»˜å®éƒ½æä¾›OAuth2åè®®çš„è®¤è¯æˆæƒæ¥å£ã€‚</p><p>ç†è§£OAuth2åè®®å¯ä»¥é€šè¿‡ä¸€ä¸ªä¾‹å­ï¼Œè¿™é‡Œä»¥å¾®ä¿¡æ‰«ç ç™»å½•é»‘é©¬ç½‘ç«™ä¸ºä¾‹è¯´æ˜ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.030.png"></p><p>Oauth2.0è®¤è¯æµç¨‹å¦‚ä¸‹ï¼š</p><p>å¼•è‡ªOauth2.0åè®®rfc6749 <a href="https://tools.ietf.org/html/rfc6749">https://tools.ietf.org/html/rfc6749</a></p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.031.png"></p><p>Oauth2åŒ…æ‹¬ä»¥ä¸‹è§’è‰²ï¼š</p><p>1ã€å®¢æˆ·ç«¯</p><p>æœ¬èº«ä¸å­˜å‚¨èµ„æºï¼Œéœ€è¦é€šè¿‡èµ„æºæ‹¥æœ‰è€…çš„æˆæƒå»è¯·æ±‚èµ„æºæœåŠ¡å™¨çš„èµ„æºï¼Œæ¯”å¦‚ï¼šæ‰‹æœºå®¢æˆ·ç«¯ã€æµè§ˆå™¨ç­‰ã€‚</p><p>ä¸Šè¾¹ç¤ºä¾‹ä¸­é»‘é©¬ç½‘ç«™å³ä¸ºå®¢æˆ·ç«¯ï¼Œå®ƒéœ€è¦é€šè¿‡æµè§ˆå™¨æ‰“å¼€ã€‚</p><p>2ã€èµ„æºæ‹¥æœ‰è€…</p><p>é€šå¸¸ä¸ºç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥æ˜¯åº”ç”¨ç¨‹åºï¼Œå³è¯¥èµ„æºçš„æ‹¥æœ‰è€…ã€‚</p><p>Aè¡¨ç¤º å®¢æˆ·ç«¯è¯·æ±‚èµ„æºæ‹¥æœ‰è€…æˆæƒã€‚</p><p>Bè¡¨ç¤º èµ„æºæ‹¥æœ‰è€…æˆæƒå®¢æˆ·ç«¯å³é»‘é©¬ç½‘ç«™è®¿é—®è‡ªå·±çš„ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>3ã€æˆæƒæœåŠ¡å™¨ï¼ˆä¹Ÿç§°è®¤è¯æœåŠ¡å™¨ï¼‰</p><p>è®¤è¯æœåŠ¡å™¨å¯¹èµ„æºæ‹¥æœ‰è€…è¿›è¡Œè®¤è¯ï¼Œè¿˜ä¼šå¯¹å®¢æˆ·ç«¯è¿›è¡Œè®¤è¯å¹¶é¢å‘ä»¤ç‰Œã€‚</p><p>C å®¢æˆ·ç«¯å³é»‘é©¬ç½‘ç«™æºå¸¦æˆæƒç è¯·æ±‚è®¤è¯ã€‚</p><p>Dè®¤è¯é€šè¿‡é¢å‘ä»¤ç‰Œã€‚</p><p>4ã€èµ„æºæœåŠ¡å™¨</p><p>å­˜å‚¨èµ„æºçš„æœåŠ¡å™¨ã€‚</p><p>Eè¡¨ç¤ºå®¢æˆ·ç«¯å³é»‘é©¬ç½‘ç«™æºå¸¦ä»¤ç‰Œè¯·æ±‚èµ„æºæœåŠ¡å™¨è·å–èµ„æºã€‚</p><p>Fè¡¨ç¤ºèµ„æºæœåŠ¡å™¨æ ¡éªŒä»¤ç‰Œé€šè¿‡åæä¾›å—ä¿æŠ¤èµ„æºã€‚</p><p><strong>3.3.2 å¾®ä¿¡æ‰«ç æµç¨‹</strong></p><p>æ ¹æ®OAuth2åè®®æˆæƒç æµç¨‹ï¼Œç»“åˆæœ¬é¡¹ç›®è‡ªèº«ç‰¹ç‚¹ï¼Œåˆ†ææ¥å…¥å¾®ä¿¡æ‰«ç ç™»å½•çš„æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.032.png"></p><p>æœ¬é¡¹ç›®è®¤è¯æœåŠ¡éœ€è¦åšå“ªäº›äº‹ï¼Ÿ</p><p>1ã€éœ€è¦å®šä¹‰æ¥å£æ¥æ”¶å¾®ä¿¡ä¸‹å‘çš„æˆæƒç ã€‚</p><p>2ã€æ”¶åˆ°æˆæƒç è°ƒç”¨å¾®ä¿¡æ¥å£ç”³è¯·ä»¤ç‰Œã€‚</p><p>3ã€ç”³è¯·åˆ°ä»¤ç‰Œè°ƒç”¨å¾®ä¿¡è·å–ç”¨æˆ·ä¿¡æ¯</p><p>4ã€è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸå°†å…¶å†™å…¥æœ¬é¡¹ç›®ç”¨æˆ·ä¸­å¿ƒæ•°æ®åº“ã€‚</p><p>5ã€æœ€åé‡å®šå‘åˆ°æµè§ˆå™¨è‡ªåŠ¨ç™»å½•ã€‚</p><p><strong>3.3.3 æˆæƒç›¸å…³çš„æ•°æ®æ¨¡å‹</strong></p><p>æœ¬é¡¹ç›®æˆæƒç›¸å…³çš„æ•°æ®è¡¨å¦‚ä¸‹ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.033.png"></p><p>è¯´æ˜å¦‚ä¸‹ï¼š</p><p>xc_userï¼šç”¨æˆ·è¡¨ï¼Œå­˜å‚¨äº†ç³»ç»Ÿç”¨æˆ·ä¿¡æ¯ï¼Œç”¨æˆ·ç±»å‹åŒ…æ‹¬ï¼šå­¦ç”Ÿã€è€å¸ˆã€ç®¡ç†å‘˜ç­‰</p><p>xc_roleï¼šè§’è‰²è¡¨ï¼Œå­˜å‚¨äº†ç³»ç»Ÿçš„è§’è‰²ä¿¡æ¯ï¼Œå­¦ç”Ÿã€è€å¸ˆã€æ•™å­¦ç®¡ç†å‘˜ã€ç³»ç»Ÿç®¡ç†å‘˜ç­‰ã€‚</p><p>xc_user_roleï¼šç”¨æˆ·è§’è‰²è¡¨ï¼Œä¸€ä¸ªç”¨æˆ·å¯æ‹¥æœ‰å¤šä¸ªè§’è‰²ï¼Œä¸€ä¸ªè§’è‰²å¯è¢«å¤šä¸ªç”¨æˆ·æ‰€æ‹¥æœ‰</p><p>xc_menu:æ¨¡å—è¡¨ï¼Œè®°å½•äº†èœå•åŠèœå•ä¸‹çš„æƒé™</p><p>xc_permission:è§’è‰²æƒé™è¡¨ï¼Œä¸€ä¸ªè§’è‰²å¯æ‹¥æœ‰å¤šä¸ªæƒé™ï¼Œä¸€ä¸ªæƒé™å¯è¢«å¤šä¸ªè§’è‰²æ‰€æ‹¥æœ‰</p><p>å¦‚ä½•æŸ¥è¯¢ç”¨æˆ·çš„æƒé™ï¼Ÿ</p><table><thead><tr><th align="left">Java<br>SELECT * FROM xc_menu WHERE id IN(<br><code>    </code>SELECT menu_id FROM xc_permission WHERE role_id IN(<br><code>        </code>SELECT role_id FROM xc_user_role WHERE user_id &#x3D; â€˜49â€™<br><code>    </code>)<br>)</th></tr></thead></table><p><strong>3.3.4 éªŒè¯ç æ ¡éªŒæµç¨‹</strong></p><p>éªŒè¯ç æœåŠ¡å¯¹å¤–æä¾›çš„æ¥å£æœ‰ï¼š</p><p>1ã€ç”ŸæˆéªŒè¯ç </p><p>2ã€æ ¡éªŒéªŒè¯ç ã€‚</p><p>éªŒè¯ç æœåŠ¡å¦‚ä½•ç”Ÿæˆå¹¶æ ¡éªŒéªŒè¯ç ï¼Ÿ</p><p>æ‹¿å›¾ç‰‡éªŒè¯ç ä¸¾ä¾‹ï¼š</p><p>1ã€å…ˆç”Ÿæˆä¸€ä¸ªæŒ‡å®šä½æ•°çš„éªŒè¯ç ï¼Œæ ¹æ®éœ€è¦å¯èƒ½æ˜¯æ•°å­—ã€æ•°å­—å­—æ¯ç»„åˆæˆ–æ–‡å­—ã€‚</p><p>2ã€æ ¹æ®ç”Ÿæˆçš„éªŒè¯ç ç”Ÿæˆä¸€ä¸ªå›¾ç‰‡å¹¶è¿”å›ç»™é¡µé¢</p><p>3ã€ç»™ç”Ÿæˆçš„éªŒè¯ç åˆ†é…ä¸€ä¸ªkeyï¼Œå°†keyå’ŒéªŒè¯ç ä¸€åŒå­˜å…¥ç¼“å­˜ã€‚è¿™ä¸ªkeyå’Œå›¾ç‰‡ä¸€åŒè¿”å›ç»™é¡µé¢ã€‚</p><p>4ã€ç”¨æˆ·è¾“å…¥éªŒè¯ç ï¼Œè¿åŒkeyä¸€åŒæäº¤è‡³è®¤è¯æœåŠ¡ã€‚</p><p>5ã€è®¤è¯æœåŠ¡æ‹¿keyå’Œè¾“å…¥çš„éªŒè¯ç è¯·æ±‚éªŒè¯ç æœåŠ¡å»æ ¡éªŒ</p><p>6ã€éªŒè¯ç æœåŠ¡æ ¹æ®keyä»ç¼“å­˜å–å‡ºæ­£ç¡®çš„éªŒè¯ç å’Œç”¨æˆ·è¾“å…¥çš„éªŒè¯ç è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœç›¸åŒåˆ™æ ¡éªŒé€šè¿‡ï¼Œå¦åˆ™ä¸é€šè¿‡ã€‚</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.034.png"></p><p><strong>3.3.5 ä»€ä¹ˆæ˜¯JWTä»¤ç‰Œ</strong></p><p>JSON Web Tokenï¼ˆJWTï¼‰æ˜¯ä¸€ç§ä½¿ç”¨JSONæ ¼å¼ä¼ é€’æ•°æ®çš„ç½‘ç»œä»¤ç‰ŒæŠ€æœ¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼€æ”¾çš„è¡Œä¸šæ ‡å‡†ï¼ˆRFC 7519ï¼‰ï¼Œç”¨äºåœ¨é€šä¿¡åŒæ–¹ä¼ é€’jsonå¯¹è±¡ï¼Œä¼ é€’çš„ä¿¡æ¯ç»è¿‡æ•°å­—ç­¾åå¯ä»¥è¢«éªŒè¯å’Œä¿¡ä»»ï¼Œå®ƒå¯ä»¥ä½¿ç”¨HMACç®—æ³•æˆ–ä½¿ç”¨RSAçš„å…¬é’¥&#x2F;ç§é’¥å¯¹æ¥ç­¾åï¼Œé˜²æ­¢å†…å®¹ç¯¡æ”¹ã€‚</p><p>JWTä»¤ç‰Œçš„ä¼˜ç‚¹ï¼š</p><p>1ã€jwtåŸºäºjsonï¼Œéå¸¸æ–¹ä¾¿è§£æã€‚</p><p>2ã€å¯ä»¥åœ¨ä»¤ç‰Œä¸­è‡ªå®šä¹‰ä¸°å¯Œçš„å†…å®¹ï¼Œæ˜“æ‰©å±•ã€‚</p><p>3ã€é€šè¿‡éå¯¹ç§°åŠ å¯†ç®—æ³•åŠæ•°å­—ç­¾åæŠ€æœ¯ï¼ŒJWTé˜²æ­¢ç¯¡æ”¹ï¼Œå®‰å…¨æ€§é«˜ã€‚</p><p>4ã€èµ„æºæœåŠ¡ä½¿ç”¨JWTå¯ä¸ä¾èµ–è®¤è¯æœåŠ¡å³å¯å®Œæˆæˆæƒã€‚</p><p>ç¼ºç‚¹ï¼š</p><p>ï¼‘ã€JWTä»¤ç‰Œè¾ƒé•¿ï¼Œå å­˜å‚¨ç©ºé—´æ¯”è¾ƒå¤§ã€‚</p><p>JWTä»¤ç‰Œç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œæ¯éƒ¨åˆ†ä¸­é—´ä½¿ç”¨ç‚¹ï¼ˆ.ï¼‰åˆ†éš”ï¼Œæ¯”å¦‚ï¼šxxxxx.yyyyy.zzzzz</p><ol><li><p>Header        </p><p><code>  </code>å¤´éƒ¨åŒ…æ‹¬ä»¤ç‰Œçš„ç±»å‹ï¼ˆå³JWTï¼‰åŠä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ï¼ˆå¦‚HMAC SHA256æˆ–RSAï¼‰</p></li><li><p><code> </code>Payload</p><p><code>  </code>ç¬¬äºŒéƒ¨åˆ†æ˜¯è´Ÿè½½ï¼Œå†…å®¹ä¹Ÿæ˜¯ä¸€ä¸ªjsonå¯¹è±¡ï¼Œå®ƒæ˜¯å­˜æ”¾æœ‰æ•ˆä¿¡æ¯çš„åœ°æ–¹ï¼Œå®ƒå¯ä»¥å­˜æ”¾jwtæä¾›çš„ç°æˆå­—æ®µï¼Œæ¯”å¦‚ï¼šissï¼ˆç­¾å‘è€…ï¼‰,expï¼ˆè¿‡æœŸæ—¶é—´æˆ³ï¼‰, subï¼ˆé¢å‘çš„ç”¨æˆ·ï¼‰ç­‰ï¼Œä¹Ÿå¯è‡ªå®šä¹‰å­—æ®µã€‚</p></li><li><p><code> </code>Signature</p><p><code>  </code>ç¬¬ä¸‰éƒ¨åˆ†æ˜¯ç­¾åï¼Œæ­¤éƒ¨åˆ†ç”¨äºé˜²æ­¢jwtå†…å®¹è¢«ç¯¡æ”¹ã€‚</p><p><code>  </code>è¿™ä¸ªéƒ¨åˆ†ä½¿ç”¨base64urlå°†å‰ä¸¤éƒ¨åˆ†è¿›è¡Œç¼–ç ï¼Œç¼–ç åä½¿ç”¨ç‚¹ï¼ˆ.ï¼‰è¿æ¥ç»„æˆå­—ç¬¦ä¸²ï¼Œæœ€åä½¿ç”¨headerä¸­å£°æ˜ç­¾åç®—æ³•è¿›è¡Œç­¾åã€‚</p><p><strong>3.3.6 JWTä»¤ç‰Œå¯ä»¥é˜²æ­¢ç¯¡æ”¹å—ï¼Ÿ</strong></p><p>JWTå¯ä»¥é˜²æ­¢ç¯¡æ”¹ã€‚</p><p>ç¬¬ä¸‰éƒ¨åˆ†ä½¿ç”¨ç­¾åç®—æ³•å¯¹ç¬¬ä¸€éƒ¨åˆ†å’Œç¬¬äºŒéƒ¨åˆ†çš„å†…å®¹è¿›è¡Œç­¾åï¼Œå¸¸ç”¨çš„ç­¾åç®—æ³•æ˜¯ HS256ï¼Œå¸¸è§çš„è¿˜æœ‰md5,sha ç­‰ï¼Œç­¾åç®—æ³•éœ€è¦ä½¿ç”¨å¯†é’¥è¿›è¡Œç­¾åï¼Œå¯†é’¥ä¸å¯¹å¤–å…¬å¼€ï¼Œå¹¶ä¸”ç­¾åæ˜¯ä¸å¯é€†çš„ï¼Œå¦‚æœç¬¬ä¸‰æ–¹æ›´æ”¹äº†å†…å®¹é‚£ä¹ˆæœåŠ¡å™¨éªŒè¯ç­¾åå°±ä¼šå¤±è´¥ï¼Œè¦æƒ³ä¿è¯éªŒè¯ç­¾åæ­£ç¡®å¿…é¡»ä¿è¯å†…å®¹ã€å¯†é’¥ä¸ç­¾åå‰ä¸€è‡´ã€‚</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.035.png"></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºè®¤è¯æœåŠ¡å’Œèµ„æºæœåŠ¡ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ï¼Œè¿™å«å¯¹ç§°åŠ å¯†ï¼Œå¯¹ç§°åŠ å¯†æ•ˆç‡é«˜ï¼Œå¦‚æœä¸€æ—¦å¯†é’¥æ³„éœ²å¯ä»¥ä¼ªé€ jwtä»¤ç‰Œã€‚</p><p>JWTè¿˜å¯ä»¥ä½¿ç”¨éå¯¹ç§°åŠ å¯†ï¼Œè®¤è¯æœåŠ¡è‡ªå·±ä¿ç•™ç§é’¥ï¼Œå°†å…¬é’¥ä¸‹å‘ç»™å—ä¿¡ä»»çš„å®¢æˆ·ç«¯ã€èµ„æºæœåŠ¡ï¼Œå…¬é’¥å’Œç§é’¥æ˜¯é…å¯¹çš„ï¼Œæˆå¯¹çš„å…¬é’¥å’Œç§é’¥æ‰å¯ä»¥æ­£å¸¸åŠ å¯†å’Œè§£å¯†ï¼Œéå¯¹ç§°åŠ å¯†æ•ˆç‡ä½ä½†ç›¸æ¯”å¯¹ç§°åŠ å¯†éå¯¹ç§°åŠ å¯†æ›´å®‰å…¨ä¸€äº›ã€‚</p><p><strong>3.3.7 Spring Securityçš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆ?</strong></p><p>Spring Securityæ‰€è§£å†³çš„é—®é¢˜å°±æ˜¯<strong>å®‰å…¨è®¿é—®æ§åˆ¶</strong>ï¼Œåˆå§‹åŒ–Spring Securityæ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªåä¸ºSpringSecurityFilterChainçš„Servletè¿‡æ»¤å™¨ï¼Œ å®ƒæ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼Œè´¦å·å¯†ç ç™»å½•æ–¹å¼ä½¿ç”¨UsernamePasswordAuthenticationFilterè¿‡æ»¤å™¨ã€‚</p><p>Spring Securityçš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.036.png"></p></li><li><p>ç”¨æˆ·æäº¤ç”¨æˆ·åã€å¯†ç è¢«SecurityFilterChainä¸­çš„UsernamePasswordAuthenticationFilterè¿‡æ»¤å™¨è·å–åˆ°ï¼Œå°è£…ä¸ºè¯·æ±‚Authenticationï¼Œé€šå¸¸æƒ…å†µä¸‹æ˜¯UsernamePasswordAuthenticationTokenè¿™ä¸ªå®ç°ç±»ã€‚</p></li><li><p>ç„¶åè¿‡æ»¤å™¨å°†Authenticationæäº¤è‡³è®¤è¯ç®¡ç†å™¨ï¼ˆAuthenticationManagerï¼‰è¿›è¡Œè®¤è¯</p></li><li><p>è®¤è¯æˆåŠŸåï¼ŒAuthenticationManagerèº«ä»½ç®¡ç†å™¨è¿”å›ä¸€ä¸ªè¢«å¡«å……æ»¡äº†ä¿¡æ¯çš„ï¼ˆåŒ…æ‹¬ä¸Šé¢æåˆ°çš„æƒé™ä¿¡æ¯ï¼Œèº«ä»½ä¿¡æ¯ï¼Œç»†èŠ‚ä¿¡æ¯ï¼Œä½†å¯†ç é€šå¸¸ä¼šè¢«ç§»é™¤ï¼‰Authenticationå®ä¾‹ã€‚</p></li><li><p>SecurityContextHolderå®‰å…¨ä¸Šä¸‹æ–‡å®¹å™¨å°†ç¬¬3æ­¥å¡«å……äº†ä¿¡æ¯çš„Authenticationï¼Œé€šè¿‡SecurityContextHolder.getContext().setAuthentication(â€¦)æ–¹æ³•ï¼Œè®¾ç½®åˆ°å…¶ä¸­ã€‚</p></li><li><p><code>        </code>å¯ä»¥çœ‹å‡ºAuthenticationManageræ¥å£ï¼ˆè®¤è¯ç®¡ç†å™¨ï¼‰æ˜¯è®¤è¯ç›¸å…³çš„æ ¸å¿ƒæ¥å£ï¼Œä¹Ÿæ˜¯å‘èµ·è®¤è¯çš„å‡ºå‘ç‚¹ï¼Œå®ƒçš„å®ç°ç±»ä¸ºProviderManagerã€‚è€ŒSpring Securityæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼Œå› æ­¤ProviderManagerç»´æŠ¤ç€ä¸€ä¸ªList<AuthenticationProvider>åˆ—è¡¨ï¼Œå­˜æ”¾å¤šç§è®¤è¯æ–¹å¼ï¼Œæœ€ç»ˆå®é™…çš„è®¤è¯å·¥ä½œæ˜¯ç”±AuthenticationProviderå®Œæˆçš„ã€‚å’±ä»¬çŸ¥é“webè¡¨å•çš„å¯¹åº”çš„AuthenticationProviderå®ç°ç±»ä¸ºDaoAuthenticationProviderï¼Œå®ƒçš„å†…éƒ¨åˆç»´æŠ¤ç€ä¸€ä¸ªUserDetailsServiceè´Ÿè´£UserDetailsçš„è·å–ã€‚æœ€ç»ˆAuthenticationProviderå°†UserDetailså¡«å……è‡³Authenticationã€‚</p><h2 id="é€‰è¯¾å­¦ä¹ "><a href="#é€‰è¯¾å­¦ä¹ " class="headerlink" title="é€‰è¯¾å­¦ä¹ "></a>é€‰è¯¾å­¦ä¹ </h2><p><strong>3.4.1 é€‰è¯¾æµç¨‹</strong></p><p>é€‰è¯¾æ˜¯å°†è¯¾ç¨‹åŠ å…¥æˆ‘çš„è¯¾ç¨‹è¡¨çš„è¿‡ç¨‹ã€‚</p><p>å¯¹å…è´¹è¯¾ç¨‹é€‰è¯¾åå¯ç›´æ¥åŠ å…¥æˆ‘çš„è¯¾ç¨‹è¡¨ï¼Œå¯¹æ”¶è´¹è¯¾ç¨‹é€‰è¯¾åéœ€è¦ä¸‹å•æ”¯ä»˜æˆåŠŸç³»ç»Ÿè‡ªåŠ¨åŠ å…¥æˆ‘çš„è¯¾ç¨‹è¡¨ã€‚</p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.037.png"></p><p><strong>3.4.2 åœ¨çº¿å­¦ä¹ æµç¨‹</strong></p><p>è¯¾æˆåŠŸç”¨æˆ·ä½¿å¯ä»¥åœ¨çº¿å­¦ä¹ ï¼Œå¯¹äºå…è´¹è¯¾ç¨‹æ— éœ€é€‰è¯¾å³å¯åœ¨çº¿å­¦ä¹ ã€‚</p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.038.png"></p><p><strong>3.4.3 å…è´¹è¯¾ç¨‹ç»­æœŸæµç¨‹</strong></p><p>å…è´¹è¯¾ç¨‹åŠ å…¥æˆ‘çš„è¯¾ç¨‹è¡¨é»˜è®¤ä¸º1å¹´æœ‰æ•ˆæœŸï¼Œåˆ°æœŸç”¨æˆ·å¯ç”³è¯·ç»­æœŸï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.039.png"></p><h2 id="è®¢å•æ”¯ä»˜"><a href="#è®¢å•æ”¯ä»˜" class="headerlink" title="è®¢å•æ”¯ä»˜"></a>è®¢å•æ”¯ä»˜</h2><p><strong>3.5.1 æ”¯ä»˜æµç¨‹</strong></p><p>å½“ç”¨æˆ·ç‚¹å‡»â€œå¾®ä¿¡æ”¯ä»˜â€æˆ–æ”¯ä»˜å®æ”¯ä»˜æ—¶æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.040.png"></p><p>1ã€è¯·æ±‚å­¦ä¹ ä¸­å¿ƒæœåŠ¡åˆ›å»ºé€‰è¯¾è®°å½•</p><p>2ã€è¯·æ±‚è®¢å•æœåŠ¡åˆ›å»ºå•†å“è®¢å•ã€ç”Ÿæˆæ”¯ä»˜äºŒç»´ç ã€‚</p><p>3ã€ç”¨æˆ·æ‰«ç è¯·æ±‚è®¢å•æ”¯ä»˜æœåŠ¡ï¼Œè®¢å•æ”¯ä»˜æœåŠ¡è¯·æ±‚ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°ç”Ÿæˆæ”¯ä»˜è®¢å•ã€‚</p><p>4ã€å‰ç«¯å”¤èµ·æ”¯ä»˜å®¢æˆ·ç«¯ï¼Œç”¨æˆ·è¾“å…¥å¯†ç å®Œæˆæ”¯ä»˜ã€‚</p><p>5ã€ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°æ”¯ä»˜å®Œæˆå‘èµ·æ”¯ä»˜é€šçŸ¥ã€‚</p><p>6ã€è®¢å•æ”¯ä»˜æœåŠ¡æ¥æ”¶æ”¯ä»˜é€šçŸ¥ç»“æœã€‚</p><p>7ã€ç”¨æˆ·åœ¨å‰ç«¯æŸ¥è¯¢æ”¯ä»˜ç»“æœï¼Œè¯·æ±‚è®¢å•æ”¯ä»˜æœåŠ¡æŸ¥è¯¢æ”¯ä»˜ç»“æœï¼Œå¦‚æœè®¢å•æ”¯ä»˜æœåŠ¡è¿˜æ²¡æœ‰æ”¶åˆ°æ”¯ä»˜ç»“æœåˆ™è¯·æ±‚å­¦ä¹ ä¸­å¿ƒæŸ¥è¯¢æ”¯ä»˜ç»“æœã€‚</p><p>8ã€è®¢å•æ”¯ä»˜æœåŠ¡å‘å­¦ä¹ ä¸­å¿ƒæœåŠ¡é€šçŸ¥æ”¯ä»˜ç»“æœã€‚</p><p>9ã€å­¦ä¹ ä¸­å¿ƒæœåŠ¡æ”¶åˆ°æ”¯ä»˜ç»“æœï¼Œå¦‚æœæ”¯ä»˜æˆåŠŸåˆ™æ›´æ–°é€‰è¯¾è®°å½•ï¼Œå¹¶æ·»åŠ åˆ°æˆ‘çš„è¯¾ç¨‹è¡¨ã€‚</p><p><strong>3.5.2 ç”ŸæˆäºŒç»´ç æ‰§è¡Œæµç¨‹</strong></p><p>ç”ŸæˆäºŒç»´ç æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.041.png"></p><p>æ‰§è¡Œæµç¨‹ï¼š</p><p>1ã€å‰ç«¯è°ƒç”¨å­¦ä¹ ä¸­å¿ƒæœåŠ¡çš„æ·»åŠ é€‰è¯¾æ¥å£ã€‚</p><p>2ã€æ·»åŠ é€‰è¯¾æˆåŠŸè¯·æ±‚è®¢å•æœåŠ¡ç”Ÿæˆæ”¯ä»˜äºŒç»´ç æ¥å£ã€‚</p><p>3ã€ç”ŸæˆäºŒç»´ç æ¥å£ï¼šåˆ›å»ºå•†å“è®¢å•ã€ç”Ÿæˆæ”¯ä»˜äº¤æ˜“è®°å½•ã€ç”ŸæˆäºŒç»´ç ã€‚</p><p>4ã€å°†äºŒç»´ç è¿”å›åˆ°å‰ç«¯ï¼Œç”¨æˆ·æ‰«ç ã€‚</p><p><strong>3.5.3 ç”¨æˆ·æ‰«ç æ”¯ä»˜æµç¨‹</strong></p><p>ç”¨æˆ·æ‰«ç æ”¯ä»˜æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/../assets/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/Aspose.Words.47a7d76e-91f2-4c3e-b54a-929cdfaa0c47.042.png"></p><p><strong>3.5.4 æ”¯ä»˜ç»“æœé€šçŸ¥æµç¨‹</strong></p><p>è®¢å•æœåŠ¡ä½œä¸ºé€šç”¨æœåŠ¡åœ¨è®¢å•æ”¯ä»˜æˆåŠŸåéœ€è¦å°†æ”¯ä»˜ç»“æœé€šçŸ¥ç»™ä¸è®¢å•æœåŠ¡å¯¹æ¥çš„å…¶å®ƒå¾®æœåŠ¡ã€‚</p><p>ä¸ºäº†ä¿è¯é€šçŸ¥è¿‡ç¨‹çš„ç®€ä¾¿è¿˜è¦ä¿è¯æ¶ˆæ¯å…¨éƒ¨åˆ°è¾¾æ¶ˆè´¹æœåŠ¡ï¼Œé‡‡ç”¨å‘å¸ƒè®¢é˜…çš„æ–¹å¼é€šçŸ¥æ”¯ä»˜ç»“æœã€‚</p><p>å­¦ä¹ ä¸­å¿ƒæœåŠ¡ï¼šå¯¹æ”¶è´¹è¯¾ç¨‹é€‰è¯¾éœ€è¦æ”¯ä»˜ï¼Œä¸è®¢å•æœåŠ¡å¯¹æ¥å®Œæˆæ”¯ä»˜ã€‚</p><p>å­¦ä¹ èµ„æºæœåŠ¡ï¼šå¯¹æ”¶è´¹çš„å­¦ä¹ èµ„æ–™éœ€è¦è´­ä¹°åä¸‹è½½ï¼Œä¸è®¢å•æœåŠ¡å¯¹æ¥å®Œæˆæ”¯ä»˜ã€‚</p><p>è®¢å•æœåŠ¡å®Œæˆæ”¯ä»˜åå°†æ”¯ä»˜ç»“æœå‘ç»™æ¯ä¸€ä¸ªä¸è®¢å•æœåŠ¡å¯¹æ¥çš„å¾®æœåŠ¡ï¼Œè®¢å•æœåŠ¡å°†æ¶ˆæ¯å‘ç»™äº¤æ¢æœºï¼Œç”±äº¤æ¢æœºå¹¿æ’­æ¶ˆæ¯ï¼Œæ¯ä¸ªè®¢é˜…æ¶ˆæ¯çš„å¾®æœåŠ¡éƒ½å¯ä»¥æ¥æ”¶åˆ°æ”¯ä»˜ç»“æœ.</p><p>å¾®æœåŠ¡æ”¶åˆ°æ”¯ä»˜ç»“æœæ ¹æ®è®¢å•çš„ç±»å‹å»æ›´æ–°è‡ªå·±çš„ä¸šåŠ¡æ•°æ®ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å¸ƒéš†è¿‡æ»¤å™¨</title>
      <link href="/2024/03/01/Study-%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/"/>
      <url>/2024/03/01/Study-%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æ–‡ç« å‚è€ƒè‡ªï¼š</p><p><a href="https://juejin.cn/post/7221885350243139643">https://juejin.cn/post/7221885350243139643</a></p><p><a href="https://www.bilibili.com/video/BV192421T7JV/?spm_id_from=333.999.0.0&vd_source=fa7ba4ae353f08f1d08d1bb24528e96c">https://www.bilibili.com/video/BV192421T7JV/?spm_id_from=333.999.0.0&amp;vd_source=fa7ba4ae353f08f1d08d1bb24528e96c</a></p>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQLå‡½æ•°å­¦ä¹ </title>
      <link href="/2024/02/28/Work-SQL/"/>
      <url>/2024/02/28/Work-SQL/</url>
      
        <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>å·¥ä½œä¸­ç¢°åˆ°çš„sqlï¼Œä¸ç†Ÿç»ƒ</p><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://juejin.cn/post/7166554313803137054?searchId=20240228104719BDC66599EAB83DC1ADD3">https://juejin.cn/post/7166554313803137054?searchId=20240228104719BDC66599EAB83DC1ADD3</a></p><p>åœ¨MySQLä¸­ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„<code>FIND_IN_SET</code>å‡½æ•°æ¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ã€‚<code>FIND_IN_SET</code>å‡½æ•°å¯ä»¥åœ¨é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ä¸­æœç´¢æŒ‡å®šçš„å€¼ï¼Œå¹¶è¿”å›å…¶åœ¨å­—ç¬¦ä¸²ä¸­çš„ä½ç½®ã€‚å› æ­¤ï¼Œä½ å¯ä»¥å°†é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥ï¼Œç„¶åå°†å…¶æ‹†åˆ†æˆå•ä¸ªçš„å­—ç¬¦ä¸²ï¼Œç„¶åå°†æ¯ä¸ªå•ä¸ªçš„å­—ç¬¦ä¸²ä¸è¡¨ä¸­çš„åˆ—è¿›è¡Œæ¯”è¾ƒã€‚</p><p>ä¸‹é¢æ˜¯å¦‚ä½•åœ¨MySQLä¸­å®ç°ç±»ä¼¼çš„æ“ä½œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> GROUP_CONCAT(name) <span class="keyword">AS</span> names</span><br><span class="line"><span class="keyword">FROM</span> jy_dict</span><br><span class="line"><span class="keyword">WHERE</span> FIND_IN_SET(dictcode, #&#123;ids&#125;) <span class="operator">&gt;</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå‡è®¾ <code>#&#123;ids&#125;</code> æ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ <code>&#39;1,2,3,4&#39;</code>ã€‚<code>FIND_IN_SET</code> å‡½æ•°ä¼šæœç´¢ <code>dictcode</code> æ˜¯å¦åœ¨ <code>#&#123;ids&#125;</code> ä¸­ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œåˆ™è¿”å›å…¶åœ¨å­—ç¬¦ä¸²ä¸­çš„ä½ç½®ï¼ˆä» 1 å¼€å§‹ï¼‰ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œåˆ™è¿”å› 0ã€‚å› æ­¤ï¼Œ<code>FIND_IN_SET(dictcode, #&#123;ids&#125;) &gt; 0</code> æ¡ä»¶å°†åŒ¹é…åœ¨ <code>#&#123;ids&#125;</code> ä¸­çš„ä»»ä½• <code>dictcode</code>ã€‚</p><p>è¿™ç§æ–¹æ³•åœ¨MySQLä¸­å¯ä»¥å®ç°å°†é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²è½¬æ¢æˆå•ä¸ªçš„å€¼ï¼Œå¹¶åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨å®ƒä»¬ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Work </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®ä¹ æ”¶è·</title>
      <link href="/2024/02/03/Work-%E5%AE%9E%E4%B9%A0%E6%94%B6%E8%8E%B7/"/>
      <url>/2024/02/03/Work-%E5%AE%9E%E4%B9%A0%E6%94%B6%E8%8E%B7/</url>
      
        <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><h1 id="JasyptåŠ å¯†"><a href="#JasyptåŠ å¯†" class="headerlink" title="JasyptåŠ å¯†"></a>JasyptåŠ å¯†</h1><p>è¯¦ç»†æ–‡ç« é“¾æ¥ï¼š<a href="https://planbbbbb.github.io/2024/01/20/Work-Jasypt%E5%8A%A0%E5%AF%86/">https://planbbbbb.github.io/2024/01/20/Work-Jasypt%E5%8A%A0%E5%AF%86/</a></p><h1 id="åŠ¨æ€åŠ å¯†"><a href="#åŠ¨æ€åŠ å¯†" class="headerlink" title="åŠ¨æ€åŠ å¯†"></a>åŠ¨æ€åŠ å¯†</h1><p>åœ¨çœçº§SaaSå¹³å°ä¸Šå¤šä¸ªçœä»½ï¼Œæ¯ä¸ªä¸åŒçš„åœ°æ–¹å¯ä»¥æ ¹æ®è‡ªå·±çš„åŠ å¯†è§„åˆ™è¿›è¡ŒåŠ å¯†ä¼ è¾“</p><p>åŒç†ï¼Œåœ¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œæ ¹æ®ä¸åŒçœä»½çš„åŠ å¯†è§„åˆ™ï¼Œè¿›è¡Œè§£å¯†</p><h1 id="åˆ‡æ¢æ•°æ®æº"><a href="#åˆ‡æ¢æ•°æ®æº" class="headerlink" title="åˆ‡æ¢æ•°æ®æº"></a>åˆ‡æ¢æ•°æ®æº</h1><p>mybatis-flexè‡ªå¸¦çš„å¤šæ•°æ®æºï¼Œåœ¨çœçº§SaaSå¹³å°ä¸Šå¤šä¸ªçœä»½ï¼ˆå³å¤šä¸ªç§Ÿæˆ·ï¼‰ï¼Œå„ä¸ªçœä»½æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ•°æ®åº“æºï¼Œ</p><p>å…·ä½“æµç¨‹ï¼š</p><ol><li>åœ¨ymlæ–‡ä»¶ä¸­åªé…ç½®äº†ä¸€ä¸ªé»˜è®¤çš„æ•°æ®æºï¼Œå³publicSaaS_rescue</li><li>åœ¨ç¨‹åºå¯åŠ¨æ—¶è¿è¡Œinitæ–¹æ³•ï¼Œå»æŸ¥è¡¨ï¼Œè·å–æ‰€æœ‰ç§Ÿæˆ·çš„æ•°æ®æºä¿¡æ¯ï¼Œå¹¶å°†å…¶å­˜å…¥Mapä¸­ï¼Œkeyä¸ºæ•°æ®åº“å¯†ç ï¼Œå³md5_signï¼Œvalueä¸ºæ•°æ®åº“å</li><li>åœ¨ç™»å½•æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œå°†æ•°æ®æºçš„ä¿¡æ¯ä¼ å…¥ï¼Œå­˜åˆ°redisä¸­ï¼Œä¾›åç»­ä½¿ç”¨</li><li>åœ¨å…¶ä»–æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œåœ¨æ‹¦æˆªå™¨å¤„ä¼šä»redisé‡Œæ‰¾å‡ºå¯¹åº”çš„æ•°æ®æºä¿¡æ¯ï¼Œå¹¶åˆ‡æ¢æ•°æ®æº</li><li>åœ¨æœ¬æ¬¡æ–¹æ³•ç»“æŸåæ‹¦æˆªå™¨ä¼šæ¸…ç†threadlocalä¸”åˆ‡æ¢ä¸ºé»˜è®¤æ•°æ®æºï¼Œå³publicSaaS_rescue</li><li>é€€å‡ºç™»å½•æ—¶å°±æŠŠrediså¯¹åº”çš„æ•°æ®æºä¿¡æ¯åˆ å»</li></ol><h1 id="å®šæ—¶å™¨"><a href="#å®šæ—¶å™¨" class="headerlink" title="å®šæ—¶å™¨"></a>å®šæ—¶å™¨</h1><p>å®šæ—¶å™¨å¯ä»¥åœ¨æœ¬åœ°æ‰§è¡Œä¸€äº›éœ€è¦å®šæ—¶åšçš„ä»»åŠ¡ï¼Œä¾‹å¦‚æ¯5ç§’åœ¨æœ¬åœ°è°ƒç”¨ä¸€ä¸ªæ¥å£ç­‰ã€‚</p><blockquote><p>è¿™é‡ŒæŠŠåŸæœ¬éœ€è¦åŠ é”æ¥é˜²æ­¢çš„çº¿ç¨‹å®‰å…¨çš„é—®é¢˜è§£å†³äº†ï¼šè¿™ä¸ªå®šæ—¶å™¨æ¯äº”ç§’å°±ä¼šå»æ¶ˆæ¯è¡¨é‡ŒæŸ¥è¯¢å‡ºæ¥å¤±è´¥çš„ï¼Œä¿®æ”¹æ—¶é—´è¶…è¿‡ä¸‰åˆ†é’Ÿçš„ï¼Œä¸”å‘é€æ¬¡æ•°å°äºä¸‰æ¬¡çš„æ¶ˆæ¯åˆ—è¡¨æ•°æ®å‡ºæ¥ï¼Œç„¶ååœ¨è¿™ä¸ªå®šæ—¶å™¨ä¸­å»è¿›è¡Œè¿™äº›æ¶ˆæ¯çš„é‡å¤å‘é€ï¼›</p><p>ç„¶è€Œçº¿ç¨‹å®‰å…¨çš„é—®é¢˜å°±å‡ºç°åœ¨è¿™é‡Œäº†ï¼Œå› ä¸ºå»å‘é€äº†ä¸€æ¬¡postè¯·æ±‚ï¼Œå‡å¦‚æ—¶é—´å¾ˆé•¿ï¼Œé‚£ä¹ˆå¦‚æœè¶…è¿‡äº†äº”ç§’ï¼Œå› ä¸ºå®šæ—¶å™¨å†…æ˜¯å¼‚æ­¥çº¿ç¨‹å»å¤„ç†çš„ï¼Œæ‰€ä»¥ç­‰ä¸‹ä¸€æ¬¡äº”ç§’åï¼Œå®šæ—¶å™¨å†æ¬¡è§¦å‘ï¼Œæ­¤æ—¶å°±ä¼šé‡å¤è¯»åˆ°ç¬¬ä¸€æ¬¡å®šæ—¶å™¨æŸ¥è¯¢å‡ºæ¥çš„é‚£æ®µæ•°æ®åˆ—è¡¨ï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡å’Œè¿™ä¸€æ¬¡æŸ¥å‡ºæ¥çš„åˆ—è¡¨æ•°æ®å°±ä¼šå‡ºç°é‡å¤çš„ï¼Œæ¯•ç«Ÿæ•°æ®å¹¶æ²¡æœ‰å‘ç”Ÿä¿®æ”¹ï¼Œæ•…ä¿®æ”¹æ—¶é—´æ²¡æœ‰è¶…è¿‡ä¸‰åˆ†é’Ÿè¢«æŸ¥è¯¢äº†å‡ºæ¥ï¼Œé‚£ä¹ˆä¸¤æ¬¡åˆ†åˆ«çš„å¼‚æ­¥çº¿ç¨‹ï¼Œå°±å¾ˆæœ‰å¯èƒ½æ“ä½œäº†åŒä¸€ä¸ª<code>pushMsg</code>å¯¹è±¡ï¼Œå¯¼è‡´äº†å…¶æŸ¥è¯¢æ¬¡æ•°æ˜æ˜æ˜¯åŠ äºŒï¼Œå´å› ä¸ºçº¿ç¨‹ç«äº‰çš„é—®é¢˜å¯¼è‡´æŸ¥è¯¢æ¬¡æ•°åªåŠ äº†ä¸€ï¼Œæœ€åä¹Ÿåœ¨æ—¥å¿—ä¸­è¯å®äº†ç¡®å®å‘ç”Ÿäº†è¯¥é—®é¢˜ã€‚</p><p>ç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆå°±æ˜¯ç»™<code>pushMsg</code>å¯¹è±¡è¿›è¡ŒåŠ é”ï¼Œå³ä½¿ä¸‹ä¸€æ¬¡æŸ¥è¯¢å‡ºæ¥çš„ç›¸åŒçš„åˆ—è¡¨æ•°æ®ï¼Œä¹Ÿä¼šå› ä¸ºé”è€Œä¸ä¼šåŒæ—¶æ“ä½œè¯¥å¯¹è±¡ï¼Œè¿™æ ·å°±ä¿è¯äº†çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚</p><p>å¯æ˜¯è¿™æ ·çš„æ•ˆæœå¹¶ä¸å¥½ï¼Œè¿™æ ·é€ æˆäº†çº¿ç¨‹å¤§é‡çš„é˜»å¡ã€‚</p><p>ç¬¬äºŒç§æ–¹æ¡ˆæ˜¯åœ¨æŸ¥è¯¢å‡ºæ¥è¯¥åˆ—è¡¨æ•°æ®åï¼Œç«‹åˆ»æ‰¹é‡åœ°å¯¹è¿™äº›æ•°æ®è¿›è¡Œæ¬¡æ•°åŠ ä¸€ï¼Œç„¶åæ‰ç”¨å¼‚æ­¥çº¿ç¨‹å»å‘èµ·postè¯·æ±‚çš„è°ƒç”¨ï¼Œå› ä¸ºæ— è®ºpostè¯·æ±‚çš„æˆåŠŸä¸å¦ï¼Œè¿™æ¬¡è¯·æ±‚éƒ½æˆç«‹äº†ï¼Œæ•…å¯ä»¥ç›´æ¥æ‰¹é‡åŠ ä¸€ï¼Œè¿™æ ·å³ä½¿äº”ç§’åè¿™äº›åˆ—è¡¨æ•°æ®çš„å„ä¸ªå¼‚æ­¥çº¿ç¨‹å¹¶æ²¡æœ‰å¤„ç†å®Œè¿™äº›postè¯·æ±‚ï¼Œä¸‹ä¸€æ¬¡å®šæ—¶å™¨ä¹Ÿä¸ä¼šå†æŸ¥å‡ºç›¸åŒçš„æ•°æ®äº†ã€‚</p><p>è¿™ç¬¬äºŒç‚¹çš„æ–¹æ¡ˆå…¶å®å¹¶ä¸å®Œå…¨ä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œåœ¨æç«¯æƒ…å†µä¸‹ï¼Œå‡è®¾ç¬¬ä¸€æ¬¡å®šæ—¶å™¨æŸ¥å‡ºæ¥çš„æ•°æ®åˆ—è¡¨å¾ˆå¤šå¯¼è‡´è¿˜æ²¡æœ‰æ‰¹é‡åŠ ä¸€å®Œï¼Œç¬¬äºŒæ¬¡å®šæ—¶å™¨å°±å·²ç»è§¦å‘äº†ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°ä¸Šè¿°çš„é—®é¢˜ã€‚ä½†å…¶å®å¹¶ä¸ä¼šå‡ºç°æ”¹æç«¯æƒ…å†µï¼Œæ¯•ç«Ÿäº”ç§’å®šæ—¶å™¨ä¸€æ¬¡ï¼Œå¦‚æœä¸€ç›´è¿™æ ·ï¼Œé‚£ä¹ˆå¯ä»¥ç¡®å®šåœ°æ˜¯æ¯æ¬¡æŸ¥è¯¢å‡ºæ¥åœ°æ•°æ®åˆ—è¡¨ä¸ä¼šå¾ˆå¤šï¼Œä¹ŸåŸºæœ¬ä¿è¯äº†èƒ½åœ¨äº”ç§’å†…å®Œæˆæ‰¹é‡åŠ ä¸€æ“ä½œï¼Œé‚£ä¹ˆè¿™æ ·å°±<strong>é¿å…äº†ç›²ç›®çš„åŠ é”å¯¼è‡´çš„é—®é¢˜</strong>ã€‚</p></blockquote><p>ç‰ˆæœ¬ä¸€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scheduled(cron = &quot;*/5 * * * * ?&quot;)</span><span class="comment">//æ¯5ç§’æ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">pushMsg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">linux</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;os.name&quot;</span>).toLowerCase().contains(<span class="string">&quot;linux&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!linux) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;å®šæ—¶å™¨3&quot;</span>);</span><br><span class="line">        List&lt;PushMsg&gt; pushMsgList = iDataDao.getPushMsgList();</span><br><span class="line">        <span class="keyword">for</span> (PushMsg pushMsg : pushMsgList) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="comment">// æå‰ä¿®æ”¹è®¿é—®æ¬¡æ•°å’Œä¿®æ”¹æ—¶é—´ï¼Œé˜²æ­¢ä¸‹æ¬¡å®šæ—¶å™¨æŸ¥è¯¢å‡ºç›¸åŒçš„æ•°æ®</span></span><br><span class="line">                iDataDao.upPushMsgNum(pushMsg);</span><br><span class="line">                <span class="type">String</span> <span class="variable">curDate</span> <span class="operator">=</span> DateUtil.getCurDate();</span><br><span class="line">                SystemUtil.writeTxt(curDate + <span class="string">&quot;æ‰§è¡Œä¸ŠæŠ¥å¼‚æ­¥å¤„ç†&quot;</span>);</span><br><span class="line">                SystemUtil.writeTxt(curDate + <span class="string">&quot; &quot;</span> + pushMsg.getUrl_id() + <span class="string">&quot; &quot;</span> + pushMsg.getRequest());</span><br><span class="line">                <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> HttpUtil.doPost(pushMsg.getUrl(), pushMsg.getRequest());</span><br><span class="line">                pushMsg.setResponse(result);</span><br><span class="line">                SystemUtil.writeTxt(curDate + <span class="string">&quot; &quot;</span> + pushMsg.getUrl_id() + <span class="string">&quot; &quot;</span> + result);</span><br><span class="line"><span class="comment">//                int request_num = Integer.parseInt(pushMsg.getRequest_num());</span></span><br><span class="line"><span class="comment">//                pushMsg.setRequest_num(String.valueOf(request_num + 1));</span></span><br><span class="line"><span class="comment">//                pushMsg.setModified(DateUtil.getCurDate());</span></span><br><span class="line">                <span class="keyword">if</span> (result != <span class="literal">null</span> &amp;&amp; result.contains(<span class="string">&quot;200&quot;</span>) &amp;&amp; !result.contains(<span class="string">&quot;å¤±è´¥&quot;</span>)) &#123;</span><br><span class="line">                    pushMsg.setFlag(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                iDataDao.upPushMsg(pushMsg);</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç‰ˆæœ¬äºŒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scheduled(cron = &quot;*/5 * * * * ?&quot;)</span><span class="comment">//æ¯5ç§’æ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">pushMsg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">linux</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;os.name&quot;</span>).toLowerCase().contains(<span class="string">&quot;linux&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!linux) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;å®šæ—¶å™¨3&quot;</span>);</span><br><span class="line">        List&lt;PushMsg&gt; pushMsgList = iDataDao.getPushMsgList();</span><br><span class="line">        <span class="comment">// æå‰æ‰¹é‡ä¿®æ”¹è®¿é—®æ¬¡æ•°å’Œä¿®æ”¹æ—¶é—´ï¼Œé˜²æ­¢ä¸‹æ¬¡å®šæ—¶å™¨æŸ¥è¯¢å‡ºç›¸åŒçš„æ•°æ®</span></span><br><span class="line">        iDataDao.upPushMsgNum(pushMsgList);</span><br><span class="line">        <span class="keyword">for</span> (PushMsg pushMsg : pushMsgList) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">curDate</span> <span class="operator">=</span> DateUtil.getCurDate();</span><br><span class="line">                SystemUtil.writeTxt(curDate + <span class="string">&quot;æ‰§è¡Œä¸ŠæŠ¥å¼‚æ­¥å¤„ç†&quot;</span>);</span><br><span class="line">                SystemUtil.writeTxt(curDate + <span class="string">&quot; &quot;</span> + pushMsg.getUrl_id() + <span class="string">&quot; &quot;</span> + pushMsg.getRequest());</span><br><span class="line">                <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> HttpUtil.doPost(pushMsg.getUrl(), pushMsg.getRequest());</span><br><span class="line">                pushMsg.setResponse(result);</span><br><span class="line">                SystemUtil.writeTxt(curDate + <span class="string">&quot; &quot;</span> + pushMsg.getUrl_id() + <span class="string">&quot; &quot;</span> + result);</span><br><span class="line">                <span class="keyword">if</span> (result != <span class="literal">null</span> &amp;&amp; result.contains(<span class="string">&quot;200&quot;</span>) &amp;&amp; !result.contains(<span class="string">&quot;å¤±è´¥&quot;</span>)) &#123;</span><br><span class="line">                    pushMsg.setFlag(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                iDataDao.upPushMsg(pushMsg);</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1 id="Mybatisæ‹¦æˆªå™¨å’Œè‡ªå®šä¹‰åˆ†é¡µæ³¨è§£"><a href="#Mybatisæ‹¦æˆªå™¨å’Œè‡ªå®šä¹‰åˆ†é¡µæ³¨è§£" class="headerlink" title="Mybatisæ‹¦æˆªå™¨å’Œè‡ªå®šä¹‰åˆ†é¡µæ³¨è§£"></a>Mybatisæ‹¦æˆªå™¨å’Œè‡ªå®šä¹‰åˆ†é¡µæ³¨è§£</h1><p>é€šè¿‡è‡ªå®šä¹‰äº†ä¸€ä¸ªåˆ†é¡µæ³¨è§£ï¼Œåœ¨æ¯ä¸€ä¸ªéœ€è¦è¿›è¡Œåˆ†é¡µçš„mapperæ–¹æ³•ä¸Šæ·»åŠ ä¸Šè¿™ä¸ªæ³¨è§£ï¼Œè¿™æ ·åœ¨xmlé‡Œå°±ä¸ç”¨è‡ªå·±å†™limitè¯­å¥äº†ï¼Œé€šè¿‡mybatisçš„æ‹¦æˆªå™¨æ‹¦æˆªåˆ°é™¤å¢åˆ æ”¹å¤–çš„æŸ¥è¯­å¥ï¼Œå³åªä¼šå»å¯¹<code>SELECT</code>ç±»å‹çš„å»è¿›è¡Œåˆ¤æ–­ï¼Œè€Œä¸ä¼šå¯¹<code>INSERT</code>ï¼Œ<code>UPDATE</code>ï¼Œ<code>DELETE</code>ç±»å‹çš„è¯­å¥å»è¿›è¡Œsqlæ‹¼æ¥ã€‚</p><p>æ¯æ¬¡æŸ¥è¯¢çš„<strong>æœ‰åˆ†é¡µæ³¨è§£çš„</strong>è¯­å¥ï¼Œéƒ½ä¼šè¿›å…¥æ‹¦æˆªå™¨ï¼Œæ‹¦æˆªå™¨å»åšæ‹¼æ¥sqlï¼Œå»æŠŠå½“å‰sqlæ‰€æŸ¥è¯¢çš„æ¡æ•°å»è®°å½•åˆ°threadlocalä¸­ï¼Œæ–¹ä¾¿æŸ¥è¯¢åªåå†ç›´æ¥å–å‡ºæ¥å­˜æ”¾åˆ°voä¸­ã€‚</p><h1 id="TreeUtil"><a href="#TreeUtil" class="headerlink" title="TreeUtil"></a>TreeUtil</h1><p>å¯¹äºä¸€äº›è¿”å›çš„idï¼Œä»–ä»¬æœ‰å…¶å¯¹äºçš„çˆ¶idï¼Œç§°ä¸ºpidï¼ˆparentIdï¼‰ï¼Œä»–ä»¬ä½œä¸ºä¸€ä¸ªåˆ—è¡¨è¿”å›çš„æ—¶å€™ï¼Œå¯ä»¥æ ¹æ®ä»–ä»¬å¯¹åº”çš„å…³ç³»è¿›è¡Œç±»ä¼¼äºæ ‘çŠ¶çš„å±•ç¤ºã€‚</p><h1 id="è‡ªå®šä¹‰æ³¨è§£è¿›è¡Œæ ¡éªŒå­—æ®µåˆæ³•æ€§"><a href="#è‡ªå®šä¹‰æ³¨è§£è¿›è¡Œæ ¡éªŒå­—æ®µåˆæ³•æ€§" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£è¿›è¡Œæ ¡éªŒå­—æ®µåˆæ³•æ€§"></a>è‡ªå®šä¹‰æ³¨è§£è¿›è¡Œæ ¡éªŒå­—æ®µåˆæ³•æ€§</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> VerifyField &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦å…è®¸ä¸ä¸ºç©º</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isNotNull</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦æ˜¯æ•°å€¼ç±»å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">fieldType</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é»˜è®¤æ•°é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">num</span><span class="params">()</span> <span class="keyword">default</span> -<span class="number">99</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‹¼æ¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">joint</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>é€šè¿‡AOPçš„åˆ‡é¢æ‰¾åˆ°postè¯·æ±‚ï¼Œæ­¤æ—¶é€šè¿‡åå°„å»æ‹¿åˆ°æ ¡éªŒå­—æ®µå†å»åˆ¤æ–­å­—æ®µçš„åˆæ³•æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Section</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŸºäºæ³¨è§£çš„åˆ‡å…¥ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.planb.*.controller.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">aopAppController</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(value = &quot;aopAppController()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">aopAppController</span><span class="params">(JoinPoint joinPoint)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//æ ¡éªŒæ˜¯å¦æ˜¯POSTè¯·æ±‚</span></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> ((ServletRequestAttributes) Objects.requireNonNull(RequestContextHolder.getRequestAttributes())).getRequest();</span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethod();</span><br><span class="line">        <span class="keyword">if</span> (!<span class="string">&quot;POST&quot;</span>.equals(method)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">typ</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;content-type&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (ValidateUtil.isNotBlank(typ) &amp;&amp; typ.contains(<span class="string">&quot;json&quot;</span>)) &#123;</span><br><span class="line">            Object[] args = joinPoint.getArgs();</span><br><span class="line">            <span class="type">Object</span> <span class="variable">arg</span> <span class="operator">=</span> args[<span class="number">0</span>];</span><br><span class="line">            <span class="built_in">this</span>.opVerifyField(arg.getClass(), arg);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è‡ªå®šä¹‰æ³¨è§£æ ¡éªŒ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">opVerifyField</span><span class="params">(Class&lt;?&gt; aClass, Object obj)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Field[] fields = aClass.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field item : fields) &#123;</span><br><span class="line">            <span class="comment">// å…è®¸è®¿é—®ç§æœ‰å±æ€§</span></span><br><span class="line">            item.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="comment">// è·å–å±æ€§å</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> item.getName();</span><br><span class="line">            <span class="comment">// è·å–å±æ€§å€¼</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> item.get(obj);</span><br><span class="line">            <span class="comment">//åˆå§‹åŒ–æ•°æ®</span></span><br><span class="line">            <span class="keyword">if</span> (ValidateUtil.isBlank(value)) &#123;</span><br><span class="line">                <span class="comment">//èµ‹å€¼ç»™å±æ€§å€¼</span></span><br><span class="line">                item.set(obj, <span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//æ£€éªŒå­—æ®µ</span></span><br><span class="line">            <span class="type">VerifyField</span> <span class="variable">annotation</span> <span class="operator">=</span> item.getAnnotation(VerifyField.class);</span><br><span class="line">            <span class="type">ApiModelProperty</span> <span class="variable">modelProperty</span> <span class="operator">=</span> item.getAnnotation(ApiModelProperty.class);</span><br><span class="line">            <span class="keyword">if</span> (ValidateUtil.isNotBlank(annotation)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!annotation.fieldType() &amp;&amp; ValidateUtil.isBlank(value) &amp;&amp; annotation.isNotNull()) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (ValidateUtil.isBlank(modelProperty)) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BaseUnCheckedException</span>(name + <span class="string">&quot;ä¸èƒ½ä¸ºç©º&quot;</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BaseUnCheckedException</span>(modelProperty.value() + <span class="string">&quot;ä¸èƒ½ä¸ºç©º&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (annotation.fieldType() &amp;&amp; annotation.num() != -<span class="number">99</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (ValidateUtil.isBlank(value) || Integer.parseInt(value.toString()) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="comment">//èµ‹å€¼ç»™å±æ€§å€¼</span></span><br><span class="line">                        item.set(obj, annotation.num());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> item.getType().toString();</span><br><span class="line">                <span class="keyword">if</span> (ValidateUtil.isNotBlank(value) &amp;&amp; ValidateUtil.isNotBlank(annotation.joint()) &amp;&amp; str.contains(<span class="string">&quot;String&quot;</span>)) &#123;</span><br><span class="line">                    value = value + annotation.joint();</span><br><span class="line">                    <span class="comment">//èµ‹å€¼ç»™å±æ€§å€¼</span></span><br><span class="line">                    item.set(obj, value);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;@annotation(limit)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">limit</span><span class="params">(Limit limit)</span> &#123;</span><br><span class="line">        ThreadLocalUtil.set(ThreadLocalConstant.LIMIT, <span class="string">&quot;limit&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è‡ªå®šä¹‰æ³¨è§£å®ç°åˆ†é¡µ"><a href="#è‡ªå®šä¹‰æ³¨è§£å®ç°åˆ†é¡µ" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£å®ç°åˆ†é¡µ"></a>è‡ªå®šä¹‰æ³¨è§£å®ç°åˆ†é¡µ</h1><h1 id="ç¼–å†™å·¥å…·ç±»"><a href="#ç¼–å†™å·¥å…·ç±»" class="headerlink" title="ç¼–å†™å·¥å…·ç±»"></a>ç¼–å†™å·¥å…·ç±»</h1><p>æŠŠæ¯ä¸ªæ¥å£çš„è¯·æ±‚ï¼Œè¿”å›çš„å“åº”ï¼Œè¿™å…¶ä¸­å‘ç”Ÿçš„æŠ¥é”™ï¼Œè¯·æ±‚å¤´ï¼Œè·¯å¾„ç­‰ç›¸å…³ä¿¡æ¯ä»æœåŠ¡å™¨æ—¥å¿—é‡Œå­˜å‚¨åœ¨excelè¡¨æ ¼ä¸­</p><h1 id="ä»£ç è§„èŒƒ"><a href="#ä»£ç è§„èŒƒ" class="headerlink" title="ä»£ç è§„èŒƒ"></a>ä»£ç è§„èŒƒ</h1><p>æ‰€æœ‰çš„equalsæ–¹æ³•ï¼Œéƒ½è¦æŠŠå¸¸é‡æ”¾åœ¨å‰é¢ï¼Œé˜²æ­¢å‡ºç°ç©ºæŒ‡é’ˆçš„å¼‚å¸¸ï¼Œå› ä¸ºä¼šæœ‰æ—§ç‰ˆæœ¬çš„å…¼å®¹é—®é¢˜ï¼Œæ‰€ä»¥æ˜¯ä¸ç¡®å®šæœ‰äº›éå¸¸é‡å€¼æ˜¯å¦ä¸ºç©ºçš„</p><p>å¦‚ä¸‹ä¸ºè§„èŒƒå†™æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;0&quot;</span>.equals(dto.getIsChn())</span><br></pre></td></tr></table></figure><h1 id="å¯åŠ¨æ—¶åšå¤„ç†"><a href="#å¯åŠ¨æ—¶åšå¤„ç†" class="headerlink" title="å¯åŠ¨æ—¶åšå¤„ç†"></a>å¯åŠ¨æ—¶åšå¤„ç†</h1><p>åœ¨spring booté¡¹ç›®å¯åŠ¨æ—¶å°±å¯ä»¥å»åŠ è½½æ•°æ®äº†ï¼Œä¾‹å¦‚åŠ è½½å­—å…¸æ•°æ®ç­‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationRunnerImpl</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span> &#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> GeneralDataService generalDataService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;é€šè¿‡å®ç°ApplicationRunneræ¥å£ï¼Œåœ¨spring booté¡¹ç›®å¯åŠ¨åæ‰“å°å‚æ•°&quot;</span>);</span><br><span class="line">    String[] sourceArgs = args.getSourceArgs();</span><br><span class="line">    <span class="keyword">for</span> (String arg : sourceArgs) &#123;</span><br><span class="line">        System.out.print(arg + <span class="string">&quot; &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println();</span><br><span class="line">    <span class="built_in">this</span>.generalDataService.loadData();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– Excel è¡¨æ ¼</span></span><br><span class="line">    ExcelInterceptor.initExcel();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç”ŸæˆäºŒç»´ç çš„æ—¶å€™ï¼Œç”¨<strong>çº¿ç¨‹æ± </strong>ï¼Œå¼‚æ­¥åœ°å»æ‰§è¡Œè€—æ—¶é•¿çš„äºŒç»´ç å†™å…¥çš„æ“ä½œ</p><p>åœ¨é¡¹ç›®å¯åŠ¨æ—¶æŠŠå­—å…¸æ•°æ®è¿™ç§å¸¸ç”¨çš„é¢‘ç¹çš„å­˜åˆ°redis</p><h1 id="è‡ªå®šä¹‰æ—¥å¿—ç®¡ç†ç³»ç»Ÿ"><a href="#è‡ªå®šä¹‰æ—¥å¿—ç®¡ç†ç³»ç»Ÿ" class="headerlink" title="è‡ªå®šä¹‰æ—¥å¿—ç®¡ç†ç³»ç»Ÿ"></a>è‡ªå®šä¹‰æ—¥å¿—ç®¡ç†ç³»ç»Ÿ</h1><p>åœ¨å®šæ—¶å™¨æ¨¡å—å†™äº†åŒæ­¥å·¥å•çš„ä¸€ä¸ªæ¥å£æ–¹æ³•åï¼Œç”±äºåŒæ­¥å·¥å•è¦è¿™ä¸ªæ–¹æ³•è¦æ‰“å°å¤§é‡çš„sqlè¯­å¥ï¼Œæ•…å¯¹åŸæœ‰çš„æ—¥å¿—ç®¡ç†è¿›è¡Œä¼˜åŒ–ã€‚</p><p>åŸæœ¬çš„æ—¥å¿—ç®¡ç†ç³»ç»Ÿï¼Œåªæœ‰api.logå’Œerror.logï¼Œåˆ†åˆ«è®°å½•å…¨éƒ¨çš„æ—¥å¿—ä¿¡æ¯å’Œåªæœ‰é”™è¯¯çš„æ—¥å¿—ä¿¡æ¯ï¼ŒåŒæ—¶åŒçº§ç›®å½•ä¸‹è¿˜æœ‰ä¸¤ä¸ªç›®å½•ï¼Œåˆ†åˆ«æ˜¯apiså’Œerrorsè¿™ä¿©ç›®å½•ï¼Œåˆ†åˆ«ç”¨äºè®°å½•äº”å¤©ä¹‹å†…çš„æ—¥å¿—ä¿¡æ¯ï¼Œå…·ä½“ä¸ºapi.logæ–‡ä»¶æ¯æ»¡100MBä¹‹åå°±è¿›è¡Œ<mark>æ—¥å¿—çš„åˆ†ç‰‡ï¼ŒæŒ‰ç…§å½“æ—¥æ—¥æœŸ+åˆ†ç‰‡åºå·ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰æ¥å‘½å</mark>ï¼Œæ•…ä¸€æ—¥å¯ä»¥æœ‰å¤šä¸ª100MBçš„æ—¥å¿—æ–‡ä»¶ï¼Œå…·ä½“é‡‡ç”¨çš„æ˜¯åˆ©ç”¨æ–‡ä»¶å¤§å°æ»šåŠ¨ <code>SizeAndTimeBasedFNATP</code> æ¥å®ç°ï¼Œè¿™æ ·æ›´ä¾¿äºæŸ¥æ‰¾å’Œç®¡ç†ã€‚</p><p>ç°åœ¨çš„é—®é¢˜æ˜¯ç”±äºåŒæ­¥å·¥å•çš„æ–¹æ³•çš„sqlæ‰“å°è¿‡å¤šï¼Œå¯¼è‡´å½±å“æŸ¥çœ‹å…¶ä»–æ–¹æ³•çš„æ—¥å¿—ï¼Œæ•…è¿›è¡Œç»Ÿä¸€çš„åˆ†ç±»ã€‚</p><p>æ“ä½œæ–¹æ³•å¦‚ä¸‹ï¼š</p><ol><li>è‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼ŒåŒ…å«æ—¥å¿—çš„çº§åˆ«å’Œçº¿ç¨‹çš„åç§°</li><li>è‡ªå®šä¹‰ä¸€ä¸ªAOPåˆ‡é¢ï¼Œç„¶ååŸºäºè¿™ä¸ªæ³¨è§£çš„åˆ‡ç‚¹ï¼Œå»è·å–åˆ°çº¿ç¨‹çš„åç§°ï¼Œç„¶åè¿›è¡Œä¿®æ”¹è¯¥çº¿ç¨‹çš„çº¿ç¨‹åå’Œæ—¥å¿—çº§åˆ«</li><li>åœ¨logback-spring.xmlæ–‡ä»¶ä¸­ï¼Œä½¿ç”¨MDCæ¥åŒºåˆ†ä¸åŒçš„çº¿ç¨‹ï¼Œä¸ºæ¯ä¸ªåç§°å»ºç«‹ä¸€ä¸ªlogæ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹é‡Œä¹Ÿæ˜¯åƒä¸Šè¿°çš„ä¸€æ ·è¿›è¡Œæ»šåŠ¨åˆ‡ç‰‡å­˜å‚¨5æ—¥å†…çš„æ—¥å¿—ã€‚</li></ol><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://blog.csdn.net/SmartTxp/article/details/89114249">https://blog.csdn.net/SmartTxp/article/details/89114249</a></p>]]></content>
      
      
      <categories>
          
          <category> Work </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</title>
      <link href="/2024/01/21/Study-%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/"/>
      <url>/2024/01/21/Study-%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æœ¬æ–‡å­¦ä¹ è‡ªï¼š</p><p><a href="https://2382546457.github.io/pages/7e25cb/#_2-%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C">https://2382546457.github.io/pages/7e25cb/#_2-%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C</a></p><p><a href="https://www.bilibili.com/video/BV1Hs411j73w/?spm_id_from=333.337.search-card.all.click&vd_source=fa7ba4ae353f08f1d08d1bb24528e96c">https://www.bilibili.com/video/BV1Hs411j73w/?spm_id_from=333.337.search-card.all.click&amp;vd_source=fa7ba4ae353f08f1d08d1bb24528e96c</a></p><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>ä¸€è‡´æ€§Hashæ˜¯ä¸€ç§ç‰¹æ®Šçš„Hashç®—æ³•ï¼Œç”±äºå…¶<mark>å‡è¡¡æ€§ã€æŒä¹…æ€§</mark>çš„æ˜ å°„ç‰¹ç‚¹ï¼Œè¢«å¹¿æ³›çš„åº”ç”¨äºè´Ÿè½½å‡è¡¡é¢†åŸŸï¼Œå¦‚<code>nginx</code>å’Œ<code>memcached</code>éƒ½é‡‡ç”¨äº†ä¸€è‡´æ€§Hashæ¥ä½œä¸º<mark>é›†ç¾¤è´Ÿè½½å‡è¡¡</mark>çš„æ–¹æ¡ˆã€‚</p><h1 id="æ™®é€šå“ˆå¸Œ"><a href="#æ™®é€šå“ˆå¸Œ" class="headerlink" title="æ™®é€šå“ˆå¸Œ"></a>æ™®é€šå“ˆå¸Œ</h1><p>åœ¨ä»‹ç»ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¹‹å‰ï¼Œå…ˆè¯´ä¸€ä¸‹æ™®é€šçš„å“ˆå¸Œç®—æ³•ï¼Œä»¥ä¾¿ä»‹ç»å®ƒä¿©çš„åŒºåˆ«ã€‚</p><p>åœ¨è´Ÿè½½å‡è¡¡ä¸­ï¼Œä½¿ç”¨æ™®é€šçš„å“ˆå¸Œç®—æ³•è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œå‡å¦‚ç”¨æˆ·ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡ï¼Œæˆ‘ä»¬æœ‰ä¸‰å°æœåŠ¡å™¨å¯ä»¥å­˜å‚¨ï¼Œä¸Šä¼ åˆ°å“ªä¸€ä¸ªå›¾ç‰‡ï¼Ÿ</p><ol><li>å°†æœåŠ¡å™¨ç¼–å·ï¼Œ0ã€1ã€2</li><li>å°†å›¾ç‰‡è¿›è¡Œå“ˆå¸Œç®—æ³•ï¼Œhashï¼ˆå›¾ç‰‡ï¼‰&#x3D; 13ï¼Œå¾—åˆ°çš„ hash å€¼å†è·Ÿæœºå™¨çš„æ•°é‡å–æ¨¡ï¼Œ13 % 3 &#x3D; 1ï¼Œå°†å›¾ç‰‡å­˜å‚¨åˆ°<strong>æœåŠ¡å™¨1</strong> ä¸­ã€‚</li><li>ä»¥åè®¿é—®è¯¥å›¾ç‰‡ï¼ŒæŒ‰ç…§ä¸Šè¿°é¡ºåºå¾—åˆ°å­˜å‚¨å›¾ç‰‡çš„æœºå™¨å³å¯ã€‚</li></ol><p><img src="/../assets/Study-%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/42ba360b8045498391e1dac6f84aae53.png" alt="img"></p><p>ä½†æ˜¯ï¼Œæ™®é€šå“ˆå¸Œæœ‰ä¸ªå¾ˆå¤§çš„åå¤„ï¼šå‡å¦‚æˆ‘åˆæ·»åŠ äº†ä¸¤å°æœºå™¨ï¼Œæ­¤æ—¶æœºå™¨æ•°é‡å˜æˆ 5ï¼Œä¹‹å‰é‚£å¼ å›¾ç‰‡ä½¿ç”¨ hashï¼ˆå›¾ç‰‡ï¼‰&#x3D; 13ï¼Œå–æ¨¡ 13 % 5 &#x3D; 3ï¼Œäºæ˜¯ç¨‹åºå» <strong>æœåŠ¡å™¨2</strong> æ‰¾å›¾ç‰‡ï¼Œä½†æ˜¯æˆ‘ä»¬çš„å›¾ç‰‡ä¹‹å‰å­˜å‚¨åœ¨ æœåŠ¡å™¨1ã€‚bugä¸å°±æ¥äº†ï¼Ÿ</p><blockquote><p>çœ‹åˆ°è¿™é‡Œä½ åº”è¯¥æ„è¯†åˆ°ï¼šä¸€æ—¦æœåŠ¡å™¨æ•°é‡ä¿®æ”¹ï¼Œhashä¹‹åçš„å–æ¨¡è¿ç®—å°±ä¼šæ”¹å˜ï¼Œå¯¹åº”çš„è®¡ç®—ç»“æœä¹Ÿå°±æ”¹å˜äº†ï¼Œä¹‹å‰çš„è®¡ç®—ç»“æœ ä¸ ç°åœ¨çš„è®¡ç®—ç»“æœ ä¸ä¸€æ ·ï¼Œç»å¤§å¤šæ•°æ•°æ®å°±éœ€è¦é‡æ–°å­˜å‚¨ã€‚è¿™æ˜¯ä¸ªè‡´å‘½é”™è¯¯ã€‚</p></blockquote><h1 id="ä¸€è‡´æ€§å“ˆå¸Œ"><a href="#ä¸€è‡´æ€§å“ˆå¸Œ" class="headerlink" title="ä¸€è‡´æ€§å“ˆå¸Œ"></a>ä¸€è‡´æ€§å“ˆå¸Œ</h1><p>æ™®é€šå“ˆå¸Œå¤±è¯¯å°±å¤±è¯¯åœ¨å¯¹æœºå™¨æ•°é‡å–æ¨¡ä¸Šï¼Œæˆ‘ä»¬ä¸å¯¹æœºå™¨æ•°å–æ¨¡ï¼Œå¯¹ 2^32 å–æ¨¡ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬é¦–å…ˆå°† [0ï¼Œ 2^32-1] å›´æˆä¸€ä¸ªåœ†åœˆï¼š</p><p><img src="/../assets/Study-%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/1dabc6d21275466885e876058dd81d7a.png" alt="åœ†åœˆ"></p><p>å¦‚å›¾ï¼Œ0 çš„å·¦ä¾§å°±æ˜¯ 2^32-1ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªç”± 2^32 ä¸ªæ•°ç»„æˆçš„åœ†åœˆç§°ä¸ºå“ˆå¸Œç¯</p><p>äºæ˜¯æˆ‘ä»¬å­˜å›¾ç‰‡çš„æ­¥éª¤å˜ä¸ºï¼š</p><p>å°†æœåŠ¡å™¨çš„åœ°å€è®¡ç®—å“ˆå¸Œå€¼ï¼Œhash(æœåŠ¡å™¨)ï¼Œç”¨è¿™ä¸ªå€¼ä¸ 2^32 å–æ¨¡ï¼Œé‚£ä¹ˆæ‰€æœ‰æœåŠ¡å™¨éƒ½ä¼šåœ¨è¿™ä¸ªåœ†åœˆä¸Šä»£è¡¨ä¸€ä¸ªç‚¹</p><p><img src="/../assets/Study-%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/image-20231109001357945.png" alt="image-20231109001357945"></p><p>å°†è¦å­˜å‚¨çš„å›¾ç‰‡è®¡ç®—å“ˆå¸Œå€¼ï¼Œhash(å›¾ç‰‡)ï¼Œç”¨è¿™ä¸ªå€¼ä¸ 2^32 å–æ¨¡ï¼Œé‚£ä¹ˆæ‰€æœ‰å›¾ç‰‡éƒ½ä¼šåœ¨è¿™ä¸ªåœ†åœˆä¸Šä»£è¡¨ä¸€ä¸ªç‚¹</p><p>æ€ä¹ˆç»™è¿™äº›å›¾ç‰‡é€‰æ‹©ä¸€ä¸ªæœåŠ¡å™¨å‘¢ï¼Ÿåªéœ€è¦åœ¨è¿™ä¸ªç¯ä¸Šä¸€ç›´å¾€åéå†å°±è¡Œäº†ï¼Œä¸Šå›¾ä¸­å·¦è¾¹ä¸‰ä¸ªå›¾ç‰‡å­˜å‚¨åœ¨æœåŠ¡å™¨Aï¼Œå³è¾¹çš„ä¸‰ä¸ªå›¾ç‰‡å­˜å‚¨åœ¨æœåŠ¡å™¨Cã€‚</p><p><img src="/../assets/Study-%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/image-20231109001655962.png" alt="image-20231109001655962"></p><p>ç¨‹åºæŸ¥æ‰¾æ—¶ä¹Ÿå¯ä»¥è¿™æ ·åšï¼šè®¡ç®—hashå€¼ -&gt; ä¸ 2^32 å–æ¨¡ -&gt; æ”¾åœ¨å“ˆå¸Œç¯ä¸Šå¾€å³æ‰¾ç¬¬ä¸€ä¸ªæœåŠ¡å™¨ã€‚</p><p>é‡åˆ°æœåŠ¡å™¨å®•æœºæˆ–è€…æ–°å¢æœåŠ¡å™¨æ—¶ï¼Œå°±å¯ä»¥åªç ´åä¸€éƒ¨åˆ†æ•°æ®ï¼Œä¿æŠ¤å…¶ä½™æ•°æ®ã€‚</p><p>å‡å¦‚æ­¤æ—¶ æœåŠ¡å™¨C å®•æœºï¼Œé‚£ä¹ˆå³è¾¹çš„ä¸‰ä¸ªæ–‡ä»¶å°±åªèƒ½å­˜å‚¨åˆ° æœåŠ¡å™¨B ä¸­ï¼Œä½†æ˜¯ä¹Ÿä»…ä»…æ˜¯ä¸‰ä¸ªæ–‡ä»¶ã€‚</p><p>ä¸€è‡´æ€§å“ˆå¸Œçš„çš„ä¼˜ç¼ºç‚¹ï¼š</p><ul><li><p>ä¼˜ç‚¹ ï¼šé‡åˆ°èŠ‚ç‚¹ä¸ç¨³å®šçš„æƒ…å†µå¯ä»¥ä¿æŠ¤å¤šæ•°æ•°æ®</p></li><li><p>ç¼ºç‚¹ ï¼šåœ¨èŠ‚ç‚¹æ•°é‡å¤ªå°‘çš„æƒ…å†µä¸‹ï¼Œå®¹æ˜“å› ä¸ºèŠ‚ç‚¹åˆ†å¸ƒä¸å‡åŒ€è€Œé€ æˆæ•°æ®å€¾æ–œé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¢«ç¼“å­˜çš„æ•°æ®å¤§éƒ½é›†ä¸­å­˜å‚¨åœ¨æŸä¸ªèŠ‚ç‚¹ä¸Šï¼Œä»è€Œå‡ºç°æ•°æ®åˆ†å¸ƒä¸å‡åŒ€çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µè¢«ç§°ä¸ºå“ˆå¸Œå€¾æ–œ</p></li></ul><p>ä¸ºäº†è§£å†³è¿™ç§æ•°æ®å€¾æ–œé—®é¢˜ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å¼•å…¥äº†<strong>è™šæ‹ŸèŠ‚ç‚¹æœºåˆ¶</strong>ï¼Œå³å¯¹æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½è®¡ç®—å¤šä¸ªå“ˆå¸Œå€¼ï¼Œæ¯ä¸ªè®¡ç®—ç»“æœéƒ½æ”¾ç½®åœ¨å“ˆå¸Œç¯ä¸Šï¼Œç§°ä¸ºè™šæ‹ŸèŠ‚ç‚¹ã€‚ä¸€ä¸ªå®é™…çš„ç‰©ç†èŠ‚ç‚¹å¯ä»¥å¯¹åº”å¤šä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œè™šæ‹ŸèŠ‚ç‚¹è¶Šå¤šï¼Œå“ˆå¸Œç¯ä¸Šçš„èŠ‚ç‚¹å°±è¶Šå¤šï¼Œæ•°æ®è¢«å‡åŒ€åˆ†é…çš„æ¦‚ç‡å°±è¶Šå¤§ï¼Œå“ˆå¸Œç¯å€¾æ–œé€ æˆçš„å½±å“å°±è¶Šå°ã€‚</p><blockquote><p>å¯»æ‰¾è¿‡ç¨‹å°±å˜ä¸ºï¼šhashï¼ˆå›¾ç‰‡ï¼‰-&gt; å–æ¨¡å¾—åˆ°hashå€¼ -&gt; å‘å³æ‰¾åˆ°è™šæ‹ŸèŠ‚ç‚¹ -&gt; æ ¹æ®è™šæ‹ŸèŠ‚ç‚¹æ‰¾åˆ°ç‰©ç†èŠ‚ç‚¹</p></blockquote><p><img src="/../assets/Study-%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/image-20231109003646430.png" alt="image-20231109003646430"></p>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JasyptåŠ å¯†</title>
      <link href="/2024/01/20/Work-Jasypt%E5%8A%A0%E5%AF%86/"/>
      <url>/2024/01/20/Work-Jasypt%E5%8A%A0%E5%AF%86/</url>
      
        <content type="html"><![CDATA[<h1 id="Jasyptç®€ä»‹"><a href="#Jasyptç®€ä»‹" class="headerlink" title="Jasyptç®€ä»‹"></a>Jasyptç®€ä»‹</h1><p>Jasyptæ˜¯ä¸€ä¸ªç”¨äºå¯¹ymlæ•æ„Ÿæ•°æ®è¿›è¡ŒåŠ å¯†çš„å·¥å…·ï¼Œåœ¨å…¬å¸é¡¹ç›®ä¸­å­¦åˆ°çš„ã€‚</p><blockquote><p>ä¸€æ®µå†…å®¹å¯ä»¥ç»è¿‡ä¸€ä¸ªå¯†é’¥è¿›è¡ŒåŠ å¯†ï¼ŒåŠ å¯†åçš„æ•°æ®ä½¿ç”¨è¯¥å¯†é’¥å¯è¿›è¡Œè§£å¯†</p></blockquote><h1 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h1><h2 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ymlæ•æ„Ÿä¿¡æ¯åŠ å¯†å·¥å…·--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.ulisesbocchio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jasypt-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨å·¥å…·ç±»è¿›è¡ŒåŠ å¯†"><a href="#ä½¿ç”¨å·¥å…·ç±»è¿›è¡ŒåŠ å¯†" class="headerlink" title="ä½¿ç”¨å·¥å…·ç±»è¿›è¡ŒåŠ å¯†"></a>ä½¿ç”¨å·¥å…·ç±»è¿›è¡ŒåŠ å¯†</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JasyptUtil</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">BasicTextEncryptor</span> <span class="variable">textEncryptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicTextEncryptor</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encrypt</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> textEncryptor.encrypt(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">decrypt</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> textEncryptor.decrypt(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//åŠ å¯†æ‰€éœ€çš„salt(ç›)</span></span><br><span class="line">        textEncryptor.setPassword(<span class="string">&quot;planb123&quot;</span>);</span><br><span class="line">        <span class="comment">//è¦åŠ å¯†çš„æ•°æ®ï¼ˆæ•°æ®åº“çš„ç”¨æˆ·åæˆ–å¯†ç ï¼‰</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> encrypt(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;åŠ å¯†ç»“æœ:&quot;</span> + password);</span><br><span class="line">        password = decrypt(password);</span><br><span class="line">        System.out.println(<span class="string">&quot;è§£å¯†ç»“æœï¼š&quot;</span> + password);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹ymlæ•æ„Ÿæ•°æ®"><a href="#ä¿®æ”¹ymlæ•æ„Ÿæ•°æ®" class="headerlink" title="ä¿®æ”¹ymlæ•æ„Ÿæ•°æ®"></a>ä¿®æ”¹ymlæ•æ„Ÿæ•°æ®</h2><p>ä¾‹å¦‚æ•°æ®åº“è´¦æˆ·å’Œå¯†ç </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/bookhub?serverTimezone=UTC</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">ENC(ojZbEkkRbUtDdJnNkMmR0w==)</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">ENC(uhJgAJ4GnWNyG/LuBpXZmw==)</span></span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨å½¢å¼"><a href="#å¯åŠ¨å½¢å¼" class="headerlink" title="å¯åŠ¨å½¢å¼"></a>å¯åŠ¨å½¢å¼</h2><p>é…ç½®VMè¿è¡Œå‚æ•°-Djasypt.encryptor.password&#x3D;planb123</p><p><img src="/../assets/Work-Jasypt%E5%8A%A0%E5%AF%86/image-20240120194521598.png" alt="image-20240120194521598"></p><p>æˆ–è€…æ‰“åŒ…æˆjaråŒ…åæºå¸¦å‚æ•°è¿›è¡Œè¿è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar xxx.jar --jasypt.encryptor.password=planb123</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Work </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ å¯†ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MongoDB</title>
      <link href="/2024/01/13/Study-MongoDB%E5%AD%A6%E4%B9%A0/"/>
      <url>/2024/01/13/Study-MongoDB%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸ºä»€ä¹ˆè¦ç”¨MongoDB"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨MongoDB" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨MongoDB"></a>ä¸ºä»€ä¹ˆè¦ç”¨MongoDB</h1><p>å…·ä½“çš„åº”ç”¨åœºæ™¯å¦‚ï¼š </p><ol><li>ç¤¾äº¤åœºæ™¯ï¼Œä½¿ç”¨ MongoDB å­˜å‚¨å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œä»¥åŠç”¨æˆ·å‘è¡¨çš„æœ‹å‹åœˆä¿¡æ¯ï¼Œé€šè¿‡åœ°ç†ä½ç½®ç´¢å¼•å®ç°é™„è¿‘çš„äººã€åœ°ç‚¹ç­‰åŠŸèƒ½ã€‚ </li><li>æ¸¸æˆåœºæ™¯ï¼Œä½¿ç”¨ MongoDB å­˜å‚¨æ¸¸æˆç”¨æˆ·ä¿¡æ¯ï¼Œç”¨æˆ·çš„è£…å¤‡ã€ç§¯åˆ†ç­‰ç›´æ¥ä»¥å†…åµŒæ–‡æ¡£çš„å½¢å¼å­˜å‚¨ï¼Œæ–¹ä¾¿æŸ¥è¯¢ã€é«˜æ•ˆç‡å­˜å‚¨å’Œè®¿é—®ã€‚ </li><li>ç‰©æµåœºæ™¯ï¼Œä½¿ç”¨ MongoDB å­˜å‚¨è®¢å•ä¿¡æ¯ï¼Œè®¢å•çŠ¶æ€åœ¨è¿é€è¿‡ç¨‹ä¸­ä¼šä¸æ–­æ›´æ–°ï¼Œä»¥ MongoDB å†…åµŒæ•°ç»„çš„å½¢å¼æ¥å­˜å‚¨ï¼Œä¸€æ¬¡æŸ¥è¯¢å°±èƒ½å°† è®¢å•æ‰€æœ‰çš„å˜æ›´è¯»å–å‡ºæ¥ã€‚ </li><li>ç‰©è”ç½‘åœºæ™¯ï¼Œä½¿ç”¨ MongoDB å­˜å‚¨æ‰€æœ‰æ¥å…¥çš„æ™ºèƒ½è®¾å¤‡ä¿¡æ¯ï¼Œä»¥åŠè®¾å¤‡æ±‡æŠ¥çš„æ—¥å¿—ä¿¡æ¯ï¼Œå¹¶å¯¹è¿™äº›ä¿¡æ¯è¿›è¡Œå¤šç»´åº¦çš„åˆ†æã€‚ </li><li>è§†é¢‘ç›´æ’­ï¼Œä½¿ç”¨ MongoDB å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€ç‚¹èµäº’åŠ¨ä¿¡æ¯ç­‰ã€‚</li></ol><p>è¿™äº›åº”ç”¨åœºæ™¯ä¸­ï¼Œæ•°æ®æ“ä½œæ–¹é¢çš„å…±åŒç‰¹ç‚¹æ˜¯ï¼š </p><ol><li>æ•°æ®é‡å¤§ </li><li>å†™å…¥æ“ä½œé¢‘ç¹ï¼ˆè¯»å†™éƒ½å¾ˆé¢‘ç¹ï¼‰ </li><li>ä»·å€¼è¾ƒä½çš„æ•°æ®ï¼Œå¯¹äº‹åŠ¡æ€§è¦æ±‚ä¸é«˜ å¯¹äºè¿™æ ·çš„æ•°æ®ï¼Œæˆ‘ä»¬æ›´é€‚åˆä½¿ç”¨MongoDBæ¥å®ç°æ•°æ®çš„å­˜å‚¨ã€‚</li></ol><p>MySQLä¸MongoDBå¯¹æ¯”ï¼š</p><p><img src="/../assets/Study-MongoDB%E5%AD%A6%E4%B9%A0/image-20240113223702004.png" alt="image-20240113223702004"></p><p>å¯åŠ¨å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod -f ../conf/mongod.conf</span><br></pre></td></tr></table></figure><p>é€‰æ‹©å’Œåˆ›å»ºæ•°æ®åº“ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use æ•°æ®åº“åç§°</span><br></pre></td></tr></table></figure><p>åˆ é™¤æ•°æ®åº“ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.dropDatabase()</span><br></pre></td></tr></table></figure><p>å¢åˆ æ”¹æŸ¥ï¼š</p>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JVMç›¸å…³é¢è¯•é¢˜</title>
      <link href="/2024/01/11/%E9%9D%A2%E8%AF%95-JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
      <url>/2024/01/11/%E9%9D%A2%E8%AF%95-JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æœ¬ç¯‡æ–‡ç« å–è‡ªé»‘é©¬ç¨‹åºå‘˜</p><h1 id="JVMç›¸å…³é¢è¯•é¢˜"><a href="#JVMç›¸å…³é¢è¯•é¢˜" class="headerlink" title="JVMç›¸å…³é¢è¯•é¢˜"></a>JVMç›¸å…³é¢è¯•é¢˜</h1><h2 id="1-JVMç»„æˆ"><a href="#1-JVMç»„æˆ" class="headerlink" title="1 JVMç»„æˆ"></a>1 JVMç»„æˆ</h2><h3 id="1-1-JVMç”±é‚£äº›éƒ¨åˆ†ç»„æˆï¼Œè¿è¡Œæµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-1-JVMç”±é‚£äº›éƒ¨åˆ†ç»„æˆï¼Œè¿è¡Œæµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.1 JVMç”±é‚£äº›éƒ¨åˆ†ç»„æˆï¼Œè¿è¡Œæµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1.1 JVMç”±é‚£äº›éƒ¨åˆ†ç»„æˆï¼Œè¿è¡Œæµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><p><strong>JVMæ˜¯ä»€ä¹ˆ</strong></p><p>Java Virtual Machine Javaç¨‹åºçš„è¿è¡Œç¯å¢ƒï¼ˆjavaäºŒè¿›åˆ¶å­—èŠ‚ç çš„è¿è¡Œç¯å¢ƒï¼‰</p><p>å¥½å¤„ï¼š</p><ul><li><p>ä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œ</p></li><li><p>è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶</p></li></ul><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506094254360.png" alt="image-20230506094254360"></p><p><strong>JVMç”±å“ªäº›éƒ¨åˆ†ç»„æˆï¼Œè¿è¡Œæµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506094411247.png" alt="image-20230506094411247"></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡º JVM çš„ä¸»è¦ç»„æˆéƒ¨åˆ†</p><ul><li>ClassLoaderï¼ˆç±»åŠ è½½å™¨ï¼‰</li><li>Runtime Data Areaï¼ˆè¿è¡Œæ—¶æ•°æ®åŒºï¼Œå†…å­˜åˆ†åŒºï¼‰</li><li>Execution Engineï¼ˆæ‰§è¡Œå¼•æ“ï¼‰</li><li>Native Method Libraryï¼ˆæœ¬åœ°åº“æ¥å£ï¼‰</li></ul><p>è¿è¡Œæµç¨‹ï¼š</p><p>ï¼ˆ1ï¼‰ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰æŠŠJavaä»£ç è½¬æ¢ä¸ºå­—èŠ‚ç </p><p>ï¼ˆ2ï¼‰è¿è¡Œæ—¶æ•°æ®åŒºï¼ˆRuntime Data Areaï¼‰æŠŠå­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œå­—èŠ‚ç æ–‡ä»¶åªæ˜¯JVMçš„ä¸€å¥—æŒ‡ä»¤é›†è§„èŒƒï¼Œå¹¶ä¸èƒ½ç›´æ¥äº¤ç»™åº•å±‚ç³»ç»Ÿå»æ‰§è¡Œï¼Œè€Œæ˜¯æœ‰æ‰§è¡Œå¼•æ“è¿è¡Œ</p><p>ï¼ˆ3ï¼‰æ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰å°†å­—èŠ‚ç ç¿»è¯‘ä¸ºåº•å±‚ç³»ç»ŸæŒ‡ä»¤ï¼Œå†äº¤ç”±CPUæ‰§è¡Œå»æ‰§è¡Œï¼Œæ­¤æ—¶éœ€è¦è°ƒç”¨å…¶ä»–è¯­è¨€çš„æœ¬åœ°åº“æ¥å£ï¼ˆNative Method Libraryï¼‰æ¥å®ç°æ•´ä¸ªç¨‹åºçš„åŠŸèƒ½ã€‚</p><h3 id="1-2-ä»€ä¹ˆæ˜¯ç¨‹åºè®¡æ•°å™¨ï¼Ÿ"><a href="#1-2-ä»€ä¹ˆæ˜¯ç¨‹åºè®¡æ•°å™¨ï¼Ÿ" class="headerlink" title="1.2 ä»€ä¹ˆæ˜¯ç¨‹åºè®¡æ•°å™¨ï¼Ÿ"></a>1.2 ä»€ä¹ˆæ˜¯ç¨‹åºè®¡æ•°å™¨ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><p>ç¨‹åºè®¡æ•°å™¨ï¼šçº¿ç¨‹ç§æœ‰çš„ï¼Œå†…éƒ¨ä¿å­˜çš„å­—èŠ‚ç çš„è¡Œå·ã€‚ç”¨äºè®°å½•æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ã€‚</p><blockquote><p>javap -verbose  xx.class    æ‰“å°å †æ ˆå¤§å°ï¼Œå±€éƒ¨å˜é‡çš„æ•°é‡å’Œæ–¹æ³•çš„å‚æ•°ã€‚</p></blockquote><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506094602329.png" alt="image-20230506094602329"></p><p>â€‹javaè™šæ‹Ÿæœºå¯¹äºå¤šçº¿ç¨‹æ˜¯é€šè¿‡çº¿ç¨‹è½®æµåˆ‡æ¢å¹¶ä¸”åˆ†é…çº¿ç¨‹æ‰§è¡Œæ—¶é—´ã€‚åœ¨ä»»ä½•çš„ä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œä¸€ä¸ªå¤„ç†å™¨åªä¼šå¤„ç†æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æœå½“å‰è¢«æ‰§è¡Œçš„è¿™ä¸ªçº¿ç¨‹å®ƒæ‰€åˆ†é…çš„æ‰§è¡Œæ—¶é—´ç”¨å®Œäº†ã€æŒ‚èµ·ã€‘ã€‚å¤„ç†å™¨ä¼šåˆ‡æ¢åˆ°å¦å¤–çš„ä¸€ä¸ªçº¿ç¨‹ä¸Šæ¥è¿›è¡Œæ‰§è¡Œã€‚å¹¶ä¸”è¿™ä¸ªçº¿ç¨‹çš„æ‰§è¡Œæ—¶é—´ç”¨å®Œäº†ï¼Œæ¥ç€å¤„ç†å™¨å°±ä¼šåˆæ¥æ‰§è¡Œè¢«æŒ‚èµ·çš„è¿™ä¸ªçº¿ç¨‹ã€‚</p><p>â€‹é‚£ä¹ˆç°åœ¨æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå½“å‰å¤„ç†å™¨å¦‚ä½•èƒ½å¤ŸçŸ¥é“ï¼Œå¯¹äºè¿™ä¸ªè¢«æŒ‚èµ·çš„çº¿ç¨‹ï¼Œå®ƒä¸Šä¸€æ¬¡æ‰§è¡Œåˆ°äº†å“ªé‡Œï¼Ÿé‚£ä¹ˆè¿™æ—¶å°±éœ€è¦ä»ç¨‹åºè®¡æ•°å™¨ä¸­æ¥å›å»åˆ°å½“å‰çš„è¿™ä¸ªçº¿ç¨‹ä»–ä¸Šä¸€æ¬¡æ‰§è¡Œçš„è¡Œå·ï¼Œç„¶åæ¥ç€ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚</p><p>â€‹ç¨‹åºè®¡æ•°å™¨æ˜¯JVMè§„èŒƒä¸­å”¯ä¸€ä¸€ä¸ªæ²¡æœ‰è§„å®šå‡ºç°OOMçš„åŒºåŸŸï¼Œæ‰€ä»¥è¿™ä¸ªç©ºé—´ä¹Ÿä¸ä¼šè¿›è¡ŒGCã€‚</p><h3 id="1-3-ä½ èƒ½ç»™æˆ‘è¯¦ç»†çš„ä»‹ç»Javaå †å—"><a href="#1-3-ä½ èƒ½ç»™æˆ‘è¯¦ç»†çš„ä»‹ç»Javaå †å—" class="headerlink" title="1.3 ä½ èƒ½ç»™æˆ‘è¯¦ç»†çš„ä»‹ç»Javaå †å—?"></a>1.3 ä½ èƒ½ç»™æˆ‘è¯¦ç»†çš„ä»‹ç»Javaå †å—?</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><p>çº¿ç¨‹å…±äº«çš„åŒºåŸŸï¼šä¸»è¦ç”¨æ¥ä¿å­˜å¯¹è±¡å®ä¾‹ï¼Œæ•°ç»„ç­‰ï¼Œå½“å †ä¸­æ²¡æœ‰å†…å­˜ç©ºé—´å¯åˆ†é…ç»™å®ä¾‹ï¼Œä¹Ÿæ— æ³•å†æ‰©å±•æ—¶ï¼Œåˆ™æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506094803545.png" alt="image-20230506094803545"></p><ul><li>å¹´è½»ä»£è¢«åˆ’åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼ŒEdenåŒºå’Œä¸¤ä¸ªå¤§å°ä¸¥æ ¼ç›¸åŒçš„SurvivoråŒºï¼Œæ ¹æ®JVMçš„ç­–ç•¥ï¼Œåœ¨ç»è¿‡å‡ æ¬¡åƒåœ¾æ”¶é›†åï¼Œä»»ç„¶å­˜æ´»äºSurvivorçš„å¯¹è±¡å°†è¢«ç§»åŠ¨åˆ°è€å¹´ä»£åŒºé—´ã€‚</li><li>è€å¹´ä»£ä¸»è¦ä¿å­˜ç”Ÿå‘½å‘¨æœŸé•¿çš„å¯¹è±¡ï¼Œä¸€èˆ¬æ˜¯ä¸€äº›è€çš„å¯¹è±¡</li><li>å…ƒç©ºé—´ä¿å­˜çš„ç±»ä¿¡æ¯ã€é™æ€å˜é‡ã€å¸¸é‡ã€ç¼–è¯‘åçš„ä»£ç </li></ul><p>â€‹</p><p>ä¸ºäº†é¿å…æ–¹æ³•åŒºå‡ºç°OOMï¼Œæ‰€ä»¥åœ¨java8ä¸­å°†å †ä¸Šçš„æ–¹æ³•åŒºã€æ°¸ä¹…ä»£ã€‘ç»™ç§»åŠ¨åˆ°äº†æœ¬åœ°å†…å­˜ä¸Šï¼Œé‡æ–°å¼€è¾Ÿäº†ä¸€å—ç©ºé—´ï¼Œå«åš<strong>å…ƒç©ºé—´</strong>ã€‚é‚£ä¹ˆç°åœ¨å°±å¯ä»¥é¿å…æ‰OOMçš„å‡ºç°äº†ã€‚</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506094938843.png" alt="image-20230506094938843"></p><h5 id="å…ƒç©ºé—´-MetaSpace-ä»‹ç»"><a href="#å…ƒç©ºé—´-MetaSpace-ä»‹ç»" class="headerlink" title="å…ƒç©ºé—´(MetaSpace)ä»‹ç»"></a>å…ƒç©ºé—´(MetaSpace)ä»‹ç»</h5><p>â€‹åœ¨ HotSpot JVM ä¸­ï¼Œæ°¸ä¹…ä»£ï¼ˆ â‰ˆ æ–¹æ³•åŒºï¼‰ä¸­ç”¨äºå­˜æ”¾ç±»å’Œæ–¹æ³•çš„å…ƒæ•°æ®ä»¥åŠå¸¸é‡æ± ï¼Œæ¯”å¦‚Class å’Œ Methodã€‚æ¯å½“ä¸€ä¸ªç±»åˆæ¬¡è¢«åŠ è½½çš„æ—¶å€™ï¼Œå®ƒçš„å…ƒæ•°æ®éƒ½ä¼šæ”¾åˆ°æ°¸ä¹…ä»£ä¸­ã€‚</p><p>â€‹æ°¸ä¹…ä»£æ˜¯æœ‰å¤§å°é™åˆ¶çš„ï¼Œå› æ­¤å¦‚æœåŠ è½½çš„ç±»å¤ªå¤šï¼Œå¾ˆæœ‰å¯èƒ½å¯¼è‡´æ°¸ä¹…ä»£å†…å­˜æº¢å‡ºï¼Œå³OutOfMemoryErrorï¼Œä¸ºæ­¤ä¸å¾—ä¸å¯¹è™šæ‹Ÿæœºåšè°ƒä¼˜ã€‚</p><p>â€‹é‚£ä¹ˆï¼ŒJava 8 ä¸­ PermGen ä¸ºä»€ä¹ˆè¢«ç§»å‡º HotSpot JVM äº†ï¼Ÿ</p><p>å®˜ç½‘ç»™å‡ºäº†è§£é‡Šï¼š<a href="http://openjdk.java.net/jeps/122">http://openjdk.java.net/jeps/122</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">This is part of the JRockit and Hotspot convergence effort. JRockit customers do not need to configure the permanent generation (since JRockit does not have a permanent generation) and are accustomed to not configuring the permanent generation.</span><br><span class="line"></span><br><span class="line">ç§»é™¤æ°¸ä¹…ä»£æ˜¯ä¸ºèåˆHotSpot JVMä¸ JRockit VMè€Œåšå‡ºçš„åŠªåŠ›ï¼Œå› ä¸ºJRockitæ²¡æœ‰æ°¸ä¹…ä»£ï¼Œä¸éœ€è¦é…ç½®æ°¸ä¹…ä»£ã€‚</span><br></pre></td></tr></table></figure><p>1ï¼‰ç”±äº PermGen å†…å­˜ç»å¸¸ä¼šæº¢å‡ºï¼Œå¼•å‘OutOfMemoryErrorï¼Œå› æ­¤ JVM çš„å¼€å‘è€…å¸Œæœ›è¿™ä¸€å—å†…å­˜å¯ä»¥æ›´çµæ´»åœ°è¢«ç®¡ç†ï¼Œä¸è¦å†ç»å¸¸å‡ºç°è¿™æ ·çš„ OOMã€‚</p><p>2ï¼‰ç§»é™¤ PermGen å¯ä»¥ä¿ƒè¿› HotSpot JVM ä¸ JRockit VM çš„èåˆï¼Œå› ä¸º JRockit æ²¡æœ‰æ°¸ä¹…ä»£ã€‚</p><p>â€‹å‡†ç¡®æ¥è¯´ï¼ŒPerm åŒºä¸­çš„å­—ç¬¦ä¸²å¸¸é‡æ± è¢«ç§»åˆ°äº†å †å†…å­˜ä¸­æ˜¯åœ¨ Java7 ä¹‹åï¼ŒJava 8 æ—¶ï¼ŒPermGen è¢«å…ƒç©ºé—´ä»£æ›¿ï¼Œå…¶ä»–å†…å®¹æ¯”å¦‚<strong>ç±»å…ƒä¿¡æ¯ã€å­—æ®µã€é™æ€å±æ€§ã€æ–¹æ³•ã€å¸¸é‡</strong>ç­‰éƒ½ç§»åŠ¨åˆ°å…ƒç©ºé—´åŒºã€‚æ¯”å¦‚ java&#x2F;lang&#x2F;Object ç±»å…ƒä¿¡æ¯ã€é™æ€å±æ€§ System.outã€æ•´å‹å¸¸é‡ç­‰ã€‚</p><p>â€‹å…ƒç©ºé—´çš„æœ¬è´¨å’Œæ°¸ä¹…ä»£ç±»ä¼¼ï¼Œéƒ½æ˜¯å¯¹ JVM è§„èŒƒä¸­æ–¹æ³•åŒºçš„å®ç°ã€‚ä¸è¿‡å…ƒç©ºé—´ä¸æ°¸ä¹…ä»£ä¹‹é—´æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼šå…ƒç©ºé—´å¹¶ä¸åœ¨è™šæ‹Ÿæœºä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå…ƒç©ºé—´çš„å¤§å°ä»…å—æœ¬åœ°å†…å­˜é™åˆ¶ã€‚</p><h3 id="1-4-ä»€ä¹ˆæ˜¯è™šæ‹Ÿæœºæ ˆ"><a href="#1-4-ä»€ä¹ˆæ˜¯è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="1.4 ä»€ä¹ˆæ˜¯è™šæ‹Ÿæœºæ ˆ"></a>1.4 ä»€ä¹ˆæ˜¯è™šæ‹Ÿæœºæ ˆ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><p>Java Virtual machine Stacks (java è™šæ‹Ÿæœºæ ˆ)</p><ul><li><p>æ¯ä¸ªçº¿ç¨‹è¿è¡Œæ—¶æ‰€éœ€è¦çš„å†…å­˜ï¼Œç§°ä¸ºè™šæ‹Ÿæœºæ ˆï¼Œå…ˆè¿›åå‡º</p></li><li><p>æ¯ä¸ªæ ˆç”±å¤šä¸ªæ ˆå¸§ï¼ˆframeï¼‰ç»„æˆï¼Œå¯¹åº”ç€æ¯æ¬¡æ–¹æ³•è°ƒç”¨æ—¶æ‰€å ç”¨çš„å†…å­˜</p></li><li><p>æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§ï¼Œå¯¹åº”ç€å½“å‰æ­£åœ¨æ‰§è¡Œçš„é‚£ä¸ªæ–¹æ³•</p></li></ul><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506095140595.png" alt="image-20230506095140595"></p><ol><li><p>åƒåœ¾å›æ”¶æ˜¯å¦æ¶‰åŠæ ˆå†…å­˜ï¼Ÿ</p><p>åƒåœ¾å›æ”¶ä¸»è¦æŒ‡å°±æ˜¯å †å†…å­˜ï¼Œå½“æ ˆå¸§å¼¹æ ˆä»¥åï¼Œå†…å­˜å°±ä¼šé‡Šæ”¾</p></li><li><p>æ ˆå†…å­˜åˆ†é…è¶Šå¤§è¶Šå¥½å—ï¼Ÿ</p><p>æœªå¿…ï¼Œé»˜è®¤çš„æ ˆå†…å­˜é€šå¸¸ä¸º1024k</p><p>æ ˆå¸§è¿‡å¤§ä¼šå¯¼è‡´çº¿ç¨‹æ•°å˜å°‘ï¼Œä¾‹å¦‚ï¼Œæœºå™¨æ€»å†…å­˜ä¸º512mï¼Œç›®å‰èƒ½æ´»åŠ¨çš„çº¿ç¨‹æ•°åˆ™ä¸º512ä¸ªï¼Œå¦‚æœæŠŠæ ˆå†…å­˜æ”¹ä¸º2048kï¼Œé‚£ä¹ˆèƒ½æ´»åŠ¨çš„æ ˆå¸§å°±ä¼šå‡åŠ</p></li><li><p>æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ</p><ul><li><p>å¦‚æœæ–¹æ³•å†…å±€éƒ¨å˜é‡æ²¡æœ‰é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„</p></li><li><p>å¦‚æœæ˜¯å±€éƒ¨å˜é‡å¼•ç”¨äº†å¯¹è±¡ï¼Œå¹¶é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨</p></li><li><p>æ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506095306061.png" alt="image-20230506095306061"></p></li></ul></li></ol><p><strong>æ ˆå†…å­˜æº¢å‡ºæƒ…å†µ</strong></p><ul><li><p>æ ˆå¸§è¿‡å¤šå¯¼è‡´æ ˆå†…å­˜æº¢å‡ºï¼Œå…¸å‹é—®é¢˜ï¼šé€’å½’è°ƒç”¨</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506095401637.png" alt="image-20230506095401637"></p></li><li><p>æ ˆå¸§è¿‡å¤§å¯¼è‡´æ ˆå†…å­˜æº¢å‡º</p></li></ul><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><p>ç»„æˆéƒ¨åˆ†ï¼šå †ã€æ–¹æ³•åŒºã€æ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨</p><p>1ã€å †è§£å†³çš„æ˜¯å¯¹è±¡å®ä¾‹å­˜å‚¨çš„é—®é¢˜ï¼Œåƒåœ¾å›æ”¶å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸã€‚<br>2ã€æ–¹æ³•åŒºå¯ä»¥è®¤ä¸ºæ˜¯å †çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ä¿¡æ¯ï¼Œå¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ã€‚<br>3ã€æ ˆè§£å†³çš„æ˜¯ç¨‹åºè¿è¡Œçš„é—®é¢˜ï¼Œæ ˆé‡Œé¢å­˜çš„æ˜¯æ ˆå¸§ï¼Œæ ˆå¸§é‡Œé¢å­˜çš„æ˜¯å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚<br>4ã€æœ¬åœ°æ–¹æ³•æ ˆä¸æ ˆåŠŸèƒ½ç›¸åŒï¼Œæœ¬åœ°æ–¹æ³•æ ˆæ‰§è¡Œçš„æ˜¯æœ¬åœ°æ–¹æ³•ï¼Œä¸€ä¸ªJavaè°ƒç”¨éJavaä»£ç çš„æ¥å£ã€‚<br>5ã€ç¨‹åºè®¡æ•°å™¨ï¼ˆPCå¯„å­˜å™¨ï¼‰ç¨‹åºè®¡æ•°å™¨ä¸­å­˜æ”¾çš„æ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œæ•°ã€‚JVMå·¥ä½œæ—¶å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€ä¸ªéœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</p><h3 id="1-5-èƒ½ä¸èƒ½è§£é‡Šä¸€ä¸‹æ–¹æ³•åŒºï¼Ÿ"><a href="#1-5-èƒ½ä¸èƒ½è§£é‡Šä¸€ä¸‹æ–¹æ³•åŒºï¼Ÿ" class="headerlink" title="1.5 èƒ½ä¸èƒ½è§£é‡Šä¸€ä¸‹æ–¹æ³•åŒºï¼Ÿ"></a>1.5 èƒ½ä¸èƒ½è§£é‡Šä¸€ä¸‹æ–¹æ³•åŒºï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><h4 id="1-5-1-æ¦‚è¿°"><a href="#1-5-1-æ¦‚è¿°" class="headerlink" title="1.5.1 æ¦‚è¿°"></a>1.5.1 æ¦‚è¿°</h4><ul><li><p>æ–¹æ³•åŒº(Method Area)æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸ</p></li><li><p>ä¸»è¦å­˜å‚¨ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± </p></li><li><p>è™šæ‹Ÿæœºå¯åŠ¨çš„æ—¶å€™åˆ›å»ºï¼Œå…³é—­è™šæ‹Ÿæœºæ—¶é‡Šæ”¾</p></li><li><p>å¦‚æœæ–¹æ³•åŒºåŸŸä¸­çš„å†…å­˜æ— æ³•æ»¡è¶³åˆ†é…è¯·æ±‚ï¼Œåˆ™ä¼šæŠ›å‡ºOutOfMemoryError: Metaspace</p></li></ul><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506095504213.png" alt="image-20230506095504213"></p><h4 id="1-5-2-å¸¸é‡æ± "><a href="#1-5-2-å¸¸é‡æ± " class="headerlink" title="1.5.2 å¸¸é‡æ± "></a>1.5.2 å¸¸é‡æ± </h4><p>å¯ä»¥çœ‹ä½œæ˜¯ä¸€å¼ è¡¨ï¼Œè™šæ‹ŸæœºæŒ‡ä»¤æ ¹æ®è¿™å¼ å¸¸é‡è¡¨æ‰¾åˆ°è¦æ‰§è¡Œçš„ç±»åã€æ–¹æ³•åã€å‚æ•°ç±»å‹ã€å­—é¢é‡ç­‰ä¿¡æ¯</p><p>æŸ¥çœ‹å­—èŠ‚ç ç»“æ„ï¼ˆç±»çš„åŸºæœ¬ä¿¡æ¯ã€å¸¸é‡æ± ã€æ–¹æ³•å®šä¹‰ï¼‰<code>javap -v xx.class</code></p><p>æ¯”å¦‚ä¸‹é¢æ˜¯ä¸€ä¸ªApplicationç±»çš„mainæ–¹æ³•æ‰§è¡Œï¼Œæºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°ç±»å¯¹åº”çš„classæ–‡ä»¶å­˜æ”¾ç›®å½•ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š<code>javap -v Application.class</code>   æŸ¥çœ‹å­—èŠ‚ç ç»“æ„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">D:\code\jvm-demo\target\classes\com\heima\jvm&gt;javap -v Application.<span class="keyword">class</span></span><br><span class="line"><span class="title class_">Classfile</span> /D:/code/jvm-demo/target/classes/com/heima/jvm/Application.<span class="keyword">class</span></span><br><span class="line">  <span class="title class_">Last</span> modified <span class="number">2023</span>-<span class="number">05</span>-<span class="number">07</span>; size <span class="number">564</span> bytes    <span class="comment">//æœ€åä¿®æ”¹çš„æ—¶é—´</span></span><br><span class="line">  MD5 checksum c1b64ed6491b9a16c2baab5061c64f88   <span class="comment">//ç­¾å</span></span><br><span class="line">  Compiled from <span class="string">&quot;Application.java&quot;</span>   <span class="comment">//ä»å“ªä¸ªæºç ç¼–è¯‘</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">com</span>.heima.jvm.Application   <span class="comment">//åŒ…åï¼Œç±»å</span></span><br><span class="line">  minor version: <span class="number">0</span></span><br><span class="line">  major version: <span class="number">52</span>     <span class="comment">//jdkç‰ˆæœ¬</span></span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER  <span class="comment">//ä¿®é¥°ç¬¦</span></span><br><span class="line">Constant pool:   <span class="comment">//å¸¸é‡æ± </span></span><br><span class="line">   #<span class="number">1</span> = Methodref          #<span class="number">6.</span>#<span class="number">20</span>         <span class="comment">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">   #<span class="number">2</span> = Fieldref           #<span class="number">21.</span>#<span class="number">22</span>        <span class="comment">// java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">   #<span class="number">3</span> = String             #<span class="number">23</span>            <span class="comment">// hello world</span></span><br><span class="line">   #<span class="number">4</span> = Methodref          #<span class="number">24.</span>#<span class="number">25</span>        <span class="comment">// java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">   #<span class="number">5</span> = Class              #<span class="number">26</span>            <span class="comment">// com/heima/jvm/Application</span></span><br><span class="line">   #<span class="number">6</span> = Class              #<span class="number">27</span>            <span class="comment">// java/lang/Object</span></span><br><span class="line">   #<span class="number">7</span> = Utf8               &lt;init&gt;</span><br><span class="line">   #<span class="number">8</span> = Utf8               ()V</span><br><span class="line">   #<span class="number">9</span> = Utf8               Code</span><br><span class="line">  #<span class="number">10</span> = Utf8               LineNumberTable</span><br><span class="line">  #<span class="number">11</span> = Utf8               LocalVariableTable</span><br><span class="line">  #<span class="number">12</span> = Utf8               <span class="built_in">this</span></span><br><span class="line">  #<span class="number">13</span> = Utf8               Lcom/heima/jvm/Application;</span><br><span class="line">  #<span class="number">14</span> = Utf8               main</span><br><span class="line">  #<span class="number">15</span> = Utf8               ([Ljava/lang/String;)V</span><br><span class="line">  #<span class="number">16</span> = Utf8               args</span><br><span class="line">  #<span class="number">17</span> = Utf8               [Ljava/lang/String;</span><br><span class="line">  #<span class="number">18</span> = Utf8               SourceFile</span><br><span class="line">  #<span class="number">19</span> = Utf8               Application.java</span><br><span class="line">  #<span class="number">20</span> = NameAndType        #<span class="number">7</span>:#<span class="number">8</span>          <span class="comment">// &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">  #<span class="number">21</span> = Class              #<span class="number">28</span>            <span class="comment">// java/lang/System</span></span><br><span class="line">  #<span class="number">22</span> = NameAndType        #<span class="number">29</span>:#<span class="number">30</span>        <span class="comment">// out:Ljava/io/PrintStream;</span></span><br><span class="line">  #<span class="number">23</span> = Utf8               hello world</span><br><span class="line">  #<span class="number">24</span> = Class              #<span class="number">31</span>            <span class="comment">// java/io/PrintStream</span></span><br><span class="line">  #<span class="number">25</span> = NameAndType        #<span class="number">32</span>:#<span class="number">33</span>        <span class="comment">// println:(Ljava/lang/String;)V</span></span><br><span class="line">  #<span class="number">26</span> = Utf8               com/heima/jvm/Application</span><br><span class="line">  #<span class="number">27</span> = Utf8               java/lang/Object</span><br><span class="line">  #<span class="number">28</span> = Utf8               java/lang/System</span><br><span class="line">  #<span class="number">29</span> = Utf8               out</span><br><span class="line">  #<span class="number">30</span> = Utf8               Ljava/io/PrintStream;</span><br><span class="line">  #<span class="number">31</span> = Utf8               java/io/PrintStream</span><br><span class="line">  #<span class="number">32</span> = Utf8               println</span><br><span class="line">  #<span class="number">33</span> = Utf8               (Ljava/lang/String;)V</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> com.heima.jvm.Application();  <span class="comment">//æ„é€ æ–¹æ³•</span></span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="number">1</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">3</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="built_in">this</span>   Lcom/heima/jvm/Application;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(java.lang.String[])</span>;  <span class="comment">//mainæ–¹æ³•</span></span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: getstatic     #<span class="number">2</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">         <span class="number">3</span>: ldc           #<span class="number">3</span>                  <span class="comment">// String hello world</span></span><br><span class="line">         <span class="number">5</span>: invokevirtual #<span class="number">4</span>                  <span class="comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">         <span class="number">8</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">7</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">8</span>: <span class="number">8</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">9</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: <span class="string">&quot;Application.java&quot;</span></span><br></pre></td></tr></table></figure><p>ä¸‹å›¾ï¼Œå·¦ä¾§æ˜¯mainæ–¹æ³•çš„æŒ‡ä»¤ä¿¡æ¯ï¼Œå³ä¾§constant pool  æ˜¯å¸¸é‡æ± </p><p>mainæ–¹æ³•æŒ‰ç…§æŒ‡ä»¤æ‰§è¡Œçš„æ—¶å€™ï¼Œéœ€è¦åˆ°å¸¸é‡æ± ä¸­æŸ¥è¡¨ç¿»è¯‘æ‰¾åˆ°å…·ä½“çš„ç±»å’Œæ–¹æ³•åœ°å€å»æ‰§è¡Œ</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506095634842.png" alt="image-20230506095634842"></p><h4 id="1-5-3-è¿è¡Œæ—¶å¸¸é‡æ± "><a href="#1-5-3-è¿è¡Œæ—¶å¸¸é‡æ± " class="headerlink" title="1.5.3 è¿è¡Œæ—¶å¸¸é‡æ± "></a>1.5.3 è¿è¡Œæ—¶å¸¸é‡æ± </h4><p>å¸¸é‡æ± æ˜¯ *.class æ–‡ä»¶ä¸­çš„ï¼Œå½“è¯¥ç±»è¢«åŠ è½½ï¼Œå®ƒçš„å¸¸é‡æ± ä¿¡æ¯å°±ä¼šæ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œå¹¶æŠŠé‡Œé¢çš„ç¬¦å·åœ°å€å˜ä¸ºçœŸå®åœ°å€</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506100142724.png" alt="image-20230506100142724"></p><h3 id="1-6-ä½ å¬è¿‡ç›´æ¥å†…å­˜å—ï¼Ÿ"><a href="#1-6-ä½ å¬è¿‡ç›´æ¥å†…å­˜å—ï¼Ÿ" class="headerlink" title="1.6 ä½ å¬è¿‡ç›´æ¥å†…å­˜å—ï¼Ÿ"></a>1.6 ä½ å¬è¿‡ç›´æ¥å†…å­˜å—ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><p>ä¸å— JVM å†…å­˜å›æ”¶ç®¡ç†ï¼Œæ˜¯è™šæ‹Ÿæœºçš„ç³»ç»Ÿå†…å­˜ï¼Œå¸¸è§äº NIO æ“ä½œæ—¶ï¼Œç”¨äºæ•°æ®ç¼“å†²åŒºï¼Œåˆ†é…å›æ”¶æˆæœ¬è¾ƒé«˜ï¼Œä½†è¯»å†™æ€§èƒ½é«˜ï¼Œä¸å— JVM å†…å­˜å›æ”¶ç®¡ç†</p><p>ä¸¾ä¾‹ï¼š</p><p>éœ€æ±‚ï¼Œåœ¨æœ¬åœ°ç”µè„‘ä¸­çš„ä¸€ä¸ªè¾ƒå¤§çš„æ–‡ä»¶ï¼ˆè¶…è¿‡100mï¼‰ä»ä¸€ä¸ªç£ç›˜æŒªåˆ°å¦å¤–ä¸€ä¸ªç£ç›˜</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506100501905.png" alt="image-20230506100501905"></p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¼”ç¤º ByteBuffer ä½œç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_9</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FROM</span> <span class="operator">=</span> <span class="string">&quot;E:\\ç¼–ç¨‹èµ„æ–™\\ç¬¬ä¸‰æ–¹æ•™å­¦è§†é¢‘\\youtube\\Getting Started with Spring Boot-sbPSjI4tt10.mp4&quot;</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TO</span> <span class="operator">=</span> <span class="string">&quot;E:\\a.mp4&quot;</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_1Mb</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        io(); <span class="comment">// io ç”¨æ—¶ï¼š1535.586957 1766.963399 1359.240226</span></span><br><span class="line">        directBuffer(); <span class="comment">// directBuffer ç”¨æ—¶ï¼š479.295165 702.291454 562.56592</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">directBuffer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileChannel</span> <span class="variable">from</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(FROM).getChannel();</span><br><span class="line">             <span class="type">FileChannel</span> <span class="variable">to</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(TO).getChannel();</span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">bb</span> <span class="operator">=</span> ByteBuffer.allocateDirect(_1Mb);</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> from.read(bb);</span><br><span class="line">                <span class="keyword">if</span> (len == -<span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                bb.flip();</span><br><span class="line">                to.write(bb);</span><br><span class="line">                bb.clear();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">        System.out.println(<span class="string">&quot;directBuffer ç”¨æ—¶ï¼š&quot;</span> + (end - start) / <span class="number">1000_000.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">io</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileInputStream</span> <span class="variable">from</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(FROM);</span><br><span class="line">             <span class="type">FileOutputStream</span> <span class="variable">to</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(TO);</span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="type">byte</span>[] buf = <span class="keyword">new</span> <span class="title class_">byte</span>[_1Mb];</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> from.read(buf);</span><br><span class="line">                <span class="keyword">if</span> (len == -<span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                to.write(buf, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">        System.out.println(<span class="string">&quot;io ç”¨æ—¶ï¼š&quot;</span> + (end - start) / <span class="number">1000_000.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œä½¿ç”¨ä¼ ç»Ÿçš„IOçš„æ—¶é—´è¦æ¯”NIOæ“ä½œçš„æ—¶é—´é•¿äº†å¾ˆå¤šäº†ï¼Œä¹Ÿå°±è¯´NIOçš„è¯»æ€§èƒ½æ›´å¥½ã€‚</p><p>è¿™ä¸ªæ˜¯è·Ÿæˆ‘ä»¬çš„JVMçš„ç›´æ¥å†…å­˜æ˜¯æœ‰ä¸€å®šå…³ç³»ï¼Œå¦‚ä¸‹å›¾ï¼Œæ˜¯ä¼ ç»Ÿé˜»å¡IOçš„æ•°æ®ä¼ è¾“æµç¨‹</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506100548455.png" alt="image-20230506100548455"></p><p>ä¸‹å›¾æ˜¯NIOä¼ è¾“æ•°æ®çš„æµç¨‹ï¼Œåœ¨è¿™ä¸ªé‡Œé¢ä¸»è¦ä½¿ç”¨åˆ°äº†ä¸€ä¸ªç›´æ¥å†…å­˜ï¼Œä¸éœ€è¦åœ¨å †ä¸­å¼€è¾Ÿç©ºé—´è¿›è¡Œæ•°æ®çš„æ‹·è´ï¼Œjvmå¯ä»¥ç›´æ¥æ“ä½œç›´æ¥å†…å­˜ï¼Œä»è€Œä½¿æ•°æ®è¯»å†™ä¼ è¾“æ›´å¿«ã€‚</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506100621146.png" alt="image-20230506100621146"></p><h3 id="1-7-å †æ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-7-å †æ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.7 å †æ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1.7 å †æ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><p>1ã€æ ˆå†…å­˜ä¸€èˆ¬ä¼šç”¨æ¥å­˜å‚¨å±€éƒ¨å˜é‡å’Œæ–¹æ³•è°ƒç”¨ï¼Œä½†å †å†…å­˜æ˜¯ç”¨æ¥å­˜å‚¨Javaå¯¹è±¡å’Œæ•°ç»„çš„çš„ã€‚å †ä¼šGCåƒåœ¾å›æ”¶ï¼Œè€Œæ ˆä¸ä¼šã€‚</p><p>2ã€æ ˆå†…å­˜æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œè€Œå †å†…å­˜æ˜¯çº¿ç¨‹å…±æœ‰çš„ã€‚</p><p>3,ã€ä¸¤è€…å¼‚å¸¸é”™è¯¯ä¸åŒï¼Œä½†å¦‚æœæ ˆå†…å­˜æˆ–è€…å †å†…å­˜ä¸è¶³éƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><p>æ ˆç©ºé—´ä¸è¶³ï¼šjava.lang.StackOverFlowErrorã€‚</p><p>å †ç©ºé—´ä¸è¶³ï¼šjava.lang.OutOfMemoryErrorã€‚</p><h2 id="2-ç±»åŠ è½½å™¨"><a href="#2-ç±»åŠ è½½å™¨" class="headerlink" title="2 ç±»åŠ è½½å™¨"></a>2 ç±»åŠ è½½å™¨</h2><h3 id="2-1-ä»€ä¹ˆæ˜¯ç±»åŠ è½½å™¨ï¼Œç±»åŠ è½½å™¨æœ‰å“ªäº›"><a href="#2-1-ä»€ä¹ˆæ˜¯ç±»åŠ è½½å™¨ï¼Œç±»åŠ è½½å™¨æœ‰å“ªäº›" class="headerlink" title="2.1 ä»€ä¹ˆæ˜¯ç±»åŠ è½½å™¨ï¼Œç±»åŠ è½½å™¨æœ‰å“ªäº›?"></a>2.1 ä»€ä¹ˆæ˜¯ç±»åŠ è½½å™¨ï¼Œç±»åŠ è½½å™¨æœ‰å“ªäº›?</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><p>è¦æƒ³ç†è§£ç±»åŠ è½½å™¨çš„è¯ï¼ŒåŠ¡å¿…è¦å…ˆæ¸…æ¥šå¯¹äºä¸€ä¸ªJavaæ–‡ä»¶ï¼Œå®ƒä»ç¼–è¯‘åˆ°æ‰§è¡Œçš„æ•´ä¸ªè¿‡ç¨‹ã€‚</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220903233627146.png"></p><ul><li>ç±»åŠ è½½å™¨ï¼šç”¨äºè£…è½½å­—èŠ‚ç æ–‡ä»¶(.classæ–‡ä»¶)</li><li>è¿è¡Œæ—¶æ•°æ®åŒºï¼šç”¨äºåˆ†é…å­˜å‚¨ç©ºé—´</li><li>æ‰§è¡Œå¼•æ“ï¼šæ‰§è¡Œå­—èŠ‚ç æ–‡ä»¶æˆ–æœ¬åœ°æ–¹æ³•</li><li>åƒåœ¾å›æ”¶å™¨ï¼šç”¨äºå¯¹JVMä¸­çš„åƒåœ¾å†…å®¹è¿›è¡Œå›æ”¶</li></ul><p><strong>ç±»åŠ è½½å™¨</strong></p><p>JVMåªä¼šè¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè€Œç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰çš„ä¸»è¦ä½œç”¨å°±æ˜¯å°†<strong>å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°JVMä¸­</strong>ï¼Œä»è€Œè®©Javaç¨‹åºèƒ½å¤Ÿå¯åŠ¨èµ·æ¥ã€‚ç°æœ‰çš„ç±»åŠ è½½å™¨åŸºæœ¬ä¸Šéƒ½æ˜¯java.lang.ClassLoaderçš„å­ç±»ï¼Œè¯¥ç±»çš„åªè¦èŒè´£å°±æ˜¯ç”¨äºå°†æŒ‡å®šçš„ç±»æ‰¾åˆ°æˆ–ç”Ÿæˆå¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶ï¼ŒåŒæ—¶ç±»åŠ è½½å™¨è¿˜ä¼šè´Ÿè´£åŠ è½½ç¨‹åºæ‰€éœ€è¦çš„èµ„æº</p><p><strong>ç±»åŠ è½½å™¨ç§ç±»</strong></p><p>ç±»åŠ è½½å™¨æ ¹æ®å„è‡ªåŠ è½½èŒƒå›´çš„ä¸åŒï¼Œåˆ’åˆ†ä¸ºå››ç§ç±»åŠ è½½å™¨ï¼š</p><ul><li><p><strong>å¯åŠ¨ç±»åŠ è½½å™¨(BootStrap ClassLoader)ï¼š</strong></p><p>è¯¥ç±»å¹¶ä¸ç»§æ‰¿ClassLoaderç±»ï¼Œå…¶æ˜¯ç”±C++ç¼–å†™å®ç°ã€‚ç”¨äºåŠ è½½<strong>JAVA_HOME&#x2F;jre&#x2F;lib</strong>ç›®å½•ä¸‹çš„ç±»åº“ã€‚</p></li><li><p><strong>æ‰©å±•ç±»åŠ è½½å™¨(ExtClassLoader)ï¼š</strong></p><p>è¯¥ç±»æ˜¯ClassLoaderçš„å­ç±»ï¼Œä¸»è¦åŠ è½½<strong>JAVA_HOME&#x2F;jre&#x2F;lib&#x2F;ext</strong>ç›®å½•ä¸­çš„ç±»åº“ã€‚</p></li><li><p><strong>åº”ç”¨ç±»åŠ è½½å™¨(AppClassLoader)ï¼š</strong></p><p>è¯¥ç±»æ˜¯ClassLoaderçš„å­ç±»ï¼Œä¸»è¦ç”¨äºåŠ è½½<strong>classPath</strong>ä¸‹çš„ç±»ï¼Œä¹Ÿå°±æ˜¯åŠ è½½å¼€å‘è€…è‡ªå·±ç¼–å†™çš„Javaç±»ã€‚</p></li><li><p><strong>è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼š</strong></p><p>å¼€å‘è€…è‡ªå®šä¹‰ç±»ç»§æ‰¿ClassLoaderï¼Œå®ç°è‡ªå®šä¹‰ç±»åŠ è½½è§„åˆ™ã€‚</p></li></ul><p>ä¸Šè¿°ä¸‰ç§ç±»åŠ è½½å™¨çš„å±‚æ¬¡ç»“æ„å¦‚ä¸‹å¦‚ä¸‹ï¼š</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506100746624.png" alt="image-20230506100746624"></p><p>ç±»åŠ è½½å™¨çš„ä½“ç³»å¹¶ä¸æ˜¯â€œç»§æ‰¿â€ä½“ç³»ï¼Œè€Œæ˜¯<strong>å§”æ´¾ä½“ç³»</strong>ï¼Œç±»åŠ è½½å™¨é¦–å…ˆä¼šåˆ°è‡ªå·±çš„parentä¸­æŸ¥æ‰¾ç±»æˆ–è€…èµ„æºï¼Œå¦‚æœæ‰¾ä¸åˆ°æ‰ä¼šåˆ°è‡ªå·±æœ¬åœ°æŸ¥æ‰¾ã€‚ç±»åŠ è½½å™¨çš„å§”æ‰˜è¡Œä¸ºåŠ¨æœºæ˜¯ä¸ºäº†é¿å…ç›¸åŒçš„ç±»è¢«åŠ è½½å¤šæ¬¡ã€‚</p><h3 id="2-2-ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ"><a href="#2-2-ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ" class="headerlink" title="2.2 ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ"></a>2.2 ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><p>å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨åœ¨æ¥åˆ°åŠ è½½ç±»çš„è¯·æ±‚æ—¶ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å°è¯•å»åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚ä»»åŠ¡å§”æ‰˜ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œä¾æ¬¡é€’å½’ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»åŠ è½½ä»»åŠ¡ï¼Œå°±è¿”å›æˆåŠŸï¼›åªæœ‰çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆæ­¤åŠ è½½ä»»åŠ¡æ—¶ï¼Œæ‰ç”±ä¸‹ä¸€çº§å»åŠ è½½ã€‚ </p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506100920042.png" alt="image-20230506100920042"></p><h3 id="2-3-JVMä¸ºä»€ä¹ˆé‡‡ç”¨åŒäº²å§”æ´¾æœºåˆ¶"><a href="#2-3-JVMä¸ºä»€ä¹ˆé‡‡ç”¨åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="2.3 JVMä¸ºä»€ä¹ˆé‡‡ç”¨åŒäº²å§”æ´¾æœºåˆ¶"></a>2.3 JVMä¸ºä»€ä¹ˆé‡‡ç”¨åŒäº²å§”æ´¾æœºåˆ¶</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><p>ï¼ˆ1ï¼‰é€šè¿‡åŒäº²å§”æ´¾æœºåˆ¶å¯ä»¥é¿å…æŸä¸€ä¸ªç±»è¢«é‡å¤åŠ è½½ï¼Œå½“çˆ¶ç±»å·²ç»åŠ è½½ååˆ™æ— éœ€é‡å¤åŠ è½½ï¼Œä¿è¯å”¯ä¸€æ€§ã€‚</p><p>ï¼ˆ2ï¼‰ä¸ºäº†å®‰å…¨ï¼Œä¿è¯ç±»åº“APIä¸ä¼šè¢«ä¿®æ”¹</p><p>åœ¨å·¥ç¨‹ä¸­æ–°å»ºjava.langåŒ…ï¼Œæ¥ç€åœ¨è¯¥åŒ…ä¸‹æ–°å»ºStringç±»ï¼Œå¹¶å®šä¹‰mainå‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">String</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;demo info&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æ­¤æ—¶æ‰§è¡Œmainå‡½æ•°ï¼Œä¼šå‡ºç°å¼‚å¸¸ï¼Œåœ¨ç±» java.lang.String ä¸­æ‰¾ä¸åˆ° main æ–¹æ³•</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220903144547378.png" alt="image-20220903144547378"></p><p>â€‹å‡ºç°è¯¥ä¿¡æ¯æ˜¯å› ä¸ºç”±åŒäº²å§”æ´¾çš„æœºåˆ¶ï¼Œjava.lang.Stringçš„åœ¨å¯åŠ¨ç±»åŠ è½½å™¨(Bootstrap classLoader)å¾—åˆ°åŠ è½½ï¼Œå› ä¸ºåœ¨æ ¸å¿ƒjreåº“ä¸­æœ‰å…¶ç›¸åŒåå­—çš„ç±»æ–‡ä»¶ï¼Œä½†è¯¥ç±»ä¸­å¹¶æ²¡æœ‰mainæ–¹æ³•ã€‚è¿™æ ·å°±èƒ½é˜²æ­¢æ¶æ„ç¯¡æ”¹æ ¸å¿ƒAPIåº“ã€‚</p><h3 id="2-4-è¯´ä¸€ä¸‹ç±»è£…è½½çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ"><a href="#2-4-è¯´ä¸€ä¸‹ç±»è£…è½½çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ" class="headerlink" title="2.4 è¯´ä¸€ä¸‹ç±»è£…è½½çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ"></a>2.4 è¯´ä¸€ä¸‹ç±»è£…è½½çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><p>ç±»ä»åŠ è½½åˆ°è™šæ‹Ÿæœºä¸­å¼€å§‹ï¼Œç›´åˆ°å¸è½½ä¸ºæ­¢ï¼Œå®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬äº†ï¼šåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–ã€ä½¿ç”¨å’Œå¸è½½è¿™7ä¸ªé˜¶æ®µã€‚å…¶ä¸­ï¼ŒéªŒè¯ã€å‡†å¤‡å’Œè§£æè¿™ä¸‰ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºè¿æ¥ï¼ˆlinkingï¼‰ã€‚</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506101032605.png" alt="image-20230506101032605"></p><p><strong>ç±»åŠ è½½è¿‡ç¨‹è¯¦è§£</strong></p><p>1.åŠ è½½</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506101115674.png" alt="image-20230506101115674"> </p><ul><li><p>é€šè¿‡ç±»çš„å…¨åï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµã€‚</p></li><li><p>è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµä¸ºæ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„ï¼ˆJavaç±»æ¨¡å‹ï¼‰ </p></li><li><p>åˆ›å»ºjava.lang.Classç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ã€‚ä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£</p></li></ul><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506101213373.png" alt="image-20230506101213373"></p><p>2.éªŒè¯</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506101420202.png" alt="image-20230506101420202"></p><p><strong>éªŒè¯ç±»æ˜¯å¦ç¬¦åˆJVMè§„èŒƒï¼Œå®‰å…¨æ€§æ£€æŸ¥</strong></p><p>(1)æ–‡ä»¶æ ¼å¼éªŒè¯:æ˜¯å¦ç¬¦åˆClassæ–‡ä»¶çš„è§„èŒƒ<br>(2)å…ƒæ•°æ®éªŒè¯<br>    è¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»ï¼ˆé™¤äº†Objectè¿™ä¸ªç±»ä¹‹å¤–ï¼Œå…¶ä½™çš„ç±»éƒ½åº”è¯¥æœ‰çˆ¶ç±»ï¼‰<br>    è¿™ä¸ªç±»æ˜¯å¦ç»§æ‰¿ï¼ˆextendsï¼‰äº†è¢«finalä¿®é¥°è¿‡çš„ç±»ï¼ˆè¢«finalä¿®é¥°è¿‡çš„ç±»è¡¨ç¤ºç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼‰<br>    ç±»ä¸­çš„å­—æ®µã€æ–¹æ³•æ˜¯å¦ä¸çˆ¶ç±»äº§ç”ŸçŸ›ç›¾ã€‚ï¼ˆè¢«finalä¿®é¥°è¿‡çš„æ–¹æ³•æˆ–å­—æ®µæ˜¯ä¸èƒ½è¦†ç›–çš„ï¼‰<br>(3)å­—èŠ‚ç éªŒè¯<br>    ä¸»è¦çš„ç›®çš„æ˜¯é€šè¿‡å¯¹æ•°æ®æµå’Œæ§åˆ¶æµçš„åˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„ã€‚<br>(4)ç¬¦å·å¼•ç”¨éªŒè¯ï¼šç¬¦å·å¼•ç”¨ä»¥ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡</p><blockquote><p>æ¯”å¦‚ï¼šint i &#x3D; 3;<br>å­—é¢é‡ï¼š3<br>ç¬¦å·å¼•ç”¨ï¼ši</p></blockquote><p>3.å‡†å¤‡</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506101445898.png" alt="image-20230506101445898"></p><p><strong>ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼</strong></p><ul><li><p>staticå˜é‡ï¼Œåˆ†é…ç©ºé—´åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆï¼ˆè®¾ç½®é»˜è®¤å€¼ï¼‰ï¼Œèµ‹å€¼åœ¨åˆå§‹åŒ–é˜¶æ®µå®Œæˆ</p></li><li><p>staticå˜é‡æ˜¯finalçš„åŸºæœ¬ç±»å‹ï¼Œä»¥åŠå­—ç¬¦ä¸²å¸¸é‡ï¼Œå€¼å·²ç¡®å®šï¼Œèµ‹å€¼åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆ</p></li><li><p>staticå˜é‡æ˜¯finalçš„å¼•ç”¨ç±»å‹ï¼Œé‚£ä¹ˆèµ‹å€¼ä¹Ÿä¼šåœ¨åˆå§‹åŒ–é˜¶æ®µå®Œæˆ</p></li></ul><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506101824622.png" alt="image-20230506101824622"></p><p>4.è§£æ</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506101504632.png" alt="image-20230506101504632"></p><p><strong>æŠŠç±»ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨</strong></p><p>æ¯”å¦‚ï¼šæ–¹æ³•ä¸­è°ƒç”¨äº†å…¶ä»–æ–¹æ³•ï¼Œæ–¹æ³•åå¯ä»¥ç†è§£ä¸ºç¬¦å·å¼•ç”¨ï¼Œè€Œç›´æ¥å¼•ç”¨å°±æ˜¯ä½¿ç”¨æŒ‡é’ˆç›´æ¥æŒ‡å‘æ–¹æ³•ã€‚</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506102311951.png" alt="image-20230506102311951"></p><p>5.åˆå§‹åŒ–</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506101625087.png" alt="image-20230506101625087"></p><p><strong>å¯¹ç±»çš„é™æ€å˜é‡ï¼Œé™æ€ä»£ç å—æ‰§è¡Œåˆå§‹åŒ–æ“ä½œ</strong></p><ul><li><p>å¦‚æœåˆå§‹åŒ–ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå…¶çˆ¶ç±»å°šæœªåˆå§‹åŒ–ï¼Œåˆ™ä¼˜å…ˆåˆå§‹åŒ–å…¶çˆ¶ç±»ã€‚</p></li><li><p>å¦‚æœåŒæ—¶åŒ…å«å¤šä¸ªé™æ€å˜é‡å’Œé™æ€ä»£ç å—ï¼Œåˆ™æŒ‰ç…§è‡ªä¸Šè€Œä¸‹çš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</p></li></ul><p>6.ä½¿ç”¨</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506101641837.png" alt="image-20230506101641837"></p><p>JVM å¼€å§‹ä»å…¥å£æ–¹æ³•å¼€å§‹æ‰§è¡Œç”¨æˆ·çš„ç¨‹åºä»£ç </p><ul><li><p>è°ƒç”¨é™æ€ç±»æˆå‘˜ä¿¡æ¯ï¼ˆæ¯”å¦‚ï¼šé™æ€å­—æ®µã€é™æ€æ–¹æ³•ï¼‰</p></li><li><p>ä½¿ç”¨newå…³é”®å­—ä¸ºå…¶åˆ›å»ºå¯¹è±¡å®ä¾‹</p></li></ul><p>7.å¸è½½</p><p>å½“ç”¨æˆ·ç¨‹åºä»£ç æ‰§è¡Œå®Œæ¯•åï¼ŒJVM ä¾¿å¼€å§‹é”€æ¯åˆ›å»ºçš„ Class å¯¹è±¡ï¼Œæœ€åè´Ÿè´£è¿è¡Œçš„ JVM ä¹Ÿé€€å‡ºå†…å­˜</p><h2 id="3-åƒåœ¾å›æ”¶"><a href="#3-åƒåœ¾å›æ”¶" class="headerlink" title="3 åƒåœ¾å›æ”¶"></a>3 åƒåœ¾å›æ”¶</h2><h3 id="3-1-ç®€è¿°Javaåƒåœ¾å›æ”¶æœºåˆ¶ï¼Ÿï¼ˆGCæ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦GCï¼‰"><a href="#3-1-ç®€è¿°Javaåƒåœ¾å›æ”¶æœºåˆ¶ï¼Ÿï¼ˆGCæ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦GCï¼‰" class="headerlink" title="3.1 ç®€è¿°Javaåƒåœ¾å›æ”¶æœºåˆ¶ï¼Ÿï¼ˆGCæ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦GCï¼‰"></a>3.1 ç®€è¿°Javaåƒåœ¾å›æ”¶æœºåˆ¶ï¼Ÿï¼ˆGCæ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦GCï¼‰</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><p>ä¸ºäº†è®©ç¨‹åºå‘˜æ›´ä¸“æ³¨äºä»£ç çš„å®ç°ï¼Œè€Œä¸ç”¨è¿‡å¤šçš„è€ƒè™‘å†…å­˜é‡Šæ”¾çš„é—®é¢˜ï¼Œæ‰€ä»¥ï¼Œåœ¨Javaè¯­è¨€ä¸­ï¼Œæœ‰äº†è‡ªåŠ¨çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„GC(Garbage Collection)ã€‚</p><p>æœ‰äº†åƒåœ¾å›æ”¶æœºåˆ¶åï¼Œç¨‹åºå‘˜åªéœ€è¦å…³å¿ƒå†…å­˜çš„ç”³è¯·å³å¯ï¼Œå†…å­˜çš„é‡Šæ”¾ç”±ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«å®Œæˆã€‚</p><p>åœ¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œä¸åŒçš„å¯¹è±¡å¼•ç”¨ç±»å‹ï¼ŒGCä¼šé‡‡ç”¨ä¸åŒçš„å›æ”¶æ—¶æœº</p><p>æ¢å¥è¯è¯´ï¼Œè‡ªåŠ¨çš„åƒåœ¾å›æ”¶çš„ç®—æ³•å°±ä¼šå˜å¾—éå¸¸é‡è¦äº†ï¼Œå¦‚æœå› ä¸ºç®—æ³•çš„ä¸åˆç†ï¼Œå¯¼è‡´å†…å­˜èµ„æºä¸€ç›´æ²¡æœ‰é‡Šæ”¾ï¼ŒåŒæ ·ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºçš„ã€‚</p><p>å½“ç„¶ï¼Œé™¤äº†Javaè¯­è¨€ï¼ŒC#ã€Pythonç­‰è¯­è¨€ä¹Ÿéƒ½æœ‰è‡ªåŠ¨çš„åƒåœ¾å›æ”¶æœºåˆ¶ã€‚</p><h3 id="3-2-å¯¹è±¡ä»€ä¹ˆæ—¶å€™å¯ä»¥è¢«åƒåœ¾å™¨å›æ”¶"><a href="#3-2-å¯¹è±¡ä»€ä¹ˆæ—¶å€™å¯ä»¥è¢«åƒåœ¾å™¨å›æ”¶" class="headerlink" title="3.2 å¯¹è±¡ä»€ä¹ˆæ—¶å€™å¯ä»¥è¢«åƒåœ¾å™¨å›æ”¶"></a>3.2 å¯¹è±¡ä»€ä¹ˆæ—¶å€™å¯ä»¥è¢«åƒåœ¾å™¨å›æ”¶</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506104954777.png" alt="image-20230506104954777"></p><p>ç®€å•ä¸€å¥å°±æ˜¯ï¼šå¦‚æœä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡æ²¡æœ‰ä»»ä½•çš„å¼•ç”¨æŒ‡å‘å®ƒäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ç°åœ¨å°±æ˜¯åƒåœ¾ï¼Œå¦‚æœå®šä½äº†åƒåœ¾ï¼Œåˆ™æœ‰å¯èƒ½ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚</p><p>å¦‚æœè¦å®šä½ä»€ä¹ˆæ˜¯åƒåœ¾ï¼Œæœ‰ä¸¤ç§æ–¹å¼æ¥ç¡®å®šï¼Œç¬¬ä¸€ä¸ªæ˜¯å¼•ç”¨è®¡æ•°æ³•ï¼Œç¬¬äºŒä¸ªæ˜¯å¯è¾¾æ€§åˆ†æç®—æ³•</p><h4 id="3-2-1-å¼•ç”¨è®¡æ•°æ³•"><a href="#3-2-1-å¼•ç”¨è®¡æ•°æ³•" class="headerlink" title="3.2.1 å¼•ç”¨è®¡æ•°æ³•"></a>3.2.1 å¼•ç”¨è®¡æ•°æ³•</h4><p>ä¸€ä¸ªå¯¹è±¡è¢«å¼•ç”¨äº†ä¸€æ¬¡ï¼Œåœ¨å½“å‰çš„å¯¹è±¡å¤´ä¸Šé€’å¢ä¸€æ¬¡å¼•ç”¨æ¬¡æ•°ï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨æ¬¡æ•°ä¸º0ï¼Œä»£è¡¨è¿™ä¸ªå¯¹è±¡å¯å›æ”¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;123&quot;</span>);</span><br></pre></td></tr></table></figure><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506111102825.png" alt="image-20230506111102825"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506111136231.png" alt="image-20230506111136231"></p><p>å½“å¯¹è±¡é—´å‡ºç°äº†å¾ªç¯å¼•ç”¨çš„è¯ï¼Œåˆ™å¼•ç”¨è®¡æ•°æ³•å°±ä¼šå¤±æ•ˆ</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506111255401.png" alt="image-20230506111255401"></p><p>å…ˆæ‰§è¡Œå³ä¾§ä»£ç çš„å‰4è¡Œä»£ç </p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506111327590.png" alt="image-20230506111327590"></p><p>ç›®å‰ä¸Šæ–¹çš„å¼•ç”¨å…³ç³»å’Œè®¡æ•°éƒ½æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯ï¼Œå¦‚æœä»£ç ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œå¦‚ä¸‹å›¾</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506111512450.png" alt="image-20230506111512450"></p><p>è™½ç„¶aå’Œbéƒ½ä¸ºnullï¼Œä½†æ˜¯ç”±äºaå’Œbå­˜åœ¨å¾ªç¯å¼•ç”¨ï¼Œè¿™æ ·aå’Œbæ°¸è¿œéƒ½ä¸ä¼šè¢«å›æ”¶ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>å®æ—¶æ€§è¾ƒé«˜ï¼Œæ— éœ€ç­‰åˆ°å†…å­˜ä¸å¤Ÿçš„æ—¶å€™ï¼Œæ‰å¼€å§‹å›æ”¶ï¼Œè¿è¡Œæ—¶æ ¹æ®å¯¹è±¡çš„è®¡æ•°å™¨æ˜¯å¦ä¸º0ï¼Œå°±å¯ä»¥ç›´æ¥å›æ”¶ã€‚</li><li>åœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ï¼Œåº”ç”¨æ— éœ€æŒ‚èµ·ã€‚å¦‚æœç”³è¯·å†…å­˜æ—¶ï¼Œå†…å­˜ä¸è¶³ï¼Œåˆ™ç«‹åˆ»æŠ¥OOMé”™è¯¯ã€‚</li><li>åŒºåŸŸæ€§ï¼Œæ›´æ–°å¯¹è±¡çš„è®¡æ•°å™¨æ—¶ï¼Œåªæ˜¯å½±å“åˆ°è¯¥å¯¹è±¡ï¼Œä¸ä¼šæ‰«æå…¨éƒ¨å¯¹è±¡ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>æ¯æ¬¡å¯¹è±¡è¢«å¼•ç”¨æ—¶ï¼Œéƒ½éœ€è¦å»æ›´æ–°è®¡æ•°å™¨ï¼Œæœ‰ä¸€ç‚¹æ—¶é—´å¼€é”€ã€‚ </li><li><strong>æµªè´¹CPUèµ„æº</strong>ï¼Œå³ä½¿å†…å­˜å¤Ÿç”¨ï¼Œä»ç„¶åœ¨è¿è¡Œæ—¶è¿›è¡Œè®¡æ•°å™¨çš„ç»Ÿè®¡ã€‚</li><li><strong>æ— æ³•è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œä¼šå¼•å‘å†…å­˜æ³„éœ²</strong>ã€‚ï¼ˆæœ€å¤§çš„ç¼ºç‚¹ï¼‰</li></ul><h4 id="3-2-2-å¯è¾¾æ€§åˆ†æç®—æ³•"><a href="#3-2-2-å¯è¾¾æ€§åˆ†æç®—æ³•" class="headerlink" title="3.2.2 å¯è¾¾æ€§åˆ†æç®—æ³•"></a>3.2.2 å¯è¾¾æ€§åˆ†æç®—æ³•</h4><p>â€‹ç°åœ¨çš„è™šæ‹Ÿæœºé‡‡ç”¨çš„éƒ½æ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†æç®—æ³•æ¥ç¡®å®šå“ªäº›å†…å®¹æ˜¯åƒåœ¾ã€‚</p><p>â€‹ä¼šå­˜åœ¨ä¸€ä¸ªæ ¹èŠ‚ç‚¹ã€GC Rootsã€‘ï¼Œå¼•å‡ºå®ƒä¸‹é¢æŒ‡å‘çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå†ä»¥ä¸‹ä¸€ä¸ªèŠ‚ç‚¹èŠ‚ç‚¹å¼€å§‹æ‰¾å‡ºå®ƒä¸‹é¢çš„èŠ‚ç‚¹ï¼Œä¾æ¬¡å¾€ä¸‹ç±»æ¨ã€‚ç›´åˆ°æ‰€æœ‰çš„èŠ‚ç‚¹å…¨éƒ¨éå†å®Œæ¯•ã€‚</p><blockquote><p>æ ¹å¯¹è±¡æ˜¯é‚£äº›è‚¯å®šä¸èƒ½å½“åšåƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼Œå°±å¯ä»¥å½“åšæ ¹å¯¹è±¡</p><p>å±€éƒ¨å˜é‡ï¼Œé™æ€æ–¹æ³•ï¼Œé™æ€å˜é‡ï¼Œç±»ä¿¡æ¯</p><p>æ ¸å¿ƒæ˜¯ï¼šåˆ¤æ–­æŸå¯¹è±¡æ˜¯å¦ä¸æ ¹å¯¹è±¡æœ‰ç›´æ¥æˆ–é—´æ¥çš„å¼•ç”¨ï¼Œå¦‚æœæ²¡æœ‰è¢«å¼•ç”¨ï¼Œåˆ™å¯ä»¥å½“åšåƒåœ¾å›æ”¶</p></blockquote><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220904010634153.png" alt="image-20220904010634153"></p><p>â€‹X,Yè¿™ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¯å›æ”¶çš„ï¼Œä½†æ˜¯<strong>å¹¶ä¸ä¼šé©¬ä¸Šçš„è¢«å›æ”¶ï¼ï¼</strong> å¯¹è±¡ä¸­å­˜åœ¨ä¸€ä¸ªæ–¹æ³•ã€finalizeã€‘ã€‚å½“å¯¹è±¡è¢«æ ‡è®°ä¸ºå¯å›æ”¶åï¼Œå½“å‘ç”ŸGCæ—¶ï¼Œé¦–å…ˆ<strong>ä¼šåˆ¤æ–­è¿™ä¸ªå¯¹è±¡æ˜¯å¦æ‰§è¡Œäº†finalizeæ–¹æ³•</strong>ï¼Œå¦‚æœè¿™ä¸ªæ–¹æ³•è¿˜æ²¡æœ‰è¢«æ‰§è¡Œçš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šå…ˆæ¥æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œæ¥ç€åœ¨è¿™ä¸ªæ–¹æ³•æ‰§è¡Œä¸­ï¼Œå¯ä»¥è®¾ç½®å½“å‰è¿™ä¸ªå¯¹è±¡ä¸GC ROOTSäº§ç”Ÿå…³è”ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•æ‰§è¡Œå®Œæˆä¹‹åï¼ŒGCä¼šå†æ¬¡åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¦‚æœä»ç„¶ä¸å¯è¾¾ï¼Œåˆ™ä¼šè¿›è¡Œå›æ”¶ï¼Œå¦‚æœå¯è¾¾äº†ï¼Œåˆ™ä¸ä¼šè¿›è¡Œå›æ”¶ã€‚</p><p>â€‹finalizeæ–¹æ³•å¯¹äºæ¯ä¸€ä¸ªå¯¹è±¡æ¥è¯´ï¼Œåªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚å¦‚æœç¬¬ä¸€æ¬¡æ‰§è¡Œè¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œè®¾ç½®äº†å½“å‰å¯¹è±¡ä¸RC ROOTSå…³è”ï¼Œé‚£ä¹ˆè¿™ä¸€æ¬¡ä¸ä¼šè¿›è¡Œå›æ”¶ã€‚ é‚£ä¹ˆç­‰åˆ°è¿™ä¸ªå¯¹è±¡ç¬¬äºŒæ¬¡è¢«æ ‡è®°ä¸ºå¯å›æ”¶æ—¶ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡çš„finalizeæ–¹æ³•å°±ä¸ä¼šå†æ¬¡æ‰§è¡Œäº†ã€‚</p><p><strong>GC ROOTSï¼š</strong></p><ul><li>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * demoæ˜¯æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡ï¼Œå½“ demo = null æ—¶ï¼Œç”±äºæ­¤æ—¶ demo å……å½“äº† GC Root çš„ä½œç”¨ï¼Œdemoä¸åŸæ¥æŒ‡å‘çš„å®ä¾‹ new Demo() æ–­å¼€äº†è¿æ¥ï¼Œå¯¹è±¡è¢«å›æ”¶ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Demo</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo</span>();</span><br><span class="line">    demo = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å½“æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡ b = null æ—¶ï¼Œç”±äº b åŸæ¥æŒ‡å‘çš„å¯¹è±¡ä¸ GC Root (å˜é‡ b) æ–­å¼€äº†è¿æ¥ï¼Œæ‰€ä»¥ b åŸæ¥æŒ‡å‘çš„å¯¹è±¡ä¼šè¢«å›æ”¶ï¼Œè€Œç”±äºæˆ‘ä»¬ç»™ a èµ‹å€¼äº†å˜é‡çš„å¼•ç”¨ï¼Œaåœ¨æ­¤æ—¶æ˜¯ç±»é™æ€å±æ€§å¼•ç”¨ï¼Œå……å½“äº† GC Root çš„ä½œç”¨ï¼Œå®ƒæŒ‡å‘çš„å¯¹è±¡ä¾ç„¶å­˜æ´»!</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Demo a;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Demo</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo</span>();</span><br><span class="line">        b.a = <span class="keyword">new</span> <span class="title class_">Demo</span>();</span><br><span class="line">        b = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¸¸é‡ a æŒ‡å‘çš„å¯¹è±¡å¹¶ä¸ä¼šå› ä¸º demo æŒ‡å‘çš„å¯¹è±¡è¢«å›æ”¶è€Œå›æ”¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Demo</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Demo</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo</span>();</span><br><span class="line">        demo = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNIï¼ˆå³ä¸€èˆ¬è¯´çš„ Native æ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡</li></ul><h3 id="3-3-JVM-åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›ï¼Ÿ"><a href="#3-3-JVM-åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="3.3 JVM åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›ï¼Ÿ"></a>3.3 JVM åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><h4 id="3-3-1-æ ‡è®°æ¸…é™¤ç®—æ³•"><a href="#3-3-1-æ ‡è®°æ¸…é™¤ç®—æ³•" class="headerlink" title="3.3.1 æ ‡è®°æ¸…é™¤ç®—æ³•"></a>3.3.1 æ ‡è®°æ¸…é™¤ç®—æ³•</h4><p>æ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œæ˜¯å°†åƒåœ¾å›æ”¶åˆ†ä¸º2ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯<strong>æ ‡è®°å’Œæ¸…é™¤</strong>ã€‚</p><p>1.æ ¹æ®å¯è¾¾æ€§åˆ†æç®—æ³•å¾—å‡ºçš„åƒåœ¾è¿›è¡Œæ ‡è®°</p><p>2.å¯¹è¿™äº›æ ‡è®°ä¸ºå¯å›æ”¶çš„å†…å®¹è¿›è¡Œåƒåœ¾å›æ”¶</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506112047190.png" alt="image-20230506112047190"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ ‡è®°æ¸…é™¤ç®—æ³•è§£å†³äº†å¼•ç”¨è®¡æ•°ç®—æ³•ä¸­çš„å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œæ²¡æœ‰ä»rootèŠ‚ç‚¹å¼•ç”¨çš„å¯¹è±¡éƒ½ä¼šè¢«å›æ”¶ã€‚</p><p>åŒæ ·ï¼Œæ ‡è®°æ¸…é™¤ç®—æ³•ä¹Ÿæ˜¯æœ‰ç¼ºç‚¹çš„ï¼š</p><ul><li>æ•ˆç‡è¾ƒä½ï¼Œ<strong>æ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªåŠ¨ä½œéƒ½éœ€è¦éå†æ‰€æœ‰çš„å¯¹è±¡</strong>ï¼Œå¹¶ä¸”åœ¨GCæ—¶ï¼Œ<strong>éœ€è¦åœæ­¢åº”ç”¨ç¨‹åº</strong>ï¼Œå¯¹äºäº¤äº’æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„åº”ç”¨è€Œè¨€è¿™ä¸ªä½“éªŒæ˜¯éå¸¸å·®çš„ã€‚</li><li>ï¼ˆ<strong>é‡è¦</strong>ï¼‰é€šè¿‡æ ‡è®°æ¸…é™¤ç®—æ³•æ¸…ç†å‡ºæ¥çš„å†…å­˜ï¼Œç¢ç‰‡åŒ–è¾ƒä¸ºä¸¥é‡ï¼Œå› ä¸ºè¢«å›æ”¶çš„å¯¹è±¡å¯èƒ½å­˜åœ¨äºå†…å­˜çš„å„ä¸ªè§’è½ï¼Œæ‰€ä»¥æ¸…ç†å‡ºæ¥çš„å†…å­˜æ˜¯ä¸è¿è´¯çš„ã€‚</li></ul><h4 id="3-3-2-å¤åˆ¶ç®—æ³•"><a href="#3-3-2-å¤åˆ¶ç®—æ³•" class="headerlink" title="3.3.2 å¤åˆ¶ç®—æ³•"></a>3.3.2 å¤åˆ¶ç®—æ³•</h4><p>â€‹å¤åˆ¶ç®—æ³•çš„æ ¸å¿ƒå°±æ˜¯ï¼Œ<strong>å°†åŸæœ‰çš„å†…å­˜ç©ºé—´ä¸€åˆ†ä¸ºäºŒï¼Œæ¯æ¬¡åªç”¨å…¶ä¸­çš„ä¸€å—</strong>ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œå°†æ­£åœ¨ä½¿ç”¨çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€ä¸ªå†…å­˜ç©ºé—´ä¸­ï¼Œç„¶åå°†è¯¥å†…å­˜ç©ºé—´æ¸…ç©ºï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜çš„è§’è‰²ï¼Œå®Œæˆåƒåœ¾çš„å›æ”¶ã€‚</p><p>â€‹å¦‚æœå†…å­˜ä¸­çš„åƒåœ¾å¯¹è±¡è¾ƒå¤šï¼Œéœ€è¦å¤åˆ¶çš„å¯¹è±¡å°±è¾ƒå°‘ï¼Œè¿™ç§æƒ…å†µä¸‹é€‚åˆä½¿ç”¨è¯¥æ–¹å¼å¹¶ä¸”æ•ˆç‡æ¯”è¾ƒé«˜ï¼Œåä¹‹ï¼Œåˆ™ä¸é€‚åˆã€‚ </p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506111919008.png" alt="image-20230506111919008"></p><p>1ï¼‰å°†å†…å­˜åŒºåŸŸåˆ†æˆä¸¤éƒ¨åˆ†ï¼Œæ¯æ¬¡æ“ä½œå…¶ä¸­ä¸€ä¸ªã€‚</p><p>2ï¼‰å½“è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œå°†æ­£åœ¨ä½¿ç”¨çš„å†…å­˜åŒºåŸŸä¸­çš„å­˜æ´»å¯¹è±¡ç§»åŠ¨åˆ°æœªä½¿ç”¨çš„å†…å­˜åŒºåŸŸã€‚å½“ç§»åŠ¨å®Œå¯¹è¿™éƒ¨åˆ†å†…å­˜åŒºåŸŸä¸€æ¬¡æ€§æ¸…é™¤ã€‚</p><p>3ï¼‰å‘¨è€Œå¤å§‹ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>åœ¨åƒåœ¾å¯¹è±¡å¤šçš„æƒ…å†µä¸‹ï¼Œæ•ˆç‡è¾ƒé«˜</li><li>æ¸…ç†åï¼Œå†…å­˜æ— ç¢ç‰‡</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>åˆ†é…çš„2å—å†…å­˜ç©ºé—´ï¼Œåœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªèƒ½ä½¿ç”¨ä¸€åŠï¼Œå†…å­˜ä½¿ç”¨ç‡è¾ƒä½</li></ul><h4 id="3-3-3-æ ‡è®°æ•´ç†ç®—æ³•"><a href="#3-3-3-æ ‡è®°æ•´ç†ç®—æ³•" class="headerlink" title="3.3.3 æ ‡è®°æ•´ç†ç®—æ³•"></a>3.3.3 æ ‡è®°æ•´ç†ç®—æ³•</h4><p>â€‹æ ‡è®°å‹ç¼©ç®—æ³•æ˜¯åœ¨æ ‡è®°æ¸…é™¤ç®—æ³•çš„åŸºç¡€ä¹‹ä¸Šï¼Œåšäº†ä¼˜åŒ–æ”¹è¿›çš„ç®—æ³•ã€‚å’Œæ ‡è®°æ¸…é™¤ç®—æ³•ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå¯¹å¯¹è±¡çš„å¼•ç”¨è¿›è¡Œæ ‡è®°ï¼Œåœ¨æ¸…ç†é˜¶æ®µï¼Œå¹¶ä¸æ˜¯ç®€å•çš„ç›´æ¥æ¸…ç†å¯å›æ”¶å¯¹è±¡ï¼Œè€Œæ˜¯å°†å­˜æ´»å¯¹è±¡éƒ½å‘å†…å­˜å¦ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åæ¸…ç†è¾¹ç•Œä»¥å¤–çš„åƒåœ¾ï¼Œä»è€Œè§£å†³äº†ç¢ç‰‡åŒ–çš„é—®é¢˜ã€‚</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506111957793.png" alt="image-20230506111957793"></p><p>1ï¼‰æ ‡è®°åƒåœ¾ã€‚</p><p>2ï¼‰éœ€è¦æ¸…é™¤å‘å³è¾¹èµ°ï¼Œä¸éœ€è¦æ¸…é™¤çš„å‘å·¦è¾¹èµ°ã€‚</p><p>3ï¼‰æ¸…é™¤è¾¹ç•Œä»¥å¤–çš„åƒåœ¾ã€‚</p><p>ä¼˜ç¼ºç‚¹åŒæ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œè§£å†³äº†æ ‡è®°æ¸…é™¤ç®—æ³•çš„ç¢ç‰‡åŒ–çš„é—®é¢˜ï¼ŒåŒæ—¶ï¼Œæ ‡è®°å‹ç¼©ç®—æ³•å¤šäº†ä¸€æ­¥ï¼Œå¯¹è±¡ç§»åŠ¨å†…å­˜ä½ç½®çš„æ­¥éª¤ï¼Œå…¶æ•ˆç‡ä¹Ÿæœ‰æœ‰ä¸€å®šçš„å½±å“ã€‚</p><p>ä¸å¤åˆ¶ç®—æ³•å¯¹æ¯”ï¼šå¤åˆ¶ç®—æ³•æ ‡è®°å®Œå°±å¤åˆ¶ï¼Œä½†æ ‡è®°æ•´ç†ç®—æ³•å¾—ç­‰æŠŠæ‰€æœ‰å­˜æ´»å¯¹è±¡éƒ½æ ‡è®°å®Œæ¯•ï¼Œå†è¿›è¡Œæ•´ç†</p><h3 id="3-4-åˆ†ä»£æ”¶é›†ç®—æ³•"><a href="#3-4-åˆ†ä»£æ”¶é›†ç®—æ³•" class="headerlink" title="3.4 åˆ†ä»£æ”¶é›†ç®—æ³•"></a>3.4 åˆ†ä»£æ”¶é›†ç®—æ³•</h3><h4 id="3-4-1-æ¦‚è¿°"><a href="#3-4-1-æ¦‚è¿°" class="headerlink" title="3.4.1 æ¦‚è¿°"></a>3.4.1 æ¦‚è¿°</h4><p>åœ¨java8æ—¶ï¼Œå †è¢«åˆ†ä¸ºäº†ä¸¤ä»½ï¼š<strong>æ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€1ï¼š2ã€‘</strong>ï¼Œåœ¨java7æ—¶ï¼Œè¿˜å­˜åœ¨ä¸€ä¸ªæ°¸ä¹…ä»£ã€‚</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506131229649.png" alt="image-20230506131229649"></p><p>å¯¹äºæ–°ç”Ÿä»£ï¼Œå†…éƒ¨åˆè¢«åˆ†ä¸ºäº†ä¸‰ä¸ªåŒºåŸŸã€‚EdenåŒºï¼ŒS0åŒºï¼ŒS1åŒºã€8ï¼š1ï¼š1ã€‘</p><p>å½“å¯¹æ–°ç”Ÿä»£äº§ç”ŸGCï¼šMinorGCã€young GCã€‘</p><p>å½“å¯¹è€å¹´ä»£ä»£äº§ç”ŸGCï¼šMajor GC </p><p>å½“å¯¹æ–°ç”Ÿä»£å’Œè€å¹´ä»£äº§ç”ŸFullGCï¼š æ–°ç”Ÿä»£ + è€å¹´ä»£å®Œæ•´åƒåœ¾å›æ”¶ï¼Œæš‚åœæ—¶é—´é•¿ï¼Œ<strong>åº”å°½åŠ›é¿å…</strong></p><h4 id="3-4-2å·¥ä½œæœºåˆ¶"><a href="#3-4-2å·¥ä½œæœºåˆ¶" class="headerlink" title="3.4.2å·¥ä½œæœºåˆ¶"></a>3.4.2å·¥ä½œæœºåˆ¶</h4><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506131308654.png" alt="image-20230506131308654"></p><ul><li>æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œéƒ½ä¼šå…ˆåˆ†é…åˆ°edenåŒº</li></ul><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506131415418.png" alt="image-20230506131415418"></p><ul><li><p>å½“ä¼Šç”¸å›­å†…å­˜ä¸è¶³ï¼Œæ ‡è®°ä¼Šç”¸å›­ä¸ fromï¼ˆç°é˜¶æ®µæ²¡æœ‰ï¼‰çš„å­˜æ´»å¯¹è±¡</p></li><li><p>å°†å­˜æ´»å¯¹è±¡é‡‡ç”¨å¤åˆ¶ç®—æ³•å¤åˆ¶åˆ° to ä¸­ï¼Œå¤åˆ¶å®Œæ¯•åï¼Œä¼Šç”¸å›­å’Œ from å†…å­˜éƒ½å¾—åˆ°é‡Šæ”¾</p></li></ul><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506131442503.png" alt="image-20230506131442503"></p><ul><li>ç»è¿‡ä¸€æ®µæ—¶é—´åä¼Šç”¸å›­çš„å†…å­˜åˆå‡ºç°ä¸è¶³ï¼Œæ ‡è®°edenåŒºåŸŸtoåŒºå­˜æ´»çš„å¯¹è±¡ï¼Œå°†å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°fromåŒº</li></ul><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506131544447.png" alt="image-20230506131544447"></p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506131607645.png" alt="image-20230506131607645"></p><ul><li>å½“å¹¸å­˜åŒºå¯¹è±¡ç†¬è¿‡å‡ æ¬¡å›æ”¶ï¼ˆæœ€å¤š15æ¬¡ï¼‰ï¼Œæ™‹å‡åˆ°è€å¹´ä»£ï¼ˆå¹¸å­˜åŒºå†…å­˜ä¸è¶³æˆ–å¤§å¯¹è±¡ä¼šå¯¼è‡´æå‰æ™‹å‡ï¼‰</li></ul><p><strong>MinorGCã€ Mixed GC ã€ FullGCçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</strong></p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506131640893.png" alt="image-20230506131640893"></p><ul><li><p>MinorGCã€young GCã€‘å‘ç”Ÿåœ¨æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶ï¼Œæš‚åœæ—¶é—´çŸ­ï¼ˆSTWï¼‰</p></li><li><p>Mixed GC æ–°ç”Ÿä»£ + è€å¹´ä»£éƒ¨åˆ†åŒºåŸŸçš„åƒåœ¾å›æ”¶ï¼ŒG1 æ”¶é›†å™¨ç‰¹æœ‰</p></li><li><p>FullGCï¼š æ–°ç”Ÿä»£ + è€å¹´ä»£å®Œæ•´åƒåœ¾å›æ”¶ï¼Œæš‚åœæ—¶é—´é•¿ï¼ˆSTWï¼‰ï¼Œåº”å°½åŠ›é¿å…ï¼Ÿ</p></li></ul><blockquote><p>åè¯è§£é‡Šï¼š</p><p>STWï¼ˆStop-The-Worldï¼‰ï¼šæš‚åœæ‰€æœ‰åº”ç”¨ç¨‹åºçº¿ç¨‹ï¼Œç­‰å¾…åƒåœ¾å›æ”¶çš„å®Œæˆ</p></blockquote><h3 id="3-5-è¯´ä¸€ä¸‹-JVM-æœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨ï¼Ÿ"><a href="#3-5-è¯´ä¸€ä¸‹-JVM-æœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨ï¼Ÿ" class="headerlink" title="3.5 è¯´ä¸€ä¸‹ JVM æœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨ï¼Ÿ"></a>3.5 è¯´ä¸€ä¸‹ JVM æœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><p>åœ¨jvmä¸­ï¼Œå®ç°äº†å¤šç§åƒåœ¾æ”¶é›†å™¨ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><p>ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨</p></li><li><p>å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨</p></li><li><p>CMSï¼ˆå¹¶å‘ï¼‰åƒåœ¾æ”¶é›†å™¨</p></li><li><p>G1åƒåœ¾æ”¶é›†å™¨</p></li></ul><h4 id="3-5-1-ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨"><a href="#3-5-1-ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨" class="headerlink" title="3.5.1 ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨"></a>3.5.1 ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨</h4><p>Serialå’ŒSerial Oldä¸²è¡Œåƒåœ¾æ”¶é›†å™¨ï¼Œæ˜¯æŒ‡ä½¿ç”¨å•çº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå †å†…å­˜è¾ƒå°ï¼Œé€‚åˆä¸ªäººç”µè„‘</p><ul><li><p>Serial ä½œç”¨äºæ–°ç”Ÿä»£ï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•</p></li><li><p>Serial Old ä½œç”¨äºè€å¹´ä»£ï¼Œé‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•</p></li></ul><p>åƒåœ¾å›æ”¶æ—¶ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨å·¥ä½œï¼Œå¹¶ä¸”javaåº”ç”¨ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½è¦æš‚åœï¼ˆSTWï¼‰ï¼Œç­‰å¾…åƒåœ¾å›æ”¶çš„å®Œæˆã€‚</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506154006266.png" alt="image-20230506154006266"></p><h4 id="3-5-2-å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨"><a href="#3-5-2-å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨" class="headerlink" title="3.5.2 å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨"></a>3.5.2 å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨</h4><p>Parallel Newå’ŒParallel Oldæ˜¯ä¸€ä¸ªå¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼Œ<strong>JDK8é»˜è®¤ä½¿ç”¨æ­¤åƒåœ¾å›æ”¶å™¨</strong></p><ul><li><p>Parallel Newä½œç”¨äºæ–°ç”Ÿä»£ï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•</p></li><li><p>Parallel Oldä½œç”¨äºè€å¹´ä»£ï¼Œé‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•</p></li></ul><p>åƒåœ¾å›æ”¶æ—¶ï¼Œå¤šä¸ªçº¿ç¨‹åœ¨å·¥ä½œï¼Œå¹¶ä¸”javaåº”ç”¨ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½è¦æš‚åœï¼ˆSTWï¼‰ï¼Œç­‰å¾…åƒåœ¾å›æ”¶çš„å®Œæˆã€‚</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506154042673.png" alt="image-20230506154042673"></p><h4 id="3-5-2-CMSï¼ˆå¹¶å‘ï¼‰åƒåœ¾æ”¶é›†å™¨"><a href="#3-5-2-CMSï¼ˆå¹¶å‘ï¼‰åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="3.5.2 CMSï¼ˆå¹¶å‘ï¼‰åƒåœ¾æ”¶é›†å™¨"></a>3.5.2 CMSï¼ˆå¹¶å‘ï¼‰åƒåœ¾æ”¶é›†å™¨</h4><p>CMSå…¨ç§° Concurrent Mark Sweepï¼Œæ˜¯ä¸€æ¬¾å¹¶å‘çš„ã€ä½¿ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ï¼Œè¯¥å›æ”¶å™¨æ˜¯é’ˆå¯¹è€å¹´ä»£åƒåœ¾å›æ”¶çš„ï¼Œæ˜¯ä¸€æ¬¾ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œåœé¡¿æ—¶é—´çŸ­ï¼Œç”¨æˆ·ä½“éªŒå°±å¥½ã€‚å…¶æœ€å¤§ç‰¹ç‚¹æ˜¯åœ¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œåº”ç”¨ä»ç„¶èƒ½æ­£å¸¸è¿è¡Œã€‚</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506154117857.png" alt="image-20230506154117857"></p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506154107944.png" alt="image-20230506154107944"></p><h3 id="3-6-è¯¦ç»†èŠä¸€ä¸‹G1åƒåœ¾å›æ”¶å™¨"><a href="#3-6-è¯¦ç»†èŠä¸€ä¸‹G1åƒåœ¾å›æ”¶å™¨" class="headerlink" title="3.6 è¯¦ç»†èŠä¸€ä¸‹G1åƒåœ¾å›æ”¶å™¨"></a>3.6 è¯¦ç»†èŠä¸€ä¸‹G1åƒåœ¾å›æ”¶å™¨</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><h4 id="3-6-1-æ¦‚è¿°"><a href="#3-6-1-æ¦‚è¿°" class="headerlink" title="3.6.1 æ¦‚è¿°"></a>3.6.1 æ¦‚è¿°</h4><ul><li><p>åº”ç”¨äºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œ<strong>åœ¨<strong><strong>JDK9</strong></strong>ä¹‹åé»˜è®¤ä½¿ç”¨****G1</strong></p></li><li><p>åˆ’åˆ†æˆå¤šä¸ªåŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸéƒ½å¯ä»¥å……å½“ edenï¼Œsurvivorï¼Œoldï¼Œ humongousï¼Œå…¶ä¸­ humongous ä¸“ä¸ºå¤§å¯¹è±¡å‡†å¤‡</p></li><li><p>é‡‡ç”¨å¤åˆ¶ç®—æ³•</p></li><li><p>å“åº”æ—¶é—´ä¸ååé‡å…¼é¡¾</p></li><li><p>åˆ†æˆä¸‰ä¸ªé˜¶æ®µï¼šæ–°ç”Ÿä»£å›æ”¶ã€å¹¶å‘æ ‡è®°ã€æ··åˆæ”¶é›†</p></li><li><p>å¦‚æœå¹¶å‘å¤±è´¥ï¼ˆå³å›æ”¶é€Ÿåº¦èµ¶ä¸ä¸Šåˆ›å»ºæ–°å¯¹è±¡é€Ÿåº¦ï¼‰ï¼Œä¼šè§¦å‘ Full GC</p></li></ul><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506154323950.png" alt="image-20230506154323950"></p><h4 id="3-6-2-Young-Collection-å¹´è½»ä»£åƒåœ¾å›æ”¶"><a href="#3-6-2-Young-Collection-å¹´è½»ä»£åƒåœ¾å›æ”¶" class="headerlink" title="3.6.2 Young Collection(å¹´è½»ä»£åƒåœ¾å›æ”¶)"></a>3.6.2 Young Collection(å¹´è½»ä»£åƒåœ¾å›æ”¶)</h4><ul><li><p>åˆå§‹æ—¶ï¼Œæ‰€æœ‰åŒºåŸŸéƒ½å¤„äºç©ºé—²çŠ¶æ€</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506154542687.png" alt="image-20230506154542687"></p></li><li><p>åˆ›å»ºäº†ä¸€äº›å¯¹è±¡ï¼ŒæŒ‘å‡ºä¸€äº›ç©ºé—²åŒºåŸŸä½œä¸ºä¼Šç”¸å›­åŒºå­˜å‚¨è¿™äº›å¯¹è±¡</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506154607558.png" alt="image-20230506154607558"></p></li><li><p>å½“ä¼Šç”¸å›­éœ€è¦åƒåœ¾å›æ”¶æ—¶ï¼ŒæŒ‘å‡ºä¸€ä¸ªç©ºé—²åŒºåŸŸä½œä¸ºå¹¸å­˜åŒºï¼Œç”¨å¤åˆ¶ç®—æ³•å¤åˆ¶å­˜æ´»å¯¹è±¡ï¼Œéœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506154633118.png" alt="image-20230506154633118"></p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506154705088.png" alt="image-20230506154705088"></p></li><li><p>éšç€æ—¶é—´æµé€ï¼Œä¼Šç”¸å›­çš„å†…å­˜åˆæœ‰ä¸è¶³</p></li><li><p>å°†ä¼Šç”¸å›­ä»¥åŠä¹‹å‰å¹¸å­˜åŒºä¸­çš„å­˜æ´»å¯¹è±¡ï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œå¤åˆ¶åˆ°æ–°çš„å¹¸å­˜åŒºï¼Œå…¶ä¸­è¾ƒè€å¯¹è±¡æ™‹å‡è‡³è€å¹´ä»£</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506154759809.png" alt="image-20230506154759809"></p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506154826981.png" alt="image-20230506154826981"></p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506154859985.png" alt="image-20230506154859985"></p></li></ul><h4 id="3-6-3-Young-Collection-Concurrent-Mark-å¹´è½»ä»£åƒåœ¾å›æ”¶-å¹¶å‘æ ‡è®°"><a href="#3-6-3-Young-Collection-Concurrent-Mark-å¹´è½»ä»£åƒåœ¾å›æ”¶-å¹¶å‘æ ‡è®°" class="headerlink" title="3.6.3 Young Collection + Concurrent Mark (å¹´è½»ä»£åƒåœ¾å›æ”¶+å¹¶å‘æ ‡è®°)"></a>3.6.3 Young Collection + Concurrent Mark (å¹´è½»ä»£åƒåœ¾å›æ”¶+å¹¶å‘æ ‡è®°)</h4><p>å½“è€å¹´ä»£å ç”¨å†…å­˜è¶…è¿‡é˜ˆå€¼(é»˜è®¤æ˜¯45%)åï¼Œè§¦å‘å¹¶å‘æ ‡è®°ï¼Œè¿™æ—¶æ— éœ€æš‚åœç”¨æˆ·çº¿ç¨‹</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506155000503.png" alt="image-20230506155000503"></p><ul><li><p>å¹¶å‘æ ‡è®°ä¹‹åï¼Œä¼šæœ‰é‡æ–°æ ‡è®°é˜¶æ®µè§£å†³æ¼æ ‡é—®é¢˜ï¼Œæ­¤æ—¶éœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹ã€‚</p></li><li><p>è¿™äº›éƒ½å®Œæˆåå°±çŸ¥é“äº†è€å¹´ä»£æœ‰å“ªäº›å­˜æ´»å¯¹è±¡ï¼Œéšåè¿›å…¥æ··åˆæ”¶é›†é˜¶æ®µã€‚æ­¤æ—¶ä¸ä¼šå¯¹æ‰€æœ‰è€å¹´ä»£åŒºåŸŸè¿›è¡Œå›æ”¶ï¼Œè€Œæ˜¯æ ¹æ®æš‚åœæ—¶é—´ç›®æ ‡ä¼˜å…ˆå›æ”¶ä»·å€¼é«˜ï¼ˆå­˜æ´»å¯¹è±¡å°‘ï¼‰çš„åŒºåŸŸï¼ˆè¿™ä¹Ÿæ˜¯ Gabage First åç§°çš„ç”±æ¥ï¼‰ã€‚</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506155047765.png" alt="image-20230506155047765"></p></li></ul><h4 id="3-6-4-Mixed-Collection-æ··åˆåƒåœ¾å›æ”¶"><a href="#3-6-4-Mixed-Collection-æ··åˆåƒåœ¾å›æ”¶" class="headerlink" title="3.6.4 Mixed Collection (æ··åˆåƒåœ¾å›æ”¶)"></a>3.6.4 Mixed Collection (æ··åˆåƒåœ¾å›æ”¶)</h4><p>å¤åˆ¶å®Œæˆï¼Œå†…å­˜å¾—åˆ°é‡Šæ”¾ã€‚è¿›å…¥ä¸‹ä¸€è½®çš„æ–°ç”Ÿä»£å›æ”¶ã€å¹¶å‘æ ‡è®°ã€æ··åˆæ”¶é›†</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506155116267.png" alt="image-20230506155116267"></p><p>å…¶ä¸­Hå«åšå·¨å‹å¯¹è±¡ï¼Œå¦‚æœå¯¹è±¡éå¸¸å¤§ï¼Œä¼šå¼€è¾Ÿä¸€å—è¿ç»­çš„ç©ºé—´å­˜å‚¨å·¨å‹å¯¹è±¡</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506155146370.png" alt="image-20230506155146370"></p><h3 id="3-7-å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨çš„åŒºåˆ«ï¼Ÿ"><a href="#3-7-å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="3.7 å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨çš„åŒºåˆ«ï¼Ÿ"></a>3.7 å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨çš„åŒºåˆ«ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><h4 id="3-7-1-å¼ºå¼•ç”¨"><a href="#3-7-1-å¼ºå¼•ç”¨" class="headerlink" title="3.7.1 å¼ºå¼•ç”¨"></a>3.7.1 å¼ºå¼•ç”¨</h4><p>å¼ºå¼•ç”¨ï¼šåªæœ‰æ‰€æœ‰ GC Roots å¯¹è±¡éƒ½ä¸é€šè¿‡ã€å¼ºå¼•ç”¨ã€‘å¼•ç”¨è¯¥å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ‰èƒ½è¢«åƒåœ¾å›æ”¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br></pre></td></tr></table></figure><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506155341703.png" alt="image-20230506155341703"></p><h4 id="3-7-2-è½¯å¼•ç”¨"><a href="#3-7-2-è½¯å¼•ç”¨" class="headerlink" title="3.7.2 è½¯å¼•ç”¨"></a>3.7.2 è½¯å¼•ç”¨</h4><p>è½¯å¼•ç”¨ï¼šä»…æœ‰è½¯å¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œåœ¨åƒåœ¾å›æ”¶åï¼Œå†…å­˜ä»ä¸è¶³æ—¶ä¼šå†æ¬¡å‡ºå‘åƒåœ¾å›æ”¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="type">SoftReference</span> <span class="variable">softReference</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SoftReference</span>(user);</span><br></pre></td></tr></table></figure><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506155416293.png" alt="image-20230506155416293"></p><h4 id="3-7-3-å¼±å¼•ç”¨"><a href="#3-7-3-å¼±å¼•ç”¨" class="headerlink" title="3.7.3 å¼±å¼•ç”¨"></a>3.7.3 å¼±å¼•ç”¨</h4><p>å¼±å¼•ç”¨ï¼šä»…æœ‰å¼±å¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œæ— è®ºå†…å­˜æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›æ”¶å¼±å¼•ç”¨å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="type">WeakReference</span> <span class="variable">weakReference</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WeakReference</span>(user);</span><br></pre></td></tr></table></figure><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506155501557.png" alt="image-20230506155501557"></p><blockquote><p>å»¶ä¼¸è¯é¢˜ï¼šThreadLocalå†…å­˜æ³„æ¼é—®é¢˜</p></blockquote><p>ThreadLocalç”¨çš„å°±æ˜¯å¼±å¼•ç”¨ï¼Œçœ‹ä»¥ä¸‹æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span> <span class="keyword">extends</span> <span class="title class_">WeakReference</span>&lt;ThreadLocal&lt;?&gt;&gt; &#123;</span><br><span class="line">    Object value;</span><br><span class="line"></span><br><span class="line">    Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class="line">         <span class="built_in">super</span>(k);</span><br><span class="line">         value = v; <span class="comment">//å¼ºå¼•ç”¨ï¼Œä¸ä¼šè¢«å›æ”¶</span></span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Entry</code>çš„keyæ˜¯å½“å‰ThreadLocalï¼Œvalueå€¼æ˜¯æˆ‘ä»¬è¦è®¾ç½®çš„æ•°æ®ã€‚</p><p><code>WeakReference</code>è¡¨ç¤ºçš„æ˜¯å¼±å¼•ç”¨ï¼Œå½“JVMè¿›è¡ŒGCæ—¶ï¼Œä¸€æ—¦å‘ç°äº†åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰å†…å­˜ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜ã€‚ä½†æ˜¯<code>value</code>æ˜¯å¼ºå¼•ç”¨ï¼Œå®ƒä¸ä¼šè¢«å›æ”¶æ‰ã€‚</p><blockquote><p>ThreadLocalä½¿ç”¨å»ºè®®ï¼šä½¿ç”¨å®Œæ¯•åæ³¨æ„è°ƒç”¨æ¸…ç†æ–¹æ³•ã€‚</p></blockquote><h4 id="3-7-4-è™šå¼•ç”¨"><a href="#3-7-4-è™šå¼•ç”¨" class="headerlink" title="3.7.4 è™šå¼•ç”¨"></a>3.7.4 è™šå¼•ç”¨</h4><p>è™šå¼•ç”¨ï¼šå¿…é¡»é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨ï¼Œè¢«å¼•ç”¨å¯¹è±¡å›æ”¶æ—¶ï¼Œä¼šå°†è™šå¼•ç”¨å…¥é˜Ÿï¼Œç”± Reference Handler çº¿ç¨‹è°ƒç”¨è™šå¼•ç”¨ç›¸å…³æ–¹æ³•é‡Šæ”¾ç›´æ¥å†…å­˜</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506155518510.png" alt="image-20230506155518510"></p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506155552693.png" alt="image-20230506155552693"></p><h2 id="4-JVMå®è·µï¼ˆè°ƒä¼˜ï¼‰"><a href="#4-JVMå®è·µï¼ˆè°ƒä¼˜ï¼‰" class="headerlink" title="4 JVMå®è·µï¼ˆè°ƒä¼˜ï¼‰"></a>4 JVMå®è·µï¼ˆè°ƒä¼˜ï¼‰</h2><h3 id="4-1-JVM-è°ƒä¼˜çš„å‚æ•°å¯ä»¥åœ¨å“ªé‡Œè®¾ç½®å‚æ•°å€¼ï¼Ÿ"><a href="#4-1-JVM-è°ƒä¼˜çš„å‚æ•°å¯ä»¥åœ¨å“ªé‡Œè®¾ç½®å‚æ•°å€¼ï¼Ÿ" class="headerlink" title="4.1 JVM è°ƒä¼˜çš„å‚æ•°å¯ä»¥åœ¨å“ªé‡Œè®¾ç½®å‚æ•°å€¼ï¼Ÿ"></a>4.1 JVM è°ƒä¼˜çš„å‚æ•°å¯ä»¥åœ¨å“ªé‡Œè®¾ç½®å‚æ•°å€¼ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><h4 id="4-1-1-tomcatçš„è®¾ç½®vmå‚æ•°"><a href="#4-1-1-tomcatçš„è®¾ç½®vmå‚æ•°" class="headerlink" title="4.1.1 tomcatçš„è®¾ç½®vmå‚æ•°"></a>4.1.1 tomcatçš„è®¾ç½®vmå‚æ•°</h4><p>ä¿®æ”¹TOMCAT_HOME&#x2F;bin&#x2F;catalina.shæ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾</p><p><code>JAVA_OPTS=&quot;-Xms512m -Xmx1024m&quot; </code></p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220904151948778.png" alt="image-20220904151948778"></p><h4 id="4-1-2-springbooté¡¹ç›®jaræ–‡ä»¶å¯åŠ¨"><a href="#4-1-2-springbooté¡¹ç›®jaræ–‡ä»¶å¯åŠ¨" class="headerlink" title="4.1.2 springbooté¡¹ç›®jaræ–‡ä»¶å¯åŠ¨"></a>4.1.2 springbooté¡¹ç›®jaræ–‡ä»¶å¯åŠ¨</h4><p>é€šå¸¸åœ¨linuxç³»ç»Ÿä¸‹ç›´æ¥åŠ å‚æ•°å¯åŠ¨springbooté¡¹ç›®</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> java -Xms512m -Xmx1024m -jar xxxx.jar --spring.profiles.active=prod &amp;</span><br></pre></td></tr></table></figure><blockquote><p>nohup  :  ç”¨äºåœ¨ç³»ç»Ÿåå°ä¸æŒ‚æ–­åœ°è¿è¡Œå‘½ä»¤ï¼Œé€€å‡ºç»ˆç«¯ä¸ä¼šå½±å“ç¨‹åºçš„è¿è¡Œ</p><p>å‚æ•° <strong>&amp;</strong>  ï¼šè®©å‘½ä»¤åœ¨åå°æ‰§è¡Œï¼Œç»ˆç«¯é€€å‡ºåå‘½ä»¤ä»æ—§æ‰§è¡Œã€‚</p></blockquote><h3 id="4-2-ç”¨çš„-JVM-è°ƒä¼˜çš„å‚æ•°éƒ½æœ‰å“ªäº›ï¼Ÿ"><a href="#4-2-ç”¨çš„-JVM-è°ƒä¼˜çš„å‚æ•°éƒ½æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="4.2 ç”¨çš„ JVM è°ƒä¼˜çš„å‚æ•°éƒ½æœ‰å“ªäº›ï¼Ÿ"></a>4.2 ç”¨çš„ JVM è°ƒä¼˜çš„å‚æ•°éƒ½æœ‰å“ªäº›ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><p>â€‹å¯¹äºJVMè°ƒä¼˜ï¼Œä¸»è¦å°±æ˜¯è°ƒæ•´å¹´è½»ä»£ã€å¹´è€å¤§ã€å…ƒç©ºé—´çš„å†…å­˜ç©ºé—´å¤§å°åŠä½¿ç”¨çš„åƒåœ¾å›æ”¶å™¨ç±»å‹ã€‚</p><p><a href="https://www.oracle.com/java/technologies/javase/vmoptions-jsp.html">https://www.oracle.com/java/technologies/javase/vmoptions-jsp.html</a></p><p>1ï¼‰è®¾ç½®å †çš„åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°ï¼Œä¸ºäº†é˜²æ­¢åƒåœ¾æ”¶é›†å™¨åœ¨åˆå§‹å¤§å°ã€æœ€å¤§å¤§å°ä¹‹é—´æ”¶ç¼©å †è€Œäº§ç”Ÿé¢å¤–çš„æ—¶é—´ï¼Œé€šå¸¸æŠŠæœ€å¤§ã€åˆå§‹å¤§å°è®¾ç½®ä¸ºç›¸åŒçš„å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-Xmsï¼šè®¾ç½®å †çš„åˆå§‹åŒ–å¤§å°</span><br><span class="line"></span><br><span class="line">-Xmxï¼šè®¾ç½®å †çš„æœ€å¤§å¤§å°</span><br></pre></td></tr></table></figure><p>2ï¼‰ è®¾ç½®å¹´è½»ä»£ä¸­EdenåŒºå’Œä¸¤ä¸ªSurvivoråŒºçš„å¤§å°æ¯”ä¾‹ã€‚è¯¥å€¼å¦‚æœä¸è®¾ç½®ï¼Œåˆ™é»˜è®¤æ¯”ä¾‹ä¸º8:1:1ã€‚Javaå®˜æ–¹é€šè¿‡å¢å¤§EdenåŒºçš„å¤§å°ï¼Œæ¥å‡å°‘YGCå‘ç”Ÿçš„æ¬¡æ•°ï¼Œä½†æœ‰æ—¶æˆ‘ä»¬å‘ç°ï¼Œè™½ç„¶æ¬¡æ•°å‡å°‘äº†ï¼Œä½†EdenåŒºæ»¡</p><p>çš„æ—¶å€™ï¼Œç”±äºå ç”¨çš„ç©ºé—´è¾ƒå¤§ï¼Œå¯¼è‡´é‡Šæ”¾ç¼“æ…¢ï¼Œæ­¤æ—¶STWçš„æ—¶é—´è¾ƒé•¿ï¼Œå› æ­¤éœ€è¦æŒ‰ç…§ç¨‹åºæƒ…å†µå»è°ƒä¼˜ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-XXSurvivorRatio=3ï¼Œè¡¨ç¤ºå¹´è½»ä»£ä¸­çš„åˆ†é…æ¯”ç‡ï¼šsurvivor:eden = 2:3</span><br></pre></td></tr></table></figure><p>3ï¼‰å¹´è½»ä»£å’Œè€å¹´ä»£é»˜è®¤æ¯”ä¾‹ä¸º1ï¼š2ã€‚å¯ä»¥é€šè¿‡è°ƒæ•´äºŒè€…ç©ºé—´å¤§å°æ¯”ç‡æ¥è®¾ç½®ä¸¤è€…çš„å¤§å°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-XX:newSize   è®¾ç½®å¹´è½»ä»£çš„åˆå§‹å¤§å°</span><br><span class="line">-XX:MaxNewSize   è®¾ç½®å¹´è½»ä»£çš„æœ€å¤§å¤§å°ï¼Œ  åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°ä¸¤ä¸ªå€¼é€šå¸¸ç›¸åŒ</span><br></pre></td></tr></table></figure><p>4ï¼‰çº¿ç¨‹å †æ ˆçš„è®¾ç½®ï¼š<strong>æ¯ä¸ªçº¿ç¨‹é»˜è®¤ä¼šå¼€å¯1Mçš„å †æ ˆ</strong>ï¼Œç”¨äºå­˜æ”¾æ ˆå¸§ã€è°ƒç”¨å‚æ•°ã€å±€éƒ¨å˜é‡ç­‰ï¼Œä½†ä¸€èˆ¬256Kå°±å¤Ÿç”¨ã€‚é€šå¸¸å‡å°‘æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆï¼Œå¯ä»¥äº§ç”Ÿæ›´å¤šçš„çº¿ç¨‹ï¼Œä½†è¿™å®é™…ä¸Šè¿˜å—é™äºæ“ä½œç³»ç»Ÿã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xss   å¯¹æ¯ä¸ªçº¿ç¨‹stackå¤§å°çš„è°ƒæ•´,-Xss128k</span><br></pre></td></tr></table></figure><p>5ï¼‰ä¸€èˆ¬æ¥è¯´ï¼Œå½“survivoråŒºä¸å¤Ÿå¤§æˆ–è€…å ç”¨é‡è¾¾åˆ°50%ï¼Œå°±ä¼šæŠŠä¸€äº›å¯¹è±¡æ”¾åˆ°è€å¹´åŒºã€‚é€šè¿‡è®¾ç½®åˆç†çš„edenåŒºï¼ŒsurvivoråŒºåŠä½¿ç”¨ç‡ï¼Œå¯ä»¥å°†å¹´è½»å¯¹è±¡ä¿å­˜åœ¨å¹´è½»ä»£ï¼Œä»è€Œé¿å…full GCï¼Œä½¿ç”¨-Xmnè®¾ç½®å¹´è½»ä»£çš„å¤§å°</p><p>6ï¼‰ç³»ç»ŸCPUæŒç»­é£™é«˜çš„è¯ï¼Œé¦–å…ˆå…ˆæ’æŸ¥ä»£ç é—®é¢˜ï¼Œå¦‚æœä»£ç æ²¡é—®é¢˜ï¼Œåˆ™å’¨è¯¢è¿ç»´æˆ–è€…äº‘æœåŠ¡å™¨ä¾›åº”å•†ï¼Œé€šå¸¸æœåŠ¡å™¨é‡å¯æˆ–è€…æœåŠ¡å™¨è¿ç§»å³å¯è§£å†³ã€‚</p><p>7ï¼‰å¯¹äºå ç”¨å†…å­˜æ¯”è¾ƒå¤šçš„å¤§å¯¹è±¡ï¼Œä¸€èˆ¬ä¼šé€‰æ‹©åœ¨è€å¹´ä»£åˆ†é…å†…å­˜ã€‚å¦‚æœåœ¨å¹´è½»ä»£ç»™å¤§å¯¹è±¡åˆ†é…å†…å­˜ï¼Œå¹´è½»ä»£å†…å­˜ä¸å¤Ÿäº†ï¼Œå°±è¦åœ¨edenåŒºç§»åŠ¨å¤§é‡å¯¹è±¡åˆ°è€å¹´ä»£ï¼Œç„¶åè¿™äº›ç§»åŠ¨çš„å¯¹è±¡å¯èƒ½å¾ˆå¿«æ¶ˆäº¡ï¼Œå› æ­¤å¯¼è‡´full GCã€‚é€šè¿‡è®¾ç½®å‚æ•°ï¼š-XX:PetenureSizeThreshold&#x3D;1000000ï¼Œå•ä½ä¸ºBï¼Œæ ‡æ˜å¯¹è±¡å¤§å°è¶…è¿‡1Mæ—¶ï¼Œåœ¨è€å¹´ä»£(tenured)åˆ†é…å†…å­˜ç©ºé—´ã€‚</p><p>8ï¼‰ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¹´è½»å¯¹è±¡æ”¾åœ¨edenåŒºï¼Œå½“ç¬¬ä¸€æ¬¡GCåï¼Œå¦‚æœå¯¹è±¡è¿˜å­˜æ´»ï¼Œæ”¾åˆ°survivoråŒºï¼Œæ­¤åï¼Œæ¯GCä¸€æ¬¡ï¼Œå¹´é¾„å¢åŠ 1ï¼Œå½“å¯¹è±¡çš„å¹´é¾„è¾¾åˆ°é˜ˆå€¼ï¼Œå°±è¢«æ”¾åˆ°tenuredè€å¹´åŒºã€‚è¿™ä¸ªé˜ˆå€¼å¯ä»¥åŒæ„-XX:MaxTenuringThresholdè®¾ç½®ã€‚å¦‚æœæƒ³è®©å¯¹è±¡ç•™åœ¨å¹´è½»ä»£ï¼Œå¯ä»¥è®¾ç½®æ¯”è¾ƒå¤§çš„é˜ˆå€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ1ï¼‰-XX:+UseParallelGC:å¹´è½»ä»£ä½¿ç”¨å¹¶è¡Œåƒåœ¾å›æ”¶æ”¶é›†å™¨ã€‚è¿™æ˜¯ä¸€ä¸ªå…³æ³¨ååé‡çš„æ”¶é›†å™¨ï¼Œå¯ä»¥å°½å¯èƒ½çš„å‡å°‘åƒåœ¾å›æ”¶æ—¶é—´ã€‚</span><br><span class="line"></span><br><span class="line">ï¼ˆ2ï¼‰-XX:+UseParallelOldGC:è®¾ç½®è€å¹´ä»£ä½¿ç”¨å¹¶è¡Œåƒåœ¾å›æ”¶æ”¶é›†å™¨ã€‚</span><br></pre></td></tr></table></figure><p>9ï¼‰å°è¯•ä½¿ç”¨å¤§çš„å†…å­˜åˆ†é¡µï¼šä½¿ç”¨å¤§çš„å†…å­˜åˆ†é¡µå¢åŠ CPUçš„å†…å­˜å¯»å€èƒ½åŠ›ï¼Œä»è€Œç³»ç»Ÿçš„æ€§èƒ½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-XX:+LargePageSizeInBytes è®¾ç½®å†…å­˜é¡µçš„å¤§å°</span><br></pre></td></tr></table></figure><p>10ï¼‰ä½¿ç”¨éå ç”¨çš„åƒåœ¾æ”¶é›†å™¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UseConcMarkSweepGCè€å¹´ä»£ä½¿ç”¨CMSæ”¶é›†å™¨é™ä½åœé¡¿ã€‚</span><br></pre></td></tr></table></figure><h3 id="4-3-è¯´ä¸€ä¸‹-JVM-è°ƒä¼˜çš„å·¥å…·ï¼Ÿ"><a href="#4-3-è¯´ä¸€ä¸‹-JVM-è°ƒä¼˜çš„å·¥å…·ï¼Ÿ" class="headerlink" title="4.3 è¯´ä¸€ä¸‹ JVM è°ƒä¼˜çš„å·¥å…·ï¼Ÿ"></a>4.3 è¯´ä¸€ä¸‹ JVM è°ƒä¼˜çš„å·¥å…·ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><h4 id="4-3-1-å‘½ä»¤å·¥å…·"><a href="#4-3-1-å‘½ä»¤å·¥å…·" class="headerlink" title="4.3.1 å‘½ä»¤å·¥å…·"></a>4.3.1 å‘½ä»¤å·¥å…·</h4><h5 id="4-3-1-1-jpsï¼ˆJava-Process-Statusï¼‰"><a href="#4-3-1-1-jpsï¼ˆJava-Process-Statusï¼‰" class="headerlink" title="4.3.1.1 jpsï¼ˆJava Process Statusï¼‰"></a>4.3.1.1 jpsï¼ˆJava Process Statusï¼‰</h5><p>è¾“å‡ºJVMä¸­è¿è¡Œçš„è¿›ç¨‹çŠ¶æ€ä¿¡æ¯(ç°åœ¨ä¸€èˆ¬ä½¿ç”¨jconsole)</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220904104739581.png" alt="image-20220904104739581"></p><h5 id="4-3-1-2-jstack"><a href="#4-3-1-2-jstack" class="headerlink" title="4.3.1.2 jstack"></a>4.3.1.2 jstack</h5><p>æŸ¥çœ‹javaè¿›ç¨‹å†…<strong>çº¿ç¨‹çš„å †æ ˆ</strong>ä¿¡æ¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstack [option] &lt;pid&gt;  </span><br></pre></td></tr></table></figure><p>javaæ¡ˆä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.heima.jvm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;å“ˆå“ˆå“ˆ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨jstackæŸ¥çœ‹è¿›è¡Œå †æ ˆè¿è¡Œä¿¡æ¯</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220904111059602.png" alt="image-20220904111059602"></p><h5 id="4-3-1-3-jmap"><a href="#4-3-1-3-jmap" class="headerlink" title="4.3.1.3 jmap"></a>4.3.1.3 jmap</h5><p>ç”¨äºç”Ÿæˆå †è½¬å­˜å¿«ç…§</p><blockquote><p>jmap [options] pid  å†…å­˜æ˜ åƒä¿¡æ¯</p><p>jmap -heap pid   æ˜¾ç¤ºJavaå †çš„ä¿¡æ¯</p><p>jmap -dump:format&#x3D;b,file&#x3D;heap.hprof pid</p><p>â€‹format&#x3D;bè¡¨ç¤ºä»¥hprofäºŒè¿›åˆ¶æ ¼å¼è½¬å‚¨Javaå †çš„å†…å­˜<br>â€‹file&#x3D;<filename>ç”¨äºæŒ‡å®šå¿«ç…§dumpæ–‡ä»¶çš„æ–‡ä»¶åã€‚</p></blockquote><p>ä¾‹ï¼šæ˜¾ç¤ºäº†æŸä¸€ä¸ªjavaè¿è¡Œçš„å †ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\yuhon&gt;jmap -heap <span class="number">53280</span></span><br><span class="line">Attaching to process ID <span class="number">53280</span>, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is <span class="number">25.321</span>-b07</span><br><span class="line"></span><br><span class="line">using thread-local object allocation.</span><br><span class="line">Parallel GC with <span class="number">8</span> thread(s)   <span class="comment">//å¹¶è¡Œçš„åƒåœ¾å›æ”¶å™¨</span></span><br><span class="line"></span><br><span class="line">Heap Configuration:  <span class="comment">//å †é…ç½®</span></span><br><span class="line">   MinHeapFreeRatio         = <span class="number">0</span>   <span class="comment">//ç©ºé—²å †ç©ºé—´çš„æœ€å°ç™¾åˆ†æ¯”</span></span><br><span class="line">   MaxHeapFreeRatio         = <span class="number">100</span>  <span class="comment">//ç©ºé—²å †ç©ºé—´çš„æœ€å¤§ç™¾åˆ†æ¯”</span></span><br><span class="line">   MaxHeapSize              = <span class="number">8524922880</span> (<span class="number">8130.</span>0MB) <span class="comment">//å †ç©ºé—´å…è®¸çš„æœ€å¤§å€¼</span></span><br><span class="line">   NewSize                  = <span class="number">178257920</span> (<span class="number">170.</span>0MB) <span class="comment">//æ–°ç”Ÿä»£å †ç©ºé—´çš„é»˜è®¤å€¼</span></span><br><span class="line">   MaxNewSize               = <span class="number">2841640960</span> (<span class="number">2710.</span>0MB) <span class="comment">//æ–°ç”Ÿä»£å †ç©ºé—´å…è®¸çš„æœ€å¤§å€¼</span></span><br><span class="line">   OldSize                  = <span class="number">356515840</span> (<span class="number">340.</span>0MB) <span class="comment">//è€å¹´ä»£å †ç©ºé—´çš„é»˜è®¤å€¼</span></span><br><span class="line">   NewRatio                 = <span class="number">2</span> <span class="comment">//æ–°ç”Ÿä»£ä¸è€å¹´ä»£çš„å †ç©ºé—´æ¯”å€¼ï¼Œè¡¨ç¤ºæ–°ç”Ÿä»£ï¼šè€å¹´ä»£=1ï¼š2</span></span><br><span class="line">   SurvivorRatio            = <span class="number">8</span> <span class="comment">//ä¸¤ä¸ªSurvivoråŒºå’ŒEdenåŒºçš„å †ç©ºé—´æ¯”å€¼ä¸º8,è¡¨ç¤ºS0:S1:Eden=1:1:8</span></span><br><span class="line">   MetaspaceSize            = <span class="number">21807104</span> (<span class="number">20.</span>796875MB) <span class="comment">//å…ƒç©ºé—´çš„é»˜è®¤å€¼</span></span><br><span class="line">   CompressedClassSpaceSize = <span class="number">1073741824</span> (<span class="number">1024.</span>0MB) <span class="comment">//å‹ç¼©ç±»ä½¿ç”¨ç©ºé—´å¤§å°</span></span><br><span class="line">   MaxMetaspaceSize         = <span class="number">17592186044415</span> MB <span class="comment">//å…ƒç©ºé—´å…è®¸çš„æœ€å¤§å€¼</span></span><br><span class="line">   G1HeapRegionSize         = <span class="number">0</span> (<span class="number">0.</span>0MB)<span class="comment">//åœ¨ä½¿ç”¨ G1 åƒåœ¾å›æ”¶ç®—æ³•æ—¶ï¼ŒJVM ä¼šå°† Heap ç©ºé—´åˆ†éš”ä¸ºè‹¥å¹²ä¸ª Regionï¼Œè¯¥å‚æ•°ç”¨æ¥æŒ‡å®šæ¯ä¸ª Region ç©ºé—´çš„å¤§å°ã€‚</span></span><br><span class="line"></span><br><span class="line">Heap Usage:</span><br><span class="line">PS Young Generation</span><br><span class="line">Eden Space: <span class="comment">//Edenä½¿ç”¨æƒ…å†µ</span></span><br><span class="line">   capacity = <span class="number">134217728</span> (<span class="number">128.</span>0MB)</span><br><span class="line">   used     = <span class="number">10737496</span> (<span class="number">10.</span>240074157714844MB)</span><br><span class="line">   free     = <span class="number">123480232</span> (<span class="number">117.</span>75992584228516MB)</span><br><span class="line">   <span class="number">8.000057935714722</span>% used</span><br><span class="line">From Space: <span class="comment">//Survivor-From ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line">   capacity = <span class="number">22020096</span> (<span class="number">21.</span>0MB)</span><br><span class="line">   used     = <span class="number">0</span> (<span class="number">0.</span>0MB)</span><br><span class="line">   free     = <span class="number">22020096</span> (<span class="number">21.</span>0MB)</span><br><span class="line">   <span class="number">0.0</span>% used</span><br><span class="line">To Space: <span class="comment">//Survivor-To ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line">   capacity = <span class="number">22020096</span> (<span class="number">21.</span>0MB)</span><br><span class="line">   used     = <span class="number">0</span> (<span class="number">0.</span>0MB)</span><br><span class="line">   free     = <span class="number">22020096</span> (<span class="number">21.</span>0MB)</span><br><span class="line">   <span class="number">0.0</span>% used</span><br><span class="line">PS Old Generation  <span class="comment">//è€å¹´ä»£ ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line">   capacity = <span class="number">356515840</span> (<span class="number">340.</span>0MB)</span><br><span class="line">   used     = <span class="number">0</span> (<span class="number">0.</span>0MB)</span><br><span class="line">   free     = <span class="number">356515840</span> (<span class="number">340.</span>0MB)</span><br><span class="line">   <span class="number">0.0</span>% used</span><br><span class="line"></span><br><span class="line"><span class="number">3185</span> interned Strings occupying <span class="number">261264</span> bytes.</span><br></pre></td></tr></table></figure><h5 id="4-3-1-4-jhat"><a href="#4-3-1-4-jhat" class="headerlink" title="4.3.1.4 jhat"></a>4.3.1.4 jhat</h5><p>ç”¨äºåˆ†æjmapç”Ÿæˆçš„å †è½¬å­˜å¿«ç…§ï¼ˆä¸€èˆ¬ä¸æ¨èä½¿ç”¨ï¼Œè€Œæ˜¯ä½¿ç”¨Ecplise Memory Analyzerï¼‰</p><h5 id="4-3-1-5-jstat"><a href="#4-3-1-5-jstat" class="headerlink" title="4.3.1.5 jstat"></a>4.3.1.5 jstat</h5><p>æ˜¯JVMç»Ÿè®¡ç›‘æµ‹å·¥å…·ã€‚å¯ä»¥ç”¨æ¥æ˜¾ç¤ºåƒåœ¾å›æ”¶ä¿¡æ¯ã€ç±»åŠ è½½ä¿¡æ¯ã€æ–°ç”Ÿä»£ç»Ÿè®¡ä¿¡æ¯ç­‰ã€‚</p><p><strong>å¸¸è§å‚æ•°</strong>ï¼š</p><p>â‘ æ€»ç»“åƒåœ¾å›æ”¶ç»Ÿè®¡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstat -gcutil pid</span><br></pre></td></tr></table></figure><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220904114511854.png" alt="image-20220904114511854"></p><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>S0</td><td>å¹¸å­˜1åŒºå½“å‰ä½¿ç”¨æ¯”ä¾‹</td></tr><tr><td>S1</td><td>å¹¸å­˜2åŒºå½“å‰ä½¿ç”¨æ¯”ä¾‹</td></tr><tr><td>E</td><td>ä¼Šç”¸å›­åŒºä½¿ç”¨æ¯”ä¾‹</td></tr><tr><td>O</td><td>è€å¹´ä»£ä½¿ç”¨æ¯”ä¾‹</td></tr><tr><td>M</td><td>å…ƒæ•°æ®åŒºä½¿ç”¨æ¯”ä¾‹</td></tr><tr><td>CCS</td><td>å‹ç¼©ä½¿ç”¨æ¯”ä¾‹</td></tr><tr><td>YGC</td><td>å¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°</td></tr><tr><td>YGCT</td><td>å¹´è½»ä»£åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´</td></tr><tr><td>FGC</td><td>è€å¹´ä»£åƒåœ¾å›æ”¶æ¬¡æ•°</td></tr><tr><td>FGCT</td><td>è€å¹´ä»£åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´</td></tr><tr><td>GCT</td><td>åƒåœ¾å›æ”¶æ¶ˆè€—æ€»æ—¶é—´</td></tr></tbody></table><p>â‘¡åƒåœ¾å›æ”¶ç»Ÿè®¡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstat -gc pid</span><br></pre></td></tr></table></figure><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220904115157363.png" alt="image-20220904115157363"></p><h4 id="4-3-2-å¯è§†åŒ–å·¥å…·"><a href="#4-3-2-å¯è§†åŒ–å·¥å…·" class="headerlink" title="4.3.2 å¯è§†åŒ–å·¥å…·"></a>4.3.2 å¯è§†åŒ–å·¥å…·</h4><h5 id="4-3-2-1-jconsole"><a href="#4-3-2-1-jconsole" class="headerlink" title="4.3.2.1 jconsole"></a>4.3.2.1 jconsole</h5><p>ç”¨äºå¯¹jvmçš„å†…å­˜ï¼Œçº¿ç¨‹ï¼Œç±» çš„ç›‘æ§ï¼Œæ˜¯ä¸€ä¸ªåŸºäº jmx çš„ GUI æ€§èƒ½ç›‘æ§å·¥å…·</p><p>æ‰“å¼€æ–¹å¼ï¼šjava å®‰è£…ç›®å½• binç›®å½•ä¸‹ ç›´æ¥å¯åŠ¨ jconsole.exe å°±è¡Œ</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220904115936095.png" alt="image-20220904115936095"></p><p>å¯ä»¥å†…å­˜ã€çº¿ç¨‹ã€ç±»ç­‰ä¿¡æ¯</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220904120057211.png" alt="image-20220904120057211"></p><h5 id="4-3-2-2-VisualVMï¼šæ•…éšœå¤„ç†å·¥å…·"><a href="#4-3-2-2-VisualVMï¼šæ•…éšœå¤„ç†å·¥å…·" class="headerlink" title="4.3.2.2 VisualVMï¼šæ•…éšœå¤„ç†å·¥å…·"></a>4.3.2.2 VisualVMï¼šæ•…éšœå¤„ç†å·¥å…·</h5><p>èƒ½å¤Ÿç›‘æ§çº¿ç¨‹ï¼Œå†…å­˜æƒ…å†µï¼ŒæŸ¥çœ‹æ–¹æ³•çš„CPUæ—¶é—´å’Œå†…å­˜ä¸­çš„å¯¹ è±¡ï¼Œå·²è¢«GCçš„å¯¹è±¡ï¼Œåå‘æŸ¥çœ‹åˆ†é…çš„å †æ ˆ</p><p>æ‰“å¼€æ–¹å¼ï¼šjava å®‰è£…ç›®å½• binç›®å½•ä¸‹ ç›´æ¥å¯åŠ¨ jvisualvm.exeå°±è¡Œ</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220904120356174.png" alt="image-20220904120356174"></p><p>ç›‘æ§ç¨‹åºè¿è¡Œæƒ…å†µ</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220904132011289.png" alt="image-20220904132011289"></p><p>æŸ¥çœ‹è¿è¡Œä¸­çš„dump</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220904132134095.png" alt="image-20220904132134095"></p><p>æŸ¥çœ‹å †ä¸­çš„ä¿¡æ¯</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220904132346495.png" alt="image-20220904132346495"></p><h3 id="4-4-javaå†…å­˜æ³„éœ²çš„æ’æŸ¥æ€è·¯ï¼Ÿ"><a href="#4-4-javaå†…å­˜æ³„éœ²çš„æ’æŸ¥æ€è·¯ï¼Ÿ" class="headerlink" title="4.4 javaå†…å­˜æ³„éœ²çš„æ’æŸ¥æ€è·¯ï¼Ÿ"></a>4.4 javaå†…å­˜æ³„éœ²çš„æ’æŸ¥æ€è·¯ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><p>åŸå› ï¼š</p><p>å¦‚æœçº¿ç¨‹è¯·æ±‚åˆ†é…çš„æ ˆå®¹é‡è¶…è¿‡javaè™šæ‹Ÿæœºæ ˆå…è®¸çš„æœ€å¤§å®¹é‡çš„æ—¶å€™ï¼Œjavaè™šæ‹Ÿæœºå°†æŠ›å‡ºä¸€ä¸ªStackOverFlowErrorå¼‚å¸¸</p><p>å¦‚æœjavaè™šæ‹Ÿæœºæ ˆå¯ä»¥åŠ¨æ€æ‹“å±•ï¼Œå¹¶ä¸”æ‰©å±•çš„åŠ¨ä½œå·²ç»å°è¯•è¿‡ï¼Œä½†æ˜¯ç›®å‰æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜å»å®Œæˆæ‹“å±•ï¼Œæˆ–è€…åœ¨å»ºç«‹æ–°çº¿ç¨‹çš„æ—¶å€™æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å»åˆ›å»ºå¯¹åº”çš„è™šæ‹Ÿæœºæ ˆï¼Œé‚£javaè™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ªOutOfMemoryErrorå¼‚å¸¸</p><p>å¦‚æœä¸€æ¬¡åŠ è½½çš„ç±»å¤ªå¤šï¼Œå…ƒç©ºé—´å†…å­˜ä¸è¶³ï¼Œåˆ™ä¼šæŠ¥OutOfMemoryError: Metaspace</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230506155704119.png" alt="image-20230506155704119"></p><p>1ã€é€šè¿‡jmapæŒ‡å®šæ‰“å°ä»–çš„å†…å­˜å¿«ç…§ dump</p><blockquote><p>æœ‰çš„æƒ…å†µæ˜¯å†…å­˜æº¢å‡ºä¹‹åç¨‹åºåˆ™ä¼šç›´æ¥ä¸­æ–­ï¼Œè€Œjmapåªèƒ½æ‰“å°åœ¨è¿è¡Œä¸­çš„ç¨‹åºï¼Œæ‰€ä»¥å»ºè®®é€šè¿‡å‚æ•°çš„æ–¹å¼çš„ç”Ÿæˆdumpæ–‡ä»¶ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><p>-XX:+HeapDumpOnOutOfMemoryError<br>-XX:HeapDumpPath&#x3D;&#x2F;home&#x2F;app&#x2F;dumps&#x2F;      æŒ‡å®šç”Ÿæˆåæ–‡ä»¶çš„ä¿å­˜ç›®å½•</p></blockquote><p>2ã€é€šè¿‡å·¥å…·ï¼Œ VisualVMï¼ˆEcplise MATï¼‰å»åˆ†æ dumpæ–‡ä»¶</p><p>VisualVMå¯ä»¥åŠ è½½ç¦»çº¿çš„dumpæ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾</p><p>æ–‡ä»¶â€“&gt;è£…å…¥â€”&gt;é€‰æ‹©dumpæ–‡ä»¶å³å¯æŸ¥çœ‹å †å¿«ç…§ä¿¡æ¯</p><blockquote><p>å¦‚æœæ˜¯linuxç³»ç»Ÿä¸­çš„ç¨‹åºï¼Œåˆ™éœ€è¦æŠŠdumpæ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼ˆwindowsç¯å¢ƒï¼‰ä¸‹ï¼Œæ‰“å¼€VisualVMå·¥å…·åˆ†æã€‚VisualVMç›®å‰åªæ”¯æŒåœ¨windowsç¯å¢ƒä¸‹è¿è¡Œå¯è§†åŒ–</p></blockquote><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220904132925812.png" alt="image-20220904132925812"></p><p>3ã€é€šè¿‡æŸ¥çœ‹å †ä¿¡æ¯çš„æƒ…å†µï¼Œå¯ä»¥å¤§æ¦‚å®šä½å†…å­˜æº¢å‡ºæ˜¯å“ªè¡Œä»£ç å‡ºäº†é—®é¢˜</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220904133722905.png" alt="image-20220904133722905"></p><p>4ã€æ‰¾åˆ°å¯¹åº”çš„ä»£ç ï¼Œé€šè¿‡é˜…è¯»ä¸Šä¸‹æ–‡çš„æƒ…å†µï¼Œè¿›è¡Œä¿®å¤å³å¯</p><h3 id="4-5-CPUé£™é«˜æ’æŸ¥æ–¹æ¡ˆä¸æ€è·¯ï¼Ÿ"><a href="#4-5-CPUé£™é«˜æ’æŸ¥æ–¹æ¡ˆä¸æ€è·¯ï¼Ÿ" class="headerlink" title="4.5 CPUé£™é«˜æ’æŸ¥æ–¹æ¡ˆä¸æ€è·¯ï¼Ÿ"></a>4.5 CPUé£™é«˜æ’æŸ¥æ–¹æ¡ˆä¸æ€è·¯ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><p>1.ä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹å ç”¨cpuçš„æƒ…å†µ</p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220904161818255.png" alt="image-20220904161818255"></p><p>2.é€šè¿‡topå‘½ä»¤æŸ¥çœ‹åï¼Œå¯ä»¥æŸ¥çœ‹æ˜¯å“ªä¸€ä¸ªè¿›ç¨‹å ç”¨cpuè¾ƒé«˜ï¼Œä¸Šå›¾æ‰€ç¤ºçš„è¿›ç¨‹ä¸ºï¼š30978</p><p>3.æŸ¥çœ‹å½“å‰çº¿ç¨‹ä¸­çš„è¿›ç¨‹ä¿¡æ¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps H -eo pid,tid,%cpu | grep 40940</span><br></pre></td></tr></table></figure><blockquote><p>pid  è¿›è¡Œid</p><p>tid   è¿›ç¨‹ä¸­çš„çº¿ç¨‹id</p><p>%  cpuä½¿ç”¨ç‡ </p></blockquote><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220904162117022.png" alt="image-20220904162117022"></p><p>4.é€šè¿‡ä¸Šå›¾åˆ†æï¼Œåœ¨è¿›ç¨‹30978ä¸­çš„çº¿ç¨‹30979å ç”¨cpuè¾ƒé«˜</p><blockquote><p>æ³¨æ„ï¼šä¸Šè¿°çš„çº¿ç¨‹idæ˜¯ä¸€ä¸ªåè¿›åˆ¶ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªçº¿ç¨‹idè½¬æ¢ä¸º16è¿›åˆ¶æ‰è¡Œï¼Œå› ä¸ºé€šå¸¸åœ¨æ—¥å¿—ä¸­å±•ç¤ºçš„éƒ½æ˜¯16è¿›åˆ¶çš„çº¿ç¨‹idåç§°</p><p>è½¬æ¢æ–¹å¼ï¼š</p><p>åœ¨linuxä¸­æ‰§è¡Œå‘½ä»¤</p><p><code>printf &quot;%x\n&quot; 30979</code></p><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220904162654928.png" alt="image-20220904162654928"></p></blockquote><p>5.å¯ä»¥æ ¹æ®çº¿ç¨‹ id æ‰¾åˆ°æœ‰é—®é¢˜çš„çº¿ç¨‹ï¼Œè¿›ä¸€æ­¥å®šä½åˆ°é—®é¢˜ä»£ç çš„æºç è¡Œå·</p><p>æ‰§è¡Œå‘½ä»¤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstack 30978   æ­¤å¤„æ˜¯è¿›ç¨‹<span class="built_in">id</span></span><br></pre></td></tr></table></figure><p><img src="/../assets/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220904162941977.png" alt="image-20220904162941977"></p><h2 id="5-é¢è¯•ç°åœº"><a href="#5-é¢è¯•ç°åœº" class="headerlink" title="5.é¢è¯•ç°åœº"></a>5.é¢è¯•ç°åœº</h2><h3 id="5-1-JVMç»„æˆ"><a href="#5-1-JVMç»„æˆ" class="headerlink" title="5.1 JVMç»„æˆ"></a>5.1 JVMç»„æˆ</h3><blockquote><p><strong>é¢è¯•å®˜</strong>ï¼šJVMç”±é‚£äº›éƒ¨åˆ†ç»„æˆï¼Œè¿è¡Œæµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ</p><p><strong>å€™é€‰äºº:</strong></p><p>å—¯ï¼Œå¥½çš„~~</p><p>åœ¨JVMä¸­å…±æœ‰å››å¤§éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ClassLoaderï¼ˆç±»åŠ è½½å™¨ï¼‰ã€Runtime Data Areaï¼ˆè¿è¡Œæ—¶æ•°æ®åŒºï¼Œå†…å­˜åˆ†åŒºï¼‰ã€Execution Engineï¼ˆæ‰§è¡Œå¼•æ“ï¼‰ã€Native Method Libraryï¼ˆæœ¬åœ°åº“æ¥å£ï¼‰</p><p>å®ƒä»¬çš„è¿è¡Œæµç¨‹æ˜¯ï¼š</p><p>ç¬¬ä¸€ï¼Œç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰æŠŠJavaä»£ç è½¬æ¢ä¸ºå­—èŠ‚ç </p><p>ç¬¬äºŒï¼Œè¿è¡Œæ—¶æ•°æ®åŒºï¼ˆRuntime Data Areaï¼‰æŠŠå­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œå­—èŠ‚ç æ–‡ä»¶åªæ˜¯JVMçš„ä¸€å¥—æŒ‡ä»¤é›†è§„èŒƒï¼Œå¹¶ä¸èƒ½ç›´æ¥äº¤ç»™åº•å±‚ç³»ç»Ÿå»æ‰§è¡Œï¼Œè€Œæ˜¯æœ‰æ‰§è¡Œå¼•æ“è¿è¡Œ</p><p>ç¬¬ä¸‰ï¼Œæ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰å°†å­—èŠ‚ç ç¿»è¯‘ä¸ºåº•å±‚ç³»ç»ŸæŒ‡ä»¤ï¼Œå†äº¤ç”±CPUæ‰§è¡Œå»æ‰§è¡Œï¼Œæ­¤æ—¶éœ€è¦è°ƒç”¨å…¶ä»–è¯­è¨€çš„æœ¬åœ°åº“æ¥å£ï¼ˆNative Method Libraryï¼‰æ¥å®ç°æ•´ä¸ªç¨‹åºçš„åŠŸèƒ½ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šå¥½çš„ï¼Œä½ èƒ½è¯¦ç»†è¯´ä¸€ä¸‹ JVM è¿è¡Œæ—¶æ•°æ®åŒºå—ï¼Ÿ</p><p><strong>å€™é€‰äºº:</strong></p><p>å—¯ï¼Œå¥½~</p><p>è¿è¡Œæ—¶æ•°æ®åŒºåŒ…å«äº†å †ã€æ–¹æ³•åŒºã€æ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨è¿™å‡ éƒ¨åˆ†ï¼Œæ¯ä¸ªåŠŸèƒ½ä½œç”¨ä¸ä¸€æ ·ã€‚</p><ul><li>å †è§£å†³çš„æ˜¯å¯¹è±¡å®ä¾‹å­˜å‚¨çš„é—®é¢˜ï¼Œåƒåœ¾å›æ”¶å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸã€‚</li><li>æ–¹æ³•åŒºå¯ä»¥è®¤ä¸ºæ˜¯å †çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ä¿¡æ¯ï¼Œå¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ã€‚</li><li>æ ˆè§£å†³çš„æ˜¯ç¨‹åºè¿è¡Œçš„é—®é¢˜ï¼Œæ ˆé‡Œé¢å­˜çš„æ˜¯æ ˆå¸§ï¼Œæ ˆå¸§é‡Œé¢å­˜çš„æ˜¯å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸æ ˆåŠŸèƒ½ç›¸åŒï¼Œæœ¬åœ°æ–¹æ³•æ ˆæ‰§è¡Œçš„æ˜¯æœ¬åœ°æ–¹æ³•ï¼Œä¸€ä¸ªJavaè°ƒç”¨éJavaä»£ç çš„æ¥å£ã€‚</li><li>ç¨‹åºè®¡æ•°å™¨ï¼ˆPCå¯„å­˜å™¨ï¼‰ç¨‹åºè®¡æ•°å™¨ä¸­å­˜æ”¾çš„æ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œæ•°ã€‚JVMå·¥ä½œæ—¶å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€ä¸ªéœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</li></ul><p><strong>é¢è¯•å®˜</strong>ï¼šå¥½çš„ï¼Œä½ å†è¯¦ç»†ä»‹ç»ä¸€ä¸‹ç¨‹åºè®¡æ•°å™¨çš„ä½œç”¨ï¼Ÿ</p><p><strong>å€™é€‰äºº:</strong></p><p>å—¯ï¼Œæ˜¯è¿™æ ·~~</p><p>javaè™šæ‹Ÿæœºå¯¹äºå¤šçº¿ç¨‹æ˜¯é€šè¿‡çº¿ç¨‹è½®æµåˆ‡æ¢å¹¶ä¸”åˆ†é…çº¿ç¨‹æ‰§è¡Œæ—¶é—´ã€‚åœ¨ä»»ä½•çš„ä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œä¸€ä¸ªå¤„ç†å™¨åªä¼šå¤„ç†æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æœå½“å‰è¢«æ‰§è¡Œçš„è¿™ä¸ªçº¿ç¨‹å®ƒæ‰€åˆ†é…çš„æ‰§è¡Œæ—¶é—´ç”¨å®Œäº†ã€æŒ‚èµ·ã€‘ã€‚å¤„ç†å™¨ä¼šåˆ‡æ¢åˆ°å¦å¤–çš„ä¸€ä¸ªçº¿ç¨‹ä¸Šæ¥è¿›è¡Œæ‰§è¡Œã€‚å¹¶ä¸”è¿™ä¸ªçº¿ç¨‹çš„æ‰§è¡Œæ—¶é—´ç”¨å®Œäº†ï¼Œæ¥ç€å¤„ç†å™¨å°±ä¼šåˆæ¥æ‰§è¡Œè¢«æŒ‚èµ·çš„è¿™ä¸ªçº¿ç¨‹ã€‚è¿™æ—¶å€™ç¨‹åºè®¡æ•°å™¨å°±èµ·åˆ°äº†å…³é”®ä½œç”¨ï¼Œç¨‹åºè®¡æ•°å™¨åœ¨æ¥å›åˆ‡æ¢çš„çº¿ç¨‹ä¸­è®°å½•ä»–ä¸Šä¸€æ¬¡æ‰§è¡Œçš„è¡Œå·ï¼Œç„¶åæ¥ç€ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šä½ èƒ½ç»™æˆ‘è¯¦ç»†çš„ä»‹ç»Javaå †å—?</p><p><strong>å€™é€‰äºº:</strong></p><p>å¥½çš„~</p><p>Javaä¸­çš„å †æœ¯è¯­çº¿ç¨‹å…±äº«çš„åŒºåŸŸã€‚ä¸»è¦ç”¨æ¥ä¿å­˜<strong>å¯¹è±¡å®ä¾‹ï¼Œæ•°ç»„</strong>ç­‰ï¼Œå½“å †ä¸­æ²¡æœ‰å†…å­˜ç©ºé—´å¯åˆ†é…ç»™å®ä¾‹ï¼Œä¹Ÿæ— æ³•å†æ‰©å±•æ—¶ï¼Œåˆ™æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</p><p>â€‹åœ¨JAVA8ä¸­å †å†…ä¼šå­˜åœ¨å¹´è½»ä»£ã€è€å¹´ä»£</p><p>â€‹1ï¼‰YoungåŒºè¢«åˆ’åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼ŒEdenåŒºå’Œä¸¤ä¸ªå¤§å°ä¸¥æ ¼ç›¸åŒçš„SurvivoråŒºï¼Œå…¶ä¸­ï¼ŒSurvivoråŒºé—´ä¸­ï¼ŒæŸä¸€æ—¶åˆ»åªæœ‰å…¶ä¸­ä¸€ä¸ªæ˜¯è¢«ä½¿ç”¨çš„ï¼Œå¦å¤–ä¸€ä¸ªç•™åšåƒåœ¾æ”¶é›†æ—¶å¤åˆ¶å¯¹è±¡ç”¨ã€‚åœ¨EdenåŒºå˜æ»¡çš„æ—¶å€™ï¼Œ GCå°±ä¼šå°†å­˜æ´»çš„å¯¹è±¡ç§»åˆ°ç©ºé—²çš„SurvivoråŒºé—´ä¸­ï¼Œæ ¹æ®JVMçš„ç­–ç•¥ï¼Œåœ¨ç»è¿‡å‡ æ¬¡åƒåœ¾æ”¶é›†åï¼Œä»»ç„¶å­˜æ´»äºSurvivorçš„å¯¹è±¡å°†è¢«ç§»åŠ¨åˆ°TenuredåŒºé—´ã€‚</p><p>â€‹2ï¼‰TenuredåŒºä¸»è¦ä¿å­˜ç”Ÿå‘½å‘¨æœŸé•¿çš„å¯¹è±¡ï¼Œä¸€èˆ¬æ˜¯ä¸€äº›è€çš„å¯¹è±¡ï¼Œå½“ä¸€äº›å¯¹è±¡åœ¨Youngå¤åˆ¶è½¬ç§»ä¸€å®šçš„æ¬¡æ•°ä»¥åï¼Œå¯¹è±¡å°±ä¼šè¢«è½¬ç§»åˆ°TenuredåŒºã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šèƒ½ä¸èƒ½è§£é‡Šä¸€ä¸‹æ–¹æ³•åŒºï¼Ÿ</p><p><strong>å€™é€‰äºº:</strong></p><p>å¥½çš„~</p><p>ä¸è™šæ‹Ÿæœºæ ˆç±»ä¼¼ã€‚æœ¬åœ°æ–¹æ³•æ ˆæ˜¯ä¸ºè™šæ‹Ÿæœº<strong>æ‰§è¡Œæœ¬åœ°æ–¹æ³•æ—¶æä¾›æœåŠ¡çš„</strong>ã€‚ä¸éœ€è¦è¿›è¡ŒGCã€‚æœ¬åœ°æ–¹æ³•ä¸€èˆ¬æ˜¯ç”±å…¶ä»–è¯­è¨€ç¼–å†™ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šä½ å¬è¿‡ç›´æ¥å†…å­˜å—ï¼Ÿ</p><p><strong>å€™é€‰äºº:</strong></p><p>å—¯~~</p><p>å®ƒåˆå«åš<strong>å †å¤–å†…å­˜</strong>ï¼Œ<strong>çº¿ç¨‹å…±äº«çš„åŒºåŸŸ</strong>ï¼Œåœ¨ Java 8 ä¹‹å‰æœ‰ä¸ª<strong>æ°¸ä¹…ä»£</strong>çš„æ¦‚å¿µï¼Œå®é™…ä¸ŠæŒ‡çš„æ˜¯ HotSpot è™šæ‹Ÿæœºä¸Šçš„æ°¸ä¹…ä»£ï¼Œå®ƒç”¨æ°¸ä¹…ä»£å®ç°äº† JVM è§„èŒƒå®šä¹‰çš„æ–¹æ³•åŒºåŠŸèƒ½ï¼Œ<strong>ä¸»è¦å­˜å‚¨ç±»çš„ä¿¡æ¯ï¼Œå¸¸é‡ï¼Œé™æ€å˜é‡</strong>ï¼Œå³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åä»£ç ç­‰ï¼Œè¿™éƒ¨åˆ†ç”±äºæ˜¯åœ¨å †ä¸­å®ç°çš„ï¼Œå— GC çš„ç®¡ç†ï¼Œä¸è¿‡ç”±äºæ°¸ä¹…ä»£æœ‰ -XX:MaxPermSize çš„ä¸Šé™ï¼Œæ‰€ä»¥å¦‚æœå¤§é‡åŠ¨æ€ç”Ÿæˆç±»ï¼ˆå°†ç±»ä¿¡æ¯æ”¾å…¥æ°¸ä¹…ä»£ï¼‰ï¼Œå¾ˆå®¹æ˜“é€ æˆ OOMï¼Œæœ‰äººè¯´å¯ä»¥æŠŠæ°¸ä¹…ä»£è®¾ç½®å¾—è¶³å¤Ÿå¤§ï¼Œä½†å¾ˆéš¾ç¡®å®šä¸€ä¸ªåˆé€‚çš„å¤§å°ï¼Œå—ç±»æ•°é‡ï¼Œå¸¸é‡æ•°é‡çš„å¤šå°‘å½±å“å¾ˆå¤§ã€‚</p><p>â€‹æ‰€ä»¥åœ¨ Java 8 ä¸­å°±æŠŠæ–¹æ³•åŒºçš„å®ç°ç§»åˆ°äº†æœ¬åœ°å†…å­˜ä¸­çš„å…ƒç©ºé—´ä¸­ï¼Œè¿™æ ·æ–¹æ³•åŒºå°±ä¸å— JVM çš„æ§åˆ¶äº†,ä¹Ÿå°±ä¸ä¼šè¿›è¡Œ GCï¼Œä¹Ÿå› æ­¤æå‡äº†æ€§èƒ½ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šä»€ä¹ˆæ˜¯è™šæ‹Ÿæœºæ ˆ</p><p><strong>å€™é€‰äºº:</strong></p><p>è™šæ‹Ÿæœºæ ˆæ˜¯æè¿°çš„æ˜¯æ–¹æ³•æ‰§è¡Œæ—¶çš„å†…å­˜æ¨¡å‹,æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒ,æ¯ä¸ªæ–¹æ³•è¢«æ‰§è¡Œçš„åŒæ—¶ä¼šåˆ›å»º<strong>æ ˆæ¡¢</strong>ã€‚ä¿å­˜æ‰§è¡Œæ–¹æ³•æ—¶çš„<strong>å±€éƒ¨å˜é‡ã€åŠ¨æ€è¿æ¥ä¿¡æ¯ã€æ–¹æ³•è¿”å›åœ°å€ä¿¡æ¯</strong>ç­‰ç­‰ã€‚æ–¹æ³•å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ä¼šè¿›æ ˆï¼Œæ–¹æ³•æ‰§è¡Œå®Œä¼šå‡ºæ ˆã€ç›¸å½“äºæ¸…ç©ºäº†æ•°æ®ã€‘ï¼Œæ‰€ä»¥è¿™å—åŒºåŸŸ<strong>ä¸éœ€è¦è¿›è¡Œ GC</strong>ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šèƒ½è¯´ä¸€ä¸‹å †æ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆå—ï¼Ÿ</p><p><strong>å€™é€‰äºº:</strong></p><p>å—¯ï¼Œå¥½çš„ï¼Œæœ‰è¿™å‡ ä¸ªåŒºåˆ«</p><p>ç¬¬ä¸€ï¼Œæ ˆå†…å­˜ä¸€èˆ¬ä¼šç”¨æ¥å­˜å‚¨å±€éƒ¨å˜é‡å’Œæ–¹æ³•è°ƒç”¨ï¼Œä½†å †å†…å­˜æ˜¯ç”¨æ¥å­˜å‚¨Javaå¯¹è±¡å’Œæ•°ç»„çš„çš„ã€‚å †ä¼šGCåƒåœ¾å›æ”¶ï¼Œè€Œæ ˆä¸ä¼šã€‚</p><p>ç¬¬äºŒã€æ ˆå†…å­˜æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œè€Œå †å†…å­˜æ˜¯çº¿ç¨‹å…±æœ‰çš„ã€‚</p><p>ç¬¬ä¸‰ã€ä¸¤è€…å¼‚å¸¸é”™è¯¯ä¸åŒï¼Œä½†å¦‚æœæ ˆå†…å­˜æˆ–è€…å †å†…å­˜ä¸è¶³éƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><p>æ ˆç©ºé—´ä¸è¶³ï¼šjava.lang.StackOverFlowErrorã€‚</p><p>å †ç©ºé—´ä¸è¶³ï¼šjava.lang.OutOfMemoryErrorã€‚</p></blockquote><h3 id="5-2-ç±»åŠ è½½å™¨"><a href="#5-2-ç±»åŠ è½½å™¨" class="headerlink" title="5.2 ç±»åŠ è½½å™¨"></a>5.2 ç±»åŠ è½½å™¨</h3><blockquote><p><strong>é¢è¯•å®˜</strong>ï¼šä»€ä¹ˆæ˜¯ç±»åŠ è½½å™¨ï¼Œç±»åŠ è½½å™¨æœ‰å“ªäº›?</p><p><strong>å€™é€‰äºº:</strong></p><p>å—¯ï¼Œæ˜¯è¿™æ ·çš„</p><p>JVMåªä¼šè¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè€Œç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰çš„ä¸»è¦ä½œç”¨å°±æ˜¯å°†<strong>å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°JVMä¸­</strong>ï¼Œä»è€Œè®©Javaç¨‹åºèƒ½å¤Ÿå¯åŠ¨èµ·æ¥ã€‚</p><p>å¸¸è§çš„ç±»åŠ è½½å™¨æœ‰4ä¸ª</p><p>ç¬¬ä¸€ä¸ªæ˜¯å¯åŠ¨ç±»åŠ è½½å™¨(BootStrap ClassLoader)ï¼šå…¶æ˜¯ç”±C++ç¼–å†™å®ç°ã€‚ç”¨äºåŠ è½½JAVA_HOME&#x2F;jre&#x2F;libç›®å½•ä¸‹çš„ç±»åº“ã€‚</p><p>ç¬¬äºŒä¸ªæ˜¯æ‰©å±•ç±»åŠ è½½å™¨(ExtClassLoader)ï¼šè¯¥ç±»æ˜¯ClassLoaderçš„å­ç±»ï¼Œä¸»è¦åŠ è½½JAVA_HOME&#x2F;jre&#x2F;lib&#x2F;extç›®å½•ä¸­çš„ç±»åº“ã€‚</p><p>ç¬¬ä¸‰ä¸ªæ˜¯åº”ç”¨ç±»åŠ è½½å™¨(AppClassLoader)ï¼šè¯¥ç±»æ˜¯ClassLoaderçš„å­ç±»ï¼Œä¸»è¦ç”¨äºåŠ è½½classPathä¸‹çš„ç±»ï¼Œä¹Ÿå°±æ˜¯åŠ è½½å¼€å‘è€…è‡ªå·±ç¼–å†™çš„Javaç±»ã€‚</p><p>ç¬¬å››ä¸ªæ˜¯è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼šå¼€å‘è€…è‡ªå®šä¹‰ç±»ç»§æ‰¿ClassLoaderï¼Œå®ç°è‡ªå®šä¹‰ç±»åŠ è½½è§„åˆ™ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šè¯´ä¸€ä¸‹ç±»è£…è½½çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ</p><p><strong>å€™é€‰äºº:</strong></p><p>å—¯ï¼Œè¿™ä¸ªè¿‡ç¨‹è¿˜æ˜¯æŒºå¤šçš„ã€‚</p><p>ç±»ä»åŠ è½½åˆ°è™šæ‹Ÿæœºä¸­å¼€å§‹ï¼Œç›´åˆ°å¸è½½ä¸ºæ­¢ï¼Œå®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬äº†ï¼šåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–ã€ä½¿ç”¨å’Œå¸è½½è¿™7ä¸ªé˜¶æ®µã€‚å…¶ä¸­ï¼ŒéªŒè¯ã€å‡†å¤‡å’Œè§£æè¿™ä¸‰ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºè¿æ¥ï¼ˆlinkingï¼‰</p><p>1.åŠ è½½ï¼šæŸ¥æ‰¾å’Œå¯¼å…¥classæ–‡ä»¶</p><p>2.éªŒè¯ï¼šä¿è¯åŠ è½½ç±»çš„å‡†ç¡®æ€§</p><p>3.å‡†å¤‡ï¼šä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼</p><p>4.è§£æï¼šæŠŠç±»ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨</p><p>5.åˆå§‹åŒ–ï¼šå¯¹ç±»çš„é™æ€å˜é‡ï¼Œé™æ€ä»£ç å—æ‰§è¡Œåˆå§‹åŒ–æ“ä½œ</p><p>6.ä½¿ç”¨ï¼šJVM å¼€å§‹ä»å…¥å£æ–¹æ³•å¼€å§‹æ‰§è¡Œç”¨æˆ·çš„ç¨‹åºä»£ç </p><p>7.å¸è½½ï¼šå½“ç”¨æˆ·ç¨‹åºä»£ç æ‰§è¡Œå®Œæ¯•åï¼ŒJVM ä¾¿å¼€å§‹é”€æ¯åˆ›å»ºçš„ Class å¯¹è±¡ï¼Œæœ€åè´Ÿè´£è¿è¡Œçš„ JVM ä¹Ÿé€€å‡ºå†…å­˜</p><p><strong>é¢è¯•å®˜</strong>ï¼šä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ</p><p><strong>å€™é€‰äºº:</strong></p><p>å—¯ï¼Œå®ƒæ˜¯æ˜¯è¿™æ ·çš„ã€‚</p><p>å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™è¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œæ¯ä¸€ä¸ªå±‚æ¬¡çš„ç±»åŠ è½½å™¨éƒ½æ˜¯å¦‚æ­¤ï¼Œå› æ­¤æ‰€æœ‰çš„åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ è¯´åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ï¼Œåªæœ‰å½“çˆ¶ç±»åŠ è½½å™¨è¿”å›è‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½è¯·æ±‚ï¼ˆå®ƒçš„æœç´¢è¿”å›ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼‰æ—¶ï¼Œå­ç±»åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½</p><p><strong>é¢è¯•å®˜</strong>ï¼šJVMä¸ºä»€ä¹ˆé‡‡ç”¨åŒäº²å§”æ´¾æœºåˆ¶</p><p><strong>å€™é€‰äºº:</strong></p><p>ä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ã€‚</p><p>ç¬¬ä¸€ã€é€šè¿‡åŒäº²å§”æ´¾æœºåˆ¶å¯ä»¥é¿å…æŸä¸€ä¸ªç±»è¢«é‡å¤åŠ è½½ï¼Œ<strong>å½“çˆ¶ç±»å·²ç»åŠ è½½ååˆ™æ— éœ€é‡å¤åŠ è½½ï¼Œä¿è¯å”¯ä¸€æ€§ã€‚</strong></p><p>ç¬¬äºŒã€ä¸ºäº†å®‰å…¨ï¼Œä¿è¯ç±»åº“APIä¸ä¼šè¢«ä¿®æ”¹</p></blockquote><h3 id="5-3-åƒåœ¾å›æ”¶"><a href="#5-3-åƒåœ¾å›æ”¶" class="headerlink" title="5.3 åƒåœ¾å›æ”¶"></a>5.3 åƒåœ¾å›æ”¶</h3><blockquote><p><strong>é¢è¯•å®˜</strong>ï¼šç®€è¿°Javaåƒåœ¾å›æ”¶æœºåˆ¶ï¼Ÿï¼ˆGCæ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦GCï¼‰</p><p><strong>å€™é€‰äºº:</strong></p><p>å—¯ï¼Œæ˜¯è¿™æ ·~~</p><p>ä¸ºäº†è®©ç¨‹åºå‘˜æ›´ä¸“æ³¨äºä»£ç çš„å®ç°ï¼Œè€Œä¸ç”¨è¿‡å¤šçš„è€ƒè™‘å†…å­˜é‡Šæ”¾çš„é—®é¢˜ï¼Œæ‰€ä»¥ï¼Œåœ¨Javaè¯­è¨€ä¸­ï¼Œæœ‰äº†è‡ªåŠ¨çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„GC(Garbage Collection)ã€‚</p><p>æœ‰äº†åƒåœ¾å›æ”¶æœºåˆ¶åï¼Œç¨‹åºå‘˜åªéœ€è¦å…³å¿ƒå†…å­˜çš„ç”³è¯·å³å¯ï¼Œå†…å­˜çš„é‡Šæ”¾ç”±ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«å®Œæˆã€‚</p><p>åœ¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œä¸åŒçš„å¯¹è±¡å¼•ç”¨ç±»å‹ï¼ŒGCä¼šé‡‡ç”¨ä¸åŒçš„å›æ”¶æ—¶æœº</p><p><strong>é¢è¯•å®˜</strong>ï¼šå¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨çš„åŒºåˆ«ï¼Ÿ</p><p><strong>å€™é€‰äºº:</strong></p><p>å—¯å—¯~</p><p>å¼ºå¼•ç”¨æœ€ä¸ºæ™®é€šçš„å¼•ç”¨æ–¹å¼ï¼Œè¡¨ç¤ºä¸€ä¸ªå¯¹è±¡å¤„äº<strong>æœ‰ç”¨ä¸”å¿…é¡»</strong>çš„çŠ¶æ€ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰å¼ºå¼•ç”¨ï¼Œåˆ™GCå¹¶ä¸ä¼šå›æ”¶å®ƒã€‚å³ä¾¿å †ä¸­å†…å­˜ä¸è¶³äº†ï¼Œå®å¯å‡ºç°OOMï¼Œä¹Ÿä¸ä¼šå¯¹å…¶è¿›è¡Œå›æ”¶</p><p>è½¯å¼•ç”¨è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡å¤„äº<strong>æœ‰ç”¨ä¸”éå¿…é¡»</strong>çŠ¶æ€ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡å¤„äºè½¯å¼•ç”¨ï¼Œåœ¨å†…å­˜ç©ºé—´è¶³å¤Ÿçš„æƒ…å†µä¸‹ï¼ŒGCæœºåˆ¶å¹¶ä¸ä¼šå›æ”¶å®ƒï¼Œè€Œåœ¨å†…å­˜ç©ºé—´ä¸è¶³æ—¶ï¼Œåˆ™ä¼šåœ¨OOMå¼‚å¸¸å‡ºç°ä¹‹é—´å¯¹å…¶è¿›è¡Œå›æ”¶ã€‚ä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºGCçº¿ç¨‹ä¼˜å…ˆçº§è¾ƒä½ï¼Œè½¯å¼•ç”¨å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ã€‚</p><p>å¼±å¼•ç”¨è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡å¤„äº<strong>å¯èƒ½æœ‰ç”¨ä¸”éå¿…é¡»</strong>çš„çŠ¶æ€ã€‚åœ¨GCçº¿ç¨‹æ‰«æå†…å­˜åŒºåŸŸæ—¶ï¼Œä¸€æ—¦å‘ç°å¼±å¼•ç”¨ï¼Œå°±ä¼šå›æ”¶åˆ°å¼±å¼•ç”¨ç›¸å…³è”çš„å¯¹è±¡ã€‚å¯¹äºå¼±å¼•ç”¨çš„å›æ”¶ï¼Œæ— å…³å†…å­˜åŒºåŸŸæ˜¯å¦è¶³å¤Ÿï¼Œä¸€æ—¦å‘ç°åˆ™ä¼šè¢«å›æ”¶ã€‚åŒæ ·çš„ï¼Œå› ä¸ºGCçº¿ç¨‹ä¼˜å…ˆçº§è¾ƒä½ï¼Œæ‰€ä»¥å¼±å¼•ç”¨ä¹Ÿå¹¶ä¸æ˜¯ä¼šè¢«ç«‹åˆ»å›æ”¶ã€‚</p><p>è™šå¼•ç”¨è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡å¤„äº<strong>æ— ç”¨</strong>çš„çŠ¶æ€ã€‚åœ¨ä»»ä½•æ—¶å€™éƒ½æœ‰å¯èƒ½è¢«åƒåœ¾å›æ”¶ã€‚è™šå¼•ç”¨çš„ä½¿ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—Reference Queueè”åˆä½¿ç”¨</p><p><strong>é¢è¯•å®˜</strong>ï¼šå¯¹è±¡ä»€ä¹ˆæ—¶å€™å¯ä»¥è¢«åƒåœ¾å™¨å›æ”¶</p><p><strong>å€™é€‰äºº:</strong></p><p>æ€è€ƒä¸€ä¼š~~</p><p>å¦‚æœä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡æ²¡æœ‰ä»»ä½•çš„å¼•ç”¨æŒ‡å‘å®ƒäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ç°åœ¨å°±æ˜¯åƒåœ¾ï¼Œå¦‚æœå®šä½äº†åƒåœ¾ï¼Œåˆ™æœ‰å¯èƒ½ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚</p><p>å¦‚æœè¦å®šä½ä»€ä¹ˆæ˜¯åƒåœ¾ï¼Œæœ‰ä¸¤ç§æ–¹å¼æ¥ç¡®å®šï¼Œç¬¬ä¸€ä¸ªæ˜¯å¼•ç”¨è®¡æ•°æ³•ï¼Œç¬¬äºŒä¸ªæ˜¯å¯è¾¾æ€§åˆ†æç®—æ³•</p><p>é€šå¸¸éƒ½ä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•æ¥ç¡®å®šæ˜¯ä¸æ˜¯åƒåœ¾</p><p><strong>é¢è¯•å®˜</strong>ï¼š JVM åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›ï¼Ÿ</p><p><strong>å€™é€‰äºº:</strong></p><p>æˆ‘è®°å¾—ä¸€å…±æœ‰å››ç§ï¼Œåˆ†åˆ«æ˜¯æ ‡è®°æ¸…é™¤ç®—æ³•ã€å¤åˆ¶ç®—æ³•ã€æ ‡è®°æ•´ç†ç®—æ³•ã€åˆ†ä»£å›æ”¶</p><p><strong>é¢è¯•å®˜</strong>ï¼š ä½ èƒ½è¯¦ç»†èŠä¸€ä¸‹åˆ†ä»£å›æ”¶å—ï¼Ÿ</p><p><strong>å€™é€‰äºº:</strong></p><p>å…³äºåˆ†ä»£å›æ”¶æ˜¯è¿™æ ·çš„</p><p>åœ¨java8æ—¶ï¼Œå †è¢«åˆ†ä¸ºäº†ä¸¤ä»½ï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œå®ƒä»¬é»˜è®¤ç©ºé—´å ç”¨æ¯”ä¾‹æ˜¯1:2</p><p>å¯¹äºæ–°ç”Ÿä»£ï¼Œå†…éƒ¨åˆè¢«åˆ†ä¸ºäº†ä¸‰ä¸ªåŒºåŸŸã€‚EdenåŒºï¼ŒS0åŒºï¼ŒS1åŒºé»˜è®¤ç©ºé—´å ç”¨æ¯”ä¾‹æ˜¯8:1:1</p><p>å…·ä½“çš„å·¥ä½œæœºåˆ¶æ˜¯æœ‰äº›æƒ…å†µï¼š</p><p>1ï¼‰å½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ä¼šè¢«åˆ†é…åœ¨æ–°ç”Ÿä»£çš„EdenåŒºã€‚å½“EdenåŒºè¦æ»¡äº†æ—¶å€™ï¼Œè§¦å‘YoungGCã€‚</p><p>2ï¼‰å½“è¿›è¡ŒYoungGCåï¼Œæ­¤æ—¶åœ¨EdenåŒºå­˜æ´»çš„å¯¹è±¡è¢«ç§»åŠ¨åˆ°S0åŒºï¼Œå¹¶ä¸”<strong>å½“å‰å¯¹è±¡çš„å¹´é¾„ä¼šåŠ 1</strong>ï¼Œæ¸…ç©ºEdenåŒºã€‚</p><p>3ï¼‰å½“å†ä¸€æ¬¡è§¦å‘YoungGCçš„æ—¶å€™ï¼Œä¼šæŠŠEdenåŒºä¸­å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡å’ŒS0ä¸­çš„å¯¹è±¡ï¼Œç§»åŠ¨åˆ°S1åŒºä¸­ï¼Œè¿™äº›å¯¹è±¡çš„å¹´é¾„ä¼šåŠ 1ï¼Œæ¸…ç©ºEdenåŒºå’ŒS0åŒºã€‚</p><p>4ï¼‰å½“å†ä¸€æ¬¡è§¦å‘YoungGCçš„æ—¶å€™ï¼Œä¼šæŠŠEdenåŒºä¸­å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡å’ŒS1ä¸­çš„å¯¹è±¡ï¼Œç§»åŠ¨åˆ°S0åŒºä¸­ï¼Œè¿™äº›å¯¹è±¡çš„å¹´é¾„ä¼šåŠ 1ï¼Œæ¸…ç©ºEdenåŒºå’ŒS1åŒºã€‚</p><p>5ï¼‰å¯¹è±¡çš„å¹´é¾„è¾¾åˆ°äº†æŸä¸€ä¸ªé™å®šçš„å€¼ï¼ˆ<strong>é»˜è®¤15å²</strong>  ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±ä¼šè¿›å…¥åˆ°è€å¹´ä»£ä¸­ã€‚</p><p>å½“ç„¶ä¹Ÿæœ‰ç‰¹æ®Šæƒ…å†µï¼Œå¦‚æœè¿›å…¥EdenåŒºçš„æ˜¯ä¸€ä¸ªå¤§å¯¹è±¡ï¼Œåœ¨è§¦å‘YoungGCçš„æ—¶å€™ï¼Œä¼šç›´æ¥å­˜æ”¾åˆ°è€å¹´ä»£</p><p>å½“è€å¹´ä»£æ»¡äº†ä¹‹åï¼Œ<strong>è§¦å‘FullGC</strong>ã€‚<strong>FullGCåŒæ—¶å›æ”¶æ–°ç”Ÿä»£å’Œè€å¹´ä»£</strong>ï¼Œå½“å‰åªä¼šå­˜åœ¨ä¸€ä¸ªFullGCçš„çº¿ç¨‹è¿›è¡Œæ‰§è¡Œï¼Œå…¶ä»–çš„çº¿ç¨‹å…¨éƒ¨ä¼šè¢«æŒ‚èµ·ã€‚  æˆ‘ä»¬åœ¨ç¨‹åºä¸­è¦å°½é‡é¿å…FullGCçš„å‡ºç°ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šè®²ä¸€ä¸‹æ–°ç”Ÿä»£ã€è€å¹´ä»£ã€æ°¸ä¹…ä»£çš„åŒºåˆ«ï¼Ÿ</p><p><strong>å€™é€‰äºº:</strong></p><p>å—¯ï¼æ˜¯è¿™æ ·çš„ï¼Œç®€å•è¯´å°±æ˜¯</p><p><strong>æ–°ç”Ÿä»£</strong>ä¸»è¦ç”¨æ¥å­˜æ”¾æ–°ç”Ÿçš„å¯¹è±¡ã€‚</p><p><strong>è€å¹´ä»£</strong>ä¸»è¦å­˜æ”¾åº”ç”¨ä¸­ç”Ÿå‘½å‘¨æœŸé•¿çš„å†…å­˜å¯¹è±¡ã€‚</p><p><strong>æ°¸ä¹…ä»£</strong>æŒ‡çš„æ˜¯æ°¸ä¹…ä¿å­˜åŒºåŸŸã€‚ä¸»è¦å­˜æ”¾Classå’ŒMetaï¼ˆå…ƒæ•°æ®ï¼‰çš„ä¿¡æ¯ã€‚åœ¨Java8ä¸­ï¼Œæ°¸ä¹…ä»£å·²ç»è¢«ç§»é™¤ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä¸€ä¸ªç§°ä¹‹ä¸ºâ€œå…ƒæ•°æ®åŒºâ€ï¼ˆ<strong>å…ƒç©ºé—´</strong>ï¼‰çš„åŒºåŸŸã€‚å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£ç±»ä¼¼ï¼Œä¸è¿‡å…ƒç©ºé—´ä¸æ°¸ä¹…ä»£ä¹‹é—´æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼šå…ƒç©ºé—´å¹¶ä¸åœ¨è™šæ‹Ÿæœºä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå…ƒç©ºé—´çš„å¤§å°ä»…å—æœ¬åœ°å†…å­˜çš„é™åˆ¶ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šè¯´ä¸€ä¸‹ JVM æœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨ï¼Ÿ</p><p><strong>å€™é€‰äºº:</strong></p><p>åœ¨jvmä¸­ï¼Œå®ç°äº†å¤šç§åƒåœ¾æ”¶é›†å™¨ï¼ŒåŒ…æ‹¬ï¼šä¸²è¡Œåƒåœ¾æ”¶é›†å™¨ã€å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨ï¼ˆJDK8é»˜è®¤ï¼‰ã€CMSï¼ˆå¹¶å‘ï¼‰åƒåœ¾æ”¶é›†å™¨ã€G1åƒåœ¾æ”¶é›†å™¨ï¼ˆJDK9é»˜è®¤ï¼‰</p><p><strong>é¢è¯•å®˜</strong>ï¼šMinor GCã€Major GCã€Full GCæ˜¯ä»€ä¹ˆ</p><p><strong>å€™é€‰äºº:</strong></p><p>å—¯ï¼Œå…¶å®å®ƒä»¬æŒ‡çš„æ˜¯ä¸åŒä»£ä¹‹é—´çš„åƒåœ¾å›æ”¶</p><p>Minor GC å‘ç”Ÿåœ¨æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶ï¼Œæš‚åœæ—¶é—´çŸ­</p><p>Major GC è€å¹´ä»£åŒºåŸŸçš„åƒåœ¾å›æ”¶ï¼Œè€å¹´ä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼šå…ˆå°è¯•è§¦å‘Minor GCã€‚Minor GCä¹‹åç©ºé—´è¿˜ä¸è¶³ï¼Œåˆ™ä¼šè§¦å‘Major GCï¼ŒMajor GCé€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œæš‚åœæ—¶é—´é•¿</p><p>Full GC æ–°ç”Ÿä»£ + è€å¹´ä»£å®Œæ•´åƒåœ¾å›æ”¶ï¼Œæš‚åœæ—¶é—´é•¿ï¼Œ<strong>åº”å°½åŠ›é¿å…</strong></p></blockquote><h3 id="5-4-JVMå®è·µï¼ˆè°ƒä¼˜ï¼‰"><a href="#5-4-JVMå®è·µï¼ˆè°ƒä¼˜ï¼‰" class="headerlink" title="5.4 JVMå®è·µï¼ˆè°ƒä¼˜ï¼‰"></a>5.4 JVMå®è·µï¼ˆè°ƒä¼˜ï¼‰</h3><blockquote><p><strong>é¢è¯•å®˜</strong>ï¼šJVM è°ƒä¼˜çš„å‚æ•°å¯ä»¥åœ¨å“ªé‡Œè®¾ç½®å‚æ•°å€¼ï¼Ÿ</p><p><strong>å€™é€‰äºº:</strong></p><p>æˆ‘ä»¬å½“æ—¶çš„é¡¹ç›®æ˜¯springbooté¡¹ç›®ï¼Œå¯ä»¥åœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™ï¼Œjava -jarä¸­åŠ å…¥å‚æ•°å°±è¡Œäº†</p><p><strong>é¢è¯•å®˜</strong>ï¼šç”¨çš„ JVM è°ƒä¼˜çš„å‚æ•°éƒ½æœ‰å“ªäº›ï¼Ÿ</p><p><strong>å€™é€‰äºº:</strong></p><p>å—¯ï¼Œè¿™äº›å‚æ•°æ˜¯æ¯”è¾ƒå¤šçš„</p><p>æˆ‘è®°å¾—å½“æ—¶æˆ‘ä»¬è®¾ç½®è¿‡å †çš„å¤§å°ï¼Œåƒ-Xmså’Œ-Xmx</p><p>è¿˜æœ‰å°±æ˜¯å¯ä»¥è®¾ç½®å¹´è½»ä»£ä¸­EdenåŒºå’Œä¸¤ä¸ªSurvivoråŒºçš„å¤§å°æ¯”ä¾‹</p><p>è¿˜æœ‰å°±æ˜¯å¯ä»¥è®¾ç½®ä½¿ç”¨å“ªç§åƒåœ¾å›æ”¶å™¨ç­‰ç­‰ã€‚å…·ä½“çš„æŒ‡ä»¤è¿˜çœŸè®°ä¸å¤ªæ¸…æ¥šã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šå—¯ï¼Œå¥½çš„ï¼Œä½ ä»¬å¹³æ—¶è°ƒè¯• JVMéƒ½ç”¨äº†å“ªäº›å·¥å…·å‘¢ï¼Ÿ</p><p><strong>å€™é€‰äºº:</strong></p><p>å—¯ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨jdkè‡ªå¸¦çš„ä¸€äº›å·¥å…·ï¼Œæ¯”å¦‚</p><p>jps è¾“å‡ºJVMä¸­è¿è¡Œçš„è¿›ç¨‹çŠ¶æ€ä¿¡æ¯</p><p>jstackæŸ¥çœ‹javaè¿›ç¨‹å†…<strong>çº¿ç¨‹çš„å †æ ˆ</strong>ä¿¡æ¯ã€‚</p><p>jmap ç”¨äºç”Ÿæˆå †è½¬å­˜å¿«ç…§</p><p>jstatç”¨äºJVMç»Ÿè®¡ç›‘æµ‹å·¥å…·</p><p>è¿˜æœ‰ä¸€äº›å¯è§†åŒ–å·¥å…·ï¼Œåƒjconsoleå’ŒVisualVMç­‰</p><p><strong>é¢è¯•å®˜</strong>ï¼šå‡å¦‚é¡¹ç›®ä¸­äº§ç”Ÿäº†javaå†…å­˜æ³„éœ²ï¼Œä½ è¯´ä¸€ä¸‹ä½ çš„æ’æŸ¥æ€è·¯ï¼Ÿ</p><p><strong>å€™é€‰äºº:</strong></p><p>å—¯ï¼Œè¿™ä¸ªæˆ‘åœ¨ä¹‹å‰é¡¹ç›®æ’æŸ¥è¿‡</p><p>ç¬¬ä¸€å‘¢å¯ä»¥é€šè¿‡jmapæŒ‡å®šæ‰“å°ä»–çš„å†…å­˜å¿«ç…§ dumpæ–‡ä»¶ï¼Œä¸è¿‡æœ‰çš„æƒ…å†µæ‰“å°ä¸äº†ï¼Œæˆ‘ä»¬ä¼šè®¾ç½®vmå‚æ•°è®©ç¨‹åºè‡ªåŠ¨ç”Ÿæˆdumpæ–‡ä»¶</p><p>ç¬¬äºŒï¼Œå¯ä»¥é€šè¿‡å·¥å…·å»åˆ†æ dumpæ–‡ä»¶ï¼Œjdkè‡ªå¸¦çš„VisualVMå°±å¯ä»¥åˆ†æ</p><p>ç¬¬ä¸‰ï¼Œé€šè¿‡æŸ¥çœ‹å †ä¿¡æ¯çš„æƒ…å†µï¼Œå¯ä»¥å¤§æ¦‚å®šä½å†…å­˜æº¢å‡ºæ˜¯å“ªè¡Œä»£ç å‡ºäº†é—®é¢˜</p><p>ç¬¬å››ï¼Œæ‰¾åˆ°å¯¹åº”çš„ä»£ç ï¼Œé€šè¿‡é˜…è¯»ä¸Šä¸‹æ–‡çš„æƒ…å†µï¼Œè¿›è¡Œä¿®å¤å³å¯</p><p><strong>é¢è¯•å®˜</strong>ï¼šå¥½çš„ï¼Œé‚£ç°åœ¨å†æ¥è¯´ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯è¯´æœåŠ¡å™¨CPUæŒç»­é£™é«˜ï¼Œä½ çš„æ’æŸ¥æ–¹æ¡ˆä¸æ€è·¯ï¼Ÿ</p><p><strong>å€™é€‰äºº:</strong></p><p>å—¯ï¼Œæˆ‘æ€è€ƒä¸€ä¸‹~~</p><p>å¯ä»¥è¿™ä¹ˆåš~~</p><p>ç¬¬ä¸€å¯ä»¥ä½¿ç”¨ä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹å ç”¨cpuçš„æƒ…å†µ</p><p>ç¬¬äºŒé€šè¿‡topå‘½ä»¤æŸ¥çœ‹åï¼Œå¯ä»¥æŸ¥çœ‹æ˜¯å“ªä¸€ä¸ªè¿›ç¨‹å ç”¨cpuè¾ƒé«˜ï¼Œè®°å½•è¿™ä¸ªè¿›ç¨‹id</p><p>ç¬¬ä¸‰å¯ä»¥é€šè¿‡ps æŸ¥çœ‹å½“å‰è¿›ç¨‹ä¸­çš„çº¿ç¨‹ä¿¡æ¯ï¼Œçœ‹çœ‹å“ªä¸ªçº¿ç¨‹çš„cpuå ç”¨è¾ƒé«˜</p><p>ç¬¬å››å¯ä»¥jstackå‘½ä»¤æ‰“å°è¿›è¡Œçš„idï¼Œæ‰¾åˆ°è¿™ä¸ªçº¿ç¨‹ï¼Œå°±å¯ä»¥è¿›ä¸€æ­¥å®šä½é—®é¢˜ä»£ç çš„è¡Œå·</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¿åˆ©å¨ç¬”è¯•</title>
      <link href="/2024/01/10/%E9%9D%A2%E7%BB%8F-%E4%BF%9D%E5%88%A9%E5%A8%81%E7%AC%94%E8%AF%95/"/>
      <url>/2024/01/10/%E9%9D%A2%E7%BB%8F-%E4%BF%9D%E5%88%A9%E5%A8%81%E7%AC%94%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p>æ€»ç»“ï¼š</p><p>ç¬¬ä¸€æ¬¡ç¬”è¯•ï¼ŒåŸºæœ¬éƒ½æ˜¯æŒ‰ç…§ç®€å†é—®çš„ï¼Œç¬¬ä¸€æ¬¡å°±è¸©å‘äº†Linuxå‘½ä»¤</p><h1 id="SQLé¢˜"><a href="#SQLé¢˜" class="headerlink" title="SQLé¢˜"></a>SQLé¢˜</h1><p>ä¸€å¼ è¡¨user_scoreï¼Œå­—æ®µä¸ºuser_id,æ—¥æœŸï¼Œå¾—åˆ†ï¼ŒæŒ‰ç…§æ¯ä¸ªå­£åº¦è¿›è¡Œå–æœ€é«˜è€…</p><p>è¾“å‡ºæ ·ä¾‹ä¸º2|2022-Q1|2022-01-02|90ï¼Œè¿™é‡Œçš„2æ˜¯user_id,2022-Q1ä»£è¡¨ç¬¬ä¸€å­£åº¦ï¼Œæ€»å…±æœ‰å››ä¸ªå­£åº¦ï¼Œ2022-01-02ä»£è¡¨å–å¾—æœ€é«˜åˆ†çš„æ—¥æœŸï¼Œ90ä»£è¡¨æœ€é«˜åˆ†ï¼›</p><p>å¦‚æœä¸€ä¸ªå­£åº¦æœ‰æœ€é«˜åˆ†çš„è¯å°±è¾“å‡ºå½“å‰çš„æœ€é«˜å¾—åˆ†çš„é‚£ä¸€æ¡è®°å½•ï¼Œæœ€å¤šè¾“å‡ºå››æ¡ã€‚</p><p>å†™å‡ºå¯¹åº”çš„SQLï¼Œå†™ä¸å‡ºæ¥</p><h1 id="æ‰“å®¶åŠ«èˆ"><a href="#æ‰“å®¶åŠ«èˆ" class="headerlink" title="æ‰“å®¶åŠ«èˆ"></a>æ‰“å®¶åŠ«èˆ</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">String</span> <span class="variable">next</span> <span class="operator">=</span> in.next();</span><br><span class="line">        String[] strings = next.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="comment">// ä»0åˆ°iæ‰€èƒ½æ”¶è·çš„æœ€å¤§å€¼ä¸ºdp[i]</span></span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[strings.length()];</span><br><span class="line">        dp[<span class="number">0</span>] = strings[<span class="number">0</span>];</span><br><span class="line">        dp[<span class="number">1</span>] = Math.max(strings[<span class="number">0</span>], strings[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt; strings.length(); i++) &#123;</span><br><span class="line">            dp[i] = Math.max(dp[i - <span class="number">2</span>] + strings[i], dp[i - <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(dp[dp.length - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è¡¥å……çš„Linuxå‘½ä»¤çŸ¥è¯†ç‚¹"><a href="#è¡¥å……çš„Linuxå‘½ä»¤çŸ¥è¯†ç‚¹" class="headerlink" title="è¡¥å……çš„Linuxå‘½ä»¤çŸ¥è¯†ç‚¹"></a>è¡¥å……çš„Linuxå‘½ä»¤çŸ¥è¯†ç‚¹</h1><h2 id="â€œ-â€-æ˜¯ä»€ä¹ˆæ„æ€"><a href="#â€œ-â€-æ˜¯ä»€ä¹ˆæ„æ€" class="headerlink" title="â€œ|â€ æ˜¯ä»€ä¹ˆæ„æ€"></a>â€œ|â€ æ˜¯ä»€ä¹ˆæ„æ€</h2><p>åœ¨Linuxæˆ–ç±»Unixç³»ç»Ÿçš„å‘½ä»¤è¡Œä¸­ï¼Œ<code>|</code>ï¼ˆç®¡é“ç¬¦å·ï¼‰ç”¨äºå°†ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä¼ é€’ç»™å¦ä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥ã€‚åœ¨ä½ æåˆ°çš„å‘½ä»¤ <code>ps -ef | grep java</code> ä¸­ï¼Œ<code>|</code> çš„ä½œç”¨æ˜¯å°† <code>ps -ef</code> å‘½ä»¤çš„è¾“å‡ºä¼ é€’ç»™ <code>grep java</code> å‘½ä»¤ï¼Œå®ç°äº†ä¸¤ä¸ªå‘½ä»¤ä¹‹é—´çš„æ•°æ®æµé€šã€‚</p><h2 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h2><p><a href="https://www.yiibai.com/linux/netstat.html">https://www.yiibai.com/linux/netstat.html</a></p><p>Linux netstatå‘½ä»¤ç”¨äºæ˜¾ç¤ºç½‘ç»œçŠ¶æ€ã€‚</p><p>åˆ©ç”¨netstatæŒ‡ä»¤å¯è®©ä½ å¾—çŸ¥æ•´ä¸ªLinuxç³»ç»Ÿçš„ç½‘ç»œæƒ…å†µã€‚</p><h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><p><a href="https://www.yiibai.com/linux/grep.html">https://www.yiibai.com/linux/grep.html</a></p><p>Linux grepå‘½ä»¤ç”¨äºæŸ¥æ‰¾æ–‡ä»¶é‡Œç¬¦åˆæ¡ä»¶çš„å­—ç¬¦ä¸²ã€‚</p><h2 id="top"><a href="#top" class="headerlink" title="top"></a>top</h2><p>æ˜¾ç¤ºå½“å‰ç³»ç»Ÿæ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿›ç¨‹ IDã€å†…å­˜å ç”¨ç‡ã€CPU å ç”¨ç‡ç­‰å¸¸ç”¨å‚æ•°</p><p><a href="https://www.yiibai.com/linux/top.html">https://www.yiibai.com/linux/top.html</a></p><h2 id="chmod"><a href="#chmod" class="headerlink" title="chmod"></a>chmod</h2><p>å­¦ä¹ è‡ª<a href="https://www.yiibai.com/linux/chmod.html">https://www.yiibai.com/linux/chmod.html</a></p><p><mark>ç”¨äºæ”¹å˜ linux ç³»ç»Ÿæ–‡ä»¶æˆ–ç›®å½•çš„è®¿é—®æƒé™ã€‚</mark>ç”¨å®ƒæ§åˆ¶æ–‡ä»¶æˆ–ç›®å½•çš„è®¿é—®æƒé™ã€‚è¯¥å‘½ä»¤æœ‰ä¸¤ç§ç”¨æ³•ã€‚ä¸€ç§æ˜¯åŒ…å«å­—æ¯å’Œæ“ä½œç¬¦è¡¨è¾¾å¼çš„æ–‡å­—è®¾å®šæ³•ï¼›å¦ä¸€ç§æ˜¯åŒ…å«æ•°å­—çš„æ•°å­—è®¾å®šæ³•ã€‚</p><p><code>r=4</code>ï¼Œ<code>w=2</code>ï¼Œ<code>x=1</code><br>è‹¥è¦<code>rwx</code>å±æ€§åˆ™<code>4+2+1=7</code><br>è‹¥è¦<code>rw-</code>å±æ€§åˆ™<code>4+2=6</code>ï¼›<br>è‹¥è¦<code>r-x</code>å±æ€§åˆ™<code>4+1=5</code>ã€‚</p><h3 id="å®ä¾‹1ï¼šå¢åŠ æ–‡ä»¶æ‰€æœ‰ç”¨æˆ·ç»„å¯æ‰§è¡Œæƒé™"><a href="#å®ä¾‹1ï¼šå¢åŠ æ–‡ä»¶æ‰€æœ‰ç”¨æˆ·ç»„å¯æ‰§è¡Œæƒé™" class="headerlink" title="å®ä¾‹1ï¼šå¢åŠ æ–‡ä»¶æ‰€æœ‰ç”¨æˆ·ç»„å¯æ‰§è¡Œæƒé™"></a>å®ä¾‹1ï¼šå¢åŠ æ–‡ä»¶æ‰€æœ‰ç”¨æˆ·ç»„å¯æ‰§è¡Œæƒé™</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod a+x run.py</span><br></pre></td></tr></table></figure><p>åœ¨ç»™å®šçš„<code>chmod a+x run.py</code>å‘½ä»¤ä¸­ï¼Œ<code>a+x</code>æ˜¯è¡¨ç¤ºæƒé™æ›´æ”¹çš„ä¸€ç§æ–¹å¼ã€‚è¿™æ˜¯Linuxå’Œç±»Unixç³»ç»Ÿä¸Šç”¨äºä¿®æ”¹æ–‡ä»¶æƒé™çš„å‘½ä»¤ã€‚</p><p>å…·ä½“è€Œè¨€ï¼Œ<code>a</code>ä»£è¡¨â€allâ€ï¼Œ<code>+x</code>è¡¨ç¤ºæ·»åŠ æ‰§è¡Œæƒé™ã€‚è¿™ä¸ªå‘½ä»¤çš„å«ä¹‰æ˜¯ç»™æ‰€æœ‰ç”¨æˆ·ï¼ˆæ‰€æœ‰è€…ã€ç»„å’Œå…¶ä»–ç”¨æˆ·ï¼‰æ·»åŠ æ‰§è¡Œæƒé™ï¼ˆxï¼‰ç»™æ–‡ä»¶<code>run.py</code>ã€‚</p><p>åœ¨<code>chmod</code>å‘½ä»¤ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„å­—æ¯å’Œç¬¦å·æ¥è¡¨ç¤ºæƒé™ï¼š</p><ul><li><code>u</code>è¡¨ç¤ºæ–‡ä»¶æ‰€æœ‰è€…ï¼ˆuserï¼‰ã€‚</li><li><code>g</code>è¡¨ç¤ºæ–‡ä»¶æ‰€å±ç»„ï¼ˆgroupï¼‰ã€‚</li><li><code>o</code>è¡¨ç¤ºå…¶ä»–ç”¨æˆ·ï¼ˆothersï¼‰ã€‚</li><li><code>a</code>è¡¨ç¤ºæ‰€æœ‰ç”¨æˆ·ï¼ˆallï¼‰ï¼Œå³åŒ…æ‹¬uã€gã€oã€‚</li></ul><p>æƒé™çš„ä¿®æ”¹æ“ä½œåŒ…æ‹¬ï¼š</p><ul><li><code>+</code>è¡¨ç¤ºæ·»åŠ æƒé™ã€‚</li><li><code>-</code>è¡¨ç¤ºåˆ é™¤æƒé™ã€‚</li><li><code>=</code>è¡¨ç¤ºè®¾ç½®æƒé™ã€‚</li></ul><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>a+x</code>è¡¨ç¤ºç»™æ‰€æœ‰ç”¨æˆ·æ·»åŠ æ‰§è¡Œæƒé™ã€‚è¿™æ˜¯ä¸€ç§å¿«æ·çš„æ–¹å¼ï¼Œç›¸å½“äºåŒæ—¶ç»™æ‰€æœ‰è€…ã€ç»„å’Œå…¶ä»–ç”¨æˆ·æ·»åŠ æ‰§è¡Œæƒé™ã€‚</p><h3 id="å®ä¾‹2ï¼šåŒæ—¶ä¿®æ”¹ä¸åŒç”¨æˆ·æƒé™"><a href="#å®ä¾‹2ï¼šåŒæ—¶ä¿®æ”¹ä¸åŒç”¨æˆ·æƒé™" class="headerlink" title="å®ä¾‹2ï¼šåŒæ—¶ä¿®æ”¹ä¸åŒç”¨æˆ·æƒé™"></a>å®ä¾‹2ï¼šåŒæ—¶ä¿®æ”¹ä¸åŒç”¨æˆ·æƒé™</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod ug+w,o-x run.py</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹3ï¼šåˆ é™¤æ–‡ä»¶æƒé™"><a href="#å®ä¾‹3ï¼šåˆ é™¤æ–‡ä»¶æƒé™" class="headerlink" title="å®ä¾‹3ï¼šåˆ é™¤æ–‡ä»¶æƒé™"></a>å®ä¾‹3ï¼šåˆ é™¤æ–‡ä»¶æƒé™</h3><p>å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod a-x run.py</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹4ï¼šä½¿ç”¨â€œ-â€è®¾ç½®æƒé™"><a href="#å®ä¾‹4ï¼šä½¿ç”¨â€œ-â€è®¾ç½®æƒé™" class="headerlink" title="å®ä¾‹4ï¼šä½¿ç”¨â€œ&#x3D;â€è®¾ç½®æƒé™"></a>å®ä¾‹4ï¼šä½¿ç”¨â€œ&#x3D;â€è®¾ç½®æƒé™</h3><p>å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod u=x run.py</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[yiibai@localhost bin]$ ll</span><br><span class="line">total 0</span><br><span class="line">--w-rw-rw-. 1 yiibai yiibai 0 Feb 17 02:01 run.py</span><br><span class="line">[yiibai@localhost bin]$</span><br><span class="line">[yiibai@localhost bin]$ chmod u=x run.py</span><br><span class="line">[yiibai@localhost bin]$ ll</span><br><span class="line">total 0</span><br><span class="line">---xrw-rw-. 1 yiibai yiibai 0 Feb 17 02:01 run.py</span><br><span class="line">[yiibai@localhost bin]$</span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼š<strong>æ’¤é”€åŸæ¥æ‰€æœ‰çš„æƒé™</strong>ï¼Œç„¶åä½¿æ‹¥æœ‰è€…å…·æœ‰å¯è¯»æƒé™</p></blockquote><h3 id="å®ä¾‹5ï¼šå¯¹ä¸€ä¸ªç›®å½•åŠå…¶å­ç›®å½•æ‰€æœ‰æ–‡ä»¶æ·»åŠ æƒé™"><a href="#å®ä¾‹5ï¼šå¯¹ä¸€ä¸ªç›®å½•åŠå…¶å­ç›®å½•æ‰€æœ‰æ–‡ä»¶æ·»åŠ æƒé™" class="headerlink" title="å®ä¾‹5ï¼šå¯¹ä¸€ä¸ªç›®å½•åŠå…¶å­ç›®å½•æ‰€æœ‰æ–‡ä»¶æ·»åŠ æƒé™"></a>å®ä¾‹5ï¼šå¯¹ä¸€ä¸ªç›®å½•åŠå…¶å­ç›®å½•æ‰€æœ‰æ–‡ä»¶æ·»åŠ æƒé™</h3><p>å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod -R u+x scripts/</span><br><span class="line">Shell</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[yiibai@localhost ~]$ ll scripts/</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 yiibai yiibai 0 Feb 17 02:11 run.exe</span><br><span class="line">-rw-rw-r--. 1 yiibai yiibai 0 Feb 17 02:11 run.pl</span><br><span class="line">-rw-rw-r--. 1 yiibai yiibai 0 Feb 17 02:10 run.py</span><br><span class="line">-rw-rw-r--. 1 yiibai yiibai 0 Feb 17 02:10 run.sh</span><br><span class="line">[yiibai@localhost ~]$ chmod -R u+x scripts/</span><br><span class="line">[yiibai@localhost ~]$ ll scripts/</span><br><span class="line">total 0</span><br><span class="line">-rwxrw-r--. 1 yiibai yiibai 0 Feb 17 02:11 run.exe</span><br><span class="line">-rwxrw-r--. 1 yiibai yiibai 0 Feb 17 02:11 run.pl</span><br><span class="line">-rwxrw-r--. 1 yiibai yiibai 0 Feb 17 02:10 run.py</span><br><span class="line">-rwxrw-r--. 1 yiibai yiibai 0 Feb 17 02:10 run.sh</span><br><span class="line">[yiibai@localhost ~]$</span><br><span class="line">Shell</span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼šé€’å½’åœ°ç»™test4ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•çš„å±ä¸»åˆ†é…æƒé™</p></blockquote><h2 id="find"><a href="#find" class="headerlink" title="find"></a>find</h2><p><a href="https://www.yiibai.com/linux/find.html">https://www.yiibai.com/linux/find.html</a></p><p>ç”¨äºåœ¨æŒ‡å®šç›®å½•ä¸‹æŸ¥æ‰¾æ–‡ä»¶ï¼Œå¹¶ä½œå‡ºç›¸åº”çš„å¤„ç†ã€‚</p><p>ä»»ä½•ä½äºå‚æ•°ä¹‹å‰çš„å­—ç¬¦ä¸²éƒ½å°†è¢«è§†ä¸ºæ¬²æŸ¥æ‰¾çš„ç›®å½•åã€‚å¦‚æœä½¿ç”¨è¯¥å‘½ä»¤æ—¶ï¼Œä¸è®¾ç½®ä»»ä½•å‚æ•°ï¼Œåˆ™findå‘½ä»¤å°†åœ¨å½“å‰ç›®å½•ä¸‹æŸ¥æ‰¾å­ç›®å½•ä¸æ–‡ä»¶ã€‚å¹¶ä¸”å°†æŸ¥æ‰¾åˆ°çš„å­ç›®å½•å’Œæ–‡ä»¶å…¨éƒ¨è¿›è¡Œæ˜¾ç¤ºã€‚</p><p>æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹çš„ä»¥.txtä¸ºç»“å°¾çš„æ–‡ä»¶çš„å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -<span class="built_in">type</span> f -name <span class="string">&quot;*.txt&quot;</span></span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹1ï¼šæŸ¥æ‰¾æŒ‡å®šæ—¶é—´å†…ä¿®æ”¹è¿‡çš„æ–‡ä»¶"><a href="#å®ä¾‹1ï¼šæŸ¥æ‰¾æŒ‡å®šæ—¶é—´å†…ä¿®æ”¹è¿‡çš„æ–‡ä»¶" class="headerlink" title="å®ä¾‹1ï¼šæŸ¥æ‰¾æŒ‡å®šæ—¶é—´å†…ä¿®æ”¹è¿‡çš„æ–‡ä»¶"></a>å®ä¾‹1ï¼šæŸ¥æ‰¾æŒ‡å®šæ—¶é—´å†…ä¿®æ”¹è¿‡çš„æ–‡ä»¶</h3><p>å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find -atime -2</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ¼”ç¤ºåŠè¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[yiibai@localhost ~]$ find -atime -2</span><br><span class="line">.</span><br><span class="line">./.bash_profile</span><br><span class="line">./.bashrc</span><br><span class="line">./test</span><br><span class="line">./test/log.log</span><br><span class="line">./test/is line 1.</span><br><span class="line">./test/t</span><br><span class="line">./test/t test]$ cat log.log</span><br><span class="line">./test/ping.log</span><br><span class="line">./mylog_link.log</span><br><span class="line">./.lesshst</span><br><span class="line">[yiibai@localhost ~]$</span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼šè¶…æ‰¾48å°æ—¶å†…ä¿®æ”¹è¿‡çš„æ–‡ä»¶ </p></blockquote><h3 id="å®ä¾‹2ï¼šæ ¹æ®å…³é”®å­—æŸ¥æ‰¾"><a href="#å®ä¾‹2ï¼šæ ¹æ®å…³é”®å­—æŸ¥æ‰¾" class="headerlink" title="å®ä¾‹2ï¼šæ ¹æ®å…³é”®å­—æŸ¥æ‰¾"></a>å®ä¾‹2ï¼šæ ¹æ®å…³é”®å­—æŸ¥æ‰¾</h3><p>å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -name &quot;*.log&quot;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ¼”ç¤ºåŠè¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[yiibai@localhost ~]$ find . -name &quot;*.log&quot;</span><br><span class="line">./test/mylog1.log</span><br><span class="line">./test/mylog2.log</span><br><span class="line">./test/log.log</span><br><span class="line">./test/t test]$ cat log.log</span><br><span class="line">./test/ping.log</span><br><span class="line">./test5/mylog.log</span><br><span class="line">./mylog.log</span><br><span class="line">./mylog_link.log</span><br><span class="line">[yiibai@localhost ~]$</span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼šåœ¨å½“å‰ç›®å½•æŸ¥æ‰¾ ä»¥.logç»“å°¾çš„æ–‡ä»¶ã€‚ â€œ. â€œä»£è¡¨å½“å‰ç›®å½• </p></blockquote><h3 id="å®ä¾‹3ï¼šæŒ‰ç…§ç›®å½•æˆ–æ–‡ä»¶çš„æƒé™æ¥æŸ¥æ‰¾æ–‡ä»¶"><a href="#å®ä¾‹3ï¼šæŒ‰ç…§ç›®å½•æˆ–æ–‡ä»¶çš„æƒé™æ¥æŸ¥æ‰¾æ–‡ä»¶" class="headerlink" title="å®ä¾‹3ï¼šæŒ‰ç…§ç›®å½•æˆ–æ–‡ä»¶çš„æƒé™æ¥æŸ¥æ‰¾æ–‡ä»¶"></a>å®ä¾‹3ï¼šæŒ‰ç…§ç›®å½•æˆ–æ–‡ä»¶çš„æƒé™æ¥æŸ¥æ‰¾æ–‡ä»¶</h3><p>å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /home/yiibai -perm 777</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ¼”ç¤ºåŠè¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[yiibai@localhost ~]$ find /home/yiibai -perm 777</span><br><span class="line">/home/yiibai/mylog_link.log</span><br><span class="line">[yiibai@localhost ~]$</span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼š æŸ¥æ‰¾&#x2F;opt&#x2F;soft&#x2F;test&#x2F;ç›®å½•ä¸‹ æƒé™ä¸º 777çš„æ–‡ä»¶</p></blockquote><h3 id="å®ä¾‹4ï¼šæŒ‰ç±»å‹æŸ¥æ‰¾"><a href="#å®ä¾‹4ï¼šæŒ‰ç±»å‹æŸ¥æ‰¾" class="headerlink" title="å®ä¾‹4ï¼šæŒ‰ç±»å‹æŸ¥æ‰¾"></a>å®ä¾‹4ï¼šæŒ‰ç±»å‹æŸ¥æ‰¾</h3><p>å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -type f -name &quot;*.log&quot;</span><br></pre></td></tr></table></figure><p>æ¼”ç¤ºæ‰§è¡ŒåŠè¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[yiibai@localhost ~]$ find . -type f -name &quot;*.log&quot;</span><br><span class="line">./test/mylog1.log</span><br><span class="line">./test/mylog2.log</span><br><span class="line">./test/log.log</span><br><span class="line">./test/t test]$ cat log.log</span><br><span class="line">./test/ping.log</span><br><span class="line">./test5/mylog.log</span><br><span class="line">./mylog.log</span><br><span class="line">[yiibai@localhost ~]$</span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼šæŸ¥æ‰¾å½“ç›®å½•ï¼Œä»¥.logç»“å°¾çš„æ™®é€šæ–‡ä»¶ </p></blockquote><h3 id="å®ä¾‹5ï¼šæŸ¥æ‰¾å½“å‰æ‰€æœ‰ç›®å½•å¹¶æ’åº"><a href="#å®ä¾‹5ï¼šæŸ¥æ‰¾å½“å‰æ‰€æœ‰ç›®å½•å¹¶æ’åº" class="headerlink" title="å®ä¾‹5ï¼šæŸ¥æ‰¾å½“å‰æ‰€æœ‰ç›®å½•å¹¶æ’åº"></a>å®ä¾‹5ï¼šæŸ¥æ‰¾å½“å‰æ‰€æœ‰ç›®å½•å¹¶æ’åº</h3><p>å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -type d | sort</span><br></pre></td></tr></table></figure><p>æ¼”ç¤ºæ‰§è¡ŒåŠè¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[yiibai@localhost ~]$ find . -type d | sort</span><br><span class="line">.</span><br><span class="line">./test</span><br><span class="line">./test1</span><br><span class="line">./test2</span><br><span class="line">./test3</span><br><span class="line">./test3/test4</span><br><span class="line">./test3/test4/test41</span><br><span class="line">./test5</span><br><span class="line">./test5/test3</span><br><span class="line">./test5/test3/test4</span><br><span class="line">./test5/test3/test4/test41</span><br><span class="line">./test-noexists</span><br><span class="line">./test-noexists/test4</span><br><span class="line">./test-noexists/test4/test41</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹6ï¼šæŒ‰å¤§å°æŸ¥æ‰¾æ–‡ä»¶"><a href="#å®ä¾‹6ï¼šæŒ‰å¤§å°æŸ¥æ‰¾æ–‡ä»¶" class="headerlink" title="å®ä¾‹6ï¼šæŒ‰å¤§å°æŸ¥æ‰¾æ–‡ä»¶"></a>å®ä¾‹6ï¼šæŒ‰å¤§å°æŸ¥æ‰¾æ–‡ä»¶</h3><p>å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -size +1000c -print</span><br></pre></td></tr></table></figure><p>æ¼”ç¤ºæ‰§è¡ŒåŠè¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[yiibai@localhost ~]$ find . -size +1000c -print</span><br><span class="line">./test/is line 1.</span><br><span class="line">./test/t</span><br><span class="line">./test/t test]$ cat log.log</span><br><span class="line">./test/ping.log</span><br><span class="line">[yiibai@localhost ~]$</span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼šæŸ¥æ‰¾å½“å‰ç›®å½•å¤§äº<code>1K</code>çš„æ–‡ä»¶</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> é¢ç» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linuxå‘½ä»¤ </tag>
            
            <tag> ç¬”è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLç›¸å…³é¢è¯•é¢˜</title>
      <link href="/2024/01/08/%E9%9D%A2%E8%AF%95-MySQL%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
      <url>/2024/01/08/%E9%9D%A2%E8%AF%95-MySQL%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æœ¬ç¯‡æ–‡ç« å–è‡ªé»‘é©¬ç¨‹åºå‘˜</p><h1 id="MySQLé¢è¯•é¢˜"><a href="#MySQLé¢è¯•é¢˜" class="headerlink" title="MySQLé¢è¯•é¢˜"></a>MySQLé¢è¯•é¢˜</h1><blockquote><p><strong>é¢è¯•å®˜ï¼š</strong>MySQLä¸­ï¼Œå¦‚ä½•å®šä½æ…¢æŸ¥è¯¢?</p><p><strong>å€™é€‰äººï¼š</strong></p><p>å—¯~ï¼Œæˆ‘ä»¬å½“æ—¶åšå‹æµ‹çš„æ—¶å€™æœ‰çš„æ¥å£éå¸¸çš„æ…¢ï¼Œæ¥å£çš„å“åº”æ—¶é—´è¶…è¿‡äº†2ç§’ä»¥ä¸Šï¼Œå› ä¸ºæˆ‘ä»¬å½“æ—¶çš„ç³»ç»Ÿéƒ¨ç½²äº†è¿ç»´çš„ç›‘æ§ç³»ç»ŸSkywalking ï¼Œåœ¨å±•ç¤ºçš„æŠ¥è¡¨ä¸­å¯ä»¥çœ‹åˆ°æ˜¯å“ªä¸€ä¸ªæ¥å£æ¯”è¾ƒæ…¢ï¼Œå¹¶ä¸”å¯ä»¥åˆ†æè¿™ä¸ªæ¥å£å“ªéƒ¨åˆ†æ¯”è¾ƒæ…¢ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°SQLçš„å…·ä½“çš„æ‰§è¡Œæ—¶é—´ï¼Œæ‰€ä»¥å¯ä»¥å®šä½æ˜¯å“ªä¸ªsqlå‡ºäº†é—®é¢˜</p><p>å¦‚æœï¼Œé¡¹ç›®ä¸­æ²¡æœ‰è¿™ç§è¿ç»´çš„ç›‘æ§ç³»ç»Ÿï¼Œå…¶å®åœ¨MySQLä¸­ä¹Ÿæä¾›äº†æ…¢æ—¥å¿—æŸ¥è¯¢çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨MySQLçš„ç³»ç»Ÿé…ç½®æ–‡ä»¶ä¸­å¼€å¯è¿™ä¸ªæ…¢æ—¥å¿—çš„åŠŸèƒ½ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥è®¾ç½®SQLæ‰§è¡Œè¶…è¿‡å¤šå°‘æ—¶é—´æ¥è®°å½•åˆ°ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæˆ‘è®°å¾—ä¸Šä¸€ä¸ªé¡¹ç›®é…ç½®çš„æ˜¯2ç§’ï¼Œåªè¦SQLæ‰§è¡Œçš„æ—¶é—´è¶…è¿‡äº†2ç§’å°±ä¼šè®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æ—¥å¿—æ–‡ä»¶æ‰¾åˆ°æ‰§è¡Œæ¯”è¾ƒæ…¢çš„SQLäº†ã€‚</p><p><strong>é¢è¯•å®˜ï¼š</strong>é‚£è¿™ä¸ªSQLè¯­å¥æ‰§è¡Œå¾ˆæ…¢, å¦‚ä½•åˆ†æå‘¢ï¼Ÿ</p><p><strong>å€™é€‰äººï¼š</strong>å¦‚æœä¸€æ¡sqlæ‰§è¡Œå¾ˆæ…¢çš„è¯ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨mysqlè‡ªåŠ¨çš„æ‰§è¡Œè®¡åˆ’explainæ¥å»æŸ¥çœ‹è¿™æ¡sqlçš„æ‰§è¡Œæƒ…å†µï¼Œæ¯”å¦‚åœ¨è¿™é‡Œé¢å¯ä»¥é€šè¿‡keyå’Œkey_lenæ£€æŸ¥æ˜¯å¦å‘½ä¸­äº†ç´¢å¼•ï¼Œå¦‚æœæœ¬èº«å·²ç»æ·»åŠ äº†ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥åˆ¤æ–­ç´¢å¼•æ˜¯å¦æœ‰å¤±æ•ˆçš„æƒ…å†µï¼Œç¬¬äºŒä¸ªï¼Œå¯ä»¥é€šè¿‡typeå­—æ®µæŸ¥çœ‹sqlæ˜¯å¦æœ‰è¿›ä¸€æ­¥çš„ä¼˜åŒ–ç©ºé—´ï¼Œæ˜¯å¦å­˜åœ¨å…¨ç´¢å¼•æ‰«ææˆ–å…¨ç›˜æ‰«æï¼Œç¬¬ä¸‰ä¸ªå¯ä»¥é€šè¿‡extraå»ºè®®æ¥åˆ¤æ–­ï¼Œæ˜¯å¦å‡ºç°äº†å›è¡¨çš„æƒ…å†µï¼Œå¦‚æœå‡ºç°äº†ï¼Œå¯ä»¥å°è¯•æ·»åŠ ç´¢å¼•æˆ–ä¿®æ”¹è¿”å›å­—æ®µæ¥ä¿®å¤</p><p><strong>é¢è¯•å®˜ï¼š</strong>äº†è§£è¿‡ç´¢å¼•å—ï¼Ÿï¼ˆä»€ä¹ˆæ˜¯ç´¢å¼•ï¼‰</p><p><strong>å€™é€‰äººï¼š</strong>å—¯ï¼Œç´¢å¼•åœ¨é¡¹ç›®ä¸­è¿˜æ˜¯æ¯”è¾ƒå¸¸è§çš„ï¼Œå®ƒæ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œä¸»è¦æ˜¯ç”¨æ¥æé«˜æ•°æ®æ£€ç´¢çš„æ•ˆç‡ï¼Œé™ä½æ•°æ®åº“çš„IOæˆæœ¬ï¼ŒåŒæ—¶é€šè¿‡ç´¢å¼•åˆ—å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œé™ä½æ•°æ®æ’åºçš„æˆæœ¬ï¼Œä¹Ÿèƒ½é™ä½äº†CPUçš„æ¶ˆè€—</p><p><strong>é¢è¯•å®˜ï¼š</strong>ç´¢å¼•çš„åº•å±‚æ•°æ®ç»“æ„äº†è§£è¿‡å˜› ? </p><p><strong>å€™é€‰äººï¼š</strong>MySQLçš„é»˜è®¤çš„å­˜å‚¨å¼•æ“InnoDBé‡‡ç”¨çš„B+æ ‘çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨ç´¢å¼•ï¼Œé€‰æ‹©B+æ ‘çš„ä¸»è¦çš„åŸå› æ˜¯ï¼šç¬¬ä¸€é˜¶æ•°æ›´å¤šï¼Œè·¯å¾„æ›´çŸ­ï¼Œç¬¬äºŒä¸ªç£ç›˜è¯»å†™ä»£ä»·B+æ ‘æ›´ä½ï¼Œéå¶å­èŠ‚ç‚¹åªå­˜å‚¨æŒ‡é’ˆï¼Œå¶å­é˜¶æ®µå­˜å‚¨æ•°æ®ï¼Œç¬¬ä¸‰æ˜¯B+æ ‘ä¾¿äºæ‰«åº“å’ŒåŒºé—´æŸ¥è¯¢ï¼Œå¶å­èŠ‚ç‚¹æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨</p><p><strong>é¢è¯•å®˜ï¼š</strong>Bæ ‘å’ŒB+æ ‘çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼šç¬¬ä¸€ï¼šåœ¨Bæ ‘ä¸­ï¼Œéå¶å­èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹éƒ½ä¼šå­˜æ”¾æ•°æ®ï¼Œè€ŒB+æ ‘çš„æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šå‡ºç°åœ¨å¶å­èŠ‚ç‚¹ï¼Œåœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼ŒB+æ ‘æŸ¥æ‰¾æ•ˆç‡æ›´åŠ ç¨³å®š</p><p>ç¬¬äºŒï¼šåœ¨è¿›è¡ŒèŒƒå›´æŸ¥è¯¢çš„æ—¶å€™ï¼ŒB+æ ‘æ•ˆç‡æ›´é«˜ï¼Œå› ä¸ºB+æ ‘éƒ½åœ¨å¶å­èŠ‚ç‚¹å­˜å‚¨ï¼Œå¹¶ä¸”å¶å­èŠ‚ç‚¹æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨</p><p><strong>é¢è¯•å®˜ï¼š</strong>ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•ä»€ä¹ˆæ˜¯éèšç°‡ç´¢å¼• ?</p><p><strong>å€™é€‰äººï¼š</strong></p><p>å¥½çš„~ï¼Œèšç°‡ç´¢å¼•ä¸»è¦æ˜¯æŒ‡æ•°æ®ä¸ç´¢å¼•æ”¾åˆ°ä¸€å—ï¼ŒB+æ ‘çš„å¶å­èŠ‚ç‚¹ä¿å­˜äº†æ•´è¡Œæ•°æ®ï¼Œæœ‰ä¸”åªæœ‰ä¸€ä¸ªï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸»é”®åœ¨ä½œä¸ºèšç°‡ç´¢å¼•çš„</p><p>éèšç°‡ç´¢å¼•å€¼çš„æ˜¯æ•°æ®ä¸ç´¢å¼•åˆ†å¼€å­˜å‚¨ï¼ŒB+æ ‘çš„å¶å­èŠ‚ç‚¹ä¿å­˜å¯¹åº”çš„ä¸»é”®ï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œä¸€èˆ¬æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç´¢å¼•éƒ½æ˜¯éèšç°‡ç´¢å¼•</p><p><strong>é¢è¯•å®˜ï¼š</strong>çŸ¥é“ä»€ä¹ˆæ˜¯å›è¡¨æŸ¥è¯¢å˜› ?</p><p><strong>å€™é€‰äººï¼š</strong>å—¯ï¼Œå…¶å®è·Ÿåˆšæ‰ä»‹ç»çš„èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•æ˜¯æœ‰å…³ç³»çš„ï¼Œå›è¡¨çš„æ„æ€å°±æ˜¯é€šè¿‡äºŒçº§ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„ä¸»é”®å€¼ï¼Œç„¶åå†é€šè¿‡ä¸»é”®å€¼æ‰¾åˆ°èšé›†ç´¢å¼•ä¸­æ‰€å¯¹åº”çš„æ•´è¡Œæ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å›è¡¨</p><p>ã€<strong>å¤‡æ³¨</strong>ï¼šå¦‚æœé¢è¯•å®˜ç›´æ¥é—®å›è¡¨ï¼Œåˆ™éœ€è¦å…ˆä»‹ç»èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ã€‘</p><p><strong>é¢è¯•å®˜ï¼š</strong>çŸ¥é“ä»€ä¹ˆå«è¦†ç›–ç´¢å¼•å˜› ? </p><p><strong>å€™é€‰äººï¼š</strong>å—¯~ï¼Œæ¸…æ¥šçš„</p><p>è¦†ç›–ç´¢å¼•æ˜¯æŒ‡selectæŸ¥è¯¢è¯­å¥ä½¿ç”¨äº†ç´¢å¼•ï¼Œåœ¨è¿”å›çš„åˆ—ï¼Œå¿…é¡»åœ¨ç´¢å¼•ä¸­å…¨éƒ¨èƒ½å¤Ÿæ‰¾åˆ°ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨idæŸ¥è¯¢ï¼Œå®ƒä¼šç›´æ¥èµ°èšé›†ç´¢å¼•æŸ¥è¯¢ï¼Œä¸€æ¬¡ç´¢å¼•æ‰«æï¼Œç›´æ¥è¿”å›æ•°æ®ï¼Œæ€§èƒ½é«˜ã€‚</p><p>å¦‚æœæŒ‰ç…§äºŒçº§ç´¢å¼•æŸ¥è¯¢æ•°æ®çš„æ—¶å€™ï¼Œè¿”å›çš„åˆ—ä¸­æ²¡æœ‰åˆ›å»ºç´¢å¼•ï¼Œæœ‰å¯èƒ½ä¼šè§¦å‘å›è¡¨æŸ¥è¯¢ï¼Œå°½é‡é¿å…ä½¿ç”¨select *ï¼Œå°½é‡åœ¨è¿”å›çš„åˆ—ä¸­éƒ½åŒ…å«æ·»åŠ ç´¢å¼•çš„å­—æ®µ</p><p><strong>é¢è¯•å®˜ï¼š</strong>MYSQLè¶…å¤§åˆ†é¡µæ€ä¹ˆå¤„ç† ?</p><p><strong>å€™é€‰äººï¼š</strong>å—¯ï¼Œè¶…å¤§åˆ†é¡µä¸€èˆ¬éƒ½æ˜¯åœ¨æ•°æ®é‡æ¯”è¾ƒå¤§æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†limitåˆ†é¡µæŸ¥è¯¢ï¼Œå¹¶ä¸”éœ€è¦å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œè¿™ä¸ªæ—¶å€™æ•ˆç‡å°±å¾ˆä½ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨è¦†ç›–ç´¢å¼•å’Œå­æŸ¥è¯¢æ¥è§£å†³</p><p>å…ˆåˆ†é¡µæŸ¥è¯¢æ•°æ®çš„idå­—æ®µï¼Œç¡®å®šäº†idä¹‹åï¼Œå†ç”¨å­æŸ¥è¯¢æ¥è¿‡æ»¤ï¼ŒåªæŸ¥è¯¢è¿™ä¸ªidåˆ—è¡¨ä¸­çš„æ•°æ®å°±å¯ä»¥äº†</p><p>å› ä¸ºæŸ¥è¯¢idçš„æ—¶å€™ï¼Œèµ°çš„è¦†ç›–ç´¢å¼•ï¼Œæ‰€ä»¥æ•ˆç‡å¯ä»¥æå‡å¾ˆå¤š</p><p><strong>é¢è¯•å®˜ï¼š</strong>ç´¢å¼•åˆ›å»ºåŸåˆ™æœ‰å“ªäº›ï¼Ÿ</p><p><strong>å€™é€‰äººï¼š</strong>å—¯ï¼Œè¿™ä¸ªæƒ…å†µæœ‰å¾ˆå¤šï¼Œä¸è¿‡éƒ½æœ‰ä¸€ä¸ªå¤§å‰æï¼Œå°±æ˜¯è¡¨ä¸­çš„æ•°æ®è¦è¶…è¿‡10ä¸‡ä»¥ä¸Šï¼Œæˆ‘ä»¬æ‰ä¼šåˆ›å»ºç´¢å¼•ï¼Œå¹¶ä¸”æ·»åŠ ç´¢å¼•çš„å­—æ®µæ˜¯æŸ¥è¯¢æ¯”è¾ƒé¢‘ç¹çš„å­—æ®µï¼Œä¸€èˆ¬ä¹Ÿæ˜¯åƒä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼Œæ’åºå­—æ®µæˆ–åˆ†ç»„çš„å­—æ®µè¿™äº›ã€‚</p><p>è¿˜æœ‰å°±æ˜¯ï¼Œæˆ‘ä»¬é€šå¸¸åˆ›å»ºç´¢å¼•çš„æ—¶å€™éƒ½æ˜¯ä½¿ç”¨å¤åˆç´¢å¼•æ¥åˆ›å»ºï¼Œä¸€æ¡sqlçš„è¿”å›å€¼ï¼Œå°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå¦‚æœå­—æ®µçš„åŒºåˆ†åº¦ä¸é«˜çš„è¯ï¼Œæˆ‘ä»¬ä¹Ÿä¼šæŠŠå®ƒæ”¾åœ¨ç»„åˆç´¢å¼•åé¢çš„å­—æ®µã€‚</p><p>å¦‚æœæŸä¸€ä¸ªå­—æ®µçš„å†…å®¹è¾ƒé•¿ï¼Œæˆ‘ä»¬ä¼šè€ƒè™‘ä½¿ç”¨å‰ç¼€ç´¢å¼•æ¥ä½¿ç”¨ï¼Œå½“ç„¶å¹¶ä¸æ˜¯æ‰€æœ‰çš„å­—æ®µéƒ½è¦æ·»åŠ ç´¢å¼•ï¼Œè¿™ä¸ªç´¢å¼•çš„æ•°é‡ä¹Ÿè¦æ§åˆ¶ï¼Œå› ä¸ºæ·»åŠ ç´¢å¼•ä¹Ÿä¼šå¯¼è‡´æ–°å¢æ”¹çš„é€Ÿåº¦å˜æ…¢ã€‚</p><p><strong>é¢è¯•å®˜ï¼š</strong>ä»€ä¹ˆæƒ…å†µä¸‹ç´¢å¼•ä¼šå¤±æ•ˆ ?</p><p><strong>å€™é€‰äººï¼š</strong>å—¯ï¼Œè¿™ä¸ªæƒ…å†µæ¯”è¾ƒå¤šï¼Œæˆ‘è¯´ä¸€äº›è‡ªå·±çš„ç»éªŒï¼Œä»¥å‰é‡åˆ°è¿‡çš„</p><p>æ¯”å¦‚ï¼Œç´¢å¼•åœ¨ä½¿ç”¨çš„æ—¶å€™æ²¡æœ‰éµå¾ªæœ€å·¦åŒ¹é…æ³•åˆ™ï¼Œç¬¬äºŒä¸ªæ˜¯ï¼Œæ¨¡ç³ŠæŸ¥è¯¢ï¼Œå¦‚æœ%å·åœ¨å‰é¢ä¹Ÿä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚å¦‚æœåœ¨æ·»åŠ ç´¢å¼•çš„å­—æ®µä¸Šè¿›è¡Œäº†è¿ç®—æ“ä½œæˆ–è€…ç±»å‹è½¬æ¢ä¹Ÿéƒ½ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</p><p>æˆ‘ä»¬ä¹‹å‰è¿˜é‡åˆ°è¿‡ä¸€ä¸ªå°±æ˜¯ï¼Œå¦‚æœä½¿ç”¨äº†å¤åˆç´¢å¼•ï¼Œä¸­é—´ä½¿ç”¨äº†èŒƒå›´æŸ¥è¯¢ï¼Œå³è¾¹çš„æ¡ä»¶ç´¢å¼•ä¹Ÿä¼šå¤±æ•ˆ</p><p>æ‰€ä»¥ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæƒ³è¦åˆ¤æ–­å‡ºè¿™æ¡sqlæ˜¯å¦æœ‰ç´¢å¼•å¤±æ•ˆçš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨explainæ‰§è¡Œè®¡åˆ’æ¥åˆ†æ</p><p><strong>é¢è¯•å®˜ï¼š</strong>sqlçš„ä¼˜åŒ–çš„ç»éªŒ</p><p><strong>å€™é€‰äººï¼š</strong>å—¯ï¼Œè¿™ä¸ªåœ¨é¡¹ç›®è¿˜æ˜¯æŒºå¸¸è§çš„ï¼Œå½“ç„¶å¦‚æœç›´è¯´sqlä¼˜åŒ–çš„è¯ï¼Œæˆ‘ä»¬ä¼šä»è¿™å‡ æ–¹é¢è€ƒè™‘ï¼Œæ¯”å¦‚</p><p>å»ºè¡¨çš„æ—¶å€™ã€ä½¿ç”¨ç´¢å¼•ã€sqlè¯­å¥çš„ç¼–å†™ã€ä¸»ä»å¤åˆ¶ï¼Œè¯»å†™åˆ†ç¦»ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯å¦‚æœé‡æ¯”è¾ƒå¤§çš„è¯ï¼Œå¯ä»¥è€ƒè™‘åˆ†åº“åˆ†è¡¨</p><p><strong>é¢è¯•å®˜ï¼š</strong>åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œä½ ä»¬æ˜¯å¦‚ä½•ä¼˜åŒ–çš„å‘¢ï¼Ÿ</p><p><strong>å€™é€‰äººï¼š</strong>è¿™ä¸ªæˆ‘ä»¬ä¸»è¦å‚è€ƒçš„é˜¿é‡Œå‡ºçš„é‚£ä¸ªå¼€å‘æ‰‹å†Œã€Šåµ©å±±ç‰ˆã€‹ï¼Œå°±æ¯”å¦‚ï¼Œåœ¨å®šä¹‰å­—æ®µçš„æ—¶å€™éœ€è¦ç»“åˆå­—æ®µçš„å†…å®¹æ¥é€‰æ‹©åˆé€‚çš„ç±»å‹ï¼Œå¦‚æœæ˜¯æ•°å€¼çš„è¯ï¼Œåƒtinyintã€int ã€bigintè¿™äº›ç±»å‹ï¼Œè¦æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ã€‚å¦‚æœæ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä¹Ÿæ˜¯ç»“åˆå­˜å‚¨çš„å†…å®¹æ¥é€‰æ‹©charå’Œvarcharæˆ–è€…textç±»å‹</p><p><strong>é¢è¯•å®˜ï¼š</strong>é‚£åœ¨ä½¿ç”¨ç´¢å¼•çš„æ—¶å€™ï¼Œæ˜¯å¦‚ä½•ä¼˜åŒ–å‘¢ï¼Ÿ</p><p><strong>å€™é€‰äººï¼š</strong>ã€å‚è€ƒç´¢å¼•åˆ›å»ºåŸåˆ™    è¿›è¡Œæè¿°ã€‘</p><p><strong>é¢è¯•å®˜ï¼š</strong>ä½ å¹³æ—¶å¯¹sqlè¯­å¥åšäº†å“ªäº›ä¼˜åŒ–å‘¢ï¼Ÿ</p><p><strong>å€™é€‰äººï¼š</strong>å—¯ï¼Œè¿™ä¸ªä¹Ÿæœ‰å¾ˆå¤šï¼Œæ¯”å¦‚SELECTè¯­å¥åŠ¡å¿…æŒ‡æ˜å­—æ®µåç§°ï¼Œä¸è¦ç›´æ¥ä½¿ç”¨select * ï¼Œè¿˜æœ‰å°±æ˜¯è¦æ³¨æ„SQLè¯­å¥é¿å…é€ æˆç´¢å¼•å¤±æ•ˆçš„å†™æ³•ï¼›å¦‚æœæ˜¯èšåˆæŸ¥è¯¢ï¼Œå°½é‡ç”¨union allä»£æ›¿union ï¼Œunionä¼šå¤šä¸€æ¬¡è¿‡æ»¤ï¼Œæ•ˆç‡æ¯”è¾ƒä½ï¼›å¦‚æœæ˜¯è¡¨å…³è”çš„è¯ï¼Œå°½é‡ä½¿ç”¨innerjoin ï¼Œä¸è¦ä½¿ç”¨ç”¨left join right joinï¼Œå¦‚å¿…é¡»ä½¿ç”¨ ä¸€å®šè¦ä»¥å°è¡¨ä¸ºé©±åŠ¨</p><p><strong>é¢è¯•å®˜ï¼š</strong>äº‹åŠ¡çš„ç‰¹æ€§æ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥è¯¦ç»†è¯´ä¸€ä¸‹å—ï¼Ÿ</p><p><strong>å€™é€‰äººï¼š</strong>å—¯ï¼Œè¿™ä¸ªæ¯”è¾ƒæ¸…æ¥šï¼ŒACIDï¼Œåˆ†åˆ«æŒ‡çš„æ˜¯ï¼šåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ï¼›æˆ‘ä¸¾ä¸ªä¾‹å­ï¼š</p><p>Aå‘Bè½¬è´¦500ï¼Œè½¬è´¦æˆåŠŸï¼ŒAæ‰£é™¤500å…ƒï¼ŒBå¢åŠ 500å…ƒï¼ŒåŸå­æ“ä½œä½“ç°åœ¨è¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥</p><p>åœ¨è½¬è´¦çš„è¿‡ç¨‹ä¸­ï¼Œæ•°æ®è¦ä¸€è‡´ï¼ŒAæ‰£é™¤äº†500ï¼ŒBå¿…é¡»å¢åŠ 500</p><p>åœ¨è½¬è´¦çš„è¿‡ç¨‹ä¸­ï¼Œéš”ç¦»æ€§ä½“ç°åœ¨AåƒBè½¬è´¦ï¼Œä¸èƒ½å—å…¶ä»–äº‹åŠ¡å¹²æ‰°</p><p>åœ¨è½¬è´¦çš„è¿‡ç¨‹ä¸­ï¼ŒæŒä¹…æ€§ä½“ç°åœ¨äº‹åŠ¡æäº¤åï¼Œè¦æŠŠæ•°æ®æŒä¹…åŒ–ï¼ˆå¯ä»¥è¯´æ˜¯è½ç›˜æ“ä½œï¼‰</p><p><strong>é¢è¯•å®˜</strong>ï¼šå¹¶å‘äº‹åŠ¡å¸¦æ¥å“ªäº›é—®é¢˜ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>æˆ‘ä»¬åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶å‘è¿›è¡Œæ˜¯ç»å¸¸å‘ç”Ÿçš„ï¼Œå¹¶å‘ä¹Ÿæ˜¯å¿…ç„¶çš„ï¼Œæœ‰å¯èƒ½å¯¼è‡´ä¸€äº›é—®é¢˜</p><p>ç¬¬ä¸€æ˜¯è„è¯»ï¼Œ å½“ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨è®¿é—®æ•°æ®å¹¶ä¸”å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œè€Œè¿™ç§ä¿®æ”¹è¿˜æ²¡æœ‰æäº¤åˆ°æ•°æ®åº“ä¸­ï¼Œè¿™æ—¶å¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®äº†è¿™ä¸ªæ•°æ®ï¼Œå› ä¸ºè¿™ä¸ªæ•°æ®æ˜¯è¿˜æ²¡æœ‰æäº¤çš„æ•°æ®ï¼Œé‚£ä¹ˆå¦å¤–ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°çš„è¿™ä¸ªæ•°æ®æ˜¯â€œè„æ•°æ®â€ï¼Œä¾æ®â€œè„æ•°æ®â€æ‰€åšçš„æ“ä½œå¯èƒ½æ˜¯ä¸æ­£ç¡®çš„ã€‚</p><p>ç¬¬äºŒæ˜¯ä¸å¯é‡å¤è¯»ï¼šæ¯”å¦‚åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡è¯»åŒä¸€æ•°æ®ã€‚åœ¨è¿™ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰ç»“æŸæ—¶ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®è¯¥æ•°æ®ã€‚é‚£ä¹ˆï¼Œåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­çš„ä¸¤æ¬¡è¯»æ•°æ®ä¹‹é—´ï¼Œç”±äºç¬¬äºŒä¸ªäº‹åŠ¡çš„ä¿®æ”¹å¯¼è‡´ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»å–çš„æ•°æ®å¯èƒ½ä¸å¤ªä¸€æ ·ã€‚è¿™å°±å‘ç”Ÿäº†åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®æ˜¯ä¸ä¸€æ ·çš„æƒ…å†µï¼Œå› æ­¤ç§°ä¸ºä¸å¯é‡å¤è¯»ã€‚</p><p>ç¬¬ä¸‰æ˜¯å¹»è¯»ï¼ˆPhantom readï¼‰ï¼šå¹»è¯»ä¸ä¸å¯é‡å¤è¯»ç±»ä¼¼ã€‚å®ƒå‘ç”Ÿåœ¨ä¸€ä¸ªäº‹åŠ¡ï¼ˆT1ï¼‰è¯»å–äº†å‡ è¡Œæ•°æ®ï¼Œæ¥ç€å¦ä¸€ä¸ªå¹¶å‘äº‹åŠ¡ï¼ˆT2ï¼‰æ’å…¥äº†ä¸€äº›æ•°æ®æ—¶ã€‚åœ¨éšåçš„æŸ¥è¯¢ä¸­ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡ï¼ˆT1ï¼‰å°±ä¼šå‘ç°å¤šäº†ä¸€äº›åŸæœ¬ä¸å­˜åœ¨çš„è®°å½•ï¼Œå°±å¥½åƒå‘ç”Ÿäº†å¹»è§‰ä¸€æ ·ï¼Œæ‰€ä»¥ç§°ä¸ºå¹»è¯»ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šæ€ä¹ˆè§£å†³è¿™äº›é—®é¢˜å‘¢ï¼ŸMySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼šè§£å†³æ–¹æ¡ˆæ˜¯å¯¹äº‹åŠ¡è¿›è¡Œéš”ç¦»</p><p>MySQLæ”¯æŒå››ç§éš”ç¦»çº§åˆ«ï¼Œåˆ†åˆ«æœ‰ï¼š</p><p>ç¬¬ä¸€ä¸ªæ˜¯ï¼Œæœªæäº¤è¯»ï¼ˆread uncommittedï¼‰å®ƒè§£å†³ä¸äº†åˆšæ‰æå‡ºçš„æ‰€æœ‰é—®é¢˜ï¼Œä¸€èˆ¬é¡¹ç›®ä¸­ä¹Ÿä¸ç”¨è¿™ä¸ªã€‚ç¬¬äºŒä¸ªæ˜¯è¯»å·²æäº¤ï¼ˆread committedï¼‰å®ƒèƒ½è§£å†³è„è¯»çš„é—®é¢˜çš„ï¼Œä½†æ˜¯è§£å†³ä¸äº†ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚ç¬¬ä¸‰ä¸ªæ˜¯å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å®ƒèƒ½è§£å†³è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†æ˜¯è§£å†³ä¸äº†å¹»è¯»ï¼Œè¿™ä¸ªä¹Ÿæ˜¯mysqlé»˜è®¤çš„éš”ç¦»çº§åˆ«ã€‚ç¬¬å››ä¸ªæ˜¯ä¸²è¡ŒåŒ–ï¼ˆserializableï¼‰å®ƒå¯ä»¥è§£å†³åˆšæ‰æå‡ºæ¥çš„æ‰€æœ‰é—®é¢˜ï¼Œä½†æ˜¯ç”±äºè®©æ˜¯äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œçš„ï¼Œæ€§èƒ½æ¯”è¾ƒä½ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨çš„éƒ½æ˜¯mysqlé»˜è®¤çš„éš”ç¦»çº§åˆ«:å¯é‡å¤è¯»</p><p><strong>é¢è¯•å®˜</strong>ï¼šundo logå’Œredo logçš„åŒºåˆ«</p><p><strong>å€™é€‰äºº</strong>ï¼šå¥½çš„ï¼Œå…¶ä¸­redo logæ—¥å¿—è®°å½•çš„æ˜¯æ•°æ®é¡µçš„ç‰©ç†å˜åŒ–ï¼ŒæœåŠ¡å®•æœºå¯ç”¨æ¥åŒæ­¥æ•°æ®ï¼Œè€Œundo log ä¸åŒï¼Œå®ƒä¸»è¦è®°å½•çš„æ˜¯é€»è¾‘æ—¥å¿—ï¼Œå½“äº‹åŠ¡å›æ»šæ—¶ï¼Œé€šè¿‡é€†æ“ä½œæ¢å¤åŸæ¥çš„æ•°æ®ï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ é™¤ä¸€æ¡æ•°æ®çš„æ—¶å€™ï¼Œå°±ä¼šåœ¨undo logæ—¥å¿—æ–‡ä»¶ä¸­æ–°å¢ä¸€æ¡deleteè¯­å¥ï¼Œå¦‚æœå‘ç”Ÿå›æ»šå°±æ‰§è¡Œé€†æ“ä½œï¼›</p><p>redo logä¿è¯äº†äº‹åŠ¡çš„æŒä¹…æ€§ï¼Œundo logä¿è¯äº†äº‹åŠ¡çš„åŸå­æ€§å’Œä¸€è‡´æ€§</p><p><strong>é¢è¯•å®˜</strong>ï¼šäº‹åŠ¡ä¸­çš„éš”ç¦»æ€§æ˜¯å¦‚ä½•ä¿è¯çš„å‘¢ï¼Ÿ(ä½ è§£é‡Šä¸€ä¸‹MVCC)</p><p><strong>å€™é€‰äºº</strong>ï¼šäº‹åŠ¡çš„éš”ç¦»æ€§æ˜¯ç”±é”å’Œmvccå®ç°çš„ã€‚</p><p>å…¶ä¸­mvccçš„æ„æ€æ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚æŒ‡ç»´æŠ¤ä¸€ä¸ªæ•°æ®çš„å¤šä¸ªç‰ˆæœ¬ï¼Œä½¿å¾—è¯»å†™æ“ä½œæ²¡æœ‰å†²çªï¼Œå®ƒçš„åº•å±‚å®ç°ä¸»è¦æ˜¯åˆ†ä¸ºäº†ä¸‰ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€ä¸ªæ˜¯éšè—å­—æ®µï¼Œç¬¬äºŒä¸ªæ˜¯undo logæ—¥å¿—ï¼Œç¬¬ä¸‰ä¸ªæ˜¯readViewè¯»è§†å›¾</p><p>éšè—å­—æ®µæ˜¯æŒ‡ï¼šåœ¨mysqlä¸­ç»™æ¯ä¸ªè¡¨éƒ½è®¾ç½®äº†éšè—å­—æ®µï¼Œæœ‰ä¸€ä¸ªæ˜¯trx_id(äº‹åŠ¡id)ï¼Œè®°å½•æ¯ä¸€æ¬¡æ“ä½œçš„äº‹åŠ¡idï¼Œæ˜¯è‡ªå¢çš„ï¼›å¦ä¸€ä¸ªå­—æ®µæ˜¯roll_pointer(å›æ»šæŒ‡é’ˆ)ï¼ŒæŒ‡å‘ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„äº‹åŠ¡ç‰ˆæœ¬è®°å½•åœ°å€</p><p>undo logä¸»è¦çš„ä½œç”¨æ˜¯è®°å½•å›æ»šæ—¥å¿—ï¼Œå­˜å‚¨è€ç‰ˆæœ¬æ•°æ®ï¼Œåœ¨å†…éƒ¨ä¼šå½¢æˆä¸€ä¸ªç‰ˆæœ¬é“¾ï¼Œåœ¨å¤šä¸ªäº‹åŠ¡å¹¶è¡Œæ“ä½œæŸä¸€è¡Œè®°å½•ï¼Œè®°å½•ä¸åŒäº‹åŠ¡ä¿®æ”¹æ•°æ®çš„ç‰ˆæœ¬ï¼Œé€šè¿‡roll_pointeræŒ‡é’ˆå½¢æˆä¸€ä¸ªé“¾è¡¨</p><p>readViewè§£å†³çš„æ˜¯ä¸€ä¸ªäº‹åŠ¡æŸ¥è¯¢é€‰æ‹©ç‰ˆæœ¬çš„é—®é¢˜ï¼Œåœ¨å†…éƒ¨å®šä¹‰äº†ä¸€äº›åŒ¹é…è§„åˆ™å’Œå½“å‰çš„ä¸€äº›äº‹åŠ¡idåˆ¤æ–­è¯¥è®¿é—®é‚£ä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œä¸åŒçš„éš”ç¦»çº§åˆ«å¿«ç…§è¯»æ˜¯ä¸ä¸€æ ·çš„ï¼Œæœ€ç»ˆçš„è®¿é—®çš„ç»“æœä¸ä¸€æ ·ã€‚å¦‚æœæ˜¯rcéš”ç¦»çº§åˆ«ï¼Œæ¯ä¸€æ¬¡æ‰§è¡Œå¿«ç…§è¯»æ—¶ç”ŸæˆReadViewï¼Œå¦‚æœæ˜¯rréš”ç¦»çº§åˆ«ä»…åœ¨äº‹åŠ¡ä¸­ç¬¬ä¸€æ¬¡æ‰§è¡Œå¿«ç…§è¯»æ—¶ç”ŸæˆReadViewï¼Œåç»­å¤ç”¨</p><p><strong>é¢è¯•å®˜</strong>ï¼šMySQLä¸»ä»åŒæ­¥åŸç† </p><p><strong>å€™é€‰äºº</strong>ï¼šMySQLä¸»ä»å¤åˆ¶çš„æ ¸å¿ƒå°±æ˜¯äºŒè¿›åˆ¶æ—¥å¿—(DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰è¯­å¥å’Œ DMLï¼ˆæ•°æ®æ“çºµè¯­è¨€ï¼‰è¯­å¥)ï¼Œå®ƒçš„æ­¥éª¤æ˜¯è¿™æ ·çš„ï¼š</p><p>ç¬¬ä¸€ï¼šä¸»åº“åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œä¼šæŠŠæ•°æ®å˜æ›´è®°å½•åœ¨äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ Binlog ä¸­ã€‚</p><p>ç¬¬äºŒï¼šä»åº“è¯»å–ä¸»åº“çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ Binlog ï¼Œå†™å…¥åˆ°ä»åº“çš„ä¸­ç»§æ—¥å¿— Relay Log ã€‚</p><p>ç¬¬ä¸‰ï¼šä»åº“é‡åšä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†æ”¹å˜åæ˜ å®ƒè‡ªå·±çš„æ•°æ®</p><p><strong>é¢è¯•å®˜</strong>ï¼šä½ ä»¬é¡¹ç›®ç”¨è¿‡MySQLçš„åˆ†åº“åˆ†è¡¨å—ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼Œå› ä¸ºæˆ‘ä»¬éƒ½æ˜¯å¾®æœåŠ¡å¼€å‘ï¼Œæ¯ä¸ªå¾®æœåŠ¡å¯¹åº”äº†ä¸€ä¸ªæ•°æ®åº“ï¼Œæ˜¯æ ¹æ®ä¸šåŠ¡è¿›è¡Œæ‹†åˆ†çš„ï¼Œè¿™ä¸ªå…¶å®å°±æ˜¯å‚ç›´æ‹†åˆ†ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šé‚£ä½ ä¹‹å‰ä½¿ç”¨è¿‡æ°´å¹³åˆ†åº“å—ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼Œè¿™ä¸ªæ˜¯ä½¿ç”¨è¿‡çš„ï¼Œæˆ‘ä»¬å½“æ—¶çš„ä¸šåŠ¡æ˜¯(xxx)ï¼Œä¸€å¼€å§‹ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯å•åº“ï¼Œåæ¥è¿™ä¸ªä¸šåŠ¡é€æ¸å‘å±•ï¼Œä¸šåŠ¡é‡ä¸Šæ¥çš„å¾ˆè¿…é€Ÿï¼Œå…¶ä¸­(xx)è¡¨å·²ç»å­˜æ”¾äº†è¶…è¿‡1000ä¸‡çš„æ•°æ®ï¼Œæˆ‘ä»¬åšäº†å¾ˆå¤šä¼˜åŒ–ä¹Ÿä¸å¥½ä½¿ï¼Œæ€§èƒ½ä¾ç„¶å¾ˆæ…¢ï¼Œæ‰€ä»¥å½“æ—¶å°±ä½¿ç”¨äº†æ°´å¹³åˆ†åº“ã€‚</p><p>æˆ‘ä»¬ä¸€å¼€å§‹å…ˆåšäº†3å°æœåŠ¡å™¨å¯¹åº”äº†3ä¸ªæ•°æ®åº“ï¼Œç”±äºåº“å¤šäº†ï¼Œéœ€è¦åˆ†ç‰‡ï¼Œæˆ‘ä»¬å½“æ—¶é‡‡ç”¨çš„mycatæ¥ä½œä¸ºæ•°æ®åº“çš„ä¸­é—´ä»¶ã€‚æ•°æ®éƒ½æ˜¯æŒ‰ç…§idï¼ˆè‡ªå¢ï¼‰å–æ¨¡çš„æ–¹å¼æ¥å­˜å–çš„ã€‚</p><p>å½“ç„¶ä¸€å¼€å§‹çš„æ—¶å€™ï¼Œé‚£äº›æ—§æ•°æ®ï¼Œæˆ‘ä»¬åšäº†ä¸€äº›æ¸…æ´—çš„å·¥ä½œï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯æŒ‰ç…§idå–æ¨¡è§„åˆ™åˆ†åˆ«å­˜å‚¨åˆ°äº†å„ä¸ªæ•°æ®åº“ä¸­ï¼Œå¥½å¤„å°±æ˜¯å¯ä»¥è®©å„ä¸ªæ•°æ®åº“åˆ†æ‘Šå­˜å‚¨å’Œè¯»å–çš„å‹åŠ›ï¼Œè§£å†³äº†æˆ‘ä»¬å½“æ—¶æ€§èƒ½çš„é—®é¢˜</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisç›¸å…³é¢è¯•é¢˜</title>
      <link href="/2024/01/08/%E9%9D%A2%E8%AF%95-Redis%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
      <url>/2024/01/08/%E9%9D%A2%E8%AF%95-Redis%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æœ¬ç¯‡æ–‡ç« å–è‡ªé»‘é©¬ç¨‹åºå‘˜</p><h1 id="Redisç›¸å…³é¢è¯•é¢˜"><a href="#Redisç›¸å…³é¢è¯•é¢˜" class="headerlink" title="Redisç›¸å…³é¢è¯•é¢˜"></a>Redisç›¸å…³é¢è¯•é¢˜</h1><blockquote><p><strong>é¢è¯•å®˜</strong>ï¼šä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ ? æ€ä¹ˆè§£å†³ ?</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯~~ï¼Œæˆ‘æƒ³ä¸€ä¸‹</p><p>ç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªä¸€å®š<strong>ä¸å­˜åœ¨</strong>çš„æ•°æ®ï¼Œå¦‚æœä»å­˜å‚¨å±‚æŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ° DB å»æŸ¥è¯¢ï¼Œå¯èƒ½å¯¼è‡´ DB æŒ‚æ‰ã€‚è¿™ç§æƒ…å†µå¤§æ¦‚ç‡æ˜¯é­åˆ°äº†æ”»å‡»ã€‚</p><p>è§£å†³æ–¹æ¡ˆçš„è¯ï¼Œæˆ‘ä»¬é€šå¸¸éƒ½ä¼šç”¨å¸ƒéš†è¿‡æ»¤å™¨æ¥è§£å†³å®ƒ</p><p><strong>é¢è¯•å®˜</strong>ï¼šå¥½çš„ï¼Œä½ èƒ½ä»‹ç»ä¸€ä¸‹å¸ƒéš†è¿‡æ»¤å™¨å—ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼Œæ˜¯è¿™æ ·~</p><p>å¸ƒéš†è¿‡æ»¤å™¨ä¸»è¦æ˜¯ç”¨äºæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚æˆ‘ä»¬å½“æ—¶ä½¿ç”¨çš„æ˜¯redissonå®ç°çš„å¸ƒéš†è¿‡æ»¤å™¨ã€‚</p><p>å®ƒçš„åº•å±‚ä¸»è¦æ˜¯å…ˆå»åˆå§‹åŒ–ä¸€ä¸ªæ¯”è¾ƒå¤§æ•°ç»„ï¼Œé‡Œé¢å­˜æ”¾çš„äºŒè¿›åˆ¶0æˆ–1ã€‚åœ¨ä¸€å¼€å§‹éƒ½æ˜¯0ï¼Œå½“ä¸€ä¸ªkeyæ¥äº†ä¹‹åç»è¿‡3æ¬¡hashè®¡ç®—ï¼Œæ¨¡äºæ•°ç»„é•¿åº¦æ‰¾åˆ°æ•°æ®çš„ä¸‹æ ‡ç„¶åæŠŠæ•°ç»„ä¸­åŸæ¥çš„0æ”¹ä¸º1ï¼Œè¿™æ ·çš„è¯ï¼Œä¸‰ä¸ªæ•°ç»„çš„ä½ç½®å°±èƒ½æ ‡æ˜ä¸€ä¸ªkeyçš„å­˜åœ¨ã€‚æŸ¥æ‰¾çš„è¿‡ç¨‹ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p><p>å½“ç„¶æ˜¯æœ‰ç¼ºç‚¹çš„ï¼Œå¸ƒéš†è¿‡æ»¤å™¨æœ‰å¯èƒ½ä¼šäº§ç”Ÿä¸€å®šçš„è¯¯åˆ¤ï¼Œæˆ‘ä»¬ä¸€èˆ¬å¯ä»¥è®¾ç½®è¿™ä¸ªè¯¯åˆ¤ç‡ï¼Œå¤§æ¦‚ä¸ä¼šè¶…è¿‡5%ï¼Œå…¶å®è¿™ä¸ªè¯¯åˆ¤æ˜¯å¿…ç„¶å­˜åœ¨çš„ï¼Œè¦ä¸å°±å¾—å¢åŠ æ•°ç»„çš„é•¿åº¦ï¼Œå…¶å®å·²ç»ç®—æ˜¯å¾ˆåˆ’åˆ†äº†ï¼Œ5%ä»¥å†…çš„è¯¯åˆ¤ç‡ä¸€èˆ¬çš„é¡¹ç›®ä¹Ÿèƒ½æ¥å—ï¼Œä¸è‡³äºé«˜å¹¶å‘ä¸‹å‹å€’æ•°æ®åº“ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿ ? æ€ä¹ˆè§£å†³ ?</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼ï¼</p><p>ç¼“å­˜å‡»ç©¿çš„æ„æ€æ˜¯å¯¹äºè®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyï¼Œç¼“å­˜åœ¨æŸä¸ªæ—¶é—´ç‚¹è¿‡æœŸçš„æ—¶å€™ï¼Œæ°å¥½è¿™æ—¶é—´ç‚¹å¯¹è¿™ä¸ªKeyæœ‰å¤§é‡çš„å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä»åç«¯ DB åŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠ DB å‹å®ã€‚</p><p>è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><p>ç¬¬ä¸€å¯ä»¥ä½¿ç”¨äº’æ–¥é”ï¼šå½“ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œä¸ç«‹å³å»load dbï¼Œå…ˆä½¿ç”¨å¦‚ Redis çš„ setnx å»è®¾ç½®ä¸€ä¸ªäº’æ–¥é”ï¼Œå½“æ“ä½œæˆåŠŸè¿”å›æ—¶å†è¿›è¡Œ load dbçš„æ“ä½œå¹¶å›è®¾ç¼“å­˜ï¼Œå¦åˆ™é‡è¯•getç¼“å­˜çš„æ–¹æ³•</p><p>ç¬¬äºŒç§æ–¹æ¡ˆå¯ä»¥è®¾ç½®å½“å‰keyé€»è¾‘è¿‡æœŸï¼Œå¤§æ¦‚æ˜¯æ€è·¯å¦‚ä¸‹ï¼š</p><p>â‘ ï¼šåœ¨è®¾ç½®keyçš„æ—¶å€™ï¼Œè®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´å­—æ®µä¸€å—å­˜å…¥ç¼“å­˜ä¸­ï¼Œä¸ç»™å½“å‰keyè®¾ç½®è¿‡æœŸæ—¶é—´</p><p>â‘¡ï¼šå½“æŸ¥è¯¢çš„æ—¶å€™ï¼Œä»rediså–å‡ºæ•°æ®ååˆ¤æ–­æ—¶é—´æ˜¯å¦è¿‡æœŸ</p><p>â‘¢ï¼šå¦‚æœè¿‡æœŸåˆ™å¼€é€šå¦å¤–ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œå½“å‰çº¿ç¨‹æ­£å¸¸è¿”å›æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®ä¸æ˜¯æœ€æ–°</p><p>å½“ç„¶ä¸¤ç§æ–¹æ¡ˆå„æœ‰åˆ©å¼Šï¼š</p><p>å¦‚æœé€‰æ‹©æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œå»ºè®®ä½¿ç”¨åˆ†å¸ƒå¼é”çš„æ–¹æ¡ˆï¼Œæ€§èƒ½ä¸Šå¯èƒ½æ²¡é‚£ä¹ˆé«˜ï¼Œé”éœ€è¦ç­‰ï¼Œä¹Ÿæœ‰å¯èƒ½äº§ç”Ÿæ­»é”çš„é—®é¢˜</p><p>å¦‚æœé€‰æ‹©keyçš„é€»è¾‘åˆ é™¤ï¼Œåˆ™ä¼˜å…ˆè€ƒè™‘çš„é«˜å¯ç”¨æ€§ï¼Œæ€§èƒ½æ¯”è¾ƒé«˜ï¼Œä½†æ˜¯æ•°æ®åŒæ­¥è¿™å—åšä¸åˆ°å¼ºä¸€è‡´ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´© ? æ€ä¹ˆè§£å†³ ?</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼ï¼</p><p>ç¼“å­˜é›ªå´©æ„æ€æ˜¯è®¾ç½®ç¼“å­˜æ—¶é‡‡ç”¨äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œå¯¼è‡´ç¼“å­˜åœ¨æŸä¸€æ—¶åˆ»åŒæ—¶å¤±æ•ˆï¼Œè¯·æ±‚å…¨éƒ¨è½¬å‘åˆ°DBï¼ŒDB ç¬æ—¶å‹åŠ›è¿‡é‡é›ªå´©ã€‚ä¸ç¼“å­˜å‡»ç©¿çš„åŒºåˆ«ï¼šé›ªå´©æ˜¯å¾ˆå¤škeyï¼Œå‡»ç©¿æ˜¯æŸä¸€ä¸ªkeyç¼“å­˜ã€‚</p><p>è§£å†³æ–¹æ¡ˆä¸»è¦æ˜¯å¯ä»¥å°†ç¼“å­˜å¤±æ•ˆæ—¶é—´åˆ†æ•£å¼€ï¼Œæ¯”å¦‚å¯ä»¥åœ¨åŸæœ‰çš„å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªéšæœºå€¼ï¼Œæ¯”å¦‚1-5åˆ†é’Ÿéšæœºï¼Œè¿™æ ·æ¯ä¸€ä¸ªç¼“å­˜çš„è¿‡æœŸæ—¶é—´çš„é‡å¤ç‡å°±ä¼šé™ä½ï¼Œå°±å¾ˆéš¾å¼•å‘é›†ä½“å¤±æ•ˆçš„äº‹ä»¶ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šredisåšä¸ºç¼“å­˜ï¼Œmysqlçš„æ•°æ®å¦‚ä½•ä¸redisè¿›è¡ŒåŒæ­¥å‘¢ï¼Ÿï¼ˆåŒå†™ä¸€è‡´æ€§ï¼‰</p><p><strong>å€™é€‰äºº</strong>ï¼šå—¯ï¼å°±è¯´æˆ‘æœ€è¿‘åšçš„è¿™ä¸ªé¡¹ç›®ï¼Œé‡Œé¢æœ‰xxxxï¼ˆ<strong>æ ¹æ®è‡ªå·±çš„ç®€å†ä¸Šå†™</strong>ï¼‰çš„åŠŸèƒ½ï¼Œéœ€è¦è®©æ•°æ®åº“ä¸redisé«˜åº¦ä¿æŒä¸€è‡´ï¼Œå› ä¸ºè¦æ±‚æ—¶æ•ˆæ€§æ¯”è¾ƒé«˜ï¼Œæˆ‘ä»¬å½“æ—¶é‡‡ç”¨çš„è¯»å†™é”ä¿è¯çš„å¼ºä¸€è‡´æ€§ã€‚</p><p>æˆ‘ä»¬é‡‡ç”¨çš„æ˜¯redissonå®ç°çš„è¯»å†™é”ï¼Œåœ¨è¯»çš„æ—¶å€™æ·»åŠ å…±äº«é”ï¼Œå¯ä»¥ä¿è¯è¯»è¯»ä¸äº’æ–¥ï¼Œè¯»å†™äº’æ–¥ã€‚å½“æˆ‘ä»¬æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œæ·»åŠ æ’ä»–é”ï¼Œå®ƒæ˜¯è¯»å†™ï¼Œè¯»è¯»éƒ½äº’æ–¥ï¼Œè¿™æ ·å°±èƒ½ä¿è¯åœ¨å†™æ•°æ®çš„åŒæ—¶æ˜¯ä¸ä¼šè®©å…¶ä»–çº¿ç¨‹è¯»æ•°æ®çš„ï¼Œé¿å…äº†è„æ•°æ®ã€‚è¿™é‡Œé¢éœ€è¦æ³¨æ„çš„æ˜¯è¯»æ–¹æ³•å’Œå†™æ–¹æ³•ä¸Šéœ€è¦ä½¿ç”¨åŒä¸€æŠŠé”æ‰è¡Œã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šé‚£è¿™ä¸ªæ’ä»–é”æ˜¯å¦‚ä½•ä¿è¯è¯»å†™ã€è¯»è¯»äº’æ–¥çš„å‘¢ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼šå…¶å®æ’ä»–é”åº•å±‚ä½¿ç”¨ä¹Ÿæ˜¯setnxï¼Œä¿è¯äº†åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œé”ä½çš„æ–¹æ³•</p><p><strong>é¢è¯•å®˜</strong>ï¼šä½ å¬è¯´è¿‡å»¶æ—¶åŒåˆ å—ï¼Ÿä¸ºä»€ä¹ˆä¸ç”¨å®ƒå‘¢ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼šå»¶è¿ŸåŒåˆ ï¼Œå¦‚æœæ˜¯å†™æ“ä½œï¼Œæˆ‘ä»¬å…ˆæŠŠç¼“å­˜ä¸­çš„æ•°æ®åˆ é™¤ï¼Œç„¶åæ›´æ–°æ•°æ®åº“ï¼Œæœ€åå†å»¶æ—¶åˆ é™¤ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œå…¶ä¸­è¿™ä¸ªå»¶æ—¶å¤šä¹…ä¸å¤ªå¥½ç¡®å®šï¼Œåœ¨å»¶æ—¶çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°è„æ•°æ®ï¼Œå¹¶ä¸èƒ½ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œæ‰€ä»¥æ²¡æœ‰é‡‡ç”¨å®ƒã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šredisåšä¸ºç¼“å­˜ï¼Œmysqlçš„æ•°æ®å¦‚ä½•ä¸redisè¿›è¡ŒåŒæ­¥å‘¢ï¼Ÿï¼ˆåŒå†™ä¸€è‡´æ€§ï¼‰</p><p><strong>å€™é€‰äºº</strong>ï¼šå—¯ï¼å°±è¯´æˆ‘æœ€è¿‘åšçš„è¿™ä¸ªé¡¹ç›®ï¼Œé‡Œé¢æœ‰xxxxï¼ˆ<strong>æ ¹æ®è‡ªå·±çš„ç®€å†ä¸Šå†™</strong>ï¼‰çš„åŠŸèƒ½ï¼Œæ•°æ®åŒæ­¥å¯ä»¥æœ‰ä¸€å®šçš„å»¶æ—¶ï¼ˆç¬¦åˆå¤§éƒ¨åˆ†ä¸šåŠ¡ï¼‰</p><p>æˆ‘ä»¬å½“æ—¶é‡‡ç”¨çš„é˜¿é‡Œçš„canalç»„ä»¶å®ç°æ•°æ®åŒæ­¥ï¼šä¸éœ€è¦æ›´æ”¹ä¸šåŠ¡ä»£ç ï¼Œéƒ¨ç½²ä¸€ä¸ªcanalæœåŠ¡ã€‚canalæœåŠ¡æŠŠè‡ªå·±ä¼ªè£…æˆmysqlçš„ä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œå½“mysqlæ•°æ®æ›´æ–°ä»¥åï¼Œcanalä¼šè¯»å–binlogæ•°æ®ï¼Œç„¶ååœ¨é€šè¿‡canalçš„å®¢æˆ·ç«¯è·å–åˆ°æ•°æ®ï¼Œæ›´æ–°ç¼“å­˜å³å¯ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šredisåšä¸ºç¼“å­˜ï¼Œæ•°æ®çš„æŒä¹…åŒ–æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼šåœ¨Redisä¸­æä¾›äº†ä¸¤ç§æ•°æ®æŒä¹…åŒ–çš„æ–¹å¼ï¼š1ã€RDB  2ã€AOF</p><p><strong>é¢è¯•å®˜</strong>ï¼šè¿™ä¸¤ç§æŒä¹…åŒ–æ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼šRDBæ˜¯ä¸€ä¸ªå¿«ç…§æ–‡ä»¶ï¼Œå®ƒæ˜¯æŠŠrediså†…å­˜å­˜å‚¨çš„æ•°æ®å†™åˆ°ç£ç›˜ä¸Šï¼Œå½“rediså®ä¾‹å®•æœºæ¢å¤æ•°æ®çš„æ—¶å€™ï¼Œæ–¹ä¾¿ä»RDBçš„å¿«ç…§æ–‡ä»¶ä¸­æ¢å¤æ•°æ®ã€‚</p><p>AOFçš„å«ä¹‰æ˜¯è¿½åŠ æ–‡ä»¶ï¼Œå½“redisæ“ä½œå†™å‘½ä»¤çš„æ—¶å€™ï¼Œéƒ½ä¼šå­˜å‚¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œå½“rediså®ä¾‹å®•æœºæ¢å¤æ•°æ®çš„æ—¶å€™ï¼Œä¼šä»è¿™ä¸ªæ–‡ä»¶ä¸­å†æ¬¡æ‰§è¡Œä¸€éå‘½ä»¤æ¥æ¢å¤æ•°æ®</p><p><strong>é¢è¯•å®˜</strong>ï¼šè¿™ä¸¤ç§æ–¹å¼ï¼Œå“ªç§æ¢å¤çš„æ¯”è¾ƒå¿«å‘¢ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼šRDBå› ä¸ºæ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåœ¨ä¿å­˜çš„æ—¶å€™ä½“ç§¯ä¹Ÿæ˜¯æ¯”è¾ƒå°çš„ï¼Œå®ƒæ¢å¤çš„æ¯”è¾ƒå¿«ï¼Œä½†æ˜¯å®ƒæœ‰å¯èƒ½ä¼šä¸¢æ•°æ®ï¼Œæˆ‘ä»¬é€šå¸¸åœ¨é¡¹ç›®ä¸­ä¹Ÿä¼šä½¿ç”¨AOFæ¥æ¢å¤æ•°æ®ï¼Œè™½ç„¶AOFæ¢å¤çš„é€Ÿåº¦æ…¢ä¸€äº›ï¼Œä½†æ˜¯å®ƒä¸¢æ•°æ®çš„é£é™©è¦å°å¾ˆå¤šï¼Œåœ¨AOFæ–‡ä»¶ä¸­å¯ä»¥è®¾ç½®åˆ·ç›˜ç­–ç•¥ï¼Œæˆ‘ä»¬å½“æ—¶è®¾ç½®çš„å°±æ˜¯æ¯ç§’æ‰¹é‡å†™å…¥ä¸€æ¬¡å‘½ä»¤</p><p><strong>é¢è¯•å®˜</strong>ï¼šRedisçš„æ•°æ®è¿‡æœŸç­–ç•¥æœ‰å“ªäº› ? </p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯~ï¼Œåœ¨redisä¸­æä¾›äº†ä¸¤ç§æ•°æ®è¿‡æœŸåˆ é™¤ç­–ç•¥</p><p>ç¬¬ä¸€ç§æ˜¯æƒ°æ€§åˆ é™¤ï¼Œåœ¨è®¾ç½®è¯¥keyè¿‡æœŸæ—¶é—´åï¼Œæˆ‘ä»¬ä¸å»ç®¡å®ƒï¼Œå½“éœ€è¦è¯¥keyæ—¶ï¼Œæˆ‘ä»¬åœ¨æ£€æŸ¥å…¶æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸï¼Œæˆ‘ä»¬å°±åˆ æ‰å®ƒï¼Œåä¹‹è¿”å›è¯¥keyã€‚</p><p>ç¬¬äºŒç§æ˜¯ å®šæœŸåˆ é™¤ï¼Œå°±æ˜¯è¯´æ¯éš”ä¸€æ®µæ—¶é—´ï¼Œæˆ‘ä»¬å°±å¯¹ä¸€äº›keyè¿›è¡Œæ£€æŸ¥ï¼Œåˆ é™¤é‡Œé¢è¿‡æœŸçš„key</p><p>å®šæœŸæ¸…ç†çš„ä¸¤ç§æ¨¡å¼ï¼š</p><ul><li>SLOWæ¨¡å¼æ˜¯å®šæ—¶ä»»åŠ¡ï¼Œæ‰§è¡Œé¢‘ç‡é»˜è®¤ä¸º10hzï¼Œæ¯æ¬¡ä¸è¶…è¿‡25msï¼Œä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶redis.conf çš„ <strong>hz</strong> é€‰é¡¹æ¥è°ƒæ•´è¿™ä¸ªæ¬¡æ•°</li><li>FASTæ¨¡å¼æ‰§è¡Œé¢‘ç‡ä¸å›ºå®šï¼Œæ¯æ¬¡äº‹ä»¶å¾ªç¯ä¼šå°è¯•æ‰§è¡Œï¼Œä½†ä¸¤æ¬¡é—´éš”ä¸ä½äº2msï¼Œæ¯æ¬¡è€—æ—¶ä¸è¶…è¿‡1ms</li></ul><p>Redisçš„è¿‡æœŸåˆ é™¤ç­–ç•¥ï¼š<strong>æƒ°æ€§åˆ é™¤ + å®šæœŸåˆ é™¤</strong>ä¸¤ç§ç­–ç•¥è¿›è¡Œé…åˆä½¿ç”¨ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šRedisçš„æ•°æ®æ·˜æ±°ç­–ç•¥æœ‰å“ªäº› ? </p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼Œè¿™ä¸ªåœ¨redisä¸­æä¾›äº†å¾ˆå¤šç§ï¼Œé»˜è®¤æ˜¯noevictionï¼Œä¸åˆ é™¤ä»»ä½•æ•°æ®ï¼Œå†…éƒ¨ä¸è¶³ç›´æ¥æŠ¥é”™</p><p>æ˜¯å¯ä»¥åœ¨redisçš„é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œè®¾ç½®çš„ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œä¸€ä¸ªæ˜¯LRUï¼Œå¦å¤–ä¸€ä¸ªæ˜¯LFU</p><p>LRUçš„æ„æ€å°±æ˜¯æœ€å°‘æœ€è¿‘ä½¿ç”¨ï¼Œç”¨å½“å‰æ—¶é—´å‡å»æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´ï¼Œè¿™ä¸ªå€¼è¶Šå¤§åˆ™æ·˜æ±°ä¼˜å…ˆçº§è¶Šé«˜ã€‚</p><p>LFUçš„æ„æ€æ˜¯æœ€å°‘é¢‘ç‡ä½¿ç”¨ã€‚ä¼šç»Ÿè®¡æ¯ä¸ªkeyçš„è®¿é—®é¢‘ç‡ï¼Œå€¼è¶Šå°æ·˜æ±°ä¼˜å…ˆçº§è¶Šé«˜</p><p>æˆ‘ä»¬åœ¨é¡¹ç›®è®¾ç½®çš„allkeys-lruï¼ŒæŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ï¼ŒæŠŠä¸€äº›ç»å¸¸è®¿é—®çš„keyç•™åœ¨redisä¸­</p><p><strong>é¢è¯•å®˜</strong>ï¼šæ•°æ®åº“æœ‰1000ä¸‡æ•°æ® ,Redisåªèƒ½ç¼“å­˜20wæ•°æ®, å¦‚ä½•ä¿è¯Redisä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ® ?</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼Œæˆ‘æƒ³ä¸€ä¸‹~~</p><p>å¯ä»¥ä½¿ç”¨ allkeys-lru ï¼ˆæŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ï¼‰æ·˜æ±°ç­–ç•¥ï¼Œé‚£ç•™ä¸‹æ¥çš„éƒ½æ˜¯ç»å¸¸è®¿é—®çš„çƒ­ç‚¹æ•°æ®</p><p><strong>é¢è¯•å®˜</strong>ï¼šRedisçš„å†…å­˜ç”¨å®Œäº†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯~ï¼Œè¿™ä¸ªè¦çœ‹redisçš„æ•°æ®æ·˜æ±°ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Œå¦‚æœæ˜¯é»˜è®¤çš„é…ç½®ï¼Œrediså†…å­˜ç”¨å®Œä»¥ååˆ™ç›´æ¥æŠ¥é”™ã€‚æˆ‘ä»¬å½“æ—¶è®¾ç½®çš„ allkeys-lru ç­–ç•¥ã€‚æŠŠæœ€è¿‘æœ€å¸¸è®¿é—®çš„æ•°æ®ç•™åœ¨ç¼“å­˜ä¸­ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šRedisåˆ†å¸ƒå¼é”å¦‚ä½•å®ç° ? </p><p><strong>å€™é€‰äºº</strong>ï¼šå—¯ï¼Œåœ¨redisä¸­æä¾›äº†ä¸€ä¸ªå‘½ä»¤setnx(SET if not exists)</p><p>ç”±äºredisçš„å•çº¿ç¨‹çš„ï¼Œç”¨äº†å‘½ä»¤ä¹‹åï¼Œåªèƒ½æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å¯¹æŸä¸€ä¸ªkeyè®¾ç½®å€¼ï¼Œåœ¨æ²¡æœ‰è¿‡æœŸæˆ–åˆ é™¤keyçš„æ—¶å€™æ˜¯å…¶ä»–å®¢æˆ·ç«¯æ˜¯ä¸èƒ½è®¾ç½®è¿™ä¸ªkeyçš„</p><p><strong>é¢è¯•å®˜</strong>ï¼šå¥½çš„ï¼Œé‚£ä½ å¦‚ä½•æ§åˆ¶Rediså®ç°åˆ†å¸ƒå¼é”æœ‰æ•ˆæ—¶é•¿å‘¢ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼šå—¯ï¼Œçš„ç¡®ï¼Œredisçš„setnxæŒ‡ä»¤ä¸å¥½æ§åˆ¶è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å½“æ—¶é‡‡ç”¨çš„redisçš„ä¸€ä¸ªæ¡†æ¶redissonå®ç°çš„ã€‚</p><p>åœ¨redissonä¸­éœ€è¦æ‰‹åŠ¨åŠ é”ï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶é”çš„å¤±æ•ˆæ—¶é—´å’Œç­‰å¾…æ—¶é—´ï¼Œå½“é”ä½çš„ä¸€ä¸ªä¸šåŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæˆçš„æ—¶å€™ï¼Œåœ¨redissonä¸­å¼•å…¥äº†ä¸€ä¸ªçœ‹é—¨ç‹—æœºåˆ¶ï¼Œå°±æ˜¯è¯´æ¯éš”ä¸€æ®µæ—¶é—´å°±æ£€æŸ¥å½“å‰ä¸šåŠ¡æ˜¯å¦è¿˜æŒæœ‰é”ï¼Œå¦‚æœæŒæœ‰å°±å¢åŠ åŠ é”çš„æŒæœ‰æ—¶é—´ï¼Œå½“ä¸šåŠ¡æ‰§è¡Œå®Œæˆä¹‹åéœ€è¦ä½¿ç”¨é‡Šæ”¾é”å°±å¯ä»¥äº†</p><p>è¿˜æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯ï¼Œåœ¨é«˜å¹¶å‘ä¸‹ï¼Œä¸€ä¸ªä¸šåŠ¡æœ‰å¯èƒ½ä¼šæ‰§è¡Œå¾ˆå¿«ï¼Œå…ˆå®¢æˆ·1æŒæœ‰é”çš„æ—¶å€™ï¼Œå®¢æˆ·2æ¥äº†ä»¥åå¹¶ä¸ä¼šé©¬ä¸Šæ‹’ç»ï¼Œå®ƒä¼šè‡ªæ—‹ä¸æ–­å°è¯•è·å–é”ï¼Œå¦‚æœå®¢æˆ·1é‡Šæ”¾ä¹‹åï¼Œå®¢æˆ·2å°±å¯ä»¥é©¬ä¸ŠæŒæœ‰é”ï¼Œæ€§èƒ½ä¹Ÿå¾—åˆ°äº†æå‡ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šå¥½çš„ï¼Œredissonå®ç°çš„åˆ†å¸ƒå¼é”æ˜¯å¯é‡å…¥çš„å—ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼šå—¯ï¼Œæ˜¯å¯ä»¥é‡å…¥çš„ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†é¿å…æ­»é”çš„äº§ç”Ÿã€‚è¿™ä¸ªé‡å…¥å…¶å®åœ¨å†…éƒ¨å°±æ˜¯åˆ¤æ–­æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹æŒæœ‰çš„é”ï¼Œå¦‚æœæ˜¯å½“å‰çº¿ç¨‹æŒæœ‰çš„é”å°±ä¼šè®¡æ•°ï¼Œå¦‚æœé‡Šæ”¾é”å°±ä¼šåœ¨è®¡ç®—ä¸Šå‡ä¸€ã€‚åœ¨å­˜å‚¨æ•°æ®çš„æ—¶å€™é‡‡ç”¨çš„hashç»“æ„ï¼Œå¤§keyå¯ä»¥æŒ‰ç…§è‡ªå·±çš„ä¸šåŠ¡è¿›è¡Œå®šåˆ¶ï¼Œå…¶ä¸­å°keyæ˜¯å½“å‰çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ï¼Œvalueæ˜¯å½“å‰çº¿ç¨‹é‡å…¥çš„æ¬¡æ•°</p><p><strong>é¢è¯•å®˜</strong>ï¼šredissonå®ç°çš„åˆ†å¸ƒå¼é”èƒ½è§£å†³ä¸»ä»ä¸€è‡´æ€§çš„é—®é¢˜å—</p><p><strong>å€™é€‰äºº</strong>ï¼šè¿™ä¸ªæ˜¯ä¸èƒ½çš„ï¼Œæ¯”å¦‚ï¼Œå½“çº¿ç¨‹1åŠ é”æˆåŠŸåï¼ŒmasterèŠ‚ç‚¹æ•°æ®ä¼šå¼‚æ­¥å¤åˆ¶åˆ°slaveèŠ‚ç‚¹ï¼Œæ­¤æ—¶å½“å‰æŒæœ‰Redisé”çš„masterèŠ‚ç‚¹å®•æœºï¼ŒslaveèŠ‚ç‚¹è¢«æå‡ä¸ºæ–°çš„masterèŠ‚ç‚¹ï¼Œå‡å¦‚ç°åœ¨æ¥äº†ä¸€ä¸ªçº¿ç¨‹2ï¼Œå†æ¬¡åŠ é”ï¼Œä¼šåœ¨æ–°çš„masterèŠ‚ç‚¹ä¸ŠåŠ é”æˆåŠŸï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå‡ºç°ä¸¤ä¸ªèŠ‚ç‚¹åŒæ—¶æŒæœ‰ä¸€æŠŠé”çš„é—®é¢˜ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨redissonæä¾›çš„çº¢é”æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ï¼Œä¸èƒ½åªåœ¨ä¸€ä¸ªrediså®ä¾‹ä¸Šåˆ›å»ºé”ï¼Œåº”è¯¥æ˜¯åœ¨å¤šä¸ªrediså®ä¾‹ä¸Šåˆ›å»ºé”ï¼Œå¹¶ä¸”è¦æ±‚åœ¨å¤§å¤šæ•°redisèŠ‚ç‚¹ä¸Šéƒ½æˆåŠŸåˆ›å»ºé”ï¼Œçº¢é”ä¸­è¦æ±‚æ˜¯redisçš„èŠ‚ç‚¹æ•°é‡è¦è¿‡åŠã€‚è¿™æ ·å°±èƒ½é¿å…çº¿ç¨‹1åŠ é”æˆåŠŸåmasterèŠ‚ç‚¹å®•æœºå¯¼è‡´çº¿ç¨‹2æˆåŠŸåŠ é”åˆ°æ–°çš„masterèŠ‚ç‚¹ä¸Šçš„é—®é¢˜äº†ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨äº†çº¢é”ï¼Œå› ä¸ºéœ€è¦åŒæ—¶åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šéƒ½æ·»åŠ é”ï¼Œæ€§èƒ½å°±å˜çš„å¾ˆä½äº†ï¼Œå¹¶ä¸”è¿ç»´ç»´æŠ¤æˆæœ¬ä¹Ÿéå¸¸é«˜ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸€èˆ¬åœ¨é¡¹ç›®ä¸­ä¹Ÿä¸ä¼šç›´æ¥ä½¿ç”¨çº¢é”ï¼Œå¹¶ä¸”å®˜æ–¹ä¹Ÿæš‚æ—¶åºŸå¼ƒäº†è¿™ä¸ªçº¢é”</p><p><strong>é¢è¯•å®˜</strong>ï¼šå¥½çš„ï¼Œå¦‚æœä¸šåŠ¡éè¦ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œè¿™ä¸ªè¯¥æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p><p><strong>å€™é€‰äººï¼š</strong>å—¯~ï¼Œredisæœ¬èº«å°±æ˜¯æ”¯æŒé«˜å¯ç”¨çš„ï¼Œåšåˆ°å¼ºä¸€è‡´æ€§ï¼Œå°±éå¸¸å½±å“æ€§èƒ½ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæœ‰å¼ºä¸€è‡´æ€§è¦æ±‚é«˜çš„ä¸šåŠ¡ï¼Œå»ºè®®ä½¿ç”¨zookeeperå®ç°çš„åˆ†å¸ƒå¼é”ï¼Œå®ƒæ˜¯å¯ä»¥ä¿è¯å¼ºä¸€è‡´æ€§çš„ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šRedisé›†ç¾¤æœ‰å“ªäº›æ–¹æ¡ˆ, çŸ¥é“å˜› ? </p><p><strong>å€™é€‰äºº</strong>ï¼šå—¯~~ï¼Œåœ¨Redisä¸­æä¾›çš„é›†ç¾¤æ–¹æ¡ˆæ€»å…±æœ‰ä¸‰ç§ï¼šä¸»ä»å¤åˆ¶ã€å“¨å…µæ¨¡å¼ã€Redisåˆ†ç‰‡é›†ç¾¤</p><p><strong>é¢è¯•å®˜</strong>ï¼šé‚£ä½ æ¥ä»‹ç»ä¸€ä¸‹ä¸»ä»åŒæ­¥</p><p><strong>å€™é€‰äºº</strong>ï¼šå—¯ï¼Œæ˜¯è¿™æ ·çš„ï¼Œå•èŠ‚ç‚¹Redisçš„å¹¶å‘èƒ½åŠ›æ˜¯æœ‰ä¸Šé™çš„ï¼Œè¦è¿›ä¸€æ­¥æé«˜Redisçš„å¹¶å‘èƒ½åŠ›ï¼Œå¯ä»¥æ­å»ºä¸»ä»é›†ç¾¤ï¼Œå®ç°è¯»å†™åˆ†ç¦»ã€‚ä¸€èˆ¬éƒ½æ˜¯ä¸€ä¸»å¤šä»ï¼Œä¸»èŠ‚ç‚¹è´Ÿè´£å†™æ•°æ®ï¼Œä»èŠ‚ç‚¹è´Ÿè´£è¯»æ•°æ®ï¼Œä¸»èŠ‚ç‚¹å†™å…¥æ•°æ®ä¹‹åï¼Œéœ€è¦æŠŠæ•°æ®åŒæ­¥åˆ°ä»èŠ‚ç‚¹ä¸­</p><p><strong>é¢è¯•å®˜</strong>ï¼šèƒ½è¯´ä¸€ä¸‹ï¼Œä¸»ä»åŒæ­¥æ•°æ®çš„æµç¨‹</p><p><strong>å€™é€‰äºº</strong>ï¼šå—¯~~ï¼Œå¥½ï¼ä¸»ä»åŒæ­¥åˆ†ä¸ºäº†ä¸¤ä¸ªé˜¶æ®µï¼Œä¸€ä¸ªæ˜¯å…¨é‡åŒæ­¥ï¼Œä¸€ä¸ªæ˜¯å¢é‡åŒæ­¥</p><p>å…¨é‡åŒæ­¥æ˜¯æŒ‡ä»èŠ‚ç‚¹ç¬¬ä¸€æ¬¡ä¸ä¸»èŠ‚ç‚¹å»ºç«‹è¿æ¥çš„æ—¶å€™ä½¿ç”¨å…¨é‡åŒæ­¥ï¼Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><p>ç¬¬ä¸€ï¼šä»èŠ‚ç‚¹è¯·æ±‚ä¸»èŠ‚ç‚¹åŒæ­¥æ•°æ®ï¼Œå…¶ä¸­ä»èŠ‚ç‚¹ä¼šæºå¸¦è‡ªå·±çš„replication idå’Œoffsetåç§»é‡ã€‚</p><p>ç¬¬äºŒï¼šä¸»èŠ‚ç‚¹åˆ¤æ–­æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œä¸»è¦åˆ¤æ–­çš„ä¾æ®å°±æ˜¯ï¼Œä¸»èŠ‚ç‚¹ä¸ä»èŠ‚ç‚¹æ˜¯å¦æ˜¯åŒä¸€ä¸ªreplication idï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±è¯´æ˜æ˜¯ç¬¬ä¸€æ¬¡åŒæ­¥ï¼Œé‚£ä¸»èŠ‚ç‚¹å°±ä¼šæŠŠè‡ªå·±çš„replication idå’Œoffsetå‘é€ç»™ä»èŠ‚ç‚¹ï¼Œè®©ä»èŠ‚ç‚¹ä¸ä¸»èŠ‚ç‚¹çš„ä¿¡æ¯ä¿æŒä¸€è‡´ã€‚</p><p>ç¬¬ä¸‰ï¼šåœ¨åŒæ—¶ä¸»èŠ‚ç‚¹ä¼šæ‰§è¡Œbgsaveï¼Œç”Ÿæˆrdbæ–‡ä»¶åï¼Œå‘é€ç»™ä»èŠ‚ç‚¹å»æ‰§è¡Œï¼Œä»èŠ‚ç‚¹å…ˆæŠŠè‡ªå·±çš„æ•°æ®æ¸…ç©ºï¼Œç„¶åæ‰§è¡Œä¸»èŠ‚ç‚¹å‘é€è¿‡æ¥çš„rdbæ–‡ä»¶ï¼Œè¿™æ ·å°±ä¿æŒäº†ä¸€è‡´</p><p>å½“ç„¶ï¼Œå¦‚æœåœ¨rdbç”Ÿæˆæ‰§è¡ŒæœŸé—´ï¼Œä¾ç„¶æœ‰è¯·æ±‚åˆ°äº†ä¸»èŠ‚ç‚¹ï¼Œè€Œä¸»èŠ‚ç‚¹ä¼šä»¥å‘½ä»¤çš„æ–¹å¼è®°å½•åˆ°ç¼“å†²åŒºï¼Œç¼“å†²åŒºæ˜¯ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œæœ€åæŠŠè¿™ä¸ªæ—¥å¿—æ–‡ä»¶å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œè¿™æ ·å°±èƒ½ä¿è¯ä¸»èŠ‚ç‚¹ä¸ä»èŠ‚ç‚¹å®Œå…¨ä¸€è‡´äº†ï¼ŒåæœŸå†åŒæ­¥æ•°æ®çš„æ—¶å€™ï¼Œéƒ½æ˜¯ä¾èµ–äºè¿™ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œè¿™ä¸ªå°±æ˜¯å…¨é‡åŒæ­¥</p><p>å¢é‡åŒæ­¥æŒ‡çš„æ˜¯ï¼Œå½“ä»èŠ‚ç‚¹æœåŠ¡é‡å¯ä¹‹åï¼Œæ•°æ®å°±ä¸ä¸€è‡´äº†ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™ï¼Œä»èŠ‚ç‚¹ä¼šè¯·æ±‚ä¸»èŠ‚ç‚¹åŒæ­¥æ•°æ®ï¼Œä¸»èŠ‚ç‚¹è¿˜æ˜¯åˆ¤æ–­ä¸æ˜¯ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œä¸æ˜¯ç¬¬ä¸€æ¬¡å°±è·å–ä»èŠ‚ç‚¹çš„offsetå€¼ï¼Œç„¶åä¸»èŠ‚ç‚¹ä»å‘½ä»¤æ—¥å¿—ä¸­è·å–offsetå€¼ä¹‹åçš„æ•°æ®ï¼Œå‘é€ç»™ä»èŠ‚ç‚¹è¿›è¡Œæ•°æ®åŒæ­¥</p><p><strong>é¢è¯•å®˜</strong>ï¼šæ€ä¹ˆä¿è¯Redisçš„é«˜å¹¶å‘é«˜å¯ç”¨</p><p><strong>å€™é€‰äºº</strong>ï¼šé¦–å…ˆå¯ä»¥æ­å»ºä¸»ä»é›†ç¾¤ï¼Œå†åŠ ä¸Šä½¿ç”¨redisä¸­çš„å“¨å…µæ¨¡å¼ï¼Œå“¨å…µæ¨¡å¼å¯ä»¥å®ç°ä¸»ä»é›†ç¾¤çš„è‡ªåŠ¨æ•…éšœæ¢å¤ï¼Œé‡Œé¢å°±åŒ…å«äº†å¯¹ä¸»ä»æœåŠ¡çš„ç›‘æ§ã€è‡ªåŠ¨æ•…éšœæ¢å¤ã€é€šçŸ¥ï¼›å¦‚æœmasteræ•…éšœï¼ŒSentinelä¼šå°†ä¸€ä¸ªslaveæå‡ä¸ºmasterã€‚å½“æ•…éšœå®ä¾‹æ¢å¤åä¹Ÿä»¥æ–°çš„masterä¸ºä¸»ï¼›åŒæ—¶Sentinelä¹Ÿå……å½“Rediså®¢æˆ·ç«¯çš„æœåŠ¡å‘ç°æ¥æºï¼Œå½“é›†ç¾¤å‘ç”Ÿæ•…éšœè½¬ç§»æ—¶ï¼Œä¼šå°†æœ€æ–°ä¿¡æ¯æ¨é€ç»™Redisçš„å®¢æˆ·ç«¯ï¼Œæ‰€ä»¥ä¸€èˆ¬é¡¹ç›®éƒ½ä¼šé‡‡ç”¨å“¨å…µçš„æ¨¡å¼æ¥ä¿è¯redisçš„é«˜å¹¶å‘é«˜å¯ç”¨</p><p><strong>é¢è¯•å®˜</strong>ï¼šä½ ä»¬ä½¿ç”¨redisæ˜¯å•ç‚¹è¿˜æ˜¯é›†ç¾¤ï¼Œå“ªç§é›†ç¾¤</p><p><strong>å€™é€‰äºº</strong>ï¼šå—¯ï¼ï¼Œæˆ‘ä»¬å½“æ—¶ä½¿ç”¨çš„æ˜¯ä¸»ä»ï¼ˆ1ä¸»1ä»ï¼‰åŠ å“¨å…µã€‚ä¸€èˆ¬å•èŠ‚ç‚¹ä¸è¶…è¿‡10Gå†…å­˜ï¼Œå¦‚æœRediså†…å­˜ä¸è¶³åˆ™å¯ä»¥ç»™ä¸åŒæœåŠ¡åˆ†é…ç‹¬ç«‹çš„Redisä¸»ä»èŠ‚ç‚¹ã€‚å°½é‡ä¸åšåˆ†ç‰‡é›†ç¾¤ã€‚å› ä¸ºé›†ç¾¤ç»´æŠ¤èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œå¹¶ä¸”é›†ç¾¤ä¹‹é—´çš„å¿ƒè·³æ£€æµ‹å’Œæ•°æ®é€šä¿¡ä¼šæ¶ˆè€—å¤§é‡çš„ç½‘ç»œå¸¦å®½ï¼Œä¹Ÿæ²¡æœ‰åŠæ³•ä½¿ç”¨luaè„šæœ¬å’Œäº‹åŠ¡</p><p><strong>é¢è¯•å®˜</strong>ï¼šredisé›†ç¾¤è„‘è£‚ï¼Œè¯¥æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼šå—¯ï¼ è¿™ä¸ªåœ¨é¡¹ç›®å¾ˆå°‘è§ï¼Œä¸è¿‡è„‘è£‚çš„é—®é¢˜æ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬ç°åœ¨ç”¨çš„æ˜¯redisçš„å“¨å…µæ¨¡å¼é›†ç¾¤çš„</p><p>æœ‰çš„æ—¶å€™ç”±äºç½‘ç»œç­‰åŸå› å¯èƒ½ä¼šå‡ºç°è„‘è£‚çš„æƒ…å†µï¼Œå°±æ˜¯è¯´ï¼Œç”±äºredis masterèŠ‚ç‚¹å’Œredis salveèŠ‚ç‚¹å’Œsentinelå¤„äºä¸åŒçš„ç½‘ç»œåˆ†åŒºï¼Œä½¿å¾—sentinelæ²¡æœ‰èƒ½å¤Ÿå¿ƒè·³æ„ŸçŸ¥åˆ°masterï¼Œæ‰€ä»¥é€šè¿‡é€‰ä¸¾çš„æ–¹å¼æå‡äº†ä¸€ä¸ªsalveä¸ºmasterï¼Œè¿™æ ·å°±å­˜åœ¨äº†ä¸¤ä¸ªmasterï¼Œå°±åƒå¤§è„‘åˆ†è£‚äº†ä¸€æ ·ï¼Œè¿™æ ·ä¼šå¯¼è‡´å®¢æˆ·ç«¯è¿˜åœ¨old masteré‚£é‡Œå†™å…¥æ•°æ®ï¼Œæ–°èŠ‚ç‚¹æ— æ³•åŒæ­¥æ•°æ®ï¼Œå½“ç½‘ç»œæ¢å¤åï¼Œsentinelä¼šå°†old masteré™ä¸ºsalveï¼Œè¿™æ—¶å†ä»æ–°masteråŒæ­¥æ•°æ®ï¼Œè¿™ä¼šå¯¼è‡´old masterä¸­çš„å¤§é‡æ•°æ®ä¸¢å¤±ã€‚</p><p>å…³äºè§£å†³çš„è¯ï¼Œæˆ‘è®°å¾—åœ¨redisçš„é…ç½®ä¸­å¯ä»¥è®¾ç½®ï¼šç¬¬ä¸€å¯ä»¥è®¾ç½®æœ€å°‘çš„salveèŠ‚ç‚¹ä¸ªæ•°ï¼Œæ¯”å¦‚è®¾ç½®è‡³å°‘è¦æœ‰ä¸€ä¸ªä»èŠ‚ç‚¹æ‰èƒ½åŒæ­¥æ•°æ®ï¼Œç¬¬äºŒä¸ªå¯ä»¥è®¾ç½®ä¸»ä»æ•°æ®å¤åˆ¶å’ŒåŒæ­¥çš„å»¶è¿Ÿæ—¶é—´ï¼Œè¾¾ä¸åˆ°è¦æ±‚å°±æ‹’ç»è¯·æ±‚ï¼Œå°±å¯ä»¥é¿å…å¤§é‡çš„æ•°æ®ä¸¢å¤±</p><p><strong>é¢è¯•å®˜</strong>ï¼šredisçš„åˆ†ç‰‡é›†ç¾¤æœ‰ä»€ä¹ˆä½œç”¨</p><p><strong>å€™é€‰äºº</strong>ï¼šåˆ†ç‰‡é›†ç¾¤ä¸»è¦è§£å†³çš„æ˜¯ï¼Œæµ·é‡æ•°æ®å­˜å‚¨çš„é—®é¢˜ï¼Œé›†ç¾¤ä¸­æœ‰å¤šä¸ªmasterï¼Œæ¯ä¸ªmasterä¿å­˜ä¸åŒæ•°æ®ï¼Œå¹¶ä¸”è¿˜å¯ä»¥ç»™æ¯ä¸ªmasterè®¾ç½®å¤šä¸ªslaveèŠ‚ç‚¹ï¼Œå°±å¯ä»¥ç»§ç»­å¢å¤§é›†ç¾¤çš„é«˜å¹¶å‘èƒ½åŠ›ã€‚åŒæ—¶æ¯ä¸ªmasterä¹‹é—´é€šè¿‡pingç›‘æµ‹å½¼æ­¤å¥åº·çŠ¶æ€ï¼Œå°±ç±»ä¼¼äºå“¨å…µæ¨¡å¼äº†ã€‚å½“å®¢æˆ·ç«¯è¯·æ±‚å¯ä»¥è®¿é—®é›†ç¾¤ä»»æ„èŠ‚ç‚¹ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«è½¬å‘åˆ°æ­£ç¡®èŠ‚ç‚¹</p><p><strong>é¢è¯•å®˜</strong>ï¼šRedisåˆ†ç‰‡é›†ç¾¤ä¸­æ•°æ®æ˜¯æ€ä¹ˆå­˜å‚¨å’Œè¯»å–çš„ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯~ï¼Œåœ¨redisé›†ç¾¤ä¸­æ˜¯è¿™æ ·çš„</p><p>Redis é›†ç¾¤å¼•å…¥äº†å“ˆå¸Œæ§½çš„æ¦‚å¿µï¼Œæœ‰ 16384 ä¸ªå“ˆå¸Œæ§½ï¼Œé›†ç¾¤ä¸­æ¯ä¸ªä¸»èŠ‚ç‚¹ç»‘å®šäº†ä¸€å®šèŒƒå›´çš„å“ˆå¸Œæ§½èŒƒå›´ï¼Œ keyé€šè¿‡ CRC16 æ ¡éªŒåå¯¹ 16384 å–æ¨¡æ¥å†³å®šæ”¾ç½®å“ªä¸ªæ§½ï¼Œé€šè¿‡æ§½æ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹è¿›è¡Œå­˜å‚¨ã€‚</p><p>å–å€¼çš„é€»è¾‘æ˜¯ä¸€æ ·çš„</p><p><strong>é¢è¯•å®˜</strong>ï¼šRedisæ˜¯å•çº¿ç¨‹çš„ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¿˜é‚£ä¹ˆå¿«ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼Œè¿™ä¸ªæœ‰å‡ ä¸ªåŸå› å§~~~</p><p>1ã€å®Œå…¨åŸºäºå†…å­˜çš„ï¼ŒCè¯­è¨€ç¼–å†™</p><p>2ã€é‡‡ç”¨å•çº¿ç¨‹ï¼Œé¿å…ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¯ç«äº‰æ¡ä»¶</p><p>3ã€ä½¿ç”¨å¤šè·¯I&#x2F;Oå¤ç”¨æ¨¡å‹ï¼Œéé˜»å¡IO</p><p>ä¾‹å¦‚ï¼šbgsave å’Œ bgrewriteaof  éƒ½æ˜¯åœ¨<strong>åå°</strong>æ‰§è¡Œæ“ä½œï¼Œä¸å½±å“ä¸»çº¿ç¨‹çš„æ­£å¸¸ä½¿ç”¨ï¼Œä¸ä¼šäº§ç”Ÿé˜»å¡</p><p><strong>é¢è¯•å®˜</strong>ï¼šèƒ½è§£é‡Šä¸€ä¸‹I&#x2F;Oå¤šè·¯å¤ç”¨æ¨¡å‹ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼šå—¯~~ï¼ŒI&#x2F;Oå¤šè·¯å¤ç”¨æ˜¯æŒ‡åˆ©ç”¨å•ä¸ªçº¿ç¨‹æ¥åŒæ—¶ç›‘å¬å¤šä¸ªSocket ï¼Œå¹¶åœ¨æŸä¸ªSocketå¯è¯»ã€å¯å†™æ—¶å¾—åˆ°é€šçŸ¥ï¼Œä»è€Œé¿å…æ— æ•ˆçš„ç­‰å¾…ï¼Œå……åˆ†åˆ©ç”¨CPUèµ„æºã€‚ç›®å‰çš„I&#x2F;Oå¤šè·¯å¤ç”¨éƒ½æ˜¯é‡‡ç”¨çš„epollæ¨¡å¼å®ç°ï¼Œå®ƒä¼šåœ¨é€šçŸ¥ç”¨æˆ·è¿›ç¨‹Socketå°±ç»ªçš„åŒæ—¶ï¼ŒæŠŠå·²å°±ç»ªçš„Socketå†™å…¥ç”¨æˆ·ç©ºé—´ï¼Œä¸éœ€è¦æŒ¨ä¸ªéå†Socketæ¥åˆ¤æ–­æ˜¯å¦å°±ç»ªï¼Œæå‡äº†æ€§èƒ½ã€‚</p><p>å…¶ä¸­Redisçš„ç½‘ç»œæ¨¡å‹å°±æ˜¯ä½¿ç”¨I&#x2F;Oå¤šè·¯å¤ç”¨ç»“åˆäº‹ä»¶çš„å¤„ç†å™¨æ¥åº”å¯¹å¤šä¸ªSocketè¯·æ±‚ï¼Œæ¯”å¦‚ï¼Œæä¾›äº†è¿æ¥åº”ç­”å¤„ç†å™¨ã€å‘½ä»¤å›å¤å¤„ç†å™¨ï¼Œå‘½ä»¤è¯·æ±‚å¤„ç†å™¨ï¼›</p><p>åœ¨Redis6.0ä¹‹åï¼Œä¸ºäº†æå‡æ›´å¥½çš„æ€§èƒ½ï¼Œåœ¨å‘½ä»¤å›å¤å¤„ç†å™¨ä½¿ç”¨äº†å¤šçº¿ç¨‹æ¥å¤„ç†å›å¤äº‹ä»¶ï¼Œåœ¨å‘½ä»¤è¯·æ±‚å¤„ç†å™¨ä¸­ï¼Œå°†å‘½ä»¤çš„è½¬æ¢ä½¿ç”¨äº†å¤šçº¿ç¨‹ï¼Œå¢åŠ å‘½ä»¤è½¬æ¢é€Ÿåº¦ï¼Œåœ¨å‘½ä»¤æ‰§è¡Œçš„æ—¶å€™ï¼Œä¾ç„¶æ˜¯å•çº¿ç¨‹</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaé›†åˆç›¸å…³é¢è¯•é¢˜</title>
      <link href="/2024/01/08/%E9%9D%A2%E8%AF%95-Java%E9%9B%86%E5%90%88%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
      <url>/2024/01/08/%E9%9D%A2%E8%AF%95-Java%E9%9B%86%E5%90%88%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æœ¬ç¯‡æ–‡ç« å–è‡ªé»‘é©¬ç¨‹åºå‘˜</p><h1 id="Javaé›†åˆç›¸å…³é¢è¯•é¢˜"><a href="#Javaé›†åˆç›¸å…³é¢è¯•é¢˜" class="headerlink" title="Javaé›†åˆç›¸å…³é¢è¯•é¢˜"></a>Javaé›†åˆç›¸å…³é¢è¯•é¢˜</h1><h2 id="çœŸå®é¢è¯•è¿˜åŸ"><a href="#çœŸå®é¢è¯•è¿˜åŸ" class="headerlink" title="çœŸå®é¢è¯•è¿˜åŸ"></a>çœŸå®é¢è¯•è¿˜åŸ</h2><h3 id="Javaå¸¸è§çš„é›†åˆç±»"><a href="#Javaå¸¸è§çš„é›†åˆç±»" class="headerlink" title="Javaå¸¸è§çš„é›†åˆç±»"></a>Javaå¸¸è§çš„é›†åˆç±»</h3><p><mark><strong>é¢è¯•å®˜</strong></mark>ï¼šè¯´ä¸€è¯´Javaæä¾›çš„å¸¸è§é›†åˆï¼Ÿï¼ˆç”»ä¸€ä¸‹é›†åˆç»“æ„å›¾ï¼‰</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯~~ï¼Œå¥½çš„ã€‚</p><p>åœ¨javaä¸­æä¾›äº†é‡å¤§ç±»çš„é›†åˆæ¡†æ¶ï¼Œä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼š</p><p>ç¬¬ä¸€ä¸ªæ˜¯Collection  å±äºå•åˆ—é›†åˆï¼Œç¬¬äºŒä¸ªæ˜¯Map  å±äºåŒåˆ—é›†åˆ</p><ul><li>åœ¨Collectionä¸­æœ‰ä¸¤ä¸ªå­æ¥å£Listå’ŒSetã€‚åœ¨æˆ‘ä»¬å¹³å¸¸å¼€å‘çš„è¿‡ç¨‹ä¸­ç”¨çš„æ¯”è¾ƒå¤šåƒlistæ¥å£ä¸­çš„å®ç°ç±»ArrarListå’ŒLinkedListã€‚  åœ¨Setæ¥å£ä¸­æœ‰å®ç°ç±»HashSetå’ŒTreeSetã€‚</li><li>åœ¨mapæ¥å£ä¸­æœ‰å¾ˆå¤šçš„å®ç°ç±»ï¼Œå¹³æ—¶æ¯”è¾ƒå¸¸è§çš„æ˜¯HashMapã€TreeMapï¼Œè¿˜æœ‰ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„map:ConcurrentHashMap</li></ul><h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><p><mark><strong>é¢è¯•å®˜</strong></mark>ï¼šArrayListåº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯~ï¼Œæˆ‘é˜…è¯»è¿‡arraylistçš„æºç ï¼Œæˆ‘ä¸»è¦è¯´ä¸€ä¸‹addæ–¹æ³•å§</p><p>ç¬¬ä¸€ï¼šç¡®ä¿æ•°ç»„å·²ä½¿ç”¨é•¿åº¦ï¼ˆsizeï¼‰åŠ 1ä¹‹åè¶³å¤Ÿå­˜ä¸‹ä¸‹ä¸€ä¸ªæ•°æ® </p><p>ç¬¬äºŒï¼šè®¡ç®—æ•°ç»„çš„å®¹é‡ï¼Œå¦‚æœå½“å‰æ•°ç»„å·²ä½¿ç”¨é•¿åº¦+1åçš„å¤§äºå½“å‰çš„æ•°ç»„é•¿åº¦ï¼Œåˆ™è°ƒç”¨growæ–¹æ³•æ‰©å®¹ï¼ˆåŸæ¥çš„1.5å€ï¼‰</p><p>ç¬¬ä¸‰ï¼šç¡®ä¿æ–°å¢çš„æ•°æ®æœ‰åœ°æ–¹å­˜å‚¨ä¹‹åï¼Œåˆ™å°†æ–°å…ƒç´ æ·»åŠ åˆ°ä½äºsizeçš„ä½ç½®ä¸Šã€‚ </p><p>ç¬¬å››ï¼šè¿”å›æ·»åŠ æˆåŠŸå¸ƒå°”å€¼ã€‚ </p><p><mark><strong>é¢è¯•å®˜</strong></mark>ï¼šArrayList list&#x3D;new ArrayList(10)ä¸­çš„listæ‰©å®¹å‡ æ¬¡</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>â€‹æ˜¯newäº†ä¸€ä¸ªArrarListå¹¶ä¸”ç»™äº†ä¸€ä¸ªæ„é€ å‚æ•°10ï¼Œå¯¹å§ï¼Ÿ(é—®é¢˜ä¸€å®šè¦é—®æ¸…æ¥šå†ç­”)</p><p><mark><strong>é¢è¯•å®˜</strong></mark>ï¼šæ˜¯çš„</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>â€‹    å¥½çš„ï¼Œåœ¨ArrayListçš„æºç ä¸­æä¾›äº†ä¸€ä¸ªå¸¦å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯æŒ‡å®šçš„é›†åˆåˆå§‹é•¿åº¦ï¼Œæ‰€ä»¥ç»™äº†ä¸€ä¸ª10çš„å‚æ•°ï¼Œå°±æ˜¯æŒ‡å®šäº†é›†åˆçš„åˆå§‹é•¿åº¦æ˜¯10ï¼Œè¿™é‡Œé¢å¹¶æ²¡æœ‰æ‰©å®¹ã€‚</p><hr><p><mark><strong>é¢è¯•å®˜</strong></mark>ï¼šå¦‚ä½•å®ç°æ•°ç»„å’ŒListä¹‹é—´çš„è½¬æ¢</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>â€‹å—¯ï¼Œè¿™ä¸ªåœ¨æˆ‘ä»¬å¹³æ—¶å¼€å‘å¾ˆå¸¸è§</p><p>â€‹    æ•°ç»„è½¬listï¼Œå¯ä»¥ä½¿ç”¨jdkè‡ªåŠ¨çš„ä¸€ä¸ªå·¥å…·ç±»Arrarsï¼Œé‡Œé¢æœ‰ä¸€ä¸ªasListæ–¹æ³•å¯ä»¥è½¬æ¢ä¸ºæ•°ç»„</p><p>â€‹    List è½¬æ•°ç»„ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨listä¸­çš„toArrayæ–¹æ³•ï¼Œéœ€è¦ç»™ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡å®šæ•°ç»„çš„ç±»å‹ï¼Œéœ€è¦æŒ‡å®šæ•°ç»„çš„é•¿åº¦ã€‚</p><p><mark><strong>é¢è¯•å®˜</strong></mark>ï¼šç”¨Arrays.asListè½¬Liståï¼Œå¦‚æœä¿®æ”¹äº†æ•°ç»„å†…å®¹ï¼Œlistå—å½±å“å—ï¼ŸListç”¨toArrayè½¬æ•°ç»„åï¼Œå¦‚æœä¿®æ”¹äº†Listå†…å®¹ï¼Œæ•°ç»„å—å½±å“å—</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>Arrays.asListè½¬æ¢listä¹‹åï¼Œå¦‚æœä¿®æ”¹äº†æ•°ç»„çš„å†…å®¹ï¼Œlistä¼šå—å½±å“ï¼Œå› ä¸ºå®ƒçš„åº•å±‚ä½¿ç”¨çš„Arraysç±»ä¸­çš„ä¸€ä¸ªå†…éƒ¨ç±»ArrayListæ¥æ„é€ çš„é›†åˆï¼Œåœ¨è¿™ä¸ªé›†åˆçš„æ„é€ å™¨ä¸­ï¼ŒæŠŠæˆ‘ä»¬ä¼ å…¥çš„è¿™ä¸ªé›†åˆè¿›è¡Œäº†åŒ…è£…è€Œå·²ï¼Œæœ€ç»ˆæŒ‡å‘çš„éƒ½æ˜¯åŒä¸€ä¸ªå†…å­˜åœ°å€</p><p>listç”¨äº†toArrayè½¬æ•°ç»„åï¼Œå¦‚æœä¿®æ”¹äº†listå†…å®¹ï¼Œæ•°ç»„ä¸ä¼šå½±å“ï¼Œå½“è°ƒç”¨äº†toArrayä»¥åï¼Œåœ¨åº•å±‚æ˜¯å®ƒæ˜¯è¿›è¡Œäº†æ•°ç»„çš„æ‹·è´ï¼Œè·ŸåŸæ¥çš„å…ƒç´ å°±æ²¡å•¥å…³ç³»äº†ï¼Œæ‰€ä»¥å³ä½¿listä¿®æ”¹äº†ä»¥åï¼Œæ•°ç»„ä¹Ÿä¸å—å½±å“</p><hr><p><mark><strong>é¢è¯•å®˜</strong></mark>ï¼šArrayList å’Œ LinkedList çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼Œå®ƒä»¬ä¸¤ä¸ªä¸»è¦æ˜¯åº•å±‚ä½¿ç”¨çš„æ•°æ®ç»“æ„ä¸ä¸€æ ·ï¼ŒArrayList æ˜¯åŠ¨æ€æ•°ç»„ï¼ŒLinkedList æ˜¯åŒå‘é“¾è¡¨ï¼Œè¿™ä¹Ÿå¯¼è‡´äº†å®ƒä»¬å¾ˆå¤šä¸åŒçš„ç‰¹ç‚¹ã€‚</p><p>1ï¼Œä»æ“ä½œæ•°æ®æ•ˆç‡æ¥è¯´</p><p>ArrayListæŒ‰ç…§ä¸‹æ ‡æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦O(1)ã€å†…å­˜æ˜¯è¿ç»­çš„ï¼Œæ ¹æ®å¯»å€å…¬å¼ã€‘ï¼Œ LinkedListä¸æ”¯æŒä¸‹æ ‡æŸ¥è¯¢</p><p>æŸ¥æ‰¾ï¼ˆæœªçŸ¥ç´¢å¼•ï¼‰ï¼š ArrayListéœ€è¦éå†ï¼Œé“¾è¡¨ä¹Ÿéœ€è¦é“¾è¡¨ï¼Œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(n)</p><p>æ–°å¢å’Œåˆ é™¤</p><ul><li>ArrayListå°¾éƒ¨æ’å…¥å’Œåˆ é™¤ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼›å…¶ä»–éƒ¨åˆ†å¢åˆ éœ€è¦æŒªåŠ¨æ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(n)</li><li>LinkedListå¤´å°¾èŠ‚ç‚¹å¢åˆ æ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼Œå…¶ä»–éƒ½éœ€è¦éå†é“¾è¡¨ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(n)</li></ul><p>2ï¼Œä»å†…å­˜ç©ºé—´å ç”¨æ¥è¯´</p><p>ArrayListåº•å±‚æ˜¯æ•°ç»„ï¼Œå†…å­˜è¿ç»­ï¼ŒèŠ‚çœå†…å­˜</p><p>LinkedList æ˜¯åŒå‘é“¾è¡¨éœ€è¦å­˜å‚¨æ•°æ®ï¼Œå’Œä¸¤ä¸ªæŒ‡é’ˆï¼Œæ›´å ç”¨å†…å­˜</p><p>3ï¼Œä»çº¿ç¨‹å®‰å…¨æ¥è¯´ï¼ŒArrayListå’ŒLinkedListéƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</p><p><mark><strong>é¢è¯•å®˜</strong></mark>ï¼šå—¯ï¼Œå¥½çš„ï¼Œåˆšæ‰ä½ è¯´äº†ArrayList å’Œ LinkedList ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½ ä»¬åœ¨é¡¹ç›®ä¸­æ˜¯å¦‚ä½•è§£å†³è¿™ä¸ªçš„çº¿ç¨‹å®‰å…¨é—®é¢˜çš„ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼Œæ˜¯è¿™æ ·çš„ï¼Œä¸»è¦æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p><p>ç¬¬ä¸€ï¼šæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªé›†åˆï¼Œä¼˜å…ˆåœ¨æ–¹æ³•å†…ä½¿ç”¨ï¼Œå®šä¹‰ä¸ºå±€éƒ¨å˜é‡ï¼Œè¿™æ ·çš„è¯ï¼Œå°±ä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p>ç¬¬äºŒï¼šå¦‚æœéè¦åœ¨æˆå‘˜å˜é‡ä¸­ä½¿ç”¨çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é›†åˆæ¥æ›¿ä»£</p><p>ArrayListå¯ä»¥é€šè¿‡Collections çš„ synchronizedList æ–¹æ³•å°† ArrayList è½¬æ¢æˆçº¿ç¨‹å®‰å…¨çš„å®¹å™¨åå†ä½¿ç”¨ã€‚</p><p>LinkedList æ¢æˆConcurrentLinkedQueueæ¥ä½¿ç”¨</p><h3 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h3><p><mark><strong>é¢è¯•å®˜</strong></mark>ï¼šè¯´ä¸€ä¸‹HashMapçš„å®ç°åŸç†ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>â€‹å—¯ã€‚å®ƒä¸»è¦åˆ†ä¸ºäº†ä¸€ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><p>1ï¼Œåº•å±‚ä½¿ç”¨hashè¡¨æ•°æ®ç»“æ„ï¼Œå³æ•°ç»„+ï¼ˆé“¾è¡¨ | çº¢é»‘æ ‘ï¼‰</p><p>2ï¼Œæ·»åŠ æ•°æ®æ—¶ï¼Œè®¡ç®—keyçš„å€¼ç¡®å®šå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡</p><p>â€‹keyç›¸åŒåˆ™æ›¿æ¢</p><p>â€‹ä¸åŒåˆ™å­˜å…¥é“¾è¡¨æˆ–çº¢é»‘æ ‘ä¸­</p><p>3ï¼Œè·å–æ•°æ®é€šè¿‡keyçš„hashè®¡ç®—æ•°ç»„ä¸‹æ ‡è·å–å…ƒç´ </p><p><mark><strong>é¢è¯•å®˜</strong></mark>ï¼šHashMapçš„jdk1.7å’Œjdk1.8æœ‰ä»€ä¹ˆåŒºåˆ«</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><ul><li><p>JDK1.8ä¹‹å‰é‡‡ç”¨çš„æ‹‰é“¾æ³•ï¼Œæ•°ç»„+é“¾è¡¨</p></li><li><p>JDK1.8ä¹‹åé‡‡ç”¨æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼Œé“¾è¡¨é•¿åº¦å¤§äº8ä¸”æ•°ç»„é•¿åº¦å¤§äº64åˆ™ä¼šä»é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘</p></li></ul><p><mark><strong>é¢è¯•å®˜</strong></mark>ï¼šå¥½çš„ï¼Œä½ èƒ½è¯´ä¸‹HashMapçš„putæ–¹æ³•çš„å…·ä½“æµç¨‹å—ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯å¥½çš„ã€‚</p><ol><li><p>åˆ¤æ–­é”®å€¼å¯¹æ•°ç»„tableæ˜¯å¦ä¸ºç©ºæˆ–ä¸ºnullï¼Œå¦åˆ™æ‰§è¡Œresize()è¿›è¡Œæ‰©å®¹ï¼ˆåˆå§‹åŒ–ï¼‰</p></li><li><p>æ ¹æ®é”®å€¼keyè®¡ç®—hashå€¼å¾—åˆ°æ•°ç»„ç´¢å¼•</p></li><li><p>åˆ¤æ–­table[i]&#x3D;&#x3D;nullï¼Œæ¡ä»¶æˆç«‹ï¼Œç›´æ¥æ–°å»ºèŠ‚ç‚¹æ·»åŠ </p></li><li><p>å¦‚æœtable[i]&#x3D;&#x3D;null ,ä¸æˆç«‹</p><p>4.1 åˆ¤æ–­table[i]çš„é¦–ä¸ªå…ƒç´ æ˜¯å¦å’Œkeyä¸€æ ·ï¼Œå¦‚æœç›¸åŒç›´æ¥è¦†ç›–value</p><p>4.2 åˆ¤æ–­table[i] æ˜¯å¦ä¸ºtreeNodeï¼Œå³table[i] æ˜¯å¦æ˜¯çº¢é»‘æ ‘ï¼Œå¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œåˆ™ç›´æ¥åœ¨æ ‘ä¸­æ’å…¥é”®å€¼å¯¹</p><p>4.3 éå†table[i]ï¼Œé“¾è¡¨çš„å°¾éƒ¨æ’å…¥æ•°æ®ï¼Œç„¶ååˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦å¤§äº8ï¼Œå¤§äº8çš„è¯æŠŠé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåœ¨çº¢é»‘æ ‘ä¸­æ‰§è¡Œæ’å…¥æ“ ä½œï¼Œéå†è¿‡ç¨‹ä¸­è‹¥å‘ç°keyå·²ç»å­˜åœ¨ç›´æ¥è¦†ç›–value</p></li><li><p>æ’å…¥æˆåŠŸåï¼Œåˆ¤æ–­å®é™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡sizeæ˜¯å¦è¶…å¤šäº†æœ€å¤§å®¹é‡thresholdï¼ˆæ•°ç»„é•¿åº¦*0.75ï¼‰ï¼Œå¦‚æœè¶…è¿‡ï¼Œè¿›è¡Œæ‰©å®¹ã€‚</p></li></ol><p><mark><strong>é¢è¯•å®˜</strong></mark>ï¼šå¥½çš„ï¼Œåˆšæ‰ä½ å¤šæ¬¡ä»‹ç»äº†hsahmapçš„æ‰©å®¹ï¼Œèƒ½è®²ä¸€è®²HashMapçš„æ‰©å®¹æœºåˆ¶å—ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å¥½çš„</p><ul><li><p>åœ¨æ·»åŠ å…ƒç´ æˆ–åˆå§‹åŒ–çš„æ—¶å€™éœ€è¦è°ƒç”¨resizeæ–¹æ³•è¿›è¡Œæ‰©å®¹ï¼Œç¬¬ä¸€æ¬¡æ·»åŠ æ•°æ®åˆå§‹åŒ–æ•°ç»„é•¿åº¦ä¸º16ï¼Œä»¥åæ¯æ¬¡æ¯æ¬¡æ‰©å®¹éƒ½æ˜¯è¾¾åˆ°äº†æ‰©å®¹é˜ˆå€¼ï¼ˆæ•°ç»„é•¿åº¦ * 0.75ï¼‰</p></li><li><p>æ¯æ¬¡æ‰©å®¹çš„æ—¶å€™ï¼Œéƒ½æ˜¯æ‰©å®¹ä¹‹å‰å®¹é‡çš„2å€ï¼› </p></li><li><p>æ‰©å®¹ä¹‹åï¼Œä¼šæ–°åˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œéœ€è¦æŠŠè€æ•°ç»„ä¸­çš„æ•°æ®æŒªåŠ¨åˆ°æ–°çš„æ•°ç»„ä¸­</p><ul><li>æ²¡æœ‰hashå†²çªçš„èŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ e.hash &amp; (newCap - 1) è®¡ç®—æ–°æ•°ç»„çš„ç´¢å¼•ä½ç½®</li><li>å¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œèµ°çº¢é»‘æ ‘çš„æ·»åŠ </li><li>å¦‚æœæ˜¯é“¾è¡¨ï¼Œåˆ™éœ€è¦éå†é“¾è¡¨ï¼Œå¯èƒ½éœ€è¦æ‹†åˆ†é“¾è¡¨ï¼Œåˆ¤æ–­(e.hash &amp; oldCap)æ˜¯å¦ä¸º0ï¼Œè¯¥å…ƒç´ çš„ä½ç½®è¦ä¹ˆåœç•™åœ¨åŸå§‹ä½ç½®ï¼Œè¦ä¹ˆç§»åŠ¨åˆ°åŸå§‹ä½ç½®+å¢åŠ çš„æ•°ç»„å¤§å°è¿™ä¸ªä½ç½®ä¸Š</li></ul></li></ul><p><mark><strong>é¢è¯•å®˜</strong></mark>ï¼šå¥½çš„ï¼Œåˆšæ‰ä½ è¯´çš„é€šè¿‡hashè®¡ç®—åæ‰¾åˆ°æ•°ç»„çš„ä¸‹æ ‡ï¼Œæ˜¯å¦‚ä½•æ‰¾åˆ°çš„å‘¢ï¼Œä½ äº†è§£hashMapçš„å¯»å€ç®—æ³•å—ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>è¿™ä¸ªå“ˆå¸Œæ–¹æ³•é¦–å…ˆè®¡ç®—å‡ºkeyçš„hashCodeå€¼ï¼Œç„¶åé€šè¿‡è¿™ä¸ªhashå€¼å³ç§»16ä½åçš„äºŒè¿›åˆ¶è¿›è¡ŒæŒ‰ä½<strong>å¼‚æˆ–è¿ç®—</strong>å¾—åˆ°æœ€åçš„hashå€¼ã€‚</p><p>åœ¨putValueçš„æ–¹æ³•ä¸­ï¼Œè®¡ç®—æ•°ç»„ä¸‹æ ‡çš„æ—¶å€™ä½¿ç”¨hashå€¼ä¸æ•°ç»„é•¿åº¦å–æ¨¡å¾—åˆ°å­˜å‚¨æ•°æ®ä¸‹æ ‡çš„ä½ç½®ï¼Œhashmapä¸ºäº†æ€§èƒ½æ›´å¥½ï¼Œå¹¶æ²¡æœ‰ç›´æ¥é‡‡ç”¨å–æ¨¡çš„æ–¹å¼ï¼Œè€Œæ˜¯ä½¿ç”¨äº†æ•°ç»„é•¿åº¦-1 å¾—åˆ°ä¸€ä¸ªå€¼ï¼Œç”¨è¿™ä¸ªå€¼æŒ‰ä½ä¸è¿ç®—hashå€¼ï¼Œæœ€ç»ˆå¾—åˆ°æ•°ç»„çš„ä½ç½®ã€‚</p><p><mark><strong>é¢è¯•å®˜</strong></mark>ï¼šä¸ºä½•HashMapçš„æ•°ç»„é•¿åº¦ä¸€å®šæ˜¯2çš„æ¬¡å¹‚ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼Œå¥½çš„ã€‚hashmapè¿™ä¹ˆè®¾è®¡ä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼š</p><p>ç¬¬ä¸€ï¼š</p><p>è®¡ç®—ç´¢å¼•æ—¶æ•ˆç‡æ›´é«˜ï¼šå¦‚æœæ˜¯ 2 çš„ n æ¬¡å¹‚å¯ä»¥ä½¿ç”¨ä½ä¸è¿ç®—ä»£æ›¿å–æ¨¡</p><p>ç¬¬äºŒï¼š</p><p>æ‰©å®¹æ—¶é‡æ–°è®¡ç®—ç´¢å¼•æ•ˆç‡æ›´é«˜ï¼šåœ¨è¿›è¡Œæ‰©å®¹æ˜¯ä¼šè¿›è¡Œåˆ¤æ–­ hashå€¼æŒ‰ä½ä¸è¿ç®—æ—§æ•°ç»„é•¿ç§Ÿæ˜¯å¦ &#x3D;&#x3D; 0 </p><p>å¦‚æœç­‰äº0ï¼Œåˆ™æŠŠå…ƒç´ ç•™åœ¨åŸæ¥ä½ç½® ï¼Œå¦åˆ™æ–°ä½ç½®æ˜¯ç­‰äºæ—§ä½ç½®çš„ä¸‹æ ‡+æ—§æ•°ç»„é•¿åº¦</p><p><mark><strong>é¢è¯•å®˜</strong></mark>ï¼šå¥½çš„ï¼Œæˆ‘çœ‹ä½ å¯¹hashmapäº†è§£çš„æŒºæ·±å…¥çš„ï¼Œä½ çŸ¥é“hashmapåœ¨1.7æƒ…å†µä¸‹çš„å¤šçº¿ç¨‹æ­»å¾ªç¯é—®é¢˜å—ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼ŒçŸ¥é“çš„ã€‚æ˜¯è¿™æ ·</p><p>jdk7çš„çš„æ•°æ®ç»“æ„æ˜¯ï¼šæ•°ç»„+é“¾è¡¨</p><p>åœ¨æ•°ç»„è¿›è¡Œæ‰©å®¹çš„æ—¶å€™ï¼Œå› ä¸ºé“¾è¡¨æ˜¯<strong>å¤´æ’æ³•</strong>ï¼Œåœ¨è¿›è¡Œæ•°æ®è¿ç§»çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½å¯¼è‡´æ­»å¾ªç¯</p><p>æ¯”å¦‚è¯´ï¼Œç°åœ¨æœ‰ä¸¤ä¸ªçº¿ç¨‹</p><p>çº¿ç¨‹ä¸€ï¼š<strong>è¯»å–</strong>åˆ°å½“å‰çš„hashmapæ•°æ®ï¼Œæ•°æ®ä¸­ä¸€ä¸ªé“¾è¡¨ï¼Œåœ¨å‡†å¤‡æ‰©å®¹æ—¶ï¼Œçº¿ç¨‹äºŒä»‹å…¥</p><p>çº¿ç¨‹äºŒä¹Ÿè¯»å–hashmapï¼Œç›´æ¥è¿›è¡Œæ‰©å®¹ã€‚å› ä¸ºæ˜¯å¤´æ’æ³•ï¼Œé“¾è¡¨çš„é¡ºåºä¼šè¿›è¡Œé¢ å€’è¿‡æ¥ã€‚æ¯”å¦‚åŸæ¥çš„é¡ºåºæ˜¯ABï¼Œæ‰©å®¹åçš„é¡ºåºæ˜¯BAï¼Œçº¿ç¨‹äºŒæ‰§è¡Œç»“æŸã€‚</p><p>å½“çº¿ç¨‹ä¸€å†ç»§ç»­æ‰§è¡Œçš„æ—¶å€™å°±ä¼šå‡ºç°æ­»å¾ªç¯çš„é—®é¢˜ã€‚</p><p>çº¿ç¨‹ä¸€å…ˆå°†Aç§»å…¥æ–°çš„é“¾è¡¨ï¼Œå†å°†Bæ’å…¥åˆ°é“¾å¤´ï¼Œç”±äºå¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„åŸå› ï¼ŒBçš„nextæŒ‡å‘äº†Aï¼Œæ‰€ä»¥B-A-B,å½¢æˆå¾ªç¯ã€‚</p><p>å½“ç„¶ï¼ŒJDK 8 å°†æ‰©å®¹ç®—æ³•åšäº†è°ƒæ•´ï¼Œä¸å†å°†å…ƒç´ åŠ å…¥é“¾è¡¨å¤´ï¼ˆè€Œæ˜¯ä¿æŒä¸æ‰©å®¹å‰ä¸€æ ·çš„é¡ºåºï¼‰ï¼Œ<strong>å°¾æ’æ³•</strong>ï¼Œå°±é¿å…äº†jdk7ä¸­æ­»å¾ªç¯çš„é—®é¢˜ã€‚</p><p><mark><strong>é¢è¯•å®˜</strong></mark>ï¼šå¥½çš„ï¼Œhashmapæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼šä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</p><p><mark><strong>é¢è¯•å®˜</strong></mark>ï¼šé‚£æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„mapè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼šæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ConcurrentHashMapè¿›è¡Œä½¿ç”¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„HashMap</p><p><mark><strong>é¢è¯•å®˜</strong></mark>ï¼šé‚£ä½ èƒ½èŠä¸€ä¸‹ConcurrentHashMapçš„åŸç†å—ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼šå¥½çš„ï¼Œè¯·å‚è€ƒã€Šå¤šçº¿ç¨‹ç›¸å…³é¢è¯•é¢˜ã€‹ä¸­çš„ConcurrentHashMapéƒ¨åˆ†çš„è®²è§£</p><hr><p><mark><strong>é¢è¯•å®˜</strong></mark>ï¼šHashSetä¸HashMapçš„åŒºåˆ«ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼šå—¯ï¼Œæ˜¯è¿™æ ·ã€‚</p><p>HashSetåº•å±‚å…¶å®æ˜¯ç”¨HashMapå®ç°å­˜å‚¨çš„, HashSetå°è£…äº†ä¸€ç³»åˆ—HashMapçš„æ–¹æ³•. ä¾é HashMapæ¥å­˜å‚¨å…ƒç´ å€¼,(åˆ©ç”¨hashMapçš„keyé”®è¿›è¡Œå­˜å‚¨), è€Œvalueå€¼é»˜è®¤ä¸ºObjectå¯¹è±¡. æ‰€ä»¥HashSetä¹Ÿä¸å…è®¸å‡ºç°é‡å¤å€¼, åˆ¤æ–­æ ‡å‡†å’ŒHashMapåˆ¤æ–­æ ‡å‡†ç›¸åŒ, ä¸¤ä¸ªå…ƒç´ çš„hashCodeç›¸ç­‰å¹¶ä¸”é€šè¿‡equals()æ–¹æ³•è¿”å›true.</p><p><mark><strong>é¢è¯•å®˜</strong></mark>ï¼šHashTableä¸HashMapçš„åŒºåˆ«</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼Œä»–ä»¬çš„ä¸»è¦åŒºåˆ«æ˜¯æœ‰å‡ ä¸ªå§</p><p>ç¬¬ä¸€ï¼Œæ•°æ®ç»“æ„ä¸ä¸€æ ·ï¼Œhashtableæ˜¯æ•°ç»„+é“¾è¡¨ï¼Œhashmapåœ¨1.8ä¹‹åæ”¹ä¸ºäº†æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘</p><p>ç¬¬äºŒï¼Œhashtableå­˜å‚¨æ•°æ®çš„æ—¶å€™éƒ½ä¸èƒ½ä¸ºnullï¼Œè€Œhashmapæ˜¯å¯ä»¥çš„</p><p>ç¬¬ä¸‰ï¼Œhashç®—æ³•ä¸åŒï¼Œhashtableæ˜¯ç”¨æœ¬åœ°ä¿®é¥°çš„hashcodeå€¼ï¼Œè€Œhashmapç»å¸¸äº†äºŒæ¬¡hash</p><p>ç¬¬å››ï¼Œæ‰©å®¹æ–¹å¼ä¸åŒï¼Œhashtableæ˜¯å½“å‰å®¹é‡ç¿»å€+1ï¼Œhashmapæ˜¯å½“å‰å®¹é‡ç¿»å€</p><p>ç¬¬äº”ï¼Œhashtableæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ“ä½œæ•°æ®çš„æ—¶å€™åŠ äº†é”synchronizedï¼Œhashmapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ•ˆç‡æ›´é«˜ä¸€äº›</p><p>åœ¨å®é™…å¼€ä¸­ä¸å»ºè®®ä½¿ç”¨HashTableï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯ä»¥ä½¿ç”¨ConcurrentHashMapç±»</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaé›†åˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤šçº¿ç¨‹ç›¸å…³é¢è¯•é¢˜</title>
      <link href="/2024/01/06/%E9%9D%A2%E8%AF%95-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
      <url>/2024/01/06/%E9%9D%A2%E8%AF%95-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æœ¬ç¯‡æ–‡ç« å–è‡ªé»‘é©¬ç¨‹åºå‘˜ï¼Œä»…ä¾›å­¦ä¹ ä½¿ç”¨</p><h1 id="Javaå¤šçº¿ç¨‹ç›¸å…³é¢è¯•é¢˜"><a href="#Javaå¤šçº¿ç¨‹ç›¸å…³é¢è¯•é¢˜" class="headerlink" title="Javaå¤šçº¿ç¨‹ç›¸å…³é¢è¯•é¢˜"></a>Javaå¤šçº¿ç¨‹ç›¸å…³é¢è¯•é¢˜</h1><h2 id="1-çº¿ç¨‹çš„åŸºç¡€çŸ¥è¯†"><a href="#1-çº¿ç¨‹çš„åŸºç¡€çŸ¥è¯†" class="headerlink" title="1.çº¿ç¨‹çš„åŸºç¡€çŸ¥è¯†"></a>1.çº¿ç¨‹çš„åŸºç¡€çŸ¥è¯†</h2><h3 id="1-1-çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ"><a href="#1-1-çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="1.1 çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ"></a>1.1 çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><p>ç¨‹åºç”±æŒ‡ä»¤å’Œæ•°æ®ç»„æˆï¼Œä½†è¿™äº›æŒ‡ä»¤è¦è¿è¡Œï¼Œæ•°æ®è¦è¯»å†™ï¼Œå°±å¿…é¡»å°†æŒ‡ä»¤åŠ è½½è‡³ CPUï¼Œæ•°æ®åŠ è½½è‡³å†…å­˜ã€‚åœ¨æŒ‡ä»¤è¿è¡Œè¿‡ç¨‹ä¸­è¿˜éœ€è¦ç”¨åˆ°ç£ç›˜ã€ç½‘ç»œç­‰è®¾å¤‡ã€‚è¿›ç¨‹å°±æ˜¯ç”¨æ¥åŠ è½½æŒ‡ä»¤ã€ç®¡ç†å†…å­˜ã€ç®¡ç† IO çš„ã€‚</p><p><strong>å½“ä¸€ä¸ªç¨‹åºè¢«è¿è¡Œï¼Œä»ç£ç›˜åŠ è½½è¿™ä¸ªç¨‹åºçš„ä»£ç è‡³å†…å­˜ï¼Œè¿™æ—¶å°±å¼€å¯äº†ä¸€ä¸ªè¿›ç¨‹ã€‚</strong></p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20221026105350827.png" alt="image-20221026105350827"></p><p>ä¸€ä¸ªè¿›ç¨‹ä¹‹å†…å¯ä»¥åˆ†ä¸ºä¸€åˆ°å¤šä¸ªçº¿ç¨‹ã€‚</p><p>ä¸€ä¸ªçº¿ç¨‹å°±æ˜¯ä¸€ä¸ªæŒ‡ä»¤æµï¼Œå°†æŒ‡ä»¤æµä¸­çš„ä¸€æ¡æ¡æŒ‡ä»¤ä»¥ä¸€å®šçš„é¡ºåºäº¤ç»™ CPU æ‰§è¡Œ</p><p>Java ä¸­ï¼Œçº¿ç¨‹ä½œä¸ºæœ€å°è°ƒåº¦å•ä½ï¼Œè¿›ç¨‹ä½œä¸ºèµ„æºåˆ†é…çš„æœ€å°å•ä½ã€‚åœ¨ windows ä¸­è¿›ç¨‹æ˜¯ä¸æ´»åŠ¨çš„ï¼Œåªæ˜¯ä½œä¸ºçº¿ç¨‹çš„å®¹å™¨</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20221026105442158.png" alt="image-20221026105442158"></p><p><strong>äºŒè€…å¯¹æ¯”</strong></p><ul><li><mark>è¿›ç¨‹æ˜¯æ­£åœ¨è¿è¡Œç¨‹åºçš„å®ä¾‹ï¼Œè¿›ç¨‹ä¸­åŒ…å«äº†çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œä¸åŒçš„ä»»åŠ¡</mark></li><li><mark>ä¸åŒçš„è¿›ç¨‹ä½¿ç”¨ä¸åŒçš„å†…å­˜ç©ºé—´ï¼Œåœ¨å½“å‰è¿›ç¨‹ä¸‹çš„æ‰€æœ‰çº¿ç¨‹å¯ä»¥å…±äº«å†…å­˜ç©ºé—´</mark></li><li><mark>çº¿ç¨‹æ›´è½»é‡ï¼Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ä¸€èˆ¬ä¸Šè¦æ¯”è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä½(ä¸Šä¸‹æ–‡åˆ‡æ¢æŒ‡çš„æ˜¯ä»ä¸€ä¸ªçº¿ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹)</mark></li></ul><h3 id="1-2-å¹¶è¡Œå’Œå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#1-2-å¹¶è¡Œå’Œå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="1.2 å¹¶è¡Œå’Œå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>1.2 å¹¶è¡Œå’Œå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†</p></blockquote><p>å•æ ¸CPU</p><ul><li><p>å•æ ¸CPUä¸‹çº¿ç¨‹å®é™…è¿˜æ˜¯ä¸²è¡Œæ‰§è¡Œçš„</p></li><li><p>æ“ä½œç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªç»„ä»¶å«åšä»»åŠ¡è°ƒåº¦å™¨ï¼Œå°†cpuçš„æ—¶é—´ç‰‡ï¼ˆwindowsä¸‹æ—¶é—´ç‰‡æœ€å°çº¦ä¸º 15 æ¯«ç§’ï¼‰åˆ†ç»™ä¸åŒçš„ç¨‹åºä½¿ç”¨ï¼Œåªæ˜¯ç”±äºcpuåœ¨çº¿ç¨‹é—´ï¼ˆæ—¶é—´ç‰‡å¾ˆçŸ­ï¼‰çš„åˆ‡æ¢éå¸¸å¿«ï¼Œäººç±»æ„Ÿè§‰æ˜¯åŒæ—¶è¿è¡Œçš„ ã€‚</p></li><li><p>æ€»ç»“ä¸ºä¸€å¥è¯å°±æ˜¯ï¼š å¾®è§‚ä¸²è¡Œï¼Œå®è§‚å¹¶è¡Œ</p></li></ul><p>ä¸€èˆ¬ä¼šå°†è¿™ç§çº¿ç¨‹è½®æµä½¿ç”¨CPUçš„åšæ³•ç§°ä¸ºå¹¶å‘ï¼ˆconcurrentï¼‰</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230503203246348.png" alt="image-20230503203246348"></p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20221026105607248.png" alt="image-20221026105607248"></p><p>å¤šæ ¸CPU</p><p>æ¯ä¸ªæ ¸ï¼ˆcoreï¼‰éƒ½å¯ä»¥è°ƒåº¦è¿è¡Œçº¿ç¨‹ï¼Œè¿™æ—¶å€™çº¿ç¨‹å¯ä»¥æ˜¯å¹¶è¡Œçš„ã€‚</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230503203330700.png" alt="image-20230503203330700"></p><p><mark><strong>å¹¶å‘ï¼ˆconcurrentï¼‰æ˜¯åŒä¸€æ—¶é—´åº”å¯¹ï¼ˆdealing withï¼‰å¤šä»¶äº‹æƒ…çš„èƒ½åŠ›</strong></mark></p><p><mark><strong>å¹¶è¡Œï¼ˆparallelï¼‰æ˜¯åŒä¸€æ—¶é—´åŠ¨æ‰‹åšï¼ˆdoingï¼‰å¤šä»¶äº‹æƒ…çš„èƒ½åŠ›</strong></mark></p><blockquote><p>ä¸¾ä¾‹ï¼š</p><ul><li><p>å®¶åº­ä¸»å¦‡åšé¥­ã€æ‰“æ‰«å«ç”Ÿã€ç»™å­©å­å–‚å¥¶ï¼Œå¥¹ä¸€ä¸ªäººè½®æµäº¤æ›¿åšè¿™å¤šä»¶äº‹ï¼Œè¿™æ—¶å°±æ˜¯å¹¶å‘</p></li><li><p>å®¶åº­ä¸»å¦‡é›‡äº†ä¸ªä¿å§†ï¼Œå¥¹ä»¬ä¸€èµ·è¿™äº›äº‹ï¼Œè¿™æ—¶æ—¢æœ‰å¹¶å‘ï¼Œä¹Ÿæœ‰å¹¶è¡Œï¼ˆè¿™æ—¶ä¼šäº§ç”Ÿç«äº‰ï¼Œä¾‹å¦‚é”…åªæœ‰ä¸€å£ï¼Œä¸€ä¸ªäººç”¨é”…æ—¶ï¼Œå¦ä¸€ä¸ªäººå°±å¾—ç­‰å¾…ï¼‰</p></li><li><p>é›‡äº†3ä¸ªä¿å§†ï¼Œä¸€ä¸ªä¸“åšé¥­ã€ä¸€ä¸ªä¸“æ‰“æ‰«å«ç”Ÿã€ä¸€ä¸ªä¸“å–‚å¥¶ï¼Œäº’ä¸å¹²æ‰°ï¼Œè¿™æ—¶æ˜¯å¹¶è¡Œ</p></li></ul></blockquote><h3 id="1-3-åˆ›å»ºçº¿ç¨‹çš„å››ç§æ–¹å¼"><a href="#1-3-åˆ›å»ºçº¿ç¨‹çš„å››ç§æ–¹å¼" class="headerlink" title="1.3 åˆ›å»ºçº¿ç¨‹çš„å››ç§æ–¹å¼"></a>1.3 åˆ›å»ºçº¿ç¨‹çš„å››ç§æ–¹å¼</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><p>å‚è€ƒå›ç­”ï¼š</p><p>å…±æœ‰å››ç§æ–¹å¼å¯ä»¥åˆ›å»ºçº¿ç¨‹ï¼Œåˆ†åˆ«æ˜¯ï¼šç»§æ‰¿Threadç±»ã€å®ç°runnableæ¥å£ã€å®ç°Callableæ¥å£ã€çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹</p><p>è¯¦ç»†åˆ›å»ºæ–¹å¼å‚è€ƒä¸‹é¢ä»£ç ï¼š</p><p>â‘  <strong>ç»§æ‰¿Threadç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyThread...run...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºMyThreadå¯¹è±¡</span></span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>() ;</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>() ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨startæ–¹æ³•å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â‘¡ <strong>å®ç°runnableæ¥å£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyRunnable...run...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºMyRunnableå¯¹è±¡</span></span><br><span class="line">        <span class="type">MyRunnable</span> <span class="variable">mr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyRunnable</span>() ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºThreadå¯¹è±¡</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(mr) ;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(mr) ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨startæ–¹æ³•å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â‘¢ <strong>å®ç°Callableæ¥å£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCallable</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyCallable...call...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;OK&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºMyCallableå¯¹è±¡</span></span><br><span class="line">        <span class="type">MyCallable</span> <span class="variable">mc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyCallable</span>() ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºF</span></span><br><span class="line">        FutureTask&lt;String&gt; ft = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;String&gt;(mc) ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºThreadå¯¹è±¡</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(ft) ;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(ft) ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨startæ–¹æ³•å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨ftçš„getæ–¹æ³•è·å–æ‰§è¡Œç»“æœ</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> ft.get();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¾“å‡º</span></span><br><span class="line">        System.out.println(result);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â‘£ <strong>çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyExecutors</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyRunnable...run...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºçº¿ç¨‹æ± å¯¹è±¡</span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line">        threadPool.submit(<span class="keyword">new</span> <span class="title class_">MyExecutors</span>()) ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">        threadPool.shutdown();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-4-runnable-å’Œ-callable-æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#1-4-runnable-å’Œ-callable-æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="1.4 runnable å’Œ callable æœ‰ä»€ä¹ˆåŒºåˆ«"></a>1.4 runnable å’Œ callable æœ‰ä»€ä¹ˆåŒºåˆ«</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><p>å‚è€ƒå›ç­”ï¼š</p><ol><li>Runnable æ¥å£runæ–¹æ³•<mark>æ²¡æœ‰è¿”å›å€¼</mark>ï¼›Callableæ¥å£callæ–¹æ³•<mark>æœ‰è¿”å›å€¼</mark>ï¼Œæ˜¯ä¸ªæ³›å‹ï¼Œå’ŒFutureã€FutureTaské…åˆå¯ä»¥ç”¨æ¥<mark>è·å–å¼‚æ­¥æ‰§è¡Œçš„ç»“æœ</mark></li><li>Callalbeæ¥å£æ”¯æŒè¿”å›æ‰§è¡Œç»“æœï¼Œéœ€è¦è°ƒç”¨FutureTask.get()å¾—åˆ°ï¼Œæ­¤æ–¹æ³•ä¼šé˜»å¡ä¸»è¿›ç¨‹çš„ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œå¦‚æœä¸è°ƒç”¨ä¸ä¼šé˜»å¡ã€‚</li><li>Callableæ¥å£çš„call()æ–¹æ³•<mark>å…è®¸æŠ›å‡ºå¼‚å¸¸</mark>ï¼›è€ŒRunnableæ¥å£çš„run()æ–¹æ³•çš„<mark>å¼‚å¸¸åªèƒ½åœ¨å†…éƒ¨æ¶ˆåŒ–</mark>ï¼Œä¸èƒ½ç»§ç»­ä¸ŠæŠ›</li></ol><h3 id="1-5-çº¿ç¨‹çš„-run-å’Œ-start-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#1-5-çº¿ç¨‹çš„-run-å’Œ-start-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="1.5 çº¿ç¨‹çš„ run()å’Œ start()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>1.5 çº¿ç¨‹çš„ run()å’Œ start()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†</p></blockquote><p>start(): <mark>ç”¨æ¥å¯åŠ¨çº¿ç¨‹</mark>ï¼Œé€šè¿‡è¯¥çº¿ç¨‹è°ƒç”¨runæ–¹æ³•æ‰§è¡Œrunæ–¹æ³•ä¸­æ‰€å®šä¹‰çš„é€»è¾‘ä»£ç ã€‚<mark>startæ–¹æ³•åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡</mark>ã€‚</p><p>run(): å°è£…äº†è¦è¢«çº¿ç¨‹æ‰§è¡Œçš„ä»£ç ï¼Œ<mark>å¯ä»¥è¢«è°ƒç”¨å¤šæ¬¡</mark>ã€‚</p><h3 id="1-6-çº¿ç¨‹åŒ…æ‹¬å“ªäº›çŠ¶æ€ï¼ŒçŠ¶æ€ä¹‹é—´æ˜¯å¦‚ä½•å˜åŒ–çš„"><a href="#1-6-çº¿ç¨‹åŒ…æ‹¬å“ªäº›çŠ¶æ€ï¼ŒçŠ¶æ€ä¹‹é—´æ˜¯å¦‚ä½•å˜åŒ–çš„" class="headerlink" title="1.6 çº¿ç¨‹åŒ…æ‹¬å“ªäº›çŠ¶æ€ï¼ŒçŠ¶æ€ä¹‹é—´æ˜¯å¦‚ä½•å˜åŒ–çš„"></a>1.6 çº¿ç¨‹åŒ…æ‹¬å“ªäº›çŠ¶æ€ï¼ŒçŠ¶æ€ä¹‹é—´æ˜¯å¦‚ä½•å˜åŒ–çš„</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><p>çº¿ç¨‹çš„çŠ¶æ€å¯ä»¥å‚è€ƒJDKä¸­çš„Threadç±»ä¸­çš„æšä¸¾State</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">State</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å°šæœªå¯åŠ¨çš„çº¿ç¨‹çš„çº¿ç¨‹çŠ¶æ€</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        NEW,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å¯è¿è¡Œçº¿ç¨‹çš„çº¿ç¨‹çŠ¶æ€ã€‚å¤„äºå¯è¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹æ­£åœ¨ Java è™šæ‹Ÿæœºä¸­æ‰§è¡Œï¼Œä½†å®ƒå¯èƒ½æ­£åœ¨ç­‰å¾…æ¥è‡ª * æ“ä½œç³»ç»Ÿçš„å…¶ä»–èµ„æºï¼Œä¾‹å¦‚å¤„ç†å™¨ã€‚</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        RUNNABLE,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * çº¿ç¨‹é˜»å¡ç­‰å¾…ç›‘è§†å™¨é”çš„çº¿ç¨‹çŠ¶æ€ã€‚å¤„äºé˜»å¡çŠ¶æ€çš„çº¿ç¨‹æ­£åœ¨ç­‰å¾…ç›‘è§†å™¨é”è¿›å…¥åŒæ­¥å—/æ–¹æ³•æˆ–åœ¨è°ƒ          * ç”¨Object.waitåé‡æ–°è¿›å…¥åŒæ­¥å—/æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        BLOCKED,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ç­‰å¾…çº¿ç¨‹çš„çº¿ç¨‹çŠ¶æ€ã€‚ç”±äºè°ƒç”¨ä»¥ä¸‹æ–¹æ³•ä¹‹ä¸€ï¼Œçº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ï¼š</span></span><br><span class="line"><span class="comment">* Object.waitæ²¡æœ‰è¶…æ—¶</span></span><br><span class="line"><span class="comment">         * æ²¡æœ‰è¶…æ—¶çš„Thread.join</span></span><br><span class="line"><span class="comment">         * LockSupport.park</span></span><br><span class="line"><span class="comment">         * å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹æ­£åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç‰¹å®šæ“ä½œã€‚</span></span><br><span class="line"><span class="comment">         * ä¾‹å¦‚ï¼Œä¸€ä¸ªå¯¹å¯¹è±¡è°ƒç”¨Object.wait()çš„çº¿ç¨‹æ­£åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹å¯¹è¯¥å¯¹è±¡è°ƒç”¨Object.notify()* æˆ–Object.notifyAll() ã€‚å·²è°ƒç”¨Thread.join()çš„çº¿ç¨‹æ­£åœ¨ç­‰å¾…æŒ‡å®šçº¿ç¨‹ç»ˆæ­¢ã€‚</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        WAITING,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å…·æœ‰æŒ‡å®šç­‰å¾…æ—¶é—´çš„ç­‰å¾…çº¿ç¨‹çš„çº¿ç¨‹çŠ¶æ€ã€‚ç”±äºä»¥æŒ‡å®šçš„æ­£ç­‰å¾…æ—¶é—´è°ƒç”¨ä»¥ä¸‹æ–¹æ³•ä¹‹ä¸€ï¼Œçº¿ç¨‹å¤„äºå®š          * æ—¶ç­‰å¾…çŠ¶æ€ï¼š</span></span><br><span class="line"><span class="comment">* Thread.sleep</span></span><br><span class="line"><span class="comment">* Object.waitè¶…æ—¶</span></span><br><span class="line"><span class="comment">* Thread.joinè¶…æ—¶</span></span><br><span class="line"><span class="comment">* LockSupport.parkNanos</span></span><br><span class="line"><span class="comment">* LockSupport.parkUntil</span></span><br><span class="line"><span class="comment">         * &lt;/ul&gt;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        TIMED_WAITING,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å·²ç»ˆæ­¢çº¿ç¨‹çš„çº¿ç¨‹çŠ¶æ€ã€‚çº¿ç¨‹å·²å®Œæˆæ‰§è¡Œ</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        TERMINATED;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>çŠ¶æ€ä¹‹é—´æ˜¯å¦‚ä½•å˜åŒ–çš„</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230503203629212.png" alt="image-20230503203629212"></p><p>åˆ†åˆ«æ˜¯</p><ul><li><mark>æ–°å»º</mark><ul><li>å½“ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡è¢«åˆ›å»ºï¼Œä½†è¿˜æœªè°ƒç”¨ start æ–¹æ³•æ—¶å¤„äº<strong>æ–°å»º</strong>çŠ¶æ€</li><li>æ­¤æ—¶æœªä¸æ“ä½œç³»ç»Ÿåº•å±‚çº¿ç¨‹å…³è”</li></ul></li><li><mark>å¯è¿è¡Œ</mark><ul><li>è°ƒç”¨äº† start æ–¹æ³•ï¼Œå°±ä¼šç”±<strong>æ–°å»º</strong>è¿›å…¥<strong>å¯è¿è¡Œ</strong></li><li>æ­¤æ—¶ä¸åº•å±‚çº¿ç¨‹å…³è”ï¼Œç”±æ“ä½œç³»ç»Ÿè°ƒåº¦æ‰§è¡Œ</li></ul></li><li><mark>ç»ˆç»“</mark><ul><li>çº¿ç¨‹å†…ä»£ç å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œç”±<strong>å¯è¿è¡Œ</strong>è¿›å…¥<strong>ç»ˆç»“</strong></li><li>æ­¤æ—¶ä¼šå–æ¶ˆä¸åº•å±‚çº¿ç¨‹å…³è”</li></ul></li><li><mark>é˜»å¡</mark><ul><li>å½“<mark>è·å–é”å¤±è´¥å</mark>ï¼Œç”±<strong>å¯è¿è¡Œ</strong>è¿›å…¥ Monitor çš„é˜»å¡é˜Ÿåˆ—<strong>é˜»å¡</strong>ï¼Œæ­¤æ—¶ä¸å ç”¨ cpu æ—¶é—´</li><li>å½“æŒé”çº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼Œä¼šæŒ‰ç…§ä¸€å®šè§„åˆ™å”¤é†’é˜»å¡é˜Ÿåˆ—ä¸­çš„<strong>é˜»å¡</strong>çº¿ç¨‹ï¼Œå”¤é†’åçš„çº¿ç¨‹è¿›å…¥<strong>å¯è¿è¡Œ</strong>çŠ¶æ€</li></ul></li><li><mark>ç­‰å¾…</mark><ul><li>å½“<mark>è·å–é”æˆåŠŸåï¼Œä½†ç”±äºæ¡ä»¶ä¸æ»¡è¶³</mark>ï¼Œè°ƒç”¨äº† wait() æ–¹æ³•ï¼Œæ­¤æ—¶ä»<strong>å¯è¿è¡Œ</strong>çŠ¶æ€é‡Šæ”¾é”è¿›å…¥ Monitor ç­‰å¾…é›†åˆ<strong>ç­‰å¾…</strong>ï¼ŒåŒæ ·ä¸å ç”¨ cpu æ—¶é—´</li><li>å½“å…¶å®ƒæŒé”çº¿ç¨‹è°ƒç”¨ notify() æˆ– notifyAll() æ–¹æ³•ï¼Œä¼šæŒ‰ç…§ä¸€å®šè§„åˆ™å”¤é†’ç­‰å¾…é›†åˆä¸­çš„<strong>ç­‰å¾…</strong>çº¿ç¨‹ï¼Œæ¢å¤ä¸º<strong>å¯è¿è¡Œ</strong>çŠ¶æ€</li></ul></li><li><mark>æœ‰æ—¶é™ç­‰å¾…</mark><ul><li>å½“è·å–é”æˆåŠŸåï¼Œä½†ç”±äºæ¡ä»¶ä¸æ»¡è¶³ï¼Œè°ƒç”¨äº† wait(long) æ–¹æ³•ï¼Œæ­¤æ—¶ä»<strong>å¯è¿è¡Œ</strong>çŠ¶æ€é‡Šæ”¾é”è¿›å…¥ Monitor ç­‰å¾…é›†åˆè¿›è¡Œ<strong>æœ‰æ—¶é™ç­‰å¾…</strong>ï¼ŒåŒæ ·ä¸å ç”¨ cpu æ—¶é—´</li><li>å½“å…¶å®ƒæŒé”çº¿ç¨‹è°ƒç”¨ notify() æˆ– notifyAll() æ–¹æ³•ï¼Œä¼šæŒ‰ç…§ä¸€å®šè§„åˆ™å”¤é†’ç­‰å¾…é›†åˆä¸­çš„<strong>æœ‰æ—¶é™ç­‰å¾…</strong>çº¿ç¨‹ï¼Œæ¢å¤ä¸º<strong>å¯è¿è¡Œ</strong>çŠ¶æ€ï¼Œå¹¶é‡æ–°å»ç«äº‰é”</li><li>å¦‚æœç­‰å¾…è¶…æ—¶ï¼Œä¹Ÿä¼šä»<strong>æœ‰æ—¶é™ç­‰å¾…</strong>çŠ¶æ€æ¢å¤ä¸º<strong>å¯è¿è¡Œ</strong>çŠ¶æ€ï¼Œå¹¶é‡æ–°å»ç«äº‰é”</li><li>è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯è°ƒç”¨ sleep(long) æ–¹æ³•ä¹Ÿä¼šä»<strong>å¯è¿è¡Œ</strong>çŠ¶æ€è¿›å…¥<strong>æœ‰æ—¶é™ç­‰å¾…</strong>çŠ¶æ€ï¼Œä½†ä¸ Monitor æ— å…³ï¼Œä¸éœ€è¦ä¸»åŠ¨å”¤é†’ï¼Œè¶…æ—¶æ—¶é—´åˆ°è‡ªç„¶æ¢å¤ä¸º<strong>å¯è¿è¡Œ</strong>çŠ¶æ€</li></ul></li></ul><h3 id="1-7-æ–°å»º-T1ã€T2ã€T3-ä¸‰ä¸ªçº¿ç¨‹ï¼Œå¦‚ä½•ä¿è¯å®ƒä»¬æŒ‰é¡ºåºæ‰§è¡Œï¼Ÿ"><a href="#1-7-æ–°å»º-T1ã€T2ã€T3-ä¸‰ä¸ªçº¿ç¨‹ï¼Œå¦‚ä½•ä¿è¯å®ƒä»¬æŒ‰é¡ºåºæ‰§è¡Œï¼Ÿ" class="headerlink" title="1.7 æ–°å»º T1ã€T2ã€T3 ä¸‰ä¸ªçº¿ç¨‹ï¼Œå¦‚ä½•ä¿è¯å®ƒä»¬æŒ‰é¡ºåºæ‰§è¡Œï¼Ÿ"></a>1.7 æ–°å»º T1ã€T2ã€T3 ä¸‰ä¸ªçº¿ç¨‹ï¼Œå¦‚ä½•ä¿è¯å®ƒä»¬æŒ‰é¡ºåºæ‰§è¡Œï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><p>åœ¨å¤šçº¿ç¨‹ä¸­æœ‰å¤šç§æ–¹æ³•è®©çº¿ç¨‹æŒ‰ç‰¹å®šé¡ºåºæ‰§è¡Œï¼Œä½ å¯ä»¥ç”¨çº¿ç¨‹ç±»çš„<strong>join</strong>()æ–¹æ³•åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å¯åŠ¨å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹å®Œæˆè¯¥çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚</p><p>ä»£ç ä¸¾ä¾‹ï¼š</p><p>ä¸ºäº†ç¡®ä¿ä¸‰ä¸ªçº¿ç¨‹çš„é¡ºåºä½ åº”è¯¥å…ˆå¯åŠ¨æœ€åä¸€ä¸ª(T3è°ƒç”¨T2ï¼ŒT2è°ƒç”¨T1)ï¼Œè¿™æ ·T1å°±ä¼šå…ˆå®Œæˆè€ŒT3æœ€åå®Œæˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JoinTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºçº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;t1&quot;</span>);</span><br><span class="line">        &#125;) ;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                t1.join();                          <span class="comment">// åŠ å…¥çº¿ç¨‹t1,åªæœ‰t1çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä»¥åï¼Œå†æ¬¡æ‰§è¡Œè¯¥çº¿ç¨‹</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;t2&quot;</span>);</span><br><span class="line">        &#125;) ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                t2.join();                              <span class="comment">// åŠ å…¥çº¿ç¨‹t2,åªæœ‰t2çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä»¥åï¼Œå†æ¬¡æ‰§è¡Œè¯¥çº¿ç¨‹</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;t3&quot;</span>);</span><br><span class="line">        &#125;) ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-8-notify-å’Œ-notifyAll-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#1-8-notify-å’Œ-notifyAll-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="1.8 notify()å’Œ notifyAll()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>1.8 notify()å’Œ notifyAll()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†</p></blockquote><p><mark>notifyAllï¼šå”¤é†’æ‰€æœ‰waitçš„çº¿ç¨‹</mark></p><p><mark>notifyï¼šåªéšæœºå”¤é†’ä¸€ä¸ª wait çº¿ç¨‹</mark></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.basic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WaitNotify</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock)&#123;</span><br><span class="line">                <span class="keyword">while</span> (!flag)&#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;...wating...&quot;</span>);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        lock.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot;...flag is true&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock)&#123;</span><br><span class="line">                <span class="keyword">while</span> (!flag)&#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;...wating...&quot;</span>);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        lock.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot;...flag is true&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; hold lock&quot;</span>);</span><br><span class="line">                lock.notifyAll();</span><br><span class="line">                flag = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-9-åœ¨-java-ä¸­-wait-å’Œ-sleep-æ–¹æ³•çš„ä¸åŒï¼Ÿ"><a href="#1-9-åœ¨-java-ä¸­-wait-å’Œ-sleep-æ–¹æ³•çš„ä¸åŒï¼Ÿ" class="headerlink" title="1.9 åœ¨ java ä¸­ wait å’Œ sleep æ–¹æ³•çš„ä¸åŒï¼Ÿ"></a>1.9 åœ¨ java ä¸­ wait å’Œ sleep æ–¹æ³•çš„ä¸åŒï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><p>å‚è€ƒå›ç­”ï¼š</p><p>å…±åŒç‚¹</p><ul><li>wait() ï¼Œwait(long) å’Œ sleep(long) çš„æ•ˆæœ<mark>éƒ½æ˜¯è®©å½“å‰çº¿ç¨‹æš‚æ—¶æ”¾å¼ƒ CPU çš„ä½¿ç”¨æƒï¼Œè¿›å…¥é˜»å¡çŠ¶æ€</mark></li></ul><p>ä¸åŒç‚¹</p><ul><li><p>æ–¹æ³•å½’å±ä¸åŒ</p><ul><li>sleep(long) æ˜¯ Thread çš„é™æ€æ–¹æ³•</li><li>è€Œ wait()ï¼Œwait(long) éƒ½æ˜¯ Object çš„æˆå‘˜æ–¹æ³•ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰</li></ul></li><li><p>é†’æ¥æ—¶æœºä¸åŒ</p><ul><li>æ‰§è¡Œ sleep(long) å’Œ wait(long) çš„çº¿ç¨‹éƒ½ä¼šåœ¨ç­‰å¾…ç›¸åº”æ¯«ç§’åé†’æ¥</li><li><mark>wait(long) å’Œ wait() è¿˜å¯ä»¥è¢« notify å”¤é†’</mark>ï¼Œwait() å¦‚æœä¸å”¤é†’å°±ä¸€ç›´ç­‰ä¸‹å»</li><li>å®ƒä»¬éƒ½å¯ä»¥è¢«æ‰“æ–­å”¤é†’</li></ul></li><li><p>é”ç‰¹æ€§ä¸åŒï¼ˆé‡ç‚¹ï¼‰</p><ul><li><mark>wait æ–¹æ³•çš„è°ƒç”¨å¿…é¡»å…ˆè·å– wait å¯¹è±¡çš„é”ï¼Œè€Œ sleep åˆ™æ— æ­¤é™åˆ¶</mark></li><li><mark>wait æ–¹æ³•æ‰§è¡Œåä¼šé‡Šæ”¾å¯¹è±¡é”ï¼Œå…è®¸å…¶å®ƒçº¿ç¨‹è·å¾—è¯¥å¯¹è±¡é”ï¼ˆæˆ‘æ”¾å¼ƒ cpuï¼Œä½†ä½ ä»¬è¿˜å¯ä»¥ç”¨ï¼‰</mark></li><li><mark>è€Œ sleep å¦‚æœåœ¨ synchronized ä»£ç å—ä¸­æ‰§è¡Œï¼Œå¹¶ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ï¼ˆæˆ‘æ”¾å¼ƒ cpuï¼Œä½ ä»¬ä¹Ÿç”¨ä¸äº†ï¼‰</mark></li></ul></li></ul><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WaitSleepCase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">LOCK</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        sleeping();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">illegalWait</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        LOCK.wait();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">waiting</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (LOCK) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    get(<span class="string">&quot;t&quot;</span>).debug(<span class="string">&quot;waiting...&quot;</span>);</span><br><span class="line">                    LOCK.wait(<span class="number">5000L</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    get(<span class="string">&quot;t&quot;</span>).debug(<span class="string">&quot;interrupted...&quot;</span>);</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        <span class="keyword">synchronized</span> (LOCK) &#123;</span><br><span class="line">            main.debug(<span class="string">&quot;other...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sleeping</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (LOCK) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    get(<span class="string">&quot;t&quot;</span>).debug(<span class="string">&quot;sleeping...&quot;</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">5000L</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    get(<span class="string">&quot;t&quot;</span>).debug(<span class="string">&quot;interrupted...&quot;</span>);</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        <span class="keyword">synchronized</span> (LOCK) &#123;</span><br><span class="line">            main.debug(<span class="string">&quot;other...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-10-å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Ÿ"><a href="#1-10-å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Ÿ" class="headerlink" title="1.10 å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Ÿ"></a>1.10 å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†</p></blockquote><p>å‚è€ƒå›ç­”ï¼š</p><p>æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥åœæ­¢çº¿ç¨‹</p><ul><li>ä½¿ç”¨é€€å‡ºæ ‡å¿—ï¼Œä½¿çº¿ç¨‹æ­£å¸¸é€€å‡ºï¼Œä¹Ÿå°±æ˜¯å½“runæ–¹æ³•å®Œæˆåçº¿ç¨‹ç»ˆæ­¢</li><li>ä½¿ç”¨stopæ–¹æ³•å¼ºè¡Œç»ˆæ­¢ï¼ˆä¸æ¨èï¼Œæ–¹æ³•å·²ä½œåºŸï¼‰</li><li><mark>ä½¿ç”¨interruptæ–¹æ³•ä¸­æ–­çº¿ç¨‹</mark></li></ul><p>ä»£ç å‚è€ƒå¦‚ä¸‹ï¼š</p><p>â‘  <strong>ä½¿ç”¨é€€å‡ºæ ‡å¿—ï¼Œä½¿çº¿ç¨‹æ­£å¸¸é€€å‡º</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyInterrupt1</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span> ;     <span class="comment">// çº¿ç¨‹æ‰§è¡Œçš„é€€å‡ºæ ‡è®°</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(!flag) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;MyThread...run...&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºMyThreadå¯¹è±¡</span></span><br><span class="line">        <span class="type">MyInterrupt1</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyInterrupt1</span>() ;</span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸»çº¿ç¨‹ä¼‘çœ 6ç§’</span></span><br><span class="line">        Thread.sleep(<span class="number">6000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›´æ”¹æ ‡è®°ä¸ºtrue</span></span><br><span class="line">        t1.flag = <span class="literal">true</span> ;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â‘¡ <strong>ä½¿ç”¨stopæ–¹æ³•å¼ºè¡Œç»ˆæ­¢</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyInterrupt2</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span> ;     <span class="comment">// çº¿ç¨‹æ‰§è¡Œçš„é€€å‡ºæ ‡è®°</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(!flag) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;MyThread...run...&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºMyThreadå¯¹è±¡</span></span><br><span class="line">        <span class="type">MyInterrupt2</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyInterrupt2</span>() ;</span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸»çº¿ç¨‹ä¼‘çœ 2ç§’</span></span><br><span class="line">        Thread.sleep(<span class="number">6000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨stopæ–¹æ³•</span></span><br><span class="line">        t1.stop();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â‘¢ <strong>ä½¿ç”¨interruptæ–¹æ³•ä¸­æ–­çº¿ç¨‹</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.basic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyInterrupt3</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.æ‰“æ–­é˜»å¡çš„çº¿ç¨‹</span></span><br><span class="line">        <span class="comment">/*Thread t1 = new Thread(()-&gt;&#123;</span></span><br><span class="line"><span class="comment">            System.out.println(&quot;t1 æ­£åœ¨è¿è¡Œ...&quot;);</span></span><br><span class="line"><span class="comment">            try &#123;</span></span><br><span class="line"><span class="comment">                Thread.sleep(5000);</span></span><br><span class="line"><span class="comment">            &#125; catch (InterruptedException e) &#123;</span></span><br><span class="line"><span class="comment">                e.printStackTrace();</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;, &quot;t1&quot;);</span></span><br><span class="line"><span class="comment">        t1.start();</span></span><br><span class="line"><span class="comment">        Thread.sleep(500);</span></span><br><span class="line"><span class="comment">        t1.interrupt();</span></span><br><span class="line"><span class="comment">        System.out.println(t1.isInterrupted());*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.æ‰“æ–­æ­£å¸¸çš„çº¿ç¨‹</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="type">Thread</span> <span class="variable">current</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">interrupted</span> <span class="operator">=</span> current.isInterrupted();</span><br><span class="line">                <span class="keyword">if</span>(interrupted) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ‰“æ–­çŠ¶æ€ï¼š&quot;</span>+interrupted);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line">        t2.start();</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line"><span class="comment">//        t2.interrupt();</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-çº¿ç¨‹ä¸­å¹¶å‘é”"><a href="#2-çº¿ç¨‹ä¸­å¹¶å‘é”" class="headerlink" title="2.çº¿ç¨‹ä¸­å¹¶å‘é”"></a>2.çº¿ç¨‹ä¸­å¹¶å‘é”</h2><h3 id="2-1-è®²ä¸€ä¸‹synchronizedå…³é”®å­—çš„åº•å±‚åŸç†ï¼Ÿ"><a href="#2-1-è®²ä¸€ä¸‹synchronizedå…³é”®å­—çš„åº•å±‚åŸç†ï¼Ÿ" class="headerlink" title="2.1 è®²ä¸€ä¸‹synchronizedå…³é”®å­—çš„åº•å±‚åŸç†ï¼Ÿ"></a>2.1 è®²ä¸€ä¸‹synchronizedå…³é”®å­—çš„åº•å±‚åŸç†ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><h4 id="2-1-1-åŸºæœ¬ä½¿ç”¨"><a href="#2-1-1-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="2.1.1 åŸºæœ¬ä½¿ç”¨"></a>2.1.1 åŸºæœ¬ä½¿ç”¨</h4><p>å¦‚ä¸‹æŠ¢ç¥¨çš„ä»£ç ï¼Œå¦‚æœä¸åŠ é”ï¼Œå°±ä¼šå‡ºç°è¶…å–æˆ–è€…ä¸€å¼ ç¥¨å–ç»™å¤šä¸ªäºº</p><p>Synchronizedã€å¯¹è±¡é”ã€‘é‡‡ç”¨äº’æ–¥çš„æ–¹å¼è®©åŒä¸€æ—¶åˆ»è‡³å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰ã€å¯¹è±¡é”ã€‘ï¼Œå…¶å®ƒçº¿ç¨‹å†æƒ³è·å–è¿™ä¸ªã€å¯¹è±¡é”ã€‘æ—¶å°±ä¼šé˜»å¡ä½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TicketDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="type">int</span> <span class="variable">ticketNum</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">getTicket</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ticketNum &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;æŠ¢åˆ°ä¸€å¼ ç¥¨,å‰©ä½™:&quot;</span> + ticketNum);</span><br><span class="line">            <span class="comment">// éåŸå­æ€§æ“ä½œ</span></span><br><span class="line">            ticketNum--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">TicketDemo</span> <span class="variable">ticketDemo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TicketDemo</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                ticketDemo.getTicket();</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-1-2-Monitor"><a href="#2-1-2-Monitor" class="headerlink" title="2.1.2 Monitor"></a>2.1.2 Monitor</h4><p>Monitor è¢«ç¿»è¯‘ä¸ºç›‘è§†å™¨ï¼Œæ˜¯ç”±jvmæä¾›ï¼Œc++è¯­è¨€å®ç°</p><p>åœ¨ä»£ç ä¸­æƒ³è¦ä½“ç°monitoréœ€è¦å€ŸåŠ©javapå‘½ä»¤æŸ¥çœ‹clsssçš„å­—èŠ‚ç ï¼Œæ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SyncTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            counter++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°è¿™ä¸ªç±»çš„classæ–‡ä»¶ï¼Œåœ¨classæ–‡ä»¶ç›®å½•ä¸‹æ‰§è¡Œ<code>javap -v SyncTest.class</code>ï¼Œåç¼–è¯‘æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504165342501.png" alt="image-20230504165342501"></p><blockquote><ul><li>monitorenter    ä¸Šé”å¼€å§‹çš„åœ°æ–¹</li><li>monitorexit        è§£é”çš„åœ°æ–¹</li><li>å…¶ä¸­è¢«monitorenterå’ŒmonitorexitåŒ…å›´ä½çš„æŒ‡ä»¤å°±æ˜¯ä¸Šé”çš„ä»£ç </li><li>æœ‰ä¸¤ä¸ªmonitorexitçš„åŸå› ï¼Œç¬¬äºŒä¸ªmonitorexitæ˜¯ä¸ºäº†é˜²æ­¢é”ä½çš„ä»£ç æŠ›å¼‚å¸¸åä¸èƒ½åŠæ—¶é‡Šæ”¾é”</li></ul></blockquote><p>åœ¨ä½¿ç”¨äº†synchornizedä»£ç å—æ—¶éœ€è¦æŒ‡å®šä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥synchornizedä¹Ÿè¢«ç§°ä¸ºå¯¹è±¡é”</p><p>monitorä¸»è¦å°±æ˜¯è·Ÿè¿™ä¸ªå¯¹è±¡äº§ç”Ÿå…³è”ï¼Œå¦‚ä¸‹å›¾</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504165833809.png" alt="image-20230504165833809"></p><p>Monitorå†…éƒ¨å…·ä½“çš„å­˜å‚¨ç»“æ„ï¼š</p><ul><li><p>Ownerï¼šå­˜å‚¨å½“å‰è·å–é”çš„çº¿ç¨‹çš„ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è·å–</p></li><li><p>EntryListï¼šå…³è”æ²¡æœ‰æŠ¢åˆ°é”çš„çº¿ç¨‹ï¼Œå¤„äºBlockedçŠ¶æ€çš„çº¿ç¨‹</p></li><li><p>WaitSetï¼šå…³è”è°ƒç”¨äº†waitæ–¹æ³•çš„çº¿ç¨‹ï¼Œå¤„äºWaitingçŠ¶æ€çš„çº¿ç¨‹</p></li></ul><p>å…·ä½“çš„æµç¨‹ï¼š</p><ul><li>ä»£ç è¿›å…¥synchorizedä»£ç å—ï¼Œå…ˆè®©lockï¼ˆå¯¹è±¡é”ï¼‰å…³è”çš„monitorï¼Œç„¶ååˆ¤æ–­Owneræ˜¯å¦æœ‰çº¿ç¨‹æŒæœ‰</li><li>å¦‚æœæ²¡æœ‰çº¿ç¨‹æŒæœ‰ï¼Œåˆ™è®©å½“å‰çº¿ç¨‹æŒæœ‰ï¼Œè¡¨ç¤ºè¯¥çº¿ç¨‹è·å–é”æˆåŠŸ</li><li>å¦‚æœæœ‰çº¿ç¨‹æŒæœ‰ï¼Œåˆ™è®©å½“å‰çº¿ç¨‹è¿›å…¥entryListè¿›è¡Œé˜»å¡ï¼Œå¦‚æœOwneræŒæœ‰çš„çº¿ç¨‹å·²ç»é‡Šæ”¾äº†é”ï¼Œåœ¨EntryListä¸­çš„çº¿ç¨‹å»ç«äº‰é”çš„æŒæœ‰æƒï¼ˆéå…¬å¹³ï¼‰</li><li>å¦‚æœä»£ç å—ä¸­è°ƒç”¨äº†wait()æ–¹æ³•ï¼Œåˆ™ä¼šè¿›å»WaitSetä¸­è¿›è¡Œç­‰å¾…</li></ul><p>ğŸ”´ğŸŸ¡ğŸŸ¢å‚è€ƒå›ç­”ï¼š</p><ul><li><p>Synchronizedã€å¯¹è±¡é”ã€‘é‡‡ç”¨äº’æ–¥çš„æ–¹å¼è®©åŒä¸€æ—¶åˆ»è‡³å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰ã€å¯¹è±¡é”ã€‘</p></li><li><p>å®ƒçš„åº•å±‚ç”±monitorå®ç°çš„ï¼Œmonitoræ˜¯jvmçº§åˆ«çš„å¯¹è±¡ï¼ˆ C++å®ç°ï¼‰ï¼Œçº¿ç¨‹è·å¾—é”éœ€è¦ä½¿ç”¨å¯¹è±¡ï¼ˆé”ï¼‰å…³è”monitor</p></li><li><p>åœ¨monitorå†…éƒ¨æœ‰ä¸‰ä¸ªå±æ€§ï¼Œåˆ†åˆ«æ˜¯ownerã€entrylistã€waitset</p></li><li><p><mark>å…¶ä¸­owneræ˜¯å…³è”çš„è·å¾—é”çš„çº¿ç¨‹ï¼Œå¹¶ä¸”åªèƒ½å…³è”ä¸€ä¸ªçº¿ç¨‹ï¼›entrylistå…³è”çš„æ˜¯å¤„äºé˜»å¡çŠ¶æ€çš„çº¿ç¨‹ï¼›waitsetå…³è”çš„æ˜¯å¤„äºWaitingçŠ¶æ€çš„çº¿ç¨‹</mark></p></li></ul><h3 id="2-2-synchronizedå…³é”®å­—çš„åº•å±‚åŸç†-è¿›é˜¶"><a href="#2-2-synchronizedå…³é”®å­—çš„åº•å±‚åŸç†-è¿›é˜¶" class="headerlink" title="2.2 synchronizedå…³é”®å­—çš„åº•å±‚åŸç†-è¿›é˜¶"></a>2.2 synchronizedå…³é”®å­—çš„åº•å±‚åŸç†-è¿›é˜¶</h3><p>Monitorå®ç°çš„é”å±äºé‡é‡çº§é”ï¼Œä½ äº†è§£è¿‡é”å‡çº§å—ï¼Ÿ</p><ul><li><p>Monitorå®ç°çš„é”å±äºé‡é‡çº§é”ï¼Œé‡Œé¢æ¶‰åŠåˆ°äº†ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢ã€è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæˆæœ¬è¾ƒé«˜ï¼Œæ€§èƒ½æ¯”è¾ƒä½ã€‚</p></li><li><p>åœ¨JDK 1.6å¼•å…¥äº†ä¸¤ç§æ–°å‹é”æœºåˆ¶ï¼šåå‘é”å’Œè½»é‡çº§é”ï¼Œå®ƒä»¬çš„å¼•å…¥æ˜¯ä¸ºäº†è§£å†³åœ¨æ²¡æœ‰å¤šçº¿ç¨‹ç«äº‰æˆ–åŸºæœ¬æ²¡æœ‰ç«äº‰çš„åœºæ™¯ä¸‹å› ä½¿ç”¨ä¼ ç»Ÿé”æœºåˆ¶å¸¦æ¥çš„æ€§èƒ½å¼€é”€é—®é¢˜ã€‚</p></li></ul><h4 id="2-2-1-å¯¹è±¡çš„å†…å­˜ç»“æ„"><a href="#2-2-1-å¯¹è±¡çš„å†…å­˜ç»“æ„" class="headerlink" title="2.2.1 å¯¹è±¡çš„å†…å­˜ç»“æ„"></a>2.2.1 å¯¹è±¡çš„å†…å­˜ç»“æ„</h4><p>åœ¨HotSpotè™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„å¸ƒå±€å¯åˆ†ä¸º3å—åŒºåŸŸï¼šå¯¹è±¡å¤´ï¼ˆHeaderï¼‰ã€å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰å’Œå¯¹é½å¡«å……</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504172253826.png" alt="image-20230504172253826"></p><p>æˆ‘ä»¬éœ€è¦é‡ç‚¹åˆ†æMarkWordå¯¹è±¡å¤´</p><h4 id="2-2-2-MarkWord"><a href="#2-2-2-MarkWord" class="headerlink" title="2.2.2 MarkWord"></a>2.2.2 MarkWord</h4><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504172541922.png" alt="image-20230504172541922"></p><blockquote><ul><li><p>hashcodeï¼š25ä½çš„å¯¹è±¡æ ‡è¯†Hashç </p></li><li><p>ageï¼šå¯¹è±¡åˆ†ä»£å¹´é¾„å 4ä½</p></li><li><p>biased_lockï¼šåå‘é”æ ‡è¯†ï¼Œå 1ä½ ï¼Œ0è¡¨ç¤ºæ²¡æœ‰å¼€å§‹åå‘é”ï¼Œ1è¡¨ç¤ºå¼€å¯äº†åå‘é”</p></li><li><p>threadï¼šæŒæœ‰åå‘é”çš„çº¿ç¨‹IDï¼Œå 23ä½</p></li><li><p>epochï¼šåå‘æ—¶é—´æˆ³ï¼Œå 2ä½</p></li><li><p>ptr_to_lock_recordï¼šè½»é‡çº§é”çŠ¶æ€ä¸‹ï¼ŒæŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆï¼Œå 30ä½</p></li><li><p>ptr_to_heavyweight_monitorï¼šé‡é‡çº§é”çŠ¶æ€ä¸‹ï¼ŒæŒ‡å‘å¯¹è±¡ç›‘è§†å™¨Monitorçš„æŒ‡é’ˆï¼Œå 30ä½</p></li></ul></blockquote><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡lockçš„æ ‡è¯†ï¼Œæ¥åˆ¤æ–­æ˜¯å“ªä¸€ç§é”çš„ç­‰çº§</p><ul><li>åä¸‰ä½æ˜¯001è¡¨ç¤ºæ— é”</li><li>åä¸‰ä½æ˜¯101è¡¨ç¤ºåå‘é”</li><li>åä¸¤ä½æ˜¯00è¡¨ç¤ºè½»é‡çº§é”</li><li>åä¸¤ä½æ˜¯10è¡¨ç¤ºé‡é‡çº§é”</li></ul><h4 id="2-2-3-å†è¯´Monitoré‡é‡çº§é”"><a href="#2-2-3-å†è¯´Monitoré‡é‡çº§é”" class="headerlink" title="2.2.3 å†è¯´Monitoré‡é‡çº§é”"></a>2.2.3 å†è¯´Monitoré‡é‡çº§é”</h4><p>æ¯ä¸ª Java å¯¹è±¡éƒ½å¯ä»¥å…³è”ä¸€ä¸ª Monitor å¯¹è±¡ï¼Œå¦‚æœä½¿ç”¨ synchronized ç»™å¯¹è±¡ä¸Šé”ï¼ˆé‡é‡çº§ï¼‰ä¹‹åï¼Œ<strong>è¯¥å¯¹è±¡å¤´çš„Mark Word ä¸­å°±è¢«è®¾ç½®æŒ‡å‘ Monitor å¯¹è±¡çš„æŒ‡é’ˆ</strong></p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504172957271.png" alt="image-20230504172957271"></p><p>ç®€å•è¯´å°±æ˜¯ï¼šæ¯ä¸ªå¯¹è±¡çš„å¯¹è±¡å¤´éƒ½å¯ä»¥è®¾ç½®monoitorçš„æŒ‡é’ˆï¼Œè®©å¯¹è±¡ä¸monitoräº§ç”Ÿå…³è”</p><h4 id="2-2-4-è½»é‡çº§é”"><a href="#2-2-4-è½»é‡çº§é”" class="headerlink" title="2.2.4 è½»é‡çº§é”"></a>2.2.4 è½»é‡çº§é”</h4><p>åœ¨å¾ˆå¤šçš„æƒ…å†µä¸‹ï¼Œåœ¨Javaç¨‹åºè¿è¡Œæ—¶ï¼ŒåŒæ­¥å—ä¸­çš„ä»£ç éƒ½æ˜¯ä¸å­˜åœ¨ç«äº‰çš„ï¼Œä¸åŒçš„çº¿ç¨‹äº¤æ›¿çš„æ‰§è¡ŒåŒæ­¥å—ä¸­çš„ä»£ç ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨é‡é‡çº§é”æ˜¯æ²¡å¿…è¦çš„ã€‚å› æ­¤JVMå¼•å…¥äº†è½»é‡çº§é”çš„æ¦‚å¿µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (obj) &#123;</span><br><span class="line">        <span class="comment">// åŒæ­¥å— A</span></span><br><span class="line">        method2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (obj) &#123;</span><br><span class="line">        <span class="comment">// åŒæ­¥å— B</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŠ é”çš„æµç¨‹</strong></p><p>1.åœ¨çº¿ç¨‹æ ˆä¸­åˆ›å»ºä¸€ä¸ªLock Recordï¼Œå°†å…¶objå­—æ®µæŒ‡å‘é”å¯¹è±¡ã€‚</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504173520412.png" alt="image-20230504173520412"></p><p>2.é€šè¿‡CASæŒ‡ä»¤å°†Lock Recordçš„åœ°å€å­˜å‚¨åœ¨å¯¹è±¡å¤´çš„mark wordä¸­ï¼ˆæ•°æ®è¿›è¡Œäº¤æ¢ï¼‰ï¼Œå¦‚æœå¯¹è±¡å¤„äºæ— é”çŠ¶æ€åˆ™ä¿®æ”¹æˆåŠŸï¼Œä»£è¡¨è¯¥çº¿ç¨‹è·å¾—äº†è½»é‡çº§é”ã€‚</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504173611219.png" alt="image-20230504173611219"></p><p>3.å¦‚æœæ˜¯å½“å‰çº¿ç¨‹å·²ç»æŒæœ‰è¯¥é”äº†ï¼Œä»£è¡¨è¿™æ˜¯ä¸€æ¬¡é”é‡å…¥ã€‚è®¾ç½®Lock Recordç¬¬ä¸€éƒ¨åˆ†ä¸ºnullï¼Œèµ·åˆ°äº†ä¸€ä¸ªé‡å…¥è®¡æ•°å™¨çš„ä½œç”¨ã€‚</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504173922343.png" alt="image-20230504173922343"></p><p>4.å¦‚æœCASä¿®æ”¹å¤±è´¥ï¼Œè¯´æ˜å‘ç”Ÿäº†ç«äº‰ï¼Œéœ€è¦è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚</p><p><strong>è§£é”è¿‡ç¨‹</strong></p><p>1.éå†çº¿ç¨‹æ ˆ,æ‰¾åˆ°æ‰€æœ‰objå­—æ®µç­‰äºå½“å‰é”å¯¹è±¡çš„Lock Recordã€‚</p><p>2.å¦‚æœLock Recordçš„Mark Wordä¸ºnullï¼Œä»£è¡¨è¿™æ˜¯ä¸€æ¬¡é‡å…¥ï¼Œå°†objè®¾ç½®ä¸ºnullåcontinueã€‚</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504173955680.png" alt="image-20230504173955680"></p><p>3.å¦‚æœLock Recordçš„ Mark Wordä¸ä¸ºnullï¼Œåˆ™åˆ©ç”¨CASæŒ‡ä»¤å°†å¯¹è±¡å¤´çš„mark wordæ¢å¤æˆä¸ºæ— é”çŠ¶æ€ã€‚å¦‚æœå¤±è´¥åˆ™è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504174045458.png" alt="image-20230504174045458"></p><h4 id="2-2-5-åå‘é”"><a href="#2-2-5-åå‘é”" class="headerlink" title="2.2.5 åå‘é”"></a>2.2.5 åå‘é”</h4><p>è½»é‡çº§é”åœ¨æ²¡æœ‰ç«äº‰æ—¶ï¼ˆå°±è‡ªå·±è¿™ä¸ªçº¿ç¨‹ï¼‰ï¼Œæ¯æ¬¡é‡å…¥ä»ç„¶éœ€è¦æ‰§è¡Œ CAS æ“ä½œã€‚</p><p>Java 6 ä¸­å¼•å…¥äº†åå‘é”æ¥åšè¿›ä¸€æ­¥ä¼˜åŒ–ï¼šåªæœ‰ç¬¬ä¸€æ¬¡ä½¿ç”¨ CAS å°†çº¿ç¨‹ ID è®¾ç½®åˆ°å¯¹è±¡çš„ Mark Word å¤´ï¼Œä¹‹åå‘ç°</p><p>è¿™ä¸ªçº¿ç¨‹ ID æ˜¯è‡ªå·±çš„å°±è¡¨ç¤ºæ²¡æœ‰ç«äº‰ï¼Œä¸ç”¨é‡æ–° CASã€‚ä»¥ååªè¦ä¸å‘ç”Ÿç«äº‰ï¼Œè¿™ä¸ªå¯¹è±¡å°±å½’è¯¥çº¿ç¨‹æ‰€æœ‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">m1</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (obj) &#123;</span><br><span class="line">        <span class="comment">// åŒæ­¥å— A</span></span><br><span class="line">        m2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">m2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (obj) &#123;</span><br><span class="line">        <span class="comment">// åŒæ­¥å— B</span></span><br><span class="line">        m3();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">m3</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (obj) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŠ é”çš„æµç¨‹</strong></p><p>1.åœ¨çº¿ç¨‹æ ˆä¸­åˆ›å»ºä¸€ä¸ªLock Recordï¼Œå°†å…¶objå­—æ®µæŒ‡å‘é”å¯¹è±¡ã€‚</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504174525256.png" alt="image-20230504174525256"></p><p>2.é€šè¿‡CASæŒ‡ä»¤å°†Lock Recordçš„<strong>çº¿ç¨‹id</strong>å­˜å‚¨åœ¨å¯¹è±¡å¤´çš„mark wordä¸­ï¼ŒåŒæ—¶ä¹Ÿè®¾ç½®åå‘é”çš„æ ‡è¯†ä¸º101ï¼Œå¦‚æœå¯¹è±¡å¤„äºæ— é”çŠ¶æ€åˆ™ä¿®æ”¹æˆåŠŸï¼Œä»£è¡¨è¯¥çº¿ç¨‹è·å¾—äº†åå‘é”ã€‚</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504174505031.png" alt="image-20230504174505031"></p><p>3.å¦‚æœæ˜¯å½“å‰çº¿ç¨‹å·²ç»æŒæœ‰è¯¥é”äº†ï¼Œä»£è¡¨è¿™æ˜¯ä¸€æ¬¡é”é‡å…¥ã€‚è®¾ç½®Lock Recordç¬¬ä¸€éƒ¨åˆ†ä¸ºnullï¼Œèµ·åˆ°äº†ä¸€ä¸ªé‡å…¥è®¡æ•°å™¨çš„ä½œç”¨ã€‚ä¸è½»é‡çº§é”ä¸åŒçš„æ—¶ï¼Œè¿™é‡Œä¸ä¼šå†æ¬¡è¿›è¡Œcasæ“ä½œï¼Œåªæ˜¯åˆ¤æ–­å¯¹è±¡å¤´ä¸­çš„çº¿ç¨‹idæ˜¯å¦æ˜¯è‡ªå·±ï¼Œå› ä¸ºç¼ºå°‘äº†casæ“ä½œï¼Œæ€§èƒ½ç›¸å¯¹è½»é‡çº§é”æ›´å¥½ä¸€äº›</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504174736226.png" alt="image-20230504174736226"></p><p>è§£é”æµç¨‹å‚è€ƒè½»é‡çº§é”</p><h4 id="2-2-6-å‚è€ƒå›ç­”"><a href="#2-2-6-å‚è€ƒå›ç­”" class="headerlink" title="2.2.6 å‚è€ƒå›ç­”"></a>2.2.6 å‚è€ƒå›ç­”</h4><p>Javaä¸­çš„synchronizedæœ‰åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ä¸‰ç§å½¢å¼ï¼Œåˆ†åˆ«å¯¹åº”äº†é”åªè¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€ä¸åŒçº¿ç¨‹äº¤æ›¿æŒæœ‰é”ã€å¤šçº¿ç¨‹ç«äº‰é”ä¸‰ç§æƒ…å†µã€‚</p><table><thead><tr><th></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>é‡é‡çº§é”</td><td>åº•å±‚ä½¿ç”¨çš„Monitorå®ç°ï¼Œé‡Œé¢æ¶‰åŠåˆ°äº†ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢ã€è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæˆæœ¬è¾ƒé«˜ï¼Œæ€§èƒ½æ¯”è¾ƒä½ã€‚</td></tr><tr><td>è½»é‡çº§é”</td><td>çº¿ç¨‹åŠ é”çš„æ—¶é—´æ˜¯é”™å¼€çš„ï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰ç«äº‰ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨è½»é‡çº§é”æ¥ä¼˜åŒ–ã€‚è½»é‡çº§ä¿®æ”¹äº†å¯¹è±¡å¤´çš„é”æ ‡å¿—ï¼Œç›¸å¯¹é‡é‡çº§é”æ€§èƒ½æå‡å¾ˆå¤šã€‚æ¯æ¬¡ä¿®æ”¹éƒ½æ˜¯CASæ“ä½œï¼Œä¿è¯åŸå­æ€§</td></tr><tr><td>åå‘é”</td><td>ä¸€æ®µå¾ˆé•¿çš„æ—¶é—´å†…éƒ½åªè¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨é”ï¼Œå¯ä»¥ä½¿ç”¨äº†åå‘é”ï¼Œåœ¨ç¬¬ä¸€æ¬¡è·å¾—é”æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ªCASæ“ä½œï¼Œä¹‹åè¯¥çº¿ç¨‹å†è·å–é”ï¼Œåªéœ€è¦åˆ¤æ–­mark  wordä¸­æ˜¯å¦æ˜¯è‡ªå·±çš„çº¿ç¨‹idå³å¯ï¼Œè€Œä¸æ˜¯å¼€é”€ç›¸å¯¹è¾ƒå¤§çš„CASå‘½ä»¤</td></tr></tbody></table><p><strong>ä¸€æ—¦é”å‘ç”Ÿäº†ç«äº‰ï¼Œéƒ½ä¼šå‡çº§ä¸ºé‡é‡çº§é”</strong></p><h3 id="Sychronizedå’ŒReentrantLockåŒºåˆ«"><a href="#Sychronizedå’ŒReentrantLockåŒºåˆ«" class="headerlink" title="Sychronizedå’ŒReentrantLockåŒºåˆ«"></a>Sychronizedå’ŒReentrantLockåŒºåˆ«</h3><table><thead><tr><th>Sychronized</th><th>ReentrantLock</th></tr></thead><tbody><tr><td>Javaä¸­çš„ä¸€ä¸ªå…³é”®å­—</td><td>JDKæä¾›çš„ä¸€ä¸ªç±»</td></tr><tr><td>JVMå±‚é¢çš„é”</td><td>APIå±‚é¢çš„é”</td></tr><tr><td>è‡ªåŠ¨åŠ é”å’Œé‡Šæ”¾é”</td><td>æ‰‹åŠ¨åŠ é”å’Œé‡Šæ”¾é”</td></tr><tr><td>ä¸å¯è·å–å½“å‰çº¿ç¨‹æ˜¯å¦ä¸Šé”</td><td>å¯è·å–å½“å‰çº¿ç¨‹æ˜¯å¦ä¸Šé”isHeldByCurrentThread</td></tr><tr><td>éå…¬å¹³é”</td><td>éå…¬å¹³é”å’Œå…¬å¹³é”ï¼Œæ ¹æ®æ„é€ æ–¹æ³•è€Œå®š</td></tr><tr><td>ä¸å¯ä¸­æ–­</td><td>å¯ä»¥ä¸­æ–­</td></tr><tr><td>é”çš„æ˜¯å¯¹è±¡ï¼Œé”ä¿¡æ¯ä¿å­˜åœ¨å¯¹è±¡å¤´ä¸­åº•å±‚æœ‰é”å‡çº§è¿‡ç¨‹</td><td>intç±»å‹çš„stateæ ‡è¯†æ¥æ ‡è¯†é”çš„çŠ¶æ€</td></tr><tr><td>åº•å±‚æœ‰é”å‡çº§æœºåˆ¶</td><td>æ²¡æœ‰é”å‡çº§æœºåˆ¶</td></tr></tbody></table><h3 id="é”çš„çŠ¶æ€å‡çº§æ€»ç»“"><a href="#é”çš„çŠ¶æ€å‡çº§æ€»ç»“" class="headerlink" title="é”çš„çŠ¶æ€å‡çº§æ€»ç»“"></a>é”çš„çŠ¶æ€å‡çº§æ€»ç»“</h3><p>åœ¨ Java ä¸­ï¼Œé”æœ‰å››ç§çŠ¶æ€ï¼šæ— é”ï¼ˆUnlockedï¼‰ã€åå‘é”ï¼ˆBiased Lockingï¼‰ã€è½»é‡çº§é”ï¼ˆLightweight Lockingï¼‰ã€é‡é‡çº§é”ï¼ˆHeavyweight Lockingï¼‰ã€‚æ¯ç§çŠ¶æ€éƒ½æœ‰ä¸åŒçš„æ€§èƒ½ç‰¹æ€§å’Œé€‚ç”¨åœºæ™¯ï¼Œé”çš„çŠ¶æ€å¯ä»¥æ ¹æ®ç«äº‰æƒ…å†µè¿›è¡Œå‡çº§ã€‚ä»¥ä¸‹æ˜¯å¯¹è¿™å››ç§é”çŠ¶æ€çš„è¯¦ç»†è§£é‡Šï¼ŒåŒ…æ‹¬å®ƒä»¬çš„å®ç°æœºåˆ¶å’ŒçŠ¶æ€å‡çº§çš„æƒ…å†µã€‚</p><h4 id="1-æ— é”çŠ¶æ€ï¼ˆUnlockedï¼‰"><a href="#1-æ— é”çŠ¶æ€ï¼ˆUnlockedï¼‰" class="headerlink" title="1. æ— é”çŠ¶æ€ï¼ˆUnlockedï¼‰"></a>1. æ— é”çŠ¶æ€ï¼ˆUnlockedï¼‰</h4><h5 id="ç‰¹ç‚¹ï¼š"><a href="#ç‰¹ç‚¹ï¼š" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h5><ul><li><strong>åˆå§‹çŠ¶æ€</strong>ï¼šæ‰€æœ‰å¯¹è±¡é»˜è®¤å¤„äºæ— é”çŠ¶æ€ã€‚</li><li><strong>æ•ˆç‡æœ€é«˜</strong>ï¼šå› ä¸ºæ— é”çŠ¶æ€ä¸‹ä¸å­˜åœ¨é”çš„å¼€é”€ï¼Œçº¿ç¨‹å¯ä»¥ç›´æ¥è®¿é—®å¯¹è±¡ã€‚</li></ul><h5 id="å®ç°ï¼š"><a href="#å®ç°ï¼š" class="headerlink" title="å®ç°ï¼š"></a>å®ç°ï¼š</h5><ul><li><strong>Mark Word</strong>ï¼šMark Word ä¸­çš„é”æ ‡å¿—ä½ï¼ˆæœ€åä¸¤ä¸ªä½ï¼‰ä¸º 01ã€‚</li></ul><h5 id="é€‚ç”¨åœºæ™¯ï¼š"><a href="#é€‚ç”¨åœºæ™¯ï¼š" class="headerlink" title="é€‚ç”¨åœºæ™¯ï¼š"></a>é€‚ç”¨åœºæ™¯ï¼š</h5><ul><li>å¯¹è±¡ä¸éœ€è¦åŒæ­¥ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥è‡ªç”±è®¿é—®ã€‚</li></ul><h4 id="2-åå‘é”ï¼ˆBiased-Lockingï¼‰"><a href="#2-åå‘é”ï¼ˆBiased-Lockingï¼‰" class="headerlink" title="2. åå‘é”ï¼ˆBiased Lockingï¼‰"></a>2. åå‘é”ï¼ˆBiased Lockingï¼‰</h4><h5 id="ç‰¹ç‚¹ï¼š-1"><a href="#ç‰¹ç‚¹ï¼š-1" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h5><ul><li><strong>åå‘å•ä¸ªçº¿ç¨‹</strong>ï¼šå¦‚æœä¸€ä¸ªçº¿ç¨‹ç¬¬ä¸€æ¬¡è·å–é”ï¼Œé”ä¼šåå‘äºè¯¥çº¿ç¨‹ï¼Œåç»­è¯¥çº¿ç¨‹å†æ¬¡è¯·æ±‚é”æ—¶æ— éœ€åŒæ­¥æ“ä½œã€‚</li><li><strong>ä½å¼€é”€</strong>ï¼šåå‘é”çš„è·å–å’Œé‡Šæ”¾éƒ½éå¸¸å¿«ï¼Œæ²¡æœ‰ CASï¼ˆCompare-And-Swapï¼‰æ“ä½œã€‚</li></ul><h5 id="å®ç°ï¼š-1"><a href="#å®ç°ï¼š-1" class="headerlink" title="å®ç°ï¼š"></a>å®ç°ï¼š</h5><ul><li><strong>Mark Word</strong>ï¼šMark Word ä¸­å­˜å‚¨åå‘çº¿ç¨‹çš„ ID å’Œé”æ ‡å¿—ä½ä¸º 01ã€‚</li><li><strong>é”é‡åå‘</strong>ï¼šå½“åå‘çº¿ç¨‹å†æ¬¡è¿›å…¥åŒæ­¥å—æ—¶ï¼Œåªéœ€è¦æ£€æŸ¥å¯¹è±¡å¤´ä¸­çš„çº¿ç¨‹ ID æ˜¯å¦åŒ¹é…å³å¯ã€‚</li></ul><h5 id="å‡çº§æƒ…å†µï¼š"><a href="#å‡çº§æƒ…å†µï¼š" class="headerlink" title="å‡çº§æƒ…å†µï¼š"></a>å‡çº§æƒ…å†µï¼š</h5><ul><li><strong>é”æ’¤é”€</strong>ï¼šå¦‚æœå¦ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–è¯¥é”ï¼Œåå‘é”å°†è¢«æ’¤é”€ï¼Œå‡çº§ä¸ºè½»é‡çº§é”ã€‚</li></ul><h5 id="é€‚ç”¨åœºæ™¯ï¼š-1"><a href="#é€‚ç”¨åœºæ™¯ï¼š-1" class="headerlink" title="é€‚ç”¨åœºæ™¯ï¼š"></a>é€‚ç”¨åœºæ™¯ï¼š</h5><ul><li>åŒæ­¥å—æ€»æ˜¯ç”±åŒä¸€ä¸ªçº¿ç¨‹è¿›å…¥ï¼Œæ²¡æœ‰ç«äº‰çš„æƒ…å†µã€‚</li></ul><h4 id="3-è½»é‡çº§é”ï¼ˆLightweight-Lockingï¼‰"><a href="#3-è½»é‡çº§é”ï¼ˆLightweight-Lockingï¼‰" class="headerlink" title="3. è½»é‡çº§é”ï¼ˆLightweight Lockingï¼‰"></a>3. è½»é‡çº§é”ï¼ˆLightweight Lockingï¼‰</h4><h5 id="ç‰¹ç‚¹ï¼š-2"><a href="#ç‰¹ç‚¹ï¼š-2" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h5><ul><li><strong>ç«äº‰å°‘</strong>ï¼šé€‚ç”¨äºå°‘é‡ç«äº‰çš„åœºæ™¯ã€‚</li><li><strong>è‡ªæ—‹ç­‰å¾…</strong>ï¼šçº¿ç¨‹å°è¯•è·å–é”æ—¶ï¼Œå¦‚æœé”å·²ç»è¢«æŒæœ‰ï¼Œå°†é€šè¿‡è‡ªæ—‹ï¼ˆå¿™ç­‰å¾…ï¼‰æ¥ç­‰å¾…é”çš„é‡Šæ”¾ï¼Œè€Œä¸æ˜¯ç›´æ¥é˜»å¡ã€‚</li></ul><h5 id="å®ç°ï¼š-2"><a href="#å®ç°ï¼š-2" class="headerlink" title="å®ç°ï¼š"></a>å®ç°ï¼š</h5><ul><li><strong>Mark Word</strong>ï¼šMark Word ä¸­çš„é”æ ‡å¿—ä½ä¸º 00ã€‚</li><li><strong>é”è®°å½•</strong>ï¼šçº¿ç¨‹å°†å¯¹è±¡å¤´ä¸­çš„ Mark Word å¤åˆ¶åˆ°è‡ªå·±çš„æ ˆå¸§ä¸­çš„é”è®°å½•ï¼ˆLock Recordï¼‰ä¸­ï¼Œç„¶åå°è¯•ä½¿ç”¨ CAS æ“ä½œå°†å¯¹è±¡å¤´ä¸­çš„ Mark Word æ›¿æ¢ä¸ºæŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆã€‚</li><li><strong>é‡Šæ”¾é”</strong>ï¼šé”é‡Šæ”¾æ—¶ï¼Œä¼šå°†é”è®°å½•ä¸­çš„å†…å®¹æ¢å¤åˆ°å¯¹è±¡å¤´ä¸­ã€‚</li></ul><h5 id="å‡çº§æƒ…å†µï¼š-1"><a href="#å‡çº§æƒ…å†µï¼š-1" class="headerlink" title="å‡çº§æƒ…å†µï¼š"></a>å‡çº§æƒ…å†µï¼š</h5><ul><li><strong>è†¨èƒ€ä¸ºé‡é‡çº§é”</strong>ï¼šå¦‚æœè‡ªæ—‹ä¸€å®šæ¬¡æ•°åä»æœªè·å–åˆ°é”ï¼Œè½»é‡çº§é”ä¼šè†¨èƒ€ä¸ºé‡é‡çº§é”ï¼Œçº¿ç¨‹ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚</li></ul><h5 id="é€‚ç”¨åœºæ™¯ï¼š-2"><a href="#é€‚ç”¨åœºæ™¯ï¼š-2" class="headerlink" title="é€‚ç”¨åœºæ™¯ï¼š"></a>é€‚ç”¨åœºæ™¯ï¼š</h5><ul><li>é€‚ç”¨äºç«äº‰ä¸æ¿€çƒˆä¸”åŒæ­¥å—æ‰§è¡Œæ—¶é—´çŸ­çš„æƒ…å†µã€‚</li></ul><h4 id="4-é‡é‡çº§é”ï¼ˆHeavyweight-Lockingï¼‰"><a href="#4-é‡é‡çº§é”ï¼ˆHeavyweight-Lockingï¼‰" class="headerlink" title="4. é‡é‡çº§é”ï¼ˆHeavyweight Lockingï¼‰"></a>4. é‡é‡çº§é”ï¼ˆHeavyweight Lockingï¼‰</h4><h5 id="ç‰¹ç‚¹ï¼š-3"><a href="#ç‰¹ç‚¹ï¼š-3" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h5><ul><li><strong>é«˜ç«äº‰</strong>ï¼šé€‚ç”¨äºç«äº‰æ¿€çƒˆçš„åœºæ™¯ã€‚</li><li><strong>çº¿ç¨‹é˜»å¡</strong>ï¼šçº¿ç¨‹æ— æ³•è·å–é”æ—¶ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚</li></ul><h5 id="å®ç°ï¼š-3"><a href="#å®ç°ï¼š-3" class="headerlink" title="å®ç°ï¼š"></a>å®ç°ï¼š</h5><ul><li><strong>Mark Word</strong>ï¼šMark Word ä¸­çš„é”æ ‡å¿—ä½ä¸º 10ã€‚</li><li><strong>ç›‘è§†å™¨ï¼ˆMonitorï¼‰</strong>ï¼šçº¿ç¨‹è·å–é”å¤±è´¥æ—¶ï¼Œä¼šè¢«åŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ï¼ˆ_EntryListï¼‰ä¸­ï¼Œè¿›å…¥é˜»å¡çŠ¶æ€ã€‚</li></ul><h5 id="å‡çº§æƒ…å†µï¼š-2"><a href="#å‡çº§æƒ…å†µï¼š-2" class="headerlink" title="å‡çº§æƒ…å†µï¼š"></a>å‡çº§æƒ…å†µï¼š</h5><ul><li><strong>æ— é™çº§</strong>ï¼šé‡é‡çº§é”ä¸€æ—¦å½¢æˆï¼Œä¸ä¼šé™çº§å›è½»é‡çº§é”æˆ–åå‘é”ã€‚</li></ul><h5 id="é€‚ç”¨åœºæ™¯ï¼š-3"><a href="#é€‚ç”¨åœºæ™¯ï¼š-3" class="headerlink" title="é€‚ç”¨åœºæ™¯ï¼š"></a>é€‚ç”¨åœºæ™¯ï¼š</h5><ul><li>é€‚ç”¨äºé«˜ç«äº‰ã€é•¿æ—¶é—´å ç”¨é”çš„åœºæ™¯ã€‚</li></ul><h4 id="é”çš„çŠ¶æ€è½¬æ¢æµç¨‹"><a href="#é”çš„çŠ¶æ€è½¬æ¢æµç¨‹" class="headerlink" title="é”çš„çŠ¶æ€è½¬æ¢æµç¨‹"></a>é”çš„çŠ¶æ€è½¬æ¢æµç¨‹</h4><ol><li><strong>æ— é”åˆ°åå‘é”</strong>ï¼šå½“ä¸€ä¸ªçº¿ç¨‹é¦–æ¬¡è·å–å¯¹è±¡é”æ—¶ï¼Œé”ä¼šåå‘è¯¥çº¿ç¨‹ã€‚</li><li><strong>åå‘é”åˆ°è½»é‡çº§é”</strong>ï¼šå½“å¦ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–åå‘é”æ—¶ï¼Œåå‘é”ä¼šè¢«æ’¤é”€ï¼Œæ‰€æœ‰æŒæœ‰åå‘é”çš„çº¿ç¨‹ä¼šé‡æ–°ç«äº‰è½»é‡çº§é”ã€‚</li><li><strong>è½»é‡çº§é”åˆ°é‡é‡çº§é”</strong>ï¼šå¦‚æœè½»é‡çº§é”ç«äº‰æ¿€çƒˆï¼Œè‡ªæ—‹ç­‰å¾…æœªæˆåŠŸæ—¶ï¼Œè½»é‡çº§é”ä¼šè†¨èƒ€ä¸ºé‡é‡çº§é”ï¼Œçº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚</li><li><strong>é‡é‡çº§é”çš„é‡Šæ”¾</strong>ï¼šé‡é‡çº§é”é‡Šæ”¾åï¼Œå¦‚æœæœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œ<code>JVM</code> ä¼šå”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹æ¥ç«äº‰é”ã€‚</li></ol><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>é”çš„çŠ¶æ€åœ¨æ— é”ã€åå‘é”ã€è½»é‡çº§é”å’Œé‡é‡çº§é”ä¹‹é—´çš„è½¬æ¢æ˜¯æ ¹æ®çº¿ç¨‹ç«äº‰æƒ…å†µåŠ¨æ€è¿›è¡Œçš„ï¼Œä»¥å¹³è¡¡æ€§èƒ½å’Œèµ„æºå ç”¨ã€‚æ— ç«äº‰æ—¶é‡‡ç”¨åå‘é”å’Œè½»é‡çº§é”ï¼Œä»¥å‡å°‘åŒæ­¥å¼€é”€ï¼›é«˜ç«äº‰æ—¶é‡‡ç”¨é‡é‡çº§é”ï¼Œä»¥é¿å…å¤§é‡çš„è‡ªæ—‹ç­‰å¾…é€ æˆçš„ CPU èµ„æºæµªè´¹ã€‚ç†è§£è¿™äº›æœºåˆ¶æœ‰åŠ©äºä¼˜åŒ–å¤šçº¿ç¨‹ç¨‹åºçš„æ€§èƒ½ã€‚</p><h3 id="2-3ä½ è°ˆè°ˆ-JMMï¼ˆJava-å†…å­˜æ¨¡å‹ï¼‰"><a href="#2-3ä½ è°ˆè°ˆ-JMMï¼ˆJava-å†…å­˜æ¨¡å‹ï¼‰" class="headerlink" title="2.3ä½ è°ˆè°ˆ JMMï¼ˆJava å†…å­˜æ¨¡å‹ï¼‰"></a>2.3ä½ è°ˆè°ˆ JMMï¼ˆJava å†…å­˜æ¨¡å‹ï¼‰</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><p>JMM(Java Memory Model)<mark>Javaå†…å­˜æ¨¡å‹</mark>,æ˜¯javaè™šæ‹Ÿæœºè§„èŒƒä¸­æ‰€å®šä¹‰çš„ä¸€ç§å†…å­˜æ¨¡å‹ã€‚</p><p>Javaå†…å­˜æ¨¡å‹(Java Memory Model)æè¿°äº†Javaç¨‹åºä¸­å„ç§å˜é‡(çº¿ç¨‹å…±äº«å˜é‡)çš„è®¿é—®è§„åˆ™ï¼Œä»¥åŠåœ¨JVMä¸­å°†å˜é‡å­˜å‚¨åˆ°å†…å­˜å’Œä»å†…å­˜ä¸­è¯»å–å˜é‡è¿™æ ·çš„åº•å±‚ç»†èŠ‚ã€‚</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504181638237.png" alt="image-20230504181638237"></p><p>ç‰¹ç‚¹ï¼š</p><ol><li><p>æ‰€æœ‰çš„å…±äº«å˜é‡éƒ½å­˜å‚¨äºä¸»å†…å­˜(è®¡ç®—æœºçš„RAM)è¿™é‡Œæ‰€è¯´çš„å˜é‡æŒ‡çš„æ˜¯å®ä¾‹å˜é‡å’Œç±»å˜é‡ã€‚ä¸åŒ…å«å±€éƒ¨å˜é‡ï¼Œå› ä¸ºå±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå› æ­¤ä¸å­˜åœ¨ç«äº‰é—®é¢˜ã€‚</p></li><li><p>æ¯ä¸€ä¸ªçº¿ç¨‹è¿˜å­˜åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹çš„å·¥ä½œå†…å­˜ï¼Œä¿ç•™äº†è¢«çº¿ç¨‹ä½¿ç”¨çš„å˜é‡çš„å·¥ä½œå‰¯æœ¬ã€‚</p></li><li><p>çº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰çš„æ“ä½œ(è¯»ï¼Œå†™)éƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­å®Œæˆï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´ä¹Ÿä¸èƒ½ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡çš„å€¼çš„ä¼ é€’éœ€è¦é€šè¿‡ä¸»å†…å­˜å®Œæˆã€‚</p></li></ol><p>ğŸ”´ğŸŸ¡ğŸŸ¢æ€»ç»“ï¼š</p><ul><li>JMM(Java Memory Model)<mark>Javaå†…å­˜æ¨¡å‹</mark>ï¼Œå®šä¹‰äº†<mark>å…±äº«å†…å­˜</mark>ä¸­<mark>å¤šçº¿ç¨‹ç¨‹åºè¯»å†™æ“ä½œçš„è¡Œä¸ºè§„èŒƒ</mark>ï¼Œé€šè¿‡è¿™äº›è§„åˆ™æ¥è§„èŒƒå¯¹å†…å­˜çš„è¯»å†™æ“ä½œä»è€Œä¿è¯æŒ‡ä»¤çš„æ­£ç¡®æ€§ã€‚</li><li>JMMæŠŠå†…å­˜åˆ†ä¸ºä¸¤å—ï¼Œä¸€å—æ˜¯ç§æœ‰çº¿ç¨‹çš„å·¥ä½œåŒºåŸŸ(<mark>å·¥ä½œå†…å­˜</mark>)ï¼Œä¸€å—æ˜¯æ‰€æœ‰çº¿ç¨‹çš„å…±äº«åŒºåŸŸ(<mark>ä¸»å†…å­˜</mark>)</li><li>çº¿ç¨‹è·Ÿçº¿ç¨‹ä¹‹é—´æ˜¯<mark>ç›¸äº’éš”ç¦»</mark>ï¼Œçº¿ç¨‹è·Ÿçº¿ç¨‹<mark>äº¤äº’éœ€è¦é€šè¿‡ä¸»å†…å­˜</mark></li></ul><h3 id="2-4-CAS-ä½ çŸ¥é“å—ï¼Ÿ"><a href="#2-4-CAS-ä½ çŸ¥é“å—ï¼Ÿ" class="headerlink" title="2.4 CAS ä½ çŸ¥é“å—ï¼Ÿ"></a>2.4 CAS ä½ çŸ¥é“å—ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†</p></blockquote><h4 id="2-4-1-æ¦‚è¿°åŠåŸºæœ¬å·¥ä½œæµç¨‹"><a href="#2-4-1-æ¦‚è¿°åŠåŸºæœ¬å·¥ä½œæµç¨‹" class="headerlink" title="2.4.1 æ¦‚è¿°åŠåŸºæœ¬å·¥ä½œæµç¨‹"></a>2.4.1 æ¦‚è¿°åŠåŸºæœ¬å·¥ä½œæµç¨‹</h4><p>CASçš„å…¨ç§°æ˜¯ï¼š Compare And Swap(æ¯”è¾ƒå†äº¤æ¢)ï¼Œå®ƒä½“ç°çš„ä¸€ç§ä¹è§‚é”çš„æ€æƒ³ï¼Œåœ¨æ— é”æƒ…å†µä¸‹ä¿è¯çº¿ç¨‹æ“ä½œå…±äº«æ•°æ®çš„åŸå­æ€§ã€‚</p><p>åœ¨JUCï¼ˆ java.util.concurrent ï¼‰åŒ…ä¸‹å®ç°çš„å¾ˆå¤šç±»éƒ½ç”¨åˆ°äº†CASæ“ä½œ</p><ul><li><p>AbstractQueuedSynchronizerï¼ˆAQSæ¡†æ¶ï¼‰</p></li><li><p>AtomicXXXç±»</p></li></ul><p>ä¾‹å­ï¼š</p><p>æˆ‘ä»¬è¿˜æ˜¯åŸºäºåˆšæ‰å­¦ä¹ è¿‡çš„JMMå†…å­˜æ¨¡å‹è¿›è¡Œè¯´æ˜</p><ul><li>çº¿ç¨‹1ä¸çº¿ç¨‹2éƒ½ä»ä¸»å†…å­˜ä¸­è·å–å˜é‡int a &#x3D; 100,åŒæ—¶æ”¾åˆ°å„ä¸ªçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­</li></ul><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504181947319.png" alt="image-20230504181947319"></p><blockquote><p>ä¸€ä¸ªå½“å‰å†…å­˜å€¼Vã€æ—§çš„é¢„æœŸå€¼Aã€å³å°†æ›´æ–°çš„å€¼Bï¼Œå½“ä¸”ä»…å½“æ—§çš„é¢„æœŸå€¼Aå’Œå†…å­˜å€¼Vç›¸åŒæ—¶ï¼Œå°†å†…å­˜å€¼ä¿®æ”¹ä¸ºBå¹¶è¿”å›trueï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸åšï¼Œå¹¶è¿”å›falseã€‚å¦‚æœCASæ“ä½œå¤±è´¥ï¼Œé€šè¿‡è‡ªæ—‹çš„æ–¹å¼ç­‰å¾…å¹¶å†æ¬¡å°è¯•ï¼Œç›´åˆ°æˆåŠŸ</p></blockquote><ul><li>çº¿ç¨‹1æ“ä½œï¼šVï¼šint a &#x3D; 100ï¼ŒAï¼šint a &#x3D; 100ï¼ŒBï¼šä¿®æ”¹åçš„å€¼ï¼šint a &#x3D; 101 (a++)<ul><li>çº¿ç¨‹1æ‹¿Açš„å€¼ä¸ä¸»å†…å­˜Vçš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦ç›¸ç­‰</li><li>å¦‚æœç›¸ç­‰ï¼Œåˆ™æŠŠBçš„å€¼101æ›´æ–°åˆ°ä¸»å†…å­˜ä¸­</li></ul></li></ul><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504182129820.png" alt="image-20230504182129820"></p><ul><li>çº¿ç¨‹2æ“ä½œï¼šVï¼šint a &#x3D; 100ï¼ŒAï¼šint a &#x3D; 100ï¼ŒBï¼šä¿®æ”¹åçš„å€¼ï¼šint a &#x3D; 99(aâ€“)<ul><li>çº¿ç¨‹2æ‹¿Açš„å€¼ä¸ä¸»å†…å­˜Vçš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦ç›¸ç­‰(ç›®å‰ä¸ç›¸ç­‰ï¼Œå› ä¸ºçº¿ç¨‹1å·²æ›´æ–°Vçš„å€¼99)</li><li>ä¸ç›¸ç­‰ï¼Œåˆ™çº¿ç¨‹2æ›´æ–°å¤±è´¥</li></ul></li></ul><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504181827330.png" alt="image-20230504181827330"></p><ul><li><p>è‡ªæ—‹é”æ“ä½œ</p><ul><li><p>å› ä¸ºæ²¡æœ‰åŠ é”ï¼Œæ‰€ä»¥çº¿ç¨‹ä¸ä¼šé™·å…¥é˜»å¡ï¼Œæ•ˆç‡è¾ƒé«˜</p></li><li><p>å¦‚æœç«äº‰æ¿€çƒˆï¼Œé‡è¯•é¢‘ç¹å‘ç”Ÿï¼Œæ•ˆç‡ä¼šå—å½±å“</p></li></ul></li></ul><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504182447552.png" alt="image-20230504182447552"></p><p>éœ€è¦ä¸æ–­å°è¯•è·å–å…±äº«å†…å­˜Vä¸­æœ€æ–°çš„å€¼ï¼Œç„¶åå†åœ¨æ–°çš„å€¼çš„åŸºç¡€ä¸Šè¿›è¡Œæ›´æ–°æ“ä½œï¼Œå¦‚æœå¤±è´¥å°±ç»§ç»­å°è¯•è·å–æ–°çš„å€¼ï¼Œç›´åˆ°æ›´æ–°æˆåŠŸ</p><h4 id="2-4-2-CAS-åº•å±‚å®ç°"><a href="#2-4-2-CAS-åº•å±‚å®ç°" class="headerlink" title="2.4.2 CAS åº•å±‚å®ç°"></a>2.4.2 CAS åº•å±‚å®ç°</h4><p>CAS åº•å±‚ä¾èµ–äºä¸€ä¸ª Unsafe ç±»æ¥ç›´æ¥è°ƒç”¨æ“ä½œç³»ç»Ÿåº•å±‚çš„ CAS æŒ‡ä»¤</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504182737931.png" alt="image-20230504182737931"></p><p>éƒ½æ˜¯nativeä¿®é¥°çš„æ–¹æ³•ï¼Œç”±ç³»ç»Ÿæä¾›çš„æ¥å£æ‰§è¡Œï¼Œå¹¶éjavaä»£ç å®ç°ï¼Œä¸€èˆ¬çš„æ€è·¯ä¹Ÿéƒ½æ˜¯è‡ªæ—‹é”å®ç°</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504182838426.png" alt="image-20230504182838426"></p><p>åœ¨javaä¸­æ¯”è¾ƒå¸¸è§ä½¿ç”¨æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ReentrantLockå’ŒAtomicå¼€å¤´çš„çº¿ç¨‹å®‰å…¨ç±»ï¼Œéƒ½è°ƒç”¨äº†Unsafeä¸­çš„æ–¹æ³•</p><ul><li>ReentrantLockä¸­çš„ä¸€æ®µCASä»£ç </li></ul><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230504182958703.png" alt="image-20230504182958703"></p><h4 id="2-4-3-ä¹è§‚é”å’Œæ‚²è§‚é”çš„åŒºåˆ«"><a href="#2-4-3-ä¹è§‚é”å’Œæ‚²è§‚é”çš„åŒºåˆ«" class="headerlink" title="2.4.3 ä¹è§‚é”å’Œæ‚²è§‚é”çš„åŒºåˆ«"></a>2.4.3 ä¹è§‚é”å’Œæ‚²è§‚é”çš„åŒºåˆ«</h4><ul><li><p>CAS æ˜¯åŸºäºä¹è§‚é”çš„æ€æƒ³ï¼šæœ€ä¹è§‚çš„ä¼°è®¡ï¼Œä¸æ€•åˆ«çš„çº¿ç¨‹æ¥ä¿®æ”¹å…±äº«å˜é‡ï¼Œå°±ç®—æ”¹äº†ä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘åƒäºç‚¹å†é‡è¯•å‘—ã€‚</p></li><li><p>synchronized æ˜¯åŸºäºæ‚²è§‚é”çš„æ€æƒ³ï¼šæœ€æ‚²è§‚çš„ä¼°è®¡ï¼Œå¾—é˜²ç€å…¶å®ƒçº¿ç¨‹æ¥ä¿®æ”¹å…±äº«å˜é‡ï¼Œæˆ‘ä¸Šäº†é”ä½ ä»¬éƒ½åˆ«æƒ³æ”¹ï¼Œæˆ‘æ”¹å®Œäº†è§£å¼€é”ï¼Œä½ ä»¬æ‰æœ‰æœºä¼šã€‚</p></li></ul><p>ğŸ”´ğŸŸ¡ğŸŸ¢æ€»ç»“ï¼š</p><ul><li>CASçš„å…¨ç§°æ˜¯: Compare And Swap(æ¯”è¾ƒå†äº¤æ¢)å®ƒä½“ç°çš„ä¸€ç§ä¹è§‚é”çš„æ€æƒ³<mark>åœ¨æ— é”çŠ¶æ€ä¸‹ä¿è¯çº¿ç¨‹æ“ä½œæ•°æ®çš„åŸå­æ€§</mark>ã€‚</li><li>CASä½¿ç”¨åˆ°çš„åœ°æ–¹å¾ˆå¤š: AQSæ¡†æ¶ã€AtomicXXXç±»</li><li>åœ¨æ“ä½œå…±äº«å˜é‡çš„æ—¶å€™ä½¿ç”¨çš„è‡ªæ—‹é”ï¼Œæ•ˆç‡ä¸Šæ›´é«˜ä¸€äº›ï¼ˆ<mark>å› ä¸ºæ²¡æœ‰åŠ é”æ‰€ä»¥æ•ˆç‡é«˜</mark>ï¼‰</li><li>CASçš„åº•å±‚æ˜¯è°ƒç”¨çš„<mark>Unsafe</mark>ç±»ä¸­çš„æ–¹æ³•ï¼Œéƒ½æ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„ï¼Œå…¶ä»–è¯­è¨€å®ç°</li><li>ä¹è§‚é”å’Œæ‚²è§‚é”çš„åŒºåˆ«å¦‚ä¸ŠğŸ‘†</li></ul><p>ğŸ”´ğŸŸ¡ğŸŸ¢è¡¥å……ï¼š</p><p><strong>é‡é‡çº§é”ã€è½»é‡çº§é”ã€å’Œåå‘æ€§é”</strong>æ˜¯Javaä¸­ç”¨äºå®ç°çº¿ç¨‹åŒæ­¥çš„ä¸åŒé”çŠ¶æ€ï¼Œå®ƒä»¬åœ¨æ€§èƒ½å’Œåº”ç”¨åœºæ™¯ä¸Šæœ‰ä¸€äº›åŒºåˆ«ã€‚ä»¥ä¸‹æ˜¯å®ƒä»¬çš„åŸºæœ¬æ¦‚å¿µå’ŒåŒºåˆ«ï¼š</p><ol><li><p><strong>åå‘æ€§é”ï¼ˆBiased Lockingï¼‰ï¼š</strong></p><ul><li><strong>æ¦‚å¿µï¼š</strong> åå‘æ€§é”æ˜¯ä¸ºäº†åœ¨æ— ç«äº‰çš„æƒ…å†µä¸‹æé«˜æ€§èƒ½è€Œå¼•å…¥çš„ã€‚å®ƒå‡è®¾åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ã€‚</li><li><strong>å·¥ä½œåŸç†ï¼š</strong> å½“ä¸€ä¸ªçº¿ç¨‹ç¬¬ä¸€æ¬¡è®¿é—®ä¸€ä¸ªåŒæ­¥å—æ—¶ï¼Œåå‘æ€§é”ä¼šè®°å½•è¯¥çº¿ç¨‹çš„IDï¼Œå¹¶å°†å¯¹è±¡å¤´çš„Mark Word è®¾ç½®ä¸ºåå‘é”ã€‚ä»¥åè¯¥çº¿ç¨‹å†æ¬¡è¿›å…¥åŒæ­¥å—æ—¶ï¼Œä¸å†è¿›è¡Œç«äº‰ï¼Œç›´æ¥è·å–é”ï¼Œé¿å…äº†é‡é‡çº§é”çš„ç«äº‰å¼€é”€ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> ä¸»è¦é€‚ç”¨äºå•çº¿ç¨‹æˆ–è€…åªæœ‰ä¸€ä¸ªçº¿ç¨‹é¢‘ç¹è®¿é—®åŒæ­¥å—çš„æƒ…å†µã€‚</li></ul></li><li><p><strong>è½»é‡çº§é”ï¼ˆLightweight Lockingï¼‰ï¼š</strong></p><ul><li><strong>æ¦‚å¿µï¼š</strong> è½»é‡çº§é”æ˜¯ä¸ºäº†åœ¨æœ‰å°‘é‡ç«äº‰çš„æƒ…å†µä¸‹æé«˜æ€§èƒ½ã€‚å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªåŒæ­¥å—æ—¶ï¼Œä¼šä½¿ç”¨è½»é‡çº§é”æ¥å‡å°ç«äº‰çš„ä»£ä»·ã€‚</li><li><strong>å·¥ä½œåŸç†ï¼š</strong> å½“çº¿ç¨‹å°è¯•è·å–è½»é‡çº§é”æ—¶ï¼Œä¼šå°†å¯¹è±¡å¤´çš„Mark Word å¤åˆ¶åˆ°çº¿ç¨‹çš„æ ˆå¸§ä¸­ï¼Œå¹¶å°è¯•ç”¨CASï¼ˆCompare And Swapï¼‰åŸå­æŒ‡ä»¤å°†å¯¹è±¡å¤´çš„Mark Word æ›¿æ¢ä¸ºæŒ‡å‘çº¿ç¨‹æ ˆå¸§çš„æŒ‡é’ˆã€‚å¦‚æœæ›¿æ¢æˆåŠŸï¼Œçº¿ç¨‹å°±è·å¾—äº†è½»é‡çº§é”ï¼›å¦åˆ™ï¼Œè½¬ä¸ºé‡é‡çº§é”ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> é€‚ç”¨äºçº¿ç¨‹äº¤æ›¿æ‰§è¡ŒåŒæ­¥å—çš„æƒ…å†µï¼Œç«äº‰ä¸æ¿€çƒˆã€‚</li></ul></li><li><p><strong>é‡é‡çº§é”ï¼ˆHeavyweight Lockingï¼‰ï¼š</strong></p><ul><li><strong>æ¦‚å¿µï¼š</strong> é‡é‡çº§é”æ˜¯ä¸€ç§ä¼ ç»Ÿçš„é”æœºåˆ¶ï¼Œåœ¨å¤šçº¿ç¨‹ç«äº‰æ¿€çƒˆçš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œå®ƒä¼šå¼•å…¥é˜»å¡æ¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¿›å…¥ä¸´ç•ŒåŒºã€‚</li><li><strong>å·¥ä½œåŸç†ï¼š</strong> å½“çº¿ç¨‹å°è¯•è·å–é‡é‡çº§é”æ—¶ï¼Œå¦‚æœè½»é‡çº§é”è·å–å¤±è´¥ï¼Œä¼šå‡çº§ä¸ºé‡é‡çº§é”ã€‚æ­¤æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å°†è¢«é˜»å¡ï¼Œåªæœ‰æ‹¥æœ‰é”çš„çº¿ç¨‹å¯ä»¥æ‰§è¡ŒåŒæ­¥å—å†…çš„ä»£ç ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> é€‚ç”¨äºé«˜åº¦ç«äº‰çš„æƒ…å†µï¼Œå¤šä¸ªçº¿ç¨‹é¢‘ç¹ç«äº‰åŒä¸€ä¸ªé”ã€‚</li></ul></li></ol><p>æ€»çš„æ¥è¯´ï¼Œåå‘æ€§é”é€‚ç”¨äºå•çº¿ç¨‹åœºæ™¯ï¼Œè½»é‡çº§é”é€‚ç”¨äºä½ç«äº‰åœºæ™¯ï¼Œè€Œé‡é‡çº§é”é€‚ç”¨äºé«˜ç«äº‰åœºæ™¯ã€‚Javaçš„é”æœºåˆ¶åœ¨è¿è¡Œæ—¶ä¼šæ ¹æ®å®é™…æƒ…å†µè‡ªåŠ¨é€‰æ‹©ä½¿ç”¨å“ªç§é”çŠ¶æ€ï¼Œä»¥å¹³è¡¡æ€§èƒ½å’Œç«äº‰çš„å¼€é”€ã€‚</p><hr><h3 id="2-5-è¯·è°ˆè°ˆä½ å¯¹-volatile-çš„ç†è§£"><a href="#2-5-è¯·è°ˆè°ˆä½ å¯¹-volatile-çš„ç†è§£" class="headerlink" title="2.5 è¯·è°ˆè°ˆä½ å¯¹ volatile çš„ç†è§£"></a>2.5 è¯·è°ˆè°ˆä½ å¯¹ volatile çš„ç†è§£</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><p>ä¸€æ—¦ä¸€ä¸ªå…±äº«å˜é‡ï¼ˆç±»çš„æˆå‘˜å˜é‡ã€ç±»çš„é™æ€æˆå‘˜å˜é‡ï¼‰è¢«volatileä¿®é¥°ä¹‹åï¼Œé‚£ä¹ˆå°±å…·å¤‡äº†ä¸¤å±‚è¯­ä¹‰ï¼š</p><h4 id="2-5-1-ä¿è¯çº¿ç¨‹é—´çš„å¯è§æ€§"><a href="#2-5-1-ä¿è¯çº¿ç¨‹é—´çš„å¯è§æ€§" class="headerlink" title="2.5.1 ä¿è¯çº¿ç¨‹é—´çš„å¯è§æ€§"></a>2.5.1 ä¿è¯çº¿ç¨‹é—´çš„å¯è§æ€§</h4><p>ä¿è¯äº†ä¸åŒçº¿ç¨‹å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œæ“ä½œæ—¶çš„å¯è§æ€§ï¼Œå³ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå˜é‡çš„å€¼ï¼Œè¿™æ–°å€¼å¯¹å…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯ç«‹å³å¯è§çš„,volatileå…³é”®å­—ä¼šå¼ºåˆ¶å°†ä¿®æ”¹çš„å€¼ç«‹å³å†™å…¥ä¸»å­˜ã€‚</p><p>ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼šæ°¸ä¸åœæ­¢çš„å¾ªç¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.basic;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯è§æ€§ä¾‹å­</span></span><br><span class="line"><span class="comment">// -Xint</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ForeverLoop</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">boolean</span> <span class="variable">stop</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            stop = <span class="literal">true</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;modify stop to true...&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line">        foo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!stop) &#123;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;stopped... c:&quot;</span>+ i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ‰§è¡Œä¸Šè¿°ä»£ç çš„æ—¶å€™ï¼Œå‘ç°foo()æ–¹æ³•ä¸­çš„å¾ªç¯æ˜¯ç»“æŸä¸äº†çš„ï¼Œä¹Ÿå°±è¯´è¯»å–ä¸åˆ°å…±äº«å˜é‡çš„å€¼ç»“æŸå¾ªç¯ã€‚</p><p>ä¸»è¦æ˜¯å› ä¸ºåœ¨JVMè™šæ‹Ÿæœºä¸­æœ‰ä¸€ä¸ªJITï¼ˆå³æ—¶ç¼–è¾‘å™¨ï¼‰ç»™ä»£ç åšäº†ä¼˜åŒ–ã€‚</p><blockquote><p>ä¸Šè¿°ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">while</span> (!stop) &#123;</span><br><span class="line">&gt;i++;</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…ï¼Œè¿™ä¸ªä»£ç æ‰§è¡Œçš„æ¬¡æ•°å¤ªå¤šäº†ï¼Œå½“è¾¾åˆ°äº†ä¸€ä¸ªé˜ˆå€¼ï¼ŒJITå°±ä¼šä¼˜åŒ–æ­¤ä»£ç ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">&gt;i++;</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure><p>å½“æŠŠä»£ç ä¼˜åŒ–æˆè¿™æ ·å­ä»¥åï¼ŒåŠæ—¶<code>stop</code>å˜é‡æ”¹å˜ä¸ºäº†<code>false</code>ä¹Ÿä¾ç„¶åœæ­¢ä¸äº†å¾ªç¯</p></blockquote><p>è§£å†³æ–¹æ¡ˆï¼š</p><p>ç¬¬ä¸€ï¼š</p><p>åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™åŠ å…¥vmå‚æ•°<code>-Xint</code>è¡¨ç¤ºç¦ç”¨å³æ—¶ç¼–è¾‘å™¨ï¼Œä¸æ¨èï¼Œå¾—ä¸å¿å¤±ï¼ˆå…¶ä»–ç¨‹åºè¿˜è¦ä½¿ç”¨ï¼‰</p><p>ç¬¬äºŒï¼š</p><p>åœ¨ä¿®é¥°<code>stop</code>å˜é‡çš„æ—¶å€™åŠ ä¸Š<code>volatile</code>,è¡¨ç¤ºå½“å‰ä»£ç ç¦ç”¨äº†å³æ—¶ç¼–è¾‘å™¨ï¼Œé—®é¢˜å°±å¯ä»¥è§£å†³ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">stop</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><h4 id="2-5-2-ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åº"><a href="#2-5-2-ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åº" class="headerlink" title="2.5.2 ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åº"></a>2.5.2 ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åº</h4><p>ç”¨ volatile ä¿®é¥°å…±äº«å˜é‡ä¼šåœ¨è¯»ã€å†™å…±äº«å˜é‡æ—¶åŠ å…¥ä¸åŒçš„å±éšœï¼Œé˜»æ­¢å…¶ä»–è¯»å†™æ“ä½œè¶Šè¿‡å±éšœï¼Œä»è€Œè¾¾åˆ°é˜»æ­¢é‡æ’åºçš„æ•ˆæœ</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505082441116.png" alt="image-20230505082441116"></p><p>åœ¨å»è·å–ä¸Šé¢çš„ç»“æœçš„æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°4ç§æƒ…å†µ</p><p>æƒ…å†µä¸€ï¼šå…ˆæ‰§è¡Œactor2è·å–ç»“æœâ€”&gt;0,0(æ­£å¸¸)</p><p>æƒ…å†µäºŒï¼šå…ˆæ‰§è¡Œactor1ä¸­çš„ç¬¬ä¸€è¡Œä»£ç ï¼Œç„¶åæ‰§è¡Œactor2è·å–ç»“æœâ€”&gt;0,1(æ­£å¸¸)</p><p>æƒ…å†µä¸‰ï¼šå…ˆæ‰§è¡Œactor1ä¸­æ‰€æœ‰ä»£ç ï¼Œç„¶åæ‰§è¡Œactor2è·å–ç»“æœâ€”&gt;1,1(æ­£å¸¸)</p><p>æƒ…å†µå››ï¼šå…ˆæ‰§è¡Œactor1ä¸­ç¬¬äºŒè¡Œä»£ç ï¼Œç„¶åæ‰§è¡Œactor2è·å–ç»“æœâ€”&gt;1,0(å‘ç”Ÿäº†æŒ‡ä»¤é‡æ’åºï¼Œå½±å“ç»“æœ)</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><p>åœ¨å˜é‡ä¸Šæ·»åŠ volatileï¼Œç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œåˆ™å¯ä»¥è§£å†³é—®é¢˜</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505082835588.png" alt="image-20230505082835588"></p><p>å±éšœæ·»åŠ çš„ç¤ºæ„å›¾</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505082923729.png" alt="image-20230505082923729"></p><ul><li>å†™æ“ä½œåŠ çš„å±éšœæ˜¯é˜»æ­¢ä¸Šæ–¹å…¶å®ƒå†™æ“ä½œè¶Šè¿‡å±éšœæ’åˆ°volatileå˜é‡å†™ä¹‹ä¸‹</li><li>è¯»æ“ä½œåŠ çš„å±éšœæ˜¯é˜»æ­¢ä¸‹æ–¹å…¶å®ƒè¯»æ“ä½œè¶Šè¿‡å±éšœæ’åˆ°volatileå˜é‡è¯»ä¹‹ä¸Š</li></ul><p><strong>å…¶ä»–è¡¥å……</strong></p><p>æˆ‘ä»¬ä¸Šé¢çš„è§£å†³æ–¹æ¡ˆæ˜¯æŠŠvolatileåŠ åœ¨äº†int yè¿™ä¸ªå˜é‡ä¸Šï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½æŠŠå®ƒåŠ åœ¨int xè¿™ä¸ªå˜é‡ä¸Šå‘¢ï¼Ÿ</p><p>ä¸‹é¢ä»£ç ä½¿ç”¨volatileä¿®é¥°äº†xå˜é‡</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505083124159.png" alt="image-20230505083124159"></p><p>å±éšœæ·»åŠ çš„ç¤ºæ„å›¾</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505083217904.png" alt="image-20230505083217904"></p><p>è¿™æ ·æ˜¾ç„¶æ˜¯ä¸è¡Œçš„ï¼Œä¸»è¦æ˜¯å› ä¸ºä¸‹é¢ä¸¤ä¸ªåŸåˆ™ï¼š</p><ul><li>å†™æ“ä½œåŠ çš„å±éšœæ˜¯é˜»æ­¢ä¸Šæ–¹å…¶å®ƒå†™æ“ä½œè¶Šè¿‡å±éšœæ’åˆ°volatileå˜é‡å†™ä¹‹ä¸‹</li><li>è¯»æ“ä½œåŠ çš„å±éšœæ˜¯é˜»æ­¢ä¸‹æ–¹å…¶å®ƒè¯»æ“ä½œè¶Šè¿‡å±éšœæ’åˆ°volatileå˜é‡è¯»ä¹‹ä¸Š</li></ul><p><mark>æ‰€ä»¥ï¼Œç°åœ¨æˆ‘ä»¬å°±å¯ä»¥æ€»ç»“ä¸€ä¸ªvolatileä½¿ç”¨çš„å°å¦™æ‹›ï¼š</mark></p><ul><li><mark>å†™å˜é‡è®©volatileä¿®é¥°çš„å˜é‡çš„åœ¨ä»£ç æœ€åä½ç½®</mark></li><li><mark>è¯»å˜é‡è®©volatileä¿®é¥°çš„å˜é‡çš„åœ¨ä»£ç æœ€å¼€å§‹ä½ç½®</mark></li></ul><p>ğŸ”´ğŸŸ¡ğŸŸ¢æ€»ç»“ï¼š</p><ol><li>ä¿è¯çº¿ç¨‹é—´çš„å¯è§æ€§<br>ç”¨ volatile ä¿®é¥°å…±äº«å˜é‡ï¼Œèƒ½å¤Ÿé˜²æ­¢ç¼–è¯‘å™¨ç­‰ä¼˜åŒ–å‘ç”Ÿï¼ˆ<strong>å…¶å®å°±æ˜¯JVMçš„è¯­æ³•ç³–</strong>ï¼‰ï¼Œè®©ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§</li><li>ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åº<br>æŒ‡ä»¤é‡æ’ï¼šç”¨volatile ä¿®é¥°å…±äº«å˜é‡ä¼šåœ¨è¯»ã€å†™å…±äº«å˜é‡æ—¶åŠ å…¥ä¸åŒçš„å±éšœé˜»æ­¢å…¶ä»–è¯»å†™æ“ä½œè¶Šè¿‡å±éšœï¼Œä»è€Œè¾¾åˆ°é˜»æ­¢é‡æ’åºçš„æ•ˆæœ</li></ol><h3 id="2-6-ä»€ä¹ˆæ˜¯AQSï¼Ÿ"><a href="#2-6-ä»€ä¹ˆæ˜¯AQSï¼Ÿ" class="headerlink" title="2.6 ä»€ä¹ˆæ˜¯AQSï¼Ÿ"></a>2.6 ä»€ä¹ˆæ˜¯AQSï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><h4 id="2-6-1-æ¦‚è¿°"><a href="#2-6-1-æ¦‚è¿°" class="headerlink" title="2.6.1 æ¦‚è¿°"></a>2.6.1 æ¦‚è¿°</h4><p>å…¨ç§°æ˜¯ AbstractQueuedSynchronizerï¼Œæ˜¯é˜»å¡å¼é”å’Œç›¸å…³çš„åŒæ­¥å™¨å·¥å…·çš„æ¡†æ¶ï¼Œå®ƒæ˜¯æ„å»ºé”æˆ–è€…å…¶ä»–åŒæ­¥ç»„ä»¶çš„åŸºç¡€æ¡†æ¶</p><p>AQSä¸Synchronizedçš„åŒºåˆ«</p><table><thead><tr><th><strong>synchronized</strong></th><th><strong>AQS</strong></th></tr></thead><tbody><tr><td>å…³é”®å­—ï¼Œc++ è¯­è¨€å®ç°</td><td>java  è¯­è¨€å®ç°</td></tr><tr><td>æ‚²è§‚é”ï¼Œè‡ªåŠ¨é‡Šæ”¾é”</td><td>æ‚²è§‚é”ï¼Œæ‰‹åŠ¨å¼€å¯å’Œå…³é—­</td></tr><tr><td>é”ç«äº‰æ¿€çƒˆéƒ½æ˜¯é‡é‡çº§é”ï¼Œæ€§èƒ½å·®</td><td>é”ç«äº‰æ¿€çƒˆçš„æƒ…å†µä¸‹ï¼Œæä¾›äº†å¤šç§è§£å†³æ–¹æ¡ˆ</td></tr></tbody></table><p>AQSå¸¸è§çš„å®ç°ç±»</p><ul><li><p>ReentrantLock      é˜»å¡å¼é”</p></li><li><p>Semaphore        ä¿¡å·é‡</p></li><li><p>CountDownLatch   å€’è®¡æ—¶é”</p></li></ul><h4 id="2-6-2-å·¥ä½œæœºåˆ¶"><a href="#2-6-2-å·¥ä½œæœºåˆ¶" class="headerlink" title="2.6.2 å·¥ä½œæœºåˆ¶"></a>2.6.2 å·¥ä½œæœºåˆ¶</h4><ul><li>åœ¨AQSä¸­ç»´æŠ¤äº†ä¸€ä¸ªä½¿ç”¨äº†volatileä¿®é¥°çš„stateå±æ€§æ¥è¡¨ç¤ºèµ„æºçš„çŠ¶æ€ï¼Œ0è¡¨ç¤ºæ— é”ï¼Œ1è¡¨ç¤ºæœ‰é”</li><li>æä¾›äº†åŸºäº FIFO çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œç±»ä¼¼äº Monitor çš„ EntryList</li><li>æ¡ä»¶å˜é‡æ¥å®ç°ç­‰å¾…ã€å”¤é†’æœºåˆ¶ï¼Œæ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡ï¼Œç±»ä¼¼äº Monitor çš„ WaitSet</li></ul><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505083840046.png" alt="image-20230505083840046"></p><blockquote><ul><li>çº¿ç¨‹0æ¥äº†ä»¥åï¼Œå»å°è¯•ä¿®æ”¹stateå±æ€§ï¼Œå¦‚æœå‘ç°stateå±æ€§æ˜¯0ï¼Œå°±ä¿®æ”¹stateçŠ¶æ€ä¸º1ï¼Œè¡¨ç¤ºçº¿ç¨‹0æŠ¢é”æˆåŠŸ</li><li>çº¿ç¨‹1å’Œçº¿ç¨‹2ä¹Ÿä¼šå…ˆå°è¯•ä¿®æ”¹stateå±æ€§ï¼Œå‘ç°stateçš„å€¼å·²ç»æ˜¯1äº†ï¼Œæœ‰å…¶ä»–çº¿ç¨‹æŒæœ‰é”ï¼Œå®ƒä»¬éƒ½ä¼šåˆ°FIFOé˜Ÿåˆ—ä¸­è¿›è¡Œç­‰å¾…ï¼Œ</li><li>FIFOæ˜¯ä¸€ä¸ªåŒå‘é˜Ÿåˆ—ï¼Œheadå±æ€§è¡¨ç¤ºå¤´ç»“ç‚¹ï¼Œtailè¡¨ç¤ºå°¾ç»“ç‚¹</li></ul></blockquote><p><strong>å¦‚æœå¤šä¸ªçº¿ç¨‹å…±åŒå»æŠ¢è¿™ä¸ªèµ„æºæ˜¯å¦‚ä½•ä¿è¯åŸå­æ€§çš„å‘¢ï¼Ÿ</strong></p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505084451193.png" alt="image-20230505084451193"></p><p>åœ¨å»ä¿®æ”¹stateçŠ¶æ€çš„æ—¶å€™ï¼Œä½¿ç”¨çš„casè‡ªæ—‹é”æ¥ä¿è¯åŸå­æ€§ï¼Œç¡®ä¿åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹æˆåŠŸï¼Œä¿®æ”¹å¤±è´¥çš„çº¿ç¨‹å°†ä¼šè¿›å…¥FIFOé˜Ÿåˆ—ä¸­ç­‰å¾…</p><p><strong>AQSæ˜¯å…¬å¹³é”å—ï¼Œè¿˜æ˜¯éå…¬å¹³é”ï¼Ÿ</strong></p><ul><li><p>æ–°çš„çº¿ç¨‹ä¸é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å…±åŒæ¥æŠ¢èµ„æºï¼Œæ˜¯éå…¬å¹³é”</p></li><li><p>æ–°çš„çº¿ç¨‹åˆ°é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œåªè®©é˜Ÿåˆ—ä¸­çš„headçº¿ç¨‹è·å–é”ï¼Œæ˜¯å…¬å¹³é”</p></li></ul><blockquote><p>æ¯”è¾ƒå…¸å‹çš„AQSå®ç°ç±»ReentrantLockï¼Œå®ƒé»˜è®¤å°±æ˜¯éå…¬å¹³é”ï¼Œæ–°çš„çº¿ç¨‹ä¸é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å…±åŒæ¥æŠ¢èµ„æº</p></blockquote><p>ğŸ”´ğŸŸ¡ğŸŸ¢æ€»ç»“ï¼š</p><ul><li>AQSæ˜¯å¤šçº¿ç¨‹ä¸­çš„é˜Ÿåˆ—åŒæ­¥å™¨ã€‚æ˜¯ä¸€ç§<mark><strong>é”æœºåˆ¶</strong></mark>ï¼Œå®ƒæ˜¯åšä¸ºä¸€ä¸ª<mark>åŸºç¡€æ¡†æ¶</mark>ä½¿ç”¨çš„åƒReentrantLockã€Semaphoreéƒ½æ˜¯åŸºäºAQSå®ç°çš„</li><li>AQSå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„åŒå‘é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸­å­˜å‚¨çš„æ’é˜Ÿçš„çº¿ç¨‹</li><li>åœ¨AQSå†…éƒ¨è¿˜æœ‰ä¸€ä¸ªå±æ€§stateï¼Œè¿™ä¸ªstateå°±ç›¸å½“äºæ˜¯ä¸€ä¸ªèµ„æºï¼Œé»˜è®¤æ˜¯0(æ— é”çŠ¶æ€)ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­çš„æœ‰ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹æˆåŠŸäº†stateä¸º1ï¼Œåˆ™å½“å‰çº¿ç¨‹å°±ç›¸ç­‰äºè·å–äº†èµ„æº</li><li>åœ¨å¯¹stateä¿®æ”¹çš„æ—¶å€™ä½¿ç”¨çš„casæ“ä½œï¼Œä¿è¯å¤šä¸ªçº¿ç¨‹ä¿®æ”¹çš„æƒ…å†µä¸‹åŸå­æ€§</li></ul><h3 id="2-5-ReentrantLockçš„å®ç°åŸç†"><a href="#2-5-ReentrantLockçš„å®ç°åŸç†" class="headerlink" title="2.5 ReentrantLockçš„å®ç°åŸç†"></a>2.5 ReentrantLockçš„å®ç°åŸç†</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><h4 id="2-5-1-æ¦‚è¿°"><a href="#2-5-1-æ¦‚è¿°" class="headerlink" title="2.5.1 æ¦‚è¿°"></a>2.5.1 æ¦‚è¿°</h4><p>ReentrantLockç¿»è¯‘è¿‡æ¥æ˜¯å¯é‡å…¥é”ï¼Œç›¸å¯¹äºsynchronizedå®ƒå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li><p>å¯ä¸­æ–­</p></li><li><p>å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´</p></li><li><p>å¯ä»¥è®¾ç½®å…¬å¹³é”</p></li><li><p>æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡</p></li><li><p>ä¸synchronizedä¸€æ ·ï¼Œéƒ½æ”¯æŒé‡å…¥</p></li></ul><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505091736569.png" alt="image-20230505091736569"></p><h4 id="2-5-2-å®ç°åŸç†"><a href="#2-5-2-å®ç°åŸç†" class="headerlink" title="2.5.2 å®ç°åŸç†"></a>2.5.2 å®ç°åŸç†</h4><p>ReentrantLockä¸»è¦åˆ©ç”¨CAS+AQSé˜Ÿåˆ—æ¥å®ç°ã€‚å®ƒæ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”ï¼Œä¸¤è€…çš„å®ç°ç±»ä¼¼</p><p>æ„é€ æ–¹æ³•æ¥å—ä¸€ä¸ªå¯é€‰çš„å…¬å¹³å‚æ•°ï¼ˆé»˜è®¤éå…¬å¹³é”ï¼‰ï¼Œå½“è®¾ç½®ä¸ºtrueæ—¶ï¼Œè¡¨ç¤ºå…¬å¹³é”ï¼Œå¦åˆ™ä¸ºéå…¬å¹³é”ã€‚å…¬å¹³é”çš„æ•ˆç‡å¾€å¾€æ²¡æœ‰éå…¬å¹³é”çš„æ•ˆç‡é«˜ï¼Œåœ¨è®¸å¤šçº¿ç¨‹è®¿é—®çš„æƒ…å†µä¸‹ï¼Œå…¬å¹³é”è¡¨ç°å‡ºè¾ƒä½çš„ååé‡ã€‚</p><p>æŸ¥çœ‹ReentrantLockæºç ä¸­çš„æ„é€ æ–¹æ³•ï¼š</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505091827720.png" alt="image-20230505091827720"></p><p>æä¾›äº†ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œä¸å¸¦å‚æ•°çš„é»˜è®¤ä¸ºéå…¬å¹³</p><p>å¦‚æœä½¿ç”¨å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”ä¼ çš„å€¼ä¸ºtrueï¼Œåˆ™æ˜¯å…¬å¹³é”</p><p>å…¶ä¸­NonfairSyncå’ŒFairSyncè¿™ä¸¤ä¸ªç±»çˆ¶ç±»éƒ½æ˜¯Sync</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505092151244.png" alt="image-20230505092151244"></p><p>è€ŒSyncçš„çˆ¶ç±»æ˜¯AQSï¼Œæ‰€ä»¥å¯ä»¥å¾—å‡ºReentrantLockåº•å±‚ä¸»è¦å®ç°å°±æ˜¯åŸºäºAQSæ¥å®ç°çš„</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505091833629.png" alt="image-20230505091833629"></p><p><strong>å·¥ä½œæµç¨‹</strong></p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505092340431.png" alt="image-20230505092340431"></p><ul><li><p>çº¿ç¨‹æ¥æŠ¢é”åä½¿ç”¨casçš„æ–¹å¼ä¿®æ”¹stateçŠ¶æ€ï¼Œä¿®æ”¹çŠ¶æ€æˆåŠŸä¸º1ï¼Œåˆ™è®©exclusiveOwnerThreadå±æ€§æŒ‡å‘å½“å‰çº¿ç¨‹ï¼Œè·å–é”æˆåŠŸ</p></li><li><p>å‡å¦‚ä¿®æ”¹çŠ¶æ€å¤±è´¥ï¼Œåˆ™ä¼šè¿›å…¥åŒå‘é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼ŒheadæŒ‡å‘åŒå‘é˜Ÿåˆ—å¤´éƒ¨ï¼ŒtailæŒ‡å‘åŒå‘é˜Ÿåˆ—å°¾éƒ¨</p></li><li><p>å½“exclusiveOwnerThreadä¸ºnullçš„æ—¶å€™ï¼Œåˆ™ä¼šå”¤é†’åœ¨åŒå‘é˜Ÿåˆ—ä¸­ç­‰å¾…çš„çº¿ç¨‹</p></li><li><p>å…¬å¹³é”åˆ™ä½“ç°åœ¨æŒ‰ç…§å…ˆåé¡ºåºè·å–é”ï¼Œéå…¬å¹³ä½“ç°åœ¨ä¸åœ¨æ’é˜Ÿçš„çº¿ç¨‹ä¹Ÿå¯ä»¥æŠ¢é”</p></li></ul><h3 id="2-6-synchronizedå’ŒLockæœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#2-6-synchronizedå’ŒLockæœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="2.6 synchronizedå’ŒLockæœ‰ä»€ä¹ˆåŒºåˆ« ?"></a>2.6 synchronizedå’ŒLockæœ‰ä»€ä¹ˆåŒºåˆ« ?</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><p>å‚è€ƒå›ç­”</p><ul><li>è¯­æ³•å±‚é¢<ul><li>synchronized æ˜¯å…³é”®å­—ï¼Œæºç åœ¨ jvm ä¸­ï¼Œç”¨ c++ è¯­è¨€å®ç°</li><li>Lock æ˜¯æ¥å£ï¼Œæºç ç”± jdk æä¾›ï¼Œç”¨ java è¯­è¨€å®ç°</li><li>ä½¿ç”¨ synchronized æ—¶ï¼Œé€€å‡ºåŒæ­¥ä»£ç å—é”ä¼š<strong>è‡ªåŠ¨é‡Šæ”¾</strong>ï¼Œè€Œä½¿ç”¨ Lock æ—¶ï¼Œ<strong>éœ€è¦æ‰‹åŠ¨è°ƒç”¨ unlock æ–¹æ³•é‡Šæ”¾é”</strong></li></ul></li><li>åŠŸèƒ½å±‚é¢<ul><li>äºŒè€…<strong>å‡å±äºæ‚²è§‚é”</strong>ã€éƒ½å…·å¤‡åŸºæœ¬çš„äº’æ–¥ã€åŒæ­¥ã€é”é‡å…¥åŠŸèƒ½</li><li>Lock æä¾›äº†è®¸å¤š synchronized ä¸å…·å¤‡çš„åŠŸèƒ½ï¼Œä¾‹å¦‚<strong>è·å–ç­‰å¾…çŠ¶æ€ã€å…¬å¹³é”ã€å¯æ‰“æ–­ã€å¯è¶…æ—¶ã€å¤šæ¡ä»¶å˜é‡</strong></li><li>Lock æœ‰é€‚åˆä¸åŒåœºæ™¯çš„å®ç°ï¼Œå¦‚ ReentrantLockï¼Œ ReentrantReadWriteLock</li></ul></li><li>æ€§èƒ½å±‚é¢<ul><li>åœ¨æ²¡æœ‰ç«äº‰æ—¶ï¼Œsynchronized åšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œå¦‚åå‘é”ã€è½»é‡çº§é”ï¼Œæ€§èƒ½ä¸èµ–</li><li>åœ¨ç«äº‰æ¿€çƒˆæ—¶ï¼ŒLock çš„å®ç°é€šå¸¸ä¼šæä¾›æ›´å¥½çš„æ€§èƒ½</li></ul></li></ul><h3 id="2-7-æ­»é”äº§ç”Ÿçš„æ¡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2-7-æ­»é”äº§ç”Ÿçš„æ¡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2.7 æ­»é”äº§ç”Ÿçš„æ¡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ"></a>2.7 æ­»é”äº§ç”Ÿçš„æ¡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><p><strong>æ­»é”</strong>ï¼šä¸€ä¸ªçº¿ç¨‹éœ€è¦åŒæ—¶è·å–å¤šæŠŠé”ï¼Œè¿™æ—¶å°±å®¹æ˜“å‘ç”Ÿæ­»é”</p><blockquote><p>ä¾‹å¦‚ï¼š</p><p>t1 çº¿ç¨‹è·å¾—Aå¯¹è±¡é”ï¼Œæ¥ä¸‹æ¥æƒ³è·å–Bå¯¹è±¡çš„é”</p><p>t2 çº¿ç¨‹è·å¾—Bå¯¹è±¡é”ï¼Œæ¥ä¸‹æ¥æƒ³è·å–Aå¯¹è±¡çš„é” </p></blockquote><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.basic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.Thread.sleep;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Deadlock</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">A</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">B</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (A) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;lock A&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (B) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;lock B&quot;</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ“ä½œ...&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (B) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;lock B&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    sleep(<span class="number">500</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (A) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;lock A&quot;</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ“ä½œ...&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ§åˆ¶å°è¾“å‡ºç»“æœ</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220902171032898.png" alt="image-20220902171032898"></p><p>æ­¤æ—¶ç¨‹åºå¹¶æ²¡æœ‰ç»“æŸï¼Œè¿™ç§ç°è±¡å°±æ˜¯æ­»é”ç°è±¡â€¦çº¿ç¨‹t1æŒæœ‰Açš„é”ç­‰å¾…è·å–Bé”ï¼Œçº¿ç¨‹t2æŒæœ‰Bçš„é”ç­‰å¾…è·å–Açš„é”ã€‚</p><h3 id="2-8-å¦‚ä½•è¿›è¡Œæ­»é”è¯Šæ–­ï¼Ÿ"><a href="#2-8-å¦‚ä½•è¿›è¡Œæ­»é”è¯Šæ–­ï¼Ÿ" class="headerlink" title="2.8 å¦‚ä½•è¿›è¡Œæ­»é”è¯Šæ–­ï¼Ÿ"></a>2.8 å¦‚ä½•è¿›è¡Œæ­»é”è¯Šæ–­ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><p>å½“ç¨‹åºå‡ºç°äº†æ­»é”ç°è±¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨jdkè‡ªå¸¦çš„å·¥å…·ï¼šjpså’Œ jstack</p><p>æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>ç¬¬ä¸€ï¼šæŸ¥çœ‹è¿è¡Œçš„çº¿ç¨‹</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220902171426738.png" alt="image-20220902171426738"></p><p>ç¬¬äºŒï¼šä½¿ç”¨jstackæŸ¥çœ‹çº¿ç¨‹è¿è¡Œçš„æƒ…å†µï¼Œä¸‹å›¾æ˜¯æˆªå›¾çš„å…³é”®ä¿¡æ¯</p><p>è¿è¡Œå‘½ä»¤ï¼š<code>jstack -l 46032</code></p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220902172229567.png" alt="image-20220902172229567"></p><p><strong>å…¶ä»–è§£å†³å·¥å…·ï¼Œå¯è§†åŒ–å·¥å…·</strong></p><ul><li>jconsole</li></ul><p>ç”¨äºå¯¹jvmçš„å†…å­˜ï¼Œçº¿ç¨‹ï¼Œç±» çš„ç›‘æ§ï¼Œæ˜¯ä¸€ä¸ªåŸºäº jmx çš„ GUI æ€§èƒ½ç›‘æ§å·¥å…·</p><p>æ‰“å¼€æ–¹å¼ï¼šjava å®‰è£…ç›®å½• binç›®å½•ä¸‹ ç›´æ¥å¯åŠ¨ jconsole.exe å°±è¡Œ</p><ul><li>VisualVMï¼šæ•…éšœå¤„ç†å·¥å…·</li></ul><p>èƒ½å¤Ÿç›‘æ§çº¿ç¨‹ï¼Œå†…å­˜æƒ…å†µï¼ŒæŸ¥çœ‹æ–¹æ³•çš„CPUæ—¶é—´å’Œå†…å­˜ä¸­çš„å¯¹ è±¡ï¼Œå·²è¢«GCçš„å¯¹è±¡ï¼Œåå‘æŸ¥çœ‹åˆ†é…çš„å †æ ˆ</p><p>æ‰“å¼€æ–¹å¼ï¼šjava å®‰è£…ç›®å½• binç›®å½•ä¸‹ ç›´æ¥å¯åŠ¨ jvisualvm.exeå°±è¡Œ</p><h3 id="2-10-ConcurrentHashMap"><a href="#2-10-ConcurrentHashMap" class="headerlink" title="2.10  ConcurrentHashMap"></a>2.10  ConcurrentHashMap</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><p>ConcurrentHashMap æ˜¯ä¸€ç§çº¿ç¨‹å®‰å…¨çš„é«˜æ•ˆMapé›†åˆ</p><p>åº•å±‚æ•°æ®ç»“æ„ï¼š</p><ul><li><p>JDK1.7åº•å±‚é‡‡ç”¨åˆ†æ®µçš„æ•°ç»„+é“¾è¡¨å®ç°</p></li><li><p>JDK1.8 é‡‡ç”¨çš„æ•°æ®ç»“æ„è·ŸHashMap1.8çš„ç»“æ„ä¸€æ ·ï¼Œæ•°ç»„+é“¾è¡¨&#x2F;çº¢é»‘äºŒå‰æ ‘ã€‚</p></li></ul><h4 id="ï¼ˆ1ï¼‰-JDK1-7ä¸­concurrentHashMap"><a href="#ï¼ˆ1ï¼‰-JDK1-7ä¸­concurrentHashMap" class="headerlink" title="ï¼ˆ1ï¼‰ JDK1.7ä¸­concurrentHashMap"></a>ï¼ˆ1ï¼‰ JDK1.7ä¸­concurrentHashMap</h4><p>æ•°æ®ç»“æ„</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505092654811.png" alt="image-20230505092654811"></p><blockquote><ul><li>æä¾›äº†ä¸€ä¸ªsegmentæ•°ç»„ï¼Œåœ¨åˆå§‹åŒ–ConcurrentHashMap çš„æ—¶å€™å¯ä»¥æŒ‡å®šæ•°ç»„çš„é•¿åº¦ï¼Œé»˜è®¤æ˜¯16ï¼Œä¸€æ—¦åˆå§‹åŒ–ä¹‹åä¸­é—´ä¸å¯æ‰©å®¹</li><li>åœ¨æ¯ä¸ªsegmentä¸­éƒ½å¯ä»¥æŒ‚ä¸€ä¸ªHashEntryæ•°ç»„ï¼Œæ•°ç»„é‡Œé¢å¯ä»¥å­˜å‚¨å…·ä½“çš„å…ƒç´ ï¼ŒHashEntryæ•°ç»„æ˜¯å¯ä»¥æ‰©å®¹çš„</li><li>åœ¨HashEntryå­˜å‚¨çš„æ•°ç»„ä¸­å­˜å‚¨çš„å…ƒç´ ï¼Œå¦‚æœå‘ç”Ÿå†²çªï¼Œåˆ™å¯ä»¥æŒ‚å•å‘é“¾è¡¨</li></ul></blockquote><p>å­˜å‚¨æµç¨‹</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505093055382.png" alt="image-20230505093055382"></p><ul><li>å…ˆå»è®¡ç®—keyçš„hashå€¼ï¼Œç„¶åç¡®å®šsegmentæ•°ç»„ä¸‹æ ‡</li><li>å†é€šè¿‡hashå€¼ç¡®å®šhashEntryæ•°ç»„ä¸­çš„ä¸‹æ ‡å­˜å‚¨æ•°æ®</li><li>åœ¨è¿›è¡Œæ“ä½œæ•°æ®çš„ä¹‹å‰ï¼Œä¼šå…ˆåˆ¤æ–­å½“å‰segmentå¯¹åº”ä¸‹æ ‡ä½ç½®æ˜¯å¦æœ‰çº¿ç¨‹è¿›è¡Œæ“ä½œï¼Œä¸ºäº†çº¿ç¨‹å®‰å…¨ä½¿ç”¨çš„æ˜¯ReentrantLockè¿›è¡ŒåŠ é”ï¼Œå¦‚æœè·å–é”æ˜¯è¢«ä¼šä½¿ç”¨casè‡ªæ—‹é”è¿›è¡Œå°è¯•</li></ul><h4 id="ï¼ˆ2ï¼‰-JDK1-8ä¸­concurrentHashMap"><a href="#ï¼ˆ2ï¼‰-JDK1-8ä¸­concurrentHashMap" class="headerlink" title="ï¼ˆ2ï¼‰ JDK1.8ä¸­concurrentHashMap"></a>ï¼ˆ2ï¼‰ JDK1.8ä¸­concurrentHashMap</h4><p>åœ¨JDK1.8ä¸­ï¼Œæ”¾å¼ƒäº†Segmentè‡ƒè‚¿çš„è®¾è®¡ï¼Œæ•°æ®ç»“æ„è·ŸHashMapçš„æ•°æ®ç»“æ„æ˜¯ä¸€æ ·çš„ï¼šæ•°ç»„+çº¢é»‘æ ‘+é“¾è¡¨</p><p>é‡‡ç”¨ CAS + Synchronizedæ¥ä¿è¯å¹¶å‘å®‰å…¨è¿›è¡Œå®ç°</p><ul><li><p>CASæ§åˆ¶æ•°ç»„èŠ‚ç‚¹çš„æ·»åŠ </p></li><li><p>synchronizedåªé”å®šå½“å‰é“¾è¡¨æˆ–çº¢é»‘äºŒå‰æ ‘çš„é¦–èŠ‚ç‚¹ï¼Œåªè¦hashä¸å†²çªï¼Œå°±ä¸ä¼šäº§ç”Ÿå¹¶å‘çš„é—®é¢˜ , æ•ˆç‡å¾—åˆ°æå‡</p></li></ul><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505093507265.png" alt="image-20230505093507265"></p><p>ğŸ”´ğŸŸ¡ğŸŸ¢æ€»ç»“ï¼š</p><ol><li>åº•å±‚æ•°æ®ç»“æ„:<br>JDK1.7åº•å±‚é‡‡ç”¨åˆ†æ®µçš„æ•°ç»„+é“¾è¡¨å®ç°<br>JDK18 é‡‡ç”¨çš„æ•°æ®ç»“æ„è·ŸHashMap1.8çš„ç»“æ„ä¸€æ ·ï¼Œæ•°ç»„+é“¾è¡¨&#x2F;çº¢é»‘äºŒå‰æ ‘</li><li>åŠ é”çš„æ–¹å¼<br>JDK1.7é‡‡ç”¨Segmentåˆ†æ®µé”ï¼Œåº•å±‚ä½¿ç”¨çš„æ˜¯ReentrantLock<br>JDK1.8é‡‡ç”¨CASæ·»åŠ æ–°èŠ‚ç‚¹ï¼Œé‡‡ç”¨synchronizedé”å®šé“¾è¡¨æˆ–çº¢é»‘äºŒå‰æ ‘çš„<mark>é¦–èŠ‚ç‚¹</mark>ï¼Œç›¸å¯¹Segmentåˆ†æ®µé”ç²’åº¦æ›´ç»†ï¼Œæ€§èƒ½æ›´å¥½</li></ol><h3 id="2-11-å¯¼è‡´å¹¶å‘ç¨‹åºå‡ºç°é—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆ"><a href="#2-11-å¯¼è‡´å¹¶å‘ç¨‹åºå‡ºç°é—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆ" class="headerlink" title="2.11 å¯¼è‡´å¹¶å‘ç¨‹åºå‡ºç°é—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆ"></a>2.11 å¯¼è‡´å¹¶å‘ç¨‹åºå‡ºç°é—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><p>Javaå¹¶å‘ç¼–ç¨‹ä¸‰å¤§ç‰¹æ€§</p><ul><li><p>åŸå­æ€§</p></li><li><p>å¯è§æ€§</p></li><li><p>æœ‰åºæ€§</p></li></ul><h4 id="ï¼ˆ1ï¼‰åŸå­æ€§"><a href="#ï¼ˆ1ï¼‰åŸå­æ€§" class="headerlink" title="ï¼ˆ1ï¼‰åŸå­æ€§"></a>ï¼ˆ1ï¼‰åŸå­æ€§</h4><p>ä¸€ä¸ªçº¿ç¨‹åœ¨CPUä¸­æ“ä½œä¸å¯æš‚åœï¼Œä¹Ÿä¸å¯ä¸­æ–­ï¼Œè¦ä¸æ‰§è¡Œå®Œæˆï¼Œè¦ä¸ä¸æ‰§è¡Œ</p><p>æ¯”å¦‚ï¼Œå¦‚ä¸‹ä»£ç èƒ½ä¿è¯åŸå­æ€§å—ï¼Ÿ</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505205200628.png" alt="image-20230505205200628"></p><p>ä»¥ä¸Šä»£ç ä¼šå‡ºç°è¶…å–æˆ–è€…æ˜¯ä¸€å¼ ç¥¨å–ç»™åŒä¸€ä¸ªäººï¼Œæ‰§è¡Œå¹¶ä¸æ˜¯åŸå­æ€§çš„</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><p>1.synchronizedï¼šåŒæ­¥åŠ é”</p><p>2.JUCé‡Œé¢çš„lockï¼šåŠ é”</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505210853493.png" alt="image-20230505210853493"></p><h4 id="ï¼ˆ2ï¼‰å†…å­˜å¯è§æ€§"><a href="#ï¼ˆ2ï¼‰å†…å­˜å¯è§æ€§" class="headerlink" title="ï¼ˆ2ï¼‰å†…å­˜å¯è§æ€§"></a>ï¼ˆ2ï¼‰å†…å­˜å¯è§æ€§</h4><p>å†…å­˜å¯è§æ€§ï¼šè®©ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§</p><p>æ¯”å¦‚ï¼Œä»¥ä¸‹ä»£ç ä¸èƒ½ä¿è¯å†…å­˜å¯è§æ€§</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505211002252.png" alt="image-20230505211002252"></p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li><p>synchronized</p></li><li><p>volatileï¼ˆæ¨èï¼‰</p></li><li><p>LOCK</p></li></ul><h4 id="ï¼ˆ3ï¼‰æœ‰åºæ€§"><a href="#ï¼ˆ3ï¼‰æœ‰åºæ€§" class="headerlink" title="ï¼ˆ3ï¼‰æœ‰åºæ€§"></a>ï¼ˆ3ï¼‰æœ‰åºæ€§</h4><p>æŒ‡ä»¤é‡æ’ï¼šå¤„ç†å™¨ä¸ºäº†æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ï¼Œå¯èƒ½ä¼šå¯¹è¾“å…¥ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œå®ƒä¸ä¿è¯ç¨‹åºä¸­å„ä¸ªè¯­å¥çš„æ‰§è¡Œå…ˆåé¡ºåºåŒä»£ç ä¸­çš„é¡ºåºä¸€è‡´ï¼Œä½†æ˜¯å®ƒä¼šä¿è¯ç¨‹åºæœ€ç»ˆæ‰§è¡Œç»“æœå’Œä»£ç é¡ºåºæ‰§è¡Œçš„ç»“æœæ˜¯ä¸€è‡´çš„</p><p>è¿˜æ˜¯ä¹‹å‰çš„ä¾‹å­ï¼Œå¦‚ä¸‹ä»£ç ï¼š</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505211209336.png" alt="image-20230505211209336"></p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>volatile</li></ul><h2 id="3-çº¿ç¨‹æ± "><a href="#3-çº¿ç¨‹æ± " class="headerlink" title="3.çº¿ç¨‹æ± "></a>3.çº¿ç¨‹æ± </h2><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://juejin.cn/post/6844903910096764942">https://juejin.cn/post/6844903910096764942</a></p><h3 id="3-1-è¯´ä¸€ä¸‹çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°ï¼ˆçº¿ç¨‹æ± çš„æ‰§è¡ŒåŸç†çŸ¥é“å˜›ï¼‰"><a href="#3-1-è¯´ä¸€ä¸‹çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°ï¼ˆçº¿ç¨‹æ± çš„æ‰§è¡ŒåŸç†çŸ¥é“å˜›ï¼‰" class="headerlink" title="3.1 è¯´ä¸€ä¸‹çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°ï¼ˆçº¿ç¨‹æ± çš„æ‰§è¡ŒåŸç†çŸ¥é“å˜›ï¼‰"></a>3.1 è¯´ä¸€ä¸‹çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°ï¼ˆçº¿ç¨‹æ± çš„æ‰§è¡ŒåŸç†çŸ¥é“å˜›ï¼‰</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><p>çº¿ç¨‹æ± æ ¸å¿ƒå‚æ•°ä¸»è¦å‚è€ƒThreadPoolExecutorè¿™ä¸ªç±»çš„7ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505220514872.png" alt="image-20230505220514872"></p><ul><li><p>corePoolSize æ ¸å¿ƒçº¿ç¨‹æ•°ç›®</p></li><li><p>maximumPoolSize æœ€å¤§çº¿ç¨‹æ•°ç›® &#x3D; (æ ¸å¿ƒçº¿ç¨‹+æ•‘æ€¥çº¿ç¨‹çš„æœ€å¤§æ•°ç›®)</p></li><li><p>keepAliveTime ç”Ÿå­˜æ—¶é—´ - æ•‘æ€¥çº¿ç¨‹çš„ç”Ÿå­˜æ—¶é—´ï¼Œç”Ÿå­˜æ—¶é—´å†…æ²¡æœ‰æ–°ä»»åŠ¡ï¼Œæ­¤çº¿ç¨‹èµ„æºä¼šé‡Šæ”¾</p></li><li><p>unit æ—¶é—´å•ä½ - æ•‘æ€¥çº¿ç¨‹çš„ç”Ÿå­˜æ—¶é—´å•ä½ï¼Œå¦‚ç§’ã€æ¯«ç§’ç­‰</p></li><li><p>workQueue - å½“æ²¡æœ‰ç©ºé—²æ ¸å¿ƒçº¿ç¨‹æ—¶ï¼Œæ–°æ¥ä»»åŠ¡ä¼šåŠ å…¥åˆ°æ­¤é˜Ÿåˆ—æ’é˜Ÿï¼Œé˜Ÿåˆ—æ»¡ä¼šåˆ›å»ºæ•‘æ€¥çº¿ç¨‹æ‰§è¡Œä»»åŠ¡</p></li><li><p>threadFactory çº¿ç¨‹å·¥å‚ - å¯ä»¥å®šåˆ¶çº¿ç¨‹å¯¹è±¡çš„åˆ›å»ºï¼Œä¾‹å¦‚è®¾ç½®çº¿ç¨‹åå­—ã€æ˜¯å¦æ˜¯å®ˆæŠ¤çº¿ç¨‹ç­‰</p></li><li><p>handler æ‹’ç»ç­–ç•¥ - å½“æ‰€æœ‰çº¿ç¨‹éƒ½åœ¨ç¹å¿™ï¼ŒworkQueue ä¹Ÿæ”¾æ»¡æ—¶ï¼Œä¼šè§¦å‘æ‹’ç»ç­–ç•¥</p></li></ul><p><strong>å·¥ä½œæµç¨‹</strong></p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505220701835.png" alt="image-20230505220701835"></p><blockquote><p>1ï¼Œä»»åŠ¡åœ¨æäº¤çš„æ—¶å€™ï¼Œé¦–å…ˆåˆ¤æ–­æ ¸å¿ƒçº¿ç¨‹æ•°æ˜¯å¦å·²æ»¡ï¼Œå¦‚æœæ²¡æœ‰æ»¡åˆ™ç›´æ¥æ·»åŠ åˆ°å·¥ä½œçº¿ç¨‹æ‰§è¡Œ</p><p>2ï¼Œå¦‚æœæ ¸å¿ƒçº¿ç¨‹æ•°æ»¡äº†ï¼Œåˆ™åˆ¤æ–­é˜»å¡é˜Ÿåˆ—æ˜¯å¦å·²æ»¡ï¼Œå¦‚æœæ²¡æœ‰æ»¡ï¼Œå½“å‰ä»»åŠ¡å­˜å…¥é˜»å¡é˜Ÿåˆ—</p><p>3ï¼Œå¦‚æœé˜»å¡é˜Ÿåˆ—ä¹Ÿæ»¡äº†ï¼Œåˆ™åˆ¤æ–­çº¿ç¨‹æ•°æ˜¯å¦å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œåˆ™ä½¿ç”¨ä¸´æ—¶çº¿ç¨‹æ‰§è¡Œä»»åŠ¡</p><p>å¦‚æœæ ¸å¿ƒæˆ–ä¸´æ—¶çº¿ç¨‹æ‰§è¡Œå®Œæˆä»»åŠ¡åä¼šæ£€æŸ¥é˜»å¡é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰éœ€è¦æ‰§è¡Œçš„çº¿ç¨‹ï¼Œå¦‚æœæœ‰ï¼Œåˆ™ä½¿ç”¨éæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œä»»åŠ¡</p><p>4ï¼Œå¦‚æœæ‰€æœ‰çº¿ç¨‹éƒ½åœ¨å¿™ç€ï¼ˆæ ¸å¿ƒçº¿ç¨‹+ä¸´æ—¶çº¿ç¨‹ï¼‰ï¼Œåˆ™èµ°æ‹’ç»ç­–ç•¥</p></blockquote><p>æ‹’ç»ç­–ç•¥ï¼š</p><p>1.AbortPolicyï¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œé»˜è®¤ç­–ç•¥ï¼›</p><p>2.CallerRunsPolicyï¼šç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼›</p><p>3.DiscardOldestPolicyï¼šä¸¢å¼ƒé˜»å¡é˜Ÿåˆ—ä¸­é æœ€å‰çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡ï¼›</p><p>4.DiscardPolicyï¼šç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼›</p><h3 id="3-2-çº¿ç¨‹æ± ä¸­æœ‰å“ªäº›å¸¸è§çš„é˜»å¡é˜Ÿåˆ—"><a href="#3-2-çº¿ç¨‹æ± ä¸­æœ‰å“ªäº›å¸¸è§çš„é˜»å¡é˜Ÿåˆ—" class="headerlink" title="3.2 çº¿ç¨‹æ± ä¸­æœ‰å“ªäº›å¸¸è§çš„é˜»å¡é˜Ÿåˆ—"></a>3.2 çº¿ç¨‹æ± ä¸­æœ‰å“ªäº›å¸¸è§çš„é˜»å¡é˜Ÿåˆ—</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><p>workQueue - å½“æ²¡æœ‰ç©ºé—²æ ¸å¿ƒçº¿ç¨‹æ—¶ï¼Œæ–°æ¥ä»»åŠ¡ä¼šåŠ å…¥åˆ°æ­¤é˜Ÿåˆ—æ’é˜Ÿï¼Œé˜Ÿåˆ—æ»¡ä¼šåˆ›å»ºæ•‘æ€¥çº¿ç¨‹æ‰§è¡Œä»»åŠ¡</p><p>æ¯”è¾ƒå¸¸è§çš„æœ‰4ä¸ªï¼Œç”¨çš„æœ€å¤šæ˜¯ArrayBlockingQueueå’ŒLinkedBlockingQueue</p><p>1.<mark><strong>ArrayBlockingQueue</strong></mark>ï¼šåŸºäºæ•°ç»„ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒFIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ã€‚</p><p>2.<mark><strong>LinkedBlockingQueue</strong></mark>ï¼šåŸºäºé“¾è¡¨ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒFIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ã€‚</p><p>3.DelayedWorkQueue ï¼šæ˜¯ä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå®ƒå¯ä»¥ä¿è¯æ¯æ¬¡å‡ºé˜Ÿçš„ä»»åŠ¡éƒ½æ˜¯å½“å‰é˜Ÿåˆ—ä¸­æ‰§è¡Œæ—¶é—´æœ€é å‰çš„</p><p>4.SynchronousQueueï¼šä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªæ’å…¥æ“ä½œéƒ½å¿…é¡»ç­‰å¾…ä¸€ä¸ªç§»å‡ºæ“ä½œã€‚</p><p><strong>ArrayBlockingQueueçš„LinkedBlockingQueueåŒºåˆ«</strong></p><table><thead><tr><th><strong>LinkedBlockingQueue</strong></th><th><strong>ArrayBlockingQueue</strong></th></tr></thead><tbody><tr><td>é»˜è®¤æ— ç•Œï¼Œæ”¯æŒæœ‰ç•Œ</td><td>å¼ºåˆ¶æœ‰ç•Œ</td></tr><tr><td>åº•å±‚æ˜¯é“¾è¡¨</td><td>åº•å±‚æ˜¯æ•°ç»„</td></tr><tr><td>æ˜¯æ‡’æƒ°çš„ï¼Œåˆ›å»ºèŠ‚ç‚¹çš„æ—¶å€™æ·»åŠ æ•°æ®</td><td>æå‰åˆå§‹åŒ– Node  æ•°ç»„</td></tr><tr><td>å…¥é˜Ÿä¼šç”Ÿæˆæ–° Node</td><td>Nodeéœ€è¦æ˜¯æå‰åˆ›å»ºå¥½çš„</td></tr><tr><td><mark>ä¸¤æŠŠé”ï¼ˆå¤´å°¾ï¼‰</mark></td><td><mark>ä¸€æŠŠé”</mark></td></tr></tbody></table><p>å·¦è¾¹æ˜¯LinkedBlockingQueueåŠ é”çš„æ–¹å¼ï¼Œå³è¾¹æ˜¯ArrayBlockingQueueåŠ é”çš„æ–¹å¼</p><ul><li>LinkedBlockingQueueè¯»å’Œå†™å„æœ‰ä¸€æŠŠé”ï¼Œ<mark>æ€§èƒ½</mark>ç›¸å¯¹è¾ƒå¥½</li><li>ArrayBlockingQueueåªæœ‰ä¸€æŠŠé”ï¼Œè¯»å’Œå†™å…¬ç”¨ï¼Œæ€§èƒ½ç›¸å¯¹äºLinkedBlockingQueueå·®ä¸€äº›</li></ul><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505221424359.png" alt="image-20230505221424359"></p><p>åœ¨é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œè¯»å’Œå†™æ“ä½œåˆ†åˆ«æŒ‡çš„æ˜¯ä»é˜Ÿåˆ—ä¸­å–å‡ºå…ƒç´ å’Œå‘é˜Ÿåˆ—ä¸­æ·»åŠ å…ƒç´ ã€‚å…·ä½“æ¥è¯´ï¼š</p><ul><li><strong>è¯»æ“ä½œ</strong>ï¼ˆä¹Ÿå«å–æ“ä½œæˆ–æ¶ˆè´¹æ“ä½œï¼‰ï¼šä»é˜Ÿåˆ—çš„å¤´éƒ¨å–å‡ºä¸€ä¸ªå…ƒç´ ã€‚</li><li><strong>å†™æ“ä½œ</strong>ï¼ˆä¹Ÿå«æ’å…¥æ“ä½œæˆ–ç”Ÿäº§æ“ä½œï¼‰ï¼šå‘é˜Ÿåˆ—çš„å°¾éƒ¨æ·»åŠ ä¸€ä¸ªå…ƒç´ ã€‚</li></ul><p>å¯¹äº <code>LinkedBlockingQueue</code> å’Œ <code>ArrayBlockingQueue</code>ï¼Œå®ƒä»¬çš„å®ç°æ–¹å¼å¯¹è¿™äº›æ“ä½œçš„é”æœºåˆ¶æœ‰ä¸åŒçš„å½±å“ï¼Œè¿™ä¼šå½±å“åˆ°å®ƒä»¬åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹çš„æ€§èƒ½ã€‚</p><h4 id="LinkedBlockingQueue"><a href="#LinkedBlockingQueue" class="headerlink" title="LinkedBlockingQueue"></a>LinkedBlockingQueue</h4><ul><li>è¯»æ“ä½œå’Œå†™æ“ä½œå„æœ‰ä¸€æŠŠé”ï¼š<ul><li><code>LinkedBlockingQueue</code> ä½¿ç”¨äº†ä¸¤ä¸ªç‹¬ç«‹çš„é”æ¥ç®¡ç†è¯»æ“ä½œï¼ˆå–å…ƒç´ ï¼‰å’Œå†™æ“ä½œï¼ˆæ’å…¥å…ƒç´ ï¼‰ã€‚è¿™æ ·ä¸€æ¥ï¼Œè¯»å†™æ“ä½œå¯ä»¥å¹¶è¡Œè¿›è¡Œï¼Œå› ä¸ºä¸€ä¸ªé”ä½æ’å…¥æ“ä½œï¼Œä¸ä¼šå½±å“å–å‡ºæ“ä½œï¼Œåä¹‹äº¦ç„¶ã€‚</li><li>åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ï¼Œè¿™ç§å®ç°æ–¹å¼å¯ä»¥å‡å°‘è¯»å†™æ“ä½œä¹‹é—´çš„ç«äº‰ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</li></ul></li></ul><h4 id="ArrayBlockingQueue"><a href="#ArrayBlockingQueue" class="headerlink" title="ArrayBlockingQueue"></a>ArrayBlockingQueue</h4><ul><li>è¯»æ“ä½œå’Œå†™æ“ä½œå…±ç”¨ä¸€æŠŠé”ï¼š<ul><li><code>ArrayBlockingQueue</code> ä½¿ç”¨å•ä¸€çš„é”æ¥ç®¡ç†æ‰€æœ‰çš„è¯»æ“ä½œå’Œå†™æ“ä½œã€‚è¿™æ„å‘³ç€å½“ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œæ’å…¥æ“ä½œæ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½è¿›è¡Œå–å‡ºæ“ä½œï¼Œåä¹‹äº¦ç„¶ã€‚</li><li>ç”±äºè¯»å†™æ“ä½œä¸èƒ½å¹¶è¡Œè¿›è¡Œï¼Œåœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ï¼Œæ€§èƒ½å¯èƒ½ä¼šå—åˆ°å½±å“ï¼Œå› ä¸ºæ“ä½œä¹‹é—´çš„é”ç«äº‰ä¼šå¯¼è‡´æ›´å¤šçš„çº¿ç¨‹ç­‰å¾…ã€‚</li></ul></li></ul><h4 id="æ€§èƒ½å½±å“"><a href="#æ€§èƒ½å½±å“" class="headerlink" title="æ€§èƒ½å½±å“"></a>æ€§èƒ½å½±å“</h4><ul><li><strong><code>LinkedBlockingQueue</code> çš„æ€§èƒ½ä¼˜åŠ¿</strong>ï¼š<ul><li>å› ä¸ºæœ‰ä¸¤æŠŠé”ï¼Œè¯»æ“ä½œå’Œå†™æ“ä½œå¯ä»¥å¹¶è¡Œè¿›è¡Œï¼Œä»è€Œå‡å°‘äº†é”ç«äº‰å’Œçº¿ç¨‹ç­‰å¾…æ—¶é—´ã€‚</li><li>é€‚ç”¨äºè¯»å†™æ“ä½œé¢‘ç¹ä¸”å¹¶å‘åº¦è¾ƒé«˜çš„åœºæ™¯ã€‚</li></ul></li><li><strong><code>ArrayBlockingQueue</code> çš„æ€§èƒ½åŠ£åŠ¿</strong>ï¼š<ul><li>ç”±äºåªæœ‰ä¸€æŠŠé”ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½å¿…é¡»ä¸²è¡ŒåŒ–ï¼Œä»è€Œå¢åŠ äº†é”ç«äº‰å’Œçº¿ç¨‹ç­‰å¾…æ—¶é—´ã€‚</li><li>æ›´é€‚ç”¨äºè¯»å†™æ“ä½œè¾ƒå°‘æˆ–è€…å¹¶å‘åº¦ä¸é«˜çš„åœºæ™¯ã€‚</li></ul></li></ul><h3 id="3-3-å¦‚ä½•ç¡®å®šæ ¸å¿ƒçº¿ç¨‹æ•°"><a href="#3-3-å¦‚ä½•ç¡®å®šæ ¸å¿ƒçº¿ç¨‹æ•°" class="headerlink" title="3.3 å¦‚ä½•ç¡®å®šæ ¸å¿ƒçº¿ç¨‹æ•°"></a>3.3 å¦‚ä½•ç¡®å®šæ ¸å¿ƒçº¿ç¨‹æ•°</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><p>æ€»ç»“ï¼š</p><p>å–è‡ªï¼š<a href="https://juejin.cn/post/6844903910096764942?searchId=20240523143106992E18EE943C881683A6#heading-5">https://juejin.cn/post/6844903910096764942?searchId=20240523143106992E18EE943C881683A6#heading-5</a></p><blockquote><p>æˆ‘ä»¬çŸ¥é“ä»»åŠ¡ä¸€èˆ¬æœ‰ä¸¤ç§ï¼šCPUå¯†é›†å‹å’ŒIOå¯†é›†å‹ã€‚é‚£ä¹ˆé¢å¯¹CPUå¯†é›†å‹çš„ä»»åŠ¡ï¼Œçº¿ç¨‹æ•°ä¸å®œè¿‡å¤šï¼Œä¸€èˆ¬é€‰æ‹©CPUæ ¸å¿ƒæ•°+1æˆ–è€…æ ¸å¿ƒæ•°çš„2å€æ˜¯æ¯”è¾ƒåˆç†çš„ä¸€ä¸ªå€¼ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥è€ƒè™‘å°†corePoolSizeè®¾ç½®ä¸ºCPUæ ¸å¿ƒæ•°+1ï¼ŒmaxPoolSizeè®¾ç½®ä¸ºæ ¸å¿ƒæ•°çš„2å€ã€‚é‚£ä¹ˆåŒæ ·çš„ï¼Œé¢å¯¹IOå¯†é›†å‹ä»»åŠ¡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä»¥æ ¸å¿ƒæ•°ä¹˜ä»¥4å€ä½œä¸ºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œç„¶åæ ¸å¿ƒæ•°ä¹˜ä»¥5å€ä½œä¸ºæœ€å¤§çº¿ç¨‹æ•°çš„æ–¹å¼å»è®¾ç½®çº¿ç¨‹æ•°ï¼Œè¿™æ ·çš„è®¾ç½®ä¼šæ¯”ç›´æ¥æ‹è„‘è¢‹è®¾ç½®ä¸€ä¸ªå€¼ä¼šæ›´åˆç†ä¸€äº›ã€‚</p><p>å½“ç„¶æ€»çš„çº¿ç¨‹æ•°ä¸å®œè¿‡å¤šï¼Œæ§åˆ¶åœ¨100ä¸ªçº¿ç¨‹ä»¥å†…æ¯”è¾ƒåˆç†ï¼Œå¦åˆ™çº¿ç¨‹æ•°è¿‡å¤šå¯èƒ½ä¼šå¯¼è‡´é¢‘ç¹åœ°ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¯¼è‡´ç³»ç»Ÿæ€§èƒ½åä¸å¦‚å‰ã€‚</p></blockquote><p>åœ¨è®¾ç½®æ ¸å¿ƒçº¿ç¨‹æ•°ä¹‹å‰ï¼Œéœ€è¦å…ˆç†Ÿæ‚‰ä¸€äº›æ‰§è¡Œçº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡çš„ç±»å‹</p><ul><li>IOå¯†é›†å‹ä»»åŠ¡</li></ul><p>ä¸€èˆ¬æ¥è¯´ï¼šæ–‡ä»¶è¯»å†™ã€DBè¯»å†™ã€ç½‘ç»œè¯·æ±‚ç­‰</p><p>æ¨èï¼šæ ¸å¿ƒçº¿ç¨‹æ•°å¤§å°è®¾ç½®ä¸º2N+1    ï¼ˆNä¸ºè®¡ç®—æœºçš„CPUæ ¸æ•°ï¼‰</p><ul><li>CPUå¯†é›†å‹ä»»åŠ¡</li></ul><p>ä¸€èˆ¬æ¥è¯´ï¼šè®¡ç®—å‹ä»£ç ã€Bitmapè½¬æ¢ã€Gsonè½¬æ¢ç­‰</p><p>æ¨èï¼šæ ¸å¿ƒçº¿ç¨‹æ•°å¤§å°è®¾ç½®ä¸ºN+1    ï¼ˆNä¸ºè®¡ç®—æœºçš„CPUæ ¸æ•°ï¼‰</p><p>javaä»£ç æŸ¥çœ‹CPUæ ¸æ•°</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505221837189.png" alt="image-20230505221837189"></p><p>ğŸ”´ğŸŸ¡ğŸŸ¢<strong>å‚è€ƒå›ç­”ï¼š</strong></p><p>â‘  é«˜å¹¶å‘ã€ä»»åŠ¡æ‰§è¡Œæ—¶é—´çŸ­ â€“&gt;ï¼ˆ CPUæ ¸æ•°+1 ï¼‰ï¼Œå‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢</p><p>â‘¡ å¹¶å‘ä¸é«˜ã€ä»»åŠ¡æ‰§è¡Œæ—¶é—´é•¿</p><ul><li><p>IOå¯†é›†å‹çš„ä»»åŠ¡ â€“&gt; (CPUæ ¸æ•° * 2 + 1)</p></li><li><p>è®¡ç®—å¯†é›†å‹ä»»åŠ¡ â€“&gt; ï¼ˆ CPUæ ¸æ•°+1 ï¼‰</p></li></ul><p>â‘¢ å¹¶å‘é«˜ã€ä¸šåŠ¡æ‰§è¡Œæ—¶é—´é•¿ï¼Œè§£å†³è¿™ç§ç±»å‹ä»»åŠ¡çš„å…³é”®ä¸åœ¨äºçº¿ç¨‹æ± è€Œåœ¨äºæ•´ä½“æ¶æ„çš„è®¾è®¡ï¼Œçœ‹çœ‹è¿™äº›ä¸šåŠ¡é‡Œé¢æŸäº›æ•°æ®æ˜¯å¦èƒ½åšç¼“å­˜æ˜¯ç¬¬ä¸€æ­¥ï¼Œå¢åŠ æœåŠ¡å™¨æ˜¯ç¬¬äºŒæ­¥ï¼Œè‡³äºçº¿ç¨‹æ± çš„è®¾ç½®ï¼Œè®¾ç½®å‚è€ƒï¼ˆ2ï¼‰</p><h3 id="3-4-çº¿ç¨‹æ± çš„ç§ç±»æœ‰å“ªäº›"><a href="#3-4-çº¿ç¨‹æ± çš„ç§ç±»æœ‰å“ªäº›" class="headerlink" title="3.4 çº¿ç¨‹æ± çš„ç§ç±»æœ‰å“ªäº›"></a>3.4 çº¿ç¨‹æ± çš„ç§ç±»æœ‰å“ªäº›</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><p>åœ¨java.util.concurrent.Executorsç±»ä¸­æä¾›äº†å¤§é‡åˆ›å»ºè¿æ¥æ± çš„é™æ€æ–¹æ³•ï¼Œå¸¸è§å°±æœ‰å››ç§</p><ol><li><p>åˆ›å»ºä½¿ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± </p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505221959259.png" alt="image-20230505221959259"></p><ul><li><p>æ ¸å¿ƒçº¿ç¨‹æ•°ä¸æœ€å¤§çº¿ç¨‹æ•°ä¸€æ ·ï¼Œæ²¡æœ‰æ•‘æ€¥çº¿ç¨‹</p></li><li><p>é˜»å¡é˜Ÿåˆ—æ˜¯LinkedBlockingQueueï¼Œæœ€å¤§å®¹é‡ä¸ºInteger.MAX_VALUE</p></li><li><p><mark>é€‚ç”¨åœºæ™¯ï¼šé€‚ç”¨äºä»»åŠ¡é‡å·²çŸ¥ï¼Œç›¸å¯¹è€—æ—¶çš„ä»»åŠ¡</mark></p></li><li><p>æ¡ˆä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FixedThreadPoolCase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">FixedThreadDemo</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">                System.out.println(name + <span class="string">&quot;:&quot;</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼Œæ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°éƒ½æ˜¯3</span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            executorService.submit(<span class="keyword">new</span> <span class="title class_">FixedThreadDemo</span>());</span><br><span class="line">            Thread.sleep(<span class="number">10</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        executorService.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>å•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± ï¼Œå®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»» åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåº(FIFO)æ‰§è¡Œ</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505222050294.png" alt="image-20230505222050294"></p><ul><li><p>æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°éƒ½æ˜¯1</p></li><li><p>é˜»å¡é˜Ÿåˆ—æ˜¯LinkedBlockingQueueï¼Œæœ€å¤§å®¹é‡ä¸ºInteger.MAX_VALUE</p></li><li><p><mark>é€‚ç”¨åœºæ™¯ï¼šé€‚ç”¨äºæŒ‰ç…§é¡ºåºæ‰§è¡Œçš„ä»»åŠ¡</mark></p></li><li><p>æ¡ˆä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NewSingleThreadCase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Demo</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            count++;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;:&quot;</span> + count);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">//å•ä¸ªçº¿ç¨‹æ± ï¼Œæ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°éƒ½æ˜¯1</span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">exec</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            exec.execute(<span class="keyword">new</span> <span class="title class_">Demo</span>());</span><br><span class="line">            Thread.sleep(<span class="number">5</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        exec.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>å¯ç¼“å­˜çº¿ç¨‹æ± </p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505222126391.png" alt="image-20230505222126391"></p><ul><li><p>æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º0</p></li><li><p>æœ€å¤§çº¿ç¨‹æ•°æ˜¯Integer.MAX_VALUE</p></li><li><p>é˜»å¡é˜Ÿåˆ—ä¸ºSynchronousQueue:ä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªæ’å…¥æ“ä½œéƒ½å¿…é¡»ç­‰å¾…ä¸€ä¸ªç§»å‡ºæ“ä½œã€‚</p></li><li><p><mark>é€‚ç”¨åœºæ™¯ï¼šé€‚åˆä»»åŠ¡æ•°æ¯”è¾ƒå¯†é›†ï¼Œä½†æ¯ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´è¾ƒçŸ­çš„æƒ…å†µ</mark></p></li><li><p>æ¡ˆä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CachedThreadPoolCase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Demo</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//ä¿®æ”¹ç¡çœ æ—¶é—´ï¼Œæ¨¡æ‹Ÿçº¿ç¨‹æ‰§è¡Œéœ€è¦èŠ±è´¹çš„æ—¶é—´</span></span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">                System.out.println(name + <span class="string">&quot;æ‰§è¡Œå®Œäº†&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªç¼“å­˜çš„çº¿ç¨‹ï¼Œæ²¡æœ‰æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸ºInteger.MAX_VALUE</span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">exec</span> <span class="operator">=</span> Executors.newCachedThreadPool();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            exec.execute(<span class="keyword">new</span> <span class="title class_">Demo</span>());</span><br><span class="line">            Thread.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        exec.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>æä¾›äº†â€œå»¶è¿Ÿâ€å’Œâ€œå‘¨æœŸæ‰§è¡Œâ€åŠŸèƒ½çš„ThreadPoolExecutorã€‚</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505222203615.png" alt="image-20230505222203615"></p><ul><li><p><mark>é€‚ç”¨åœºæ™¯ï¼šæœ‰å®šæ—¶å’Œå»¶è¿Ÿæ‰§è¡Œçš„ä»»åŠ¡</mark></p></li><li><p>æ¡ˆä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScheduledThreadPoolCase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Task</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line"></span><br><span class="line">                System.out.println(name + <span class="string">&quot;, å¼€å§‹ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                System.out.println(name + <span class="string">&quot;, ç»“æŸï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">//æŒ‰ç…§å‘¨æœŸæ‰§è¡Œçš„çº¿ç¨‹æ± ï¼Œæ ¸å¿ƒçº¿ç¨‹æ•°ä¸º2ï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸ºInteger.MAX_VALUE</span></span><br><span class="line">        <span class="type">ScheduledExecutorService</span> <span class="variable">scheduledThreadPool</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¨‹åºå¼€å§‹ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * schedule æäº¤ä»»åŠ¡åˆ°çº¿ç¨‹æ± ä¸­</span></span><br><span class="line"><span class="comment">         * ç¬¬ä¸€ä¸ªå‚æ•°ï¼šæäº¤çš„ä»»åŠ¡</span></span><br><span class="line"><span class="comment">         * ç¬¬äºŒä¸ªå‚æ•°ï¼šä»»åŠ¡æ‰§è¡Œçš„å»¶è¿Ÿæ—¶é—´</span></span><br><span class="line"><span class="comment">         * ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šæ—¶é—´å•ä½</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        scheduledThreadPool.schedule(<span class="keyword">new</span> <span class="title class_">Task</span>(), <span class="number">0</span>, TimeUnit.SECONDS);</span><br><span class="line">        scheduledThreadPool.schedule(<span class="keyword">new</span> <span class="title class_">Task</span>(), <span class="number">1</span>, TimeUnit.SECONDS);</span><br><span class="line">        scheduledThreadPool.schedule(<span class="keyword">new</span> <span class="title class_">Task</span>(), <span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">        scheduledThreadPool.shutdown();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="3-5-ä¸ºä»€ä¹ˆä¸å»ºè®®ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ± "><a href="#3-5-ä¸ºä»€ä¹ˆä¸å»ºè®®ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ± " class="headerlink" title="3.5 ä¸ºä»€ä¹ˆä¸å»ºè®®ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ± "></a>3.5 ä¸ºä»€ä¹ˆä¸å»ºè®®ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ± </h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†</p></blockquote><p>å‚è€ƒé˜¿é‡Œå¼€å‘æ‰‹å†Œã€ŠJavaå¼€å‘æ‰‹å†Œ-åµ©å±±ç‰ˆã€‹</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20220821003816845.png" alt="image-20220821003816845"></p><h3 id="3-6çº¿ç¨‹æ± çš„é˜Ÿåˆ—æ»¡äº†å¦‚ä½•é¢„è­¦"><a href="#3-6çº¿ç¨‹æ± çš„é˜Ÿåˆ—æ»¡äº†å¦‚ä½•é¢„è­¦" class="headerlink" title="3.6çº¿ç¨‹æ± çš„é˜Ÿåˆ—æ»¡äº†å¦‚ä½•é¢„è­¦"></a>3.6çº¿ç¨‹æ± çš„é˜Ÿåˆ—æ»¡äº†å¦‚ä½•é¢„è­¦</h3><p>å½“çº¿ç¨‹æ± çš„é˜Ÿåˆ—æ»¡äº†æ—¶ï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹å‡ ç§æ–¹æ³•è¿›è¡Œé¢„è­¦ï¼š</p><h4 id="1-è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥"><a href="#1-è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥" class="headerlink" title="1. è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥"></a>1. <strong>è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥</strong></h4><p>çº¿ç¨‹æ± æä¾›äº†å¤šç§æ‹’ç»ç­–ç•¥ï¼ˆRejectionHandlerï¼‰ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥æ¥å®ç°é¢„è­¦åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå½“é˜Ÿåˆ—æ»¡äº†æ—¶ï¼Œå¯ä»¥å‘é€å‘Šè­¦ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomRejectedExecutionHandler</span> <span class="keyword">implements</span> <span class="title class_">RejectedExecutionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor executor)</span> &#123;</span><br><span class="line">        <span class="comment">// å‘é€å‘Šè­¦ä¿¡æ¯ï¼Œæ¯”å¦‚æ—¥å¿—è®°å½•æˆ–çŸ­ä¿¡ã€é‚®ä»¶é€šçŸ¥ç­‰</span></span><br><span class="line">        System.err.println(<span class="string">&quot;Task &quot;</span> + r.toString() + <span class="string">&quot; rejected from &quot;</span> + executor.toString());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¯ä»¥è¿›ä¸€æ­¥æ‰©å±•ï¼Œå°†å‘Šè­¦ä¿¡æ¯å‘é€åˆ°ç›‘æ§ç³»ç»Ÿ</span></span><br><span class="line">        <span class="comment">// notifyMonitoringSystem(r, executor);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºçº¿ç¨‹æ± æ—¶ä½¿ç”¨è‡ªå®šä¹‰çš„æ‹’ç»ç­–ç•¥</span></span><br><span class="line"><span class="type">ThreadPoolExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">    <span class="number">5</span>, <span class="number">10</span>, <span class="number">60</span>, TimeUnit.SECONDS,</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="number">100</span>),</span><br><span class="line">    Executors.defaultThreadFactory(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CustomRejectedExecutionHandler</span>()</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="2-ç›‘æ§çº¿ç¨‹æ± çŠ¶æ€"><a href="#2-ç›‘æ§çº¿ç¨‹æ± çŠ¶æ€" class="headerlink" title="2. ç›‘æ§çº¿ç¨‹æ± çŠ¶æ€"></a>2. <strong>ç›‘æ§çº¿ç¨‹æ± çŠ¶æ€</strong></h4><p>å¯ä»¥å®šæœŸæ£€æŸ¥çº¿ç¨‹æ± çš„çŠ¶æ€ï¼Œå¹¶åœ¨é˜Ÿåˆ—æ¥è¿‘æ»¡çš„æ—¶å€™å‘å‡ºé¢„è­¦ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡å®šæ—¶ä»»åŠ¡ç›‘æ§çº¿ç¨‹æ± é˜Ÿåˆ—çš„å¤§å°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadPoolMonitor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ThreadPoolExecutor executor;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ScheduledExecutorService</span> <span class="variable">scheduler</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ThreadPoolMonitor</span><span class="params">(ThreadPoolExecutor executor)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.executor = executor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startMonitoring</span><span class="params">()</span> &#123;</span><br><span class="line">        scheduler.scheduleAtFixedRate(() -&gt; &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">queueSize</span> <span class="operator">=</span> executor.getQueue().size();</span><br><span class="line">            <span class="type">int</span> <span class="variable">queueCapacity</span> <span class="operator">=</span> <span class="number">100</span>; <span class="comment">// å‡è®¾é˜Ÿåˆ—å®¹é‡ä¸º100</span></span><br><span class="line">            <span class="keyword">if</span> (queueSize &gt; queueCapacity * <span class="number">0.8</span>) &#123; <span class="comment">// é˜Ÿåˆ—è¶…è¿‡80%æ—¶é¢„è­¦</span></span><br><span class="line">                System.err.println(<span class="string">&quot;Warning: ThreadPool queue is &quot;</span> + queueSize + <span class="string">&quot; out of &quot;</span> + queueCapacity);</span><br><span class="line">                <span class="comment">// å‘é€å‘Šè­¦ä¿¡æ¯åˆ°ç›‘æ§ç³»ç»Ÿ</span></span><br><span class="line">                <span class="comment">// notifyMonitoringSystem(queueSize, queueCapacity);</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">0</span>, <span class="number">1</span>, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="type">ThreadPoolExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">    <span class="number">5</span>, <span class="number">10</span>, <span class="number">60</span>, TimeUnit.SECONDS,</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="number">100</span>)</span><br><span class="line">);</span><br><span class="line"><span class="type">ThreadPoolMonitor</span> <span class="variable">monitor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolMonitor</span>(executor);</span><br><span class="line">monitor.startMonitoring();</span><br></pre></td></tr></table></figure><h4 id="3-ä½¿ç”¨ç›‘æ§å·¥å…·"><a href="#3-ä½¿ç”¨ç›‘æ§å·¥å…·" class="headerlink" title="3. ä½¿ç”¨ç›‘æ§å·¥å…·"></a>3. <strong>ä½¿ç”¨ç›‘æ§å·¥å…·</strong></h4><p>å¯ä»¥å€ŸåŠ©ä¸€äº›ç°æˆçš„ç›‘æ§å·¥å…·å’Œæ¡†æ¶æ¥ç›‘æ§çº¿ç¨‹æ± çŠ¶æ€å¹¶è®¾ç½®å‘Šè­¦ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨Micrometerã€Prometheusç­‰ç›‘æ§å·¥å…·ï¼Œè¿™äº›å·¥å…·å¯ä»¥è½»æ¾é›†æˆåˆ°Springç­‰æ¡†æ¶ä¸­ã€‚</p><h4 id="4-æ—¥å¿—åˆ†æ"><a href="#4-æ—¥å¿—åˆ†æ" class="headerlink" title="4. æ—¥å¿—åˆ†æ"></a>4. <strong>æ—¥å¿—åˆ†æ</strong></h4><p>å°†çº¿ç¨‹æ± çš„çŠ¶æ€å˜åŒ–è®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œå¹¶é€šè¿‡æ—¥å¿—åˆ†æå·¥å…·ï¼ˆå¦‚ELK Stackï¼‰è¿›è¡Œç›‘æ§å’Œå‘Šè­¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggingRejectedExecutionHandler</span> <span class="keyword">implements</span> <span class="title class_">RejectedExecutionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor executor)</span> &#123;</span><br><span class="line">        <span class="comment">// è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ä¸­</span></span><br><span class="line">        <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> Logger.getLogger(<span class="string">&quot;ThreadPoolLogger&quot;</span>);</span><br><span class="line">        logger.warning(<span class="string">&quot;Task &quot;</span> + r.toString() + <span class="string">&quot; rejected from &quot;</span> + executor.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºçº¿ç¨‹æ± æ—¶ä½¿ç”¨æ—¥å¿—è®°å½•çš„æ‹’ç»ç­–ç•¥</span></span><br><span class="line"><span class="type">ThreadPoolExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">    <span class="number">5</span>, <span class="number">10</span>, <span class="number">60</span>, TimeUnit.SECONDS,</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="number">100</span>),</span><br><span class="line">    Executors.defaultThreadFactory(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">LoggingRejectedExecutionHandler</span>()</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šè¿°æ–¹æ³•å¯ä»¥å®ç°çº¿ç¨‹æ± é˜Ÿåˆ—æ»¡äº†æ—¶çš„é¢„è­¦ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚</p><h3 id="3-7å¦‚ä½•æ­£ç¡®å…³é—­çº¿ç¨‹æ± "><a href="#3-7å¦‚ä½•æ­£ç¡®å…³é—­çº¿ç¨‹æ± " class="headerlink" title="3.7å¦‚ä½•æ­£ç¡®å…³é—­çº¿ç¨‹æ± "></a>3.7å¦‚ä½•æ­£ç¡®å…³é—­çº¿ç¨‹æ± </h3><p>è¯´åˆ°å¦‚ä½•æ­£ç¡®å»å…³é—­ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œè¿™é‡Œé¢ä¹Ÿæœ‰ç‚¹è®²ç©¶ã€‚ä¸ºäº†å®ç°ä¼˜é›…åœæœºçš„ç›®æ ‡ï¼Œæˆ‘ä»¬åº”å½“å…ˆè°ƒç”¨shutdownæ–¹æ³•ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•ä¹Ÿå°±æ„å‘³ç€ï¼Œè¿™ä¸ªçº¿ç¨‹æ± ä¸ä¼šå†æ¥æ”¶ä»»ä½•æ–°çš„ä»»åŠ¡ï¼Œä½†æ˜¯å·²ç»æäº¤çš„ä»»åŠ¡è¿˜ä¼šç»§ç»­æ‰§è¡Œï¼ŒåŒ…æ‹¬é˜Ÿåˆ—ä¸­çš„ã€‚æ‰€ä»¥ï¼Œä¹‹åä½ è¿˜åº”å½“è°ƒç”¨awaitTerminationæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥è®¾å®šçº¿ç¨‹æ± åœ¨å…³é—­ä¹‹å‰çš„æœ€å¤§è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœåœ¨è¶…æ—¶æ—¶é—´ç»“æŸä¹‹å‰çº¿ç¨‹æ± èƒ½å¤Ÿæ­£å¸¸å…³é—­ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¿”å›trueï¼Œå¦åˆ™ï¼Œä¸€æ—¦è¶…æ—¶ï¼Œå°±ä¼šè¿”å›falseã€‚é€šå¸¸æ¥è¯´æˆ‘ä»¬ä¸å¯èƒ½æ— é™åˆ¶åœ°ç­‰å¾…ä¸‹å»ï¼Œå› æ­¤éœ€è¦æˆ‘ä»¬äº‹å…ˆé¢„ä¼°ä¸€ä¸ªåˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œç„¶åå»ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><p>å¦‚æœawaitTerminationæ–¹æ³•è¿”å›falseï¼Œä½ åˆå¸Œæœ›å°½å¯èƒ½åœ¨çº¿ç¨‹æ± å…³é—­ä¹‹åå†åšå…¶ä»–èµ„æºå›æ”¶å·¥ä½œï¼Œä½ å¯ä»¥è€ƒè™‘å†è°ƒç”¨ä¸€ä¸‹shutdownNowæ–¹æ³•ï¼Œæ­¤æ—¶é˜Ÿåˆ—ä¸­æ‰€æœ‰å°šæœªè¢«å¤„ç†çš„ä»»åŠ¡éƒ½ä¼šè¢«ä¸¢å¼ƒï¼ŒåŒæ—¶ä¼šè®¾ç½®çº¿ç¨‹æ± ä¸­æ¯ä¸ªçº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½ã€‚shutdownNowå¹¶ä¸ä¿è¯ä¸€å®šå¯ä»¥è®©æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹åœæ­¢å·¥ä½œï¼Œé™¤éæäº¤ç»™çº¿ç¨‹çš„ä»»åŠ¡èƒ½å¤Ÿæ­£ç¡®å“åº”ä¸­æ–­ã€‚</p><h3 id="3-8ä½¿ç”¨å•çº¿ç¨‹çº¿ç¨‹æ± ä¼˜åŒ–æ–¹æ¡ˆ"><a href="#3-8ä½¿ç”¨å•çº¿ç¨‹çº¿ç¨‹æ± ä¼˜åŒ–æ–¹æ¡ˆ" class="headerlink" title="3.8ä½¿ç”¨å•çº¿ç¨‹çº¿ç¨‹æ± ä¼˜åŒ–æ–¹æ¡ˆ"></a>3.8ä½¿ç”¨å•çº¿ç¨‹çº¿ç¨‹æ± ä¼˜åŒ–æ–¹æ¡ˆ</h3><p><a href="https://chatgpt.com/share/970432db-c2a6-47f4-af1e-5aacfdd57271">https://chatgpt.com/share/970432db-c2a6-47f4-af1e-5aacfdd57271</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…¨å±€IOå¯†é›†å‹çº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalThreadPool</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> ExecutorService instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ æ–¹æ³•ï¼Œé˜²æ­¢å¤–éƒ¨å®ä¾‹åŒ–</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">GlobalThreadPool</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å…¨å±€å”¯ä¸€çº¿ç¨‹æ± å®ä¾‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åŒé‡æ£€æŸ¥é”å®šï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨</span></span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (GlobalThreadPool.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = createThreadPool();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºçº¿ç¨‹æ± </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ExecutorService <span class="title function_">createThreadPool</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">corePoolSize</span> <span class="operator">=</span> <span class="number">32</span>; <span class="comment">// æ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆIOå¯†é›†å‹ä¸ºCPUæ ¸æ•°*4ï¼‰</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">maximumPoolSize</span> <span class="operator">=</span> <span class="number">40</span>; <span class="comment">// æœ€å¤§çº¿ç¨‹æ•°ï¼ˆIOå¯†é›†å‹ä¸ºCPUæ ¸æ•°*5ï¼‰</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">keepAliveTime</span> <span class="operator">=</span> <span class="number">60L</span>; <span class="comment">// ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼ˆç§’ï¼‰</span></span><br><span class="line">        <span class="type">TimeUnit</span> <span class="variable">unit</span> <span class="operator">=</span> TimeUnit.SECONDS; <span class="comment">// æ—¶é—´å•ä½</span></span><br><span class="line">        BlockingQueue&lt;Runnable&gt; workQueue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">100</span>); <span class="comment">// ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">        <span class="type">ThreadFactory</span> <span class="variable">threadFactory</span> <span class="operator">=</span> Executors.defaultThreadFactory(); <span class="comment">// çº¿ç¨‹å·¥å‚</span></span><br><span class="line">        <span class="type">RejectedExecutionHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomRejectedExecutionHandler</span>(); <span class="comment">// è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥ï¼šç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå‘é€é‚®ä»¶ï¼Œè®°å½•æ—¥å¿—</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, threadFactory, handler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance != <span class="literal">null</span>) &#123;</span><br><span class="line">            instance.shutdown();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!instance.awaitTermination(<span class="number">60</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">                    instance.shutdownNow();</span><br><span class="line">                    <span class="keyword">if</span> (!instance.awaitTermination(<span class="number">60</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">                        log.error(<span class="string">&quot;çº¿ç¨‹æ± æœªèƒ½æ­£å¸¸å…³é—­&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException ie) &#123;</span><br><span class="line">                instance.shutdownNow();</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çº¿ç¨‹æ± ä¸­-execute-å’Œ-submit-æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#çº¿ç¨‹æ± ä¸­-execute-å’Œ-submit-æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="çº¿ç¨‹æ± ä¸­ execute å’Œ submit æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>çº¿ç¨‹æ± ä¸­ execute å’Œ submit æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p><strong>è¿”å›ç±»å‹ä¸åŒ</strong>ï¼š</p><ul><li><code>execute(Runnable command)</code>ï¼šè¯¥æ–¹æ³•ç”¨äºæäº¤ä¸€ä¸ªä¸è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚å®ƒæ²¡æœ‰è¿”å›å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè°ƒç”¨ <code>execute</code> æ–¹æ³•åä¸ä¼šè¿”å›ä»»ä½•å¯¹è±¡ï¼Œä»»åŠ¡çš„ç»“æœï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰éœ€è¦åœ¨ä»»åŠ¡å†…éƒ¨å¤„ç†ã€‚</li><li><code>submit(Callable&lt;T&gt; task)</code> å’Œ <code>submit(Runnable task)</code>ï¼šè¿™ä¸¤ä¸ªæ–¹æ³•ç”¨äºæäº¤ä»»åŠ¡å¹¶è¿”å›ä¸€ä¸ª <code>Future</code> å¯¹è±¡ã€‚<code>Future</code> å¯¹è±¡å¯ä»¥ç”¨äºæ£€æŸ¥ä»»åŠ¡çš„çŠ¶æ€ï¼Œå¹¶ä¸”å¯ä»¥è·å–ä»»åŠ¡çš„æ‰§è¡Œç»“æœæˆ–è€…åœ¨ä»»åŠ¡å®Œæˆä¹‹å‰é˜»å¡ã€‚</li></ul><p><strong>å¼‚å¸¸å¤„ç†ä¸åŒ</strong>ï¼š</p><ul><li><code>execute(Runnable command)</code>ï¼šå¦‚æœä»»åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œçº¿ç¨‹æ± å°†å¤„ç†è¯¥å¼‚å¸¸å¹¶å°†å…¶è®°å½•åœ¨ <code>ThreadPoolExecutor</code> çš„æœªæ•è·å¼‚å¸¸å¤„ç†å™¨ä¸­ã€‚</li><li><code>submit(Callable&lt;T&gt; task)</code> å’Œ <code>submit(Runnable task)</code>ï¼šå¦‚æœä»»åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œå¼‚å¸¸å°†è¢«å°è£…åœ¨è¿”å›çš„ <code>Future</code> å¯¹è±¡ä¸­ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è°ƒç”¨ <code>Future.get()</code> æ–¹æ³•æ¥è·å–ã€‚<code>Future.get()</code> å°†ä¼šåœ¨ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºçš„ä»»ä½•å¼‚å¸¸åŒ…è£…æˆ <code>ExecutionException</code>ã€‚</li></ul><p><strong>ä»»åŠ¡ç±»å‹ä¸åŒ</strong>ï¼š</p><ul><li><code>execute(Runnable command)</code>ï¼šåªèƒ½æäº¤å®ç°äº† <code>Runnable</code> æ¥å£çš„ä»»åŠ¡ï¼Œ<code>Runnable</code> æ¥å£çš„ <code>run</code> æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ã€‚</li><li><code>submit(Callable&lt;T&gt; task)</code>ï¼šå¯ä»¥æäº¤å®ç°äº† <code>Callable</code> æ¥å£çš„ä»»åŠ¡ï¼Œ<code>Callable</code> æ¥å£çš„ <code>call</code> æ–¹æ³•æœ‰è¿”å›å€¼ã€‚<code>submit(Runnable task)</code> å¯ä»¥æäº¤å®ç°äº† <code>Runnable</code> æ¥å£çš„ä»»åŠ¡ï¼Œä½†è¿”å›çš„ <code>Future</code> çš„ <code>get</code> æ–¹æ³•å°†è¿”å› <code>null</code>ã€‚</li></ul><h2 id="4-çº¿ç¨‹ä½¿ç”¨åœºæ™¯é—®é¢˜"><a href="#4-çº¿ç¨‹ä½¿ç”¨åœºæ™¯é—®é¢˜" class="headerlink" title="4.çº¿ç¨‹ä½¿ç”¨åœºæ™¯é—®é¢˜"></a>4.çº¿ç¨‹ä½¿ç”¨åœºæ™¯é—®é¢˜</h2><h3 id="4-1-çº¿ç¨‹æ± ä½¿ç”¨åœºæ™¯CountDownLatchã€Futureï¼ˆä½ ä»¬é¡¹ç›®å“ªé‡Œç”¨åˆ°äº†å¤šçº¿ç¨‹ï¼‰"><a href="#4-1-çº¿ç¨‹æ± ä½¿ç”¨åœºæ™¯CountDownLatchã€Futureï¼ˆä½ ä»¬é¡¹ç›®å“ªé‡Œç”¨åˆ°äº†å¤šçº¿ç¨‹ï¼‰" class="headerlink" title="4.1 çº¿ç¨‹æ± ä½¿ç”¨åœºæ™¯CountDownLatchã€Futureï¼ˆä½ ä»¬é¡¹ç›®å“ªé‡Œç”¨åˆ°äº†å¤šçº¿ç¨‹ï¼‰"></a>4.1 çº¿ç¨‹æ± ä½¿ç”¨åœºæ™¯CountDownLatchã€Futureï¼ˆä½ ä»¬é¡¹ç›®å“ªé‡Œç”¨åˆ°äº†å¤šçº¿ç¨‹ï¼‰</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><h4 id="4-1-2-æ¡ˆä¾‹ä¸€ï¼ˆesæ•°æ®æ‰¹é‡å¯¼å…¥ï¼‰"><a href="#4-1-2-æ¡ˆä¾‹ä¸€ï¼ˆesæ•°æ®æ‰¹é‡å¯¼å…¥ï¼‰" class="headerlink" title="4.1.2 æ¡ˆä¾‹ä¸€ï¼ˆesæ•°æ®æ‰¹é‡å¯¼å…¥ï¼‰"></a>4.1.2 æ¡ˆä¾‹ä¸€ï¼ˆesæ•°æ®æ‰¹é‡å¯¼å…¥ï¼‰</h4><p>åœ¨æˆ‘ä»¬é¡¹ç›®ä¸Šçº¿ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ•°æ®åº“ä¸­çš„æ•°æ®ä¸€æ¬¡æ€§çš„åŒæ­¥åˆ°esç´¢å¼•åº“ä¸­ï¼Œä½†æ˜¯å½“æ—¶çš„æ•°æ®å¥½åƒæ˜¯1000ä¸‡å·¦å³ï¼Œä¸€æ¬¡æ€§è¯»å–æ•°æ®è‚¯å®šä¸è¡Œï¼ˆoomå¼‚å¸¸ï¼‰ï¼Œå½“æ—¶æˆ‘å°±æƒ³åˆ°å¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± çš„æ–¹å¼å¯¼å…¥ï¼Œåˆ©ç”¨CountDownLatchæ¥æ§åˆ¶ï¼Œå°±èƒ½é¿å…ä¸€æ¬¡æ€§åŠ è½½è¿‡å¤šï¼Œé˜²æ­¢å†…å­˜æº¢å‡º</p><p>æ•´ä½“æµç¨‹å°±æ˜¯é€šè¿‡CountDownLatch+çº¿ç¨‹æ± é…åˆå»æ‰§è¡Œ</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505223219951.png" alt="image-20230505223219951"></p><p>è¯¦ç»†å®ç°æµç¨‹ï¼š</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505223246059.png" alt="image-20230505223246059"></p><blockquote><p>è¯¦ç»†å®ç°ä»£ç ï¼Œè¯·æŸ¥çœ‹å½“å¤©ä»£ç </p></blockquote><h4 id="4-1-3-æ¡ˆä¾‹äºŒï¼ˆæ•°æ®æ±‡æ€»ï¼‰"><a href="#4-1-3-æ¡ˆä¾‹äºŒï¼ˆæ•°æ®æ±‡æ€»ï¼‰" class="headerlink" title="4.1.3 æ¡ˆä¾‹äºŒï¼ˆæ•°æ®æ±‡æ€»ï¼‰"></a>4.1.3 æ¡ˆä¾‹äºŒï¼ˆæ•°æ®æ±‡æ€»ï¼‰</h4><p>åœ¨ä¸€ä¸ªç”µå•†ç½‘ç«™ä¸­ï¼Œç”¨æˆ·ä¸‹å•ä¹‹åï¼Œéœ€è¦æŸ¥è¯¢æ•°æ®ï¼Œæ•°æ®åŒ…å«äº†ä¸‰éƒ¨åˆ†ï¼šè®¢å•ä¿¡æ¯ã€åŒ…å«çš„å•†å“ã€ç‰©æµä¿¡æ¯ï¼›è¿™ä¸‰å—ä¿¡æ¯éƒ½åœ¨ä¸åŒçš„å¾®æœåŠ¡ä¸­è¿›è¡Œå®ç°çš„ï¼Œæˆ‘ä»¬å¦‚ä½•å®Œæˆè¿™ä¸ªä¸šåŠ¡å‘¢ï¼Ÿ</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505223442924.png" alt="image-20230505223442924"></p><blockquote><p>è¯¦ç»†å®ç°ä»£ç ï¼Œè¯·æŸ¥çœ‹å½“å¤©ä»£ç </p></blockquote><ul><li><p>åœ¨å®é™…å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œéš¾å…éœ€è¦è°ƒç”¨å¤šä¸ªæ¥å£æ¥æ±‡æ€»æ•°æ®ï¼Œå¦‚æœæ‰€æœ‰æ¥å£ï¼ˆæˆ–éƒ¨åˆ†æ¥å£ï¼‰çš„æ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œå°±å¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± +futureæ¥æå‡æ€§èƒ½</p></li><li><p>æŠ¥è¡¨æ±‡æ€»</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505223536657.png" alt="image-20230505223536657"></p></li></ul><h4 id="4-1-4-æ¡ˆä¾‹äºŒï¼ˆå¼‚æ­¥è°ƒç”¨ï¼‰"><a href="#4-1-4-æ¡ˆä¾‹äºŒï¼ˆå¼‚æ­¥è°ƒç”¨ï¼‰" class="headerlink" title="4.1.4 æ¡ˆä¾‹äºŒï¼ˆå¼‚æ­¥è°ƒç”¨ï¼‰"></a>4.1.4 æ¡ˆä¾‹äºŒï¼ˆå¼‚æ­¥è°ƒç”¨ï¼‰</h4><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505223640038.png" alt="image-20230505223640038"></p><p>åœ¨è¿›è¡Œæœç´¢çš„æ—¶å€™ï¼Œéœ€è¦ä¿å­˜ç”¨æˆ·çš„æœç´¢è®°å½•ï¼Œè€Œæœç´¢è®°å½•ä¸èƒ½å½±å“ç”¨æˆ·çš„æ­£å¸¸æœç´¢ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå¼€å¯ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œå†å²è®°å½•çš„ä¿å­˜ï¼Œåœ¨æ–°å¼€å¯çš„çº¿ç¨‹åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥åˆ©ç”¨çº¿ç¨‹æäº¤ä»»åŠ¡</p><h3 id="4-1-å¦‚ä½•æ§åˆ¶æŸä¸ªæ–¹æ³•å…è®¸å¹¶å‘è®¿é—®çº¿ç¨‹çš„æ•°é‡ï¼Ÿ"><a href="#4-1-å¦‚ä½•æ§åˆ¶æŸä¸ªæ–¹æ³•å…è®¸å¹¶å‘è®¿é—®çº¿ç¨‹çš„æ•°é‡ï¼Ÿ" class="headerlink" title="4.1 å¦‚ä½•æ§åˆ¶æŸä¸ªæ–¹æ³•å…è®¸å¹¶å‘è®¿é—®çº¿ç¨‹çš„æ•°é‡ï¼Ÿ"></a>4.1 å¦‚ä½•æ§åˆ¶æŸä¸ªæ–¹æ³•å…è®¸å¹¶å‘è®¿é—®çº¿ç¨‹çš„æ•°é‡ï¼Ÿ</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†</p></blockquote><p>Semaphore [ËˆsÉ›mÉ™ËŒfÉ”r] ä¿¡å·é‡ï¼Œæ˜¯JUCåŒ…ä¸‹çš„ä¸€ä¸ªå·¥å…·ç±»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å…¶é™åˆ¶æ‰§è¡Œçš„çº¿ç¨‹æ•°é‡ï¼Œè¾¾åˆ°é™æµçš„æ•ˆæœ</p><p>å½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶å…ˆé€šè¿‡å…¶æ–¹æ³•è¿›è¡Œè·å–è®¸å¯æ“ä½œï¼Œè·å–åˆ°è®¸å¯çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œå½“çº¿ç¨‹æ‰§è¡Œå®Œæˆåè¿›è¡Œé‡Šæ”¾è®¸å¯æ“ä½œï¼Œæœªè·å–è¾¾åˆ°è®¸å¯çš„çº¿ç¨‹è¿›è¡Œç­‰å¾…æˆ–è€…ç›´æ¥ç»“æŸã€‚</p><p>Semaphoreä¸¤ä¸ªé‡è¦çš„æ–¹æ³•</p><p>lsemaphore.acquire()ï¼š è¯·æ±‚ä¸€ä¸ªä¿¡å·é‡ï¼Œè¿™æ—¶å€™çš„ä¿¡å·é‡ä¸ªæ•°-1ï¼ˆä¸€æ—¦æ²¡æœ‰å¯ä½¿ç”¨çš„ä¿¡å·é‡ï¼Œä¹Ÿå³ä¿¡å·é‡ä¸ªæ•°å˜ä¸ºè´Ÿæ•°æ—¶ï¼Œå†æ¬¡è¯·æ±‚çš„æ—¶å€™å°±ä¼šé˜»å¡ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹é‡Šæ”¾äº†ä¿¡å·é‡ï¼‰</p><p>lsemaphore.release()ï¼šé‡Šæ”¾ä¸€ä¸ªä¿¡å·é‡ï¼Œæ­¤æ—¶ä¿¡å·é‡ä¸ªæ•°+1</p><p>çº¿ç¨‹ä»»åŠ¡ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SemaphoreCase</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. åˆ›å»º semaphore å¯¹è±¡</span></span><br><span class="line">        <span class="type">Semaphore</span> <span class="variable">semaphore</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">// 2. 10ä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// 3. è·å–è®¸å¯</span></span><br><span class="line">                    semaphore.acquire();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;running...&quot;</span>);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    System.out.println(<span class="string">&quot;end...&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="comment">// 4. é‡Šæ”¾è®¸å¯</span></span><br><span class="line">                    semaphore.release();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-å…¶ä»–"><a href="#5-å…¶ä»–" class="headerlink" title="5.å…¶ä»–"></a>5.å…¶ä»–</h2><h3 id="5-1-è°ˆè°ˆä½ å¯¹ThreadLocalçš„ç†è§£"><a href="#5-1-è°ˆè°ˆä½ å¯¹ThreadLocalçš„ç†è§£" class="headerlink" title="5.1 è°ˆè°ˆä½ å¯¹ThreadLocalçš„ç†è§£"></a>5.1 è°ˆè°ˆä½ å¯¹ThreadLocalçš„ç†è§£</h3><blockquote><p>éš¾æ˜“ç¨‹åº¦ï¼šâ˜†â˜†â˜†</p><p>å‡ºç°é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†</p></blockquote><h4 id="5-1-1-æ¦‚è¿°"><a href="#5-1-1-æ¦‚è¿°" class="headerlink" title="5.1.1 æ¦‚è¿°"></a>5.1.1 æ¦‚è¿°</h4><p>ThreadLocalæ˜¯å¤šçº¿ç¨‹ä¸­å¯¹äºè§£å†³çº¿ç¨‹å®‰å…¨çš„ä¸€ä¸ªæ“ä½œç±»ï¼Œå®ƒä¼šä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹å‰¯æœ¬ä»è€Œè§£å†³äº†å˜é‡å¹¶å‘è®¿é—®å†²çªçš„é—®é¢˜ã€‚ThreadLocal åŒæ—¶å®ç°äº†çº¿ç¨‹å†…çš„èµ„æºå…±äº«</p><p>æ¡ˆä¾‹ï¼šä½¿ç”¨JDBCæ“ä½œæ•°æ®åº“æ—¶ï¼Œä¼šå°†æ¯ä¸€ä¸ªçº¿ç¨‹çš„Connectionæ”¾å…¥å„è‡ªçš„ThreadLocalä¸­ï¼Œä»è€Œä¿è¯æ¯ä¸ªçº¿ç¨‹éƒ½åœ¨å„è‡ªçš„ Connection ä¸Šè¿›è¡Œæ•°æ®åº“çš„æ“ä½œï¼Œé¿å…Açº¿ç¨‹å…³é—­äº†Bçº¿ç¨‹çš„è¿æ¥ã€‚</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505224057228.png" alt="image-20230505224057228"></p><h4 id="5-1-2-ThreadLocalåŸºæœ¬ä½¿ç”¨"><a href="#5-1-2-ThreadLocalåŸºæœ¬ä½¿ç”¨" class="headerlink" title="5.1.2 ThreadLocalåŸºæœ¬ä½¿ç”¨"></a>5.1.2 ThreadLocalåŸºæœ¬ä½¿ç”¨</h4><p>ä¸‰ä¸ªä¸»è¦æ–¹æ³•ï¼š</p><ul><li><p>set(value) è®¾ç½®å€¼</p></li><li><p>get() è·å–å€¼</p></li><li><p>remove() æ¸…é™¤å€¼</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalTest</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> ThreadLocal&lt;String&gt; threadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line">            threadLocal.set(<span class="string">&quot;itcast&quot;</span>);</span><br><span class="line">            print(name);</span><br><span class="line">            System.out.println(name + <span class="string">&quot;-after remove : &quot;</span> + threadLocal.get());</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line">            threadLocal.set(<span class="string">&quot;itheima&quot;</span>);</span><br><span class="line">            print(name);</span><br><span class="line">            System.out.println(name + <span class="string">&quot;-after remove : &quot;</span> + threadLocal.get());</span><br><span class="line">        &#125;, <span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="comment">//æ‰“å°å½“å‰çº¿ç¨‹ä¸­æœ¬åœ°å†…å­˜ä¸­æœ¬åœ°å˜é‡çš„å€¼</span></span><br><span class="line">        System.out.println(str + <span class="string">&quot; :&quot;</span> + threadLocal.get());</span><br><span class="line">        <span class="comment">//æ¸…é™¤æœ¬åœ°å†…å­˜ä¸­çš„æœ¬åœ°å˜é‡</span></span><br><span class="line">        threadLocal.remove();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-1-3-ThreadLocalçš„å®ç°åŸç†-æºç è§£æ"><a href="#5-1-3-ThreadLocalçš„å®ç°åŸç†-æºç è§£æ" class="headerlink" title="5.1.3 ThreadLocalçš„å®ç°åŸç†&amp;æºç è§£æ"></a>5.1.3 ThreadLocalçš„å®ç°åŸç†&amp;æºç è§£æ</h4><p>ThreadLocalæœ¬è´¨æ¥è¯´å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹å†…éƒ¨å­˜å‚¨ç±»ï¼Œä»è€Œè®©å¤šä¸ªçº¿ç¨‹åªæ“ä½œè‡ªå·±å†…éƒ¨çš„å€¼ï¼Œä»è€Œå®ç°çº¿ç¨‹æ•°æ®éš”ç¦»</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505224341410.png" alt="image-20230505224341410"></p><p>åœ¨ThreadLocalä¸­æœ‰ä¸€ä¸ªå†…éƒ¨ç±»å«åšThreadLocalMapï¼Œç±»ä¼¼äºHashMap</p><p>ThreadLocalMapä¸­æœ‰ä¸€ä¸ªå±æ€§tableæ•°ç»„ï¼Œè¿™ä¸ªæ˜¯çœŸæ­£å­˜å‚¨æ•°æ®çš„ä½ç½®</p><p><strong>setæ–¹æ³•</strong></p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505224626253.png" alt="image-20230505224626253"></p><p><strong>getæ–¹æ³•&#x2F;removeæ–¹æ³•</strong></p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505224715087.png" alt="image-20230505224715087"></p><h4 id="5-1-4-ThreadLocal-å†…å­˜æ³„éœ²é—®é¢˜"><a href="#5-1-4-ThreadLocal-å†…å­˜æ³„éœ²é—®é¢˜" class="headerlink" title="5.1.4 ThreadLocal-å†…å­˜æ³„éœ²é—®é¢˜"></a>5.1.4 ThreadLocal-å†…å­˜æ³„éœ²é—®é¢˜</h4><p>Javaå¯¹è±¡ä¸­çš„å››ç§å¼•ç”¨ç±»å‹ï¼šå¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨</p><ul><li>å¼ºå¼•ç”¨ï¼šæœ€ä¸ºæ™®é€šçš„å¼•ç”¨æ–¹å¼ï¼Œè¡¨ç¤ºä¸€ä¸ªå¯¹è±¡å¤„äºæœ‰ç”¨ä¸”å¿…é¡»çš„çŠ¶æ€ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰å¼ºå¼•ç”¨ï¼Œåˆ™GCå¹¶ä¸ä¼šå›æ”¶å®ƒã€‚å³ä¾¿å †ä¸­å†…å­˜ä¸è¶³äº†ï¼Œå®å¯å‡ºç°OOMï¼Œä¹Ÿä¸ä¼šå¯¹å…¶è¿›è¡Œå›æ”¶</li></ul><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505224755797.png" alt="image-20230505224755797"></p><ul><li>å¼±å¼•ç”¨ï¼šè¡¨ç¤ºä¸€ä¸ªå¯¹è±¡å¤„äºå¯èƒ½æœ‰ç”¨ä¸”éå¿…é¡»çš„çŠ¶æ€ã€‚åœ¨GCçº¿ç¨‹æ‰«æå†…å­˜åŒºåŸŸæ—¶ï¼Œä¸€æ—¦å‘ç°å¼±å¼•ç”¨ï¼Œå°±ä¼šå›æ”¶åˆ°å¼±å¼•ç”¨ç›¸å…³è”çš„å¯¹è±¡ã€‚å¯¹äºå¼±å¼•ç”¨çš„å›æ”¶ï¼Œæ— å…³å†…å­˜åŒºåŸŸæ˜¯å¦è¶³å¤Ÿï¼Œä¸€æ—¦å‘ç°åˆ™ä¼šè¢«å›æ”¶</li></ul><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505224812015.png" alt="image-20230505224812015"></p><p>æ¯ä¸€ä¸ªThreadç»´æŠ¤ä¸€ä¸ªThreadLocalMapï¼Œåœ¨ThreadLocalMapä¸­çš„Entryå¯¹è±¡ç»§æ‰¿äº†WeakReferenceã€‚å…¶ä¸­keyä¸ºä½¿ç”¨å¼±å¼•ç”¨çš„ThreadLocalå®ä¾‹ï¼Œvalueä¸ºçº¿ç¨‹å˜é‡çš„å‰¯æœ¬</p><p><img src="/../assets/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230505224857538.png" alt="image-20230505224857538"></p><p>åœ¨ä½¿ç”¨ThreadLocalçš„æ—¶å€™ï¼Œå¼ºçƒˆå»ºè®®ï¼š<strong>åŠ¡å¿…æ‰‹åŠ¨remove</strong></p><h2 id="6-çœŸå®é¢è¯•è¿˜åŸ"><a href="#6-çœŸå®é¢è¯•è¿˜åŸ" class="headerlink" title="6 çœŸå®é¢è¯•è¿˜åŸ"></a>6 çœŸå®é¢è¯•è¿˜åŸ</h2><h3 id="6-1-çº¿ç¨‹çš„åŸºç¡€çŸ¥è¯†"><a href="#6-1-çº¿ç¨‹çš„åŸºç¡€çŸ¥è¯†" class="headerlink" title="6.1 çº¿ç¨‹çš„åŸºç¡€çŸ¥è¯†"></a>6.1 çº¿ç¨‹çš„åŸºç¡€çŸ¥è¯†</h3><blockquote><p><strong>é¢è¯•å®˜</strong>ï¼šèŠä¸€ä¸‹å¹¶è¡Œå’Œå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><p><strong>å€™é€‰äººï¼š</strong></p><p>æ˜¯è¿™æ ·çš„~~</p><p>ç°åœ¨éƒ½æ˜¯å¤šæ ¸CPUï¼Œåœ¨å¤šæ ¸CPUä¸‹</p><p>å¹¶å‘æ˜¯åŒä¸€æ—¶é—´åº”å¯¹å¤šä»¶äº‹æƒ…çš„èƒ½åŠ›ï¼Œå¤šä¸ªçº¿ç¨‹è½®æµä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªCPU</p><p>å¹¶è¡Œæ˜¯åŒä¸€æ—¶é—´åŠ¨æ‰‹åšå¤šä»¶äº‹æƒ…çš„èƒ½åŠ›ï¼Œ4æ ¸CPUåŒæ—¶æ‰§è¡Œ4ä¸ªçº¿ç¨‹</p><hr><p><strong>é¢è¯•å®˜</strong>ï¼šè¯´ä¸€ä¸‹çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ</p><p><strong>å€™é€‰äººï¼š</strong></p><p>å—¯ï¼Œå¥½~</p><ul><li>è¿›ç¨‹æ˜¯æ­£åœ¨è¿è¡Œç¨‹åºçš„å®ä¾‹ï¼Œè¿›ç¨‹ä¸­åŒ…å«äº†çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œä¸åŒçš„ä»»åŠ¡</li><li>ä¸åŒçš„è¿›ç¨‹ä½¿ç”¨ä¸åŒçš„å†…å­˜ç©ºé—´ï¼Œåœ¨å½“å‰è¿›ç¨‹ä¸‹çš„æ‰€æœ‰çº¿ç¨‹å¯ä»¥å…±äº«å†…å­˜ç©ºé—´</li><li>çº¿ç¨‹æ›´è½»é‡ï¼Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ä¸€èˆ¬ä¸Šè¦æ¯”è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä½(ä¸Šä¸‹æ–‡åˆ‡æ¢æŒ‡çš„æ˜¯ä»ä¸€ä¸ªçº¿ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹)</li></ul><hr><p><strong>é¢è¯•å®˜</strong>ï¼šå¦‚æœåœ¨javaä¸­åˆ›å»ºçº¿ç¨‹æœ‰å“ªäº›æ–¹å¼ï¼Ÿ</p><p><strong>å€™é€‰äººï¼š</strong></p><p>åœ¨javaä¸­ä¸€å…±æœ‰å››ç§å¸¸è§çš„åˆ›å»ºæ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ï¼šç»§æ‰¿Threadç±»ã€å®ç°runnableæ¥å£ã€å®ç°Callableæ¥å£ã€çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é¡¹ç›®ä¸­éƒ½ä¼šé‡‡ç”¨çº¿ç¨‹æ± çš„æ–¹å¼åˆ›å»ºçº¿ç¨‹ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šå¥½çš„ï¼Œåˆšæ‰ä½ è¯´çš„runnable å’Œ callable ä¸¤ä¸ªæ¥å£åˆ›å»ºçº¿ç¨‹æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ</p><p><strong>å€™é€‰äººï¼š</strong></p><p>æ˜¯è¿™æ ·çš„~</p><p>æœ€ä¸»è¦çš„ä¸¤ä¸ªçº¿ç¨‹ä¸€ä¸ªæ˜¯æœ‰è¿”å›å€¼ï¼Œä¸€ä¸ªæ˜¯æ²¡æœ‰è¿”å›å€¼çš„ã€‚</p><p>Runnable æ¥å£runæ–¹æ³•æ— è¿”å›å€¼ï¼›Callableæ¥å£callæ–¹æ³•æœ‰è¿”å›å€¼ï¼Œæ˜¯ä¸ªæ³›å‹ï¼Œå’ŒFutureã€FutureTaské…åˆå¯ä»¥ç”¨æ¥è·å–å¼‚æ­¥æ‰§è¡Œçš„ç»“æœ</p><p>è¿˜æœ‰ä¸€ä¸ªå°±æ˜¯ï¼Œä»–ä»¬å¼‚å¸¸å¤„ç†ä¹Ÿä¸ä¸€æ ·ã€‚Runnableæ¥å£runæ–¹æ³•åªèƒ½æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ï¼Œä¹Ÿæ— æ³•æ•è·å¤„ç†ï¼›Callableæ¥å£callæ–¹æ³•å…è®¸æŠ›å‡ºå¼‚å¸¸ï¼Œå¯ä»¥è·å–å¼‚å¸¸ä¿¡æ¯</p><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¦‚æœéœ€è¦æ‹¿åˆ°æ‰§è¡Œçš„ç»“æœï¼Œéœ€è¦ä½¿ç”¨Callalbeæ¥å£åˆ›å»ºçº¿ç¨‹ï¼Œè°ƒç”¨FutureTask.get()å¾—åˆ°å¯ä»¥å¾—åˆ°è¿”å›å€¼ï¼Œæ­¤æ–¹æ³•ä¼šé˜»å¡ä¸»è¿›ç¨‹çš„ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œå¦‚æœä¸è°ƒç”¨ä¸ä¼šé˜»å¡ã€‚</p><hr><p><strong>é¢è¯•å®˜</strong>ï¼šçº¿ç¨‹åŒ…æ‹¬å“ªäº›çŠ¶æ€ï¼ŒçŠ¶æ€ä¹‹é—´æ˜¯å¦‚ä½•å˜åŒ–çš„ï¼Ÿ</p><p><strong>å€™é€‰äººï¼š</strong></p><p>åœ¨JDKä¸­çš„Threadç±»ä¸­çš„æšä¸¾Stateé‡Œé¢å®šä¹‰äº†6ä¸­çº¿ç¨‹çš„çŠ¶æ€åˆ†åˆ«æ˜¯ï¼šæ–°å»ºã€å¯è¿è¡Œã€ç»ˆç»“ã€é˜»å¡ã€ç­‰å¾…å’Œæœ‰æ—¶é™ç­‰å¾…å…­ç§ã€‚</p><p>å…³äºçº¿ç¨‹çš„çŠ¶æ€åˆ‡æ¢æƒ…å†µæ¯”è¾ƒå¤šã€‚æˆ‘åˆ†åˆ«ä»‹ç»ä¸€ä¸‹</p><p>å½“ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡è¢«åˆ›å»ºï¼Œä½†è¿˜æœªè°ƒç”¨ start æ–¹æ³•æ—¶å¤„äº<strong>æ–°å»º</strong>çŠ¶æ€ï¼Œè°ƒç”¨äº† start æ–¹æ³•ï¼Œå°±ä¼šç”±<strong>æ–°å»º</strong>è¿›å…¥<strong>å¯è¿è¡Œ</strong>çŠ¶æ€ã€‚å¦‚æœçº¿ç¨‹å†…ä»£ç å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œç”±<strong>å¯è¿è¡Œ</strong>è¿›å…¥<strong>ç»ˆç»“</strong>çŠ¶æ€ã€‚å½“ç„¶è¿™äº›æ˜¯ä¸€ä¸ªçº¿ç¨‹æ­£å¸¸æ‰§è¡Œæƒ…å†µã€‚</p><p>å¦‚æœçº¿ç¨‹è·å–é”å¤±è´¥åï¼Œç”±<strong>å¯è¿è¡Œ</strong>è¿›å…¥ Monitor çš„é˜»å¡é˜Ÿåˆ—<strong>é˜»å¡</strong>ï¼Œåªæœ‰å½“æŒé”çº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼Œä¼šæŒ‰ç…§ä¸€å®šè§„åˆ™å”¤é†’é˜»å¡é˜Ÿåˆ—ä¸­çš„<strong>é˜»å¡</strong>çº¿ç¨‹ï¼Œå”¤é†’åçš„çº¿ç¨‹è¿›å…¥<strong>å¯è¿è¡Œ</strong>çŠ¶æ€</p><p>å¦‚æœçº¿ç¨‹è·å–é”æˆåŠŸåï¼Œä½†ç”±äºæ¡ä»¶ä¸æ»¡è¶³ï¼Œè°ƒç”¨äº† wait() æ–¹æ³•ï¼Œæ­¤æ—¶ä»<strong>å¯è¿è¡Œ</strong>çŠ¶æ€é‡Šæ”¾é”<strong>ç­‰å¾…</strong>çŠ¶æ€ï¼Œå½“å…¶å®ƒæŒé”çº¿ç¨‹è°ƒç”¨ notify() æˆ– notifyAll() æ–¹æ³•ï¼Œä¼šæ¢å¤ä¸º<strong>å¯è¿è¡Œ</strong>çŠ¶æ€</p><p>è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯è°ƒç”¨ sleep(long) æ–¹æ³•ä¹Ÿä¼šä»<strong>å¯è¿è¡Œ</strong>çŠ¶æ€è¿›å…¥<strong>æœ‰æ—¶é™ç­‰å¾…</strong>çŠ¶æ€ï¼Œä¸éœ€è¦ä¸»åŠ¨å”¤é†’ï¼Œè¶…æ—¶æ—¶é—´åˆ°è‡ªç„¶æ¢å¤ä¸º<strong>å¯è¿è¡Œ</strong>çŠ¶æ€</p><p><strong>é¢è¯•å®˜</strong>ï¼šå—¯ï¼Œå¥½çš„ï¼Œåˆšæ‰ä½ è¯´çš„çº¿ç¨‹ä¸­çš„ wait å’Œ sleepæ–¹æ³•æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ</p><p><strong>å€™é€‰äººï¼š</strong></p><p>å®ƒä»¬ä¸¤ä¸ªçš„ç›¸åŒç‚¹æ˜¯éƒ½å¯ä»¥è®©å½“å‰çº¿ç¨‹æš‚æ—¶æ”¾å¼ƒ CPU çš„ä½¿ç”¨æƒï¼Œè¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p><p>ä¸åŒç‚¹ä¸»è¦æœ‰ä¸‰ä¸ªæ–¹é¢ï¼š</p><p>ç¬¬ä¸€ï¼šæ–¹æ³•å½’å±ä¸åŒ</p><p>sleep(long) æ˜¯ Thread çš„é™æ€æ–¹æ³•ã€‚è€Œ wait()ï¼Œæ˜¯ Object çš„æˆå‘˜æ–¹æ³•ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰</p><p>ç¬¬äºŒï¼šçº¿ç¨‹é†’æ¥æ—¶æœºä¸åŒ</p><p>çº¿ç¨‹æ‰§è¡Œ sleep(long) ä¼šåœ¨ç­‰å¾…ç›¸åº”æ¯«ç§’åé†’æ¥ï¼Œè€Œ wait() éœ€è¦è¢« notify å”¤é†’ï¼Œwait() å¦‚æœä¸å”¤é†’å°±ä¸€ç›´ç­‰ä¸‹å»</p><p>ç¬¬ä¸‰ï¼šé”ç‰¹æ€§ä¸åŒ</p><p>wait æ–¹æ³•çš„è°ƒç”¨å¿…é¡»å…ˆè·å– wait å¯¹è±¡çš„é”ï¼Œè€Œ sleep åˆ™æ— æ­¤é™åˆ¶</p><p>wait æ–¹æ³•æ‰§è¡Œåä¼šé‡Šæ”¾å¯¹è±¡é”ï¼Œå…è®¸å…¶å®ƒçº¿ç¨‹è·å¾—è¯¥å¯¹è±¡é”ï¼ˆç›¸å½“äºæˆ‘æ”¾å¼ƒ cpuï¼Œä½†ä½ ä»¬è¿˜å¯ä»¥ç”¨ï¼‰</p><p>è€Œ sleep å¦‚æœåœ¨ synchronized ä»£ç å—ä¸­æ‰§è¡Œï¼Œå¹¶ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ï¼ˆç›¸å½“äºæˆ‘æ”¾å¼ƒ cpuï¼Œä½ ä»¬ä¹Ÿç”¨ä¸äº†ï¼‰</p><p><strong>é¢è¯•å®˜</strong>ï¼šå¥½çš„ï¼Œæˆ‘ç°åœ¨ä¸¾ä¸€ä¸ªåœºæ™¯ï¼Œä½ æ¥åˆ†æä¸€ä¸‹æ€ä¹ˆåšï¼Œæ–°å»º T1ã€T2ã€T3 ä¸‰ä¸ªçº¿ç¨‹ï¼Œå¦‚ä½•ä¿è¯å®ƒä»¬æŒ‰é¡ºåºæ‰§è¡Œï¼Ÿ</p><p><strong>å€™é€‰äººï¼š</strong></p><p>å—¯~~ï¼Œæˆ‘æ€è€ƒä¸€ä¸‹ ï¼ˆé€‚å½“çš„æ€è€ƒæˆ–æƒ³ä¸€ä¸‹å±äºæ­£å¸¸æƒ…å†µï¼Œè„±å£è€Œå‡ºåè€Œå¤ªå‡[èƒŒè¯µç—•è¿¹]ï¼‰</p><p>å¯ä»¥è¿™ä¹ˆåšï¼Œåœ¨å¤šçº¿ç¨‹ä¸­æœ‰å¤šç§æ–¹æ³•è®©çº¿ç¨‹æŒ‰ç‰¹å®šé¡ºåºæ‰§è¡Œï¼Œå¯ä»¥ç”¨çº¿ç¨‹ç±»çš„<strong>join</strong>()æ–¹æ³•åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å¯åŠ¨å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹å®Œæˆè¯¥çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚</p><p>æ¯”å¦‚è¯´ï¼š</p><p>ä½¿ç”¨joinæ–¹æ³•ï¼ŒT3è°ƒç”¨T2ï¼ŒT2è°ƒç”¨T1ï¼Œè¿™æ ·å°±èƒ½ç¡®ä¿T1å°±ä¼šå…ˆå®Œæˆè€ŒT3æœ€åå®Œæˆ</p><p><strong>é¢è¯•å®˜</strong>ï¼šåœ¨æˆ‘ä»¬ä½¿ç”¨çº¿ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸¤ä¸ªæ–¹æ³•ã€‚çº¿ç¨‹çš„ run()å’Œ start()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><p><strong>å€™é€‰äººï¼š</strong></p><p>startæ–¹æ³•ç”¨æ¥å¯åŠ¨çº¿ç¨‹ï¼Œé€šè¿‡è¯¥çº¿ç¨‹è°ƒç”¨runæ–¹æ³•æ‰§è¡Œrunæ–¹æ³•ä¸­æ‰€å®šä¹‰çš„é€»è¾‘ä»£ç ã€‚startæ–¹æ³•åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚runæ–¹æ³•å°è£…äº†è¦è¢«çº¿ç¨‹æ‰§è¡Œçš„ä»£ç ï¼Œå¯ä»¥è¢«è°ƒç”¨å¤šæ¬¡ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šé‚£å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹å‘¢ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥åœæ­¢çº¿ç¨‹</p><p>ç¬¬ä¸€ï¼šå¯ä»¥ä½¿ç”¨é€€å‡ºæ ‡å¿—ï¼Œä½¿çº¿ç¨‹æ­£å¸¸é€€å‡ºï¼Œä¹Ÿå°±æ˜¯å½“runæ–¹æ³•å®Œæˆåçº¿ç¨‹ç»ˆæ­¢ï¼Œä¸€èˆ¬æˆ‘ä»¬åŠ ä¸€ä¸ªæ ‡è®°</p><p>ç¬¬äºŒï¼šå¯ä»¥ä½¿ç”¨çº¿ç¨‹çš„stopæ–¹æ³•å¼ºè¡Œç»ˆæ­¢ï¼Œä¸è¿‡ä¸€èˆ¬ä¸æ¨èï¼Œè¿™ä¸ªæ–¹æ³•å·²ä½œåºŸ</p><p>ç¬¬ä¸‰ï¼šå¯ä»¥ä½¿ç”¨çº¿ç¨‹çš„interruptæ–¹æ³•ä¸­æ–­çº¿ç¨‹ï¼Œå†…éƒ¨å…¶å®ä¹Ÿæ˜¯ä½¿ç”¨ä¸­æ–­æ ‡å¿—æ¥ä¸­æ–­çº¿ç¨‹</p><p>æˆ‘ä»¬é¡¹ç›®ä¸­ä½¿ç”¨çš„è¯ï¼Œå»ºè®®ä½¿ç”¨ç¬¬ä¸€ç§æˆ–ç¬¬ä¸‰ç§æ–¹å¼ä¸­æ–­çº¿ç¨‹</p></blockquote><h3 id="6-2-çº¿ç¨‹ä¸­å¹¶å‘é”"><a href="#6-2-çº¿ç¨‹ä¸­å¹¶å‘é”" class="headerlink" title="6.2 çº¿ç¨‹ä¸­å¹¶å‘é”"></a>6.2 çº¿ç¨‹ä¸­å¹¶å‘é”</h3><blockquote><p><strong>é¢è¯•å®˜</strong>ï¼šè®²ä¸€ä¸‹synchronizedå…³é”®å­—çš„åº•å±‚åŸç†ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯~~å¥½çš„ï¼Œ</p><p>synchronized åº•å±‚ä½¿ç”¨çš„JVMçº§åˆ«ä¸­çš„Monitor æ¥å†³å®šå½“å‰çº¿ç¨‹æ˜¯å¦è·å¾—äº†é”ï¼Œå¦‚æœæŸä¸€ä¸ªçº¿ç¨‹è·å¾—äº†é”ï¼Œåœ¨æ²¡æœ‰é‡Šæ”¾é”ä¹‹å‰ï¼Œå…¶ä»–çº¿ç¨‹æ˜¯ä¸èƒ½æˆ–å¾—åˆ°é”çš„ã€‚synchronized å±äºæ‚²è§‚é”ã€‚</p><p>synchronized å› ä¸ºéœ€è¦ä¾èµ–äºJVMçº§åˆ«çš„Monitor ï¼Œç›¸å¯¹æ€§èƒ½ä¹Ÿæ¯”è¾ƒä½ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šå¥½çš„ï¼Œä½ èƒ½å…·ä½“è¯´ä¸‹Monitor å—ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>monitorå¯¹è±¡å­˜åœ¨äºæ¯ä¸ªJavaå¯¹è±¡çš„å¯¹è±¡å¤´ä¸­ï¼Œsynchronized é”ä¾¿æ˜¯é€šè¿‡è¿™ç§æ–¹å¼è·å–é”çš„ï¼Œä¹Ÿæ˜¯ä¸ºä»€ä¹ˆJavaä¸­ä»»æ„å¯¹è±¡å¯ä»¥ä½œä¸ºé”çš„åŸå› </p><p>monitorå†…éƒ¨ç»´æŠ¤äº†ä¸‰ä¸ªå˜é‡</p><ul><li><p>WaitSetï¼šä¿å­˜å¤„äºWaitingçŠ¶æ€çš„çº¿ç¨‹</p></li><li><p>EntryListï¼šä¿å­˜å¤„äºBlockedçŠ¶æ€çš„çº¿ç¨‹</p></li><li><p>Ownerï¼šæŒæœ‰é”çš„çº¿ç¨‹</p></li></ul><p>åªæœ‰ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°çš„æ ‡å¿—å°±æ˜¯åœ¨monitorä¸­è®¾ç½®æˆåŠŸäº†Ownerï¼Œä¸€ä¸ªmonitorä¸­åªèƒ½æœ‰ä¸€ä¸ªOwner</p><p>åœ¨ä¸Šé”çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰å…¶ä»–çº¿ç¨‹ä¹Ÿæ¥æŠ¢é”ï¼Œåˆ™è¿›å…¥EntryList è¿›è¡Œé˜»å¡ï¼Œå½“è·å¾—é”çš„çº¿ç¨‹æ‰§è¡Œå®Œäº†ï¼Œé‡Šæ”¾äº†é”ï¼Œå°±ä¼šå”¤é†’EntryList ä¸­ç­‰å¾…çš„çº¿ç¨‹ç«äº‰é”ï¼Œç«äº‰çš„æ—¶å€™æ˜¯éå…¬å¹³çš„ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šå¥½çš„ï¼Œé‚£å…³äºsynchronized çš„é”å‡çº§çš„æƒ…å†µäº†è§£å—ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼ŒçŸ¥é“ä¸€äº›ï¼ˆè¦è°¦è™šï¼‰</p><p>Javaä¸­çš„synchronizedæœ‰åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ä¸‰ç§å½¢å¼ï¼Œåˆ†åˆ«å¯¹åº”äº†é”åªè¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€ä¸åŒçº¿ç¨‹äº¤æ›¿æŒæœ‰é”ã€å¤šçº¿ç¨‹ç«äº‰é”ä¸‰ç§æƒ…å†µã€‚</p><p>é‡é‡çº§é”ï¼šåº•å±‚ä½¿ç”¨çš„Monitorå®ç°ï¼Œé‡Œé¢æ¶‰åŠåˆ°äº†ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢ã€è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæˆæœ¬è¾ƒé«˜ï¼Œæ€§èƒ½æ¯”è¾ƒä½ã€‚</p><p>è½»é‡çº§é”ï¼šçº¿ç¨‹åŠ é”çš„æ—¶é—´æ˜¯é”™å¼€çš„ï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰ç«äº‰ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨è½»é‡çº§é”æ¥ä¼˜åŒ–ã€‚è½»é‡çº§ä¿®æ”¹äº†å¯¹è±¡å¤´çš„é”æ ‡å¿—ï¼Œç›¸å¯¹é‡é‡çº§é”æ€§èƒ½æå‡å¾ˆå¤šã€‚æ¯æ¬¡ä¿®æ”¹éƒ½æ˜¯CASæ“ä½œï¼Œä¿è¯åŸå­æ€§</p><p>åå‘é”ï¼šä¸€æ®µå¾ˆé•¿çš„æ—¶é—´å†…éƒ½åªè¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨é”ï¼Œå¯ä»¥ä½¿ç”¨äº†åå‘é”ï¼Œåœ¨ç¬¬ä¸€æ¬¡è·å¾—é”æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ªCASæ“ä½œï¼Œä¹‹åè¯¥çº¿ç¨‹å†è·å–é”ï¼Œåªéœ€è¦åˆ¤æ–­mark wordä¸­æ˜¯å¦æ˜¯è‡ªå·±çš„çº¿ç¨‹idå³å¯ï¼Œè€Œä¸æ˜¯å¼€é”€ç›¸å¯¹è¾ƒå¤§çš„CASå‘½ä»¤</p><p>ä¸€æ—¦é”å‘ç”Ÿäº†ç«äº‰ï¼Œéƒ½ä¼šå‡çº§ä¸ºé‡é‡çº§é”</p><p><strong>é¢è¯•å®˜</strong>ï¼šå¥½çš„ï¼Œåˆšæ‰ä½ è¯´äº†synchronizedå®ƒåœ¨é«˜å¹¶å‘é‡çš„æƒ…å†µä¸‹ï¼Œæ€§èƒ½ä¸é«˜ï¼Œåœ¨é¡¹ç›®è¯¥å¦‚ä½•æ§åˆ¶ä½¿ç”¨é”å‘¢ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼Œå…¶å®ï¼Œåœ¨é«˜å¹¶å‘ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ReentrantLockæ¥åŠ é”ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šå—¯ï¼Œé‚£ä½ è¯´ä¸‹ReentrantLockçš„ä½¿ç”¨æ–¹å¼å’Œåº•å±‚åŸç†ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å¥½çš„ï¼Œ</p><p>ReentrantLockæ˜¯ä¸€ä¸ªå¯é‡å…¥é”:ï¼Œè°ƒç”¨ lock æ–¹ æ³•è·å–äº†é”ä¹‹åï¼Œå†æ¬¡è°ƒç”¨ lockï¼Œæ˜¯ä¸ä¼šå†é˜»å¡ï¼Œå†…éƒ¨ç›´æ¥å¢åŠ é‡å…¥æ¬¡æ•° å°±è¡Œäº†ï¼Œæ ‡è¯†è¿™ä¸ªçº¿ç¨‹å·²ç»é‡å¤è·å–ä¸€æŠŠé”è€Œä¸éœ€è¦ç­‰å¾…é”çš„é‡Šæ”¾ã€‚</p><p>ReentrantLockæ˜¯å±äºjucæŠ¥ä¸‹çš„ç±»ï¼Œå±äºapiå±‚é¢çš„é”ï¼Œè·Ÿsynchronizedä¸€æ ·ï¼Œéƒ½æ˜¯æ‚²è§‚é”ã€‚é€šè¿‡lock()ç”¨æ¥è·å–é”ï¼Œunlock()é‡Šæ”¾é”ã€‚</p><p>å®ƒçš„åº•å±‚å®ç°åŸç†ä¸»è¦åˆ©ç”¨<strong>CAS+AQSé˜Ÿåˆ—</strong>æ¥å®ç°ã€‚å®ƒæ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”ï¼Œä¸¤è€…çš„å®ç°ç±»ä¼¼</p><p>æ„é€ æ–¹æ³•æ¥å—ä¸€ä¸ªå¯é€‰çš„å…¬å¹³å‚æ•°ï¼ˆ<strong>é»˜è®¤éå…¬å¹³é”</strong>ï¼‰ï¼Œå½“è®¾ç½®ä¸ºtrueæ—¶ï¼Œè¡¨ç¤ºå…¬å¹³é”ï¼Œå¦åˆ™ä¸ºéå…¬å¹³é”ã€‚å…¬å¹³é”çš„æ•ˆç‡å¾€å¾€æ²¡æœ‰éå…¬å¹³é”çš„æ•ˆç‡é«˜ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šå¥½çš„ï¼Œåˆšæ‰ä½ è¯´äº†CASå’ŒAQSï¼Œä½ èƒ½ä»‹ç»ä¸€ä¸‹å—ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å¥½çš„ã€‚</p><p>CASçš„å…¨ç§°æ˜¯ï¼š Compare And Swap(æ¯”è¾ƒå†äº¤æ¢);å®ƒä½“ç°çš„ä¸€ç§ä¹è§‚é”çš„æ€æƒ³ï¼Œåœ¨æ— é”çŠ¶æ€ä¸‹ä¿è¯çº¿ç¨‹æ“ä½œæ•°æ®çš„åŸå­æ€§ã€‚</p><ul><li><p>CASä½¿ç”¨åˆ°çš„åœ°æ–¹å¾ˆå¤šï¼šAQSæ¡†æ¶ã€AtomicXXXç±»</p></li><li><p>åœ¨æ“ä½œå…±äº«å˜é‡çš„æ—¶å€™ä½¿ç”¨çš„è‡ªæ—‹é”ï¼Œæ•ˆç‡ä¸Šæ›´é«˜ä¸€äº›</p></li><li><p>CASçš„åº•å±‚æ˜¯è°ƒç”¨çš„Unsafeç±»ä¸­çš„æ–¹æ³•ï¼Œéƒ½æ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„ï¼Œå…¶ä»–è¯­è¨€å®ç°</p></li></ul><p>AQSçš„è¯ï¼Œå…¶å®å°±ä¸€ä¸ªjdkæä¾›çš„ç±»AbstractQueuedSynchronizerï¼Œæ˜¯é˜»å¡å¼é”å’Œç›¸å…³çš„åŒæ­¥å™¨å·¥å…·çš„æ¡†æ¶ã€‚</p><p>å†…éƒ¨æœ‰ä¸€ä¸ªå±æ€§ state å±æ€§æ¥è¡¨ç¤ºèµ„æºçš„çŠ¶æ€ï¼Œé»˜è®¤stateç­‰äº0ï¼Œè¡¨ç¤ºæ²¡æœ‰è·å–é”ï¼Œstateç­‰äº1çš„æ—¶å€™æ‰æ ‡æ˜è·å–åˆ°äº†é”ã€‚é€šè¿‡cas æœºåˆ¶è®¾ç½® state çŠ¶æ€</p><p>åœ¨å®ƒçš„å†…éƒ¨è¿˜æä¾›äº†åŸºäº FIFO çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œæ˜¯ä¸€ä¸ªåŒå‘åˆ—è¡¨ï¼Œå…¶ä¸­</p><ul><li><p>tail æŒ‡å‘é˜Ÿåˆ—æœ€åä¸€ä¸ªå…ƒç´ </p></li><li><p>head  æŒ‡å‘é˜Ÿåˆ—ä¸­æœ€ä¹…çš„ä¸€ä¸ªå…ƒç´ </p></li></ul><p>å…¶ä¸­æˆ‘ä»¬åˆšåˆšèŠçš„ReentrantLockåº•å±‚çš„å®ç°å°±æ˜¯ä¸€ä¸ªAQSã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šsynchronizedå’ŒLockæœ‰ä»€ä¹ˆåŒºåˆ« ? </p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯~~ï¼Œå¥½çš„ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªæ–¹é¢ä¸å¤ªä¸€æ ·</p><p>ç¬¬ä¸€ï¼Œè¯­æ³•å±‚é¢</p><ul><li>synchronized æ˜¯å…³é”®å­—ï¼Œæºç åœ¨ jvm ä¸­ï¼Œç”¨ c++ è¯­è¨€å®ç°ï¼Œé€€å‡ºåŒæ­¥ä»£ç å—é”ä¼šè‡ªåŠ¨é‡Šæ”¾</li><li>Lock æ˜¯æ¥å£ï¼Œæºç ç”± jdk æä¾›ï¼Œç”¨ java è¯­è¨€å®ç°ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨ unlock æ–¹æ³•é‡Šæ”¾é”</li></ul><p>ç¬¬äºŒï¼ŒåŠŸèƒ½å±‚é¢</p><ul><li>äºŒè€…å‡å±äºæ‚²è§‚é”ã€éƒ½å…·å¤‡åŸºæœ¬çš„äº’æ–¥ã€åŒæ­¥ã€é”é‡å…¥åŠŸèƒ½</li><li>Lock æä¾›äº†è®¸å¤š synchronized ä¸å…·å¤‡çš„åŠŸèƒ½ï¼Œä¾‹å¦‚è·å–ç­‰å¾…çŠ¶æ€ã€å…¬å¹³é”ã€å¯æ‰“æ–­ã€å¯è¶…æ—¶ã€å¤šæ¡ä»¶å˜é‡ï¼ŒåŒæ—¶Lock å¯ä»¥å®ç°ä¸åŒçš„åœºæ™¯ï¼Œå¦‚ ReentrantLockï¼Œ ReentrantReadWriteLock</li></ul><p>ç¬¬ä¸‰ï¼Œæ€§èƒ½å±‚é¢</p><ul><li>åœ¨æ²¡æœ‰ç«äº‰æ—¶ï¼Œsynchronized åšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œå¦‚åå‘é”ã€è½»é‡çº§é”ï¼Œæ€§èƒ½ä¸èµ–</li><li>åœ¨ç«äº‰æ¿€çƒˆæ—¶ï¼ŒLock çš„å®ç°é€šå¸¸ä¼šæä¾›æ›´å¥½çš„æ€§èƒ½</li></ul><p>ç»Ÿåˆæ¥çœ‹ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„åœºæ™¯æ¥é€‰æ‹©ä¸åŒçš„é”çš„ä½¿ç”¨ã€‚</p><hr><p><strong>é¢è¯•å®˜</strong>ï¼šæ­»é”äº§ç”Ÿçš„æ¡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼Œæ˜¯è¿™æ ·çš„ï¼Œä¸€ä¸ªçº¿ç¨‹éœ€è¦åŒæ—¶è·å–å¤šæŠŠé”ï¼Œè¿™æ—¶å°±å®¹æ˜“å‘ç”Ÿæ­»é”ï¼Œä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼š</p><p>t1 çº¿ç¨‹è·å¾—Aå¯¹è±¡é”ï¼Œæ¥ä¸‹æ¥æƒ³è·å–Bå¯¹è±¡çš„é”</p><p>t2 çº¿ç¨‹è·å¾—Bå¯¹è±¡é”ï¼Œæ¥ä¸‹æ¥æƒ³è·å–Aå¯¹è±¡çš„é” </p><p>è¿™ä¸ªæ—¶å€™t1çº¿ç¨‹å’Œt2çº¿ç¨‹éƒ½åœ¨äº’ç›¸ç­‰å¾…å¯¹æ–¹çš„é”ï¼Œå°±äº§ç”Ÿäº†æ­»é”</p><p><strong>é¢è¯•å®˜</strong>ï¼šé‚£å¦‚æœäº§å‡ºäº†è¿™æ ·çš„ï¼Œå¦‚ä½•è¿›è¡Œæ­»é”è¯Šæ–­ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>è¿™ä¸ªä¹Ÿå¾ˆå®¹æ˜“ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡jdkè‡ªåŠ¨çš„å·¥å…·å°±èƒ½æå®š</p><p>æˆ‘ä»¬å¯ä»¥å…ˆé€šè¿‡jpsæ¥æŸ¥çœ‹å½“å‰javaç¨‹åºè¿è¡Œçš„è¿›ç¨‹id</p><p>ç„¶åé€šè¿‡jstackæ¥æŸ¥çœ‹è¿™ä¸ªè¿›ç¨‹idï¼Œå°±èƒ½å±•ç¤ºå‡ºæ¥æ­»é”çš„é—®é¢˜ï¼Œå¹¶ä¸”ï¼Œå¯ä»¥å®šä½ä»£ç çš„å…·ä½“è¡Œå·èŒƒå›´ï¼Œæˆ‘ä»¬å†å»æ‰¾åˆ°å¯¹åº”çš„ä»£ç è¿›è¡Œæ’æŸ¥å°±è¡Œäº†ã€‚</p><hr><p><strong>é¢è¯•å®˜</strong>ï¼šè¯·è°ˆè°ˆä½ å¯¹ volatile çš„ç†è§£</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯~~</p><p>volatile æ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œå¯ä»¥ä¿®é¥°ç±»çš„æˆå‘˜å˜é‡ã€ç±»çš„é™æ€æˆå‘˜å˜é‡ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªåŠŸèƒ½</p><p>ç¬¬ä¸€ï¼šä¿è¯äº†ä¸åŒçº¿ç¨‹å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œæ“ä½œæ—¶çš„å¯è§æ€§ï¼Œå³ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå˜é‡çš„å€¼ï¼Œè¿™æ–°å€¼å¯¹å…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯ç«‹å³å¯è§çš„,volatileå…³é”®å­—ä¼šå¼ºåˆ¶å°†ä¿®æ”¹çš„å€¼ç«‹å³å†™å…¥ä¸»å­˜ã€‚</p><p>ç¬¬äºŒï¼š ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åºï¼Œå¯ä»¥ä¿è¯ä»£ç æ‰§è¡Œæœ‰åºæ€§ã€‚åº•å±‚å®ç°åŸç†æ˜¯ï¼Œæ·»åŠ äº†ä¸€ä¸ª<strong>å†…å­˜å±éšœ</strong>ï¼Œé€šè¿‡æ’å…¥å†…å­˜å±éšœç¦æ­¢åœ¨å†…å­˜å±éšœ<strong>å‰å</strong>çš„æŒ‡ä»¤æ‰§è¡Œé‡æ’åºä¼˜åŒ–</p><hr><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šæ¥ã€Šé›†åˆç›¸å…³é¢è¯•é¢˜ã€‹</p><p><strong>é¢è¯•å®˜</strong>ï¼šé‚£ä½ èƒ½èŠä¸€ä¸‹ConcurrentHashMapçš„åŸç†å—ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯å¥½çš„ï¼Œ</p><p>ConcurrentHashMap æ˜¯ä¸€ç§çº¿ç¨‹å®‰å…¨çš„é«˜æ•ˆMapé›†åˆï¼Œjdk1.7å’Œ1.8ä¹Ÿåšäº†å¾ˆå¤šè°ƒæ•´ã€‚</p><ul><li>JDK1.7çš„åº•å±‚é‡‡ç”¨æ˜¯<strong>åˆ†æ®µçš„æ•°ç»„</strong>+<strong>é“¾è¡¨</strong> å®ç°</li><li>JDK1.8 é‡‡ç”¨çš„æ•°æ®ç»“æ„è·ŸHashMap1.8çš„ç»“æ„ä¸€æ ·ï¼Œæ•°ç»„+é“¾è¡¨&#x2F;çº¢é»‘äºŒå‰æ ‘ã€‚</li></ul><p>åœ¨jdk1.7ä¸­ ConcurrentHashMap é‡ŒåŒ…å«ä¸€ä¸ª Segment æ•°ç»„ã€‚Segment çš„ç»“æ„å’ŒHashMapç±»ä¼¼ï¼Œæ˜¯ä¸€ ç§æ•°ç»„å’Œé“¾è¡¨ç»“æ„ï¼Œä¸€ä¸ª Segment åŒ…å«ä¸€ä¸ª HashEntry æ•°ç»„ï¼Œæ¯ä¸ª HashEntry æ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„ çš„å…ƒç´ ï¼Œæ¯ä¸ª Segment å®ˆæŠ¤ç€ä¸€ä¸ªHashEntryæ•°ç»„é‡Œçš„å…ƒç´ ï¼Œå½“å¯¹ HashEntry æ•°ç»„çš„æ•°æ®è¿›è¡Œä¿® æ”¹æ—¶ï¼Œå¿…é¡»é¦–å…ˆè·å¾—å¯¹åº”çš„ Segmentçš„é”ã€‚</p><p>Segment æ˜¯ä¸€ç§å¯é‡å…¥çš„é” ReentrantLockï¼Œæ¯ä¸ª Segment å®ˆæŠ¤ä¸€ä¸ªHashEntry æ•°ç»„é‡Œå¾—å…ƒ ç´ ï¼Œå½“å¯¹ HashEntry æ•°ç»„çš„æ•°æ®è¿›è¡Œä¿®æ”¹æ—¶ï¼Œå¿…é¡»é¦–å…ˆè·å¾—å¯¹åº”çš„ Segment é”</p><p>åœ¨jdk1.8ä¸­çš„ConcurrentHashMap åšäº†è¾ƒå¤§çš„ä¼˜åŒ–ï¼Œæ€§èƒ½æå‡äº†ä¸å°‘ã€‚é¦–å…ˆæ˜¯å®ƒçš„æ•°æ®ç»“æ„ä¸jdk1.8çš„hashMapæ•°æ®ç»“æ„å®Œå…¨ä¸€è‡´ã€‚å…¶æ¬¡æ˜¯æ”¾å¼ƒäº†Segmentè‡ƒè‚¿çš„è®¾è®¡ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯é‡‡ç”¨Node + CAS + Synchronizedæ¥ä¿ è¯å¹¶å‘å®‰å…¨è¿›è¡Œå®ç°ï¼Œsynchronizedåªé”å®šå½“å‰é“¾è¡¨æˆ–çº¢é»‘äºŒå‰æ ‘çš„é¦–èŠ‚ç‚¹ï¼Œè¿™æ ·åªè¦hashä¸å†² çªï¼Œå°±ä¸ä¼šäº§ç”Ÿå¹¶å‘ , æ•ˆç‡å¾—åˆ°æå‡</p></blockquote><h3 id="6-3-çº¿ç¨‹æ± "><a href="#6-3-çº¿ç¨‹æ± " class="headerlink" title="6.3 çº¿ç¨‹æ± "></a>6.3 çº¿ç¨‹æ± </h3><blockquote><p><strong>é¢è¯•å®˜</strong>ï¼šçº¿ç¨‹æ± çš„ç§ç±»æœ‰å“ªäº›ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼æ˜¯è¿™æ ·</p><p>åœ¨jdkä¸­é»˜è®¤æä¾›äº†4ä¸­æ–¹å¼åˆ›å»ºçº¿ç¨‹æ± </p><p>ç¬¬ä¸€ä¸ªæ˜¯ï¼šnewCachedThreadPoolåˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çº¿ç¨‹æ± ï¼Œå¦‚æœçº¿ç¨‹æ± é•¿åº¦è¶…è¿‡å¤„ç†éœ€è¦ï¼Œå¯çµæ´»å› æ”¶ç©ºé—²çº¿ç¨‹ï¼Œè‹¥æ— å¯å›æ”¶ï¼Œåˆ™æ–°å»ºçº¿ç¨‹ã€‚ </p><p>ç¬¬äºŒä¸ªæ˜¯ï¼šnewFixedThreadPool åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œå¯æ§åˆ¶çº¿ç¨‹æœ€å¤§å¹¶å‘æ•°ï¼Œè¶…å‡ºçš„çº¿ç¨‹ä¼šåœ¨é˜Ÿåˆ— ä¸­ç­‰å¾…ã€‚ </p><p>ç¬¬ä¸‰ä¸ªæ˜¯ï¼šnewScheduledThreadPool åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚ </p><p>ç¬¬å››ä¸ªæ˜¯ï¼šnewSingleThreadExecutor åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± ï¼Œå®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»» åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåº(FIFO, LIFO, ä¼˜å…ˆçº§)æ‰§è¡Œã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šçº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°æœ‰å“ªäº›ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>åœ¨çº¿ç¨‹æ± ä¸­ä¸€å…±æœ‰7ä¸ªæ ¸å¿ƒå‚æ•°ï¼š</p><ol><li><p>corePoolSize æ ¸å¿ƒçº¿ç¨‹æ•°ç›® - æ± ä¸­ä¼šä¿ç•™çš„æœ€å¤šçº¿ç¨‹æ•°</p></li><li><p>maximumPoolSize æœ€å¤§çº¿ç¨‹æ•°ç›® - æ ¸å¿ƒçº¿ç¨‹+æ•‘æ€¥çº¿ç¨‹çš„æœ€å¤§æ•°ç›®</p></li><li><p>keepAliveTime ç”Ÿå­˜æ—¶é—´ - æ•‘æ€¥çº¿ç¨‹çš„ç”Ÿå­˜æ—¶é—´ï¼Œç”Ÿå­˜æ—¶é—´å†…æ²¡æœ‰æ–°ä»»åŠ¡ï¼Œæ­¤çº¿ç¨‹èµ„æºä¼šé‡Šæ”¾</p></li><li><p>unit æ—¶é—´å•ä½ - æ•‘æ€¥çº¿ç¨‹çš„ç”Ÿå­˜æ—¶é—´å•ä½ï¼Œå¦‚ç§’ã€æ¯«ç§’ç­‰</p></li><li><p>workQueue - å½“æ²¡æœ‰ç©ºé—²æ ¸å¿ƒçº¿ç¨‹æ—¶ï¼Œæ–°æ¥ä»»åŠ¡ä¼šåŠ å…¥åˆ°æ­¤é˜Ÿåˆ—æ’é˜Ÿï¼Œé˜Ÿåˆ—æ»¡ä¼šåˆ›å»ºæ•‘æ€¥çº¿ç¨‹æ‰§è¡Œä»»åŠ¡</p></li><li><p>threadFactory çº¿ç¨‹å·¥å‚ - å¯ä»¥å®šåˆ¶çº¿ç¨‹å¯¹è±¡çš„åˆ›å»ºï¼Œä¾‹å¦‚è®¾ç½®çº¿ç¨‹åå­—ã€æ˜¯å¦æ˜¯å®ˆæŠ¤çº¿ç¨‹ç­‰</p></li><li><p>handler æ‹’ç»ç­–ç•¥ - å½“æ‰€æœ‰çº¿ç¨‹éƒ½åœ¨ç¹å¿™ï¼ŒworkQueue ä¹Ÿæ”¾æ»¡æ—¶ï¼Œä¼šè§¦å‘æ‹’ç»ç­–ç•¥</p></li></ol><p>  åœ¨æ‹’ç»ç­–ç•¥ä¸­åˆæœ‰4ä¸­æ‹’ç»ç­–ç•¥</p><p>  å½“çº¿ç¨‹æ•°è¿‡å¤šä»¥åï¼Œç¬¬ä¸€ç§æ˜¯æŠ›å¼‚å¸¸ã€ç¬¬äºŒç§æ˜¯ç”±è°ƒç”¨è€…æ‰§è¡Œä»»åŠ¡ã€ç¬¬ä¸‰æ˜¯ä¸¢å¼ƒå½“å‰çš„ä»»åŠ¡ï¼Œç¬¬å››æ˜¯ä¸¢å¼ƒæœ€æ—©æ’é˜Ÿä»»åŠ¡ã€‚é»˜è®¤æ˜¯ç›´æ¥æŠ›å¼‚å¸¸ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šå¦‚ä½•ç¡®å®šæ ¸å¿ƒçº¿ç¨‹æ± å‘¢ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>æ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬å…¬å¸å½“æ—¶æœ‰ä¸€äº›è§„èŒƒï¼Œä¸ºäº†å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ï¼Œè¦æ ¹æ®å½“æ—¶éƒ¨ç½²çš„æœåŠ¡å™¨çš„CPUæ ¸æ•°æ¥å†³å®šï¼Œæˆ‘ä»¬è§„åˆ™æ˜¯ï¼šCPUæ ¸æ•°+1å°±æ˜¯æœ€ç»ˆçš„æ ¸å¿ƒçº¿ç¨‹æ•°ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šçº¿ç¨‹æ± çš„æ‰§è¡ŒåŸç†çŸ¥é“å—ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯~ï¼Œå®ƒæ˜¯è¿™æ ·çš„</p><p>é¦–å…ˆåˆ¤æ–­çº¿ç¨‹æ± é‡Œçš„æ ¸å¿ƒçº¿ç¨‹æ˜¯å¦éƒ½åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœä¸æ˜¯åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœæ ¸å¿ƒçº¿ç¨‹éƒ½åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œåˆ™çº¿ç¨‹æ± åˆ¤æ–­å·¥ä½œé˜Ÿåˆ—æ˜¯å¦å·²æ»¡ï¼Œå¦‚æœå·¥ä½œé˜Ÿåˆ—æ²¡æœ‰æ»¡ï¼Œåˆ™å°†æ–°æäº¤çš„ä»»åŠ¡å­˜å‚¨åœ¨è¿™ä¸ªå·¥ä½œé˜Ÿ åˆ—é‡Œã€‚å¦‚æœå·¥ä½œé˜Ÿåˆ—æ»¡äº†ï¼Œåˆ™åˆ¤æ–­çº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹æ˜¯å¦éƒ½å¤„äºå·¥ä½œçŠ¶æ€ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»» åŠ¡ã€‚å¦‚æœå·²ç»æ»¡äº†ï¼Œåˆ™äº¤ç»™æ‹’ç»ç­–ç•¥æ¥å¤„ç†è¿™ä¸ªä»»åŠ¡ã€‚</p><p><strong>é¢è¯•å®˜</strong>ï¼šä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ± å‘¢ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å¥½çš„ï¼Œå…¶å®è¿™ä¸ªäº‹æƒ…åœ¨é˜¿é‡Œæä¾›çš„æœ€æ–°å¼€å‘æ‰‹å†Œã€ŠJavaå¼€å‘æ‰‹å†Œ-åµ©å±±ç‰ˆã€‹ä¸­ä¹Ÿæåˆ°äº†</p><p>ä¸»è¦åŸå› æ˜¯å¦‚æœä½¿ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ± çš„è¯ï¼Œå®ƒå…è®¸çš„è¯·æ±‚é˜Ÿåˆ—é»˜è®¤é•¿åº¦æ˜¯Integer.MAX_VALUEï¼Œè¿™æ ·çš„è¯ï¼Œæœ‰å¯èƒ½å¯¼è‡´å †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´OOMï¼ˆå†…å­˜æº¢å‡ºï¼‰ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ¨èä½¿ç”¨ThreadPoolExecutoræ¥åˆ›å»ºçº¿ç¨‹æ± ï¼Œè¿™æ ·å¯ä»¥æ˜ç¡®è§„å®šçº¿ç¨‹æ± çš„å‚æ•°ï¼Œé¿å…èµ„æºçš„è€—å°½ã€‚</p></blockquote><h3 id="6-4-çº¿ç¨‹ä½¿ç”¨åœºæ™¯é—®é¢˜"><a href="#6-4-çº¿ç¨‹ä½¿ç”¨åœºæ™¯é—®é¢˜" class="headerlink" title="6.4 çº¿ç¨‹ä½¿ç”¨åœºæ™¯é—®é¢˜"></a>6.4 çº¿ç¨‹ä½¿ç”¨åœºæ™¯é—®é¢˜</h3><blockquote><p><strong>é¢è¯•å®˜</strong>ï¼šå¦‚æœæ§åˆ¶æŸä¸€ä¸ªæ–¹æ³•å…è®¸å¹¶å‘è®¿é—®çº¿ç¨‹çš„æ•°é‡ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯~~ï¼Œæˆ‘æƒ³ä¸€ä¸‹</p><p>åœ¨jdkä¸­æä¾›äº†ä¸€ä¸ªSemaphore[semÉ™fÉ”Ër]ç±»ï¼ˆä¿¡å·é‡ï¼‰</p><p>å®ƒæä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œsemaphore.acquire() è¯·æ±‚ä¿¡å·é‡ï¼Œå¯ä»¥é™åˆ¶çº¿ç¨‹çš„ä¸ªæ•°ï¼Œæ˜¯ä¸€ä¸ªæ­£æ•°ï¼Œå¦‚æœä¿¡å·é‡æ˜¯-1,å°±ä»£è¡¨å·²ç»ç”¨å®Œäº†ä¿¡å·é‡ï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦é˜»å¡äº†</p><p>ç¬¬äºŒä¸ªæ–¹æ³•æ˜¯semaphore.release()ï¼Œä»£è¡¨æ˜¯é‡Šæ”¾ä¸€ä¸ªä¿¡å·é‡ï¼Œæ­¤æ—¶ä¿¡å·é‡çš„ä¸ªæ•°+1</p><p><strong>é¢è¯•å®˜</strong>ï¼šå¥½çš„ï¼Œé‚£è¯¥å¦‚ä½•ä¿è¯Javaç¨‹åºåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹æ‰§è¡Œå®‰å…¨å‘¢ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼Œåˆšæ‰è®²è¿‡äº†å¯¼è‡´çº¿ç¨‹å®‰å…¨çš„åŸå› ï¼Œå¦‚æœè§£å†³çš„è¯ï¼Œjdkä¸­ä¹Ÿæä¾›äº†å¾ˆå¤šçš„ç±»å¸®åŠ©æˆ‘ä»¬è§£å†³å¤šçº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p><ul><li>JDK Atomicå¼€å¤´çš„åŸå­ç±»ã€synchronizedã€LOCKï¼Œå¯ä»¥è§£å†³åŸå­æ€§é—®é¢˜</li><li>synchronizedã€volatileã€LOCKï¼Œå¯ä»¥è§£å†³å¯è§æ€§é—®é¢˜</li><li>Happens-Before è§„åˆ™å¯ä»¥è§£å†³æœ‰åºæ€§é—®é¢˜</li></ul><hr><p><strong>é¢è¯•å®˜</strong>ï¼šä½ åœ¨é¡¹ç›®ä¸­å“ªé‡Œç”¨äº†å¤šçº¿ç¨‹ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯~~ï¼Œæˆ‘æƒ³ä¸€ä¸‹å½“æ—¶çš„åœºæ™¯[æ ¹æ®è‡ªå·±ç®€å†ä¸Šçš„æ¨¡å—è®¾è®¡å¤šçº¿ç¨‹åœºæ™¯]</p><p>å‚è€ƒåœºæ™¯ä¸€ï¼š</p><p>esæ•°æ®æ‰¹é‡å¯¼å…¥</p><p>åœ¨æˆ‘ä»¬é¡¹ç›®ä¸Šçº¿ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ•°æ®é‡çš„æ•°æ®ä¸€æ¬¡æ€§çš„åŒæ­¥åˆ°esç´¢å¼•åº“ä¸­ï¼Œä½†æ˜¯å½“æ—¶çš„æ•°æ®å¥½åƒæ˜¯1000ä¸‡å·¦å³ï¼Œä¸€æ¬¡æ€§è¯»å–æ•°æ®è‚¯å®šä¸è¡Œï¼ˆoomå¼‚å¸¸ï¼‰ï¼Œå¦‚æœåˆ†æ‰¹æ‰§è¡Œçš„è¯ï¼Œè€—æ—¶ä¹Ÿå¤ªä¹…äº†ã€‚æ‰€ä»¥ï¼Œå½“æ—¶æˆ‘å°±æƒ³åˆ°å¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± çš„æ–¹å¼å¯¼å…¥ï¼Œåˆ©ç”¨CountDownLatch+Futureæ¥æ§åˆ¶ï¼Œå°±èƒ½å¤§å¤§æå‡å¯¼å…¥çš„æ—¶é—´ã€‚</p><p>å‚è€ƒåœºæ™¯äºŒï¼š</p><p>åœ¨æˆ‘åšé‚£ä¸ªxxç”µå•†ç½‘ç«™çš„æ—¶å€™ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªæ•°æ®æ±‡æ€»çš„åŠŸèƒ½ï¼Œåœ¨ç”¨æˆ·ä¸‹å•ä¹‹åéœ€è¦æŸ¥è¯¢è®¢å•ä¿¡æ¯ï¼Œä¹Ÿéœ€è¦è·å¾—è®¢å•ä¸­çš„å•†å“è¯¦ç»†ä¿¡æ¯ï¼ˆå¯èƒ½æ˜¯å¤šä¸ªï¼‰ï¼Œè¿˜éœ€è¦æŸ¥çœ‹ç‰©æµå‘è´§ä¿¡æ¯ã€‚å› ä¸ºå®ƒä»¬ä¸‰ä¸ªå¯¹åº”çš„åˆ†åˆ«ä¸‰ä¸ªå¾®æœåŠ¡ï¼Œå¦‚æœä¸€ä¸ªä¸€ä¸ªçš„æ“ä½œçš„è¯ï¼Œäº’ç›¸ç­‰å¾…çš„æ—¶é—´æ¯”è¾ƒé•¿ã€‚æ‰€ä»¥ï¼Œæˆ‘å½“æ—¶å°±æƒ³åˆ°å¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± ï¼Œè®©å¤šä¸ªçº¿ç¨‹åŒæ—¶å¤„ç†ï¼Œæœ€ç»ˆå†æ±‡æ€»ç»“æœå°±å¯ä»¥äº†ï¼Œå½“ç„¶é‡Œé¢éœ€è¦ç”¨åˆ°Futureæ¥è·å–æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œä¹‹åçš„ç»“æœæ‰è¡Œ</p><p>å‚è€ƒåœºæ™¯ä¸‰ï¼š</p><p>ã€Šé»‘é©¬å¤´æ¡ã€‹é¡¹ç›®ä¸­ä½¿ç”¨çš„</p><p>æˆ‘å½“æ—¶åšäº†ä¸€ä¸ªæ–‡ç« æœç´¢çš„åŠŸèƒ½ï¼Œç”¨æˆ·è¾“å…¥å…³é”®å­—è¦æœç´¢æ–‡ç« ï¼ŒåŒæ—¶éœ€è¦ä¿å­˜ç”¨æˆ·çš„æœç´¢è®°å½•ï¼ˆæœç´¢å†å²ï¼‰ï¼Œè¿™å—æˆ‘è®¾è®¡çš„æ—¶å€™ï¼Œä¸ºäº†ä¸å½±å“ç”¨æˆ·çš„æ­£å¸¸æœç´¢ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„å¼‚æ­¥çš„æ–¹å¼è¿›è¡Œä¿å­˜çš„ï¼Œä¸ºäº†æå‡æ€§èƒ½ï¼Œæˆ‘ä»¬åŠ å…¥äº†çº¿ç¨‹æ± ï¼Œä¹Ÿå°±è¯´åœ¨è°ƒç”¨å¼‚æ­¥æ–¹æ³•çš„æ—¶å€™ï¼Œç›´æ¥ä»çº¿ç¨‹æ± ä¸­è·å–çº¿ç¨‹ä½¿ç”¨</p></blockquote><h3 id="6-5-å…¶ä»–"><a href="#6-5-å…¶ä»–" class="headerlink" title="6.5 å…¶ä»–"></a>6.5 å…¶ä»–</h3><blockquote><p><strong>é¢è¯•å®˜</strong>ï¼šè°ˆè°ˆä½ å¯¹ThreadLocalçš„ç†è§£</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼Œæ˜¯è¿™æ ·çš„~~</p><p>ThreadLocal ä¸»è¦åŠŸèƒ½æœ‰ä¸¤ä¸ªï¼Œç¬¬ä¸€ä¸ªæ˜¯å¯ä»¥<strong>å®ç°èµ„æºå¯¹è±¡çš„çº¿ç¨‹éš”ç¦»</strong>ï¼Œè®©æ¯ä¸ªçº¿ç¨‹å„ç”¨å„çš„èµ„æºå¯¹è±¡ï¼Œé¿å…äº‰ç”¨å¼•å‘çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œç¬¬äºŒä¸ªæ˜¯å®ç°äº†<strong>çº¿ç¨‹å†…çš„èµ„æºå…±äº«</strong></p><p><strong>é¢è¯•å®˜</strong>ï¼šå¥½çš„ï¼Œé‚£ä½ çŸ¥é“ThreadLocalçš„åº•å±‚åŸç†å®ç°å—ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼ŒçŸ¥é“ä¸€äº›~</p><p>åœ¨ThreadLocalå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªä¸€ä¸ª ThreadLocalMap ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œç”¨æ¥å­˜å‚¨èµ„æºå¯¹è±¡</p><p>å½“æˆ‘ä»¬è°ƒç”¨ set æ–¹æ³•ï¼Œå°±æ˜¯ä»¥ ThreadLocal è‡ªå·±ä½œä¸º keyï¼Œèµ„æºå¯¹è±¡ä½œä¸º valueï¼Œæ”¾å…¥å½“å‰çº¿ç¨‹çš„ ThreadLocalMap é›†åˆä¸­</p><p>å½“è°ƒç”¨ get æ–¹æ³•ï¼Œå°±æ˜¯ä»¥ ThreadLocal è‡ªå·±ä½œä¸º keyï¼Œåˆ°å½“å‰çº¿ç¨‹ä¸­æŸ¥æ‰¾å…³è”çš„èµ„æºå€¼</p><p>å½“è°ƒç”¨ remove æ–¹æ³•ï¼Œå°±æ˜¯ä»¥ ThreadLocal è‡ªå·±ä½œä¸º keyï¼Œç§»é™¤å½“å‰çº¿ç¨‹å…³è”çš„èµ„æºå€¼</p><p><strong>é¢è¯•å®˜</strong>ï¼šå¥½çš„ï¼Œé‚£å…³äºThreadLocalä¼šå¯¼è‡´å†…å­˜æº¢å‡ºè¿™ä¸ªäº‹æƒ…ï¼Œäº†è§£å—ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å—¯ï¼Œæˆ‘ä¹‹å‰çœ‹è¿‡æºç ï¼Œæˆ‘æƒ³ä¸€ä¸‹~~</p><p>æ˜¯åº”ä¸ºThreadLocalMap ä¸­çš„ key è¢«è®¾è®¡ä¸ºå¼±å¼•ç”¨ï¼Œå®ƒæ˜¯è¢«åŠ¨çš„è¢«GCè°ƒç”¨é‡Šæ”¾keyï¼Œä¸è¿‡å…³é”®çš„æ˜¯åªæœ‰keyå¯ä»¥å¾—åˆ°å†…å­˜é‡Šæ”¾ï¼Œè€Œvalueä¸ä¼šï¼Œå› ä¸ºvalueæ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚</p><p>åœ¨ä½¿ç”¨ThreadLocal æ—¶éƒ½æŠŠå®ƒä½œä¸ºé™æ€å˜é‡ï¼ˆå³å¼ºå¼•ç”¨ï¼‰ï¼Œå› æ­¤æ— æ³•è¢«åŠ¨ä¾é  GC å›æ”¶ï¼Œå»ºè®®ä¸»åŠ¨çš„remove é‡Šæ”¾ keyï¼Œè¿™æ ·å°±èƒ½é¿å…å†…å­˜æº¢å‡ºã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¹¶å‘ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ElasticSearch</title>
      <link href="/2023/12/30/Study-ElasticSearch/"/>
      <url>/2023/12/30/Study-ElasticSearch/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æœ¬æ–‡å­¦ä¹ è‡ª<a href="https://www.bilibili.com/video/BV1LQ4y127n4">https://www.bilibili.com/video/BV1LQ4y127n4</a></p><p>å‚è€ƒè‡ªï¼š<a href="https://cyborg2077.github.io/2022/12/24/ElasticSearch/">https://cyborg2077.github.io/2022/12/24/ElasticSearch/</a></p><p>å½“ä½¿ç”¨Elasticsearchè¿›è¡Œå¸ƒå°”æŸ¥è¯¢ã€èšåˆæœç´¢ã€è¿‡æ»¤å™¨å’Œé«˜äº®æ˜¾ç¤ºæ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨Elasticsearchæä¾›çš„æŸ¥è¯¢DSLï¼ˆDomain Specific Languageï¼‰æ¥å®ç°è¿™äº›åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯æ¯ä¸ªåŠŸèƒ½çš„è¯¦ç»†è¯´æ˜ï¼š</p><h3 id="1-å¸ƒå°”æŸ¥è¯¢"><a href="#1-å¸ƒå°”æŸ¥è¯¢" class="headerlink" title="1. å¸ƒå°”æŸ¥è¯¢"></a>1. å¸ƒå°”æŸ¥è¯¢</h3><p>å¸ƒå°”æŸ¥è¯¢å…è®¸ä½ ç»„åˆå¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼ŒåŒ…æ‹¬<code>must</code>ã€<code>should</code>å’Œ<code>must_not</code>ã€‚è¿™äº›æŸ¥è¯¢æ¡ä»¶å¯ä»¥æ˜¯å•ä¸ªæŸ¥è¯¢ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ç»„åˆæŸ¥è¯¢ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„å¸ƒå°”æŸ¥è¯¢ç¤ºä¾‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Elasticsearch&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;should&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span> <span class="string">&quot;programming&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;must_not&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;archived&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæŸ¥è¯¢å°†åŒ¹é…æ ‡é¢˜ä¸­åŒ…å«â€Elasticsearchâ€ï¼Œå¹¶ä¸”ç±»åˆ«ä¸ºâ€programmingâ€çš„æ–‡æ¡£ï¼Œä½†ä¸åŒ…æ‹¬çŠ¶æ€ä¸ºâ€archivedâ€çš„æ–‡æ¡£ã€‚</p><h3 id="2-èšåˆæœç´¢"><a href="#2-èšåˆæœç´¢" class="headerlink" title="2. èšåˆæœç´¢"></a>2. èšåˆæœç´¢</h3><p>èšåˆæœç´¢å…è®¸ä½ å¯¹æœç´¢ç»“æœè¿›è¡Œæ±‡æ€»ç»Ÿè®¡ã€‚å¸¸è§çš„èšåˆç±»å‹åŒ…æ‹¬<code>terms</code>ã€<code>date_histogram</code>ã€<code>range</code>ç­‰ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªæŒ‰ç±»åˆ«èšåˆçš„ç¤ºä¾‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;category_counts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;category.keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªèšåˆå°†è¿”å›æ¯ä¸ªç±»åˆ«çš„æ–‡æ¡£è®¡æ•°ã€‚</p><h3 id="3-è¿‡æ»¤å™¨"><a href="#3-è¿‡æ»¤å™¨" class="headerlink" title="3. è¿‡æ»¤å™¨"></a>3. è¿‡æ»¤å™¨</h3><p>è¿‡æ»¤å™¨å…è®¸ä½ åœ¨ä¸å½±å“æœç´¢è¯„åˆ†çš„æƒ…å†µä¸‹è¿‡æ»¤æ–‡æ¡£ã€‚å¸¸è§çš„è¿‡æ»¤å™¨åŒ…æ‹¬<code>term</code>ã€<code>range</code>ã€<code>exists</code>ç­‰ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªèŒƒå›´è¿‡æ»¤å™¨çš„ç¤ºä¾‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span> <span class="number">50</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¿‡æ»¤å™¨å°†è¿”å›ä»·æ ¼åœ¨20åˆ°50ä¹‹é—´çš„æ–‡æ¡£ã€‚</p><h3 id="4-é«˜äº®æ˜¾ç¤º"><a href="#4-é«˜äº®æ˜¾ç¤º" class="headerlink" title="4. é«˜äº®æ˜¾ç¤º"></a>4. é«˜äº®æ˜¾ç¤º</h3><p>é«˜äº®æ˜¾ç¤ºå¯ä»¥çªå‡ºæ˜¾ç¤ºæœç´¢ç»“æœä¸­åŒ¹é…æŸ¥è¯¢çš„éƒ¨åˆ†ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªé«˜äº®æ˜¾ç¤ºçš„ç¤ºä¾‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Elasticsearch&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;highlight&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæŸ¥è¯¢å°†åœ¨æœç´¢ç»“æœä¸­çªå‡ºæ˜¾ç¤ºåŒ¹é…â€Elasticsearchâ€çš„å†…å®¹éƒ¨åˆ†ã€‚</p><p>ä»¥ä¸Šæ˜¯å¯¹å¸ƒå°”æŸ¥è¯¢ã€èšåˆæœç´¢ã€è¿‡æ»¤å™¨å’Œé«˜äº®æ˜¾ç¤ºçš„ç®€è¦è¯´æ˜ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œç»„åˆå’Œè°ƒæ•´ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ™ºå­¦è½©åœ¨çº¿æ•™è‚²å¹³å°</title>
      <link href="/2023/12/29/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E5%9C%A8%E7%BA%BF%E6%95%99%E8%82%B2%E5%B9%B3%E5%8F%B0/"/>
      <url>/2023/12/29/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E5%9C%A8%E7%BA%BF%E6%95%99%E8%82%B2%E5%B9%B3%E5%8F%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="é¡¹ç›®åœ°å€"><a href="#é¡¹ç›®åœ°å€" class="headerlink" title="é¡¹ç›®åœ°å€"></a>é¡¹ç›®åœ°å€</h1><p><a href="https://github.com/PlanBBBBB/zhixuexuan">https://github.com/PlanBBBBB/zhixuexuan</a></p><h1 id="é¡¹ç›®ç»å†"><a href="#é¡¹ç›®ç»å†" class="headerlink" title="é¡¹ç›®ç»å†"></a>é¡¹ç›®ç»å†</h1><p><strong>2023.09 - 2023.11</strong></p><p><strong>æ™ºå­¦è½©åœ¨çº¿æ•™å­¦å¹³å°</strong>       </p><p><strong>ä¸»è¦æˆå‘˜</strong></p><p><strong>é¡¹ç›®æè¿°ï¼š</strong> æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªé¢å‘å¤§ä¼—ç”¨æˆ·èŒä¸šæŠ€èƒ½å­¦ä¹ çš„åœ¨çº¿æ•™è‚²å¹³å°ï¼Œæä¾›äº†èŒä¸šæŠ€èƒ½åŸ¹è®­ç›¸å…³è¯¾ç¨‹ã€‚é¡¹ç›®åŸºäºB2B2Cçš„ä¸šåŠ¡æ¨¡å¼ï¼ŒåŒ…æ‹¬é—¨æˆ·ã€ä¸ªäººå­¦ä¹ ä¸­å¿ƒã€æ•™å­¦æœºæ„ç®¡ç†å¹³å°ã€è¿è¥å¹³å°ã€ç¤¾äº¤ç³»ç»Ÿå’Œç³»ç»Ÿç®¡ç†6å¤§æ¨¡å—ã€‚</p><p><strong>æŠ€æœ¯æ¦‚è¿°ï¼š</strong> æœ¬é¡¹ç›®é‡‡ç”¨SpringCloudå¾®æœåŠ¡æ¶æ„ï¼Œä½¿ç”¨Nacoså®ç°æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ï¼Œç»Ÿä¸€é…ç½®æ–‡ä»¶ç®¡ç†ï¼ŒGatewayç½‘å…³å®ç°åŠ¨æ€è·¯ç”±ä»¥åŠè´Ÿè½½å‡è¡¡ï¼Œä½¿ç”¨Redisæé«˜æ•°æ®è¯»å–å’Œæ£€ç´¢æ•ˆç‡ï¼Œä½¿ç”¨MinIOè¿›è¡Œåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ï¼ŒåŒæ—¶ä½¿ç”¨XXL-Jobå®Œæˆåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ã€‚</p><p><strong>æŠ€æœ¯æ ˆï¼š</strong> SpringCloud + SpringSecurity + Nacos + Redis + MySQL + Mybatis + RabbitMQ + Elasticsearch + MinlO + XXL-Job+ Nginx+Vue</p><p><strong>é¡¹ç›®èŒè´£ï¼š</strong></p><ol><li>è´Ÿè´£è¯¾ç¨‹å†…å®¹ç®¡ç†æ¨¡å—çš„è®¾è®¡ä¸å¼€å‘ï¼Œä½¿Redisç¼“å­˜è¯¾ç¨‹ä¿¡æ¯å‡è½»æ•°æ®åº“å‹åŠ›ï¼ŒåŒæ—¶è§£å†³ç¼“å­˜ç©¿é€ï¼Œç¼“å­˜å‡»ç©¿ã€æ•°æ®ä¸€è‡´æ€§ç­‰é—®é¢˜ã€‚</li><li>ä½¿ç”¨Elasticsearchä¸ºè¯¾ç¨‹å»ºç«‹ç´¢å¼•ï¼Œæé«˜è¯¾ç¨‹æ£€ç´¢æ•ˆç‡ï¼ŒåŸºäºæœ¬åœ°æ¶ˆæ¯è¡¨åŠ XXL-Jobä»»åŠ¡è°ƒåº¦å®ç°<strong>åˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶</strong>ã€‚</li><li>ä½¿ç”¨<strong>çº¿ç¨‹æ± </strong>å®ç°ä»»åŠ¡çš„å¹¶è¡Œå¤„ç†ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡ï¼ŒåŒæ—¶åŸºäºæ¶ˆæ¯è¡¨çš„çŠ¶æ€å­—æ®µæ¥é¿å…ä»»åŠ¡é‡å¤æ‰§è¡Œï¼Œä¿è¯ä»»åŠ¡çš„å¹‚ç­‰æ€§ã€‚</li><li>è´Ÿè´£åª’ä½“èµ„æºç®¡ç†æ¨¡å—çš„å¼€å‘ï¼Œå°†è§†é¢‘ï¼Œå›¾ç‰‡ï¼Œæ–‡æ¡£ç­‰åª’ä½“èµ„æºä¸Šä¼ åˆ°MinIOåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå®ç°å¤§æ–‡ä»¶<strong>æ–­ç‚¹ç»­ä¼ </strong>ã€‚</li><li>å‚ä¸è®¢å•ç®¡ç†æ¨¡å—çš„å¼€å‘ï¼Œå®ç°è¯¾ç¨‹è´­ä¹°ï¼Œä»£é‡‘åˆ¸æŠ¢è´­ç­‰ä¸šåŠ¡åŠŸèƒ½ï¼Œä½¿ç”¨RabbitMQè¿›è¡Œç»“æœé€šçŸ¥ï¼ŒåŸºäºå»¶è¿Ÿé˜Ÿåˆ—å¤„ç†æœªæ”¯ä»˜è®¢å•ã€‚</li><li>ä½¿ç”¨RabbitMQè¿›è¡Œæµé‡å‰Šå³°ï¼Œä¼˜åŒ–ä»£é‡‘åˆ¸æŠ¢è´­ï¼ŒåŒæ—¶è§£å†³äº†ä»£é‡‘åˆ¸è¶…å–å’Œé‡å¤ä¸‹å•é—®é¢˜ï¼ŒåŸºäºRedis+Luaè„šæœ¬å®ç°ã€‚</li><li>å¯¹å„æ¨¡å—è¿›è¡Œç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼Œè‡ªå®šä¹‰é¡¹ç›®å¼‚å¸¸ï¼Œå¯¹ä¸åŒå¼‚å¸¸ç¼–å†™ä¸åŒçš„å¤„ç†é€»è¾‘ï¼ŒåŸºäºJSR303æ¡†æ¶å®ç°è¯·æ±‚å‚æ•°çš„åˆæ³•æ€§æ ¡éªŒã€‚</li><li>è´Ÿè´£æ­å»ºRedisä¸»ä»é›†ç¾¤ï¼ŒåŠ å…¥Sentinelæœºåˆ¶ï¼Œå®è§‚è¯»å†™åˆ†ç¦»ï¼Œæé«˜ç³»ç»Ÿçš„é«˜å¯ç”¨ã€é«˜å¹¶å‘èƒ½åŠ›ã€‚</li></ol><h1 id="é¢è¯•é¢˜"><a href="#é¢è¯•é¢˜" class="headerlink" title="é¢è¯•é¢˜"></a>é¢è¯•é¢˜</h1><p><strong>ä½¿ç”¨è®¾è®¡æ¨¡å¼ä¼˜åŒ–ä»£ç ï¼š</strong></p><p>ç™»å½•ã€æ”¯ä»˜ï¼šï¼ˆå·¥å‚+ç­–ç•¥ï¼‰<br>æä¾›äº†å¾ˆå¤šç§ç­–ç•¥ï¼Œéƒ½è®©springå®¹å™¨ç®¡ç†<br>æä¾›ä¸€ä¸ªå·¥å‚ï¼šå‡†å¤‡ç­–ç•¥å¯¹è±¡ï¼Œæ ¹æ®å‚æ•°æä¾›å¯¹è±¡</p><hr><p>ä¸‹è®¢å•ï¼šï¼ˆè´£ä»»é“¾ï¼‰</p><p>å‚æ•°æ ¡éªŒ -&gt; è¡¥å……è®¢å•ä¿¡æ¯ -&gt; è®¡ç®—ç›¸å…³ä¿¡æ¯ -&gt; è®¢å•å…¥åº“</p><h2 id="ç¬¬7ç‚¹"><a href="#ç¬¬7ç‚¹" class="headerlink" title="ç¬¬7ç‚¹"></a>ç¬¬7ç‚¹</h2><ol><li><p>ç³»ç»Ÿå¦‚ä½•å¤„ç†å¼‚å¸¸ï¼Ÿ</p><ul><li>æˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†å™¨å»æ•è·å¹¶å¤„ç†å¼‚å¸¸</li><li>ä½¿ç”¨æ§åˆ¶å™¨å¢å¼ºæ³¨è§£**@ControllerAdvice<strong>ï¼ˆä¹Ÿå¯ä»¥ç”¨@RestControllerAdviceï¼‰å’Œå¼‚å¸¸å¤„ç†æ³¨è§£</strong>@ExceptionHandler**æ¥å®ç°</li></ul></li><li><p>å¦‚ä½•å¤„ç†è‡ªå®šä¹‰å¼‚å¸¸ï¼Ÿ</p><ul><li>ç¨‹åºåœ¨ç¼–å†™ä»£ç æ—¶ï¼Œæ ¹æ®æ ¡éªŒç»“æœä¸»åŠ¨æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ç±»å¯¹è±¡ï¼Œ<strong>æŠ›å‡ºå¼‚å¸¸æ—¶æŒ‡å®šè¯¦ç»†çš„å¼‚å¸¸ä¿¡æ¯</strong>ï¼Œå¼‚å¸¸å¤„ç†å™¨æ•è·å¼‚å¸¸ä¿¡æ¯è®°å½•ã€å¼‚å¸¸æ—¥å¿—ï¼Œ<strong>å¹¶å“åº”ç»™ç”¨æˆ·</strong></li></ul></li><li><p>å¦‚ä½•å¤„ç†æœªçŸ¥å¼‚å¸¸ï¼Ÿ</p><ul><li>æ¥å£æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸€äº›è¿è¡Œæ—¶å¼‚å¸¸ä¹Ÿä¼š<strong>è¢«å¼‚å¸¸å¤„ç†å™¨ç»Ÿä¸€æ•è·</strong>ï¼Œè®°å½•å¼‚å¸¸æ—¥å¿—ï¼Œç»Ÿä¸€å“åº”ç»™ç”¨æˆ·500é”™è¯¯</li><li>åœ¨å¼‚å¸¸å¤„ç†å…¶ä¸­è¿˜å¯ä»¥å¯¹æŸä¸ªå¼‚å¸¸ç±»å‹è¿›è¡Œå•ç‹¬å¤„ç†ï¼ˆä½¿ç”¨@ExceptionHandleræ¥å£°æ˜è¦æ•è·çš„å¼‚å¸¸ç±»å‹ï¼‰</li></ul></li><li><p>è¯·æ±‚å‚æ•°çš„åˆæ³•æ€§å¦‚ä½•æ ¡éªŒï¼Ÿ</p><ul><li>ä½¿ç”¨åŸºäº<code>JSR-303</code>çš„æ ¡éªŒæ¡†æ¶å®ç°ï¼Œ<code>SpringBoot</code>æä¾›äº†<code>JSR-303</code>çš„æ”¯æŒï¼Œå®ƒå°±æ˜¯<code>spring-boot-starter-validation</code>ï¼Œå®ƒåŒ…æ‹¬äº†å¾ˆå¤šæ ¡éªŒè§„åˆ™ï¼Œåªéœ€è¦åœ¨æ¨¡å‹ç±»ä¸­é€šè¿‡æ³¨è§£æŒ‡å®šæ ¡éªŒè§„åˆ™ï¼Œåœ¨<code>Controller</code>æ–¹æ³•ä¸Šå¼€å¯æ ¡éªŒã€‚</li></ul></li></ol><h2 id="ç¬¬4ç‚¹"><a href="#ç¬¬4ç‚¹" class="headerlink" title="ç¬¬4ç‚¹"></a>ç¬¬4ç‚¹</h2><h3 id="æ–­ç‚¹ç»­ä¼ æ˜¯æ€ä¹ˆåšçš„"><a href="#æ–­ç‚¹ç»­ä¼ æ˜¯æ€ä¹ˆåšçš„" class="headerlink" title="æ–­ç‚¹ç»­ä¼ æ˜¯æ€ä¹ˆåšçš„?"></a>æ–­ç‚¹ç»­ä¼ æ˜¯æ€ä¹ˆåšçš„?</h3><p>æˆ‘ä»¬æ˜¯åŸºäºåˆ†å—ä¸Šä¼ çš„æ¨¡å¼å®ç°æ–­ç‚¹ç»­ä¼ çš„éœ€æ±‚ï¼Œå½“æ–‡ä»¶ä¸Šä¼ ä¸€éƒ¨åˆ†æ–­ç½‘åå‰è¾¹å·²ç»ä¸Šä¼ è¿‡çš„ä¸å†ä¸Šä¼ ã€‚</p><ul><li>å‰ç«¯å¯¹æ–‡ä»¶åˆ†å—</li><li>å‰ç«¯ä½¿ç”¨å¤šçº¿ç¨‹ä¸€å—ä¸€å—ä¸Šä¼ ï¼Œä¸Šä¼ å‰ç»™æœåŠ¡ç«¯å‘ä¸€ä¸ªæ¶ˆæ¯æ ¡éªŒè¯¥åˆ†å—æ˜¯å¦ä¸Šä¼ ï¼Œå¦‚æœå·²ä¸Šä¼ åˆ™ä¸å†ä¸Šä¼ ã€‚</li><li>ç­‰æ‰€æœ‰åˆ†å—ä¸Šä¼ å®Œæ¯•ï¼ŒæœåŠ¡ç«¯åˆå¹¶æ‰€æœ‰åˆ†å—ï¼Œæ ¡éªŒæ–‡ä»¶çš„å®Œæ•´æ€§ï¼ˆ<strong>ç”¨md5å€¼å»æ ¡éªŒ</strong>ï¼‰ã€‚å› ä¸ºåˆ†å—å…¨éƒ¨ä¸Šä¼ åˆ°äº†æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å°†æ‰€æœ‰åˆ†å—æŒ‰é¡ºåºè¿›è¡Œåˆå¹¶ï¼Œå°±æ˜¯å†™æ¯ä¸ªåˆ†å—æ–‡ä»¶å†…å®¹æŒ‰é¡ºåºä¾æ¬¡å†™å…¥ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚ä½¿ç”¨å­—èŠ‚æµå»è¯»å†™æ–‡ä»¶ã€‚</li><li>å‰ç«¯ç»™æœåŠ¡ä¼ äº†ä¸€ä¸ªmd5å€¼ï¼ŒæœåŠ¡ç«¯åˆå¹¶æ–‡ä»¶åè®¡ç®—åˆå¹¶åæ–‡ä»¶çš„md5æ˜¯å¦å’Œå‰ç«¯ä¼ çš„ä¸€æ ·ï¼Œå¦‚æœä¸€æ ·åˆ™è¯´æ–‡ä»¶å®Œæ•´ï¼Œå¦‚æœä¸ä¸€æ ·è¯´æ˜å¯èƒ½ç”±äºç½‘ç»œä¸¢åŒ…å¯¼è‡´æ–‡ä»¶ä¸å®Œæ•´ï¼Œè¿™æ—¶ä¸Šä¼ å¤±è´¥éœ€è¦é‡æ–°ä¸Šä¼ </li></ul><h3 id="åˆ†å—æ–‡ä»¶æ¸…ç†é—®é¢˜"><a href="#åˆ†å—æ–‡ä»¶æ¸…ç†é—®é¢˜" class="headerlink" title="åˆ†å—æ–‡ä»¶æ¸…ç†é—®é¢˜?"></a>åˆ†å—æ–‡ä»¶æ¸…ç†é—®é¢˜?</h3><p>ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œåˆ†å—ä¸Šä¼ ï¼Œä¸Šä¼ ä¸€åŠä¸ä¼ äº†ï¼Œä¹‹å‰ä¸Šä¼ åˆ°minioçš„åˆ†å—æ–‡ä»¶è¦æ¸…ç†å—? æ€ä¹ˆåšçš„?</p><ul><li><p>åœ¨æ•°æ®åº“ä¸­æœ‰ä¸€å¼ æ–‡ä»¶è¡¨è®°å½•minioä¸­å­˜å‚¨çš„æ–‡ä»¶ä¿¡æ¯ã€‚</p></li><li><p>æ–‡ä»¶å¼€å§‹ä¸Šä¼ æ—¶ä¼šå†™å…¥æ–‡ä»¶è¡¨ï¼ŒçŠ¶æ€ä¸ºä¸Šä¼ ä¸­ï¼Œä¸Šä¼ å®Œæˆä¼šæ›´æ–°çŠ¶æ€ä¸ºä¸Šä¼ å®Œæˆ</p></li><li><p>å½“ä¸€ä¸ªæ–‡ä»¶ä¼ äº†ä¸€åŠä¸å†ä¸Šä¼ äº†è¯´æ˜è¯¥æ–‡ä»¶æ²¡æœ‰ä¸Šä¼ å®Œæˆï¼Œä¼šæœ‰<strong>å®šæ—¶ä»»åŠ¡</strong>å»æŸ¥è¯¢æ–‡ä»¶è¡¨ä¸­çš„è®°å½•ï¼Œå¦‚æœæ–‡ä»¶æœªä¸Šä¼ å®Œæˆåˆ™åˆ é™¤minioä¸­æ²¡æœ‰ä¸Šä¼ æˆåŠŸçš„æ–‡ä»¶ç›®å½•ã€‚</p></li></ul><h2 id="ç¬¬2ç‚¹å’Œç¬¬3ç‚¹"><a href="#ç¬¬2ç‚¹å’Œç¬¬3ç‚¹" class="headerlink" title="ç¬¬2ç‚¹å’Œç¬¬3ç‚¹"></a>ç¬¬2ç‚¹å’Œç¬¬3ç‚¹</h2><h3 id="xxl-jobçš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆï¼Ÿxxl-jobæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#xxl-jobçš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆï¼Ÿxxl-jobæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="xxl-jobçš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆï¼Ÿxxl-jobæ˜¯ä»€ä¹ˆï¼Ÿ"></a>xxl-jobçš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆï¼Ÿxxl-jobæ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li><p>xxl-jobåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æœåŠ¡ç”±è°ƒåº¦ä¸­å¿ƒå’Œæ‰§è¡Œå™¨ç»„æˆï¼Œè°ƒåº¦ä¸­å¿ƒè´Ÿè´£æŒ‰ä»»åŠ¡è°ƒåº¦ç­–ç•¥å‘æ‰§è¡Œå™¨ä¸‹å‘ä»»åŠ¡ï¼Œæ‰§è¡Œå™¨è´Ÿè´£æ¥æ”¶ä»»åŠ¡ï¼Œæ‰§è¡Œä»»åŠ¡</p><ol><li><p>é¦–å…ˆéƒ¨ç½²å¹¶å¯åŠ¨xxl-jobè°ƒåº¦ä¸­å¿ƒï¼ˆä¸€ä¸ªjavaå·¥ç¨‹ï¼Œæ‰“æˆjaråŒ…å¯ä»¥æ”¾åˆ°è™šæ‹Ÿæœºä¸Šè¿è¡Œï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> java -jar xxl-job-admin...  &amp; </span><br></pre></td></tr></table></figure></li><li><p>åœ¨å¾®æœåŠ¡ä¸­æ·»åŠ xxl-jobä¾èµ–ï¼Œåœ¨å¾®æœåŠ¡ä¸­é…ç½®æ‰§è¡Œå™¨</p><ul><li>ä¾èµ–</li><li>ymlé…ç½®</li><li>é…ç½®ç±»</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xuxueli<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xxl-job-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨å¾®æœåŠ¡ï¼Œæ‰§è¡Œå™¨å‘è°ƒåº¦ä¸­å¿ƒä¸ŠæŠ¥è‡ªå·±</p></li><li><p>åœ¨å¾®æœåŠ¡ä¸­å†™ä¸€ä¸ªä»»åŠ¡æ–¹æ³•ï¼Œå¹¶ç”¨xxl-jobçš„æ³¨è§£å»æ ‡è®°æ‰§è¡Œä»»åŠ¡çš„æ–¹æ³•åç§°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@XxlJob(&quot;testJob&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJob</span><span class="params">()</span> &#123;</span><br><span class="line">    log.debug(<span class="string">&quot;å¼€å§‹æ‰§è¡Œ.......&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>åœ¨è°ƒåº¦ä¸­å¿ƒé…ç½®ä»»åŠ¡è°ƒåº¦ç­–ç•¥ï¼Œè°ƒåº¦ç­–ç•¥å°±æ˜¯æ¯ä¸ªå¤šé•¿æ—¶é—´æ‰§è¡Œï¼Œåˆæˆ–è€…æ˜¯æ¯å¤©&#x2F;æ¯æœˆçš„å›ºå®šæ—¶é—´å»æ‰§è¡Œç­‰</p></li><li><p>åœ¨è°ƒåº¦ä¸­å¿ƒå¯åŠ¨ä»»åŠ¡</p></li><li><p>è°ƒåº¦ä¸­å¿ƒæ ¹æ®ä»»åŠ¡è°ƒåº¦ç­–ç•¥ï¼Œåˆ°è¾¾æ—¶é—´å°±å¼€å§‹ä¸‹å‘ä»»åŠ¡ç»™æ‰§è¡Œå™¨</p></li><li><p>æ‰§è¡Œå™¨æ”¶åˆ°ä»»åŠ¡å°±å¼€å§‹æ‰§è¡Œä»»åŠ¡</p></li></ol></li></ul><h3 id="å¦‚ä½•ä¿è¯ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œï¼Ÿ"><a href="#å¦‚ä½•ä¿è¯ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¿è¯ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œï¼Ÿ"></a>å¦‚ä½•ä¿è¯ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œï¼Ÿ</h3><ol><li>è°ƒåº¦ä¸­å¿ƒæŒ‰<strong>åˆ†ç‰‡å¹¿æ’­</strong>çš„æ–¹å¼å»ä¸‹å‘ä»»åŠ¡</li><li>æ‰§è¡Œå™¨æ”¶åˆ°ä½œä¸šåˆ†ç‰‡å¹¿æ’­çš„å‚æ•°ï¼šåˆ†ç‰‡æ€»æ•°(shardTotal)å’Œåˆ†ç‰‡åºå·(shardIndex)ï¼Œè®¡ç®—<code>ä»»åŠ¡id % åˆ†ç‰‡æ€»æ•°</code>(taskId % shardTotal)ï¼Œå¦‚æœç»“æœç­‰äºåˆ†ç‰‡åºå·ï¼Œå°±å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡(taskId % shardTotal &#x3D; shardIndex)ã€‚è¿™æ ·å°±å¯ä»¥ä¿è¯ä¸åŒçš„æ‰§è¡Œå™¨æ‰§è¡Œä¸åŒçš„ä»»åŠ¡</li><li>é…ç½®è°ƒåº¦è¿‡æœŸç­–ç•¥ä¸º<strong>å¿½ç•¥</strong>ï¼Œé¿å…åŒä¸€ä¸ªæ‰§è¡Œå™¨å¤šæ¬¡é‡å¤æ‰§è¡ŒåŒä¸€ä¸ªä»»åŠ¡</li><li>é…ç½®ä»»åŠ¡é˜»å¡å¤„ç†ç­–ç•¥ä¸º<strong>ä¸¢å¼ƒåç»­è°ƒåº¦</strong>ï¼Œæ³¨æ„ï¼šä¸¢å¼ƒä¹Ÿæ²¡äº‹ï¼Œä¸‹ä¸€æ¬¡è°ƒåº¦è¿˜å¯ä»¥æ‰§è¡Œ</li><li>å¦å¤–è¿˜è¦ä¿è¯ä»»åŠ¡å¤„ç†çš„å¹‚ç­‰æ€§ï¼Œæ‰§è¡Œè¿‡çš„ä»»åŠ¡å¯ä»¥æ‰“ä¸€ä¸ªçŠ¶æ€æ ‡è®°å·²å®Œæˆï¼ˆä¸Šé¢çš„ä»£ç è®¾ç½®status&#x3D;2å³ä¸ºå®Œæˆï¼‰ï¼Œä¸‹æ¬¡å†æ¬¡è°ƒåº¦è¯¥ä»»åŠ¡æ—¶ï¼Œåˆ¤æ–­è¯¥ä»»åŠ¡å·²å®Œæˆï¼Œå°±ä¸å†æ‰§è¡Œ</li></ol><h3 id="ä»»åŠ¡å¹‚ç­‰æ€§å¦‚ä½•ä¿è¯ï¼Ÿ"><a href="#ä»»åŠ¡å¹‚ç­‰æ€§å¦‚ä½•ä¿è¯ï¼Ÿ" class="headerlink" title="ä»»åŠ¡å¹‚ç­‰æ€§å¦‚ä½•ä¿è¯ï¼Ÿ"></a>ä»»åŠ¡å¹‚ç­‰æ€§å¦‚ä½•ä¿è¯ï¼Ÿ</h3><ul><li><p>å¹‚ç­‰æ€§æè¿°çš„æ˜¯ä¸€æ¬¡å’Œå¤šæ¬¡è¯·æ±‚æŸä¸€ä¸ªèµ„æºï¼Œå¯¹äºèµ„æºæœ¬èº«ï¼Œåº”è¯¥è¿”å›åŒæ ·çš„ç»“æœ</p></li><li><p>å¹‚ç­‰æ€§æ˜¯ä¸ºäº†è§£å†³é‡å¤æäº¤é—®é¢˜ï¼Œä¾‹å¦‚ï¼šæ¶æ„åˆ·å•ï¼Œé‡å¤æ”¯ä»˜ç­‰</p></li><li><p>è§£å†³å¹‚ç­‰æ€§çš„å¸¸ç”¨æ–¹æ¡ˆ</p><ol><li>æ•°æ®åº“çº¦æŸï¼Œä¾‹å¦‚ï¼šå”¯ä¸€ç´¢å¼•ã€ä¸»é”®</li><li>ä¹è§‚é”ï¼šå¸¸ç”¨äºæ•°æ®åº“ï¼Œæ›´æ–°æ•°æ®æ—¶ï¼Œæ ¹æ®ä¹è§‚é”çš„çŠ¶æ€å»æ›´æ–°</li><li>å”¯ä¸€åºåˆ—å·ï¼Œè¯·æ±‚å‰ç”Ÿæˆçš„å”¯ä¸€åºåˆ—å·ï¼Œæºå¸¦åºåˆ—å·å»è¯·æ±‚ï¼Œæ‰§è¡Œæ—¶åœ¨redisè®°å½•è¯¥åºåˆ—å·ï¼Œç”¨äºè¡¨ç¤ºè¯¥åºåˆ—å·è¯·æ±‚å·²ç»æ‰§è¡Œè¿‡äº†ï¼Œå¦‚æœç›¸åŒçš„åºåˆ—å·å†æ¬¡æ¥æ‰§è¡Œï¼Œåˆ™è¯´æ˜æ˜¯é‡å¤æ‰§è¡Œã€‚</li></ol><p>æœ¬é¡¹ç›®çš„è§£å†³æ–¹å¼æ˜¯<mark><strong>åœ¨æ•°æ®åº“ä¸­æ·»åŠ çŠ¶æ€å¤„ç†å­—æ®µ</strong></mark>ï¼Œè§†é¢‘å¤„ç†å®Œæˆï¼Œåˆ™æ›´æ–°è¯¥å­—æ®µä¸ºå·²å®Œæˆï¼Œæ‰§è¡Œè§†é¢‘å¤„ç†ä¹‹å‰åˆ¤æ–­çŠ¶æ€æ˜¯å¦ä¸ºå·²å®Œæˆï¼Œè‹¥å·²å®Œæˆåˆ™ä¸å¤„ç†</p></li></ul><h3 id="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ</h3><ul><li>ç”±å¤šä¸ªæœåŠ¡é€šè¿‡ç½‘ç»œå®Œæˆä¸€ä¸ªäº‹åŠ¡å«åˆ†å¸ƒå¼äº‹åŠ¡</li><li>ä¾‹å¦‚ï¼šè¯¾ç¨‹å‘å¸ƒæ“ä½œä¸ä»…è¦åœ¨æœ¬åœ°æ•°æ®åº“æ’å…¥è¯¾ç¨‹ä¿¡æ¯ï¼Œè¿˜è¦è¯·æ±‚ç´¢å¼•æœåŠ¡å°†è¯¾ç¨‹ä¿¡æ¯æ·»åŠ åˆ°ç´¢å¼•åº“ï¼Œè¿™é‡Œå°±å­˜åœ¨åˆ†å¸ƒå¼äº‹åŠ¡</li></ul><h3 id="åˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶çš„æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶çš„æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶çš„æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ"></a>åˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶çš„æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ</h3><ul><li>é¦–å…ˆæ ¹æ®CAPåŸç†å†³å®šæˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ˜¯è¦å®ç°CPè¿˜æ˜¯AP</li><li>å®ç°CPå°±æ˜¯è¦å®ç°å¼ºä¸€è‡´æ€§ï¼Œå¯ä»¥ä½¿ç”¨Seataæ¡†æ¶åŸºäºATã€TCCæ¨¡å¼å»å®ç°</li><li>æˆ‘ä»¬é¡¹ç›®ä¸­å¤§éƒ¨åˆ†å®ç°çš„æ˜¯APï¼Œä½¿ç”¨æœ¬åœ°æ¶ˆæ¯è¡¨åŠ ä»»åŠ¡è°ƒåº¦ï¼Œä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡æœ€ç»ˆæ•°æ®ä¸€è‡´æ€§</li></ul><h3 id="â­â­â­å¦‚ä½•ä½¿ç”¨æœ¬åœ°æ¶ˆæ¯è¡¨åŠ ä»»åŠ¡è°ƒåº¦å®Œæˆåˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶ï¼Ÿ"><a href="#â­â­â­å¦‚ä½•ä½¿ç”¨æœ¬åœ°æ¶ˆæ¯è¡¨åŠ ä»»åŠ¡è°ƒåº¦å®Œæˆåˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶ï¼Ÿ" class="headerlink" title="â­â­â­å¦‚ä½•ä½¿ç”¨æœ¬åœ°æ¶ˆæ¯è¡¨åŠ ä»»åŠ¡è°ƒåº¦å®Œæˆåˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶ï¼Ÿ"></a>â­â­â­<strong>å¦‚ä½•ä½¿ç”¨æœ¬åœ°æ¶ˆæ¯è¡¨åŠ ä»»åŠ¡è°ƒåº¦å®Œæˆåˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶ï¼Ÿ</strong></h3><p>å­¦ä¹ æ–‡ç« ï¼š<a href="https://juejin.cn/post/6844904041659498509">https://juejin.cn/post/6844904041659498509</a></p><ul><li>ä»¥<mark><strong>å‘å¸ƒè¯¾ç¨‹</strong></mark>ä¸ºä¾‹è¿›è¡Œè¯´æ˜ï¼Œå‘å¸ƒè¯¾ç¨‹éœ€è¦åœ¨å†…å®¹ç®¡ç†æ•°æ®åº“ä¸­å†™è¯¾ç¨‹å‘å¸ƒè¡¨è®°å½•ï¼ŒåŒæ—¶å°†è¯¾ç¨‹ä¿¡æ¯åŒæ­¥åˆ°Redisã€ElasticSearchã€MinIOï¼Œè¿™é‡Œå­˜åœ¨åˆ†å¸ƒå¼äº‹åŠ¡<ol><li>ç‚¹å‡»å‘å¸ƒè¯¾ç¨‹ï¼Œä½¿ç”¨æœ¬åœ°äº‹åŠ¡å‘å‘å¸ƒè¡¨å†™ä¸€ä¸ªè¯¾ç¨‹ä¿¡æ¯ï¼ŒåŒæ—¶å‘æ¶ˆæ¯è¡¨å†™ä¸€ä¸ªæ¶ˆæ¯è®°å½•ï¼ˆæ ‡è®°å‘å¸ƒçš„æ˜¯å“ªé—¨è¯¾ç¨‹ï¼‰</li><li>xxl-jobçš„è°ƒåº¦ä¸­å¿ƒä½¿ç”¨åˆ†ç‰‡å¹¿æ’­æ¨¡å¼å‘æ‰§è¡Œå™¨ä¸‹å‘ä»»åŠ¡ï¼Œå¼€å§‹æ‰«ææ¶ˆæ¯è¡¨ï¼ŒæŸ¥è¯¢åˆ°äº†å¾…å¤„ç†æ¶ˆæ¯</li><li>æ ¹æ®æ¶ˆæ¯çš„å†…å®¹å°†è¯¾ç¨‹ä¿¡æ¯åŒæ­¥åˆ°Redisã€ElasticSearchã€MinIO</li><li>ä»»åŠ¡å®Œæˆï¼Œåˆ é™¤æ¶ˆæ¯è¡¨è®°å½•ã€‚æ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡å®Œæˆï¼Œæœ€ç»ˆä¿è¯äº†ä¸€è‡´æ€§</li></ol></li></ul><p><img src="/../assets/%E6%99%BA%E5%AD%A6%E8%BD%A9%E5%9C%A8%E7%BA%BF%E6%95%99%E8%82%B2%E5%B9%B3%E5%8F%B0/image-20231229222033846.png" alt="image-20231229222033846"></p><hr><p><img src="/../assets/%E6%99%BA%E5%AD%A6%E8%BD%A9%E5%9C%A8%E7%BA%BF%E6%95%99%E8%82%B2%E5%B9%B3%E5%8F%B0/image-20231229222007464.png" alt="image-20231229222007464"></p><h3 id="å…³äºçº¿ç¨‹æ± çš„é—®é¢˜"><a href="#å…³äºçº¿ç¨‹æ± çš„é—®é¢˜" class="headerlink" title="å…³äºçº¿ç¨‹æ± çš„é—®é¢˜"></a>å…³äºçº¿ç¨‹æ± çš„é—®é¢˜</h3><p>åœ¨ä½¿ç”¨<mark><strong>çº¿ç¨‹æ± å®ç°ä»»åŠ¡</strong></mark>çš„å¹¶è¡Œå¤„ç†ã€å¹¶ç»“åˆæ¶ˆæ¯è¡¨çŠ¶æ€å­—æ®µç¡®ä¿ä»»åŠ¡çš„å¹‚ç­‰æ€§ï¼Œ<mark><strong>å¯èƒ½æ¶‰åŠä»¥ä¸‹ä¸€äº›ä»»åŠ¡</strong></mark>ï¼š</p><ol><li><strong>è¯¾ç¨‹å†…å®¹æ›´æ–°ï¼š</strong><ul><li>å½“æœ‰<mark><strong>æ–°çš„è¯¾ç¨‹å†…å®¹éœ€è¦æ›´æ–°æ—¶ï¼Œå¯ä»¥é€šè¿‡å¼‚æ­¥ä»»åŠ¡è¿›è¡Œå¹¶è¡Œå¤„ç†</strong></mark>ï¼Œä½¿ç”¨çº¿ç¨‹æ± æ¥æé«˜å¤„ç†æ•ˆç‡ã€‚</li><li>é€šè¿‡æ¶ˆæ¯è¡¨è®°å½•è¯¾ç¨‹æ›´æ–°ä»»åŠ¡çš„çŠ¶æ€ï¼Œé¿å…é‡å¤æ‰§è¡Œï¼Œç¡®ä¿ä»»åŠ¡çš„å¹‚ç­‰æ€§ã€‚è¿™å¯ä»¥åŒ…æ‹¬è¯¾ç¨‹ä¿¡æ¯çš„ä¿®æ”¹ã€æ·»åŠ æ–°çš„æ•™æç­‰ã€‚</li></ul></li><li><strong><mark>åª’ä½“èµ„æºä¸Šä¼ ä¸å¤„ç†</mark>ï¼š</strong>ï¼ˆæœ¬é¡¹ç›®ï¼‰<ul><li>åª’ä½“èµ„æºåŒ…æ‹¬è§†é¢‘ã€å›¾ç‰‡ã€æ–‡æ¡£ç­‰ï¼Œä¸Šä¼ å’Œå¤„ç†è¿™äº›èµ„æºå¯èƒ½æ˜¯ä¸€ä¸ªè¾ƒä¸ºè€—æ—¶çš„ä»»åŠ¡ã€‚</li><li><mark><strong>ä½¿ç”¨çº¿ç¨‹æ± å®ç°å¹¶è¡Œå¤„ç†ä¸Šä¼ ä»»åŠ¡ï¼ˆæ•°æ®æ±‡æ€»ï¼‰</strong></mark>ï¼ŒåŒæ—¶é€šè¿‡æ¶ˆæ¯è¡¨è®°å½•ä¸Šä¼ ä»»åŠ¡çš„çŠ¶æ€ï¼Œç¡®ä¿å¹‚ç­‰æ€§ã€‚è¿™å¯ä»¥åŒ…æ‹¬å°†åª’ä½“èµ„æºä¸Šä¼ åˆ°MinIOåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶å¤„ç†å¤§æ–‡ä»¶çš„æ–­ç‚¹ç»­ä¼ ã€‚</li><li>æ•°æ®æ±‡æ€»ï¼šå¦‚æœæ‰€æœ‰æ¥å£ï¼ˆæˆ–éƒ¨åˆ†æ¥å£ï¼‰çš„æ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œå°±å¯ä»¥<mark><strong>ä½¿ç”¨çº¿ç¨‹æ± +futureæ¥æå‡æ€§èƒ½</strong></mark></li></ul></li><li><strong>è®¢å•å¤„ç†ä¸é€šçŸ¥ï¼š</strong><ul><li>è®¢å•ç®¡ç†æ¨¡å—å¯èƒ½éœ€è¦å¤„ç†ç”¨æˆ·è´­ä¹°è¯¾ç¨‹çš„è®¢å•ï¼Œè¿›è¡Œåº“å­˜æ‰£å‡ã€æ”¯ä»˜çŠ¶æ€æ›´æ–°ç­‰æ“ä½œã€‚</li><li>ä½¿ç”¨çº¿ç¨‹æ± è¿›è¡Œè®¢å•å¤„ç†ä»»åŠ¡çš„å¹¶è¡Œå¤„ç†ï¼Œé€šè¿‡æ¶ˆæ¯è¡¨è®°å½•ä»»åŠ¡çŠ¶æ€ï¼Œç¡®ä¿è®¢å•å¤„ç†çš„å¹‚ç­‰æ€§ã€‚åŒæ—¶ï¼Œä½¿ç”¨RabbitMQè¿›è¡Œç»“æœé€šçŸ¥ï¼ŒåŸºäºå»¶è¿Ÿé˜Ÿåˆ—å¤„ç†æœªæ”¯ä»˜è®¢å•ï¼Œä»¥æé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚</li></ul></li></ol><p>æ€»ä½“è€Œè¨€ï¼Œè¿™äº›ä»»åŠ¡çš„å¼‚æ­¥å¤„ç†å’Œå¹¶è¡Œæ‰§è¡Œï¼Œé€šè¿‡çº¿ç¨‹æ± çš„æœºåˆ¶å¯ä»¥æœ‰æ•ˆæé«˜ç³»ç»Ÿçš„å“åº”é€Ÿåº¦å’Œå¤„ç†èƒ½åŠ›ã€‚æ¶ˆæ¯è¡¨çš„å¼•å…¥åˆ™æœ‰åŠ©äºç¡®ä¿ä»»åŠ¡çš„å¹‚ç­‰æ€§ï¼Œé¿å…ç”±äºé‡å¤æ‰§è¡Œä»»åŠ¡è€Œå¼•å‘çš„é—®é¢˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å¾®æœåŠ¡</title>
      <link href="/2023/12/23/%E9%9D%A2%E8%AF%95-%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
      <url>/2023/12/23/%E9%9D%A2%E8%AF%95-%E5%BE%AE%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p><img src="/../assets/%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20231223180737280.png" alt="image-20231223180737280"></p><h1 id="Spring-Cloud-5å¤§ç»„ä»¶æœ‰å“ªäº›ï¼Ÿ"><a href="#Spring-Cloud-5å¤§ç»„ä»¶æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="Spring Cloud 5å¤§ç»„ä»¶æœ‰å“ªäº›ï¼Ÿ"></a>Spring Cloud 5å¤§ç»„ä»¶æœ‰å“ªäº›ï¼Ÿ</h1><p>æ—©æœŸæˆ‘ä»¬ä¸€èˆ¬è®¤ä¸ºçš„Spring Cloudäº”å¤§ç»„ä»¶æ˜¯ </p><ul><li>Eureka   : æ³¨å†Œä¸­å¿ƒ</li><li>Ribbon  : è´Ÿè½½å‡è¡¡</li><li>Feign     : è¿œç¨‹è°ƒç”¨</li><li>Hystrix :  æœåŠ¡ç†”æ–­</li><li>Zuul&#x2F;Gateway  : ç½‘å…³</li></ul><p>éšç€SpringCloudAlibbaåœ¨å›½å†…å…´èµ· , æˆ‘ä»¬é¡¹ç›®ä¸­ä½¿ç”¨äº†ä¸€äº›é˜¿é‡Œå·´å·´çš„ç»„ä»¶ </p><ul><li><p>æ³¨å†Œä¸­å¿ƒ&#x2F;é…ç½®ä¸­å¿ƒ Nacos</p></li><li><p>è´Ÿè½½å‡è¡¡ Ribbon</p></li><li><p>æœåŠ¡è°ƒç”¨ Feign</p></li><li><p>æœåŠ¡ä¿æŠ¤ sentinel</p></li><li><p>æœåŠ¡ç½‘å…³ Gateway</p></li></ul><h1 id="æœåŠ¡æ³¨å†Œå’Œå‘ç°æ˜¯ä»€ä¹ˆæ„æ€ï¼ŸSpring-Cloud-å¦‚ä½•å®ç°æœåŠ¡æ³¨å†Œå‘ç°ï¼Ÿ"><a href="#æœåŠ¡æ³¨å†Œå’Œå‘ç°æ˜¯ä»€ä¹ˆæ„æ€ï¼ŸSpring-Cloud-å¦‚ä½•å®ç°æœåŠ¡æ³¨å†Œå‘ç°ï¼Ÿ" class="headerlink" title="æœåŠ¡æ³¨å†Œå’Œå‘ç°æ˜¯ä»€ä¹ˆæ„æ€ï¼ŸSpring Cloud å¦‚ä½•å®ç°æœåŠ¡æ³¨å†Œå‘ç°ï¼Ÿ"></a>æœåŠ¡æ³¨å†Œå’Œå‘ç°æ˜¯ä»€ä¹ˆæ„æ€ï¼ŸSpring Cloud å¦‚ä½•å®ç°æœåŠ¡æ³¨å†Œå‘ç°ï¼Ÿ</h1><p><strong>ä¸»è¦ä¸‰å—å¤§åŠŸèƒ½ï¼Œåˆ†åˆ«æ˜¯æœåŠ¡æ³¨å†Œï¼ˆæä¾›è€…ï¼‰ ã€æœåŠ¡å‘ç°ï¼ˆæ¶ˆè´¹è€…ï¼‰ã€æœåŠ¡çŠ¶æ€ç›‘æ§ï¼ˆnacosï¼‰</strong></p><p>æˆ‘ä»¬å½“æ—¶é¡¹ç›®é‡‡ç”¨çš„nacosä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œè¿™ä¸ªæ˜¯spring cloudä½“ç³»ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶</p><p><strong>æœåŠ¡æ³¨å†Œ</strong>ï¼š<mark><strong>æœåŠ¡æä¾›è€…</strong></mark>éœ€è¦æŠŠè‡ªå·±çš„ä¿¡æ¯æ³¨å†Œåˆ°nacosï¼Œç”±nacosæ¥ä¿å­˜è¿™äº›ä¿¡æ¯ï¼Œæ¯”å¦‚æœåŠ¡åç§°ã€ipã€ç«¯å£ç­‰ç­‰</p><p><strong>æœåŠ¡å‘ç°</strong>ï¼šæ¶ˆè´¹è€…å‘nacosæ‹‰å–æœåŠ¡åˆ—è¡¨ä¿¡æ¯ï¼Œå¦‚æœæœåŠ¡æä¾›è€…æœ‰é›†ç¾¤ï¼Œåˆ™æ¶ˆè´¹è€…ä¼šåˆ©ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰æ‹©ä¸€ä¸ªå‘èµ·è°ƒç”¨</p><p><strong>æœåŠ¡ç›‘æ§</strong>ï¼šæœåŠ¡æä¾›è€…ä¼šæ¯éš”30ç§’å‘nacoså‘é€å¿ƒè·³ï¼ŒæŠ¥å‘Šå¥åº·çŠ¶æ€ï¼Œå¦‚æœnacosæœåŠ¡90ç§’æ²¡æ¥æ”¶åˆ°å¿ƒè·³ï¼Œä»nacosä¸­å‰”é™¤</p><p><img src="/../assets/%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20231230195313133.png" alt="image-20231230195313133"></p><h1 id="nacosä¸eurekaçš„åŒºåˆ«ï¼Ÿ"><a href="#nacosä¸eurekaçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="nacosä¸eurekaçš„åŒºåˆ«ï¼Ÿ"></a>nacosä¸eurekaçš„åŒºåˆ«ï¼Ÿ</h1><p>é¡¹ç›®å°±æ˜¯é‡‡ç”¨çš„nacosä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œé€‰æ‹©nacosè¿˜è¦ä¸€ä¸ªé‡è¦åŸå› å°±æ˜¯å®ƒæ”¯æŒé…ç½®ä¸­å¿ƒï¼Œä¸è¿‡nacosä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œä¹Ÿæ¯”eurekaè¦æ–¹ä¾¿å¥½ç”¨ä¸€äº›ï¼Œä¸»è¦ç›¸åŒä¸åŒç‚¹åœ¨äºå‡ ç‚¹ï¼š</p><ul><li>å…±åŒç‚¹</li></ul><p>Nacosä¸eurekaéƒ½æ”¯æŒæœåŠ¡æ³¨å†Œå’ŒæœåŠ¡æ‹‰å–ï¼Œéƒ½æ”¯æŒæœåŠ¡æä¾›è€…å¿ƒè·³æ–¹å¼åšå¥åº·æ£€æµ‹</p><ul><li>Nacosä¸Eurekaçš„åŒºåˆ«</li></ul><p>â‘ Nacosæ”¯æŒ<strong>æœåŠ¡ç«¯ä¸»åŠ¨æ£€æµ‹æä¾›è€…çŠ¶æ€</strong>ï¼šä¸´æ—¶å®ä¾‹é‡‡ç”¨å¿ƒè·³æ¨¡å¼ï¼Œéä¸´æ—¶å®ä¾‹é‡‡ç”¨ä¸»åŠ¨æ£€æµ‹æ¨¡å¼</p><p>â‘¡ä¸´æ—¶å®ä¾‹å¿ƒè·³ä¸æ­£å¸¸ä¼šè¢«å‰”é™¤ï¼Œéä¸´æ—¶å®ä¾‹åˆ™ä¸ä¼šè¢«å‰”é™¤</p><p>â‘¢Nacosæ”¯æŒæœåŠ¡åˆ—è¡¨å˜æ›´çš„<strong>æ¶ˆæ¯æ¨é€æ¨¡å¼</strong>ï¼ŒæœåŠ¡åˆ—è¡¨æ›´æ–°æ›´åŠæ—¶</p><p>â‘£Nacosé›†ç¾¤é»˜è®¤é‡‡ç”¨APæ–¹å¼ï¼Œå½“é›†ç¾¤ä¸­å­˜åœ¨éä¸´æ—¶å®ä¾‹æ—¶ï¼Œé‡‡ç”¨CPæ¨¡å¼ï¼›Eurekaé‡‡ç”¨APæ–¹å¼</p><h1 id="é¡¹ç›®çš„è´Ÿè½½å‡è¡¡å¦‚ä½•å®ç°çš„"><a href="#é¡¹ç›®çš„è´Ÿè½½å‡è¡¡å¦‚ä½•å®ç°çš„" class="headerlink" title="é¡¹ç›®çš„è´Ÿè½½å‡è¡¡å¦‚ä½•å®ç°çš„ ?"></a>é¡¹ç›®çš„è´Ÿè½½å‡è¡¡å¦‚ä½•å®ç°çš„ ?</h1><blockquote><p>ribbonæ˜¯é›†æˆåœ¨æ¶ˆè´¹ç«¯çš„ï¼Œå› ä¸ºå·²ç»æ‹‰å–åˆ°äº†æœåŠ¡ç«¯çš„åˆ—è¡¨</p></blockquote><p>åœ¨æœåŠ¡è°ƒç”¨è¿‡ç¨‹ä¸­çš„è´Ÿè½½å‡è¡¡ä¸€èˆ¬ä½¿ç”¨SpringCloudçš„Ribbon ç»„ä»¶å®ç°  , Feignçš„åº•å±‚å·²ç»è‡ªåŠ¨é›†æˆäº†Ribbon  , ä½¿ç”¨èµ·æ¥éå¸¸ç®€å•</p><p>å½“å‘èµ·è¿œç¨‹è°ƒç”¨æ—¶ï¼Œribbonå…ˆä»æ³¨å†Œä¸­å¿ƒæ‹‰å–æœåŠ¡åœ°å€åˆ—è¡¨ï¼Œç„¶åæŒ‰ç…§ä¸€å®šçš„è·¯ç”±ç­–ç•¥é€‰æ‹©ä¸€ä¸ªå‘èµ·è¿œç¨‹è°ƒç”¨ï¼Œä¸€èˆ¬çš„è°ƒç”¨ç­–ç•¥æ˜¯è½®è¯¢</p><h1 id="Ribbonè´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰å“ªäº›"><a href="#Ribbonè´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰å“ªäº›" class="headerlink" title="Ribbonè´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰å“ªäº› ?"></a>Ribbonè´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰å“ªäº› ?</h1><ul><li><p>RoundRobinRuleï¼š<mark>ç®€å•è½®è¯¢</mark>æœåŠ¡åˆ—è¡¨æ¥é€‰æ‹©æœåŠ¡å™¨</p></li><li><p>WeightedResponseTimeRuleï¼šæŒ‰ç…§<mark>æƒé‡</mark>æ¥é€‰æ‹©æœåŠ¡å™¨ï¼Œå“åº”æ—¶é—´è¶Šé•¿ï¼Œæƒé‡è¶Šå°</p></li><li><p>RandomRuleï¼š<mark>éšæœº</mark>é€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„æœåŠ¡å™¨</p></li><li><p>ZoneAvoidanceRuleï¼š<mark>åŒºåŸŸ</mark>æ•æ„Ÿç­–ç•¥ï¼Œä»¥åŒºåŸŸå¯ç”¨çš„æœåŠ¡å™¨ä¸ºåŸºç¡€è¿›è¡ŒæœåŠ¡å™¨çš„é€‰æ‹©ã€‚ä½¿ç”¨Zoneå¯¹æœåŠ¡å™¨è¿›è¡Œåˆ†ç±»ï¼Œè¿™ä¸ªZoneå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæœºæˆ¿ã€ä¸€ä¸ªæœºæ¶ç­‰ã€‚è€Œåå†å¯¹Zoneå†…çš„å¤šä¸ªæœåŠ¡åš<mark>è½®è¯¢</mark>(é»˜è®¤)</p></li></ul><h1 id="å¦‚æœæƒ³è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥å¦‚ä½•å®ç°"><a href="#å¦‚æœæƒ³è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥å¦‚ä½•å®ç°" class="headerlink" title="å¦‚æœæƒ³è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥å¦‚ä½•å®ç° ?"></a>å¦‚æœæƒ³è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥å¦‚ä½•å®ç° ?</h1><p>æä¾›äº†ä¸¤ç§æ–¹å¼ï¼š</p><ol><li><p>åˆ›å»ºç±»å®ç°IRuleæ¥å£ï¼Œå¯ä»¥æŒ‡å®šè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œè¿™ä¸ªæ˜¯å…¨å±€çš„ï¼Œå¯¹æ‰€æœ‰çš„è¿œç¨‹è°ƒç”¨éƒ½èµ·ä½œç”¨</p></li><li><p>åœ¨å®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é…ç½®æŸä¸€ä¸ªæœåŠ¡è°ƒç”¨çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œåªæ˜¯å¯¹é…ç½®çš„è¿™ä¸ªæœåŠ¡ç”Ÿæ•ˆè¿œç¨‹è°ƒç”¨</p></li></ol><h1 id="ä»€ä¹ˆæ˜¯æœåŠ¡é›ªå´©ï¼Œæ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æœåŠ¡é›ªå´©ï¼Œæ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æœåŠ¡é›ªå´©ï¼Œæ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æœåŠ¡é›ªå´©ï¼Œæ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</h1><p>æœåŠ¡é›ªå´©æ˜¯æŒ‡<mark>ä¸€ä¸ªæœåŠ¡å¤±è´¥ï¼Œå¯¼è‡´æ•´æ¡é“¾è·¯çš„æœåŠ¡éƒ½å¤±è´¥</mark>çš„æƒ…å½¢ï¼Œä¸€èˆ¬æˆ‘ä»¬åœ¨é¡¹ç›®è§£å†³çš„è¯å°±æ˜¯ä¸¤ç§æ–¹æ¡ˆï¼Œç¬¬ä¸€ä¸ªæ˜¯æœåŠ¡é™çº§ï¼Œç¬¬äºŒä¸ªæ˜¯æœåŠ¡ç†”æ–­ï¼Œå¦‚æœæµé‡å¤ªå¤§çš„è¯ï¼Œå¯ä»¥è€ƒè™‘é™æµ</p><p><strong>æœåŠ¡é™çº§</strong>ï¼šæœåŠ¡è‡ªæˆ‘ä¿æŠ¤çš„ä¸€ç§æ–¹å¼ï¼Œæˆ–è€…ä¿æŠ¤ä¸‹æ¸¸æœåŠ¡çš„ä¸€ç§æ–¹å¼ï¼Œç”¨äºç¡®ä¿æœåŠ¡ä¸ä¼šå—è¯·æ±‚çªå¢å½±å“å˜å¾—ä¸å¯ç”¨ï¼Œç¡®ä¿æœåŠ¡ä¸ä¼šå´©æºƒï¼Œä¸€èˆ¬åœ¨å®é™…å¼€å‘ä¸­ä¸feignæ¥å£æ•´åˆï¼Œç¼–å†™é™çº§é€»è¾‘</p><p><strong>æœåŠ¡ç†”æ–­</strong>ï¼šé»˜è®¤å…³é—­ï¼Œéœ€è¦æ‰‹åŠ¨æ‰“å¼€ï¼Œå¦‚æœæ£€æµ‹åˆ° 10 ç§’å†…è¯·æ±‚çš„å¤±è´¥ç‡è¶…è¿‡ 50%ï¼Œå°±è§¦å‘ç†”æ–­æœºåˆ¶ã€‚ä¹‹åæ¯éš” 5 ç§’é‡æ–°å°è¯•è¯·æ±‚å¾®æœåŠ¡ï¼Œå¦‚æœå¾®æœåŠ¡ä¸èƒ½å“åº”ï¼Œç»§ç»­èµ°ç†”æ–­æœºåˆ¶ã€‚å¦‚æœå¾®æœåŠ¡å¯è¾¾ï¼Œåˆ™å…³é—­ç†”æ–­æœºåˆ¶ï¼Œæ¢å¤æ­£å¸¸è¯·æ±‚</p><h1 id="ä½ ä»¬çš„å¾®æœåŠ¡æ˜¯æ€ä¹ˆç›‘æ§çš„ï¼Ÿ"><a href="#ä½ ä»¬çš„å¾®æœåŠ¡æ˜¯æ€ä¹ˆç›‘æ§çš„ï¼Ÿ" class="headerlink" title="ä½ ä»¬çš„å¾®æœåŠ¡æ˜¯æ€ä¹ˆç›‘æ§çš„ï¼Ÿ"></a>ä½ ä»¬çš„å¾®æœåŠ¡æ˜¯æ€ä¹ˆç›‘æ§çš„ï¼Ÿ</h1><p>æˆ‘ä»¬é¡¹ç›®ä¸­é‡‡ç”¨çš„skywalkingè¿›è¡Œç›‘æ§çš„</p><ol><li><p>skywalkingä¸»è¦å¯ä»¥ç›‘æ§æ¥å£ã€æœåŠ¡ã€ç‰©ç†å®ä¾‹çš„ä¸€äº›çŠ¶æ€ã€‚ç‰¹åˆ«æ˜¯åœ¨å‹æµ‹çš„æ—¶å€™å¯ä»¥çœ‹åˆ°ä¼—å¤šæœåŠ¡ä¸­å“ªäº›æœåŠ¡å’Œæ¥å£æ¯”è¾ƒæ…¢ï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹æ€§çš„åˆ†æå’Œä¼˜åŒ–ã€‚</p></li><li><p>æˆ‘ä»¬è¿˜åœ¨skywalkingè®¾ç½®äº†å‘Šè­¦è§„åˆ™ï¼Œç‰¹åˆ«æ˜¯åœ¨é¡¹ç›®ä¸Šçº¿ä»¥åï¼Œå¦‚æœæŠ¥é”™ï¼Œæˆ‘ä»¬åˆ†åˆ«è®¾ç½®äº†å¯ä»¥ç»™ç›¸å…³è´Ÿè´£äººå‘çŸ­ä¿¡å’Œå‘é‚®ä»¶ï¼Œç¬¬ä¸€æ—¶é—´çŸ¥é“é¡¹ç›®çš„bugæƒ…å†µï¼Œç¬¬ä¸€æ—¶é—´ä¿®å¤</p></li></ol><h1 id="ä½ ä»¬é¡¹ç›®ä¸­æœ‰æ²¡æœ‰åšè¿‡é™æµ-æ€ä¹ˆåšçš„"><a href="#ä½ ä»¬é¡¹ç›®ä¸­æœ‰æ²¡æœ‰åšè¿‡é™æµ-æ€ä¹ˆåšçš„" class="headerlink" title="ä½ ä»¬é¡¹ç›®ä¸­æœ‰æ²¡æœ‰åšè¿‡é™æµ ? æ€ä¹ˆåšçš„ ?"></a>ä½ ä»¬é¡¹ç›®ä¸­æœ‰æ²¡æœ‰åšè¿‡é™æµ ? æ€ä¹ˆåšçš„ ?</h1><p>æˆ‘å½“æ—¶åšçš„xxé¡¹ç›®ï¼Œé‡‡ç”¨å°±æ˜¯å¾®æœåŠ¡çš„æ¶æ„ï¼Œä¸ºäº†è§£å†³è¿™äº›çªå‘æµé‡ï¼Œæ‰€ä»¥é‡‡ç”¨äº†é™æµã€‚</p><p>ã€ç‰ˆæœ¬1ã€‘</p><p>æˆ‘ä»¬å½“æ—¶é‡‡ç”¨çš„<strong>nginx</strong>é™æµæ“ä½œï¼Œnginxä½¿ç”¨çš„<mark><strong>æ¼æ¡¶ç®—æ³•</strong></mark>æ¥å®ç°è¿‡æ»¤ï¼Œè®©è¯·æ±‚ä»¥å›ºå®šçš„é€Ÿç‡å¤„ç†è¯·æ±‚ï¼Œå¯ä»¥åº”å¯¹çªå‘æµé‡ï¼Œæˆ‘ä»¬æ§åˆ¶çš„é€Ÿç‡æ˜¯æŒ‰ç…§ipè¿›è¡Œé™æµï¼Œé™åˆ¶çš„æµé‡æ˜¯æ¯ç§’20</p><p>ã€ç‰ˆæœ¬2ã€‘</p><p>æˆ‘ä»¬å½“æ—¶é‡‡ç”¨çš„æ˜¯<strong>spring cloud gateway</strong>ä¸­æ”¯æŒå±€éƒ¨è¿‡æ»¤å™¨RequestRateLimiteræ¥åšé™æµï¼Œä½¿ç”¨çš„æ˜¯ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œå¯ä»¥æ ¹æ®ipæˆ–è·¯å¾„è¿›è¡Œé™æµï¼Œå¯ä»¥è®¾ç½®æ¯ç§’å¡«å……å¹³å‡é€Ÿç‡ï¼Œå’Œ<mark><strong>ä»¤ç‰Œæ¡¶</strong></mark>æ€»å®¹é‡</p><h1 id="é™æµå¸¸è§çš„ç®—æ³•æœ‰å“ªäº›å‘¢ï¼Ÿ"><a href="#é™æµå¸¸è§çš„ç®—æ³•æœ‰å“ªäº›å‘¢ï¼Ÿ" class="headerlink" title="é™æµå¸¸è§çš„ç®—æ³•æœ‰å“ªäº›å‘¢ï¼Ÿ"></a>é™æµå¸¸è§çš„ç®—æ³•æœ‰å“ªäº›å‘¢ï¼Ÿ</h1><p>æ¯”è¾ƒå¸¸è§çš„é™æµç®—æ³•æœ‰<strong>æ¼æ¡¶ç®—æ³•å’Œä»¤ç‰Œæ¡¶ç®—æ³•</strong></p><p>æ¼æ¡¶ç®—æ³•æ˜¯<strong>æŠŠè¯·æ±‚å­˜å…¥åˆ°æ¡¶ä¸­</strong>ï¼Œä»¥å›ºå®šé€Ÿç‡ä»æ¡¶ä¸­æµå‡ºï¼Œå¯ä»¥è®©æˆ‘ä»¬çš„æœåŠ¡åšåˆ°<mark><strong>ç»å¯¹çš„å¹³å‡</strong></mark>ï¼Œèµ·åˆ°å¾ˆå¥½çš„é™æµæ•ˆæœ</p><p>ä»¤ç‰Œæ¡¶ç®—æ³•<strong>åœ¨æ¡¶ä¸­å­˜å‚¨çš„æ˜¯ä»¤ç‰Œ</strong>ï¼ŒæŒ‰ç…§ä¸€å®šçš„é€Ÿç‡ç”Ÿæˆä»¤ç‰Œï¼Œ<mark><strong>æ¯ä¸ªè¯·æ±‚éƒ½è¦å…ˆç”³è¯·ä»¤ç‰Œ</strong></mark>ï¼Œç”³è¯·åˆ°ä»¤ç‰Œä»¥åæ‰èƒ½æ­£å¸¸è¯·æ±‚ï¼Œä¹Ÿå¯ä»¥èµ·åˆ°å¾ˆå¥½çš„é™æµä½œç”¨</p><p>å®ƒä»¬çš„åŒºåˆ«æ˜¯ï¼Œæ¼æ¡¶å’Œä»¤ç‰Œæ¡¶éƒ½å¯ä»¥å¤„ç†çªå‘æµé‡ï¼Œå…¶ä¸­æ¼æ¡¶å¯ä»¥åšåˆ°ç»å¯¹çš„å¹³æ»‘ï¼Œä»¤ç‰Œæ¡¶æœ‰å¯èƒ½ä¼šäº§ç”Ÿçªå‘å¤§é‡è¯·æ±‚çš„æƒ…å†µï¼Œä¸€èˆ¬nginxé™æµé‡‡ç”¨çš„æ¼æ¡¶ï¼Œspring cloud gatewayä¸­å¯ä»¥æ”¯æŒä»¤ç‰Œæ¡¶ç®—æ³•</p><h1 id="ä»€ä¹ˆæ˜¯CAPç†è®ºï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯CAPç†è®ºï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯CAPç†è®ºï¼Ÿ"></a>ä»€ä¹ˆæ˜¯CAPç†è®ºï¼Ÿ</h1><p>CAPä¸»è¦æ˜¯åœ¨åˆ†å¸ƒå¼é¡¹ç›®ä¸‹çš„ä¸€ä¸ªç†è®ºã€‚åŒ…å«äº†ä¸‰é¡¹ï¼Œä¸€è‡´æ€§ã€å¯ç”¨æ€§ã€åˆ†åŒºå®¹é”™æ€§</p><ul><li><p>ä¸€è‡´æ€§(Consistency)æ˜¯æŒ‡æ›´æ–°æ“ä½œæˆåŠŸå¹¶è¿”å›å®¢æˆ·ç«¯å®Œæˆåï¼Œæ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çš„æ•°æ®å®Œå…¨ä¸€è‡´(<strong>å¼ºä¸€è‡´æ€§)ï¼Œä¸èƒ½å­˜åœ¨ä¸­é—´çŠ¶æ€</strong>ã€‚</p></li><li><p>å¯ç”¨æ€§(Availability) æ˜¯æŒ‡ç³»ç»Ÿæä¾›çš„æœåŠ¡<strong>å¿…é¡»ä¸€ç›´å¤„äºå¯ç”¨çš„çŠ¶æ€</strong>ï¼Œå¯¹äºç”¨æˆ·çš„æ¯ä¸€ä¸ªæ“ä½œè¯·æ±‚æ€»æ˜¯èƒ½å¤Ÿåœ¨æœ‰é™çš„æ—¶é—´å†…è¿”å›ç»“æœã€‚</p></li><li><p>åˆ†åŒºå®¹é”™æ€§(Partition tolerance) æ˜¯æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°ä»»ä½•ç½‘ç»œåˆ†åŒºæ•…éšœæ—¶ï¼Œä»ç„¶éœ€è¦èƒ½å¤Ÿä¿è¯å¯¹å¤–æä¾›æ»¡è¶³ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æœåŠ¡ï¼Œé™¤éæ˜¯æ•´ä¸ªç½‘ç»œç¯å¢ƒéƒ½å‘ç”Ÿäº†æ•…éšœã€‚</p></li></ul><h1 id="ä¸ºä»€ä¹ˆåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ— æ³•åŒæ—¶ä¿è¯ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ— æ³•åŒæ—¶ä¿è¯ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ— æ³•åŒæ—¶ä¿è¯ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ï¼Ÿ"></a>ä¸ºä»€ä¹ˆåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ— æ³•åŒæ—¶ä¿è¯ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ï¼Ÿ</h1><p>é¦–å…ˆä¸€ä¸ªå‰æï¼Œå¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿè€Œè¨€ï¼Œåˆ†åŒºå®¹é”™æ€§æ˜¯ä¸€ä¸ªæœ€åŸºæœ¬çš„è¦æ±‚ï¼Œå› æ­¤åŸºæœ¬ä¸Šæˆ‘ä»¬åœ¨è®¾è®¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ—¶å€™åªèƒ½ä»ä¸€è‡´æ€§ï¼ˆCï¼‰å’Œå¯ç”¨æ€§ï¼ˆAï¼‰ä¹‹é—´è¿›è¡Œå–èˆã€‚</p><p>å¦‚æœä¿è¯äº†ä¸€è‡´æ€§ï¼ˆCï¼‰ï¼šå¯¹äºèŠ‚ç‚¹N1å’ŒN2ï¼Œå½“å¾€N1é‡Œå†™æ•°æ®æ—¶ï¼ŒN2ä¸Šçš„æ“ä½œå¿…é¡»è¢«æš‚åœï¼Œåªæœ‰å½“N1åŒæ­¥æ•°æ®åˆ°N2æ—¶æ‰èƒ½å¯¹N2è¿›è¡Œè¯»å†™è¯·æ±‚ï¼Œåœ¨N2è¢«æš‚åœæ“ä½œæœŸé—´å®¢æˆ·ç«¯æäº¤çš„è¯·æ±‚ä¼šæ”¶åˆ°å¤±è´¥æˆ–è¶…æ—¶ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸å¯ç”¨æ€§æ˜¯ç›¸æ‚–çš„ã€‚</p><p>å¦‚æœä¿è¯äº†å¯ç”¨æ€§ï¼ˆAï¼‰ï¼šé‚£å°±ä¸èƒ½æš‚åœN2çš„è¯»å†™æ“ä½œï¼Œä½†åŒæ—¶N1åœ¨å†™æ•°æ®çš„è¯ï¼Œè¿™å°±è¿èƒŒäº†ä¸€è‡´æ€§çš„è¦æ±‚ã€‚</p><h1 id="ä»€ä¹ˆæ˜¯BASEç†è®ºï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯BASEç†è®ºï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯BASEç†è®ºï¼Ÿ"></a>ä»€ä¹ˆæ˜¯BASEç†è®ºï¼Ÿ</h1><p>è¿™ä¸ªä¹Ÿæ˜¯CAPåˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ç†è®º</p><p>BASEæ˜¯CAPç†è®ºä¸­APæ–¹æ¡ˆçš„å»¶ä¼¸ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯å³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼ˆStrongConsistencyï¼ŒCAPçš„ä¸€è‡´æ€§å°±æ˜¯å¼ºä¸€è‡´æ€§ï¼‰ï¼Œä½†åº”ç”¨å¯ä»¥é‡‡ç”¨é€‚åˆçš„æ–¹å¼è¾¾åˆ°<mark><strong>æœ€ç»ˆä¸€è‡´æ€§</strong></mark>ï¼ˆEventual Consitencyï¼‰ã€‚å®ƒçš„æ€æƒ³åŒ…å«ä¸‰æ–¹é¢ï¼š</p><p>1ã€Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ï¼šåŸºæœ¬å¯ç”¨æ˜¯æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°ä¸å¯é¢„çŸ¥çš„æ•…éšœçš„æ—¶å€™ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼Œä½†ä¸ç­‰äºç³»ç»Ÿä¸å¯ç”¨ã€‚</p><p>2ã€Soft stateï¼ˆè½¯çŠ¶æ€ï¼‰ï¼šå³æ˜¯æŒ‡<strong>å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€</strong>ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€çš„å­˜åœ¨ä¸ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿåœ¨ä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥çš„è¿‡ç¨‹å­˜åœ¨å»¶æ—¶ã€‚</p><p>3ã€Eventually consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ï¼šå¼ºè°ƒç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ã€‚å…¶æœ¬è´¨æ˜¯éœ€è¦ç³»ç»Ÿä¿è¯æœ€ç»ˆæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´ï¼Œè€Œä¸éœ€è¦å®æ—¶ä¿è¯ç³»ç»Ÿæ•°æ®çš„å¼ºä¸€è‡´æ€§ã€‚</p><h1 id="ä½ ä»¬é‡‡ç”¨å“ªç§åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Ÿ"><a href="#ä½ ä»¬é‡‡ç”¨å“ªç§åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Ÿ" class="headerlink" title="ä½ ä»¬é‡‡ç”¨å“ªç§åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Ÿ"></a>ä½ ä»¬é‡‡ç”¨å“ªç§åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Ÿ</h1><p>æœ¬åœ°æ¶ˆæ¯è¡¨åŠ ä»»åŠ¡è°ƒåº¦å®Œæˆåˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶</p><p>è¯¦è§ï¼š<a href="https://planbbbbb.github.io/2023/12/29/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E5%9C%A8%E7%BA%BF%E6%95%99%E8%82%B2%E5%B9%B3%E5%8F%B0/">https://planbbbbb.github.io/2023/12/29/Project-%E6%99%BA%E5%AD%A6%E8%BD%A9%E5%9C%A8%E7%BA%BF%E6%95%99%E8%82%B2%E5%B9%B3%E5%8F%B0/</a></p><h1 id="åˆ†å¸ƒå¼æœåŠ¡çš„æ¥å£å¹‚ç­‰æ€§å¦‚ä½•è®¾è®¡ï¼Ÿ"><a href="#åˆ†å¸ƒå¼æœåŠ¡çš„æ¥å£å¹‚ç­‰æ€§å¦‚ä½•è®¾è®¡ï¼Ÿ" class="headerlink" title="åˆ†å¸ƒå¼æœåŠ¡çš„æ¥å£å¹‚ç­‰æ€§å¦‚ä½•è®¾è®¡ï¼Ÿ"></a>åˆ†å¸ƒå¼æœåŠ¡çš„æ¥å£å¹‚ç­‰æ€§å¦‚ä½•è®¾è®¡ï¼Ÿ</h1><p>å—¯ï¼Œæˆ‘ä»¬å½“æ—¶æœ‰ä¸€ä¸ªxxé¡¹ç›®çš„ä¸‹å•æ“ä½œï¼Œé‡‡ç”¨çš„<mark><strong>token+redis</strong></mark>å®ç°çš„ï¼Œæµç¨‹æ˜¯è¿™æ ·çš„</p><p>ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·æ‰“å¼€äº†å•†å“è¯¦æƒ…é¡µé¢ï¼Œæˆ‘ä»¬ä¼šå‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œåœ¨åå°ç”Ÿæˆä¸€ä¸ª<mark>å”¯ä¸€tokenå­˜å…¥redis</mark>ï¼Œkeyå°±æ˜¯ç”¨æˆ·çš„idï¼Œvalueå°±æ˜¯è¿™ä¸ªtokenï¼ŒåŒæ—¶æŠŠè¿™ä¸ªtokenè¿”å›å‰ç«¯</p><p>ç¬¬äºŒæ¬¡è¯·æ±‚ï¼Œå½“ç”¨æˆ·ç‚¹å‡»äº†ä¸‹å•æ“ä½œä¼šåï¼Œä¼šæºå¸¦ä¹‹å‰çš„tokenï¼Œåå°å…ˆåˆ°redisè¿›è¡ŒéªŒè¯ï¼Œå¦‚æœå­˜åœ¨tokenï¼Œå¯ä»¥æ‰§è¡Œä¸šåŠ¡ï¼ŒåŒæ—¶åˆ é™¤tokenï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œä¸å¤„ç†ä¸šåŠ¡ï¼Œå°±ä¿è¯äº†åŒä¸€ä¸ªtokenåªå¤„ç†ä¸€æ¬¡ä¸šåŠ¡ï¼Œå°±ä¿è¯äº†å¹‚ç­‰æ€§</p><h1 id="xxl-jobè·¯ç”±ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ"><a href="#xxl-jobè·¯ç”±ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="xxl-jobè·¯ç”±ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ"></a>xxl-jobè·¯ç”±ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</h1><p>xxl-jobæä¾›äº†å¾ˆå¤šçš„è·¯ç”±ç­–ç•¥ï¼Œæˆ‘ä»¬å¹³æ—¶ç”¨çš„è¾ƒå¤šå°±æ˜¯ï¼š<mark><strong>è½®è¯¢ã€æ•…éšœè½¬ç§»ã€åˆ†ç‰‡å¹¿æ’­</strong></mark>â€¦</p><h1 id="xxl-jobä»»åŠ¡æ‰§è¡Œå¤±è´¥æ€ä¹ˆè§£å†³ï¼Ÿ"><a href="#xxl-jobä»»åŠ¡æ‰§è¡Œå¤±è´¥æ€ä¹ˆè§£å†³ï¼Ÿ" class="headerlink" title="xxl-jobä»»åŠ¡æ‰§è¡Œå¤±è´¥æ€ä¹ˆè§£å†³ï¼Ÿ"></a>xxl-jobä»»åŠ¡æ‰§è¡Œå¤±è´¥æ€ä¹ˆè§£å†³ï¼Ÿ</h1><ol><li><p><strong>è·¯ç”±ç­–ç•¥é€‰æ‹©æ•…éšœè½¬ç§»</strong>ï¼Œä¼˜å…ˆä½¿ç”¨å¥åº·çš„å®ä¾‹æ¥æ‰§è¡Œä»»åŠ¡</p></li><li><p>å¦‚æœè¿˜æœ‰å¤±è´¥çš„ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºä»»åŠ¡æ—¶ï¼Œå¯ä»¥è®¾ç½®<strong>é‡è¯•</strong>æ¬¡æ•°</p></li><li><p>å¦‚æœè¿˜æœ‰å¤±è´¥çš„ï¼Œå°±å¯ä»¥<strong>æŸ¥çœ‹æ—¥å¿—</strong>æˆ–è€…é…ç½®é‚®ä»¶å‘Šè­¦æ¥é€šçŸ¥ç›¸å…³è´Ÿè´£äººè§£å†³</p></li></ol><h1 id="å¦‚æœæœ‰å¤§æ•°æ®é‡çš„ä»»åŠ¡åŒæ—¶éƒ½éœ€è¦æ‰§è¡Œï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ"><a href="#å¦‚æœæœ‰å¤§æ•°æ®é‡çš„ä»»åŠ¡åŒæ—¶éƒ½éœ€è¦æ‰§è¡Œï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ" class="headerlink" title="å¦‚æœæœ‰å¤§æ•°æ®é‡çš„ä»»åŠ¡åŒæ—¶éƒ½éœ€è¦æ‰§è¡Œï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ"></a>å¦‚æœæœ‰å¤§æ•°æ®é‡çš„ä»»åŠ¡åŒæ—¶éƒ½éœ€è¦æ‰§è¡Œï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ</h1><p>æˆ‘ä»¬ä¼šè®©<strong>éƒ¨ç½²å¤šä¸ªå®ä¾‹</strong>ï¼Œå…±åŒå»æ‰§è¡Œè¿™äº›æ‰¹é‡çš„ä»»åŠ¡ï¼Œå…¶ä¸­ä»»åŠ¡çš„è·¯ç”±ç­–ç•¥æ˜¯<strong>åˆ†ç‰‡å¹¿æ’­</strong></p><p>åœ¨ä»»åŠ¡æ‰§è¡Œçš„ä»£ç ä¸­å¯ä»¥è·å–åˆ†ç‰‡æ€»æ•°å’Œå½“å‰åˆ†ç‰‡ï¼ŒæŒ‰ç…§å–æ¨¡çš„æ–¹å¼åˆ†æ‘Šåˆ°å„ä¸ªå®ä¾‹æ‰§è¡Œå°±å¯ä»¥äº†</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ¶ˆæ¯ä¸­é—´ä»¶</title>
      <link href="/2023/12/22/%E9%9D%A2%E8%AF%95-%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
      <url>/2023/12/22/%E9%9D%A2%E8%AF%95-%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æœ¬ç¯‡æ–‡ç« å–è‡ªé»‘é©¬ç¨‹åºå‘˜</p><p><img src="/../assets/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/image-20231222154658626.png" alt="image-20231222154658626"></p><h1 id="RabbitMQ-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±"><a href="#RabbitMQ-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±" class="headerlink" title="RabbitMQ-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±"></a>RabbitMQ-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±</h1><p>æˆ‘ä»¬å½“æ—¶MYSQLå’ŒRedisçš„æ•°æ®åŒå†™ä¸€è‡´æ€§å°±æ˜¯é‡‡ç”¨RabbitMQå®ç°åŒæ­¥çš„ï¼Œè¿™é‡Œé¢å°±è¦æ±‚äº†æ¶ˆæ¯çš„é«˜å¯ç”¨æ€§ï¼Œæˆ‘ä»¬è¦ä¿è¯æ¶ˆæ¯çš„ä¸ä¸¢å¤±ã€‚ä¸»è¦ä»ä¸‰ä¸ªå±‚é¢è€ƒè™‘</p><h2 id="ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶"><a href="#ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶" class="headerlink" title="ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶"></a>ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶</h2><p>ç¬¬ä¸€ä¸ªæ˜¯å¼€å¯<mark>ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶</mark>ï¼Œç¡®ä¿ç”Ÿäº§è€…çš„æ¶ˆæ¯èƒ½åˆ°è¾¾é˜Ÿåˆ—ï¼Œå¦‚æœæŠ¥é”™å¯ä»¥å…ˆè®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œå†å»ä¿®å¤æ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rabbitTemplate.setConfirmCallback((correlationData, ack, cause) -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (ack) &#123;</span><br><span class="line">                    log.info(<span class="string">&quot;æ¶ˆæ¯æˆåŠŸåˆ°è¾¾äº¤æ¢æœº: &#123;&#125;&quot;</span>, correlationData);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;æ¶ˆæ¯æœªåˆ°è¾¾äº¤æ¢æœºï¼ŒåŸå› : &#123;&#125;&quot;</span>, cause);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br></pre></td></tr></table></figure><h2 id="æŒä¹…åŒ–åŠŸèƒ½"><a href="#æŒä¹…åŒ–åŠŸèƒ½" class="headerlink" title="æŒä¹…åŒ–åŠŸèƒ½"></a>æŒä¹…åŒ–åŠŸèƒ½</h2><p>ç¬¬äºŒä¸ªæ˜¯å¼€å¯<mark>æŒä¹…åŒ–åŠŸèƒ½</mark>ï¼Œç¡®ä¿æ¶ˆæ¯æœªæ¶ˆè´¹å‰åœ¨é˜Ÿåˆ—ä¸­ä¸ä¼šä¸¢å¤±ï¼Œå…¶ä¸­çš„<strong>äº¤æ¢æœºã€é˜Ÿåˆ—ã€å’Œæ¶ˆæ¯éƒ½è¦åšæŒä¹…åŒ–</strong></p><p>äº¤æ¢æœºæŒä¹…åŒ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">orderExchange</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(ORDER_EXCHANGE, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>é˜Ÿåˆ—æŒä¹…åŒ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">orderQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; args = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        args.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, DEAD_EXCHANGE);  <span class="comment">// é˜Ÿåˆ—æ¶ˆæ¯è¿‡æœŸåå‘é€çš„äº¤æ¢å™¨</span></span><br><span class="line">        args.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>, DEAD_ROUTING_KEY); <span class="comment">// é˜Ÿåˆ—æ¶ˆæ¯è¿‡æœŸåå‘é€çš„è·¯ç”±é”®</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(ORDER_QUEUE, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, args);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ¶ˆæ¯æŒä¹…åŒ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rabbitTemplate.convertAndSend(</span><br><span class="line">                ORDER_EXCHANGE,</span><br><span class="line">                ORDER_ROUTING_KEY,</span><br><span class="line">                order.getId(),</span><br><span class="line">                message -&gt; &#123;</span><br><span class="line">                    message.getMessageProperties().setExpiration(String.valueOf(<span class="number">15</span> * <span class="number">60</span> * <span class="number">1000</span>));<span class="comment">// 15åˆ†é’Ÿ</span></span><br><span class="line">                    message.getMessageProperties().setDeliveryMode(MessageDeliveryMode.PERSISTENT);<span class="comment">// æŒä¹…åŒ–æ¶ˆæ¯</span></span><br><span class="line">                    <span class="keyword">return</span> message;</span><br><span class="line">                &#125;</span><br><span class="line">        )</span><br></pre></td></tr></table></figure><h2 id="æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶"><a href="#æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶" class="headerlink" title="æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶"></a>æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶</h2><p>ç¬¬ä¸‰ä¸ªæ˜¯å¼€å¯<mark>æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶</mark>ï¼Œæ¶ˆæ¯å¤„ç†æˆåŠŸåå®Œæˆackï¼Œå½“ç„¶ä¹Ÿéœ€è¦è®¾ç½®ä¸€å®šçš„é‡è¯•æ¬¡æ•°ï¼Œæˆ‘ä»¬å½“æ—¶è®¾ç½®äº†3æ¬¡ï¼Œå¦‚æœé‡è¯•3æ¬¡è¿˜æ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯ï¼Œå°±å°†å¤±è´¥åçš„æ¶ˆæ¯æŠ•é€’åˆ°å¼‚å¸¸äº¤æ¢æœºï¼Œäº¤ç”±äººå·¥å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitMQListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OrderMapper orderMapper;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç›‘å¬æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = DEAD_QUEUE)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDeadQueue</span><span class="params">(Message message, Channel channel)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.selectOneById(msg);</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;103000&quot;</span>.equals(order.getStatus())) &#123;</span><br><span class="line">                UpdateChain.of(Order.class)</span><br><span class="line">                        .set(ORDER.STATUS, <span class="string">&quot;103020&quot;</span>)</span><br><span class="line">                        .where(ORDER.ID.eq(order.getId()))</span><br><span class="line">                        .update();</span><br><span class="line">                log.info(<span class="string">&quot;è®¢å•&#123;&#125;å·²å–æ¶ˆ&quot;</span>, msg);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯</span></span><br><span class="line">            channel.basicAck(message.getMessageProperties().getDeliveryTag(), <span class="literal">false</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// è·å–é‡è¯•æ¬¡æ•°</span></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">retryCount</span> <span class="operator">=</span> (Integer) message.getMessageProperties().getHeaders().get(<span class="string">&quot;x-retry-count&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (retryCount == <span class="literal">null</span>) &#123;</span><br><span class="line">                retryCount = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (retryCount &lt; MAX_RETRY_COUNT) &#123;</span><br><span class="line">                <span class="comment">// é‡è¯•æ¬¡æ•°åŠ 1</span></span><br><span class="line">                retryCount++;</span><br><span class="line">                message.getMessageProperties().getHeaders().put(<span class="string">&quot;x-retry-count&quot;</span>, retryCount);</span><br><span class="line">                <span class="comment">// å¦è®¤æ¶ˆæ¯ï¼Œå¹¶é‡æ–°å…¥é˜Ÿ</span></span><br><span class="line">                channel.basicNack(message.getMessageProperties().getDeliveryTag(), <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// é‡è¯•æ¬¡æ•°è¾¾åˆ°æœ€å¤§å€¼ï¼Œå°†æ¶ˆæ¯æŠ•é€’åˆ°å¼‚å¸¸äº¤æ¢æœº</span></span><br><span class="line">                Map&lt;String, Object&gt; headers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(message.getMessageProperties().getHeaders());</span><br><span class="line">                headers.put(<span class="string">&quot;x-original-routingKey&quot;</span>, message.getMessageProperties().getReceivedRoutingKey());</span><br><span class="line">                rabbitTemplate.convertAndSend(EXCEPTION_EXCHANGE, EXCEPTION_ROUTING_KEY, message.getBody(), m -&gt; &#123;</span><br><span class="line">                    m.getMessageProperties().getHeaders().putAll(headers);</span><br><span class="line">                    <span class="keyword">return</span> m;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// æ‹’ç»æ¶ˆæ¯ï¼Œä¸é‡æ–°å…¥é˜Ÿ</span></span><br><span class="line">                channel.basicReject(message.getMessageProperties().getDeliveryTag(), <span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç›‘å¬å¼‚å¸¸é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = EXCEPTION_QUEUE)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenExceptionQueue</span><span class="params">(Message message)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody());</span><br><span class="line">        <span class="comment">// è®°å½•æ—¥å¿—ï¼Œå‘é€é‚®ä»¶é€šçŸ¥</span></span><br><span class="line">        log.error(<span class="string">&quot;å¤„ç†å¼‚å¸¸æ¶ˆæ¯: &#123;&#125;&quot;</span>, msg);</span><br><span class="line">        <span class="comment">// é‚®ä»¶é€šçŸ¥</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            MailUtil.sendEmail(ADMIN_EMAIL, <span class="string">&quot;å¼‚å¸¸æ¶ˆæ¯&quot;</span>, msg);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BaseUnCheckedException</span>(<span class="string">&quot;å‘é€å¼‚å¸¸é‚®ä»¶å¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="RabbitMQæ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹é—®é¢˜å¦‚ä½•è§£å†³çš„"><a href="#RabbitMQæ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹é—®é¢˜å¦‚ä½•è§£å†³çš„" class="headerlink" title="RabbitMQæ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹é—®é¢˜å¦‚ä½•è§£å†³çš„"></a>RabbitMQæ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹é—®é¢˜å¦‚ä½•è§£å†³çš„</h1><p>å—¯ï¼Œè¿™ä¸ªæˆ‘ä»¬è¿˜çœŸé‡åˆ°è¿‡ï¼Œæ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬å½“æ—¶æ¶ˆè´¹è€…æ˜¯è®¾ç½®äº†è‡ªåŠ¨ç¡®è®¤æœºåˆ¶ï¼Œå½“æœåŠ¡è¿˜æ²¡æ¥å¾—åŠç»™MQç¡®è®¤çš„æ—¶å€™ï¼ŒæœåŠ¡å®•æœºäº†ï¼Œå¯¼è‡´æœåŠ¡é‡å¯ä¹‹åï¼Œåˆæ¶ˆè´¹äº†ä¸€æ¬¡æ¶ˆæ¯ã€‚è¿™æ ·å°±é‡å¤æ¶ˆè´¹äº†</p><p>å› ä¸ºæˆ‘ä»¬å½“æ—¶å¤„ç†çš„æ”¯ä»˜ï¼ˆè®¢å•|ä¸šåŠ¡å”¯ä¸€æ ‡è¯†ï¼‰ï¼Œå®ƒæœ‰ä¸€ä¸ªä¸šåŠ¡çš„å”¯ä¸€æ ‡è¯†ï¼Œæˆ‘ä»¬å†å¤„ç†æ¶ˆæ¯æ—¶ï¼Œå…ˆåˆ°æ•°æ®åº“æŸ¥è¯¢ä¸€ä¸‹ï¼Œè¿™ä¸ªæ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œè¯´æ˜æ²¡æœ‰å¤„ç†è¿‡ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥æ­£å¸¸å¤„ç†è¿™ä¸ªæ¶ˆæ¯äº†ã€‚å¦‚æœå·²ç»å­˜åœ¨è¿™ä¸ªæ•°æ®äº†ï¼Œå°±è¯´æ˜æ¶ˆæ¯é‡å¤æ¶ˆè´¹äº†ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦å†æ¶ˆè´¹äº†<mark><strong>ï¼ˆåœ¨ä¸šåŠ¡ä¸Šè§£å†³ï¼‰</strong></mark></p><p><strong>é¢è¯•å®˜</strong>ï¼šé‚£ä½ è¿˜çŸ¥é“å…¶ä»–çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>å…¶å®è¿™ä¸ªå°±æ˜¯å…¸å‹çš„<mark><strong>å¹‚ç­‰</strong></mark>çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼Œredisåˆ†å¸ƒå¼é”ã€æ•°æ®åº“çš„é”éƒ½æ˜¯å¯ä»¥çš„</p><h1 id="RabbitMQä¸­æ­»ä¿¡äº¤æ¢æœº-ï¼ˆRabbitMQå»¶è¿Ÿé˜Ÿåˆ—æœ‰äº†è§£è¿‡å˜›ï¼‰"><a href="#RabbitMQä¸­æ­»ä¿¡äº¤æ¢æœº-ï¼ˆRabbitMQå»¶è¿Ÿé˜Ÿåˆ—æœ‰äº†è§£è¿‡å˜›ï¼‰" class="headerlink" title="RabbitMQä¸­æ­»ä¿¡äº¤æ¢æœº ? ï¼ˆRabbitMQå»¶è¿Ÿé˜Ÿåˆ—æœ‰äº†è§£è¿‡å˜›ï¼‰"></a>RabbitMQä¸­æ­»ä¿¡äº¤æ¢æœº ? ï¼ˆRabbitMQå»¶è¿Ÿé˜Ÿåˆ—æœ‰äº†è§£è¿‡å˜›ï¼‰</h1><p>æˆ‘ä»¬å½“æ—¶çš„xxé¡¹ç›®æœ‰ä¸€ä¸ªxxä¸šåŠ¡ï¼Œéœ€è¦ç”¨åˆ°å»¶è¿Ÿé˜Ÿåˆ—ï¼Œå…¶ä¸­å°±æ˜¯ä½¿ç”¨RabbitMQæ¥å®ç°çš„ã€‚</p><p>å»¶è¿Ÿé˜Ÿåˆ—å°±æ˜¯ç”¨åˆ°äº†æ­»ä¿¡äº¤æ¢æœºå’ŒTTLï¼ˆæ¶ˆæ¯å­˜æ´»æ—¶é—´ï¼‰å®ç°çš„ã€‚</p><p>å¦‚æœæ¶ˆæ¯è¶…æ—¶æœªæ¶ˆè´¹å°±ä¼šå˜æˆæ­»ä¿¡ï¼Œåœ¨RabbitMQä¸­å¦‚æœæ¶ˆæ¯æˆä¸ºæ­»ä¿¡ï¼Œé˜Ÿåˆ—å¯ä»¥ç»‘å®šä¸€ä¸ªæ­»ä¿¡äº¤æ¢æœºï¼Œåœ¨æ­»ä¿¡äº¤æ¢æœºä¸Šå¯ä»¥ç»‘å®šå…¶ä»–é˜Ÿåˆ—ï¼Œåœ¨æˆ‘ä»¬å‘æ¶ˆæ¯çš„æ—¶å€™å¯ä»¥æŒ‰ç…§éœ€æ±‚æŒ‡å®šTTLçš„æ—¶é—´ï¼Œè¿™æ ·å°±å®ç°äº†å»¶è¿Ÿé˜Ÿåˆ—çš„åŠŸèƒ½äº†ã€‚</p><p>æˆ‘è®°å¾—RabbitMQè¿˜æœ‰ä¸€ç§æ–¹å¼å¯ä»¥å®ç°å»¶è¿Ÿé˜Ÿåˆ—ï¼Œåœ¨RabbitMQä¸­å®‰è£…ä¸€ä¸ªæ­»ä¿¡æ’ä»¶ï¼Œè¿™æ ·æ›´æ–¹ä¾¿ä¸€äº›ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å£°æ˜äº¤äº’æœºçš„æ—¶å€™ï¼ŒæŒ‡å®šè¿™ä¸ªå°±æ˜¯æ­»ä¿¡äº¤æ¢æœºï¼Œç„¶ååœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™ç›´æ¥æŒ‡å®šè¶…æ—¶æ—¶é—´å°±è¡Œäº†ï¼Œç›¸å¯¹äºæ­»ä¿¡äº¤æ¢æœº+TTLè¦çœç•¥äº†ä¸€äº›æ­¥éª¤</p><p><strong>é¢è¯•å®˜</strong>ï¼šå¦‚æœæœ‰100ä¸‡æ¶ˆæ¯å †ç§¯åœ¨MQ , å¦‚ä½•è§£å†³ ?</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>æˆ‘åœ¨å®é™…çš„å¼€å‘ä¸­ï¼Œæ²¡é‡åˆ°è¿‡è¿™ç§æƒ…å†µï¼Œä¸è¿‡ï¼Œå¦‚æœå‘ç”Ÿäº†å †ç§¯çš„é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆä¹Ÿæ‰€æœ‰å¾ˆå¤šçš„</p><p>ç¬¬ä¸€ï¼šæé«˜æ¶ˆè´¹è€…çš„æ¶ˆè´¹èƒ½åŠ› ,å¯ä»¥ä½¿ç”¨<strong>å¤šçº¿ç¨‹æ¶ˆè´¹ä»»åŠ¡</strong></p><p>ç¬¬äºŒï¼š<strong>å¢åŠ æ›´å¤šæ¶ˆè´¹è€…ï¼Œæé«˜æ¶ˆè´¹é€Ÿåº¦</strong> </p><p>â€‹ ä½¿ç”¨å·¥ä½œé˜Ÿåˆ—æ¨¡å¼, è®¾ç½®å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆè´¹åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</p><p>ç¬¬ä¸‰ï¼š<strong>æ‰©å¤§é˜Ÿåˆ—å®¹ç§¯ï¼Œæé«˜å †ç§¯ä¸Šé™</strong> </p><p>å¯ä»¥ä½¿ç”¨RabbitMQæƒ°æ€§é˜Ÿåˆ—ï¼Œæƒ°æ€§é˜Ÿåˆ—çš„å¥½å¤„ä¸»è¦æ˜¯</p><p>â‘ æ¥æ”¶åˆ°æ¶ˆæ¯åç›´æ¥å­˜å…¥ç£ç›˜è€Œéå†…å­˜</p><p>â‘¡æ¶ˆè´¹è€…è¦æ¶ˆè´¹æ¶ˆæ¯æ—¶æ‰ä¼šä»ç£ç›˜ä¸­è¯»å–å¹¶åŠ è½½åˆ°å†…å­˜</p><p>â‘¢æ”¯æŒæ•°ç™¾ä¸‡æ¡çš„æ¶ˆæ¯å­˜å‚¨</p><h1 id="RabbitMQçš„é«˜å¯ç”¨æœºåˆ¶æœ‰äº†è§£è¿‡å˜›"><a href="#RabbitMQçš„é«˜å¯ç”¨æœºåˆ¶æœ‰äº†è§£è¿‡å˜›" class="headerlink" title="RabbitMQçš„é«˜å¯ç”¨æœºåˆ¶æœ‰äº†è§£è¿‡å˜›"></a>RabbitMQçš„é«˜å¯ç”¨æœºåˆ¶æœ‰äº†è§£è¿‡å˜›</h1><p>æˆ‘ä»¬å½“æ—¶é¡¹ç›®åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨çš„é›†ç¾¤ï¼Œå½“æ—¶æ­å»ºæ˜¯é•œåƒæ¨¡å¼é›†ç¾¤ï¼Œä½¿ç”¨äº†3å°æœºå™¨ã€‚</p><p>é•œåƒé˜Ÿåˆ—ç»“æ„æ˜¯ä¸€ä¸»å¤šä»ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯ä¸»èŠ‚ç‚¹å®Œæˆï¼Œç„¶ååŒæ­¥ç»™é•œåƒèŠ‚ç‚¹ï¼Œå¦‚æœä¸»èŠ‚ç‚¹å®•æœºåï¼Œé•œåƒèŠ‚ç‚¹ä¼šæ›¿ä»£æˆæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œä¸è¿‡åœ¨ä¸»ä»åŒæ­¥å®Œæˆå‰ï¼Œä¸»èŠ‚ç‚¹å°±å·²ç»å®•æœºï¼Œå¯èƒ½å‡ºç°æ•°æ®ä¸¢å¤±</p><p><strong>é¢è¯•å®˜</strong>ï¼šé‚£å‡ºç°ä¸¢æ•°æ®æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p><p><strong>å€™é€‰äºº</strong>ï¼š</p><p>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä»²è£é˜Ÿåˆ—ï¼Œä¸é•œåƒé˜Ÿåˆ—ä¸€æ ·ï¼Œéƒ½æ˜¯ä¸»ä»æ¨¡å¼ï¼Œæ”¯æŒä¸»ä»æ•°æ®åŒæ­¥ï¼Œä¸»ä»åŒæ­¥åŸºäºRaftåè®®ï¼Œå¼ºä¸€è‡´ã€‚</p><p>å¹¶ä¸”ä½¿ç”¨èµ·æ¥ä¹Ÿéå¸¸ç®€å•ï¼Œä¸éœ€è¦é¢å¤–çš„é…ç½®ï¼Œåœ¨å£°æ˜é˜Ÿåˆ—çš„æ—¶å€™åªè¦æŒ‡å®šè¿™ä¸ªæ˜¯ä»²è£é˜Ÿåˆ—å³å¯</p><h1 id="RocketMQ"><a href="#RocketMQ" class="headerlink" title="RocketMQ"></a>RocketMQ</h1><p><a href="https://www.bilibili.com/video/BV1GY4y1F7og/?spm_id_from=333.999.0.0&vd_source=fa7ba4ae353f08f1d08d1bb24528e96c">https://www.bilibili.com/video/BV1GY4y1F7og/?spm_id_from=333.999.0.0&amp;vd_source=fa7ba4ae353f08f1d08d1bb24528e96c</a></p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘ç»œç¼–ç¨‹+å¤šçº¿ç¨‹+IO</title>
      <link href="/2023/11/11/Study-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B+%E5%A4%9A%E7%BA%BF%E7%A8%8B+IO/"/>
      <url>/2023/11/11/Study-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B+%E5%A4%9A%E7%BA%BF%E7%A8%8B+IO/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æœ¬ç¯‡æ–‡ç« å­¦ä¹ è‡ªï¼š<a href="https://www.bilibili.com/video/BV1j54y1b7qv">https://www.bilibili.com/video/BV1j54y1b7qv</a></p>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é›¶ç¢é¢è¯•é¢˜</title>
      <link href="/2023/10/13/%E9%9D%A2%E8%AF%95-%E9%9B%B6%E7%A2%8E%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
      <url>/2023/10/13/%E9%9D%A2%E8%AF%95-%E9%9B%B6%E7%A2%8E%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="JavaåŸºç¡€"><a href="#JavaåŸºç¡€" class="headerlink" title="JavaåŸºç¡€"></a>JavaåŸºç¡€</h1><h2 id="finallyè¯­å¥å—ä»€ä¹ˆæ—¶å€™ä¸ä¼šæ‰§è¡Œ"><a href="#finallyè¯­å¥å—ä»€ä¹ˆæ—¶å€™ä¸ä¼šæ‰§è¡Œ" class="headerlink" title="finallyè¯­å¥å—ä»€ä¹ˆæ—¶å€™ä¸ä¼šæ‰§è¡Œ"></a>finallyè¯­å¥å—ä»€ä¹ˆæ—¶å€™ä¸ä¼šæ‰§è¡Œ</h2><p>finallyè¯­å¥å—åœ¨ä¸¤ç§æƒ…å†µä¸‹ä¸ä¼šæ‰§è¡Œ:</p><ol><li><p>ç¨‹åºæ²¡æœ‰è¿›å…¥åˆ°tryè¯­å¥å—å› ä¸ºå¼‚å¸¸å¯¼è‡´ç¨‹åºç»ˆæ­¢,è¿™ä¸ªé—®é¢˜ä¸»è¦æ˜¯å¼€å‘äººå‘˜åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™,å¼‚å¸¸æ•è·çš„èŒƒå›´ä¸å¤Ÿ</p></li><li><p>åœ¨tryæˆ–è€…cacheè¯­å¥å—ä¸­,æ‰§è¡Œäº†System.exit(0)è¯­å¥,å¯¼è‡´JVMç›´æ¥é€€å‡º</p></li><li><p>ç¨‹åºæ‰€åœ¨çš„çº¿ç¨‹æ­»äº¡ã€‚</p></li><li><p>å…³é—­ CPUã€‚</p></li></ol><h2 id="â­â­â­åŠ¨æ€ä»£ç†"><a href="#â­â­â­åŠ¨æ€ä»£ç†" class="headerlink" title="â­â­â­åŠ¨æ€ä»£ç†"></a>â­â­â­åŠ¨æ€ä»£ç†</h2><ul><li><strong>JDKåŠ¨æ€ä»£ç†</strong>ï¼šåªé€‚ç”¨äºæ¥å£ï¼Œä»£ç†ç±»<mark>å®ç°äº†ç›®æ ‡å¯¹è±¡çš„æ¥å£</mark>ï¼Œå¹¶åœ¨æ–¹æ³•è°ƒç”¨æ—¶æ·»åŠ é¢å¤–çš„åŠŸèƒ½ï¼ˆä¾‹å¦‚äº‹åŠ¡ç®¡ç†ï¼‰ã€‚</li><li><strong>CGLIBä»£ç†</strong>ï¼šåŸºäºå­ç±»çš„åŠ¨æ€ä»£ç†ï¼Œé€‚ç”¨äºç±»ã€‚CGLIBé€šè¿‡<mark>åˆ›å»ºç›®æ ‡ç±»çš„å­ç±»å¹¶è¦†ç›–å…¶ä¸­çš„æ–¹æ³•</mark>æ¥æ·»åŠ é¢å¤–çš„åŠŸèƒ½ã€‚</li></ul><p><strong>ä»£ç†æ¨¡å¼åœ¨è½¯ä»¶å¼€å‘ä¸­æ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œç”¨äºåœ¨ä¸æ”¹å˜ç›®æ ‡å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡ä»£ç†å¯¹è±¡æ¥æ§åˆ¶å¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®ã€‚ä»£ç†æ¨¡å¼å¯ä»¥åˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ï¼Œå®ƒä»¬ä¹‹é—´æœ‰ä¸€äº›æ˜¾è‘—çš„åŒºåˆ«ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„è§£é‡Šï¼š</strong></p><h3 id="1-é™æ€ä»£ç†"><a href="#1-é™æ€ä»£ç†" class="headerlink" title="1. é™æ€ä»£ç†"></a>1. é™æ€ä»£ç†</h3><p><strong>å®šä¹‰</strong>ï¼šé™æ€ä»£ç†æ˜¯åœ¨ç¼–è¯‘æ—¶ç”±ç¨‹åºå‘˜æ‰‹åŠ¨ç¼–å†™æˆ–è€…é€šè¿‡å·¥å…·ç”Ÿæˆä»£ç†ç±»ã€‚ä»£ç†ç±»åœ¨ç¼–è¯‘æ—¶å·²ç»ç¡®å®šï¼Œä¸ä¼šåœ¨è¿è¡Œæ—¶å˜åŒ–ã€‚</p><p><strong>å®ç°æ–¹å¼</strong>ï¼šåœ¨é™æ€ä»£ç†ä¸­ï¼Œä»£ç†ç±»å’Œç›®æ ‡ç±»éƒ½å®ç°ç›¸åŒçš„æ¥å£ï¼Œä»£ç†ç±»æŒæœ‰ä¸€ä¸ªç›®æ ‡å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶åœ¨ä»£ç†ç±»çš„æ–¹æ³•ä¸­è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>ç®€å•æ˜äº†ï¼Œæ˜“äºç†è§£å’Œå®ç°ã€‚</li><li>å¯ä»¥åœ¨ç¼–è¯‘æ—¶æ£€æŸ¥ç±»å‹å®‰å…¨ã€‚</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>ä»£ç é‡å¤§ï¼Œç›®æ ‡ç±»æ¯æ–°å¢ä¸€ä¸ªæ–¹æ³•ï¼Œä»£ç†ç±»éƒ½éœ€è¦è¿›è¡Œç›¸åº”çš„ä¿®æ”¹ã€‚</li><li>ä¸å¤Ÿçµæ´»ï¼Œä»£ç†ç±»å’Œç›®æ ‡ç±»ä¹‹é—´çš„è€¦åˆåº¦è¾ƒé«˜ã€‚</li></ul><p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›®æ ‡ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Doing something...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»£ç†ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServiceProxy</span> <span class="keyword">implements</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> MyServiceImpl target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyServiceProxy</span><span class="params">(MyServiceImpl target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before doing something...&quot;</span>);</span><br><span class="line">        target.doSomething();</span><br><span class="line">        System.out.println(<span class="string">&quot;After doing something...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyServiceImpl</span> <span class="variable">target</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyServiceImpl</span>();</span><br><span class="line">        <span class="type">MyService</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyServiceProxy</span>(target);</span><br><span class="line">        proxy.doSomething();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-åŠ¨æ€ä»£ç†"><a href="#2-åŠ¨æ€ä»£ç†" class="headerlink" title="2. åŠ¨æ€ä»£ç†"></a>2. åŠ¨æ€ä»£ç†</h3><p><strong>å®šä¹‰</strong>ï¼šåŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡åå°„æœºåˆ¶åŠ¨æ€ç”Ÿæˆä»£ç†ç±»ã€‚Javaä¸­ä¸»è¦æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼šJDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†ã€‚</p><p><strong>å®ç°æ–¹å¼</strong>ï¼š</p><ul><li><strong>JDKåŠ¨æ€ä»£ç†</strong>ï¼šé€šè¿‡<code>java.lang.reflect.Proxy</code>ç±»å’Œ<code>InvocationHandler</code>æ¥å£å®ç°ã€‚åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»ã€‚</li><li><strong>CGLIBåŠ¨æ€ä»£ç†</strong>ï¼šé€šè¿‡ç»§æ‰¿ç›®æ ‡ç±»æ¥ç”Ÿæˆå­ç±»è¿›è¡Œä»£ç†ã€‚å¯ä»¥ä»£ç†æ²¡æœ‰å®ç°æ¥å£çš„ç±»ã€‚</li></ul><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>çµæ´»æ€§é«˜ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†ç±»ã€‚</li><li>ä»£ç å¤ç”¨æ€§é«˜ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªé€šç”¨çš„ä»£ç†ç±»æ¥ä»£ç†å¤šä¸ªç›®æ ‡ç±»ã€‚</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>æ€§èƒ½ç¨ä½äºé™æ€ä»£ç†ï¼Œå› ä¸ºæ¶‰åŠåˆ°åå°„æœºåˆ¶ã€‚</li><li>è°ƒè¯•å’Œæ’é”™ç›¸å¯¹å›°éš¾ã€‚</li></ul><p><strong>JDKåŠ¨æ€ä»£ç†ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›®æ ‡ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Doing something...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ¨æ€ä»£ç†ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggingInvocationHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoggingInvocationHandler</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before doing something...&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(target, args);</span><br><span class="line">        System.out.println(<span class="string">&quot;After doing something...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyService</span> <span class="variable">target</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyServiceImpl</span>();</span><br><span class="line">        <span class="type">MyService</span> <span class="variable">proxy</span> <span class="operator">=</span> (MyService) Proxy.newProxyInstance(</span><br><span class="line">                target.getClass().getClassLoader(),</span><br><span class="line">                target.getClass().getInterfaces(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">LoggingInvocationHandler</span>(target)</span><br><span class="line">        );</span><br><span class="line">        proxy.doSomething();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>CGLIBåŠ¨æ€ä»£ç†ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.Enhancer;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodProxy;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›®æ ‡ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Doing something...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ¨æ€ä»£ç†ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggingMethodInterceptor</span> <span class="keyword">implements</span> <span class="title class_">MethodInterceptor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoggingMethodInterceptor</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object obj, Method method, Object[] args, MethodProxy proxy)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before doing something...&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> proxy.invoke(target, args);</span><br><span class="line">        System.out.println(<span class="string">&quot;After doing something...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyService</span> <span class="variable">target</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyService</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Enhancer</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line">        enhancer.setSuperclass(MyService.class);</span><br><span class="line">        enhancer.setCallback(<span class="keyword">new</span> <span class="title class_">LoggingMethodInterceptor</span>(target));</span><br><span class="line"></span><br><span class="line">        <span class="type">MyService</span> <span class="variable">proxy</span> <span class="operator">=</span> (MyService) enhancer.create();</span><br><span class="line">        proxy.doSomething();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li><strong>é™æ€ä»£ç†</strong>ï¼šåœ¨ç¼–è¯‘æ—¶åˆ›å»ºä»£ç†ç±»ï¼Œä¼˜ç‚¹æ˜¯ç®€å•æ˜“æ‡‚ï¼Œç¼ºç‚¹æ˜¯çµæ´»æ€§å·®ã€ä»£ç é‡å¤§ã€‚</li><li><strong>åŠ¨æ€ä»£ç†</strong>ï¼šåœ¨è¿è¡Œæ—¶åˆ›å»ºä»£ç†ç±»ï¼Œä¼˜ç‚¹æ˜¯çµæ´»æ€§é«˜ã€ä»£ç å¤ç”¨æ€§å¥½ï¼Œç¼ºç‚¹æ˜¯æ€§èƒ½ç¨å·®ã€è°ƒè¯•å›°éš¾ã€‚</li></ul><p>æ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯é€‰æ‹©åˆé€‚çš„ä»£ç†æ¨¡å¼ï¼Œå¯ä»¥åœ¨ä¿è¯ä»£ç ç®€æ´æ€§çš„åŒæ—¶ï¼Œå®ç°çµæ´»çš„åŠŸèƒ½æ‰©å±•ã€‚</p><h2 id="æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆå…±åŒç‚¹å’ŒåŒºåˆ«ï¼Ÿ"><a href="#æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆå…±åŒç‚¹å’ŒåŒºåˆ«ï¼Ÿ" class="headerlink" title="æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆå…±åŒç‚¹å’ŒåŒºåˆ«ï¼Ÿ"></a>æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆå…±åŒç‚¹å’ŒåŒºåˆ«ï¼Ÿ</h2><p><strong>å…±åŒç‚¹</strong>ï¼š</p><ul><li>éƒ½ä¸èƒ½è¢«å®ä¾‹åŒ–ã€‚</li><li>éƒ½å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•ã€‚</li><li>éƒ½å¯ä»¥æœ‰é»˜è®¤å®ç°çš„æ–¹æ³•ï¼ˆJava 8 å¯ä»¥ç”¨ <code>default</code> å…³é”®å­—åœ¨æ¥å£ä¸­å®šä¹‰é»˜è®¤æ–¹æ³•ï¼‰ã€‚</li></ul><p><strong>åŒºåˆ«</strong>ï¼š</p><ul><li><strong>æ¥å£ä¸»è¦ç”¨äºå¯¹ç±»çš„è¡Œä¸ºè¿›è¡Œçº¦æŸ</strong>ï¼Œä½ å®ç°äº†æŸä¸ªæ¥å£å°±å…·æœ‰äº†å¯¹åº”çš„è¡Œä¸ºã€‚<strong>æŠ½è±¡ç±»ä¸»è¦ç”¨äºä»£ç å¤ç”¨</strong>ï¼Œå¼ºè°ƒçš„æ˜¯æ‰€å±å…³ç³»ã€‚</li><li><mark>ä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œä½†æ˜¯å¯ä»¥å®ç°å¤šä¸ªæ¥å£ã€‚</mark></li><li><strong>æ¥å£ä¸­çš„æˆå‘˜å˜é‡</strong>åªèƒ½æ˜¯ <code>public static final</code> ç±»å‹çš„ï¼Œ<strong>ä¸èƒ½è¢«ä¿®æ”¹ä¸”å¿…é¡»æœ‰åˆå§‹å€¼</strong>ï¼Œè€Œ<strong>æŠ½è±¡ç±»çš„æˆå‘˜å˜é‡</strong>é»˜è®¤ defaultï¼Œ<strong>å¯åœ¨å­ç±»ä¸­è¢«é‡æ–°å®šä¹‰ï¼Œä¹Ÿå¯è¢«é‡æ–°èµ‹å€¼ã€‚</strong></li></ul><h2 id="æ·±æ‹·è´ï¼Œæµ…æ‹·è´ï¼Œå¼•ç”¨æ‹·è´"><a href="#æ·±æ‹·è´ï¼Œæµ…æ‹·è´ï¼Œå¼•ç”¨æ‹·è´" class="headerlink" title="æ·±æ‹·è´ï¼Œæµ…æ‹·è´ï¼Œå¼•ç”¨æ‹·è´"></a>æ·±æ‹·è´ï¼Œæµ…æ‹·è´ï¼Œå¼•ç”¨æ‹·è´</h2><p><strong>æµ…æ‹·è´</strong>ï¼šæµ…æ‹·è´ä¼šåœ¨å †ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ˆåŒºåˆ«äºå¼•ç”¨æ‹·è´çš„ä¸€ç‚¹ï¼‰ï¼Œä¸è¿‡ï¼Œå¦‚æœåŸå¯¹è±¡å†…éƒ¨çš„å±æ€§æ˜¯å¼•ç”¨ç±»å‹çš„è¯ï¼Œæµ…æ‹·è´ä¼šç›´æ¥å¤åˆ¶å†…éƒ¨å¯¹è±¡çš„å¼•ç”¨åœ°å€ï¼Œä¹Ÿå°±æ˜¯è¯´æ‹·è´å¯¹è±¡å’ŒåŸå¯¹è±¡å…±ç”¨åŒä¸€ä¸ªå†…éƒ¨å¯¹è±¡ã€‚</p><p><strong>æ·±æ‹·è´</strong>ï¼šæ·±æ‹·è´ä¼šå®Œå…¨å¤åˆ¶æ•´ä¸ªå¯¹è±¡ï¼ŒåŒ…æ‹¬è¿™ä¸ªå¯¹è±¡æ‰€åŒ…å«çš„å†…éƒ¨å¯¹è±¡ã€‚</p><p><strong>å¼•ç”¨æ‹·è´ï¼š</strong> å¼•ç”¨æ‹·è´å°±æ˜¯ä¸¤ä¸ªä¸åŒçš„å¼•ç”¨æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚</p><p><img src="/../assets/%E9%9D%A2%E8%AF%95-%E9%9B%B6%E7%A2%8E%E9%9D%A2%E8%AF%95%E9%A2%98/image-20240527104630529.png" alt="æµ…æ‹·è´ã€æ·±æ‹·è´ã€å¼•ç”¨æ‹·è´ç¤ºæ„å›¾"></p><h2 id="ä¸ºä»€ä¹ˆéœ€è¦åŒæ—¶é‡å†™hashCodeå’Œequals"><a href="#ä¸ºä»€ä¹ˆéœ€è¦åŒæ—¶é‡å†™hashCodeå’Œequals" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦åŒæ—¶é‡å†™hashCodeå’Œequals"></a>ä¸ºä»€ä¹ˆéœ€è¦åŒæ—¶é‡å†™hashCodeå’Œequals</h2><p>å½“ä½ åœ¨é›†åˆå¦‚<code>HashMap</code>ã€<code>HashSet</code>æˆ–<code>Hashtable</code>ä¸­å­˜å‚¨å¯¹è±¡æ—¶ï¼Œè¿™äº›é›†åˆä½¿ç”¨å“ˆå¸Œè¡¨æ¥å­˜å‚¨å…ƒç´ ã€‚å“ˆå¸Œè¡¨åŸºäºå“ˆå¸Œç æ¥å¿«é€Ÿå­˜å‚¨å’Œæ£€ç´¢å…ƒç´ ã€‚å¦‚æœåªé‡å†™äº†<code>equals</code>æ–¹æ³•è€Œæ²¡æœ‰é‡å†™<code>hashCode</code>æ–¹æ³•ï¼Œä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li><strong>è¿å<code>hashCode</code>å’Œ<code>equals</code>çš„åˆåŒ</strong>ï¼š<ul><li>æ ¹æ®Javaè§„èŒƒï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡æ ¹æ®<code>equals</code>æ–¹æ³•æ¯”è¾ƒæ˜¯ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆå®ƒä»¬çš„<code>hashCode</code>ä¹Ÿå¿…é¡»ç›¸ç­‰ã€‚</li><li>å¦‚æœåªé‡å†™<code>equals</code>æ–¹æ³•ä½†ä¸é‡å†™<code>hashCode</code>æ–¹æ³•ï¼Œåˆ™ä¸¤ä¸ªå¯¹è±¡å³ä½¿åœ¨é€»è¾‘ä¸Šæ˜¯ç›¸ç­‰çš„ï¼ˆ<code>equals</code>è¿”å›trueï¼‰ï¼Œå®ƒä»¬çš„å“ˆå¸Œç ä¹Ÿå¯èƒ½ä¸åŒã€‚è¿™ä¼šè¿ååˆåŒï¼Œå¯¼è‡´é›†åˆè¡Œä¸ºå¼‚å¸¸ã€‚</li></ul></li><li><strong>é›†åˆæ“ä½œçš„æ­£ç¡®æ€§</strong>ï¼š<ul><li><strong>æ’å…¥æ“ä½œ</strong>ï¼šå½“ä½ å¾€<code>HashSet</code>æˆ–<code>HashMap</code>ä¸­æ’å…¥ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œé›†åˆä¼šå…ˆè°ƒç”¨å¯¹è±¡çš„<code>hashCode</code>æ–¹æ³•æ¥æ‰¾åˆ°å­˜å‚¨æ¡¶ä½ç½®ï¼Œç„¶ååœ¨è¯¥ä½ç½®ç”¨<code>equals</code>æ–¹æ³•æ£€æŸ¥å¯¹è±¡æ˜¯å¦å·²ç»å­˜åœ¨ã€‚å¦‚æœ<code>hashCode</code>ä¸ä¸€è‡´ï¼Œç›¸ç­‰çš„å¯¹è±¡å¯èƒ½ä¼šè¢«æ”¾åˆ°ä¸åŒçš„å­˜å‚¨æ¡¶ï¼Œå¯¼è‡´é›†åˆä¸­åŒ…å«é‡å¤çš„å¯¹è±¡ã€‚</li><li><strong>æŸ¥æ‰¾æ“ä½œ</strong>ï¼šç±»ä¼¼åœ°ï¼ŒæŸ¥æ‰¾æ“ä½œï¼ˆå¦‚<code>contains</code>æˆ–<code>get</code>ï¼‰ä¹Ÿä¾èµ–äºå“ˆå¸Œç æ¥å¿«é€Ÿå®šä½å¯¹è±¡ã€‚å¦‚æœ<code>hashCode</code>ä¸ä¸€è‡´ï¼Œå³ä½¿ä¸¤ä¸ªå¯¹è±¡é€šè¿‡<code>equals</code>æ–¹æ³•æ¯”è¾ƒæ˜¯ç›¸ç­‰çš„ï¼ŒæŸ¥æ‰¾æ“ä½œä¹Ÿå¯èƒ½å¤±è´¥ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½åœ¨ä¸åŒçš„å­˜å‚¨æ¡¶ä¸­ã€‚</li></ul></li></ol><h2 id="String-ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„"><a href="#String-ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„" class="headerlink" title="String ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„?"></a>String ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„?</h2><ol><li><p><code>String</code> ç±»ä¸­ä½¿ç”¨ <code>final</code> å…³é”®å­—ä¿®é¥°å­—ç¬¦æ•°ç»„æ¥ä¿å­˜å­—ç¬¦ä¸²ï¼Œä¿å­˜å­—ç¬¦ä¸²çš„æ•°ç»„è¢« <code>final</code> ä¿®é¥°ä¸”ä¸ºç§æœ‰çš„ï¼Œå¹¶ä¸”<code>String</code> ç±»æ²¡æœ‰æä¾›&#x2F;æš´éœ²ä¿®æ”¹è¿™ä¸ªå­—ç¬¦ä¸²çš„æ–¹æ³•ã€‚</p></li><li><p><code>String</code> ç±»è¢« <code>final</code> ä¿®é¥°å¯¼è‡´å…¶ä¸èƒ½è¢«ç»§æ‰¿ï¼Œè¿›è€Œé¿å…äº†å­ç±»ç ´å <code>String</code> ä¸å¯å˜ã€‚</p></li></ol><h2 id="String-s1-new-String-â€œabcâ€-è¿™å¥è¯åˆ›å»ºäº†å‡ ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Ÿ"><a href="#String-s1-new-String-â€œabcâ€-è¿™å¥è¯åˆ›å»ºäº†å‡ ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Ÿ" class="headerlink" title="String s1 &#x3D; new String(â€œabcâ€);è¿™å¥è¯åˆ›å»ºäº†å‡ ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Ÿ"></a>String s1 &#x3D; new String(â€œabcâ€);è¿™å¥è¯åˆ›å»ºäº†å‡ ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Ÿ</h2><p>ä¼šåˆ›å»º 1 æˆ– 2 ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ã€‚</p><ol><li><p>å¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ä¸å­˜åœ¨å­—ç¬¦ä¸²å¯¹è±¡â€œabcâ€çš„å¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒä¼šåœ¨å †ä¸Šåˆ›å»ºä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œå…¶ä¸­ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ä¼šè¢«ä¿å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ã€‚</p></li><li><p>å¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å·²å­˜åœ¨å­—ç¬¦ä¸²å¯¹è±¡â€œabcâ€çš„å¼•ç”¨ï¼Œåˆ™åªä¼šåœ¨å †ä¸­åˆ›å»º 1 ä¸ªå­—ç¬¦ä¸²å¯¹è±¡â€œabcâ€ã€‚</p></li></ol><h2 id="Javaå€¼ä¼ é€’"><a href="#Javaå€¼ä¼ é€’" class="headerlink" title="Javaå€¼ä¼ é€’"></a>Javaå€¼ä¼ é€’</h2><p>Java ä¸­å°†å®å‚ä¼ é€’ç»™æ–¹æ³•ï¼ˆæˆ–å‡½æ•°ï¼‰çš„æ–¹å¼æ˜¯ <strong>å€¼ä¼ é€’</strong>ï¼š</p><ul><li>å¦‚æœå‚æ•°æ˜¯åŸºæœ¬ç±»å‹çš„è¯ï¼Œå¾ˆç®€å•ï¼Œä¼ é€’çš„å°±æ˜¯åŸºæœ¬ç±»å‹çš„å­—é¢é‡å€¼çš„æ‹·è´ï¼Œä¼šåˆ›å»ºå‰¯æœ¬ã€‚</li><li>å¦‚æœå‚æ•°æ˜¯å¼•ç”¨ç±»å‹ï¼Œä¼ é€’çš„å°±æ˜¯å®å‚æ‰€å¼•ç”¨çš„å¯¹è±¡åœ¨å †ä¸­åœ°å€å€¼çš„æ‹·è´ï¼ŒåŒæ ·ä¹Ÿä¼šåˆ›å»ºå‰¯æœ¬ã€‚</li></ul><h2 id="Unsafeç±»"><a href="#Unsafeç±»" class="headerlink" title="Unsafeç±»"></a>Unsafeç±»</h2><p>å¾…è¡¥å……ã€‚ã€‚ã€‚ã€‚ã€‚</p><h2 id="SPI"><a href="#SPI" class="headerlink" title="SPI"></a>SPI</h2><p>å¾…è¡¥å……ã€‚ã€‚ã€‚ã€‚ã€‚</p><h1 id="åœºæ™¯é¢˜"><a href="#åœºæ™¯é¢˜" class="headerlink" title="åœºæ™¯é¢˜"></a>åœºæ™¯é¢˜</h1><h2 id="å•ç‚¹ç™»å½•è¿™å—æ€ä¹ˆå®ç°çš„"><a href="#å•ç‚¹ç™»å½•è¿™å—æ€ä¹ˆå®ç°çš„" class="headerlink" title="å•ç‚¹ç™»å½•è¿™å—æ€ä¹ˆå®ç°çš„"></a>å•ç‚¹ç™»å½•è¿™å—æ€ä¹ˆå®ç°çš„</h2><p>ä½¿ç”¨jwtè§£å†³å•ç‚¹ç™»å½•çš„æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/../assets/%E9%9D%A2%E8%AF%95-%E9%9B%B6%E7%A2%8E%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230521113941467.png" alt="image-20230521113941467"></p><p><strong>å›ç­”è¦ç‚¹ï¼š</strong></p><p>1ï¼Œå…ˆè§£é‡Šä»€ä¹ˆæ˜¯å•ç‚¹ç™»å½•</p><p>å•ç‚¹ç™»å½•çš„è‹±æ–‡åå«åšï¼šSingle Sign Onï¼ˆç®€ç§°<strong>SSO</strong>ï¼‰</p><p>2ï¼Œä»‹ç»è‡ªå·±é¡¹ç›®ä¸­æ¶‰åŠåˆ°çš„å•ç‚¹ç™»å½•</p><p>3ï¼Œä»‹ç»å•ç‚¹ç™»å½•çš„è§£å†³æ–¹æ¡ˆï¼Œä»¥JWTä¸ºä¾‹</p><p>â€‹   I.  ç”¨æˆ·è®¿é—®å…¶ä»–ç³»ç»Ÿï¼Œä¼šåœ¨ç½‘å…³åˆ¤æ–­tokenæ˜¯å¦æœ‰æ•ˆ</p><p>â€‹     II.  å¦‚æœtokenæ— æ•ˆåˆ™ä¼šè¿”å›401ï¼ˆè®¤è¯å¤±è´¥ï¼‰å‰ç«¯è·³è½¬åˆ°ç™»å½•é¡µé¢</p><p>â€‹    III.  ç”¨æˆ·å‘é€ç™»å½•è¯·æ±‚ï¼Œè¿”å›æµè§ˆå™¨ä¸€ä¸ªtokenï¼Œæµè§ˆå™¨æŠŠtokenä¿å­˜åˆ°cookie</p><p>â€‹    IV.  å†å»è®¿é—®å…¶ä»–æœåŠ¡çš„æ—¶å€™ï¼Œéƒ½éœ€è¦æºå¸¦tokenï¼Œç”±ç½‘å…³ç»Ÿä¸€éªŒè¯åè·¯ç”±åˆ°ç›®æ ‡æœåŠ¡</p><h2 id="æƒé™è®¤è¯æ˜¯å¦‚ä½•å®ç°çš„"><a href="#æƒé™è®¤è¯æ˜¯å¦‚ä½•å®ç°çš„" class="headerlink" title="æƒé™è®¤è¯æ˜¯å¦‚ä½•å®ç°çš„"></a>æƒé™è®¤è¯æ˜¯å¦‚ä½•å®ç°çš„</h2><p>Spring security</p><p><img src="/../assets/%E9%9D%A2%E8%AF%95-%E9%9B%B6%E7%A2%8E%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230521114432028.png" alt="image-20230521114432028"></p><h2 id="ä¸Šä¼ æ•°æ®çš„å®‰å…¨æ€§ä½ ä»¬æ€ä¹ˆæ§åˆ¶"><a href="#ä¸Šä¼ æ•°æ®çš„å®‰å…¨æ€§ä½ ä»¬æ€ä¹ˆæ§åˆ¶" class="headerlink" title="ä¸Šä¼ æ•°æ®çš„å®‰å…¨æ€§ä½ ä»¬æ€ä¹ˆæ§åˆ¶"></a>ä¸Šä¼ æ•°æ®çš„å®‰å…¨æ€§ä½ ä»¬æ€ä¹ˆæ§åˆ¶</h2><p>ä½¿ç”¨éå¯¹ç§°åŠ å¯†ï¼ˆæˆ–å¯¹ç§°åŠ å¯†ï¼‰ï¼Œç»™å‰ç«¯ä¸€ä¸ªå…¬é’¥è®©ä»–æŠŠæ•°æ®åŠ å¯†åä¼ åˆ°åå°ï¼Œåå°è§£å¯†åå¤„ç†æ•°æ®</p><ul><li>ä¼ è¾“çš„æ•°æ®å¾ˆå¤§å»ºè®®ä½¿ç”¨å¯¹ç§°åŠ å¯†ï¼Œä¸è¿‡ä¸èƒ½ä¿å­˜æ•æ„Ÿä¿¡æ¯</li><li>ä¼ è¾“çš„æ•°æ®è¾ƒå°ï¼Œè¦æ±‚å®‰å…¨æ€§é«˜ï¼Œå»ºè®®é‡‡ç”¨éå¯¹ç§°åŠ å¯†</li></ul><h2 id="ä½ è´Ÿè´£é¡¹ç›®çš„æ—¶å€™é‡åˆ°äº†å“ªäº›æ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜"><a href="#ä½ è´Ÿè´£é¡¹ç›®çš„æ—¶å€™é‡åˆ°äº†å“ªäº›æ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜" class="headerlink" title="ä½ è´Ÿè´£é¡¹ç›®çš„æ—¶å€™é‡åˆ°äº†å“ªäº›æ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜"></a>ä½ è´Ÿè´£é¡¹ç›®çš„æ—¶å€™é‡åˆ°äº†å“ªäº›æ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜</h2><p><strong>ï¼ˆ1ï¼‰è®¾è®¡æ¨¡å¼</strong></p><ul><li>å·¥å‚æ¨¡å¼+ç­–ç•¥</li><li>è´£ä»»é“¾æ¨¡å¼</li></ul><blockquote><p>å›ç­”æ€è·¯</p><p>1ï¼Œä»€ä¹ˆèƒŒæ™¯ï¼ˆæŠ€æœ¯é—®é¢˜ï¼‰</p><p>2ï¼Œè¿‡ç¨‹ï¼ˆè§£å†³é—®é¢˜çš„è¿‡ç¨‹ï¼‰</p><p>3ï¼Œæœ€ç»ˆè½åœ°æ–¹æ¡ˆ</p></blockquote><p>ä¸¾ä¾‹ï¼š</p><p>â‘ ï¼šä»‹ç»ç™»å½•ä¸šåŠ¡ï¼ˆä¸€å¼€å§‹æ²¡æœ‰ç”¨è®¾è®¡æ¨¡å¼ï¼Œæ‰€æœ‰çš„ç™»å½•æ–¹å¼éƒ½æŸ”å’Œåœ¨ä¸€ä¸ªä¸šåŠ¡ç±»ä¸­ï¼Œä¸è¿‡ï¼Œå‘ç°éœ€æ±‚ç»å¸¸æ”¹ï¼‰</p><p>â‘¡ï¼šç™»å½•æ–¹å¼ç»å¸¸ä¼šå¢åŠ æˆ–æ›´æ¢ï¼Œæ¯æ¬¡éƒ½è¦ä¿®æ”¹ä¸šåŠ¡å±‚ä»£ç ï¼Œæ‰€ä»¥ï¼Œç»è¿‡æˆ‘çš„è®¾è®¡ï¼Œä½¿ç”¨äº†å·¥å‚è®¾è®¡æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼ï¼Œè§£å†³äº†ï¼Œç»å¸¸ä¿®æ”¹ä¸šåŠ¡å±‚ä»£ç çš„é—®é¢˜</p><p>â‘¢ï¼šè¯¦ç»†ä»‹ç»ä¸€ä¸‹å·¥å‚æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼ï¼ˆå‚è€ƒå‰é¢è®¾è®¡æ¨¡å¼çš„è¯¾ç¨‹ï¼‰</p><p><strong>ï¼ˆ2ï¼‰çº¿ä¸ŠBUG</strong></p><ul><li>CPUé£™é«˜</li><li>å†…å­˜æ³„æ¼</li><li>çº¿ç¨‹æ­»é”</li></ul><p><strong>ï¼ˆ3ï¼‰è°ƒä¼˜</strong></p><ul><li>æ…¢æ¥å£</li><li>æ…¢SQL</li><li>ç¼“å­˜æ–¹æ¡ˆ</li></ul><p><strong>ï¼ˆ4ï¼‰ç»„ä»¶å°è£…</strong></p><ul><li>åˆ†å¸ƒå¼é”</li><li>æ¥å£å¹‚ç­‰</li><li>åˆ†å¸ƒå¼äº‹åŠ¡</li><li>æ”¯ä»˜é€šç”¨</li></ul><h2 id="ä½ ä»¬é¡¹ç›®ä¸­æ—¥å¿—æ€ä¹ˆé‡‡é›†çš„"><a href="#ä½ ä»¬é¡¹ç›®ä¸­æ—¥å¿—æ€ä¹ˆé‡‡é›†çš„" class="headerlink" title="ä½ ä»¬é¡¹ç›®ä¸­æ—¥å¿—æ€ä¹ˆé‡‡é›†çš„"></a>ä½ ä»¬é¡¹ç›®ä¸­æ—¥å¿—æ€ä¹ˆé‡‡é›†çš„</h2><p>é‡‡ç”¨çš„ELK</p><p><img src="/../assets/%E9%9D%A2%E8%AF%95-%E9%9B%B6%E7%A2%8E%E9%9D%A2%E8%AF%95%E9%A2%98/image-20230521232913086.png" alt="image-20230521232913086"></p><p>ä»‹ç»ELKçš„ä¸‰ä¸ªç»„ä»¶ï¼š</p><ul><li>Elasticsearchæ˜¯å…¨æ–‡æœç´¢åˆ†æå¼•æ“ï¼Œå¯ä»¥å¯¹æ•°æ®å­˜å‚¨ã€æœç´¢ã€åˆ†æ</li><li>Logstashæ˜¯ä¸€ä¸ªæ•°æ®æ”¶é›†å¼•æ“ï¼Œå¯ä»¥åŠ¨æ€æ”¶é›†æ•°æ®ï¼Œå¯ä»¥å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ã€åˆ†æï¼Œå°†æ•°æ®å­˜å‚¨åˆ°æŒ‡å®šçš„ä½ç½®</li><li>Kibanaæ˜¯ä¸€ä¸ªæ•°æ®åˆ†æå’Œå¯è§†åŒ–å¹³å°ï¼Œé…åˆElasticsearchå¯¹æ•°æ®è¿›è¡Œæœç´¢ï¼Œåˆ†æï¼Œå›¾è¡¨åŒ–å±•ç¤º</li></ul><h1 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h1><p><a href="https://mp.weixin.qq.com/s/K0Q-kwP0HFwZ8qD7awxkFQ">https://mp.weixin.qq.com/s/K0Q-kwP0HFwZ8qD7awxkFQ</a></p><p>pomæ–‡ä»¶é‡Œçš„<dependencies>å’Œ<dependencyManagement>çš„åŒºåˆ«å’Œä½œç”¨</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SSMå­¦ä¹ </title>
      <link href="/2023/10/03/%E9%9D%A2%E8%AF%95-SSM/"/>
      <url>/2023/10/03/%E9%9D%A2%E8%AF%95-SSM/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æœ¬æ–‡å­¦ä¹ è‡ªï¼š<a href="https://www.bilibili.com/video/BV1yT411H7YK">https://www.bilibili.com/video/BV1yT411H7YK</a></p><p>éƒ¨åˆ†æ¥æºè‡ªç½‘ç»œ</p><h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p><strong>springåŸºæœ¬æ¦‚å¿µï¼š</strong></p><ul><li><p><mark>IoC</mark>(Inversion of control)æ§åˆ¶åè½¬ï¼š</p><ul><li>ä½¿ç”¨å¯¹è±¡æ—¶ï¼Œç”±ä¸»åŠ¨newäº§ç”Ÿå¯¹è±¡è½¬æ¢ä¸ºç”±å¤–éƒ¨æä¾›å¯¹è±¡ï¼Œæ­¤è¿‡ç¨‹ä¸­å¯¹è±¡åˆ›å»ºæ§åˆ¶æƒç”±ç¨‹åºè½¬ç§»åˆ°å¤–éƒ¨ï¼Œæ­¤æ€æƒ³ç§°ä¸ºæ§åˆ¶åè½¬</li></ul></li><li><p>SpringæŠ€æœ¯å¯¹IoCæ€æƒ³è¿›è¡Œäº†å®ç°</p><ul><li>Springæä¾›äº†ä¸€ä¸ªå®¹å™¨ï¼Œç§°ä¸ºIoCå®¹å™¨ï¼Œç”¨æ¥å……å½“IoCæ€æƒ³ä¸­çš„(å¤–éƒ¨</li><li>IoCå®¹å™¨è´Ÿè´£å¯¹è±¡çš„åˆ›å»ºã€åˆå§‹åŒ–ç­‰ä¸€ç³»åˆ—å·¥ä½œï¼Œè¢«åˆ›å»ºæˆ–è¢«ç®¡ç†çš„å¯¹è±¡åœ¨IoCå®¹å™¨ä¸­ç»Ÿç§°ä¸º<mark>Bean</mark></li></ul></li><li><p>DI(Dependency Injection)<mark>ä¾èµ–æ³¨å…¥</mark></p><ul><li>åœ¨å®¹å™¨ä¸­å»ºç«‹beanä¸beanä¹‹é—´çš„ä¾èµ–å…³ç³»çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œç§°ä¸ºä¾èµ–æ³¨å…¥</li></ul></li><li><p>ç›®æ ‡:<strong>å……åˆ†è§£è€¦</strong></p></li><li><p>ä½¿ç”¨IoCå®¹å™¨ç®¡ç†bean(Ioc)</p></li><li><p>åœ¨IoCå®¹å™¨å†…å°†æœ‰ä¾èµ–å…³ç³»çš„beanè¿›è¡Œå…³ç³»ç»‘å®š(DI)</p></li><li><p>æœ€ç»ˆæ•ˆæœ:</p><ul><li>ä½¿ç”¨å¯¹è±¡æ—¶ä¸ä»…å¯ä»¥ç›´æ¥ä»IoCå®¹å™¨ä¸­è·å–ï¼Œå¹¶ä¸”è·å–åˆ°çš„beanå·²ç»ç»‘å®šäº†æ‰€æœ‰çš„ä¾èµ–å…³ç³»</li></ul></li></ul><p><strong>AOPæ ¸å¿ƒæ¦‚å¿µï¼š</strong></p><ul><li><p>è¿æ¥ç‚¹(JoinPoint):ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä»»æ„ä½ç½®ï¼Œç²’åº¦ä¸ºæ‰§è¡Œæ–¹æ³•ã€æŠ›å‡ºå¼‚å¸¸ã€è®¾ç½®å˜é‡ç­‰åœ¨springAoPä¸­ï¼Œç†è§£ä¸ºæ–¹æ³•çš„æ‰§è¡Œ</p></li><li><p>åˆ‡å…¥ç‚¹(Pointcut):åŒ¹é…è¿æ¥ç‚¹çš„å¼å­</p></li><li><p>åœ¨SpringAoPä¸­ï¼Œä¸€ä¸ªåˆ‡å…¥ç‚¹å¯ä»¥åªæè¿°ä¸€ä¸ªå…·ä½“æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥åŒ¹é…å¤šä¸ªæ–¹æ³•</p><ul><li>ä¸€ä¸ªå…·ä½“æ–¹æ³•:com.itheima.daoåŒ…ä¸‹çš„BookDaoæ¥å£ä¸­çš„æ— å½¢å‚æ— è¿”å›å€¼çš„saveæ–¹æ³•</li><li>åŒ¹é…å¤šä¸ªæ–¹æ³•:æ‰€æœ‰çš„saveæ–¹æ³•ï¼Œæ‰€æœ‰çš„getå¼€å¤´çš„æ–¹æ³•ï¼Œæ‰€æœ‰ä»¥Daoç»“å°¾çš„æ¥å£ä¸­çš„ä»»æ„æ–¹æ³•ï¼Œæ‰€æœ‰å¸¦æœ‰ä¸€ä¸ªå‚æ•°çš„æ–¹æ³•</li></ul></li><li><p>é€šçŸ¥(Advice):åœ¨åˆ‡å…¥ç‚¹å¤„æ‰§è¡Œçš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯å…±æ€§åŠŸèƒ½åœ¨SpringA0Pä¸­ï¼ŒåŠŸèƒ½æœ€ç»ˆä»¥æ–¹æ³•çš„å½¢å¼å‘ˆç°</p></li><li><p>é€šçŸ¥ç±»:å®šä¹‰é€šçŸ¥çš„ç±»</p></li><li><p>åˆ‡é¢(Aspect):æè¿°é€šçŸ¥ä¸åˆ‡å…¥ç‚¹çš„å¯¹åº”å…³ç³»</p></li></ul><h2 id="Springä¸­çš„å•ä¾‹beanæ˜¯çº¿ç¨‹å®‰å…¨çš„å—"><a href="#Springä¸­çš„å•ä¾‹beanæ˜¯çº¿ç¨‹å®‰å…¨çš„å—" class="headerlink" title="Springä¸­çš„å•ä¾‹beanæ˜¯çº¿ç¨‹å®‰å…¨çš„å—"></a>Springä¸­çš„å•ä¾‹beanæ˜¯çº¿ç¨‹å®‰å…¨çš„å—</h2><p><strong>é€šå¸¸æƒ…å†µä¸‹æ˜¯çº¿ç¨‹å®‰å…¨</strong>çš„ï¼Œçº¿ç¨‹å®‰å…¨çš„å‰ææ˜¯æ— çŠ¶æ€å’Œä¸åšä¿®æ”¹ï¼Œè¢«Springç®¡ç†çš„beanæ˜¯é»˜è®¤ä¸ºå•ä¾‹æ¨¡å¼çš„ï¼Œå³åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­æ˜¯å…¨å±€å…±äº«ä¸€ä¸ªçš„ï¼Œä¸€æ—¦å•ä¾‹beanè¢«åˆå§‹åŒ–å®Œæˆï¼Œå®ƒä¼šè¢«ç¼“å­˜èµ·æ¥ï¼Œä¹‹åæ¯æ¬¡è¯·æ±‚è¯¥beanæ—¶éƒ½ä¼šè¿”å›åŒä¸€ä¸ªå®ä¾‹ã€‚è¿™ç¡®ä¿äº†åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨ï¼Œå› æ­¤ä¸ä¼šå‘ç”Ÿç«äº‰æ¡ä»¶ï¼Œä»è€Œä¿è¯äº†çº¿ç¨‹å®‰å…¨æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span>&#123;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> count; <span class="comment">// è¿™ä¸ªå°±æ˜¯æœ‰çŠ¶æ€çš„å¯¹è±¡ï¼Œå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserService userService <span class="comment">// è¿™ä¸ªè¢«springæ‰€ç®¡ç†çš„beanæ˜¯å•ä¾‹çš„ï¼Œæ²¡æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/getByld/fid;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getByld</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>&#123;</span><br><span class="line">count++:</span><br><span class="line">System.out.println(count);</span><br><span class="line"><span class="keyword">return</span> userService.getByld(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="â­ä»€ä¹ˆæ˜¯AOPï¼Œä½ ä»¬çš„é¡¹ç›®ä¸­æœ‰æ²¡æœ‰ä½¿ç”¨åˆ°AOP"><a href="#â­ä»€ä¹ˆæ˜¯AOPï¼Œä½ ä»¬çš„é¡¹ç›®ä¸­æœ‰æ²¡æœ‰ä½¿ç”¨åˆ°AOP" class="headerlink" title="â­ä»€ä¹ˆæ˜¯AOPï¼Œä½ ä»¬çš„é¡¹ç›®ä¸­æœ‰æ²¡æœ‰ä½¿ç”¨åˆ°AOP"></a>â­ä»€ä¹ˆæ˜¯AOPï¼Œä½ ä»¬çš„é¡¹ç›®ä¸­æœ‰æ²¡æœ‰ä½¿ç”¨åˆ°AOP</h2><p>AOPæ˜¯<mark>é¢å‘åˆ‡é¢ç¼–ç¨‹</mark>ï¼Œåœ¨springä¸­ç”¨äºå°†é‚£äº›<strong>ä¸ä¸šåŠ¡æ— å…³</strong>ï¼Œä½†å´å¯¹å¤šä¸ªå¯¹è±¡äº§ç”Ÿå½±å“çš„<strong>å…¬å…±è¡Œä¸ºå’Œé€»è¾‘</strong>ï¼ŒæŠ½å–å…¬å…±æ¨¡å—å¤ç”¨ï¼Œé™ä½è€¦åˆï¼Œä¸€èˆ¬æ¯”å¦‚å¯ä»¥åšä¸ºå…¬å…±æ—¥å¿—ä¿å­˜ï¼Œäº‹åŠ¡å¤„ç†ç­‰</p><p>æˆ‘ä»¬å½“æ—¶åœ¨åå°ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå°±æ˜¯ä½¿ç”¨AOPæ¥è®°å½•äº†ç³»ç»Ÿçš„æ“ä½œæ—¥å¿—</p><p>ä¸»è¦æ€è·¯æ˜¯è¿™æ ·çš„ï¼Œä½¿ç”¨AOPä¸­çš„ç¯ç»•é€šçŸ¥+åˆ‡ç‚¹è¡¨è¾¾å¼ï¼Œè¿™ä¸ªè¡¨è¾¾å¼å°±æ˜¯è¦æ‰¾åˆ°è¦è®°å½•æ—¥å¿—çš„æ–¹æ³•ï¼Œç„¶åé€šè¿‡ç¯ç»•é€šçŸ¥çš„å‚æ•°è·å–è¯·æ±‚æ–¹æ³•çš„å‚æ•°ï¼Œæ¯”å¦‚ç±»ä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€æ³¨è§£ã€è¯·æ±‚æ–¹å¼ç­‰ï¼Œè·å–åˆ°è¿™äº›å‚æ•°ä»¥åï¼Œä¿å­˜åˆ°æ•°æ®åº“</p><h2 id="Springä¸­çš„äº‹åŠ¡æ˜¯å¦‚ä½•å®ç°çš„"><a href="#Springä¸­çš„äº‹åŠ¡æ˜¯å¦‚ä½•å®ç°çš„" class="headerlink" title="Springä¸­çš„äº‹åŠ¡æ˜¯å¦‚ä½•å®ç°çš„"></a>Springä¸­çš„äº‹åŠ¡æ˜¯å¦‚ä½•å®ç°çš„</h2><p>springå®ç°çš„<mark>äº‹åŠ¡æœ¬è´¨å°±æ˜¯AOP</mark>å®Œæˆï¼Œå¯¹æ–¹æ³•å‰åè¿›è¡Œæ‹¦æˆªï¼Œåœ¨æ‰§è¡Œæ–¹æ³•ä¹‹å‰å¼€å¯äº‹åŠ¡ï¼Œåœ¨æ‰§è¡Œå®Œç›®æ ‡æ–¹æ³•ä¹‹åæ ¹æ®æ‰§è¡Œæƒ…å†µæäº¤æˆ–è€…å›æ»šäº‹åŠ¡ã€‚</p><p><strong>aopå·¥ä½œæµç¨‹ï¼š</strong></p><ol><li><p>Springå®¹å™¨å¯åŠ¨</p></li><li><p>è¯»å–æ‰€æœ‰åˆ‡é¢é…ç½®ä¸­çš„åˆ‡å…¥ç‚¹</p></li><li><p>åˆå§‹åŒ–beanï¼Œåˆ¤å®šbeanå¯¹åº”çš„ç±»ä¸­çš„æ–¹æ³•æ˜¯å¦åŒ¹é…åˆ°ä»»æ„åˆ‡å…¥ç‚¹</p><ul><li><p>åŒ¹é…å¤±è´¥ï¼Œåˆ›å»ºå¯¹è±¡</p></li><li><p>åŒ¹é…æˆåŠŸï¼Œ<strong>åˆ›å»º</strong>åŸå§‹å¯¹è±¡(ç›®æ ‡å¯¹è±¡)çš„<strong>ä»£ç†å¯¹è±¡</strong></p></li></ul></li><li><p>è·å–beanæ‰§è¡Œæ–¹æ³•</p><ul><li>è·å–beanï¼Œè°ƒç”¨æ–¹æ³•å¹¶æ‰§è¡Œï¼Œå®Œæˆæ“ä½œ</li><li>è·å–çš„beanæ˜¯ä»£ç†å¯¹è±¡æ—¶ï¼Œæ ¹æ®ä»£ç†å¯¹è±¡çš„è¿è¡Œæ¨¡å¼è¿è¡ŒåŸå§‹æ–¹æ³•ä¸å¢å¼ºçš„å†…å®¹ï¼Œå®Œæˆæ“ä½œ</li></ul></li></ol><h2 id="â­Springä¸­äº‹åŠ¡å¤±æ•ˆçš„åœºæ™¯æœ‰å“ªäº›"><a href="#â­Springä¸­äº‹åŠ¡å¤±æ•ˆçš„åœºæ™¯æœ‰å“ªäº›" class="headerlink" title="â­Springä¸­äº‹åŠ¡å¤±æ•ˆçš„åœºæ™¯æœ‰å“ªäº›"></a>â­Springä¸­äº‹åŠ¡å¤±æ•ˆçš„åœºæ™¯æœ‰å“ªäº›</h2><p>ç¬¬ä¸€ä¸ªï¼Œå¦‚æœæ–¹æ³•ä¸Šå¼‚å¸¸æ•è·å¤„ç†ï¼Œè‡ªå·±å¤„ç†äº†å¼‚å¸¸ï¼Œæ²¡æœ‰æŠ›å‡ºï¼Œå°±ä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼Œæ‰€ä»¥ä¸€èˆ¬å¤„ç†äº†å¼‚å¸¸ä»¥åï¼Œåˆ«å¿˜äº†è·‘å‡ºå»å°±è¡Œäº†ï¼Œ<strong>å³åœ¨catchå—ä¸­æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸</strong>ã€‚</p><p>ç¬¬äºŒä¸ªï¼Œå¦‚æœæ–¹æ³•æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸ï¼Œå¦‚æœæŠ¥é”™ä¹Ÿä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼Œæœ€ååœ¨springäº‹åŠ¡çš„æ³¨è§£ä¸Šï¼Œå°±æ˜¯@Transactionalä¸Šé…ç½®rollbackForå±æ€§ä¸ºExceptionï¼Œè¿™æ ·åˆ«ç®¡æ˜¯ä»€ä¹ˆå¼‚å¸¸ï¼Œéƒ½ä¼šå›æ»šäº‹åŠ¡</p><p>ç¬¬ä¸‰ï¼Œå¦‚æœæ–¹æ³•ä¸Šä¸æ˜¯publicä¿®é¥°çš„ï¼Œä¹Ÿä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆ</p><h3 id="1-æ–¹æ³•è®¿é—®æƒé™é—®é¢˜"><a href="#1-æ–¹æ³•è®¿é—®æƒé™é—®é¢˜" class="headerlink" title="1.æ–¹æ³•è®¿é—®æƒé™é—®é¢˜"></a>1.æ–¹æ³•è®¿é—®æƒé™é—®é¢˜</h3><p><strong>åªæ”¯æŒpublic</strong></p><h3 id="2-æ–¹æ³•ä½¿ç”¨äº†finalï¼Œstaticä¿®é¥°åäº‹åŠ¡ä¼šå¤±æ•ˆ"><a href="#2-æ–¹æ³•ä½¿ç”¨äº†finalï¼Œstaticä¿®é¥°åäº‹åŠ¡ä¼šå¤±æ•ˆ" class="headerlink" title="2.æ–¹æ³•ä½¿ç”¨äº†finalï¼Œstaticä¿®é¥°åäº‹åŠ¡ä¼šå¤±æ•ˆ"></a>2.æ–¹æ³•ä½¿ç”¨äº†finalï¼Œstaticä¿®é¥°åäº‹åŠ¡ä¼šå¤±æ•ˆ</h3><p>springäº‹åŠ¡åº•å±‚ä½¿ç”¨äº†aopï¼Œä¹Ÿå°±æ˜¯é€šè¿‡jdkåŠ¨æ€ä»£ç†æˆ–è€…cglibï¼Œå¸®æˆ‘ä»¬ç”Ÿæˆäº†ä»£ç†ç±»ï¼Œåœ¨ä»£ç†ç±»ä¸­å®ç°çš„äº‹åŠ¡åŠŸèƒ½ã€‚<br>ä½†å¦‚æœæŸä¸ªæ–¹æ³•ç”¨finalæˆ–staticä¿®é¥°äº†ï¼Œé‚£ä¹ˆåœ¨å®ƒçš„ä»£ç†ç±»ä¸­ï¼Œå°±æ— æ³•é‡å†™è¯¥æ–¹æ³•ï¼Œè€Œæ·»åŠ äº‹åŠ¡åŠŸèƒ½ã€‚</p><blockquote><ul><li><strong>JDKåŠ¨æ€ä»£ç†</strong>ï¼šåªé€‚ç”¨äºæ¥å£ï¼Œä»£ç†ç±»å®ç°äº†ç›®æ ‡å¯¹è±¡çš„æ¥å£ï¼Œå¹¶åœ¨æ–¹æ³•è°ƒç”¨æ—¶æ·»åŠ é¢å¤–çš„åŠŸèƒ½ï¼ˆä¾‹å¦‚äº‹åŠ¡ç®¡ç†ï¼‰ã€‚</li><li><strong>CGLIBä»£ç†</strong>ï¼šåŸºäºå­ç±»çš„åŠ¨æ€ä»£ç†ï¼Œé€‚ç”¨äºç±»ã€‚CGLIBé€šè¿‡åˆ›å»ºç›®æ ‡ç±»çš„å­ç±»å¹¶è¦†ç›–å…¶ä¸­çš„æ–¹æ³•æ¥æ·»åŠ é¢å¤–çš„åŠŸèƒ½ã€‚</li></ul><ol><li>æ–¹æ³•ä½¿ç”¨finalä¿®é¥°æ—¶</li></ol><p>å½“æ–¹æ³•è¢«<code>final</code>ä¿®é¥°æ—¶ï¼Œæ„å‘³ç€è¿™ä¸ªæ–¹æ³•ä¸èƒ½è¢«å­ç±»é‡å†™ã€‚è¿™å¯¹CGLIBä»£ç†çš„æœºåˆ¶äº§ç”Ÿäº†å½±å“ï¼Œå› ä¸ºCGLIBæ˜¯é€šè¿‡ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»å¹¶è¦†ç›–æ–¹æ³•æ¥å®ç°ä»£ç†åŠŸèƒ½çš„ã€‚å¦‚æœæ–¹æ³•æ˜¯<code>final</code>çš„ï¼ŒCGLIBæ— æ³•è¦†ç›–è¿™ä¸ªæ–¹æ³•ï¼Œä»è€Œæ— æ³•åœ¨æ–¹æ³•å‰åæ·»åŠ äº‹åŠ¡å¤„ç†é€»è¾‘ã€‚</p><ol start="2"><li>æ–¹æ³•ä½¿ç”¨staticä¿®é¥°æ—¶</li></ol><p><code>static</code>æ–¹æ³•å±äºç±»è€Œä¸æ˜¯å®ä¾‹ã€‚AOPä»£ç†æœºåˆ¶æ— è®ºæ˜¯åŸºäºJDKåŠ¨æ€ä»£ç†è¿˜æ˜¯CGLIBï¼Œéƒ½æ— æ³•æ‹¦æˆªé™æ€æ–¹æ³•çš„è°ƒç”¨ï¼Œå› ä¸ºä»£ç†å¯¹è±¡æ˜¯å®ä¾‹çº§åˆ«çš„è€Œä¸æ˜¯ç±»çº§åˆ«çš„ã€‚é™æ€æ–¹æ³•ä¸åœ¨ä»£ç†å¯¹è±¡çš„è°ƒç”¨è·¯å¾„ä¸­ï¼Œå› æ­¤Springæ— æ³•åœ¨é™æ€æ–¹æ³•å‰åæ·»åŠ äº‹åŠ¡å¤„ç†é€»è¾‘ã€‚</p></blockquote><h3 id="3-æ–¹æ³•å†…éƒ¨è°ƒç”¨"><a href="#3-æ–¹æ³•å†…éƒ¨è°ƒç”¨" class="headerlink" title="3.æ–¹æ³•å†…éƒ¨è°ƒç”¨"></a>3.æ–¹æ³•å†…éƒ¨è°ƒç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">userService</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span>&#123;</span><br><span class="line">        update();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢è¿™æ®µæ–¹æ³•ä¸­ï¼Œaddæ–¹æ³•è°ƒç”¨äº†updateæ–¹æ³•ï¼Œç›¸å½“äºæ˜¯ç”¨thiså»è°ƒç”¨updateæ–¹æ³•ï¼Œè€Œä½¿ç”¨thisç›¸å½“äºnewå‡ºæ¥äº†ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å»è°ƒç”¨updateæ–¹æ³•ï¼Œè¿™æ ·çš„ç›¸å½“äºnewå‡ºæ¥çš„å¯¹è±¡ä¸æ˜¯springaopçš„ä»£ç†å¯¹è±¡ï¼Œä¸å…·å¤‡aopçš„åŠŸèƒ½ï¼Œæ•…ä¸èƒ½å®ç°äº‹åŠ¡æ§åˆ¶ã€‚</p><p>è§£å†³æ–¹å¼æ˜¯ï¼šï¼ˆå°†è‡ªå·±è¿™ä¸ªç±»æ³¨å…¥è¿›æ¥ï¼Œè¿™æ ·ä¸ä¼šæœ‰å¾ªç¯ä¾èµ–ï¼Œå› ä¸ºspringçš„ä¸‰çº§ç¼“å­˜è§£å†³äº†ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">userService</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> userService proxy;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span>&#123;</span><br><span class="line">        proxy.update();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-æœªè¢«springæ§åˆ¶"><a href="#4-æœªè¢«springæ§åˆ¶" class="headerlink" title="4.æœªè¢«springæ§åˆ¶"></a>4.æœªè¢«springæ§åˆ¶</h3><p>ä¾‹å¦‚ï¼šæœªåŠ @Serviceç­‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">userService</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span>&#123;</span><br><span class="line">        update();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-å¤šçº¿ç¨‹è°ƒç”¨"><a href="#5-å¤šçº¿ç¨‹è°ƒç”¨" class="headerlink" title="5.å¤šçº¿ç¨‹è°ƒç”¨"></a>5.å¤šçº¿ç¨‹è°ƒç”¨</h3><p>å½“å¤šçº¿ç¨‹è°ƒç”¨çš„æ—¶å€™ï¼Œå› ä¸ºè¿™æ ·å¯¼è‡´äº†æ–¹æ³•ä¸åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œæ‰€ä»¥è·å–åˆ°çš„æ•°æ®åº“è¿æ¥ä¹Ÿä¸ä¸€æ ·ï¼Œä»è€Œæ˜¯ä¸åŒçš„äº‹åŠ¡ã€‚</p><p>æˆ‘ä»¬è¯´çš„åŒä¸€ä¸ªäº‹åŠ¡ï¼Œå…¶å®æ˜¯æŒ‡åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼Œåªæœ‰æ‹¥æœ‰åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥æ‰èƒ½åŒæ—¶æäº¤å’Œå›æ»š</p><h3 id="6-è¡¨ä¸æ”¯æŒäº‹åŠ¡"><a href="#6-è¡¨ä¸æ”¯æŒäº‹åŠ¡" class="headerlink" title="6.è¡¨ä¸æ”¯æŒäº‹åŠ¡"></a>6.è¡¨ä¸æ”¯æŒäº‹åŠ¡</h3><p>ä¾‹å¦‚MySQLçš„Myisam å°±ä¸æ”¯æŒäº‹åŠ¡ï¼Œéœ€è¦æ¢æˆinnodb</p><h3 id="7-äº‹åŠ¡æœªå¼€å¯"><a href="#7-äº‹åŠ¡æœªå¼€å¯" class="headerlink" title="7.äº‹åŠ¡æœªå¼€å¯"></a>7.äº‹åŠ¡æœªå¼€å¯</h3><p>springbooté»˜è®¤å¼€å¯ï¼Œä½†æ˜¯springéœ€è¦è¿›è¡Œè®¾ç½®</p><h3 id="8-äº‹åŠ¡ä¼ æ’­ç‰¹æ€§"><a href="#8-äº‹åŠ¡ä¼ æ’­ç‰¹æ€§" class="headerlink" title="8.äº‹åŠ¡ä¼ æ’­ç‰¹æ€§"></a>8.äº‹åŠ¡ä¼ æ’­ç‰¹æ€§</h3><p>äº‹åŠ¡ä¼ æ’­ç‰¹æ€§é€‰æ‹©äº†ä¸æ”¯æŒäº‹åŠ¡</p><h3 id="9-è‡ªå·±æ•è·äº†å¼‚å¸¸"><a href="#9-è‡ªå·±æ•è·äº†å¼‚å¸¸" class="headerlink" title="9.è‡ªå·±æ•è·äº†å¼‚å¸¸"></a>9.è‡ªå·±æ•è·äº†å¼‚å¸¸</h3><p>ç”¨try catchæ•è·äº†ï¼Œæ²¡æœ‰å‘ä¸ŠæŠ›å‡ºå»ï¼ŒSpringè‡ªç„¶å°±æ•è·ä¸åˆ°å¼‚å¸¸ï¼Œåˆ™ä¸ä¼šè¿›è¡Œäº‹åŠ¡å›æ»š</p><h3 id="10-å¼‚å¸¸æŠ›é”™äº†"><a href="#10-å¼‚å¸¸æŠ›é”™äº†" class="headerlink" title="10.å¼‚å¸¸æŠ›é”™äº†"></a>10.å¼‚å¸¸æŠ›é”™äº†</h3><p>é»˜è®¤çš„æ˜¯rollbackFor &#x3D; RuntimeException.classï¼Œå¦‚æœæŠ›äº†ä¸ªæ¯”å¦‚æ˜¯Exceptionçš„å¼‚å¸¸å°±æ•è·ä¸åˆ°</p><h3 id="11-è‡ªå®šä¹‰å¼‚å¸¸"><a href="#11-è‡ªå®šä¹‰å¼‚å¸¸" class="headerlink" title="11.è‡ªå®šä¹‰å¼‚å¸¸"></a>11.è‡ªå®šä¹‰å¼‚å¸¸</h3><p>åŒæ ·æ˜¯æ•è·ä¸åˆ°å¯¹åº”çš„å¼‚å¸¸</p><h3 id="12-åµŒå¥—"><a href="#12-åµŒå¥—" class="headerlink" title="12.åµŒå¥—"></a>12.åµŒå¥—</h3><p>ä¸€ä¸ªåŠ äº†äº‹åŠ¡çš„æ–¹æ³•Aè°ƒç”¨å¦ä¸€ä¸ªåŠ äº†äº‹åŠ¡çš„æ–¹æ³•Bï¼Œå¦‚æœæƒ³å®ç°æ–¹æ³•BæŠ¥é”™ä¸”æ–¹æ³•Aå‰©ä½™éƒ¨åˆ†ä¸å›æ»šï¼Œåªèƒ½åœ¨æ–¹æ³•Bè¿›è¡Œæ•è·å¼‚å¸¸ï¼Œä¸è®©å…¶å¾€ä¸ŠæŠ›å¼‚å¸¸</p><h2 id="â­Springçš„beançš„ç”Ÿå‘½å‘¨æœŸâœï¸"><a href="#â­Springçš„beançš„ç”Ÿå‘½å‘¨æœŸâœï¸" class="headerlink" title="â­Springçš„beançš„ç”Ÿå‘½å‘¨æœŸâœï¸"></a>â­Springçš„beançš„ç”Ÿå‘½å‘¨æœŸâœï¸</h2><p>Beançš„ç”Ÿå‘½å‘¨æœŸå¤§è‡´å¯ä»¥åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼šå®ä¾‹åŒ–ã€å±æ€§èµ‹å€¼ã€åˆå§‹åŒ–ã€é”€æ¯</p><p><a href="https://juejin.cn/post/7075168883744718856?searchId=20231231212710EF990A2551C424C4ECA6#heading-0">https://juejin.cn/post/7075168883744718856?searchId=20231231212710EF990A2551C424C4ECA6#heading-0</a></p><p>å¾…è¡¥å……ã€‚ã€‚ã€‚</p><p><a href="https://www.bilibili.com/video/BV1584y1r7n6/?spm_id_from=333.337.search-card.all.click&vd_source=fa7ba4ae353f08f1d08d1bb24528e96c">https://www.bilibili.com/video/BV1584y1r7n6/?spm_id_from=333.337.search-card.all.click&amp;vd_source=fa7ba4ae353f08f1d08d1bb24528e96c</a></p><h2 id="â­Springbeançš„å¾ªç¯ä¾èµ–âœï¸"><a href="#â­Springbeançš„å¾ªç¯ä¾èµ–âœï¸" class="headerlink" title="â­Springbeançš„å¾ªç¯ä¾èµ–âœï¸"></a>â­Springbeançš„å¾ªç¯ä¾èµ–âœï¸</h2><p>åœ¨Springæ¡†æ¶ä¸­ï¼Œä¸‰çº§ç¼“å­˜æ˜¯ç”¨äºè§£å†³å¾ªç¯ä¾èµ–é—®é¢˜çš„ä¸€ä¸ªé‡è¦æœºåˆ¶ã€‚å¾ªç¯ä¾èµ–æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªbeanäº’ç›¸ä¾èµ–å¯¹æ–¹ï¼Œå¯¼è‡´åœ¨åˆ›å»ºbeançš„è¿‡ç¨‹ä¸­å‡ºç°æ— é™é€’å½’çš„é—®é¢˜ã€‚Springé€šè¿‡å¼•å…¥ä¸‰çº§ç¼“å­˜æœºåˆ¶ï¼Œä¼˜é›…åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="ä¸‰çº§ç¼“å­˜ç®€ä»‹"><a href="#ä¸‰çº§ç¼“å­˜ç®€ä»‹" class="headerlink" title="ä¸‰çº§ç¼“å­˜ç®€ä»‹"></a>ä¸‰çº§ç¼“å­˜ç®€ä»‹</h3><p>Springçš„ä¸‰çº§ç¼“å­˜åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªçº§åˆ«ï¼š</p><ol><li>ä¸€çº§ç¼“å­˜ï¼ˆsingletonObjectsï¼‰<ul><li>å­˜å‚¨<mark><strong>å®Œå…¨åˆå§‹åŒ–å¥½çš„å•ä¾‹bean</strong></mark>ã€‚</li></ul></li><li>äºŒçº§ç¼“å­˜ï¼ˆearlySingletonObjectsï¼‰<ul><li>å­˜å‚¨åŸå§‹çš„<mark><strong>æ—©æœŸåŠæˆå“beanï¼ˆå·²å®ä¾‹åŒ–æœªæ³¨å…¥å±æ€§ï¼ˆæœªåˆå§‹åŒ–ï¼‰ï¼‰</strong></mark>ï¼Œé€šå¸¸æ˜¯ä¸ºäº†æš´éœ²è¿™äº›beanä»¥è§£å†³å¾ªç¯ä¾èµ–ã€‚</li></ul></li><li>ä¸‰çº§ç¼“å­˜ï¼ˆsingletonFactoriesï¼‰<ul><li><mark><strong>å­˜å‚¨beanå·¥å‚å¯¹è±¡</strong></mark>ï¼Œè¿™äº›å·¥å‚å¯¹è±¡å¯ä»¥åœ¨éœ€è¦æ—¶ç”Ÿæˆæ—©æœŸbeançš„<mark><strong>ä»£ç†</strong></mark>ã€‚</li></ul></li></ol><h3 id="è§£å†³å¾ªç¯ä¾èµ–çš„è¿‡ç¨‹"><a href="#è§£å†³å¾ªç¯ä¾èµ–çš„è¿‡ç¨‹" class="headerlink" title="è§£å†³å¾ªç¯ä¾èµ–çš„è¿‡ç¨‹"></a>è§£å†³å¾ªç¯ä¾èµ–çš„è¿‡ç¨‹</h3><p>ä»¥ä¸‹æ˜¯Springå¦‚ä½•é€šè¿‡ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–çš„å…·ä½“æ­¥éª¤ï¼š</p><ol><li><strong>åˆ›å»ºbeanå®ä¾‹</strong>ï¼š<ul><li>Springé¦–å…ˆå°è¯•åˆ›å»ºbeançš„å®ä¾‹ï¼ˆä»…å®ä¾‹åŒ–ï¼Œè¿˜æœªåˆå§‹åŒ–ï¼‰ã€‚</li><li>å¦‚æœåœ¨å®ä¾‹åŒ–è¿‡ç¨‹ä¸­æ£€æµ‹åˆ°å½“å‰beanå­˜åœ¨ä¾èµ–å…¶ä»–beanï¼Œåˆ™ä¼šå°è¯•ä»ç¼“å­˜ä¸­è·å–è¿™äº›ä¾èµ–beanã€‚</li></ul></li><li><strong>ä»ç¼“å­˜ä¸­è·å–ä¾èµ–</strong>ï¼š<ul><li><strong>ä¸€çº§ç¼“å­˜</strong>ï¼šé¦–å…ˆå°è¯•ä»ä¸€çº§ç¼“å­˜ä¸­è·å–ä¾èµ–ï¼Œå¦‚æœæ‰¾åˆ°åˆ™ç›´æ¥ä½¿ç”¨ã€‚</li><li><strong>äºŒçº§ç¼“å­˜</strong>ï¼šå¦‚æœä¸€çº§ç¼“å­˜æ²¡æœ‰ï¼Œåˆ™ä»äºŒçº§ç¼“å­˜ä¸­è·å–ã€‚</li><li><strong>ä¸‰çº§ç¼“å­˜</strong>ï¼šå¦‚æœäºŒçº§ç¼“å­˜ä¹Ÿæ²¡æœ‰ï¼Œåˆ™ä»ä¸‰çº§ç¼“å­˜ä¸­è·å–ã€‚å¦‚æœä¸‰çº§ç¼“å­˜ä¸­å­˜åœ¨ä¸€ä¸ªå·¥å‚å¯¹è±¡ï¼ŒSpringå°†ä½¿ç”¨è¯¥å·¥å‚å¯¹è±¡ç”Ÿæˆä¸€ä¸ªæ—©æœŸbeançš„ä»£ç†ï¼Œå¹¶æ”¾å…¥äºŒçº§ç¼“å­˜ä¸­ã€‚</li></ul></li><li><strong>è§£å†³å¾ªç¯ä¾èµ–</strong>ï¼š<ul><li>å½“ä¸€ä¸ªbean A ä¾èµ–äº bean Bï¼Œè€Œbean B åˆä¾èµ–äºbean Aæ—¶ï¼ŒSpringèƒ½å¤Ÿé€šè¿‡ä¸‰çº§ç¼“å­˜æä¾›ä¸€ä¸ªbeançš„æ—©æœŸå¼•ç”¨ï¼Œä»è€Œæ‰“ç ´å¾ªç¯ä¾èµ–ã€‚</li><li>åœ¨åˆå§‹åŒ–bean Aæ—¶ï¼ŒSpringä¼šå°†bean Açš„æ—©æœŸå¼•ç”¨æ”¾å…¥ä¸‰çº§ç¼“å­˜ä¸­ã€‚å½“bean Béœ€è¦bean Aæ—¶ï¼ŒSpringå¯ä»¥ä»ä¸‰çº§ç¼“å­˜ä¸­è·å–bean Açš„æ—©æœŸå¼•ç”¨ï¼Œå¹¶ç»§ç»­åˆå§‹åŒ–bean Bã€‚</li></ul></li><li><strong>å®Œæˆbeançš„åˆå§‹åŒ–</strong>ï¼š<ul><li>æœ€ç»ˆï¼Œæ‰€æœ‰beanéƒ½ä¼šå®Œæˆåˆå§‹åŒ–å¹¶æ”¾å…¥ä¸€çº§ç¼“å­˜ä¸­ã€‚ä¸‰çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜åˆ™ç”¨æ¥å¤„ç†åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‡ºç°çš„ä¾èµ–é—®é¢˜ã€‚</li></ul></li></ol><h2 id="Spring-çš„å¸¸è§æ³¨è§£æœ‰å“ªäº›"><a href="#Spring-çš„å¸¸è§æ³¨è§£æœ‰å“ªäº›" class="headerlink" title="Spring çš„å¸¸è§æ³¨è§£æœ‰å“ªäº›"></a>Spring çš„å¸¸è§æ³¨è§£æœ‰å“ªäº›</h2><p>ç¬¬ä¸€ç±»æ˜¯ï¼šå£°æ˜beanï¼Œæœ‰@Componentã€@Serviceã€@Repositoryã€@Controller</p><p>ç¬¬äºŒç±»æ˜¯ï¼šä¾èµ–æ³¨å…¥ç›¸å…³çš„ï¼Œæœ‰@Autowiredã€@Qualifierã€@Resourse</p><p>ç¬¬ä¸‰ç±»æ˜¯ï¼šè®¾ç½®ä½œç”¨åŸŸ @Scope</p><p>ç¬¬å››ç±»æ˜¯ï¼šspringé…ç½®ç›¸å…³çš„ï¼Œæ¯”å¦‚@Configurationï¼Œ@ComponentScan å’Œ @Bean </p><p>ç¬¬äº”ç±»æ˜¯ï¼šè·Ÿaopç›¸å…³åšå¢å¼ºçš„æ³¨è§£  @Aspectï¼Œ@Beforeï¼Œ@Afterï¼Œ@Aroundï¼Œ@Pointcut</p><h2 id="Resourse-å’Œ-Aotuwired-çš„åŒºåˆ«"><a href="#Resourse-å’Œ-Aotuwired-çš„åŒºåˆ«" class="headerlink" title="@Resourse å’Œ @Aotuwired çš„åŒºåˆ«"></a>@Resourse å’Œ @Aotuwired çš„åŒºåˆ«</h2><p>@Autowiredå’Œ @Resource éƒ½æ˜¯ç”¨æ¥å®ç°ä¾èµ–æ³¨å…¥çš„æ³¨è§£(åœ¨Spring&#x2F;Spring Boot é¡¹ç›®ä¸­)ï¼Œä½†äºŒè€…<br>å´æœ‰ç€4ç‚¹ä¸åŒ</p><ol><li>æ¥æºä¸åŒ: @Autowired æ¥è‡ª Spring æ¡†æ¶ï¼Œè€Œ @Resource æ¥è‡ªäº (Java) JSR-250;</li><li>ä¾èµ–æŸ¥æ‰¾çš„é¡ºåºä¸åŒ: @Autowired å…ˆæ ¹æ®ç±»å‹å†æ ¹æ®åç§°æŸ¥è¯¢ï¼Œè€Œ @Resource å…ˆæ ¹æ®åç§°å†æ ¹æ®<br>ç±»å‹æŸ¥è¯¢;</li><li>æ”¯æŒçš„å‚æ•°ä¸åŒ: @Autowired åªæ”¯æŒè®¾ç½®1 ä¸ªå‚æ•°ï¼Œè€Œ @Resource æ”¯æŒè®¾ç½®7ä¸ªå‚æ•°</li><li>ä¾èµ–æ³¨å…¥çš„ç”¨æ³•æ”¯æŒä¸åŒ: @Autowired æ—¢æ”¯æŒæ„é€ æ–¹æ³•æ³¨å…¥ï¼Œåˆæ”¯æŒå±æ€§æ³¨å…¥å’Œ Setteræ³¨å…¥ï¼Œè€Œ<br>@Resource åªæ”¯æŒå±æ€§æ³¨å…¥å’Œ Setter æ³¨å…¥;</li></ol><h1 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h1><h2 id="â­SpringMVCæ‰§è¡Œæµç¨‹"><a href="#â­SpringMVCæ‰§è¡Œæµç¨‹" class="headerlink" title="â­SpringMVCæ‰§è¡Œæµç¨‹"></a>â­SpringMVCæ‰§è¡Œæµç¨‹</h2><p>Spring MVCï¼ˆModel-View-Controllerï¼‰çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><strong>æ¥æ”¶è¯·æ±‚</strong>ï¼šç”¨æˆ·é€šè¿‡æµè§ˆå™¨å‘é€è¯·æ±‚ï¼ŒServlet å®¹å™¨ï¼ˆå¦‚ Tomcatï¼‰æ¥æ”¶è¯·æ±‚ã€‚</li><li><strong>åˆ†å‘è¯·æ±‚</strong>ï¼šè¯·æ±‚ç”± Servlet å®¹å™¨è½¬å‘ç»™ DispatcherServletï¼ˆå‰ç«¯æ§åˆ¶å™¨ï¼‰ã€‚</li><li><strong>HandlerMapping</strong>ï¼šDispatcherServlet æ ¹æ®è¯·æ±‚ URL è°ƒç”¨ HandlerMapping æ¥æ‰¾åˆ°å¯¹åº”çš„å¤„ç†å™¨ï¼ˆControllerï¼‰ã€‚</li><li><strong>HandlerAdapter</strong>ï¼šDispatcherServlet è°ƒç”¨ HandlerAdapter ä»¥é€‚é…å¤„ç†å™¨çš„æ‰§è¡Œã€‚</li><li><strong>å¤„ç†è¯·æ±‚</strong>ï¼šå…·ä½“çš„å¤„ç†å™¨ï¼ˆControllerï¼‰æ‰§è¡Œé€»è¾‘å¤„ç†ï¼Œå¹¶è¿”å›ä¸€ä¸ª ModelAndView å¯¹è±¡ã€‚</li><li><strong>è§†å›¾è§£æ</strong>ï¼šDispatcherServlet ä½¿ç”¨ ViewResolver å°†é€»è¾‘è§†å›¾åè§£æä¸ºå…·ä½“çš„ Viewï¼ˆè§†å›¾ï¼‰ã€‚</li><li><strong>æ¸²æŸ“è§†å›¾</strong>ï¼šView æ¸²æŸ“æ¨¡å‹æ•°æ®å¹¶ç”Ÿæˆæœ€ç»ˆçš„ HTML å“åº”ã€‚</li><li><strong>è¿”å›å“åº”</strong>ï¼šDispatcherServlet å°†ç”Ÿæˆçš„ HTML å“åº”è¿”å›ç»™ Servlet å®¹å™¨ï¼Œæœ€ç»ˆå“åº”ç”¨æˆ·ã€‚</li></ol><p><img src="/../assets/%E9%9D%A2%E8%AF%95-SSM/image-20240603201358007.png" alt="image-20240603201358007"></p><h2 id="SpringMVCå¸¸è§çš„æ³¨è§£æœ‰å“ªäº›"><a href="#SpringMVCå¸¸è§çš„æ³¨è§£æœ‰å“ªäº›" class="headerlink" title="SpringMVCå¸¸è§çš„æ³¨è§£æœ‰å“ªäº›"></a>SpringMVCå¸¸è§çš„æ³¨è§£æœ‰å“ªäº›</h2><p>@RequestMappingï¼šç”¨äºæ˜ å°„è¯·æ±‚è·¯å¾„ï¼›</p><p>@RequestBodyï¼šæ³¨è§£å®ç°æ¥æ”¶httpè¯·æ±‚çš„jsonæ•°æ®ï¼Œå°†jsonè½¬æ¢ä¸ºjavaå¯¹è±¡ï¼›</p><p>@RequestParamï¼šæŒ‡å®šè¯·æ±‚å‚æ•°çš„åç§°ï¼›</p><p>@PathViriableï¼šä»è¯·æ±‚è·¯å¾„ä¸‹ä¸­è·å–è¯·æ±‚å‚æ•°(&#x2F;user&#x2F;{id})ï¼Œä¼ é€’ç»™æ–¹æ³•çš„å½¢å¼å‚æ•°ï¼›</p><p>@ResponseBodyï¼šæ³¨è§£å®ç°å°†controlleræ–¹æ³•è¿”å›å¯¹è±¡è½¬åŒ–ä¸ºjsonå¯¹è±¡å“åº”ç»™å®¢æˆ·ç«¯ã€‚</p><p>@RequestHeaderï¼šè·å–æŒ‡å®šçš„è¯·æ±‚å¤´æ•°æ®ï¼Œè¿˜æœ‰åƒ@PostMappingã€@GetMappingè¿™äº›ã€‚</p><p>@RestControllerï¼š@Controller + @ResponseBody</p><h2 id="Spring-MVCä¸­çš„æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨çš„åŒºåˆ«"><a href="#Spring-MVCä¸­çš„æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨çš„åŒºåˆ«" class="headerlink" title="Spring MVCä¸­çš„æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨çš„åŒºåˆ«"></a>Spring MVCä¸­çš„æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨çš„åŒºåˆ«</h2><ol><li><p>ä¸¤è€…éƒ½å¯ä»¥åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­ä»‹å…¥å¹¶å¯èƒ½é˜»æ­¢è¯·æ±‚ï¼Œä½†æ‰§è¡Œé¡ºåºä¸åŒï¼šè¿‡æ»¤å™¨å…ˆäºæ‹¦æˆªå™¨æ‰§è¡Œï¼Œä¸”æ›´åº•å±‚ï¼Œå¤„ç†çš„æ˜¯Servletè¯·æ±‚çš„å‰åè¿‡ç¨‹ï¼›æ‹¦æˆªå™¨åˆ™åœ¨Controllerå±‚ï¼Œæ›´åå‘ä¸šåŠ¡é€»è¾‘ï¼Œå¤„ç†è¯·æ±‚å‰åçš„å·¥ä½œã€‚</p></li><li><p>è¿‡æ»¤å™¨ä¾èµ–äºServletå®¹å™¨çš„Filteræ¥å£ï¼Œæ‰§è¡Œé¡ºåºç”±é…ç½®å†³å®šï¼Œè€Œæ‹¦æˆªå™¨ä¾èµ–äºSpring MVCçš„HandlerInterceptoræ¥å£ï¼Œæ‰§è¡Œé¡ºåºç”±Beané…ç½®æˆ–@Orderæ³¨è§£å†³å®šã€‚</p></li><li><p>æ‹¦æˆªå™¨å¸¸ç”¨äºå®ç°ä¸šåŠ¡ç›¸å…³çš„éå¿…è¦åŠŸèƒ½ï¼Œå¦‚èº«ä»½éªŒè¯ã€æˆæƒã€æ€§èƒ½ç›‘æ§ç­‰ï¼Œè€Œè¿‡æ»¤å™¨ä¸»è¦ç”¨äºåŸºç¡€è®¾æ–½ä»»åŠ¡ï¼Œå¦‚ç¼–ç å¤„ç†ã€è¯·æ±‚å‚æ•°å¤„ç†å’ŒURLé‡å®šå‘ã€‚åœ¨æ—¥å¸¸ä¸šåŠ¡å¼€å‘ä¸­ï¼Œé€šå¸¸ä½¿ç”¨æ‹¦æˆªå™¨å³å¯æ»¡è¶³éœ€æ±‚ï¼Œä¸”å…¶ä¸Springé›†æˆè¾ƒå¥½ï¼Œæ–¹ä¾¿ä¸šåŠ¡å¤„ç†ã€‚</p></li></ol><h1 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h1><h2 id="â­Springbootè‡ªåŠ¨é…ç½®åŸç†"><a href="#â­Springbootè‡ªåŠ¨é…ç½®åŸç†" class="headerlink" title="â­Springbootè‡ªåŠ¨é…ç½®åŸç†"></a>â­Springbootè‡ªåŠ¨é…ç½®åŸç†</h2><p>åœ¨Spring Booté¡¹ç›®ä¸­çš„å¼•å¯¼ç±»ä¸Šæœ‰ä¸€ä¸ªæ³¨è§£@SpringBootApplicationï¼Œè¿™ä¸ªæ³¨è§£æ˜¯å¯¹ä¸‰ä¸ªæ³¨è§£è¿›è¡Œäº†å°è£…ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li><p>@SpringBootConfiguration</p></li><li><p>@EnableAutoConfiguration</p></li><li><p>@ComponentScan</p></li></ul><p>å…¶ä¸­<code>@EnableAutoConfiguration</code>æ˜¯å®ç°è‡ªåŠ¨åŒ–é…ç½®çš„æ ¸å¿ƒæ³¨è§£ã€‚ </p><p>è¯¥æ³¨è§£é€šè¿‡<code>@Import</code>æ³¨è§£å¯¼å…¥å¯¹åº”çš„é…ç½®é€‰æ‹©å™¨ã€‚å…³é”®çš„æ˜¯å†…éƒ¨å°±æ˜¯<mark>è¯»å–</mark>äº†è¯¥é¡¹ç›®å’Œè¯¥é¡¹ç›®å¼•ç”¨çš„JaråŒ…çš„çš„<mark>classpathè·¯å¾„ä¸‹<strong>META-INF&#x2F;spring.factories</strong>æ–‡ä»¶ä¸­çš„æ‰€é…ç½®çš„ç±»çš„å…¨ç±»å</mark>ã€‚ </p><p>åœ¨è¿™äº›é…ç½®ç±»ä¸­æ‰€å®šä¹‰çš„Beanä¼šæ ¹æ®æ¡ä»¶æ³¨è§£æ‰€<strong>æŒ‡å®šçš„æ¡ä»¶æ¥å†³å®š</strong>æ˜¯å¦éœ€è¦å°†å…¶å¯¼å…¥åˆ°Springå®¹å™¨ä¸­ã€‚</p><p>ä¸€èˆ¬æ¡ä»¶åˆ¤æ–­ä¼šæœ‰åƒ<code>@ConditionalOnClass</code>è¿™æ ·çš„æ³¨è§£ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰å¯¹åº”çš„classæ–‡ä»¶ï¼Œå¦‚æœæœ‰åˆ™åŠ è½½è¯¥ç±»ï¼ŒæŠŠè¿™ä¸ªé…ç½®ç±»çš„æ‰€æœ‰çš„Beanæ”¾å…¥springå®¹å™¨ä¸­ä½¿ç”¨ã€‚</p><p><img src="/../assets/%E9%9D%A2%E8%AF%95-SSM/e787ee7bfb1c417aa8624a5a5c9de438tplv-k3u1fbpfcp-zoom-in-crop-mark1512000.webp" alt="SpringBootè‡ªåŠ¨é…ç½®æµç¨‹.png"></p><h2 id="Springbootå¸¸è§æ³¨è§£æœ‰å“ªäº›"><a href="#Springbootå¸¸è§æ³¨è§£æœ‰å“ªäº›" class="headerlink" title="Springbootå¸¸è§æ³¨è§£æœ‰å“ªäº›"></a>Springbootå¸¸è§æ³¨è§£æœ‰å“ªäº›</h2><p>Spring Bootçš„æ ¸å¿ƒæ³¨è§£æ˜¯@SpringBootApplication , ä»–ç”±å‡ ä¸ªæ³¨è§£ç»„æˆ : </p><ul><li>@SpringBootConfigurationï¼š ç»„åˆäº†- @Configurationæ³¨è§£ï¼Œå®ç°é…ç½®æ–‡ä»¶çš„åŠŸèƒ½ï¼›</li><li>@EnableAutoConfigurationï¼šæ‰“å¼€è‡ªåŠ¨é…ç½®çš„åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥å…³é—­æŸä¸ªè‡ªåŠ¨é…ç½®çš„é€‰é¡¹</li><li>@ComponentScanï¼šSpringï¼šç»„ä»¶æ‰«æ</li></ul><h1 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h1><h2 id="MyBatisæ‰§è¡Œæµç¨‹"><a href="#MyBatisæ‰§è¡Œæµç¨‹" class="headerlink" title="MyBatisæ‰§è¡Œæµç¨‹"></a>MyBatisæ‰§è¡Œæµç¨‹</h2><p>â‘ è¯»å–MyBatisé…ç½®æ–‡ä»¶ï¼šmybatis-config.xmlåŠ è½½è¿è¡Œç¯å¢ƒå’Œæ˜ å°„æ–‡ä»¶</p><p>â‘¡æ„é€ ä¼šè¯å·¥å‚SqlSessionFactoryï¼Œä¸€ä¸ªé¡¹ç›®åªéœ€è¦ä¸€ä¸ªï¼Œå•ä¾‹çš„ï¼Œä¸€èˆ¬ç”±springè¿›è¡Œç®¡ç†</p><p>â‘¢ä¼šè¯å·¥å‚åˆ›å»ºSqlSessionå¯¹è±¡ï¼Œè¿™é‡Œé¢å°±å«äº†æ‰§è¡ŒSQLè¯­å¥çš„æ‰€æœ‰æ–¹æ³•</p><p>â‘£æ“ä½œæ•°æ®åº“çš„æ¥å£ï¼ŒExecutoræ‰§è¡Œå™¨ï¼ŒåŒæ—¶è´Ÿè´£æŸ¥è¯¢å’Œç¼“å­˜çš„ç»´æŠ¤</p><p>â‘¤Executoræ¥å£çš„æ‰§è¡Œæ–¹æ³•ä¸­æœ‰ä¸€ä¸ªMappedStatementç±»å‹çš„å‚æ•°ï¼Œå°è£…äº†æ˜ å°„ä¿¡æ¯</p><p>â‘¥è¾“å…¥å‚æ•°æ˜ å°„ï¼ˆå°†Javaå¯¹è±¡è½¬æ¢ä¸ºæ•°æ®åº“çš„ä¿¡æ¯ï¼‰</p><p>â‘¦è¾“å‡ºç»“æœæ˜ å°„ï¼ˆå°†æ•°æ®åº“çš„ä¿¡æ¯è½¬æ¢ä¸ºJavaå¯¹è±¡ï¼‰</p><h2 id="Mybatisæ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½"><a href="#Mybatisæ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½" class="headerlink" title="Mybatisæ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½"></a>Mybatisæ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½</h2><p>æ˜¯æ”¯æŒçš„ï¼Œå»¶è¿ŸåŠ è½½çš„æ„æ€æ˜¯ï¼šå®ƒå…è®¸åœ¨éœ€è¦æ—¶æ‰åŠ è½½å…³è”å¯¹è±¡çš„æ•°æ®ï¼Œè€Œä¸æ˜¯åœ¨ä¸»æŸ¥è¯¢æ—¶å°±å°†å…³è”å¯¹è±¡çš„æ•°æ®å…¨éƒ¨åŠ è½½è¿›æ¥ã€‚</p><p>Mybatisæ”¯æŒä¸€å¯¹ä¸€å…³è”å¯¹è±¡å’Œä¸€å¯¹å¤šå…³è”é›†åˆå¯¹è±¡çš„å»¶è¿ŸåŠ è½½</p><p>åœ¨Mybatisé…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é…ç½®æ˜¯å¦å¯ç”¨å»¶è¿ŸåŠ è½½lazyLoadingEnabled&#x3D;true|falseï¼Œé»˜è®¤æ˜¯å…³é—­çš„</p><p><strong>å»¶è¿ŸåŠ è½½çš„ä¾‹å­ï¼š</strong></p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªå®ä½“ç±»ï¼š<code>User</code> å’Œ <code>Order</code>ï¼Œå®ƒä»¬ä¹‹é—´å­˜åœ¨ä¸€å¯¹å¤šçš„å…³è”å…³ç³»ï¼Œå³ä¸€ä¸ªç”¨æˆ·å¯ä»¥æ‹¥æœ‰å¤šä¸ªè®¢å•ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>User</code>æ˜¯ä¸»å®ä½“ï¼Œ<code>Order</code>æ˜¯å…³è”å®ä½“ã€‚</p><p>é¦–å…ˆï¼Œå®šä¹‰ <code>User</code> ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Order&gt; orders; <span class="comment">// å…³è”å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// çœç•¥æ„é€ æ–¹æ³•å’Œå…¶ä»–å±æ€§çš„getterå’Œsetter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œå®šä¹‰ <code>Order</code> ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String orderNumber;</span><br><span class="line">    <span class="keyword">private</span> User user; <span class="comment">// å…³è”å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// çœç•¥æ„é€ æ–¹æ³•å’Œå…¶ä»–å±æ€§çš„getterå’Œsetter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>UserMapper</code> ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œé€šè¿‡ç”¨æˆ·IDæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯åŠå…¶å…³è”çš„è®¢å•ä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    User <span class="title function_">getUserWithOrders</span><span class="params">(Long userId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ MyBatis çš„ XML é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ResultMap é…ç½®æ¥æŒ‡å®šå…³è”å¯¹è±¡çš„æ˜ å°„å…³ç³»ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userWithOrdersMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;orders&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Order&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;orderMap&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;orderMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Order&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;order_id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;orderNumber&quot;</span> <span class="attr">column</span>=<span class="string">&quot;order_number&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æœ€åï¼Œåœ¨æŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å»¶è¿ŸåŠ è½½ï¼Œç¡®ä¿åœ¨éœ€è¦æ—¶æ‰åŠ è½½å…³è”å¯¹è±¡çš„æ•°æ®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> <span class="comment">// è·å– SqlSession çš„æ–¹æ³•ï¼Œè¿™é‡Œçœç•¥</span></span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.getUserWithOrders(<span class="number">1L</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ­¤æ—¶å…³è”å¯¹è±¡ orders å¹¶æœªè¢«ç«‹å³åŠ è½½ï¼Œåªæœ‰åœ¨è®¿é—® orders æ—¶æ‰è§¦å‘åŠ è½½</span></span><br><span class="line">        List&lt;Order&gt; orders = user.getOrders();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åœ¨è¿™é‡Œï¼Œè®¿é—® orders å±æ€§ï¼Œä¼šè§¦å‘å»¶è¿ŸåŠ è½½ï¼ŒæŸ¥è¯¢å…³è”çš„è®¢å•æ•°æ®</span></span><br><span class="line">        <span class="keyword">for</span> (Order order : orders) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Order ID: &quot;</span> + order.getId() + <span class="string">&quot;, Order Number: &quot;</span> + order.getOrderNumber());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç¤ºä¾‹æ¼”ç¤ºäº†é€šè¿‡ MyBatis è¿›è¡Œå»¶è¿ŸåŠ è½½ï¼Œåªåœ¨éœ€è¦æ—¶æ‰åŠ è½½å…³è”å¯¹è±¡çš„æ•°æ®ï¼Œè€Œä¸æ˜¯åœ¨ä¸»æŸ¥è¯¢æ—¶å°±å°†å…³è”å¯¹è±¡çš„æ•°æ®å…¨éƒ¨åŠ è½½è¿›æ¥ã€‚</p><h2 id="å»¶è¿ŸåŠ è½½çš„åº•å±‚åŸç†çŸ¥é“å—"><a href="#å»¶è¿ŸåŠ è½½çš„åº•å±‚åŸç†çŸ¥é“å—" class="headerlink" title="å»¶è¿ŸåŠ è½½çš„åº•å±‚åŸç†çŸ¥é“å—"></a>å»¶è¿ŸåŠ è½½çš„åº•å±‚åŸç†çŸ¥é“å—</h2><p>å»¶è¿ŸåŠ è½½åœ¨åº•å±‚ä¸»è¦ä½¿ç”¨çš„CGLIBåŠ¨æ€ä»£ç†å®Œæˆçš„</p><p>ç¬¬ä¸€æ˜¯ï¼Œä½¿ç”¨CGLIBåˆ›å»ºç›®æ ‡å¯¹è±¡çš„<strong>ä»£ç†å¯¹è±¡</strong>ï¼Œè¿™é‡Œçš„ç›®æ ‡å¯¹è±¡å°±æ˜¯å¼€å¯äº†å»¶è¿ŸåŠ è½½çš„mapper</p><p>ç¬¬äºŒä¸ªæ˜¯å½“è°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ï¼Œè¿›å…¥<strong>æ‹¦æˆªå™¨invokeæ–¹æ³•</strong>ï¼Œå‘ç°ç›®æ ‡æ–¹æ³•æ˜¯nullå€¼ï¼Œå†æ‰§è¡ŒsqlæŸ¥è¯¢</p><p>ç¬¬ä¸‰ä¸ªæ˜¯è·å–æ•°æ®ä»¥åï¼Œè°ƒç”¨setæ–¹æ³•è®¾ç½®å±æ€§å€¼ï¼Œå†ç»§ç»­æŸ¥è¯¢ç›®æ ‡æ–¹æ³•ï¼Œå°±æœ‰å€¼äº†</p><h2 id="Mybatisçš„ä¸€çº§ã€äºŒçº§ç¼“å­˜ç”¨è¿‡å—"><a href="#Mybatisçš„ä¸€çº§ã€äºŒçº§ç¼“å­˜ç”¨è¿‡å—" class="headerlink" title="Mybatisçš„ä¸€çº§ã€äºŒçº§ç¼“å­˜ç”¨è¿‡å—"></a>Mybatisçš„ä¸€çº§ã€äºŒçº§ç¼“å­˜ç”¨è¿‡å—</h2><p>mybatisçš„ä¸€çº§ç¼“å­˜: åŸºäº PerpetualCache çš„ HashMap æœ¬åœ°ç¼“å­˜ï¼Œå…¶å­˜å‚¨ä½œç”¨åŸŸä¸º Sessionï¼Œå½“Sessionè¿›è¡Œflushæˆ–closeä¹‹åï¼Œè¯¥Sessionä¸­çš„æ‰€æœ‰Cacheå°±å°†æ¸…ç©ºï¼Œé»˜è®¤æ‰“å¼€ä¸€çº§ç¼“å­˜</p><p>å…³äºäºŒçº§ç¼“å­˜éœ€è¦å•ç‹¬å¼€å¯</p><p>äºŒçº§ç¼“å­˜æ˜¯åŸºäºnamespaceå’Œmapperçš„ä½œç”¨åŸŸèµ·ä½œç”¨çš„ï¼Œä¸æ˜¯ä¾èµ–äºSQL sessionï¼Œé»˜è®¤ä¹Ÿæ˜¯é‡‡ç”¨ PerpetualCacheï¼ŒHashMap å­˜å‚¨ã€‚</p><p>å¦‚æœæƒ³è¦å¼€å¯äºŒçº§ç¼“å­˜éœ€è¦åœ¨å…¨å±€é…ç½®æ–‡ä»¶å’Œæ˜ å°„æ–‡ä»¶ä¸­å¼€å¯é…ç½®æ‰è¡Œã€‚</p><p>Mybatisçš„äºŒçº§ç¼“å­˜ä»€ä¹ˆæ—¶å€™ä¼šæ¸…ç†ç¼“å­˜ä¸­çš„æ•°æ®ï¼Ÿ</p><p>å½“æŸä¸€ä¸ªä½œç”¨åŸŸ(ä¸€çº§ç¼“å­˜ Session&#x2F;äºŒçº§ç¼“å­˜Namespaces)çš„è¿›è¡Œäº†<strong>æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤æ“ä½œå</strong>ï¼Œé»˜è®¤è¯¥ä½œç”¨åŸŸä¸‹æ‰€æœ‰ select ä¸­çš„ç¼“å­˜å°†è¢« clearã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç»“æ„ä¸ç®—æ³•</title>
      <link href="/2023/10/03/Study-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
      <url>/2023/10/03/Study-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="KMP"><a href="#KMP" class="headerlink" title="KMP"></a>KMP</h1><h1 id="ä½è¿ç®—"><a href="#ä½è¿ç®—" class="headerlink" title="ä½è¿ç®—"></a>ä½è¿ç®—</h1><p>å¼‚æˆ–è¿ç®—ï¼Œä¹Ÿç§°ä¸º XOR è¿ç®—ï¼Œæ˜¯ä¸€ç§é€»è¾‘è¿ç®—ç¬¦ã€‚å®ƒçš„è¿ç®—è§„åˆ™æ˜¯ï¼šå¯¹åº”ä½ç›¸åŒä¸º0ï¼Œä¸åŒä¸º1ã€‚</p><p>7ç§ä½è¿ç®—çš„è¯¦ç»†ç‰¹æ€§å’Œç¤ºä¾‹ï¼š</p><ol><li>ä¸è¿ç®—ï¼ˆANDï¼‰ï¼š</li></ol><ul><li>ä»»ä½•æ•°å’Œ0åšä¸è¿ç®—ï¼Œç»“æœæ˜¯0ï¼Œå³ x &amp; 0 &#x3D; 0ã€‚ä¾‹å¦‚ï¼Œ5ï¼ˆ101ï¼‰ &amp; 0 &#x3D; 0ã€‚</li><li>ä»»ä½•æ•°å’Œå…¶è‡ªèº«åšä¸è¿ç®—ï¼Œç»“æœæ˜¯è‡ªèº«ï¼Œå³ x &amp; x &#x3D; xã€‚ä¾‹å¦‚ï¼Œ5ï¼ˆ101ï¼‰ &amp; 5ï¼ˆ101ï¼‰ &#x3D; 5ï¼ˆ101ï¼‰ã€‚</li></ul><ol start="2"><li>æˆ–è¿ç®—ï¼ˆORï¼‰ï¼š</li></ol><ul><li>ä»»ä½•æ•°å’Œ0åšæˆ–è¿ç®—ï¼Œç»“æœæ˜¯è‡ªèº«ï¼Œå³ x | 0 &#x3D; xã€‚ä¾‹å¦‚ï¼Œ5ï¼ˆ101ï¼‰ | 0 &#x3D; 5ï¼ˆ101ï¼‰ã€‚</li><li>ä»»ä½•æ•°å’Œå…¶è‡ªèº«åšæˆ–è¿ç®—ï¼Œç»“æœæ˜¯è‡ªèº«ï¼Œå³ x | x &#x3D; xã€‚ä¾‹å¦‚ï¼Œ5ï¼ˆ101ï¼‰ | 5ï¼ˆ101ï¼‰ &#x3D; 5ï¼ˆ101ï¼‰ã€‚</li></ul><ol start="3"><li>å¼‚æˆ–è¿ç®—ï¼ˆXORï¼‰ï¼š</li></ol><ul><li>ä»»ä½•æ•°å’Œ0åšå¼‚æˆ–è¿ç®—ï¼Œç»“æœæ˜¯è‡ªèº«ï¼Œå³ x ^ 0 &#x3D; xã€‚ä¾‹å¦‚ï¼Œ5ï¼ˆ101ï¼‰ ^ 0 &#x3D; 5ï¼ˆ101ï¼‰ã€‚</li><li>ä»»ä½•æ•°å’Œå…¶è‡ªèº«åšå¼‚æˆ–è¿ç®—ï¼Œç»“æœæ˜¯0ï¼Œå³ x ^ x &#x3D; 0ã€‚ä¾‹å¦‚ï¼Œ5ï¼ˆ101ï¼‰ ^ 5ï¼ˆ101ï¼‰ &#x3D; 0ã€‚</li><li>å¼‚æˆ–è¿ç®—æ»¡è¶³äº¤æ¢å¾‹å’Œç»“åˆå¾‹ï¼Œå³ a ^ b ^ c &#x3D; a ^ (b ^ c) &#x3D; (a ^ b) ^ cã€‚ä¾‹å¦‚ï¼Œ5ï¼ˆ101ï¼‰ ^ 3ï¼ˆ011ï¼‰ ^ 4ï¼ˆ100ï¼‰ &#x3D; 5 ^ (3 ^ 4) &#x3D; (5 ^ 3) ^ 4ã€‚</li></ul><ol start="4"><li>éè¿ç®—ï¼ˆNOTï¼‰ï¼š</li></ol><ul><li>éè¿ç®—ä¼šåè½¬æ“ä½œæ•°çš„æ‰€æœ‰ä½ã€‚ä¾‹å¦‚ï¼Œ~5ï¼ˆ101ï¼‰ &#x3D; 2ï¼ˆ010ï¼‰ã€‚</li></ul><ol start="5"><li>å·¦ç§»è¿ç®—ï¼ˆSHLï¼‰ï¼š</li></ol><ul><li>å·¦ç§»nä½ç­‰äºä¹˜ä»¥2çš„næ¬¡æ–¹ï¼Œå³ x &lt;&lt; n &#x3D; x * 2^nã€‚ä¾‹å¦‚ï¼Œ5ï¼ˆ101ï¼‰ &lt;&lt; 2 &#x3D; 20ï¼ˆ10100ï¼‰ã€‚</li><li>å·¦ç§»è¿ç®—ä¸æ”¹å˜æ“ä½œæ•°çš„ç¬¦å·ä½ã€‚</li></ul><ol start="6"><li>é€»è¾‘å³ç§»è¿ç®—ï¼ˆSHRï¼‰ï¼š</li></ol><ul><li>å³ç§»nä½ç­‰äºé™¤ä»¥2çš„næ¬¡æ–¹ï¼Œå³ x &gt;&gt; n &#x3D; x &#x2F; 2^nã€‚ä¾‹å¦‚ï¼Œ20ï¼ˆ10100ï¼‰ &gt;&gt; 2 &#x3D; 5ï¼ˆ101ï¼‰ã€‚</li><li>é€»è¾‘å³ç§»è¿ç®—ä¼šç”¨0å¡«å……ç§»ä½åäº§ç”Ÿçš„ç©ºä½ã€‚</li></ul><ol start="7"><li>ç®—æœ¯å³ç§»è¿ç®—ï¼ˆSARï¼‰ï¼š</li></ol><ul><li>ç®—æœ¯å³ç§»è¿ç®—ä¼šç”¨ç¬¦å·ä½å¡«å……ç§»ä½åäº§ç”Ÿçš„ç©ºä½ï¼Œå› æ­¤å®ƒå¯ä»¥ä¿æŒè´Ÿæ•°çš„ç¬¦å·ã€‚ä¾‹å¦‚ï¼Œå¯¹äºè´Ÿæ•°-5ï¼ˆ1011ï¼‰ &gt;&gt;&gt; 2 &#x3D; -2ï¼ˆ1110ï¼‰ã€‚</li></ul><h1 id="è¿›åˆ¶è½¬æ¢"><a href="#è¿›åˆ¶è½¬æ¢" class="headerlink" title="è¿›åˆ¶è½¬æ¢"></a>è¿›åˆ¶è½¬æ¢</h1><p><img src="/../assets/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/image-20231029205712433.png" alt="image-20231029205712433"></p><p><img src="/../assets/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/image-20231029204913410.png" alt="image-20231029204913410"></p><p><img src="/../assets/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/image-20231029204333810.png" alt="image-20231029204333810"></p><p><img src="/../assets/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/image-20231029204306242.png" alt="image-20231029204306242"></p><h1 id="å“ˆå¤«æ›¼æ ‘"><a href="#å“ˆå¤«æ›¼æ ‘" class="headerlink" title="å“ˆå¤«æ›¼æ ‘"></a>å“ˆå¤«æ›¼æ ‘</h1><h1 id="å¹¶æŸ¥é›†"><a href="#å¹¶æŸ¥é›†" class="headerlink" title="å¹¶æŸ¥é›†"></a>å¹¶æŸ¥é›†</h1><h1 id="å›¾"><a href="#å›¾" class="headerlink" title="å›¾"></a>å›¾</h1><h1 id="è·³è·ƒè¡¨"><a href="#è·³è·ƒè¡¨" class="headerlink" title="è·³è·ƒè¡¨"></a>è·³è·ƒè¡¨</h1><blockquote><p>æ˜¯redisä¸­çš„zsetçš„åº•å±‚æ•°æ®ç»“æ„å®ç°ä¹‹ä¸€ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯hash</p></blockquote><p>è·³è·ƒè¡¨å®è´¨ä¸Šæ˜¯å¯¹ä¸€ä¸ªæœ‰åºçš„é“¾è¡¨è¿›è¡Œ<strong>ç±»ä¼¼äºäºŒåˆ†æŸ¥æ‰¾</strong>çš„æ•°æ®ç»“æ„ï¼Œå…¶æ€§èƒ½ä¸çº¢é»‘æ ‘ï¼ŒAVLæ ‘ä¸ç›¸ä¸Šä¸‹ã€‚</p><p>åŸæœ¬è¦ä¾æ¬¡éå†ä»1å¼€å§‹æ‰¾17ï¼Œç°åœ¨ä»ä¸‰çº§ç´¢å¼•æ‰¾åˆ°10ï¼Œå†ä»äºŒçº§ç´¢å¼•æ‰¾åˆ°15ï¼Œåœ¨ä¸€çº§ç´¢å¼•å°±èƒ½æ‰¾åˆ°17äº†ã€‚</p><p><img src="/../assets/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/image-20231023222430354.png" alt="è·³è·ƒè¡¨"></p><h1 id="äºŒå‰æ ‘"><a href="#äºŒå‰æ ‘" class="headerlink" title="äºŒå‰æ ‘"></a>äºŒå‰æ ‘</h1><p>ç”¨æ•°ç»„å»æ„é€ äºŒå‰æ ‘çš„æ—¶å€™ï¼Œéƒ½æ˜¯éµå¾ªä¸€ä¸ªè§„åˆ™ç±»ä¼¼äºå·¦é—­å³é—­ï¼Œç„¶åç”¨ç´¢å¼•å»åˆ‡å‰²æ•°ç»„ï¼Œè€Œä¸æ˜¯çœŸçš„å»æµªè´¹æ—¶é—´å’Œç©ºé—´å»åˆ‡å‰²æ•°ç»„ã€‚</p><p>åœ¨æ‰¾åˆ°ç»“ç‚¹åï¼Œæƒ³æ‰¾å…¶çˆ¶èŠ‚ç‚¹æ—¶ï¼Œå¯ä»¥åœ¨å…¨å±€å˜é‡ä¸­å®šä¹‰ä¸€ä¸ª<code>TreeNode pre</code>æ¥è®°å½•å‰ä¸€ä¸ªç»“ç‚¹ï¼Œè¿™ä¸ªå‰ä¸€ä¸ªç»“ç‚¹å¯ä»¥ç”¨æ¥å½“ä»–çš„çˆ¶èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥åœ¨äºŒå‰æœç´¢æ ‘ä¸­è®°å½•ä¸­åºéå†çš„å‰ä¸€ä¸ªå°äºä»–çš„ç»“ç‚¹ã€‚</p><h2 id="äºŒå‰æœç´¢æ ‘"><a href="#äºŒå‰æœç´¢æ ‘" class="headerlink" title="äºŒå‰æœç´¢æ ‘"></a>äºŒå‰æœç´¢æ ‘</h2><p>åœ¨äºŒå‰æœç´¢æ ‘ä¸Šæ±‚ä»€ä¹ˆæœ€å€¼å•Šï¼Œå·®å€¼ä¹‹ç±»çš„ï¼Œå°±æŠŠå®ƒæƒ³æˆåœ¨ä¸€ä¸ªæœ‰åºæ•°ç»„ï¼ˆå³å¯¹äºŒå‰æœç´¢æ ‘åšä¸­åºéå†ï¼‰ä¸Šæ±‚æœ€å€¼ï¼Œæ±‚å·®å€¼ã€‚</p><p>å¯¹äºäºŒå‰æœç´¢æ ‘çš„æ·»åŠ åˆ é™¤æ“ä½œå¯ä»¥ç”¨TreeNodeçš„è¿”å›å€¼ï¼Œè®©å…¶è¿”å›å€¼ä¼ é€’ç»™ä¸Šä¸€å±‚é€’å½’ï¼Œè®©ä¸Šä¸€å±‚é€’å½’å»æ¥ä½è¿™ä¸ªç»“æœï¼Œæ¯”å¦‚åœ¨ä¸‹ä¸€å±‚è¿”å›åˆ°ä¸Šä¸€å±‚å¯ä»¥æ¸…æ™°åœ°çŸ¥é“ä¸Šä¸€å±‚æ˜¯å·¦è¾¹è¿˜æ˜¯å³è¾¹çš„å­©å­åº”è¯¥å»æ¥ä½è¿™ä¸ªè¿”å›ä¸Šæ¥çš„ç»“æœã€‚</p><h2 id="AVLæ ‘"><a href="#AVLæ ‘" class="headerlink" title="AVLæ ‘"></a>AVLæ ‘</h2><p><a href="https://www.bilibili.com/video/BV1dr4y1j7Mz/?spm_id_from=333.788&vd_source=fa7ba4ae353f08f1d08d1bb24528e96c">https://www.bilibili.com/video/BV1dr4y1j7Mz/?spm_id_from=333.788&amp;vd_source=fa7ba4ae353f08f1d08d1bb24528e96c</a></p><p><a href="https://www.bilibili.com/video/BV15a411D7tr/?spm_id_from=333.788&vd_source=fa7ba4ae353f08f1d08d1bb24528e96c">https://www.bilibili.com/video/BV15a411D7tr/?spm_id_from=333.788&amp;vd_source=fa7ba4ae353f08f1d08d1bb24528e96c</a></p><h1 id="å›æº¯"><a href="#å›æº¯" class="headerlink" title="å›æº¯"></a>å›æº¯</h1><p><strong>åšé¢˜å…³é”®</strong>ï¼šå›æº¯éƒ½å¯ä»¥ç”»æˆä¸€é¢—æ ‘ï¼Œç”»æˆæ ‘å±‚ç»“æ„å°±å¥½æ‡‚äº†</p><h2 id="ç»„åˆ"><a href="#ç»„åˆ" class="headerlink" title="ç»„åˆ"></a>ç»„åˆ</h2><ul><li>ç»„åˆä¸­æœ€é‡è¦çš„æ˜¯startIndexï¼ˆä¸‹ä¸€æ¬¡éå†çš„èµ·å§‹ä½ç½®ï¼‰</li></ul><p>å¦‚æœæ˜¯ä¸€ä¸ªé›†åˆæ¥æ±‚ç»„åˆçš„è¯ï¼Œå°±éœ€è¦startIndexï¼Œ</p><p>å¦‚æœæ˜¯å¤šä¸ªé›†åˆå–ç»„åˆï¼Œå„ä¸ªé›†åˆä¹‹é—´ç›¸äº’ä¸å½±å“ï¼Œé‚£ä¹ˆå°±ä¸ç”¨startIndex</p><p>ç»™å®šä¸¤ä¸ªæ•´æ•° n å’Œ kï¼Œè¿”å› 1 â€¦ n ä¸­æ‰€æœ‰å¯èƒ½çš„ k ä¸ªæ•°çš„ç»„åˆã€‚</p><p>ç¤ºä¾‹: è¾“å…¥: n &#x3D; 4, k &#x3D; 2 è¾“å‡º: [ [2,4], [3,4], [2,3], [1,2], [1,3], [1,4], ]</p><p>ç»„åˆæ¨¡æ¿</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"></span><br><span class="line">    ArrayList&lt;List&lt;Integer&gt;&gt; res;</span><br><span class="line">    ArrayList&lt;Integer&gt; list;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combine</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        back(n, k, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">back</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k, <span class="type">int</span> startIndex)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (list.size() &gt;= k) &#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> startIndex; i &lt;= n-(k-list.size())+<span class="number">1</span>; i++) &#123;</span><br><span class="line">            list.add(i);</span><br><span class="line">            back(n, k, i + <span class="number">1</span>);</span><br><span class="line">            list.remove(list.size() - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰ªæä¼˜åŒ–è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>å·²ç»é€‰æ‹©çš„å…ƒç´ ä¸ªæ•°ï¼špath.size();</li><li>æ‰€éœ€éœ€è¦çš„å…ƒç´ ä¸ªæ•°ä¸º: k - path.size();</li><li>åˆ—è¡¨ä¸­å‰©ä½™å…ƒç´ ï¼ˆn-iï¼‰ &gt;&#x3D; æ‰€éœ€éœ€è¦çš„å…ƒç´ ä¸ªæ•°ï¼ˆk - path.size()ï¼‰</li><li>åœ¨é›†åˆnä¸­è‡³å¤šè¦ä»è¯¥èµ·å§‹ä½ç½® : i &lt;&#x3D; n - (k - path.size()) + 1ï¼Œå¼€å§‹éå†</li></ol><h3 id="æ ‘å±‚å»é‡"><a href="#æ ‘å±‚å»é‡" class="headerlink" title="æ ‘å±‚å»é‡"></a>æ ‘å±‚å»é‡</h3><p>åŒä¸€æ ‘å±‚ä¸Šä¸èƒ½å–ç›¸åŒçš„å€¼ï¼Œå¦åˆ™å°±ä¸ä¹‹å‰çš„é‡å¤äº†</p><ul><li><strong>åˆ©ç”¨usedæ•°ç»„åšæ ‘å±‚å»é‡</strong>ï¼šè¿™æ˜¯è¦å°†<strong>æ•°ç»„è¿›è¡Œæ’åºå</strong>ï¼Œå‰ä¸€ä¸ªæ•°å’Œå½“å‰æ•°ç›¸åŒï¼Œä¸”å‰ä¸€ä¸ªæ•°æ²¡è¢«ä½¿ç”¨è¿‡çš„æƒ…å†µï¼ˆå‰ä¸€ä¸ªæ•°è¢«ä½¿ç”¨äº†ä¸èƒ½å»ï¼Œå› ä¸ºè¿™æ˜¯æ ‘æä¸Šçš„ï¼Œæ ‘æä¸ç”¨å»é‡ï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(i&gt;<span class="number">0</span>&amp;&amp;!used[i-<span class="number">1</span>]&amp;&amp;nums[i]==nums[i-<span class="number">1</span>])&#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>åˆ©ç”¨HashSetåšæ ‘å±‚å»é‡</strong>ï¼šå½“<strong>æ•°ç»„ä¸èƒ½è¢«æ’åºæ—¶</strong>ï¼Œä¾‹å¦‚é€’å¢å­åºåˆ—é‚£é¢˜ï¼Œæœ¬è´¨ä¸Šå…¶å®éƒ½æ˜¯ä¸ºäº†ä¿è¯å½“å‰æ ‘å±‚ä¸Šä¸èƒ½å–åˆ°åŒæ ·çš„æ•°</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (hashSet.contains(nums[i]))&#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åˆ©ç”¨HashSetåšæ ‘å±‚å»é‡æ˜¯<strong>é€šç”¨æ–¹æ³•</strong>ï¼Œä½†æ˜¯æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦ä¸Šå»äº†</p></blockquote><h2 id="åˆ†å‰²"><a href="#åˆ†å‰²" class="headerlink" title="åˆ†å‰²"></a>åˆ†å‰²</h2><p>åˆ†å‰²çš„æœ¬è´¨è¿˜æ˜¯ç»„åˆ</p><p>ä¾‹å¦‚å¯¹äºå­—ç¬¦ä¸²abcdefï¼š</p><ul><li>ç»„åˆé—®é¢˜ï¼šé€‰å–ä¸€ä¸ªaä¹‹åï¼Œåœ¨bcdefä¸­å†å»é€‰å–ç¬¬äºŒä¸ªï¼Œé€‰å–bä¹‹ååœ¨cdefä¸­å†é€‰å–ç¬¬ä¸‰ä¸ªâ€¦..ã€‚</li><li>åˆ‡å‰²é—®é¢˜ï¼šåˆ‡å‰²ä¸€ä¸ªaä¹‹åï¼Œåœ¨bcdefä¸­å†å»åˆ‡å‰²ç¬¬äºŒæ®µï¼Œåˆ‡å‰²bä¹‹ååœ¨cdefä¸­å†åˆ‡å‰²ç¬¬ä¸‰æ®µâ€¦..ã€‚</li></ul><p><img src="/../assets/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/image-20231016103652105.png" alt="image-20231016103652105"></p><p>å†™æ³•ä¹ æƒ¯ï¼šåœ¨forå¾ªç¯ä¸­é‡åˆ°ä¸ç¬¦åˆæ¡ä»¶çš„å°±ç›´æ¥continueè·³è¿‡äº†</p><p>æ¨¡æ¿ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    </span><br><span class="line">    ArrayList&lt;List&lt;String&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    LinkedList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="title function_">partition</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        back(s, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">back</span><span class="params">(String s, <span class="type">int</span> startIndex)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (startIndex &gt;= s.length()) &#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> startIndex; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!isPalindrome(s, startIndex, i)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125; </span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> s.substring(startIndex, i + <span class="number">1</span>);</span><br><span class="line">            list.add(str);</span><br><span class="line">            back(s, i + <span class="number">1</span>);</span><br><span class="line">            list.pollLast();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isPalindrome</span><span class="params">(String s, <span class="type">int</span> left, <span class="type">int</span> right)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s.charAt(left) != s.charAt(right)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            left++;</span><br><span class="line">            right--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å­é›†"><a href="#å­é›†" class="headerlink" title="å­é›†"></a>å­é›†</h2><p>å¦‚æœæŠŠ å­é›†é—®é¢˜ã€ç»„åˆé—®é¢˜ã€åˆ†å‰²é—®é¢˜éƒ½æŠ½è±¡ä¸ºä¸€æ£µæ ‘çš„è¯ï¼Œ<strong>é‚£ä¹ˆç»„åˆé—®é¢˜å’Œåˆ†å‰²é—®é¢˜éƒ½æ˜¯æ”¶é›†æ ‘çš„å¶å­èŠ‚ç‚¹ï¼Œè€Œå­é›†é—®é¢˜æ˜¯æ‰¾æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹ï¼</strong></p><p>æ¨¡æ¿ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    ArrayList&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    LinkedList&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">subsets</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        back(nums, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">back</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> startIndex)</span> &#123;</span><br><span class="line">        res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> startIndex; i &lt; nums.length; i++) &#123;</span><br><span class="line">            list.add(nums[i]);</span><br><span class="line">            back(nums, i + <span class="number">1</span>);</span><br><span class="line">            list.pollLast();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ’åˆ—"><a href="#æ’åˆ—" class="headerlink" title="æ’åˆ—"></a>æ’åˆ—</h2><p>ä¸Šé¢ä¸‰ç§å…¶å®éƒ½å¯ä»¥ç§°ä¸ºç»„åˆï¼Œæ’åˆ—ä¸éœ€è¦startIndexå»è§„å®šéå†çš„èµ·å§‹ä½ç½®ï¼Œå› ä¸ºæ’åˆ—ä¸­æ¯æ¬¡éƒ½æ˜¯ä»i&#x3D;0å¼€å§‹éå†å®Œæ‰€æœ‰<strong>æœªè¢«ä½¿ç”¨</strong>çš„æ•°ï¼Œè¿™é‡Œçš„æœªè¢«ä½¿ç”¨éœ€è¦ä½¿ç”¨åˆ°usedæ•°ç»„å»åˆ¤æ–­ï¼Œæ‰€ä»¥æ’åˆ—çš„é¢˜éƒ½éœ€è¦æœ‰usedæ•°ç»„</p><h1 id="åŠ¨æ€è§„åˆ’"><a href="#åŠ¨æ€è§„åˆ’" class="headerlink" title="åŠ¨æ€è§„åˆ’"></a>åŠ¨æ€è§„åˆ’</h1><h2 id="01èƒŒåŒ…"><a href="#01èƒŒåŒ…" class="headerlink" title="01èƒŒåŒ…"></a>01èƒŒåŒ…</h2><ol><li>é¦–å…ˆæ˜¯è¦ç¡®å®šdpæ•°ç»„å’Œå…¶ä¸‹æ ‡çš„å«ä¹‰</li></ol><p><code>dp[i][j]</code>æŒ‡çš„æ˜¯åœ¨0åˆ°içš„ç‰©å“ä¸­é€‰ï¼Œä¸”å®¹é‡ä¸è¶…è¿‡jçš„æœ€å¤§ä»·å€¼</p><ol start="2"><li>ç¡®å®šé€’æ¨å…¬å¼</li></ol><p>è¦åˆ¤æ–­å½“å‰ä½ç½®ï¼ˆå³å½“å‰èƒ½é€‰çš„ç‰©å“å’Œæ­¤æ—¶çš„æœ€å¤§å®¹é‡jï¼‰çš„æœ€å¤§ä»·å€¼ï¼Œåªæœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯ä¸æ”¾å½“å‰çš„ç‰©å“iï¼Œä¸€ç§æ˜¯æ”¾å½“å‰çš„ç‰©å“iã€‚</p><p>ä¸æ”¾å½“å‰ç‰©å“å°±æ˜¯å–<code>dp[i-1][j]</code>ï¼Œå…¶å«ä¹‰æ˜¯åœ¨è¿™ä¸ªæ­¤æ—¶çš„æœ€å¤§å®¹é‡æ—¶ï¼Œä¸æ”¾å½“å‰èƒ½æ–°æ”¾å…¥çš„ç‰©å“ï¼Œè€Œæ˜¯å–ä¸Šä¸€è¡Œï¼Œå³è¯¥ä½ç½®çš„æ­£ä¸Šæ–¹çš„å€¼ï¼Œæ„æ€å°±æ˜¯ï¼Œæˆ‘ä¸æ”¾å½“å‰è¿™ä¸ªç‰©å“iï¼Œé‚£é—®é¢˜å°±è½¬æ¢ä¸ºåœ¨0åˆ°i-1ç‰©å“ä¸­å»é€‰ä¸”æœ€å¤§å®¹é‡ä¸ºjçš„é—®é¢˜ã€‚</p><p>æ”¾å…¥å½“å‰ç‰©å“içš„é—®é¢˜åˆå¯ä»¥è½¬æ¢ä¸ºä¸æ”¾å…¥ç‰©å“iæ—¶ä¸”èƒŒåŒ…å®¹é‡ä¸º<code>j-weight[i]</code>çš„æœ€å¤§ä»·å€¼åŠ ä¸Šç‰©å“içš„ä»·å€¼ï¼Œè€Œä¸ºä»€ä¹ˆæ˜¯<code>j-weight[i]</code>å‘¢ï¼Œæ˜¯ä½¿å¾—åˆšå¥½èƒ½å¤Ÿæ”¾å…¥ç‰©å“içš„å®¹é‡æ—¶ï¼Œæ­¤æ—¶çš„æœ€å¤§ä»·å€¼ã€‚æ­¤æ—¶ä¸º<code>dp[i - 1][j - weight[i]] + value[i]</code>ï¼Œå«ä¹‰å°±æ˜¯åœ¨ä¸æ”¾ç‰©å“iæ—¶ï¼Œä¸”å‰©ä½™å®¹é‡èƒ½æ”¾ç‰©å“iæ—¶çš„æœ€å¤§ä»·å€¼ï¼Œæ­¤æ—¶å†åŠ ä¸Šç‰©å“içš„ä»·å€¼ã€‚</p><p><mark><strong>æ­¤æ—¶çš„èƒŒåŒ…å®¹é‡å‡å»ç‰©å“içš„é‡é‡æ‰€èƒ½æ”¾çš„æœ€å¤§ä»·å€¼åŠ ä¸Šç‰©å“içš„ä»·å€¼</strong></mark></p><p>æœ€åå°±æ˜¯ä¸¤ä¸ªå€¼å–æœ€å¤§å€¼ã€‚</p><p>è€Œ<code>j-weight[i]</code>å¯èƒ½ä¼š&lt;0ï¼Œå¯¼è‡´æ•°ç»„è¶Šç•Œï¼Œæ­¤æ—¶çš„å«ä¹‰å°±æ˜¯å½“å‰çš„æ•´ä¸ªå®¹é‡jéƒ½ä¸å¤Ÿå»æ”¾è¿™ä¸ªç‰©å“iï¼Œæ­¤æ—¶å–å…¶æ­£ä¸Šæ–¹çš„å€¼å³å¯ã€‚</p><ol start="3"><li>éå†é¡ºåº</li></ol><p>ä»é€’æ¨å…¬å¼å¯çŸ¥ï¼Œå½“å‰ä½ç½®çš„æœ€å¤§ä»·å€¼æ˜¯ç”±å…¶æ­£ä¸Šæ–¹çš„å€¼å’Œå·¦ä¸Šæ–¹çš„å€¼æ‰€ç¡®å®šçš„ï¼Œæ‰€ä»¥å…¶å®åªéœ€è¦åˆå§‹åŒ–æ•´ä¸ªäºŒç»´æ•°ç»„çš„å·¦ä¸Šè§’å³å¯ï¼Œåˆ—å°±æ˜¯å…¨éƒ¨ä¸º0ï¼Œå› ä¸ºå®¹é‡ä¸º0æ—¶ä¸ç®¡æ€ä¹ˆæ ·éƒ½æ”¾ä¸è¿›å»ç‰©å“ï¼Œæ•…ä»·å€¼ä¹Ÿä¸º0ï¼›è¡Œçš„æƒ…å†µè¦æ ¹æ®ç¬¬0ä¸ªç‰©å“çš„weightæ¥å†³å®šï¼Œå½“å½“å‰å®¹é‡j&gt;&#x3D;å…¶é‡é‡æ—¶ä»£è¡¨å¯ä»¥æ”¾è¿›å»äº†ï¼Œæ­¤æ—¶ä»·å€¼å°±ä¸ºç¬¬0ä¸ªç‰©å“çš„ä»·å€¼value[0]ã€‚</p><blockquote><p>æ»šåŠ¨æ•°ç»„è¡¥å……ï¼šå…¶å®å°±æ˜¯æŠŠäºŒç»´æ•°ç»„å‹ç¼©æˆä¸€ç»´æ•°ç»„äº†ï¼Œåˆå§‹åŒ–è¿˜æ˜¯ä¸€æ ·ï¼Œç„¶åä¸ºäº†ä¿è¯å½“å‰ä½ç½®çš„å€¼è¿˜æ˜¯ç”±å…¶å·¦ä¸Šæ–¹å’Œæ­£ä¸Šæ–¹æ‰€æ¨å¯¼å‡ºçš„ï¼Œæ•…åªèƒ½å…ˆéå†ç‰©å“iï¼Œå†å€’åºéå†å®¹é‡jï¼Œè¿™æ ·æ‰èƒ½ä¸è¦†ç›–åˆ°ä¸Šä¸€å±‚çš„å€¼ã€‚</p></blockquote><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">        <span class="type">int</span>[] weight = <span class="keyword">new</span> <span class="title class_">int</span>[m];</span><br><span class="line">        <span class="type">int</span>[] value = <span class="keyword">new</span> <span class="title class_">int</span>[m];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            weight[i] = scanner.nextInt();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            value[i] = scanner.nextInt();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[m][n + <span class="number">1</span>];</span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–dpæ•°ç»„</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt;= n; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (j &gt;= weight[<span class="number">0</span>]) &#123;</span><br><span class="line">                dp[<span class="number">0</span>][j] = value[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (j - weight[i] &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    dp[i][j] = dp[i - <span class="number">1</span>][j];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    dp[i][j] = Math.max(dp[i - <span class="number">1</span>][j], dp[i - <span class="number">1</span>][j - weight[i]] + value[i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(dp[m - <span class="number">1</span>][n]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ç»´æ»šåŠ¨æ•°ç»„ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">        <span class="type">int</span>[] weight = <span class="keyword">new</span> <span class="title class_">int</span>[m];</span><br><span class="line">        <span class="type">int</span>[] value = <span class="keyword">new</span> <span class="title class_">int</span>[m];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            weight[i] = scanner.nextInt();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            value[i] = scanner.nextInt();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>];</span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–dpæ•°ç»„</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt;= n; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (j &gt;= weight[<span class="number">0</span>]) &#123;</span><br><span class="line">                dp[j] = value[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> n; j &gt;= weight[i]; j--) &#123;</span><br><span class="line">                dp[j] = Math.max(dp[j], dp[j - weight[i]] + value[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(dp[n]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨01èƒŒåŒ…çš„è§£æ³•ï¼š"><a href="#ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨01èƒŒåŒ…çš„è§£æ³•ï¼š" class="headerlink" title="ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨01èƒŒåŒ…çš„è§£æ³•ï¼š"></a>ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨01èƒŒåŒ…çš„è§£æ³•ï¼š</h2><p>å½“ä¸€ä¸ªæ•°ç»„æ—¢è¡¨ç¤ºäº†ç‰©å“çš„é‡é‡åˆè¡¨ç¤ºäº†ç‰©å“çš„ä»·å€¼ï¼Œé‚£ä¹ˆæœ‰ï¼š</p><ol><li>ç»™ä¸€ä¸ªæ•°ç»„ï¼Œç»™ä¸€ä¸ªæ•°ï¼Œåˆ¤æ–­è¯¥æ•°ç»„ä¸­çš„å…ƒç´ <mark>èƒ½å¦è¾¾åˆ°è¿™ä¸ªæ•°çš„å€¼</mark>ï¼Œå› ä¸ºåªèƒ½&lt;&#x3D;è¿™ä¸ªæ•°çš„å€¼ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (j - nums[i] &lt; <span class="number">0</span>) &#123;</span><br><span class="line">       dp[i][j] = dp[i - <span class="number">1</span>][j];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       dp[i][j] = Math.max(dp[i - <span class="number">1</span>][j], dp[i - <span class="number">1</span>][j - nums[i]] + nums[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>ç»™ä¸€ä¸ªæ•°ç»„ï¼Œç»™ä¸€ä¸ªæ•°ï¼Œç®—å‡ºè¯¥æ•°ç»„ä¸­çš„å…ƒç´ <mark>èƒ½å‡‘æˆè¿™ä¸ªæ•°çš„æ–¹æ¡ˆæ•°</mark>ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j] = dp[i - <span class="number">1</span>][j];</span><br><span class="line"><span class="keyword">if</span> (j - nums[i] &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        dp[i][j] += dp[i - <span class="number">1</span>][j - nums[i]];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ç§å¯¹äº<code>dp[i][j]</code>å’Œiï¼Œjçš„å®šä¹‰ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸Šé¢çš„<code>dp[i][j]</code>æŒ‡çš„æ˜¯æœ€å¤§ä»·å€¼ï¼Œä¸‹é¢çš„æŒ‡çš„æ˜¯èƒ½è£…æ»¡è¯¥å®¹é‡çš„æ–¹æ¡ˆæ•°ã€‚</p><p>ä¸€å’Œé›¶ï¼š<mark>è£…æ»¡è¿™ä¸ªèƒŒåŒ…æœ€å¤šæœ‰å¤šå°‘ä¸ªç‰©å“ï¼Ÿ</mark></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> m; i &gt;= x; i--) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> n; j &gt;= y; j--) &#123;</span><br><span class="line">        dp[i][j] = Math.max(dp[i][j], dp[i - x][j - y] + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>01èƒŒåŒ…çš„è¿™äº›ä¾‹é¢˜éƒ½æ˜¯ç»™ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åç»™ä¸ªæ•°æ¥è¿›è¡Œå¯¹æ•°ç»„é‡Œçš„æ•°åšé™åˆ¶ã€‚</p><h2 id="å®Œå…¨èƒŒåŒ…"><a href="#å®Œå…¨èƒŒåŒ…" class="headerlink" title="å®Œå…¨èƒŒåŒ…"></a>å®Œå…¨èƒŒåŒ…</h2><p>å®Œå…¨èƒŒåŒ…ä¸­ç‰©å“å¯ä»¥ä½¿ç”¨æ— æ•°æ¬¡ï¼Œè€Œ01èƒŒåŒ…çš„ç‰©å“åªèƒ½ä½¿ç”¨ä¸€æ¬¡</p><blockquote><p>å…¶å®è¿˜æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åç»™ä¸€ä¸ªæ•°è¿›è¡Œé™åˆ¶ï¼Œåªä¸è¿‡æ•°ç»„é‡Œçš„æ•°å¯ä»¥å–å¤šæ¬¡äº†</p></blockquote><p>çˆ¬æ¥¼æ¢¯è¿›é˜¶ç‰ˆï¼šï¼ˆå…¶å®è¿˜æ˜¯ä¸€ä¸ªæ•°ç»„å’Œä¸€ä¸ªæ•°æ¥é™åˆ¶ï¼Œæ•°ç»„å˜æˆäº†1åˆ°mï¼‰</p><p>è¿™æ¬¡<strong>æ”¹ä¸ºï¼šä¸€æ­¥ä¸€ä¸ªå°é˜¶ï¼Œä¸¤ä¸ªå°é˜¶ï¼Œä¸‰ä¸ªå°é˜¶ï¼Œâ€¦â€¦.ï¼Œç›´åˆ° mä¸ªå°é˜¶ã€‚é—®æœ‰å¤šå°‘ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶å‘¢ï¼Ÿ</strong></p><p>è¿™åˆæœ‰éš¾åº¦äº†ï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªå®Œå…¨èƒŒåŒ…é—®é¢˜ã€‚</p><p>1é˜¶ï¼Œ2é˜¶ï¼Œâ€¦. mé˜¶å°±æ˜¯ç‰©å“ï¼Œæ¥¼é¡¶å°±æ˜¯èƒŒåŒ…ã€‚</p><p>æ¯ä¸€é˜¶å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œä¾‹å¦‚è·³äº†1é˜¶ï¼Œè¿˜å¯ä»¥ç»§ç»­è·³1é˜¶ã€‚</p><p>é—®è·³åˆ°æ¥¼é¡¶æœ‰å‡ ç§æ–¹æ³•å…¶å®å°±æ˜¯é—®è£…æ»¡èƒŒåŒ…æœ‰å‡ ç§æ–¹æ³•ã€‚</p><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">        <span class="type">int</span>[] weight = <span class="keyword">new</span> <span class="title class_">int</span>[m];</span><br><span class="line">        <span class="type">int</span>[] value = <span class="keyword">new</span> <span class="title class_">int</span>[m];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            weight[i] = scanner.nextInt();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            value[i] = scanner.nextInt();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>];</span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–dpæ•°ç»„</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt;= n; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (j &gt;= weight[<span class="number">0</span>]) &#123;</span><br><span class="line">                dp[j] = value[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> weight[i]; j &lt;= n; j++) &#123;<span class="comment">//åªä¿®æ”¹äº†è¿™é‡Œä¸ºæ­£åºéå†</span></span><br><span class="line">                dp[j] = Math.max(dp[j], dp[j - weight[i]] + value[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(dp[n]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ±‚ç»„åˆæ•°æˆ–è€…æ’åˆ—æ•°ï¼š</p><p>å…ˆéå†ç‰©å“ i å†éå†èƒŒåŒ… j ç®—çš„æ˜¯ç»„åˆæ•°ï¼Œå…ˆéå†èƒŒåŒ… j å†éå†ç‰©å“ i ç®—çš„æ˜¯æ’åˆ—æ•°</p><h2 id="å¤šé‡èƒŒåŒ…"><a href="#å¤šé‡èƒŒåŒ…" class="headerlink" title="å¤šé‡èƒŒåŒ…"></a>å¤šé‡èƒŒåŒ…</h2><p>å¾…è¡¥å……ã€‚ã€‚ã€‚ã€‚ã€‚</p><h2 id="æ‰“å®¶åŠ«èˆ"><a href="#æ‰“å®¶åŠ«èˆ" class="headerlink" title="æ‰“å®¶åŠ«èˆ"></a>æ‰“å®¶åŠ«èˆ</h2><p>å½“å¤©çš„çŠ¶æ€ç”±å‰ä¸€å¤©æ¨å¯¼å‡ºæ¥ã€‚</p><p>å½“å¤©åˆ†ä¸ºå·å’Œä¸å·ä¸¤ç§æƒ…å†µï¼Œ</p><p>å¦‚æœå·ç¬¬iæˆ¿é—´ï¼Œé‚£ä¹ˆdp[i] &#x3D; dp[i - 2] + nums[i] ï¼Œå³ï¼šç¬¬i-1æˆ¿ä¸€å®šæ˜¯ä¸è€ƒè™‘çš„ï¼Œæ‰¾å‡º ä¸‹æ ‡i-2ï¼ˆåŒ…æ‹¬i-2ï¼‰ä»¥å†…çš„æˆ¿å±‹ï¼Œæœ€å¤šå¯ä»¥å·çªƒçš„é‡‘é¢ä¸ºdp[i-2] åŠ ä¸Šç¬¬iæˆ¿é—´å·åˆ°çš„é’±ã€‚</p><p>å¦‚æœä¸å·ç¬¬iæˆ¿é—´ï¼Œé‚£ä¹ˆdp[i] &#x3D; dp[i - 1]ï¼Œå³è€ƒ è™‘i-1æˆ¿ï¼Œï¼ˆ<strong>æ³¨æ„è¿™é‡Œæ˜¯è€ƒè™‘ï¼Œå¹¶ä¸æ˜¯ä¸€å®šè¦å·i-1æˆ¿ï¼Œè¿™æ˜¯å¾ˆå¤šåŒå­¦å®¹æ˜“æ··æ·†çš„ç‚¹</strong>ï¼‰</p><p>ç„¶ådp[i]å–æœ€å¤§å€¼ï¼Œå³dp[i] &#x3D; max(dp[i - 2] + nums[i], dp[i - 1]);</p><h2 id="è‚¡ç¥¨é—®é¢˜"><a href="#è‚¡ç¥¨é—®é¢˜" class="headerlink" title="è‚¡ç¥¨é—®é¢˜"></a>è‚¡ç¥¨é—®é¢˜</h2><p>åˆ—å‡º<code>dp[i][0]</code>,<code>dp[i][1]</code>,<code>dp[i][2]</code>,<code>dp[i][3]</code>,<code>dp[i][4]</code>ç­‰ç­‰çš„çŠ¶æ€ï¼Œç¡®å®šå…¶å¯ä»¥ç”±ä»€ä¹ˆçŠ¶æ€æ¨å¯¼å‡ºæ¥</p><h2 id="å­åºåˆ—é—®é¢˜"><a href="#å­åºåˆ—é—®é¢˜" class="headerlink" title="å­åºåˆ—é—®é¢˜"></a>å­åºåˆ—é—®é¢˜</h2><ol><li>è¿ç»­</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> s.length();</span><br><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> t.length();</span><br><span class="line"><span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[m + <span class="number">1</span>][n + <span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s.charAt(i - <span class="number">1</span>) == t.charAt(j - <span class="number">1</span>)) &#123;</span><br><span class="line">            dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">if</span> (dp[i][j] &gt; res) res = dp[i][j];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res;</span><br></pre></td></tr></table></figure><blockquote><p>è¦æ±‚è¿ç»­çš„è¯é‡åˆ°ä¸ä¸€è‡´çš„å°±è·³è¿‡äº†</p></blockquote><ol start="2"><li>ä¸è¿ç»­</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> s.length();</span><br><span class="line">   <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> t.length();</span><br><span class="line">   <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[m + <span class="number">1</span>][n + <span class="number">1</span>];</span><br><span class="line">   <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">           <span class="keyword">if</span> (s.charAt(i - <span class="number">1</span>) == t.charAt(j - <span class="number">1</span>)) &#123;</span><br><span class="line">               dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               dp[i][j] = Math.max(dp[i - <span class="number">1</span>][j], dp[i][j - <span class="number">1</span>]);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (dp[i][j] &gt; res) res = dp[i][j];</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> res;</span><br></pre></td></tr></table></figure><blockquote><p>è¦æ±‚å¯ä»¥ä¸è¿ç»­ï¼Œé‚£ä¹ˆè§£é‡Šå¦‚ä¸‹<a href="https://leetcode.cn/problems/longest-common-subsequence/solutions/2530341/zui-chang-gong-gong-zi-xu-lie-dong-gui-j-mass/">https://leetcode.cn/problems/longest-common-subsequence/solutions/2530341/zui-chang-gong-gong-zi-xu-lie-dong-gui-j-mass/</a></p></blockquote><p><strong>åˆ¤æ–­å­åºåˆ—å’Œä¸ç›¸äº¤çš„çº¿</strong>å…¶å®å°±æ˜¯æ±‚ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å­åºåˆ—ï¼Œæœ€ååˆ¤æ–­æœ€é•¿å…¬å…±å­åºåˆ—æ˜¯å¦ç­‰äºå­—ç¬¦ä¸²sçš„é•¿åº¦ã€‚</p><h1 id="å•è°ƒæ ˆ"><a href="#å•è°ƒæ ˆ" class="headerlink" title="å•è°ƒæ ˆ"></a>å•è°ƒæ ˆ</h1><p><strong>é€šå¸¸æ˜¯ä¸€ç»´æ•°ç»„ï¼Œè¦å¯»æ‰¾ä»»ä¸€ä¸ªå…ƒç´ çš„å³è¾¹æˆ–è€…å·¦è¾¹ç¬¬ä¸€ä¸ªæ¯”è‡ªå·±å¤§æˆ–è€…å°çš„å…ƒç´ çš„ä½ç½®ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±è¦æƒ³åˆ°å¯ä»¥ç”¨å•è°ƒæ ˆäº†</strong>ã€‚æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚</p><p><strong>é¡ºåºçš„æè¿°ä¸º ä»æ ˆå¤´åˆ°æ ˆåº•çš„é¡ºåº</strong></p><p>å¦‚æœæ±‚ä¸€ä¸ªå…ƒç´ å³è¾¹ç¬¬ä¸€ä¸ªæ›´å¤§å…ƒç´ ï¼Œå•è°ƒæ ˆå°±æ˜¯é€’å¢çš„ï¼Œå¦‚æœæ±‚ä¸€ä¸ªå…ƒç´ å³è¾¹ç¬¬ä¸€ä¸ªæ›´å°å…ƒç´ ï¼Œå•è°ƒæ ˆå°±æ˜¯é€’å‡çš„ã€‚</p><p>å•è°ƒæ ˆä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] dailyTemperatures(<span class="type">int</span>[] temperatures) &#123;</span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[temperatures.length];</span><br><span class="line">        Deque&lt;Integer&gt; stack = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; temperatures.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (stack.isEmpty() || temperatures[i] &lt;= temperatures[stack.peekFirst()]) &#123;</span><br><span class="line">                stack.addFirst(i);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (temperatures[i] &gt; temperatures[stack.peekFirst()]) &#123;</span><br><span class="line">                <span class="keyword">while</span> (!stack.isEmpty() &amp;&amp; temperatures[i] &gt; temperatures[stack.peekFirst()]) &#123;</span><br><span class="line">                    <span class="type">Integer</span> <span class="variable">index</span> <span class="operator">=</span> stack.pollFirst();</span><br><span class="line">                    res[index] = i - index;</span><br><span class="line">                &#125;</span><br><span class="line">                stack.addFirst(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h1><h2 id="æ’åºå°ç»“"><a href="#æ’åºå°ç»“" class="headerlink" title="æ’åºå°ç»“"></a>æ’åºå°ç»“</h2><p><strong>è¿è¡Œæ•ˆç‡</strong>ï¼šæˆ‘ä»¬æœŸæœ›æ’åºç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å°½é‡ä½ï¼Œä¸”æ€»ä½“æ“ä½œæ•°é‡è¾ƒå°‘ï¼ˆæ—¶é—´å¤æ‚åº¦ä¸­çš„å¸¸æ•°é¡¹å˜å°ï¼‰ã€‚å¯¹äºå¤§æ•°æ®é‡çš„æƒ…å†µï¼Œè¿è¡Œæ•ˆç‡æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚</p><p><strong>å°±åœ°æ€§</strong>ï¼šé¡¾åæ€ä¹‰ï¼ŒåŸåœ°æ’åºé€šè¿‡åœ¨åŸæ•°ç»„ä¸Šç›´æ¥æ“ä½œå®ç°æ’åºï¼Œæ— é¡»å€ŸåŠ©é¢å¤–çš„è¾…åŠ©æ•°ç»„ï¼Œä»è€ŒèŠ‚çœå†…å­˜ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒåŸåœ°æ’åºçš„æ•°æ®æ¬è¿æ“ä½œè¾ƒå°‘ï¼Œè¿è¡Œé€Ÿåº¦ä¹Ÿæ›´å¿«ã€‚</p><p><strong>ç¨³å®šæ€§</strong>ï¼šç¨³å®šæ’åºåœ¨å®Œæˆæ’åºåï¼Œç›¸ç­‰å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ç›¸å¯¹é¡ºåºä¸å‘ç”Ÿæ”¹å˜ã€‚</p><p>åªæœ‰é€‰æ‹©ï¼Œå¿«é€Ÿï¼Œå †æ˜¯éç¨³å®š</p><p><img src="https://www.hello-algo.com/chapter_sorting/summary.assets/sorting_algorithms_comparison.png" alt="æ’åºå¯¹æ¯”"></p><h2 id="é€‰æ‹©æ’åº"><a href="#é€‰æ‹©æ’åº" class="headerlink" title="é€‰æ‹©æ’åº"></a>é€‰æ‹©æ’åº</h2><blockquote><p>æ¯æ¬¡æ‰¾åˆ°æœ€å°å…ƒç´ æ”¾åˆ°å‰é¢</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* é€‰æ‹©æ’åº */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">selectionSort</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">    <span class="comment">// å¤–å¾ªç¯ï¼šæœªæ’åºåŒºé—´ä¸º [i, n-1]</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// å†…å¾ªç¯ï¼šæ‰¾åˆ°æœªæ’åºåŒºé—´å†…çš„æœ€å°å…ƒç´ </span></span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i + <span class="number">1</span>; j &lt; n; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[j] &lt; nums[k])</span><br><span class="line">                k = j; <span class="comment">// è®°å½•æœ€å°å…ƒç´ çš„ç´¢å¼•</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å°†è¯¥æœ€å°å…ƒç´ ä¸æœªæ’åºåŒºé—´çš„é¦–ä¸ªå…ƒç´ äº¤æ¢</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> nums[i];</span><br><span class="line">        nums[i] = nums[k];</span><br><span class="line">        nums[k] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h2><blockquote><p>æ¯æ¬¡éå†æŠŠæœ€å¤§å…ƒç´ æ”¾åœ¨å³è¾¹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* å†’æ³¡æ’åº */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">bubbleSort</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="comment">// å¤–å¾ªç¯ï¼šæœªæ’åºåŒºé—´ä¸º [0, i]</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> nums.length - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="comment">// å†…å¾ªç¯ï¼šå°†æœªæ’åºåŒºé—´ [0, i] ä¸­çš„æœ€å¤§å…ƒç´ äº¤æ¢è‡³è¯¥åŒºé—´çš„æœ€å³ç«¯</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[j] &gt; nums[j + <span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="comment">// äº¤æ¢ nums[j] ä¸ nums[j + 1]</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> nums[j];</span><br><span class="line">                nums[j] = nums[j + <span class="number">1</span>];</span><br><span class="line">                nums[j + <span class="number">1</span>] = tmp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ’å…¥æ’åº"><a href="#æ’å…¥æ’åº" class="headerlink" title="æ’å…¥æ’åº"></a>æ’å…¥æ’åº</h2><blockquote><p>åƒæ‰“ç‰Œä¸€æ ·ï¼Œå°†å½“å‰å…ƒç´ æ’å…¥åˆ°å‰é¢å·²ç»æ’åºå¥½çš„åºåˆ—ä¸­çš„åˆé€‚ä½ç½®</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* æ’å…¥æ’åº */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insertionSort</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="comment">// å¤–å¾ªç¯ï¼šå·²æ’åºå…ƒç´ æ•°é‡ä¸º 1, 2, ..., n</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">base</span> <span class="operator">=</span> nums[i], j = i - <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// å†…å¾ªç¯ï¼šå°† base æ’å…¥åˆ°å·²æ’åºéƒ¨åˆ†çš„æ­£ç¡®ä½ç½®</span></span><br><span class="line">        <span class="keyword">while</span> (j &gt;= <span class="number">0</span> &amp;&amp; nums[j] &gt; base) &#123;</span><br><span class="line">            nums[j + <span class="number">1</span>] = nums[j]; <span class="comment">// å°† nums[j] å‘å³ç§»åŠ¨ä¸€ä½</span></span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">        nums[j + <span class="number">1</span>] = base;        <span class="comment">// å°† base èµ‹å€¼åˆ°æ­£ç¡®ä½ç½®</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¸Œå°”æ’åº"><a href="#å¸Œå°”æ’åº" class="headerlink" title="å¸Œå°”æ’åº"></a>å¸Œå°”æ’åº</h2><p><img src="/../assets/Study-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/shell_sort.png" alt="å¸Œå°”æ’åº"></p><h2 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h2><blockquote><p>é€‰å‡ºä¸€ä¸ªæ•°ï¼ŒæŠŠæ•°ç»„åˆ†ä¸ºä¸¥æ ¼æ¯”è¿™ä¸ªæ•°å°çš„å·¦å­æ•°ç»„å’Œä¸¥æ ¼æ¯”è¿™ä¸ªæ•°å¤§çš„å³å­æ•°ç»„ï¼Œç„¶åé€’å½’åœ°è¿›è¡Œè¿™æ ·çš„æ“ä½œ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* å…ƒç´ äº¤æ¢ */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> nums[i];</span><br><span class="line">    nums[i] = nums[j];</span><br><span class="line">    nums[j] = tmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* å“¨å…µåˆ’åˆ† */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">partition</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> left, <span class="type">int</span> right)</span> &#123;</span><br><span class="line">    <span class="comment">// ä»¥ nums[left] ä¸ºåŸºå‡†æ•°</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> left, j = right;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; j &amp;&amp; nums[j] &gt;= nums[left])</span><br><span class="line">            j--;          <span class="comment">// ä»å³å‘å·¦æ‰¾é¦–ä¸ªå°äºåŸºå‡†æ•°çš„å…ƒç´ </span></span><br><span class="line">        <span class="keyword">while</span> (i &lt; j &amp;&amp; nums[i] &lt;= nums[left])</span><br><span class="line">            i++;          <span class="comment">// ä»å·¦å‘å³æ‰¾é¦–ä¸ªå¤§äºåŸºå‡†æ•°çš„å…ƒç´ </span></span><br><span class="line">        swap(nums, i, j); <span class="comment">// äº¤æ¢è¿™ä¸¤ä¸ªå…ƒç´ </span></span><br><span class="line">    &#125;</span><br><span class="line">    swap(nums, i, left);  <span class="comment">// å°†åŸºå‡†æ•°äº¤æ¢è‡³ä¸¤å­æ•°ç»„çš„åˆ†ç•Œçº¿</span></span><br><span class="line">    <span class="keyword">return</span> i;             <span class="comment">// è¿”å›åŸºå‡†æ•°çš„ç´¢å¼•</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* å¿«é€Ÿæ’åº */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">quickSort</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> left, <span class="type">int</span> right)</span> &#123;</span><br><span class="line">    <span class="comment">// å­æ•°ç»„é•¿åº¦ä¸º 1 æ—¶ç»ˆæ­¢é€’å½’</span></span><br><span class="line">    <span class="keyword">if</span> (left &gt;= right)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// å“¨å…µåˆ’åˆ†</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">pivot</span> <span class="operator">=</span> partition(nums, left, right);</span><br><span class="line">    <span class="comment">// é€’å½’å·¦å­æ•°ç»„ã€å³å­æ•°ç»„</span></span><br><span class="line">    quickSort(nums, left, pivot - <span class="number">1</span>);</span><br><span class="line">    quickSort(nums, pivot + <span class="number">1</span>, right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h2><p><img src="/../assets/Study-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/merge_sort_overview.png" alt="å½’å¹¶æ’åº"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* åˆå¹¶å·¦å­æ•°ç»„å’Œå³å­æ•°ç»„ */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> left, <span class="type">int</span> mid, <span class="type">int</span> right)</span> &#123;</span><br><span class="line">    <span class="comment">// å·¦å­æ•°ç»„åŒºé—´ [left, mid], å³å­æ•°ç»„åŒºé—´ [mid+1, right]</span></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ•°ç»„ tmp ï¼Œç”¨äºå­˜æ”¾åˆå¹¶åçš„ç»“æœ</span></span><br><span class="line">    <span class="type">int</span>[] tmp = <span class="keyword">new</span> <span class="title class_">int</span>[right - left + <span class="number">1</span>];</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–å·¦å­æ•°ç»„å’Œå³å­æ•°ç»„çš„èµ·å§‹ç´¢å¼•</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> left, j = mid + <span class="number">1</span>, k = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// å½“å·¦å³å­æ•°ç»„éƒ½è¿˜æœ‰å…ƒç´ æ—¶ï¼Œæ¯”è¾ƒå¹¶å°†è¾ƒå°çš„å…ƒç´ å¤åˆ¶åˆ°ä¸´æ—¶æ•°ç»„ä¸­</span></span><br><span class="line">    <span class="keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= right) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums[i] &lt;= nums[j])</span><br><span class="line">            tmp[k++] = nums[i++];</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            tmp[k++] = nums[j++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†å·¦å­æ•°ç»„å’Œå³å­æ•°ç»„çš„å‰©ä½™å…ƒç´ å¤åˆ¶åˆ°ä¸´æ—¶æ•°ç»„ä¸­</span></span><br><span class="line">    <span class="keyword">while</span> (i &lt;= mid) &#123;</span><br><span class="line">        tmp[k++] = nums[i++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (j &lt;= right) &#123;</span><br><span class="line">        tmp[k++] = nums[j++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†ä¸´æ—¶æ•°ç»„ tmp ä¸­çš„å…ƒç´ å¤åˆ¶å›åŸæ•°ç»„ nums çš„å¯¹åº”åŒºé—´</span></span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; tmp.length; k++) &#123;</span><br><span class="line">        nums[left + k] = tmp[k];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* å½’å¹¶æ’åº */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">mergeSort</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> left, <span class="type">int</span> right)</span> &#123;</span><br><span class="line">    <span class="comment">// ç»ˆæ­¢æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (left &gt;= right)</span><br><span class="line">        <span class="keyword">return</span>; <span class="comment">// å½“å­æ•°ç»„é•¿åº¦ä¸º 1 æ—¶ç»ˆæ­¢é€’å½’</span></span><br><span class="line">    <span class="comment">// åˆ’åˆ†é˜¶æ®µ</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (left + right) / <span class="number">2</span>; <span class="comment">// è®¡ç®—ä¸­ç‚¹</span></span><br><span class="line">    mergeSort(nums, left, mid); <span class="comment">// é€’å½’å·¦å­æ•°ç»„</span></span><br><span class="line">    mergeSort(nums, mid + <span class="number">1</span>, right); <span class="comment">// é€’å½’å³å­æ•°ç»„</span></span><br><span class="line">    <span class="comment">// åˆå¹¶é˜¶æ®µ</span></span><br><span class="line">    merge(nums, left, mid, right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h2><p><a href="https://www.bilibili.com/video/BV1AF411G7cA/?spm_id_from=333.788&vd_source=fa7ba4ae353f08f1d08d1bb24528e96c">https://www.bilibili.com/video/BV1AF411G7cA/?spm_id_from=333.788&amp;vd_source=fa7ba4ae353f08f1d08d1bb24528e96c</a></p><p>ä¸¤ç§æ–¹å¼ï¼š</p><ol><li><p>ç¬¬ä¸€ç§æ˜¯ç”¨åŸºäºå°æ ¹å †å®ç°çš„ä¼˜å…ˆé˜Ÿåˆ—æ¥å®ç°ï¼Œç”±äºæ˜¯å°æ ¹å †ï¼Œæ‰€ä»¥æ ¹ä¸€å®šæ˜¯æœ€å°å…ƒç´ ï¼Œæ•…æ¯æ¬¡å¼¹å‡ºæ ¹å…ƒç´ ä¹‹åå†è¿›è¡Œä¸‹æ»¤æ“ä½œå³å¯ã€‚ä½†æ˜¯è¿™æ ·ä¼š<strong>æµªè´¹ä¸€ä¸ªé¢å¤–çš„æ•°ç»„ç©ºé—´</strong>ï¼Œæ•…ä¸æ¨èä½¿ç”¨ã€‚</p></li><li><p>ç¬¬äºŒç§æ˜¯åŸºäºå¤§æ ¹å †å®ç°ï¼š</p><ol><li><p>å°†ä¹±åºæ•°ç»„æ„é€ æˆå¤§æ ¹å †åï¼›</p></li><li><p>å°†å †é¡¶å…ƒç´ ï¼ˆç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ä¸å †åº•å…ƒç´ ï¼ˆæœ€åä¸€ä¸ªå…ƒç´ ï¼‰äº¤æ¢ã€‚å®Œæˆäº¤æ¢åï¼Œå †çš„é•¿åº¦å‡ 1 ï¼Œå·²æ’åºå…ƒç´ æ•°é‡åŠ  1 ã€‚</p></li><li><p>ä»å †é¡¶å…ƒç´ å¼€å§‹ï¼Œä»é¡¶åˆ°åº•æ‰§è¡Œå †åŒ–æ“ä½œï¼ˆsift downï¼‰ã€‚å®Œæˆå †åŒ–åï¼Œå †çš„æ€§è´¨å¾—åˆ°ä¿®å¤ã€‚</p></li><li><p>å¾ªç¯æ‰§è¡Œç¬¬ <code>2.</code> æ­¥å’Œç¬¬ <code>3.</code> æ­¥ã€‚å¾ªç¯ ğ‘›âˆ’1 è½®åï¼Œå³å¯å®Œæˆæ•°ç»„æ’åºã€‚</p></li></ol></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* å †çš„é•¿åº¦ä¸º n ï¼Œä»èŠ‚ç‚¹ i å¼€å§‹ï¼Œä»é¡¶è‡³åº•å †åŒ– */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">siftDown</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> n, <span class="type">int</span> i)</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­èŠ‚ç‚¹ i, l, r ä¸­å€¼æœ€å¤§çš„èŠ‚ç‚¹ï¼Œè®°ä¸º ma</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">2</span> * i + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> <span class="number">2</span> * i + <span class="number">2</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ma</span> <span class="operator">=</span> i;</span><br><span class="line">        <span class="keyword">if</span> (l &lt; n &amp;&amp; nums[l] &gt; nums[ma])</span><br><span class="line">            ma = l;</span><br><span class="line">        <span class="keyword">if</span> (r &lt; n &amp;&amp; nums[r] &gt; nums[ma])</span><br><span class="line">            ma = r;</span><br><span class="line">        <span class="comment">// è‹¥èŠ‚ç‚¹ i æœ€å¤§æˆ–ç´¢å¼• l, r è¶Šç•Œï¼Œåˆ™æ— é¡»ç»§ç»­å †åŒ–ï¼Œè·³å‡º</span></span><br><span class="line">        <span class="keyword">if</span> (ma == i)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">// äº¤æ¢ä¸¤èŠ‚ç‚¹</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> nums[i];</span><br><span class="line">        nums[i] = nums[ma];</span><br><span class="line">        nums[ma] = temp;</span><br><span class="line">        <span class="comment">// å¾ªç¯å‘ä¸‹å †åŒ–</span></span><br><span class="line">        i = ma;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* å †æ’åº */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">heapSort</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="comment">// å»ºå †æ“ä½œï¼šå †åŒ–é™¤å¶èŠ‚ç‚¹ä»¥å¤–çš„å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> nums.length / <span class="number">2</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        siftDown(nums, nums.length, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä»å †ä¸­æå–æœ€å¤§å…ƒç´ ï¼Œå¾ªç¯ n-1 è½®</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> nums.length - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="comment">// äº¤æ¢æ ¹èŠ‚ç‚¹ä¸æœ€å³å¶èŠ‚ç‚¹ï¼ˆäº¤æ¢é¦–å…ƒç´ ä¸å°¾å…ƒç´ ï¼‰</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> nums[<span class="number">0</span>];</span><br><span class="line">        nums[<span class="number">0</span>] = nums[i];</span><br><span class="line">        nums[i] = tmp;</span><br><span class="line">        <span class="comment">// ä»¥æ ¹èŠ‚ç‚¹ä¸ºèµ·ç‚¹ï¼Œä»é¡¶è‡³åº•è¿›è¡Œå †åŒ–</span></span><br><span class="line">        siftDown(nums, i, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¡¶æ’åº"><a href="#æ¡¶æ’åº" class="headerlink" title="æ¡¶æ’åº"></a>æ¡¶æ’åº</h2><blockquote><p>é€šè¿‡è®¾ç½®ä¸€äº›å…·æœ‰å¤§å°é¡ºåºçš„æ¡¶ï¼Œæ¯ä¸ªæ¡¶å¯¹åº”ä¸€ä¸ªæ•°æ®èŒƒå›´ï¼Œå°†æ•°æ®å¹³å‡åˆ†é…åˆ°å„ä¸ªæ¡¶ä¸­ï¼›ç„¶åï¼Œåœ¨æ¯ä¸ªæ¡¶å†…éƒ¨åˆ†åˆ«æ‰§è¡Œæ’åºï¼›æœ€ç»ˆæŒ‰ç…§æ¡¶çš„é¡ºåºå°†æ‰€æœ‰æ•°æ®åˆå¹¶ã€‚</p></blockquote><ol><li>åˆå§‹åŒ– ğ‘˜ ä¸ªæ¡¶ï¼Œå°† ğ‘› ä¸ªå…ƒç´ åˆ†é…åˆ° ğ‘˜ ä¸ªæ¡¶ä¸­ã€‚</li><li>å¯¹æ¯ä¸ªæ¡¶åˆ†åˆ«æ‰§è¡Œæ’åºï¼ˆè¿™é‡Œé‡‡ç”¨ç¼–ç¨‹è¯­è¨€çš„å†…ç½®æ’åºå‡½æ•°ï¼‰ã€‚</li><li>æŒ‰ç…§æ¡¶ä»å°åˆ°å¤§çš„é¡ºåºåˆå¹¶ç»“æœã€‚</li></ol><p><img src="/../assets/Study-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/bucket_sort_overview.png" alt="æ¡¶æ’åº"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* æ¡¶æ’åº */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">bucketSort</span><span class="params">(<span class="type">float</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– k = n/2 ä¸ªæ¡¶ï¼Œé¢„æœŸå‘æ¯ä¸ªæ¡¶åˆ†é… 2 ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> nums.length / <span class="number">2</span>;</span><br><span class="line">    List&lt;List&lt;Float&gt;&gt; buckets = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">        buckets.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1. å°†æ•°ç»„å…ƒç´ åˆ†é…åˆ°å„ä¸ªæ¡¶ä¸­</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">float</span> num : nums) &#123;</span><br><span class="line">        <span class="comment">// è¾“å…¥æ•°æ®èŒƒå›´ä¸º [0, 1)ï¼Œä½¿ç”¨ num * k æ˜ å°„åˆ°ç´¢å¼•èŒƒå›´ [0, k-1]</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> (<span class="type">int</span>) (num * k);</span><br><span class="line">        <span class="comment">// å°† num æ·»åŠ è¿›æ¡¶ i</span></span><br><span class="line">        buckets.get(i).add(num);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. å¯¹å„ä¸ªæ¡¶æ‰§è¡Œæ’åº</span></span><br><span class="line">    <span class="keyword">for</span> (List&lt;Float&gt; bucket : buckets) &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨å†…ç½®æ’åºå‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ›¿æ¢æˆå…¶ä»–æ’åºç®—æ³•</span></span><br><span class="line">        Collections.sort(bucket);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3. éå†æ¡¶åˆå¹¶ç»“æœ</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (List&lt;Float&gt; bucket : buckets) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">float</span> num : bucket) &#123;</span><br><span class="line">            nums[i++] = num;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è®¡æ•°æ’åº"><a href="#è®¡æ•°æ’åº" class="headerlink" title="è®¡æ•°æ’åº"></a>è®¡æ•°æ’åº</h2><p><a href="https://www.bilibili.com/video/BV1sU4y1R7pm/?spm_id_from=333.337.search-card.all.click&vd_source=fa7ba4ae353f08f1d08d1bb24528e96c">https://www.bilibili.com/video/BV1sU4y1R7pm/?spm_id_from=333.337.search-card.all.click&amp;vd_source=fa7ba4ae353f08f1d08d1bb24528e96c</a></p><ol><li>éå†æ•°ç»„ï¼Œæ‰¾å‡ºå…¶ä¸­çš„æœ€å¤§æ•°å­—ï¼Œè®°ä¸º ğ‘š ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º ğ‘š+1 çš„è¾…åŠ©æ•°ç»„ <code>counter</code> ã€‚</li><li><strong>å€ŸåŠ© <code>counter</code> ç»Ÿè®¡ <code>nums</code> ä¸­å„æ•°å­—çš„å‡ºç°æ¬¡æ•°</strong>ï¼Œå…¶ä¸­ <code>counter[num]</code> å¯¹åº”æ•°å­— <code>num</code> çš„å‡ºç°æ¬¡æ•°ã€‚ç»Ÿè®¡æ–¹æ³•å¾ˆç®€å•ï¼Œåªéœ€éå† <code>nums</code>ï¼ˆè®¾å½“å‰æ•°å­—ä¸º <code>num</code>ï¼‰ï¼Œæ¯è½®å°† <code>counter[num]</code> å¢åŠ  1 å³å¯ã€‚</li><li><strong>ç”±äº <code>counter</code> çš„å„ä¸ªç´¢å¼•å¤©ç„¶æœ‰åºï¼Œå› æ­¤ç›¸å½“äºæ‰€æœ‰æ•°å­—å·²ç»æ’åºå¥½äº†</strong>ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éå† <code>counter</code> ï¼Œæ ¹æ®å„æ•°å­—å‡ºç°æ¬¡æ•°ä»å°åˆ°å¤§çš„é¡ºåºå¡«å…¥ <code>nums</code> å³å¯ã€‚</li></ol><p><a href="https://www.hello-algo.com/chapter_sorting/counting_sort.assets/counting_sort_overview.png"><img src="/../assets/Study-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/counting_sort_overview.png" alt="è®¡æ•°æ’åºæµç¨‹"></a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* è®¡æ•°æ’åº */</span></span><br><span class="line"><span class="comment">// ç®€å•å®ç°ï¼Œæ— æ³•ç”¨äºæ’åºå¯¹è±¡</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">countingSortNaive</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. ç»Ÿè®¡æ•°ç»„æœ€å¤§å…ƒç´  m</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">        m = Math.max(m, num);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. ç»Ÿè®¡å„æ•°å­—çš„å‡ºç°æ¬¡æ•°</span></span><br><span class="line">    <span class="comment">// counter[num] ä»£è¡¨ num çš„å‡ºç°æ¬¡æ•°</span></span><br><span class="line">    <span class="type">int</span>[] counter = <span class="keyword">new</span> <span class="title class_">int</span>[m + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">        counter[num]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3. éå† counter ï¼Œå°†å„å…ƒç´ å¡«å…¥åŸæ•°ç»„ nums</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>; num &lt; m + <span class="number">1</span>; num++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; counter[num]; j++, i++) &#123;</span><br><span class="line">            nums[i] = num;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŸºæ•°æ’åº"><a href="#åŸºæ•°æ’åº" class="headerlink" title="åŸºæ•°æ’åº"></a>åŸºæ•°æ’åº</h2><p><a href="https://www.bilibili.com/video/BV1zF411G7AU/?spm_id_from=333.337.search-card.all.click&vd_source=fa7ba4ae353f08f1d08d1bb24528e96c">https://www.bilibili.com/video/BV1zF411G7AU/?spm_id_from=333.337.search-card.all.click&amp;vd_source=fa7ba4ae353f08f1d08d1bb24528e96c</a></p><p>åˆ›å»º0åˆ°9è¿™åä¸ªæ¡¶ï¼Œé¦–å…ˆæŒ‰ç…§ä¸ªä½å­˜å…¥å¯¹åº”çš„æ¡¶ï¼Œç„¶åä¾æ¬¡å–å‡ºï¼Œç„¶åæŒ‰ç…§åä½å­˜å…¥å¯¹åº”çš„æ¡¶ï¼Œæ²¡æœ‰åä½å°±æ˜¯ä»£è¡¨åä½ä¸º0ï¼Œé€’å½’å®Œæˆä¸Šè¿°æ­¥éª¤å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* è·å–å…ƒç´  num çš„ç¬¬ k ä½ï¼Œå…¶ä¸­ exp = 10^(k-1) */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">digit</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> exp)</span> &#123;</span><br><span class="line">    <span class="comment">// ä¼ å…¥ exp è€Œé k å¯ä»¥é¿å…åœ¨æ­¤é‡å¤æ‰§è¡Œæ˜‚è´µçš„æ¬¡æ–¹è®¡ç®—</span></span><br><span class="line">    <span class="keyword">return</span> (num / exp) % <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è®¡æ•°æ’åºï¼ˆæ ¹æ® nums ç¬¬ k ä½æ’åºï¼‰ */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">countingSortDigit</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> exp)</span> &#123;</span><br><span class="line">    <span class="comment">// åè¿›åˆ¶çš„ä½èŒƒå›´ä¸º 0~9 ï¼Œå› æ­¤éœ€è¦é•¿åº¦ä¸º 10 çš„æ¡¶æ•°ç»„</span></span><br><span class="line">    <span class="type">int</span>[] counter = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">10</span>];</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">    <span class="comment">// ç»Ÿè®¡ 0~9 å„æ•°å­—çš„å‡ºç°æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">d</span> <span class="operator">=</span> digit(nums[i], exp); <span class="comment">// è·å– nums[i] ç¬¬ k ä½ï¼Œè®°ä¸º d</span></span><br><span class="line">        counter[d]++;                <span class="comment">// ç»Ÿè®¡æ•°å­— d çš„å‡ºç°æ¬¡æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ±‚å‰ç¼€å’Œï¼Œå°†â€œå‡ºç°ä¸ªæ•°â€è½¬æ¢ä¸ºâ€œæ•°ç»„ç´¢å¼•â€</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        counter[i] += counter[i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å€’åºéå†ï¼Œæ ¹æ®æ¡¶å†…ç»Ÿè®¡ç»“æœï¼Œå°†å„å…ƒç´ å¡«å…¥ res</span></span><br><span class="line">    <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">d</span> <span class="operator">=</span> digit(nums[i], exp);</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> counter[d] - <span class="number">1</span>; <span class="comment">// è·å– d åœ¨æ•°ç»„ä¸­çš„ç´¢å¼• j</span></span><br><span class="line">        res[j] = nums[i];       <span class="comment">// å°†å½“å‰å…ƒç´ å¡«å…¥ç´¢å¼• j</span></span><br><span class="line">        counter[d]--;           <span class="comment">// å°† d çš„æ•°é‡å‡ 1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ç»“æœè¦†ç›–åŸæ•°ç»„ nums</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        nums[i] = res[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* åŸºæ•°æ’åº */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">radixSort</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–æ•°ç»„çš„æœ€å¤§å…ƒç´ ï¼Œç”¨äºåˆ¤æ–­æœ€å¤§ä½æ•°</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : nums)</span><br><span class="line">        <span class="keyword">if</span> (num &gt; m)</span><br><span class="line">            m = num;</span><br><span class="line">    <span class="comment">// æŒ‰ç…§ä»ä½ä½åˆ°é«˜ä½çš„é¡ºåºéå†</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="number">1</span>; exp &lt;= m; exp *= <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="comment">// å¯¹æ•°ç»„å…ƒç´ çš„ç¬¬ k ä½æ‰§è¡Œè®¡æ•°æ’åº</span></span><br><span class="line">        <span class="comment">// k = 1 -&gt; exp = 1</span></span><br><span class="line">        <span class="comment">// k = 2 -&gt; exp = 10</span></span><br><span class="line">        <span class="comment">// å³ exp = 10^(k-1)</span></span><br><span class="line">        countingSortDigit(nums, exp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> 408 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¸¸ç”¨è®¾è®¡æ¨¡å¼</title>
      <link href="/2023/10/03/%E9%9D%A2%E8%AF%95-%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
      <url>/2023/10/03/%E9%9D%A2%E8%AF%95-%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æœ¬æ–‡å‚è€ƒè‡ª<a href="https://www.bilibili.com/video/BV1yT411H7YK">https://www.bilibili.com/video/BV1yT411H7YK</a></p><h1 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h1><blockquote><p>å·¥å‚æ¨¡å¼æœ€é‡è¦çš„æ„ä¹‰å°±æ˜¯<mark>è§£è€¦</mark></p></blockquote><p>å·¥å‚æ–¹æ³•æ¨¡å¼çš„ä¸»è¦è§’è‰²ï¼š</p><ul><li>æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰ï¼šæä¾›äº†åˆ›å»ºäº§å“çš„æ¥å£ï¼Œè°ƒç”¨è€…é€šè¿‡å®ƒè®¿é—®å…·ä½“å·¥å‚çš„å·¥å‚æ–¹æ³•æ¥åˆ›å»ºäº§å“ã€‚</li><li>å…·ä½“å·¥å‚ï¼ˆConcrete Factoryï¼‰ï¼šä¸»è¦æ˜¯å®ç°æŠ½è±¡å·¥å‚ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œå®Œæˆå…·ä½“äº§å“çš„åˆ›å»ºã€‚</li><li>æŠ½è±¡äº§å“ï¼ˆProductï¼‰ï¼šå®šä¹‰äº†äº§å“çš„è§„èŒƒï¼Œæè¿°äº†äº§å“çš„ä¸»è¦ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚</li><li>å…·ä½“äº§å“ï¼ˆConcrete Productï¼‰ï¼šå®ç°äº†æŠ½è±¡äº§å“è§’è‰²æ‰€å®šä¹‰çš„æ¥å£ï¼Œç”±å…·ä½“å·¥å‚æ¥åˆ›å»ºï¼Œå®ƒåŒå…·ä½“å·¥å‚ä¹‹é—´ä¸€ä¸€å¯¹åº”ã€‚</li></ul><p><strong>å®ç°ï¼š</strong></p><p>ä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼å¯¹ä¸Šä¾‹è¿›è¡Œæ”¹è¿›ï¼Œç±»å›¾å¦‚ä¸‹ï¼š</p><p><img src="/../assets/%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20230521102122950.png" alt="image-20230521102122950"></p><h1 id="ç­–ç•¥æ¨¡å¼"><a href="#ç­–ç•¥æ¨¡å¼" class="headerlink" title="ç­–ç•¥æ¨¡å¼"></a>ç­–ç•¥æ¨¡å¼</h1><blockquote><p>åªè¦ä»£ç ä¸­æœ‰å¾ˆé•¿çš„if-elseæˆ–switch åˆ†æ”¯åˆ¤æ–­éƒ½å¯ä»¥é‡‡ç”¨ç­–ç•¥æ¨¡å¼ä¼˜åŒ–</p></blockquote><p><img src="/../assets/%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20220913125209804-17039483861701.png" alt="image-20220913125209804"></p><p>å¦‚å›¾å¯ä»¥é€‰æ‹©ä¸åŒçš„ç­–ç•¥å»å®ç°ä¸åŒçš„æ–¹æ¡ˆ</p><h1 id="å·¥å‚-ç­–ç•¥è¿ç”¨åˆ°é¡¹ç›®"><a href="#å·¥å‚-ç­–ç•¥è¿ç”¨åˆ°é¡¹ç›®" class="headerlink" title="å·¥å‚+ç­–ç•¥è¿ç”¨åˆ°é¡¹ç›®"></a>å·¥å‚+ç­–ç•¥è¿ç”¨åˆ°é¡¹ç›®</h1><p><mark><strong>ç™»å½•ã€æ”¯ä»˜</strong></mark>ï¼š<br>æä¾›äº†å¾ˆå¤šç§ç­–ç•¥ï¼Œéƒ½è®©springå®¹å™¨ç®¡ç†<br>æä¾›ä¸€ä¸ªå·¥å‚ï¼šå‡†å¤‡ç­–ç•¥å¯¹è±¡ï¼Œæ ¹æ®å‚æ•°æä¾›å¯¹è±¡</p><blockquote><p>æ¯”å¦‚å¯ä»¥å¾®ä¿¡ç™»å½•ï¼Œæ‰‹æœºéªŒè¯ç ç™»å½•ï¼Œè´¦å·å¯†ç ç™»å½•</p><p>è¿˜å¯ä»¥å¾®ä¿¡æ”¯ä»˜ï¼Œæ”¯ä»˜å®æ”¯ä»˜ç­‰</p></blockquote><h1 id="è´£ä»»é“¾æ¨¡å¼"><a href="#è´£ä»»é“¾æ¨¡å¼" class="headerlink" title="è´£ä»»é“¾æ¨¡å¼"></a>è´£ä»»é“¾æ¨¡å¼</h1><p>ç±»ä¼¼äºSpringMVCä¸­çš„è¿‡æ»¤å™¨é“¾ä¸€æ ·</p><p><strong>åœ¨é¡¹ç›®ä¸­çš„è¿ç”¨</strong>å°±æ˜¯ï¼š</p><p>ä¸‹è®¢å•ï¼š</p><p>å‚æ•°æ ¡éªŒ -&gt; è¡¥å……è®¢å•ä¿¡æ¯ -&gt; è®¡ç®—ç›¸å…³ä¿¡æ¯ -&gt; è®¢å•å…¥åº“</p><h1 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h1><p>å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒç¡®ä¿<mark><strong>ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹</strong></mark>ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œä»è€Œé¿å…äº†å¤šæ¬¡åˆ›å»ºç›¸åŒç±»çš„å¯¹è±¡ï¼ŒèŠ‚çœäº†ç³»ç»Ÿèµ„æºã€‚</p><p>å•ä¾‹æ¨¡å¼æœ‰å‡ ä¸ªå…³é”®ç‚¹ï¼š</p><ol><li><strong>ç§æœ‰æ„é€ æ–¹æ³•</strong>ï¼šç¡®ä¿å…¶ä»–ç±»ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–è¯¥ç±»ã€‚</li><li><strong>é™æ€å˜é‡</strong>ï¼šä¿å­˜ç±»çš„å”¯ä¸€å®ä¾‹ã€‚</li><li><strong>é™æ€æ–¹æ³•</strong>ï¼šæä¾›è·å–å®ä¾‹çš„å…¨å±€è®¿é—®ç‚¹ã€‚</li></ol><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„å•ä¾‹æ¨¡å¼çš„ Java ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatabaseConnection</span> &#123;</span><br><span class="line">    <span class="comment">// 1. ç§æœ‰é™æ€å˜é‡ï¼Œç”¨äºä¿å­˜å”¯ä¸€å®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DatabaseConnection instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. ç§æœ‰æ„é€ æ–¹æ³•ï¼Œé˜²æ­¢å¤–éƒ¨ç›´æ¥å®ä¾‹åŒ–</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">DatabaseConnection</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œå¯ä»¥è¿›è¡Œä¸€äº›æ•°æ®åº“è¿æ¥çš„åˆå§‹åŒ–æ“ä½œ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ›å»ºæ•°æ®åº“è¿æ¥...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. å…¬å…±é™æ€æ–¹æ³•ï¼Œç”¨äºè·å–å®ä¾‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> DatabaseConnection <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå®ä¾‹ä¸ºç©ºï¼Œåˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹</span></span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">DatabaseConnection</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¿”å›å®ä¾‹</span></span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œé€šè¿‡å°†æ„é€ æ–¹æ³•è®¾ä¸ºç§æœ‰ï¼Œç¡®ä¿å…¶ä»–ç±»ä¸èƒ½ç›´æ¥å®ä¾‹åŒ– DatabaseConnectionç±»ã€‚é€šè¿‡æä¾›é™æ€æ–¹æ³• <code>getInstance()</code>ï¼Œå…¶ä»–ç±»å¯ä»¥è·å– DatabaseConnectionçš„å”¯ä¸€å®ä¾‹ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œå¦‚æœå®ä¾‹ä¸ºç©ºï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œå¦åˆ™ç›´æ¥è¿”å›ç°æœ‰å®ä¾‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…¨å±€IOå¯†é›†å‹çº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalThreadPool</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> ExecutorService instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ æ–¹æ³•ï¼Œé˜²æ­¢å¤–éƒ¨å®ä¾‹åŒ–</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">GlobalThreadPool</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å…¨å±€å”¯ä¸€çº¿ç¨‹æ± å®ä¾‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åŒé‡æ£€æŸ¥é”å®šï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨</span></span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (GlobalThreadPool.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = createThreadPool();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºçº¿ç¨‹æ± </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ExecutorService <span class="title function_">createThreadPool</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">corePoolSize</span> <span class="operator">=</span> <span class="number">32</span>; <span class="comment">// æ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆIOå¯†é›†å‹ä¸ºCPUæ ¸æ•°*4ï¼‰</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">maximumPoolSize</span> <span class="operator">=</span> <span class="number">40</span>; <span class="comment">// æœ€å¤§çº¿ç¨‹æ•°ï¼ˆIOå¯†é›†å‹ä¸ºCPUæ ¸æ•°*5ï¼‰</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">keepAliveTime</span> <span class="operator">=</span> <span class="number">60L</span>; <span class="comment">// ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼ˆç§’ï¼‰</span></span><br><span class="line">        <span class="type">TimeUnit</span> <span class="variable">unit</span> <span class="operator">=</span> TimeUnit.SECONDS; <span class="comment">// æ—¶é—´å•ä½</span></span><br><span class="line">        BlockingQueue&lt;Runnable&gt; workQueue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">100</span>); <span class="comment">// ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">        <span class="type">ThreadFactory</span> <span class="variable">threadFactory</span> <span class="operator">=</span> Executors.defaultThreadFactory(); <span class="comment">// çº¿ç¨‹å·¥å‚</span></span><br><span class="line">        <span class="type">RejectedExecutionHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomRejectedExecutionHandler</span>(); <span class="comment">// è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥ï¼šç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå‘é€é‚®ä»¶ï¼Œè®°å½•æ—¥å¿—</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, threadFactory, handler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance != <span class="literal">null</span>) &#123;</span><br><span class="line">            instance.shutdown();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!instance.awaitTermination(<span class="number">60</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">                    instance.shutdownNow();</span><br><span class="line">                    <span class="keyword">if</span> (!instance.awaitTermination(<span class="number">60</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">                        log.error(<span class="string">&quot;çº¿ç¨‹æ± æœªèƒ½æ­£å¸¸å…³é—­&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException ie) &#123;</span><br><span class="line">                instance.shutdownNow();</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æ˜¯æˆ‘å†™çš„ä¸€ä¸ªä½¿ç”¨å•ä¾‹æ¨¡å¼åˆ›å»ºçš„å…¨å±€å”¯ä¸€çš„çº¿ç¨‹æ± ï¼Œé‡‡ç”¨äº†åŒé‡æ£€æŸ¥é”å®š</p><h3 id="å•ä¾‹æ¨¡å¼çš„åŒæ­¥é—®é¢˜"><a href="#å•ä¾‹æ¨¡å¼çš„åŒæ­¥é—®é¢˜" class="headerlink" title="å•ä¾‹æ¨¡å¼çš„åŒæ­¥é—®é¢˜"></a>å•ä¾‹æ¨¡å¼çš„åŒæ­¥é—®é¢˜</h3><p>å‡è®¾æˆ‘ä»¬æ²¡æœ‰åŒé‡æ£€æŸ¥é”å®šï¼Œåªåœ¨ <code>getInstance</code> æ–¹æ³•ä¸Šä½¿ç”¨åŒæ­¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> ExecutorService <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">        instance = createThreadPool();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯æ¬¡è°ƒç”¨ <code>getInstance</code> éƒ½ä¼šè¿›å…¥åŒæ­¥å—ï¼Œå³ä½¿ <code>instance</code> å·²ç»è¢«åˆ›å»ºã€‚è¿™ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºåŒæ­¥å—ä¼šå¯¼è‡´çº¿ç¨‹äº‰ç”¨ï¼Œé™ä½å¹¶å‘æ€§èƒ½ã€‚</p><p><strong>ç¬¬äºŒæ¬¡æ£€æŸ¥ï¼š</strong>å†æ¬¡æ£€æŸ¥ <code>instance</code> æ˜¯å¦ä¸º <code>null</code>ã€‚ç”±äºè¿›å…¥åŒæ­¥å—åï¼Œå¯èƒ½æœ‰å…¶ä»–çº¿ç¨‹å·²ç»åˆ›å»ºäº†å®ä¾‹ï¼Œæ‰€ä»¥éœ€è¦å†æ¬¡æ£€æŸ¥ï¼Œä»¥ç¡®ä¿åªåˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ“ä½œç³»ç»Ÿ</title>
      <link href="/2023/10/03/Study-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
      <url>/2023/10/03/Study-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æœ¬ç¯‡æ–‡ç« å­¦ä¹ è‡ª<a href="https://xiaolincoding.com/os/">https://xiaolincoding.com/os/</a> å’ŒJavaguide</p><p>é¢è¯•é¢˜ï¼š</p><ol><li>fork()è°ƒç”¨ç³»ç»Ÿåº•å±‚å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</li><li>å­è¿›ç¨‹å¯ä»¥è®¿é—®çˆ¶è¿›ç¨‹çš„å…¨å±€å˜é‡å—ï¼Ÿï¼ˆä¸å¯ä»¥ï¼‰</li><li>è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ï¼Ÿ</li><li>ç¼ºé¡µä¸­æ–­ã€‚</li></ol><h1 id="ç¡¬ä»¶ç»“æ„"><a href="#ç¡¬ä»¶ç»“æ„" class="headerlink" title="ç¡¬ä»¶ç»“æ„"></a>ç¡¬ä»¶ç»“æ„</h1><h2 id="å†¯è¯ºä¾æ›¼æ¨¡å‹"><a href="#å†¯è¯ºä¾æ›¼æ¨¡å‹" class="headerlink" title="å†¯è¯ºä¾æ›¼æ¨¡å‹"></a>å†¯è¯ºä¾æ›¼æ¨¡å‹</h2><p>æœ€é‡è¦çš„æ˜¯å®šä¹‰è®¡ç®—æœºåŸºæœ¬ç»“æ„ä¸º 5 ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯<strong>è¿ç®—å™¨ã€æ§åˆ¶å™¨ã€å­˜å‚¨å™¨ã€è¾“å…¥è®¾å¤‡ã€è¾“å‡ºè®¾å¤‡</strong>ï¼Œè¿™ 5 ä¸ªéƒ¨åˆ†ä¹Ÿè¢«ç§°ä¸º<strong>å†¯è¯ºä¾æ›¼æ¨¡å‹</strong>ã€‚</p><p><img src="/../assets/Study-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/image-20240601220846287.png" alt="image-20240601220846287"></p><p>è¿ç®—å™¨ã€æ§åˆ¶å™¨æ˜¯åœ¨ä¸­å¤®å¤„ç†å™¨é‡Œçš„ï¼Œå­˜å‚¨å™¨å°±æˆ‘ä»¬å¸¸è§çš„å†…å­˜ï¼Œè¾“å…¥è¾“å‡ºè®¾å¤‡åˆ™æ˜¯è®¡ç®—æœºå¤–æ¥çš„è®¾å¤‡ï¼Œæ¯”å¦‚é”®ç›˜å°±æ˜¯è¾“å…¥è®¾å¤‡ï¼Œæ˜¾ç¤ºå™¨å°±æ˜¯è¾“å‡ºè®¾å¤‡ã€‚</p><p>å­˜å‚¨å•å…ƒå’Œè¾“å…¥è¾“å‡ºè®¾å¤‡è¦ä¸ä¸­å¤®å¤„ç†å™¨æ‰“äº¤é“çš„è¯ï¼Œç¦»ä¸å¼€æ€»çº¿ã€‚æ‰€ä»¥ï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹å›¾ï¼š</p><p><img src="/../assets/Study-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E5%86%AF%E8%AF%BA%E4%BE%9D%E6%9B%BC%E6%A8%A1%E5%9E%8B.png" alt="img"></p><p>CPU å†…éƒ¨è¿˜æœ‰ä¸€äº›ç»„ä»¶ï¼Œå¸¸è§çš„æœ‰<strong>å¯„å­˜å™¨ã€æ§åˆ¶å•å…ƒå’Œé€»è¾‘è¿ç®—å•å…ƒ</strong>ç­‰ã€‚å…¶ä¸­ï¼Œæ§åˆ¶å•å…ƒè´Ÿè´£æ§åˆ¶ CPU å·¥ä½œï¼Œé€»è¾‘è¿ç®—å•å…ƒè´Ÿè´£è®¡ç®—ï¼Œè€Œå¯„å­˜å™¨å¯ä»¥åˆ†ä¸ºå¤šç§ç±»ï¼Œæ¯ç§å¯„å­˜å™¨çš„åŠŸèƒ½åˆä¸å°½ç›¸åŒã€‚</p><p>å¸¸è§çš„å¯„å­˜å™¨ç§ç±»ï¼š</p><ul><li><em>é€šç”¨å¯„å­˜å™¨</em>ï¼Œç”¨æ¥å­˜æ”¾éœ€è¦è¿›è¡Œè¿ç®—çš„æ•°æ®ï¼Œæ¯”å¦‚éœ€è¦è¿›è¡ŒåŠ å’Œè¿ç®—çš„ä¸¤ä¸ªæ•°æ®ã€‚</li><li><em>ç¨‹åºè®¡æ•°å™¨</em>ï¼Œç”¨æ¥å­˜å‚¨ CPU è¦æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€Œæ‰€åœ¨çš„å†…å­˜åœ°å€ã€ï¼Œæ³¨æ„ä¸æ˜¯å­˜å‚¨äº†ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œæ­¤æ—¶æŒ‡ä»¤è¿˜åœ¨å†…å­˜ä¸­ï¼Œç¨‹åºè®¡æ•°å™¨åªæ˜¯å­˜å‚¨äº†ä¸‹ä¸€æ¡æŒ‡ä»¤ã€Œçš„åœ°å€ã€ã€‚</li><li><em>æŒ‡ä»¤å¯„å­˜å™¨</em>ï¼Œç”¨æ¥å­˜æ”¾å½“å‰æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯æŒ‡ä»¤æœ¬èº«ï¼ŒæŒ‡ä»¤è¢«æ‰§è¡Œå®Œæˆä¹‹å‰ï¼ŒæŒ‡ä»¤éƒ½å­˜å‚¨åœ¨è¿™é‡Œã€‚</li></ul><h3 id="æ€»çº¿"><a href="#æ€»çº¿" class="headerlink" title="æ€»çº¿"></a>æ€»çº¿</h3><p>æ€»çº¿æ˜¯ç”¨äº CPU å’Œå†…å­˜ä»¥åŠå…¶ä»–è®¾å¤‡ä¹‹é—´çš„é€šä¿¡ï¼Œæ€»çº¿å¯åˆ†ä¸º 3 ç§ï¼š</p><ul><li><em>åœ°å€æ€»çº¿</em>ï¼Œç”¨äºæŒ‡å®š CPU å°†è¦æ“ä½œçš„å†…å­˜åœ°å€ï¼›</li><li><em>æ•°æ®æ€»çº¿</em>ï¼Œç”¨äºè¯»å†™å†…å­˜çš„æ•°æ®ï¼›</li><li><em>æ§åˆ¶æ€»çº¿</em>ï¼Œç”¨äºå‘é€å’Œæ¥æ”¶ä¿¡å·ï¼Œæ¯”å¦‚ä¸­æ–­ã€è®¾å¤‡å¤ä½ç­‰ä¿¡å·ï¼ŒCPU æ”¶åˆ°ä¿¡å·åè‡ªç„¶è¿›è¡Œå“åº”ï¼Œè¿™æ—¶ä¹Ÿéœ€è¦æ§åˆ¶æ€»çº¿ï¼›</li></ul><p>å½“ CPU è¦è¯»å†™å†…å­˜æ•°æ®çš„æ—¶å€™ï¼Œä¸€èˆ¬éœ€è¦é€šè¿‡ä¸‹é¢è¿™ä¸‰ä¸ªæ€»çº¿ï¼š</p><ul><li>é¦–å…ˆè¦é€šè¿‡ã€Œåœ°å€æ€»çº¿ã€æ¥æŒ‡å®šå†…å­˜çš„åœ°å€ï¼›</li><li>ç„¶åé€šè¿‡ã€Œæ§åˆ¶æ€»çº¿ã€æ§åˆ¶æ˜¯è¯»æˆ–å†™å‘½ä»¤ï¼›</li><li>æœ€åé€šè¿‡ã€Œæ•°æ®æ€»çº¿ã€æ¥ä¼ è¾“æ•°æ®ï¼›</li></ul><h3 id="ç¨‹åºçš„æ‰§è¡Œæµç¨‹"><a href="#ç¨‹åºçš„æ‰§è¡Œæµç¨‹" class="headerlink" title="ç¨‹åºçš„æ‰§è¡Œæµç¨‹"></a>ç¨‹åºçš„æ‰§è¡Œæµç¨‹</h3><p>ç¨‹åºå®é™…ä¸Šæ˜¯ä¸€æ¡ä¸€æ¡æŒ‡ä»¤ï¼Œæ‰€ä»¥ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹å°±æ˜¯æŠŠæ¯ä¸€æ¡æŒ‡ä»¤ä¸€æ­¥ä¸€æ­¥çš„æ‰§è¡Œèµ·æ¥ï¼Œè´Ÿè´£æ‰§è¡ŒæŒ‡ä»¤çš„å°±æ˜¯ CPU äº†ã€‚</p><p><img src="/../assets/Study-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/CPU%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F.png" alt="img"></p><p>é‚£ CPU æ‰§è¡Œç¨‹åºçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ä¸€æ­¥ï¼ŒCPU è¯»å–ã€Œç¨‹åºè®¡æ•°å™¨ã€çš„å€¼ï¼Œè¿™ä¸ªå€¼æ˜¯æŒ‡ä»¤çš„å†…å­˜åœ°å€ï¼Œç„¶å CPU çš„ã€Œæ§åˆ¶å•å…ƒã€æ“ä½œã€Œåœ°å€æ€»çº¿ã€æŒ‡å®šéœ€è¦è®¿é—®çš„å†…å­˜åœ°å€ï¼Œæ¥ç€é€šçŸ¥å†…å­˜è®¾å¤‡å‡†å¤‡æ•°æ®ï¼Œæ•°æ®å‡†å¤‡å¥½åé€šè¿‡ã€Œæ•°æ®æ€»çº¿ã€å°†æŒ‡ä»¤æ•°æ®ä¼ ç»™ CPUï¼ŒCPU æ”¶åˆ°å†…å­˜ä¼ æ¥çš„æ•°æ®åï¼Œå°†è¿™ä¸ªæŒ‡ä»¤æ•°æ®å­˜å…¥åˆ°ã€ŒæŒ‡ä»¤å¯„å­˜å™¨ã€ã€‚</li><li>ç¬¬äºŒæ­¥ï¼Œã€Œç¨‹åºè®¡æ•°å™¨ã€çš„å€¼è‡ªå¢ï¼Œè¡¨ç¤ºæŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚è¿™ä¸ªè‡ªå¢çš„å¤§å°ï¼Œç”± CPU çš„ä½å®½å†³å®šï¼Œæ¯”å¦‚ 32 ä½çš„ CPUï¼ŒæŒ‡ä»¤æ˜¯ 4 ä¸ªå­—èŠ‚ï¼Œéœ€è¦ 4 ä¸ªå†…å­˜åœ°å€å­˜æ”¾ï¼Œå› æ­¤ã€Œç¨‹åºè®¡æ•°å™¨ã€çš„å€¼ä¼šè‡ªå¢ 4ï¼›</li><li>ç¬¬ä¸‰æ­¥ï¼ŒCPU åˆ†æã€ŒæŒ‡ä»¤å¯„å­˜å™¨ã€ä¸­çš„æŒ‡ä»¤ï¼Œç¡®å®šæŒ‡ä»¤çš„ç±»å‹å’Œå‚æ•°ï¼Œå¦‚æœæ˜¯è®¡ç®—ç±»å‹çš„æŒ‡ä»¤ï¼Œå°±æŠŠæŒ‡ä»¤äº¤ç»™ã€Œé€»è¾‘è¿ç®—å•å…ƒã€è¿ç®—ï¼›å¦‚æœæ˜¯å­˜å‚¨ç±»å‹çš„æŒ‡ä»¤ï¼Œåˆ™äº¤ç”±ã€Œæ§åˆ¶å•å…ƒã€æ‰§è¡Œï¼›</li></ul><p>ç®€å•æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼Œä¸€ä¸ªç¨‹åºæ‰§è¡Œçš„æ—¶å€™ï¼ŒCPU ä¼šæ ¹æ®ç¨‹åºè®¡æ•°å™¨é‡Œçš„å†…å­˜åœ°å€ï¼Œä»å†…å­˜é‡Œé¢æŠŠéœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤è¯»å–åˆ°æŒ‡ä»¤å¯„å­˜å™¨é‡Œé¢æ‰§è¡Œï¼Œç„¶åæ ¹æ®æŒ‡ä»¤é•¿åº¦è‡ªå¢ï¼Œå¼€å§‹é¡ºåºè¯»å–ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</p><p>CPU ä»ç¨‹åºè®¡æ•°å™¨è¯»å–æŒ‡ä»¤ã€åˆ°æ‰§è¡Œã€å†åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šä¸æ–­å¾ªç¯ï¼Œç›´åˆ°ç¨‹åºæ‰§è¡Œç»“æŸï¼Œè¿™ä¸ªä¸æ–­å¾ªç¯çš„è¿‡ç¨‹è¢«ç§°ä¸º <strong>CPU çš„æŒ‡ä»¤å‘¨æœŸ</strong>ã€‚</p><h2 id="å­˜å‚¨å™¨çš„å±‚æ¬¡ç»“æ„"><a href="#å­˜å‚¨å™¨çš„å±‚æ¬¡ç»“æ„" class="headerlink" title="å­˜å‚¨å™¨çš„å±‚æ¬¡ç»“æ„"></a>å­˜å‚¨å™¨çš„å±‚æ¬¡ç»“æ„</h2><p><img src="/../assets/Study-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/image-20240601221333415.png" alt="image-20240601221333415"></p><p><strong>å¯¹äºå­˜å‚¨å™¨ï¼Œå®ƒçš„é€Ÿåº¦è¶Šå¿«ã€èƒ½è€—ä¼šè¶Šé«˜ã€è€Œä¸”ææ–™çš„æˆæœ¬ä¹Ÿæ˜¯è¶Šè´µçš„ï¼Œä»¥è‡³äºé€Ÿåº¦å¿«çš„å­˜å‚¨å™¨çš„å®¹é‡éƒ½æ¯”è¾ƒå°ã€‚</strong></p><p>å…¶ä¸­ï¼Œå­˜å‚¨ç©ºé—´è¶Šå¤§çš„å­˜å‚¨å™¨è®¾å¤‡ï¼Œå…¶è®¿é—®é€Ÿåº¦è¶Šæ…¢ï¼Œæ‰€éœ€æˆæœ¬ä¹Ÿç›¸å¯¹è¶Šå°‘ã€‚</p><p>CPU å¹¶ä¸ä¼šç›´æ¥å’Œæ¯ä¸€ç§å­˜å‚¨å™¨è®¾å¤‡ç›´æ¥æ‰“äº¤é“ï¼Œè€Œæ˜¯æ¯ä¸€ç§å­˜å‚¨å™¨è®¾å¤‡åªå’Œå®ƒç›¸é‚»çš„å­˜å‚¨å™¨è®¾å¤‡æ‰“äº¤é“ã€‚</p><p>æ¯”å¦‚ï¼ŒCPU Cache çš„æ•°æ®æ˜¯ä»å†…å­˜åŠ è½½è¿‡æ¥çš„ï¼Œå†™å›æ•°æ®çš„æ—¶å€™ä¹Ÿåªå†™å›åˆ°å†…å­˜ï¼ŒCPU Cache ä¸ä¼šç›´æ¥æŠŠæ•°æ®å†™åˆ°ç¡¬ç›˜ï¼Œä¹Ÿä¸ä¼šç›´æ¥ä»ç¡¬ç›˜åŠ è½½æ•°æ®ï¼Œè€Œæ˜¯å…ˆåŠ è½½åˆ°å†…å­˜ï¼Œå†ä»å†…å­˜åŠ è½½åˆ° CPU Cache ä¸­ã€‚</p><p><img src="/../assets/Study-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E5%99%A8%E7%9A%84%E5%B1%82%E6%AC%A1%E5%85%B3%E7%B3%BB%E5%9B%BE.png" alt="img"></p><p>æ‰€ä»¥ï¼Œ<mark><strong>æ¯ä¸ªå­˜å‚¨å™¨åªå’Œç›¸é‚»çš„ä¸€å±‚å­˜å‚¨å™¨è®¾å¤‡æ‰“äº¤é“ï¼Œå¹¶ä¸”å­˜å‚¨è®¾å¤‡ä¸ºäº†è¿½æ±‚æ›´å¿«çš„é€Ÿåº¦ï¼Œæ‰€éœ€çš„ææ–™æˆæœ¬å¿…ç„¶ä¹Ÿæ˜¯æ›´é«˜ï¼Œä¹Ÿæ­£å› ä¸ºæˆæœ¬å¤ªé«˜ï¼Œæ‰€ä»¥ CPU å†…éƒ¨çš„å¯„å­˜å™¨ã€L1\L2\L3 Cache åªå¥½ç”¨è¾ƒå°çš„å®¹é‡ï¼Œç›¸åå†…å­˜ã€ç¡¬ç›˜åˆ™å¯ç”¨æ›´å¤§çš„å®¹é‡ï¼Œè¿™å°±æˆ‘ä»¬ä»Šå¤©æ‰€è¯´çš„å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„</strong></mark>ã€‚</p><h2 id="å†…æ ¸"><a href="#å†…æ ¸" class="headerlink" title="å†…æ ¸"></a>å†…æ ¸</h2><p>ä»€ä¹ˆæ˜¯å†…æ ¸å‘¢ï¼Ÿ</p><p>è®¡ç®—æœºæ˜¯ç”±å„ç§å¤–éƒ¨ç¡¬ä»¶è®¾å¤‡ç»„æˆçš„ï¼Œæ¯”å¦‚å†…å­˜ã€cpuã€ç¡¬ç›˜ç­‰ï¼Œå¦‚æœæ¯ä¸ªåº”ç”¨éƒ½è¦å’Œè¿™äº›ç¡¬ä»¶è®¾å¤‡å¯¹æ¥é€šä¿¡åè®®ï¼Œé‚£è¿™æ ·å¤ªç´¯äº†ï¼Œæ‰€ä»¥è¿™ä¸ªä¸­é—´äººå°±ç”±å†…æ ¸æ¥è´Ÿè´£ï¼Œ<strong>è®©å†…æ ¸ä½œä¸ºåº”ç”¨è¿æ¥ç¡¬ä»¶è®¾å¤‡çš„æ¡¥æ¢</strong>ï¼Œåº”ç”¨ç¨‹åºåªéœ€å…³å¿ƒä¸å†…æ ¸äº¤äº’ï¼Œä¸ç”¨å…³å¿ƒç¡¬ä»¶çš„ç»†èŠ‚ã€‚</p><p><img src="/../assets/Study-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Kernel_Layout.png" alt="å†…æ ¸"></p><p><strong><mark>å†…æ ¸æœ‰å“ªäº›èƒ½åŠ›å‘¢ï¼Ÿ</mark></strong></p><p>ç°ä»£æ“ä½œç³»ç»Ÿï¼Œå†…æ ¸ä¸€èˆ¬ä¼šæä¾› 4 ä¸ªåŸºæœ¬èƒ½åŠ›ï¼š</p><ul><li>ç®¡ç†è¿›ç¨‹ã€çº¿ç¨‹ï¼Œå†³å®šå“ªä¸ªè¿›ç¨‹ã€çº¿ç¨‹ä½¿ç”¨ CPUï¼Œä¹Ÿå°±æ˜¯<strong>è¿›ç¨‹è°ƒåº¦çš„èƒ½åŠ›</strong>ï¼›</li><li>ç®¡ç†å†…å­˜ï¼Œå†³å®šå†…å­˜çš„åˆ†é…å’Œå›æ”¶ï¼Œä¹Ÿå°±æ˜¯<strong>å†…å­˜ç®¡ç†çš„èƒ½åŠ›</strong>ï¼›</li><li>ç®¡ç†ç¡¬ä»¶è®¾å¤‡ï¼Œä¸ºè¿›ç¨‹ä¸ç¡¬ä»¶è®¾å¤‡ä¹‹é—´æä¾›é€šä¿¡èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯<strong>ç¡¬ä»¶é€šä¿¡èƒ½åŠ›</strong>ï¼›</li><li>æä¾›<strong>ç³»ç»Ÿè°ƒç”¨</strong>ï¼Œå¦‚æœåº”ç”¨ç¨‹åºè¦è¿è¡Œæ›´é«˜æƒé™è¿è¡Œçš„æœåŠ¡ï¼Œé‚£ä¹ˆå°±éœ€è¦æœ‰ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒæ˜¯ç”¨æˆ·ç¨‹åºä¸æ“ä½œç³»ç»Ÿä¹‹é—´çš„æ¥å£ã€‚</li></ul><p><strong><mark>å†…æ ¸æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ</mark></strong></p><p>å†…æ ¸å…·æœ‰å¾ˆé«˜çš„æƒé™ï¼Œå¯ä»¥æ§åˆ¶ cpuã€å†…å­˜ã€ç¡¬ç›˜ç­‰ç¡¬ä»¶ï¼Œè€Œåº”ç”¨ç¨‹åºå…·æœ‰çš„æƒé™å¾ˆå°ï¼Œå› æ­¤å¤§å¤šæ•°æ“ä½œç³»ç»Ÿï¼ŒæŠŠå†…å­˜åˆ†æˆäº†ä¸¤ä¸ªåŒºåŸŸï¼š</p><ul><li>å†…æ ¸ç©ºé—´ï¼Œè¿™ä¸ªå†…å­˜ç©ºé—´åªæœ‰å†…æ ¸ç¨‹åºå¯ä»¥è®¿é—®ï¼›</li><li>ç”¨æˆ·ç©ºé—´ï¼Œè¿™ä¸ªå†…å­˜ç©ºé—´ä¸“é—¨ç»™åº”ç”¨ç¨‹åºä½¿ç”¨ï¼›</li></ul><p>ç”¨æˆ·ç©ºé—´çš„ä»£ç åªèƒ½è®¿é—®ä¸€ä¸ªå±€éƒ¨çš„å†…å­˜ç©ºé—´ï¼Œè€Œå†…æ ¸ç©ºé—´çš„ä»£ç å¯ä»¥è®¿é—®æ‰€æœ‰å†…å­˜ç©ºé—´ã€‚å› æ­¤ï¼Œå½“ç¨‹åºä½¿ç”¨ç”¨æˆ·ç©ºé—´æ—¶ï¼Œæˆ‘ä»¬å¸¸è¯´è¯¥ç¨‹åºåœ¨<strong>ç”¨æˆ·æ€</strong>æ‰§è¡Œï¼Œè€Œå½“ç¨‹åºä½¿å†…æ ¸ç©ºé—´æ—¶ï¼Œç¨‹åºåˆ™åœ¨<strong>å†…æ ¸æ€</strong>æ‰§è¡Œã€‚</p><p>åº”ç”¨ç¨‹åºå¦‚æœéœ€è¦è¿›å…¥å†…æ ¸ç©ºé—´ï¼Œå°±éœ€è¦é€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼Œä¸‹é¢æ¥çœ‹çœ‹ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹ï¼š</p><p><img src="/../assets/Study-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/systemcall.png" alt="img"></p><p>å†…æ ¸ç¨‹åºæ‰§è¡Œåœ¨å†…æ ¸æ€ï¼Œç”¨æˆ·ç¨‹åºæ‰§è¡Œåœ¨ç”¨æˆ·æ€ã€‚å½“åº”ç”¨ç¨‹åºä½¿ç”¨ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªä¸­æ–­ã€‚å‘ç”Ÿä¸­æ–­åï¼Œ CPU ä¼šä¸­æ–­å½“å‰åœ¨æ‰§è¡Œçš„ç”¨æˆ·ç¨‹åºï¼Œè½¬è€Œè·³è½¬åˆ°ä¸­æ–­å¤„ç†ç¨‹åºï¼Œä¹Ÿå°±æ˜¯å¼€å§‹æ‰§è¡Œå†…æ ¸ç¨‹åºã€‚å†…æ ¸å¤„ç†å®Œåï¼Œä¸»åŠ¨è§¦å‘ä¸­æ–­ï¼ŒæŠŠ CPU æ‰§è¡Œæƒé™äº¤å›ç»™ç”¨æˆ·ç¨‹åºï¼Œå›åˆ°ç”¨æˆ·æ€ç»§ç»­å·¥ä½œ</p><h2 id="CPUç¼“å­˜ä¸€è‡´æ€§"><a href="#CPUç¼“å­˜ä¸€è‡´æ€§" class="headerlink" title="CPUç¼“å­˜ä¸€è‡´æ€§"></a>CPUç¼“å­˜ä¸€è‡´æ€§</h2><p>CPU åœ¨è¯»å†™æ•°æ®çš„æ—¶å€™ï¼Œéƒ½æ˜¯åœ¨ CPU Cache è¯»å†™æ•°æ®çš„ï¼ŒåŸå› æ˜¯ Cache ç¦» CPU å¾ˆè¿‘ï¼Œè¯»å†™æ€§èƒ½ç›¸æ¯”å†…å­˜é«˜å‡ºå¾ˆå¤šã€‚å¯¹äº Cache é‡Œæ²¡æœ‰ç¼“å­˜ CPU æ‰€éœ€è¦è¯»å–çš„æ•°æ®çš„è¿™ç§æƒ…å†µï¼ŒCPU åˆ™ä¼šä»å†…å­˜è¯»å–æ•°æ®ï¼Œå¹¶å°†æ•°æ®ç¼“å­˜åˆ° Cache é‡Œé¢ï¼Œæœ€å CPU å†ä» Cache è¯»å–æ•°æ®ã€‚</p><p>è€Œå¯¹äºæ•°æ®çš„å†™å…¥ï¼ŒCPU éƒ½ä¼šå…ˆå†™å…¥åˆ° Cache é‡Œé¢ï¼Œç„¶åå†åœ¨æ‰¾ä¸ªåˆé€‚çš„æ—¶æœºå†™å…¥åˆ°å†…å­˜ï¼Œé‚£å°±æœ‰ã€Œå†™ç›´è¾¾ã€å’Œã€Œå†™å›ã€è¿™ä¸¤ç§ç­–ç•¥æ¥ä¿è¯ Cache ä¸å†…å­˜çš„æ•°æ®ä¸€è‡´æ€§ï¼š</p><ul><li>å†™ç›´è¾¾ï¼Œåªè¦æœ‰æ•°æ®å†™å…¥ï¼Œéƒ½ä¼šç›´æ¥æŠŠæ•°æ®å†™å…¥åˆ°å†…å­˜é‡Œé¢ï¼Œè¿™ç§æ–¹å¼ç®€å•ç›´è§‚ï¼Œä½†æ˜¯æ€§èƒ½å°±ä¼šå—é™äºå†…å­˜çš„è®¿é—®é€Ÿåº¦ï¼›</li><li>å†™å›ï¼Œå¯¹äºå·²ç»ç¼“å­˜åœ¨ Cache çš„æ•°æ®çš„å†™å…¥ï¼Œåªéœ€è¦æ›´æ–°å…¶æ•°æ®å°±å¯ä»¥ï¼Œä¸ç”¨å†™å…¥åˆ°å†…å­˜ï¼Œåªæœ‰åœ¨éœ€è¦æŠŠç¼“å­˜é‡Œé¢çš„è„æ•°æ®äº¤æ¢å‡ºå»çš„æ—¶å€™ï¼Œæ‰æŠŠæ•°æ®åŒæ­¥åˆ°å†…å­˜é‡Œï¼Œè¿™ç§æ–¹å¼åœ¨ç¼“å­˜å‘½ä¸­ç‡é«˜çš„æƒ…å†µï¼Œæ€§èƒ½ä¼šæ›´å¥½ï¼›</li></ul><p><strong>å½“ä»Š CPU éƒ½æ˜¯å¤šæ ¸çš„ï¼Œæ¯ä¸ªæ ¸å¿ƒéƒ½æœ‰å„è‡ªç‹¬ç«‹çš„ L1&#x2F;L2 Cacheï¼Œåªæœ‰ L3 Cache æ˜¯å¤šä¸ªæ ¸å¿ƒä¹‹é—´å…±äº«çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦ç¡®ä¿å¤šæ ¸ç¼“å­˜æ˜¯ä¸€è‡´æ€§çš„ï¼Œå¦åˆ™ä¼šå‡ºç°é”™è¯¯çš„ç»“æœã€‚</strong></p><p>è¦æƒ³å®ç°ç¼“å­˜ä¸€è‡´æ€§ï¼Œå…³é”®æ˜¯è¦æ»¡è¶³ 2 ç‚¹ï¼š</p><ul><li>ç¬¬ä¸€ç‚¹æ˜¯å†™ä¼ æ’­ï¼Œä¹Ÿå°±æ˜¯å½“æŸä¸ª CPU æ ¸å¿ƒå‘ç”Ÿå†™å…¥æ“ä½œæ—¶ï¼Œéœ€è¦æŠŠè¯¥äº‹ä»¶å¹¿æ’­é€šçŸ¥ç»™å…¶ä»–æ ¸å¿ƒï¼›</li><li>ç¬¬äºŒç‚¹æ˜¯äº‹ç‰©çš„ä¸²è¡ŒåŒ–ï¼Œè¿™ä¸ªå¾ˆé‡è¦ï¼Œåªæœ‰ä¿è¯äº†è¿™ä¸ªï¼Œæ‰èƒ½ä¿éšœæˆ‘ä»¬çš„æ•°æ®æ˜¯çœŸæ­£ä¸€è‡´çš„ï¼Œæˆ‘ä»¬çš„ç¨‹åºåœ¨å„ä¸ªä¸åŒçš„æ ¸å¿ƒä¸Šè¿è¡Œçš„ç»“æœä¹Ÿæ˜¯ä¸€è‡´çš„ï¼›</li></ul><p>**<mark>åŸºäºæ€»çº¿å—…æ¢æœºåˆ¶çš„ MESI åè®®</mark>**ï¼Œå°±æ»¡è¶³ä¸Šé¢äº†è¿™ä¸¤ç‚¹ï¼Œå› æ­¤å®ƒæ˜¯ä¿éšœç¼“å­˜ä¸€è‡´æ€§çš„åè®®ã€‚</p><p>MESI åè®®ï¼Œæ˜¯å·²ä¿®æ”¹ã€ç‹¬å ã€å…±äº«ã€å·²å¤±æ•ˆè¿™å››ä¸ªçŠ¶æ€çš„è‹±æ–‡ç¼©å†™çš„ç»„åˆã€‚æ•´ä¸ª MSI çŠ¶æ€çš„å˜æ›´ï¼Œåˆ™æ˜¯æ ¹æ®æ¥è‡ªæœ¬åœ° CPU æ ¸å¿ƒçš„è¯·æ±‚ï¼Œæˆ–è€…æ¥è‡ªå…¶ä»– CPU æ ¸å¿ƒé€šè¿‡æ€»çº¿ä¼ è¾“è¿‡æ¥çš„è¯·æ±‚ï¼Œä»è€Œæ„æˆä¸€ä¸ªæµåŠ¨çš„çŠ¶æ€æœºã€‚å¦å¤–ï¼Œå¯¹äºåœ¨ã€Œå·²ä¿®æ”¹ã€æˆ–è€…ã€Œç‹¬å ã€çŠ¶æ€çš„ Cache Lineï¼Œä¿®æ”¹æ›´æ–°å…¶æ•°æ®ä¸éœ€è¦å‘é€å¹¿æ’­ç»™å…¶ä»– CPU æ ¸å¿ƒã€‚</p><p>ğŸ”´ğŸŸ¢ğŸŸ¡è¡¥å……ï¼š</p><p>CPUç¼“å­˜ä¸€è‡´æ€§ï¼ˆCache Coherenceï¼‰æ˜¯æŒ‡åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œä¿è¯å„ä¸ªå¤„ç†å™¨ç¼“å­˜ä¸­çš„æ•°æ®ä¸ä¸»å­˜ä¸­çš„æ•°æ®ä¿æŒä¸€è‡´ï¼Œä»¥é˜²æ­¢ä¸åŒå¤„ç†å™¨è¯»å–åˆ°ä¸åŒç‰ˆæœ¬çš„æ•°æ®ã€‚CPUç¼“å­˜ä¸€è‡´æ€§é—®é¢˜é€šå¸¸å‡ºç°åœ¨å¤šæ ¸å¤„ç†å™¨æˆ–å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰è‡ªå·±çš„ç¼“å­˜ã€‚å½“å¤šä¸ªå¤„ç†å™¨å¹¶å‘åœ°è¯»å–å’Œå†™å…¥å…±äº«å†…å­˜åŒºåŸŸæ—¶ï¼Œå¿…é¡»ç¡®ä¿ç¼“å­˜æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><h3 id="ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜"><a href="#ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜"></a>ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜</h3><p>ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜å¯ä»¥æè¿°ä¸ºä»¥ä¸‹å‡ ç§å…¸å‹æƒ…æ™¯ï¼š</p><ol><li><p><strong>å†™å¤±æ•ˆï¼ˆWrite Invalidationï¼‰ï¼š</strong></p><ul><li>å¤„ç†å™¨Aå°†æ•°æ®å†™å…¥è‡ªå·±çš„ç¼“å­˜ï¼Œä½†å¤„ç†å™¨Bçš„ç¼“å­˜ä¸­ä»ä¿ç•™æ—§æ•°æ®ã€‚è¿™ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</li></ul></li><li><p><strong>å†™æ›´æ–°ï¼ˆWrite Updateï¼‰ï¼š</strong></p><ul><li>å¤„ç†å™¨Aå°†æ•°æ®å†™å…¥è‡ªå·±çš„ç¼“å­˜å¹¶æ›´æ–°å†…å­˜ï¼Œå¤„ç†å™¨Bçš„ç¼“å­˜éœ€è¦åŒæ­¥æ›´æ–°æ­¤æ•°æ®ï¼Œä»¥ç¡®ä¿ä¸€è‡´æ€§ã€‚</li></ul></li></ol><h3 id="ç¼“å­˜ä¸€è‡´æ€§åè®®"><a href="#ç¼“å­˜ä¸€è‡´æ€§åè®®" class="headerlink" title="ç¼“å­˜ä¸€è‡´æ€§åè®®"></a>ç¼“å­˜ä¸€è‡´æ€§åè®®</h3><p>ä¸ºäº†è§£å†³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼Œç°ä»£å¤„ç†å™¨é€šå¸¸é‡‡ç”¨ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼ˆCache Coherence Protocolsï¼‰ã€‚æœ€å¸¸è§çš„ç¼“å­˜ä¸€è‡´æ€§åè®®æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ol><li><p><strong>MSIåè®®ï¼ˆModified, Shared, Invalidï¼‰ï¼š</strong></p><ul><li>æ•°æ®åœ¨ç¼“å­˜ä¸­çš„çŠ¶æ€å¯ä»¥æ˜¯Modifiedï¼ˆå·²ä¿®æ”¹ï¼‰ã€Sharedï¼ˆå…±äº«ï¼‰ã€Invalidï¼ˆæ— æ•ˆï¼‰ä¸‰ç§çŠ¶æ€ã€‚</li><li>å½“å¤„ç†å™¨å¯¹æ•°æ®è¿›è¡Œå†™æ“ä½œæ—¶ï¼Œä¼šå°†è¯¥æ•°æ®æ ‡è®°ä¸ºModifiedï¼Œå¹¶ä½¿å…¶ä»–ç¼“å­˜ä¸­ç›¸åŒæ•°æ®å˜ä¸ºInvalidã€‚</li></ul></li><li><p><strong>MESIåè®®ï¼ˆModified, Exclusive, Shared, Invalidï¼‰ï¼š</strong></p><ul><li>åœ¨MSIçš„åŸºç¡€ä¸Šå¢åŠ äº†ExclusiveçŠ¶æ€ï¼Œè¡¨ç¤ºè¯¥æ•°æ®åªå­˜åœ¨äºä¸€ä¸ªç¼“å­˜ä¸­ä¸”æœªè¢«ä¿®æ”¹ã€‚</li><li>å¤„ç†å™¨åœ¨è¯»å–æ•°æ®æ—¶ï¼Œå¦‚æœè¯¥æ•°æ®åœ¨ç¼“å­˜ä¸­æ˜¯ExclusiveçŠ¶æ€ï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€è®¿é—®ä¸»å­˜ã€‚</li></ul></li><li><p><strong>MOESIåè®®ï¼ˆModified, Owner, Exclusive, Shared, Invalidï¼‰ï¼š</strong></p><ul><li>åœ¨MESIçš„åŸºç¡€ä¸Šå¢åŠ äº†OwnerçŠ¶æ€ï¼Œè¡¨ç¤ºè¯¥æ•°æ®åœ¨æŸä¸ªç¼“å­˜ä¸­æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ä¸”å…±äº«ç»™å…¶ä»–å¤„ç†å™¨ã€‚</li><li>å¤„ç†å™¨å¯ä»¥ä»Ownerç¼“å­˜ä¸­è·å–æœ€æ–°æ•°æ®ï¼Œè€Œæ— éœ€è®¿é—®ä¸»å­˜ã€‚</li></ul></li><li><p><strong>MESIFåè®®ï¼ˆModified, Exclusive, Shared, Invalid, Forwardï¼‰ï¼š</strong></p><ul><li>åœ¨MESIçš„åŸºç¡€ä¸Šå¢åŠ äº†ForwardçŠ¶æ€ï¼Œç”¨äºä¼˜åŒ–è¯»æ“ä½œã€‚å½“å¤šä¸ªç¼“å­˜å…±äº«åŒä¸€æ•°æ®æ—¶ï¼ŒForwardçŠ¶æ€ç¼“å­˜è´Ÿè´£å‘å…¶ä»–å¤„ç†å™¨è½¬å‘æ•°æ®ã€‚</li></ul></li></ol><h3 id="ç¼“å­˜ä¸€è‡´æ€§æ“ä½œ"><a href="#ç¼“å­˜ä¸€è‡´æ€§æ“ä½œ" class="headerlink" title="ç¼“å­˜ä¸€è‡´æ€§æ“ä½œ"></a>ç¼“å­˜ä¸€è‡´æ€§æ“ä½œ</h3><p>ç¼“å­˜ä¸€è‡´æ€§åè®®é€šè¿‡ä»¥ä¸‹æ“ä½œæ¥ç»´æŒä¸€è‡´æ€§ï¼š</p><ol><li><p><strong>å—…æ¢ï¼ˆSnoopingï¼‰ï¼š</strong></p><ul><li>å¤„ç†å™¨é€šè¿‡å—…æ¢æ€»çº¿ä¸Šçš„é€šä¿¡æ¥ç›‘è§†å…¶ä»–å¤„ç†å™¨çš„è¯»å†™æ“ä½œã€‚å¦‚æœæ£€æµ‹åˆ°å…¶ä»–å¤„ç†å™¨å¯¹å…±äº«æ•°æ®çš„å†™æ“ä½œï¼Œç¼“å­˜è¡ŒçŠ¶æ€ä¼šç›¸åº”åœ°æ›´æ–°ã€‚</li></ul></li><li><p><strong>ç›®å½•åè®®ï¼ˆDirectory-Based Protocolsï¼‰ï¼š</strong></p><ul><li>ç³»ç»Ÿç»´æŠ¤ä¸€ä¸ªç›®å½•ï¼Œè®°å½•æ¯ä¸ªå†…å­˜å—åœ¨å“ªäº›ç¼“å­˜ä¸­å­˜åœ¨ä»¥åŠå®ƒä»¬çš„çŠ¶æ€ã€‚å¤„ç†å™¨åœ¨è¯»å†™æ•°æ®æ—¶ï¼Œé€šè¿‡æŸ¥è¯¢ç›®å½•æ¥æ›´æ–°ç¼“å­˜çŠ¶æ€ã€‚</li></ul></li><li><p><strong>æ€»çº¿åŠ é”ï¼ˆBus Lockingï¼‰ï¼š</strong></p><ul><li>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¤„ç†å™¨å¯ä»¥é€šè¿‡é”å®šæ€»çº¿æ¥ä¿è¯å¯¹æ•°æ®çš„ç‹¬å è®¿é—®ï¼Œé˜²æ­¢å…¶ä»–å¤„ç†å™¨å¹²æ‰°ã€‚</li></ul></li></ol><p>é€šè¿‡è¿™äº›åè®®å’Œæ“ä½œï¼ŒCPUå¯ä»¥ç¡®ä¿å„å¤„ç†å™¨ç¼“å­˜ä¸­çš„æ•°æ®ä¸€è‡´æ€§ï¼Œé¿å…å¹¶å‘è®¿é—®å¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚</p><h1 id="å†…å­˜ç®¡ç†"><a href="#å†…å­˜ç®¡ç†" class="headerlink" title="å†…å­˜ç®¡ç†"></a>å†…å­˜ç®¡ç†</h1><h2 id="ä¸ºä»€ä¹ˆè¦æœ‰è™šæ‹Ÿå†…å­˜"><a href="#ä¸ºä»€ä¹ˆè¦æœ‰è™šæ‹Ÿå†…å­˜" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æœ‰è™šæ‹Ÿå†…å­˜"></a>ä¸ºä»€ä¹ˆè¦æœ‰è™šæ‹Ÿå†…å­˜</h2><h1 id="è¿›ç¨‹ç®¡ç†"><a href="#è¿›ç¨‹ç®¡ç†" class="headerlink" title="è¿›ç¨‹ç®¡ç†"></a>è¿›ç¨‹ç®¡ç†</h1><h2 id="è¿›ç¨‹å’Œçº¿ç¨‹å…±äº«å“ªäº›èµ„æº"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹å…±äº«å“ªäº›èµ„æº" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹å…±äº«å“ªäº›èµ„æº"></a>è¿›ç¨‹å’Œçº¿ç¨‹å…±äº«å“ªäº›èµ„æº</h2><p>å…±äº«çš„èµ„æºå’Œä¸å…±äº«çš„èµ„æºåˆ’åˆ†å¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th>èµ„æºç±»å‹</th><th>å…±äº«&#x2F;ä¸å…±äº«</th><th>æè¿°</th></tr></thead><tbody><tr><td>ä»£ç æ®µ</td><td>å…±äº«</td><td>æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œç›¸åŒçš„ä»£ç æ®µã€‚</td></tr><tr><td>è¿›ç¨‹åœ°å€ç©ºé—´</td><td>å…±äº«</td><td>åŒ…æ‹¬å †å’Œå…¨å±€å˜é‡ï¼Œæ‰€æœ‰çº¿ç¨‹å¯ä»¥è®¿é—®å’Œä¿®æ”¹ã€‚</td></tr><tr><td>æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦</td><td>å…±äº«</td><td>æ‰€æœ‰çº¿ç¨‹å¯ä»¥è®¿é—®è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶å’Œå¥—æ¥å­—ã€‚</td></tr><tr><td>å½“å‰å·¥ä½œç›®å½•</td><td>å…±äº«</td><td>æ‰€æœ‰çº¿ç¨‹å…±äº«ç›¸åŒçš„å½“å‰å·¥ä½œç›®å½•ã€‚</td></tr><tr><td>ç”¨æˆ·IDå’Œç»„ID</td><td>å…±äº«</td><td>çº¿ç¨‹å…±äº«ç›¸åŒçš„ç”¨æˆ·IDå’Œç»„IDï¼Œå…·æœ‰ç›¸åŒçš„æƒé™ã€‚</td></tr><tr><td>ä¿¡å·å¤„ç†å™¨</td><td>å…±äº«</td><td>æ‰€æœ‰çº¿ç¨‹å…±äº«ç›¸åŒçš„ä¿¡å·å¤„ç†å™¨ã€‚</td></tr><tr><td>å®šæ—¶å™¨</td><td>å…±äº«</td><td>ç”±è¿›ç¨‹è®¾ç½®çš„å®šæ—¶å™¨æ˜¯çº¿ç¨‹å…±äº«çš„ã€‚</td></tr><tr><td>æ ˆ</td><td>ä¸å…±äº«</td><td>æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„æ ˆï¼Œç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡å’Œå‡½æ•°è°ƒç”¨ä¿¡æ¯ã€‚</td></tr><tr><td>çº¿ç¨‹å±€éƒ¨å­˜å‚¨</td><td>ä¸å…±äº«</td><td>æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„çº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼Œç”¨äºå­˜å‚¨çº¿ç¨‹ç‰¹æœ‰çš„æ•°æ®ã€‚</td></tr><tr><td>ç¨‹åºè®¡æ•°å™¨</td><td>ä¸å…±äº«</td><td>æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ï¼ŒæŒ‡ç¤ºå½“å‰æ‰§è¡Œçš„æŒ‡ä»¤ã€‚</td></tr><tr><td>å¯„å­˜å™¨</td><td>ä¸å…±äº«</td><td>æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„ä¸€ç»„å¯„å­˜å™¨ã€‚</td></tr><tr><td>ä¿¡å·æ©ç </td><td>ä¸å…±äº«</td><td>æ¯ä¸ªçº¿ç¨‹å¯ä»¥æœ‰è‡ªå·±çš„ä¿¡å·æ©ç ã€‚</td></tr><tr><td>è°ƒåº¦ä¿¡æ¯</td><td>ä¸å…±äº«</td><td>æ¯ä¸ªçº¿ç¨‹å¯ä»¥æœ‰è‡ªå·±çš„ä¼˜å…ˆçº§å’Œè°ƒåº¦å±æ€§ã€‚</td></tr></tbody></table><h2 id="è¿›ç¨‹é€šä¿¡"><a href="#è¿›ç¨‹é€šä¿¡" class="headerlink" title="è¿›ç¨‹é€šä¿¡"></a>è¿›ç¨‹é€šä¿¡</h2><p>è¿›ç¨‹é€šä¿¡æ¶‰åŠåœ¨ä¸åŒè¿›ç¨‹ä¹‹é—´ä¼ é€’æ•°æ®æˆ–ä¿¡æ¯ã€‚ç”±äºè¿›ç¨‹é€šå¸¸åœ¨ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ä¸­è¿è¡Œï¼Œå®ƒä»¬éœ€è¦ç‰¹å®šçš„æœºåˆ¶æ¥äº¤æ¢æ•°æ®ã€‚**<mark>è¿›ç¨‹é€šä¿¡çš„ä¸»è¦ç›®æ ‡æ˜¯æ•°æ®äº¤æ¢å’Œä¿¡æ¯ä¼ é€’ï¼Œä½¿å¾—å¤šä¸ªè¿›ç¨‹èƒ½å¤ŸååŒå·¥ä½œã€‚</mark>**</p><h3 id="ç®¡é“"><a href="#ç®¡é“" class="headerlink" title="ç®¡é“"></a>ç®¡é“</h3><p><strong>åŒ¿åç®¡é“</strong>é¡¾åæ€ä¹‰ï¼Œå®ƒæ²¡æœ‰åå­—æ ‡è¯†ï¼ŒåŒ¿åç®¡é“æ˜¯ç‰¹æ®Šæ–‡ä»¶åªå­˜åœ¨äºå†…å­˜ï¼Œæ²¡æœ‰å­˜åœ¨äºæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œshell å‘½ä»¤ä¸­çš„ã€Œ<code>|</code>ã€ç«–çº¿å°±æ˜¯åŒ¿åç®¡é“ï¼Œé€šä¿¡çš„æ•°æ®æ˜¯<strong>æ— æ ¼å¼çš„æµå¹¶ä¸”å¤§å°å—é™</strong>ï¼Œé€šä¿¡çš„æ–¹å¼æ˜¯<strong>å•å‘</strong>çš„ï¼Œæ•°æ®åªèƒ½åœ¨ä¸€ä¸ªæ–¹å‘ä¸ŠæµåŠ¨ï¼Œå¦‚æœè¦åŒå‘é€šä¿¡ï¼Œéœ€è¦åˆ›å»ºä¸¤ä¸ªç®¡é“ï¼Œå†æ¥<strong>åŒ¿åç®¡é“æ˜¯åªèƒ½ç”¨äºå­˜åœ¨çˆ¶å­å…³ç³»çš„è¿›ç¨‹é—´é€šä¿¡</strong>ï¼ŒåŒ¿åç®¡é“çš„ç”Ÿå‘½å‘¨æœŸéšç€è¿›ç¨‹åˆ›å»ºè€Œå»ºç«‹ï¼Œéšç€è¿›ç¨‹ç»ˆæ­¢è€Œæ¶ˆå¤±ã€‚</p><p><strong>å‘½åç®¡é“</strong>çªç ´äº†åŒ¿åç®¡é“åªèƒ½åœ¨äº²ç¼˜å…³ç³»è¿›ç¨‹é—´çš„é€šä¿¡é™åˆ¶ï¼Œå› ä¸ºä½¿ç”¨å‘½åç®¡é“çš„å‰æï¼Œéœ€è¦åœ¨æ–‡ä»¶ç³»ç»Ÿåˆ›å»ºä¸€ä¸ªç±»å‹ä¸º p çš„è®¾å¤‡æ–‡ä»¶ï¼Œé‚£ä¹ˆæ¯«æ— å…³ç³»çš„è¿›ç¨‹å°±å¯ä»¥é€šè¿‡è¿™ä¸ªè®¾å¤‡æ–‡ä»¶è¿›è¡Œé€šä¿¡ã€‚å¦å¤–ï¼Œä¸ç®¡æ˜¯åŒ¿åç®¡é“è¿˜æ˜¯å‘½åç®¡é“ï¼Œè¿›ç¨‹å†™å…¥çš„æ•°æ®éƒ½æ˜¯<strong>ç¼“å­˜åœ¨å†…æ ¸</strong>ä¸­ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹è¯»å–æ•°æ®æ—¶å€™è‡ªç„¶ä¹Ÿæ˜¯ä»å†…æ ¸ä¸­è·å–ï¼ŒåŒæ—¶é€šä¿¡æ•°æ®éƒ½éµå¾ª<strong>å…ˆè¿›å…ˆå‡º</strong>åŸåˆ™ï¼Œä¸æ”¯æŒ lseek ä¹‹ç±»çš„æ–‡ä»¶å®šä½æ“ä½œã€‚</p><h3 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—"></a>æ¶ˆæ¯é˜Ÿåˆ—</h3><p><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>å…‹æœäº†ç®¡é“é€šä¿¡çš„æ•°æ®æ˜¯æ— æ ¼å¼çš„å­—èŠ‚æµçš„é—®é¢˜ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å®é™…ä¸Šæ˜¯ä¿å­˜åœ¨å†…æ ¸çš„ã€Œæ¶ˆæ¯é“¾è¡¨ã€ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯ä½“æ˜¯å¯ä»¥ç”¨æˆ·è‡ªå®šä¹‰çš„æ•°æ®ç±»å‹ï¼Œå‘é€æ•°æ®æ—¶ï¼Œä¼šè¢«åˆ†æˆä¸€ä¸ªä¸€ä¸ªç‹¬ç«‹çš„æ¶ˆæ¯ä½“ï¼Œå½“ç„¶æ¥æ”¶æ•°æ®æ—¶ï¼Œä¹Ÿè¦ä¸å‘é€æ–¹å‘é€çš„æ¶ˆæ¯ä½“çš„æ•°æ®ç±»å‹ä¿æŒä¸€è‡´ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯è¯»å–çš„æ•°æ®æ˜¯æ­£ç¡®çš„ã€‚æ¶ˆæ¯é˜Ÿåˆ—é€šä¿¡çš„é€Ÿåº¦ä¸æ˜¯æœ€åŠæ—¶çš„ï¼Œæ¯•ç«Ÿ<strong>æ¯æ¬¡æ•°æ®çš„å†™å…¥å’Œè¯»å–éƒ½éœ€è¦ç»è¿‡ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´çš„æ‹·è´è¿‡ç¨‹ã€‚</strong></p><h3 id="å…±äº«å†…å­˜-ä¿¡å·é‡"><a href="#å…±äº«å†…å­˜-ä¿¡å·é‡" class="headerlink" title="å…±äº«å†…å­˜+ä¿¡å·é‡"></a>å…±äº«å†…å­˜+ä¿¡å·é‡</h3><p><strong>å…±äº«å†…å­˜</strong>å¯ä»¥è§£å†³æ¶ˆæ¯é˜Ÿåˆ—é€šä¿¡ä¸­ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´æ•°æ®æ‹·è´è¿‡ç¨‹å¸¦æ¥çš„å¼€é”€ï¼Œ<strong>å®ƒç›´æ¥åˆ†é…ä¸€ä¸ªå…±äº«ç©ºé—´ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½å¯ä»¥ç›´æ¥è®¿é—®</strong>ï¼Œå°±åƒè®¿é—®è¿›ç¨‹è‡ªå·±çš„ç©ºé—´ä¸€æ ·å¿«æ·æ–¹ä¾¿ï¼Œä¸éœ€è¦é™·å…¥å†…æ ¸æ€æˆ–è€…ç³»ç»Ÿè°ƒç”¨ï¼Œå¤§å¤§æé«˜äº†é€šä¿¡çš„é€Ÿåº¦ï¼Œäº«æœ‰<strong>æœ€å¿«</strong>çš„è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ä¹‹åã€‚ä½†æ˜¯ä¾¿æ·é«˜æ•ˆçš„å…±äº«å†…å­˜é€šä¿¡ï¼Œ<strong>å¸¦æ¥æ–°çš„é—®é¢˜ï¼Œå¤šè¿›ç¨‹ç«äº‰åŒä¸ªå…±äº«èµ„æºä¼šé€ æˆæ•°æ®çš„é”™ä¹±ã€‚</strong></p><p>é‚£ä¹ˆï¼Œå°±éœ€è¦<strong>ä¿¡å·é‡</strong>æ¥ä¿æŠ¤å…±äº«èµ„æºï¼Œä»¥ç¡®ä¿ä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªè¿›ç¨‹è®¿é—®å…±äº«èµ„æºï¼Œè¿™ç§æ–¹å¼å°±æ˜¯äº’æ–¥è®¿é—®ã€‚<strong>ä¿¡å·é‡ä¸ä»…å¯ä»¥å®ç°è®¿é—®çš„äº’æ–¥æ€§ï¼Œè¿˜å¯ä»¥å®ç°è¿›ç¨‹é—´çš„åŒæ­¥</strong>ï¼Œä¿¡å·é‡å…¶å®æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œè¡¨ç¤ºçš„æ˜¯èµ„æºä¸ªæ•°ï¼Œå…¶å€¼å¯ä»¥é€šè¿‡ä¸¤ä¸ªåŸå­æ“ä½œæ¥æ§åˆ¶ï¼Œåˆ†åˆ«æ˜¯ <strong>P æ“ä½œå’Œ V æ“ä½œ</strong>ã€‚</p><h3 id="ä¿¡å·"><a href="#ä¿¡å·" class="headerlink" title="ä¿¡å·"></a>ä¿¡å·</h3><p>ä¿¡å·æ˜¯<strong>å¼‚æ­¥é€šä¿¡æœºåˆ¶</strong>ï¼Œä¿¡å·å¯ä»¥åœ¨åº”ç”¨è¿›ç¨‹å’Œå†…æ ¸ä¹‹é—´ç›´æ¥äº¤äº’ï¼Œå†…æ ¸ä¹Ÿå¯ä»¥åˆ©ç”¨ä¿¡å·æ¥é€šçŸ¥ç”¨æˆ·ç©ºé—´çš„è¿›ç¨‹å‘ç”Ÿäº†å“ªäº›ç³»ç»Ÿäº‹ä»¶ï¼Œä¿¡å·äº‹ä»¶çš„æ¥æºä¸»è¦æœ‰ç¡¬ä»¶æ¥æºï¼ˆå¦‚é”®ç›˜ Cltr+C ï¼‰å’Œè½¯ä»¶æ¥æºï¼ˆå¦‚ kill å‘½ä»¤ï¼‰ï¼Œä¸€æ—¦æœ‰ä¿¡å·å‘ç”Ÿï¼Œ<strong>è¿›ç¨‹æœ‰ä¸‰ç§æ–¹å¼å“åº”ä¿¡å· 1. æ‰§è¡Œé»˜è®¤æ“ä½œã€2. æ•æ‰ä¿¡å·ã€3. å¿½ç•¥ä¿¡å·</strong>ã€‚æœ‰ä¸¤ä¸ªä¿¡å·æ˜¯åº”ç”¨è¿›ç¨‹æ— æ³•æ•æ‰å’Œå¿½ç•¥çš„ï¼Œå³ <code>SIGKILL</code> å’Œ <code>SIGSTOP</code>ï¼Œè¿™æ˜¯ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬èƒ½åœ¨ä»»ä½•æ—¶å€™ç»“æŸæˆ–åœæ­¢æŸä¸ªè¿›ç¨‹ã€‚</p><h3 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h3><p>å¦‚æœ<strong>è¦ä¸<mark>ä¸åŒä¸»æœºçš„è¿›ç¨‹é—´é€šä¿¡</mark>ï¼Œé‚£ä¹ˆå°±éœ€è¦ Socket é€šä¿¡äº†</strong>ã€‚Socket å®é™…ä¸Šä¸ä»…ç”¨äºä¸åŒçš„ä¸»æœºè¿›ç¨‹é—´é€šä¿¡ï¼Œè¿˜å¯ä»¥ç”¨äºæœ¬åœ°ä¸»æœºè¿›ç¨‹é—´é€šä¿¡ï¼Œå¯æ ¹æ®åˆ›å»º Socket çš„ç±»å‹ä¸åŒï¼Œåˆ†ä¸ºä¸‰ç§å¸¸è§çš„é€šä¿¡æ–¹å¼ï¼Œä¸€ä¸ªæ˜¯åŸºäº TCP åè®®çš„é€šä¿¡æ–¹å¼ï¼Œä¸€ä¸ªæ˜¯åŸºäº UDP åè®®çš„é€šä¿¡æ–¹å¼ï¼Œä¸€ä¸ªæ˜¯æœ¬åœ°è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ã€‚</p><h2 id="è¿›ç¨‹åŒæ­¥"><a href="#è¿›ç¨‹åŒæ­¥" class="headerlink" title="è¿›ç¨‹åŒæ­¥"></a>è¿›ç¨‹åŒæ­¥</h2><p>è¿›ç¨‹åŒæ­¥æ—¨åœ¨åè°ƒå¤šä¸ªè¿›ç¨‹çš„æ‰§è¡Œé¡ºåºï¼Œä»¥é˜²æ­¢æ•°æ®ä¸ä¸€è‡´å’Œç«æ€æ¡ä»¶ï¼ˆRace Conditionsï¼‰ã€‚å½“å¤šä¸ªè¿›ç¨‹åŒæ—¶è®¿é—®å’Œæ“ä½œå…±äº«èµ„æºæ—¶ï¼Œè¿›ç¨‹åŒæ­¥æ˜¯å¿…éœ€çš„ã€‚**<mark>è¿›ç¨‹åŒæ­¥çš„ä¸»è¦ç›®æ ‡æ˜¯ç¡®ä¿å…±äº«èµ„æºçš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼Œé˜²æ­¢æ•°æ®å†²çªå’Œæ­»é”ç­‰é—®é¢˜ã€‚</mark>**</p><p>å¸¸ç”¨çš„è¿›ç¨‹åŒæ­¥æœºåˆ¶åŒ…æ‹¬ï¼š</p><ol><li><p>**äº’æ–¥é” (Mutexes)**ï¼šç¡®ä¿æŸä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¿›ç¨‹èƒ½å¤Ÿè®¿é—®å…±äº«èµ„æºã€‚</p></li><li><p>**ä¿¡å·é‡ (Semaphores)**ï¼šå¯ä»¥ç”¨æ¥é™åˆ¶å¯¹å¤šä¸ªèµ„æºçš„è®¿é—®ï¼Œåˆ†ä¸ºè®¡æ•°ä¿¡å·é‡å’ŒäºŒè¿›åˆ¶ä¿¡å·é‡ã€‚</p></li><li><p>**æ¡ä»¶å˜é‡ (Condition Variables)**ï¼šç”¨äºè¿›ç¨‹ç­‰å¾…ç‰¹å®šæ¡ä»¶å˜ä¸ºçœŸæ—¶å†ç»§ç»­æ‰§è¡Œã€‚</p></li><li><p>**è¯»å†™é” (Read-Write Locks)**ï¼šå…è®¸å¤šè¯»å•å†™çš„è®¿é—®æ¨¡å¼ï¼Œæé«˜å¹¶å‘æ€§ã€‚</p></li></ol><h2 id="PCB-æ˜¯ä»€ä¹ˆï¼ŸåŒ…å«å“ªäº›ä¿¡æ¯ï¼Ÿ"><a href="#PCB-æ˜¯ä»€ä¹ˆï¼ŸåŒ…å«å“ªäº›ä¿¡æ¯ï¼Ÿ" class="headerlink" title="PCB æ˜¯ä»€ä¹ˆï¼ŸåŒ…å«å“ªäº›ä¿¡æ¯ï¼Ÿ"></a>PCB æ˜¯ä»€ä¹ˆï¼ŸåŒ…å«å“ªäº›ä¿¡æ¯ï¼Ÿ</h2><p><strong>PCBï¼ˆProcess Control Blockï¼‰</strong> å³è¿›ç¨‹æ§åˆ¶å—ï¼Œæ˜¯æ“ä½œç³»ç»Ÿä¸­ç”¨æ¥ç®¡ç†å’Œè·Ÿè¸ªè¿›ç¨‹çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½å¯¹åº”ç€ä¸€ä¸ªç‹¬ç«‹çš„ PCBã€‚ä½ å¯ä»¥å°† PCB è§†ä¸ºè¿›ç¨‹çš„å¤§è„‘ã€‚</p><p>å½“æ“ä½œç³»ç»Ÿåˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹æ—¶ï¼Œä¼šä¸ºè¯¥è¿›ç¨‹åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„è¿›ç¨‹ IDï¼Œå¹¶ä¸”ä¸ºè¯¥è¿›ç¨‹åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„è¿›ç¨‹æ§åˆ¶å—ã€‚å½“è¿›ç¨‹æ‰§è¡Œæ—¶ï¼ŒPCB ä¸­çš„ä¿¡æ¯ä¼šä¸æ–­å˜åŒ–ï¼Œæ“ä½œç³»ç»Ÿä¼šæ ¹æ®è¿™äº›ä¿¡æ¯æ¥ç®¡ç†å’Œè°ƒåº¦è¿›ç¨‹ã€‚</p><p>PCB ä¸»è¦åŒ…å«ä¸‹é¢å‡ éƒ¨åˆ†çš„å†…å®¹ï¼š</p><ul><li>è¿›ç¨‹çš„æè¿°ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿›ç¨‹çš„åç§°ã€æ ‡è¯†ç¬¦ç­‰ç­‰ï¼›</li><li>è¿›ç¨‹çš„è°ƒåº¦ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿›ç¨‹é˜»å¡åŸå› ã€è¿›ç¨‹çŠ¶æ€ï¼ˆå°±ç»ªã€è¿è¡Œã€é˜»å¡ç­‰ï¼‰ã€è¿›ç¨‹ä¼˜å…ˆçº§ï¼ˆæ ‡è¯†è¿›ç¨‹çš„é‡è¦ç¨‹åº¦ï¼‰ç­‰ç­‰ï¼›</li><li>è¿›ç¨‹å¯¹èµ„æºçš„éœ€æ±‚æƒ…å†µï¼ŒåŒ…æ‹¬ CPU æ—¶é—´ã€å†…å­˜ç©ºé—´ã€I&#x2F;O è®¾å¤‡ç­‰ç­‰ã€‚</li><li>è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶æè¿°ç¬¦ã€æ–‡ä»¶ç±»å‹ã€æ‰“å¼€æ¨¡å¼ç­‰ç­‰ã€‚</li><li>å¤„ç†æœºçš„çŠ¶æ€ä¿¡æ¯ï¼ˆç”±å¤„ç†æœºçš„å„ç§å¯„å­˜å™¨ä¸­çš„å†…å®¹ç»„æˆçš„ï¼‰ï¼ŒåŒ…æ‹¬é€šç”¨å¯„å­˜å™¨ã€æŒ‡ä»¤è®¡æ•°å™¨ã€ç¨‹åºçŠ¶æ€å­— PSWã€ç”¨æˆ·æ ˆæŒ‡é’ˆã€‚</li></ul><blockquote><p>æ¯ä¸ª PCB æ˜¯å¦‚ä½•ç»„ç»‡çš„å‘¢ï¼Ÿ</p></blockquote><p>é€šå¸¸æ˜¯é€šè¿‡<strong>é“¾è¡¨</strong>çš„æ–¹å¼è¿›è¡Œç»„ç»‡ï¼ŒæŠŠå…·æœ‰<strong>ç›¸åŒçŠ¶æ€çš„è¿›ç¨‹é“¾åœ¨ä¸€èµ·ï¼Œç»„æˆå„ç§é˜Ÿåˆ—</strong>ã€‚æ¯”å¦‚ï¼š</p><ul><li>å°†æ‰€æœ‰å¤„äºå°±ç»ªçŠ¶æ€çš„è¿›ç¨‹é“¾åœ¨ä¸€èµ·ï¼Œç§°ä¸º<strong>å°±ç»ªé˜Ÿåˆ—</strong>ï¼›</li><li>æŠŠæ‰€æœ‰å› ç­‰å¾…æŸäº‹ä»¶è€Œå¤„äºç­‰å¾…çŠ¶æ€çš„è¿›ç¨‹é“¾åœ¨ä¸€èµ·å°±ç»„æˆå„ç§<strong>é˜»å¡é˜Ÿåˆ—</strong>ï¼›</li><li>å¦å¤–ï¼Œå¯¹äºè¿è¡Œé˜Ÿåˆ—åœ¨å•æ ¸ CPU ç³»ç»Ÿä¸­åˆ™åªæœ‰ä¸€ä¸ªè¿è¡ŒæŒ‡é’ˆäº†ï¼Œå› ä¸ºå•æ ¸ CPU åœ¨æŸä¸ªæ—¶é—´ï¼Œåªèƒ½è¿è¡Œä¸€ä¸ªç¨‹åºã€‚</li></ul><p>é‚£ä¹ˆï¼Œå°±ç»ªé˜Ÿåˆ—å’Œé˜»å¡é˜Ÿåˆ—é“¾è¡¨çš„ç»„ç»‡å½¢å¼å¦‚ä¸‹å›¾ï¼š</p><p><img src="/../assets/Study-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/12-PCB%E7%8A%B6%E6%80%81%E9%93%BE%E8%A1%A8%E7%BB%84%E7%BB%87.jpg" alt="å°±ç»ªé˜Ÿåˆ—å’Œé˜»å¡é˜Ÿåˆ—"></p><p>é™¤äº†é“¾æ¥çš„ç»„ç»‡æ–¹å¼ï¼Œè¿˜æœ‰ç´¢å¼•æ–¹å¼ï¼Œå®ƒçš„å·¥ä½œåŸç†ï¼šå°†åŒä¸€çŠ¶æ€çš„è¿›ç¨‹ç»„ç»‡åœ¨ä¸€ä¸ªç´¢å¼•è¡¨ä¸­ï¼Œç´¢å¼•è¡¨é¡¹æŒ‡å‘ç›¸åº”çš„ PCBï¼Œä¸åŒçŠ¶æ€å¯¹åº”ä¸åŒçš„ç´¢å¼•è¡¨ã€‚</p><p>ä¸€èˆ¬ä¼šé€‰æ‹©é“¾è¡¨ï¼Œå› ä¸ºå¯èƒ½é¢ä¸´è¿›ç¨‹åˆ›å»ºï¼Œé”€æ¯ç­‰è°ƒåº¦å¯¼è‡´è¿›ç¨‹çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥é“¾è¡¨èƒ½å¤Ÿæ›´åŠ çµæ´»çš„æ’å…¥å’Œåˆ é™¤ã€‚</p><h2 id="è¿›ç¨‹æœ‰å“ªå‡ ç§çŠ¶æ€"><a href="#è¿›ç¨‹æœ‰å“ªå‡ ç§çŠ¶æ€" class="headerlink" title="è¿›ç¨‹æœ‰å“ªå‡ ç§çŠ¶æ€?"></a>è¿›ç¨‹æœ‰å“ªå‡ ç§çŠ¶æ€?</h2><p>æˆ‘ä»¬ä¸€èˆ¬æŠŠè¿›ç¨‹å¤§è‡´åˆ†ä¸º 5 ç§çŠ¶æ€ï¼Œè¿™ä¸€ç‚¹å’Œçº¿ç¨‹å¾ˆåƒï¼</p><ul><li>**åˆ›å»ºçŠ¶æ€(new)**ï¼šè¿›ç¨‹æ­£åœ¨è¢«åˆ›å»ºï¼Œå°šæœªåˆ°å°±ç»ªçŠ¶æ€ã€‚</li><li>**å°±ç»ªçŠ¶æ€(ready)<strong>ï¼šè¿›ç¨‹å·²å¤„äºå‡†å¤‡è¿è¡ŒçŠ¶æ€ï¼Œå³</strong><mark>è¿›ç¨‹è·å¾—äº†é™¤äº†å¤„ç†å™¨ä¹‹å¤–çš„ä¸€åˆ‡æ‰€éœ€èµ„æº</mark>**ï¼Œä¸€æ—¦å¾—åˆ°å¤„ç†å™¨èµ„æº(å¤„ç†å™¨åˆ†é…çš„æ—¶é—´ç‰‡)å³å¯è¿è¡Œã€‚</li><li>**è¿è¡ŒçŠ¶æ€(running)**ï¼šè¿›ç¨‹æ­£åœ¨å¤„ç†å™¨ä¸Šè¿è¡Œ(å•æ ¸ CPU ä¸‹ä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€)ã€‚</li><li>**é˜»å¡çŠ¶æ€(waiting)**ï¼šåˆç§°ä¸ºç­‰å¾…çŠ¶æ€ï¼Œè¿›ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸€äº‹ä»¶è€Œæš‚åœè¿è¡Œå¦‚ç­‰å¾…æŸèµ„æºä¸ºå¯ç”¨æˆ–ç­‰å¾… IO æ“ä½œå®Œæˆã€‚å³ä½¿å¤„ç†å™¨ç©ºé—²ï¼Œè¯¥è¿›ç¨‹ä¹Ÿä¸èƒ½è¿è¡Œã€‚</li><li>**ç»“æŸçŠ¶æ€(terminated)**ï¼šè¿›ç¨‹æ­£åœ¨ä»ç³»ç»Ÿä¸­æ¶ˆå¤±ã€‚å¯èƒ½æ˜¯è¿›ç¨‹æ­£å¸¸ç»“æŸæˆ–å…¶ä»–åŸå› ä¸­æ–­é€€å‡ºè¿è¡Œã€‚</li></ul><p><img src="/../assets/Study-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/state-transition-of-process.png" alt="è¿›ç¨‹çŠ¶æ€å›¾è½¬æ¢å›¾"></p><hr><p><img src="/../assets/Study-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/10-%E8%BF%9B%E7%A8%8B%E4%B8%83%E4%B8%AD%E7%8A%B6%E6%80%81.jpg" alt="ä¸ƒç§çŠ¶æ€å˜è¿"></p><h2 id="è¿›ç¨‹çš„æ§åˆ¶"><a href="#è¿›ç¨‹çš„æ§åˆ¶" class="headerlink" title="è¿›ç¨‹çš„æ§åˆ¶"></a>è¿›ç¨‹çš„æ§åˆ¶</h2><p>æˆ‘ä»¬ç†ŸçŸ¥äº†è¿›ç¨‹çš„çŠ¶æ€å˜è¿å’Œè¿›ç¨‹çš„æ•°æ®ç»“æ„ PCB åï¼Œå†æ¥çœ‹çœ‹è¿›ç¨‹çš„<strong>åˆ›å»ºã€ç»ˆæ­¢ã€é˜»å¡ã€å”¤é†’</strong>çš„è¿‡ç¨‹ï¼Œè¿™äº›è¿‡ç¨‹ä¹Ÿå°±æ˜¯è¿›ç¨‹çš„æ§åˆ¶ã€‚</p><p><strong>01 åˆ›å»ºè¿›ç¨‹</strong></p><p>æ“ä½œç³»ç»Ÿå…è®¸ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºå¦ä¸€ä¸ªè¿›ç¨‹ï¼Œè€Œä¸”å…è®¸å­è¿›ç¨‹ç»§æ‰¿çˆ¶è¿›ç¨‹æ‰€æ‹¥æœ‰çš„èµ„æºã€‚</p><p><mark>åˆ›å»ºè¿›ç¨‹çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</mark></p><ul><li>ç”³è¯·ä¸€ä¸ªç©ºç™½çš„ PCBï¼Œå¹¶å‘ PCB ä¸­å¡«å†™ä¸€äº›æ§åˆ¶å’Œç®¡ç†è¿›ç¨‹çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¿›ç¨‹çš„å”¯ä¸€æ ‡è¯†ç­‰ï¼›</li><li>ä¸ºè¯¥è¿›ç¨‹åˆ†é…è¿è¡Œæ—¶æ‰€å¿…éœ€çš„èµ„æºï¼Œæ¯”å¦‚å†…å­˜èµ„æºï¼›</li><li>å°† PCB æ’å…¥åˆ°å°±ç»ªé˜Ÿåˆ—ï¼Œç­‰å¾…è¢«è°ƒåº¦è¿è¡Œï¼›</li></ul><p><strong>02 ç»ˆæ­¢è¿›ç¨‹</strong></p><p>è¿›ç¨‹å¯ä»¥æœ‰ 3 ç§ç»ˆæ­¢æ–¹å¼ï¼šæ­£å¸¸ç»“æŸã€å¼‚å¸¸ç»“æŸä»¥åŠå¤–ç•Œå¹²é¢„ï¼ˆä¿¡å· <code>kill</code> æ‰ï¼‰ã€‚</p><p>å½“å­è¿›ç¨‹è¢«ç»ˆæ­¢æ—¶ï¼Œå…¶åœ¨çˆ¶è¿›ç¨‹å¤„ç»§æ‰¿çš„èµ„æºåº”å½“è¿˜ç»™çˆ¶è¿›ç¨‹ã€‚è€Œå½“çˆ¶è¿›ç¨‹è¢«ç»ˆæ­¢æ—¶ï¼Œè¯¥çˆ¶è¿›ç¨‹çš„å­è¿›ç¨‹å°±å˜ä¸ºå­¤å„¿è¿›ç¨‹ï¼Œä¼šè¢« 1 å·è¿›ç¨‹æ”¶å…»ï¼Œå¹¶ç”± 1 å·è¿›ç¨‹å¯¹å®ƒä»¬å®ŒæˆçŠ¶æ€æ”¶é›†å·¥ä½œã€‚</p><p><mark>ç»ˆæ­¢è¿›ç¨‹çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</mark></p><ul><li>æŸ¥æ‰¾éœ€è¦ç»ˆæ­¢çš„è¿›ç¨‹çš„ PCBï¼›</li><li>å¦‚æœå¤„äºæ‰§è¡ŒçŠ¶æ€ï¼Œåˆ™ç«‹å³ç»ˆæ­¢è¯¥è¿›ç¨‹çš„æ‰§è¡Œï¼Œç„¶åå°† CPU èµ„æºåˆ†é…ç»™å…¶ä»–è¿›ç¨‹ï¼›</li><li>å¦‚æœå…¶è¿˜æœ‰å­è¿›ç¨‹ï¼Œåˆ™åº”å°†è¯¥è¿›ç¨‹çš„å­è¿›ç¨‹äº¤ç»™ 1 å·è¿›ç¨‹æ¥ç®¡ï¼›</li><li>å°†è¯¥è¿›ç¨‹æ‰€æ‹¥æœ‰çš„å…¨éƒ¨èµ„æºéƒ½å½’è¿˜ç»™æ“ä½œç³»ç»Ÿï¼›</li><li>å°†å…¶ä» PCB æ‰€åœ¨é˜Ÿåˆ—ä¸­åˆ é™¤ï¼›</li></ul><p><strong>03 é˜»å¡è¿›ç¨‹</strong></p><p>å½“è¿›ç¨‹éœ€è¦ç­‰å¾…æŸä¸€äº‹ä»¶å®Œæˆæ—¶ï¼Œå®ƒå¯ä»¥è°ƒç”¨é˜»å¡è¯­å¥æŠŠè‡ªå·±é˜»å¡ç­‰å¾…ã€‚è€Œä¸€æ—¦è¢«é˜»å¡ç­‰å¾…ï¼Œå®ƒåªèƒ½ç”±å¦ä¸€ä¸ªè¿›ç¨‹å”¤é†’ã€‚</p><p><mark>é˜»å¡è¿›ç¨‹çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</mark></p><ul><li>æ‰¾åˆ°å°†è¦è¢«é˜»å¡è¿›ç¨‹æ ‡è¯†å·å¯¹åº”çš„ PCBï¼›</li><li>å¦‚æœè¯¥è¿›ç¨‹ä¸ºè¿è¡ŒçŠ¶æ€ï¼Œåˆ™ä¿æŠ¤å…¶ç°åœºï¼Œå°†å…¶çŠ¶æ€è½¬ä¸ºé˜»å¡çŠ¶æ€ï¼Œåœæ­¢è¿è¡Œï¼›</li><li>å°†è¯¥ PCB æ’å…¥åˆ°é˜»å¡é˜Ÿåˆ—ä¸­å»ï¼›</li></ul><p><strong>04 å”¤é†’è¿›ç¨‹</strong></p><p>è¿›ç¨‹ç”±ã€Œè¿è¡Œã€è½¬å˜ä¸ºã€Œé˜»å¡ã€çŠ¶æ€æ˜¯ç”±äºè¿›ç¨‹å¿…é¡»ç­‰å¾…æŸä¸€äº‹ä»¶çš„å®Œæˆï¼Œæ‰€ä»¥å¤„äºé˜»å¡çŠ¶æ€çš„è¿›ç¨‹æ˜¯ç»å¯¹ä¸å¯èƒ½å«é†’è‡ªå·±çš„ã€‚</p><p>å¦‚æœæŸè¿›ç¨‹æ­£åœ¨ç­‰å¾… I&#x2F;O äº‹ä»¶ï¼Œéœ€ç”±åˆ«çš„è¿›ç¨‹å‘æ¶ˆæ¯ç»™å®ƒï¼Œåˆ™åªæœ‰å½“è¯¥è¿›ç¨‹æ‰€æœŸå¾…çš„äº‹ä»¶å‡ºç°æ—¶ï¼Œæ‰ç”±å‘ç°è€…è¿›ç¨‹ç”¨å”¤é†’è¯­å¥å«é†’å®ƒã€‚</p><p><mark>å”¤é†’è¿›ç¨‹çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</mark></p><ul><li>åœ¨è¯¥äº‹ä»¶çš„é˜»å¡é˜Ÿåˆ—ä¸­æ‰¾åˆ°ç›¸åº”è¿›ç¨‹çš„ PCBï¼›</li><li>å°†å…¶ä»é˜»å¡é˜Ÿåˆ—ä¸­ç§»å‡ºï¼Œå¹¶ç½®å…¶çŠ¶æ€ä¸ºå°±ç»ªçŠ¶æ€ï¼›</li><li>æŠŠè¯¥ PCB æ’å…¥åˆ°å°±ç»ªé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è°ƒåº¦ç¨‹åºè°ƒåº¦ï¼›</li></ul><p>è¿›ç¨‹çš„é˜»å¡å’Œå”¤é†’æ˜¯ä¸€å¯¹åŠŸèƒ½ç›¸åçš„è¯­å¥ï¼Œå¦‚æœæŸä¸ªè¿›ç¨‹è°ƒç”¨äº†é˜»å¡è¯­å¥ï¼Œåˆ™å¿…æœ‰ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„å”¤é†’è¯­å¥ã€‚</p><h2 id="çº¿ç¨‹ç›¸æ¯”è¿›ç¨‹èƒ½å‡å°‘å¼€é”€"><a href="#çº¿ç¨‹ç›¸æ¯”è¿›ç¨‹èƒ½å‡å°‘å¼€é”€" class="headerlink" title="çº¿ç¨‹ç›¸æ¯”è¿›ç¨‹èƒ½å‡å°‘å¼€é”€"></a>çº¿ç¨‹ç›¸æ¯”è¿›ç¨‹èƒ½å‡å°‘å¼€é”€</h2><blockquote><p><strong>çº¿ç¨‹æ˜¯è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œè€Œè¿›ç¨‹åˆ™æ˜¯èµ„æºæ‹¥æœ‰çš„åŸºæœ¬å•ä½</strong>ã€‚</p></blockquote><p>å¯¹äºï¼Œçº¿ç¨‹ç›¸æ¯”è¿›ç¨‹èƒ½å‡å°‘å¼€é”€ï¼Œä½“ç°åœ¨ï¼š</p><ul><li>çº¿ç¨‹çš„åˆ›å»ºæ—¶é—´æ¯”è¿›ç¨‹å¿«ï¼Œå› ä¸ºè¿›ç¨‹åœ¨åˆ›å»ºçš„è¿‡ç¨‹ä¸­ï¼Œè¿˜éœ€è¦èµ„æºç®¡ç†ä¿¡æ¯ï¼Œæ¯”å¦‚å†…å­˜ç®¡ç†ä¿¡æ¯ã€æ–‡ä»¶ç®¡ç†ä¿¡æ¯ï¼Œè€Œçº¿ç¨‹åœ¨åˆ›å»ºçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šæ¶‰åŠè¿™äº›èµ„æºç®¡ç†ä¿¡æ¯ï¼Œè€Œæ˜¯å…±äº«å®ƒä»¬ï¼›</li><li>çº¿ç¨‹çš„ç»ˆæ­¢æ—¶é—´æ¯”è¿›ç¨‹å¿«ï¼Œå› ä¸ºçº¿ç¨‹é‡Šæ”¾çš„èµ„æºç›¸æ¯”è¿›ç¨‹å°‘å¾ˆå¤šï¼›</li><li><strong><mark>åŒä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹åˆ‡æ¢æ¯”è¿›ç¨‹åˆ‡æ¢å¿«ï¼Œå› ä¸ºçº¿ç¨‹å…·æœ‰ç›¸åŒçš„åœ°å€ç©ºé—´ï¼ˆè™šæ‹Ÿå†…å­˜å…±äº«ï¼‰ï¼Œè¿™æ„å‘³ç€åŒä¸€ä¸ªè¿›ç¨‹çš„çº¿ç¨‹éƒ½å…·æœ‰åŒä¸€ä¸ªé¡µè¡¨ï¼Œé‚£ä¹ˆåœ¨åˆ‡æ¢çš„æ—¶å€™ä¸éœ€è¦åˆ‡æ¢é¡µè¡¨ã€‚è€Œå¯¹äºè¿›ç¨‹ä¹‹é—´çš„åˆ‡æ¢ï¼Œåˆ‡æ¢çš„æ—¶å€™è¦æŠŠé¡µè¡¨ç»™åˆ‡æ¢æ‰ï¼Œè€Œé¡µè¡¨çš„åˆ‡æ¢è¿‡ç¨‹å¼€é”€æ˜¯æ¯”è¾ƒå¤§çš„ï¼›</mark></strong></li><li>ç”±äºåŒä¸€è¿›ç¨‹çš„å„çº¿ç¨‹é—´å…±äº«å†…å­˜å’Œæ–‡ä»¶èµ„æºï¼Œé‚£ä¹ˆåœ¨çº¿ç¨‹ä¹‹é—´æ•°æ®ä¼ é€’çš„æ—¶å€™ï¼Œå°±ä¸éœ€è¦ç»è¿‡å†…æ ¸äº†ï¼Œè¿™å°±ä½¿å¾—çº¿ç¨‹ä¹‹é—´çš„æ•°æ®äº¤äº’æ•ˆç‡æ›´é«˜äº†ï¼›</li></ul><p>æ‰€ä»¥ï¼Œä¸ç®¡æ˜¯æ—¶é—´æ•ˆç‡ï¼Œè¿˜æ˜¯ç©ºé—´æ•ˆç‡çº¿ç¨‹æ¯”è¿›ç¨‹éƒ½è¦é«˜ã€‚</p><h2 id="åç¨‹ä¸çº¿ç¨‹å’Œè¿›ç¨‹çš„å¯¹æ¯”"><a href="#åç¨‹ä¸çº¿ç¨‹å’Œè¿›ç¨‹çš„å¯¹æ¯”" class="headerlink" title="åç¨‹ä¸çº¿ç¨‹å’Œè¿›ç¨‹çš„å¯¹æ¯”"></a>åç¨‹ä¸çº¿ç¨‹å’Œè¿›ç¨‹çš„å¯¹æ¯”</h2><p>åç¨‹ï¼ˆCoroutineï¼‰æ˜¯æ“ä½œç³»ç»Ÿå’Œç¼–ç¨‹è¯­è¨€ä¸­ä¸€ç§ç”¨äºå¹¶å‘ç¼–ç¨‹çš„æŠ€æœ¯ï¼Œå®ƒå…è®¸åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æš‚åœå’Œæ¢å¤å‡½æ•°ï¼Œæä¾›æ¯”ä¼ ç»Ÿçº¿ç¨‹æ›´è½»é‡çº§çš„å¹¶å‘æœºåˆ¶ã€‚åç¨‹æœ‰å‡ ä¸ªå…³é”®ç‰¹ç‚¹ï¼Œä½¿å…¶ä¸çº¿ç¨‹å’Œè¿›ç¨‹æœ‰æ˜¾è‘—åŒºåˆ«ã€‚</p><h3 id="åç¨‹çš„ç‰¹ç‚¹"><a href="#åç¨‹çš„ç‰¹ç‚¹" class="headerlink" title="åç¨‹çš„ç‰¹ç‚¹"></a>åç¨‹çš„ç‰¹ç‚¹</h3><ol><li><strong>è½»é‡çº§</strong>ï¼šåç¨‹çš„åˆ›å»ºå’Œåˆ‡æ¢å¼€é”€éå¸¸å°ï¼Œé€šå¸¸ä»…ä»…æ˜¯å‡½æ•°è°ƒç”¨å’Œè¿”å›çš„å¼€é”€ï¼Œä¸éœ€è¦åƒçº¿ç¨‹é‚£æ ·ä¾èµ–æ“ä½œç³»ç»Ÿè°ƒåº¦å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</li><li><strong>ç”¨æˆ·æ€åˆ‡æ¢</strong>ï¼šåç¨‹çš„åˆ‡æ¢æ˜¯åœ¨ç”¨æˆ·æ€å®Œæˆçš„ï¼Œä¸æ¶‰åŠå†…æ ¸æ€æ“ä½œï¼Œé¿å…äº†çº¿ç¨‹åˆ‡æ¢æ—¶çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ã€‚</li><li><strong>éæŠ¢å å¼</strong>ï¼šåç¨‹çš„åˆ‡æ¢æ˜¯åä½œå¼çš„ï¼Œå³åç¨‹ä¸»åŠ¨è®©å‡ºæ‰§è¡Œæƒï¼Œè€Œä¸æ˜¯ç”±æ“ä½œç³»ç»ŸæŠ¢å ã€‚</li><li><strong>çŠ¶æ€ä¿å­˜</strong>ï¼šåç¨‹åœ¨æš‚åœæ‰§è¡Œæ—¶ä¿å­˜å½“å‰æ‰§è¡Œçš„çŠ¶æ€ï¼ˆå¦‚å±€éƒ¨å˜é‡å’Œç¨‹åºè®¡æ•°å™¨ï¼‰ï¼Œåœ¨æ¢å¤æ—¶ä»ä¿å­˜çš„çŠ¶æ€ç»§ç»­æ‰§è¡Œã€‚</li></ol><h3 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h3><ul><li><strong>çº¿ç¨‹</strong>ï¼šç”±æ“ä½œç³»ç»Ÿç®¡ç†ï¼Œæ”¯æŒçœŸæ­£çš„å¹¶è¡Œæ‰§è¡Œï¼ˆåœ¨å¤šæ ¸å¤„ç†å™¨ä¸Šï¼‰ï¼Œä½†åˆ›å»ºå’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€è¾ƒå¤§ï¼Œå®¹æ˜“äº§ç”Ÿç«æ€æ¡ä»¶å’Œæ­»é”é—®é¢˜ã€‚</li><li><strong>è¿›ç¨‹</strong>ï¼šç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œéš”ç¦»æ€§å¼ºï¼Œé€‚åˆæ‰§è¡Œå®Œå…¨ç‹¬ç«‹çš„ä»»åŠ¡ï¼Œä½†åˆ›å»ºå’Œé€šä¿¡å¼€é”€æ›´å¤§ã€‚</li><li><strong>åç¨‹</strong>ï¼šç”¨æˆ·æ€ç®¡ç†ï¼Œè½»é‡çº§ï¼Œé€‚åˆI&#x2F;Oå¯†é›†å‹ä»»åŠ¡å’Œé«˜å¹¶å‘åœºæ™¯ï¼Œä½†ä¸é€‚åˆCPUå¯†é›†å‹ä»»åŠ¡ï¼Œå› ä¸ºå•çº¿ç¨‹å†…çš„åç¨‹æ— æ³•å¹¶è¡Œæ‰§è¡Œã€‚</li></ul><p>æ€»ä¹‹ï¼Œåç¨‹é€šè¿‡æä¾›ä¸€ç§è½»é‡çº§çš„å¹¶å‘æœºåˆ¶ï¼Œç®€åŒ–äº†å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼Œæé«˜äº†ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ï¼Œç‰¹åˆ«é€‚åˆI&#x2F;Oå¯†é›†å‹å’Œé«˜å¹¶å‘ä»»åŠ¡ã€‚</p><h2 id="çº¿ç¨‹çš„å®ç°æ–¹å¼"><a href="#çº¿ç¨‹çš„å®ç°æ–¹å¼" class="headerlink" title="çº¿ç¨‹çš„å®ç°æ–¹å¼"></a>çº¿ç¨‹çš„å®ç°æ–¹å¼</h2><p>çº¿ç¨‹çš„å®ç°æ–¹å¼ä¸»è¦åŒ…æ‹¬ç”¨æˆ·çº¿ç¨‹ã€å†…æ ¸çº¿ç¨‹å’Œè½»é‡çº§è¿›ç¨‹ï¼ˆLWPï¼‰ã€‚æ¯ç§å®ç°æ–¹å¼åœ¨ç®¡ç†ã€è°ƒåº¦å’Œæ€§èƒ½æ–¹é¢éƒ½æœ‰ä¸åŒçš„ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯ã€‚ä»¥ä¸‹æ˜¯å¯¹è¿™ä¸‰ç§çº¿ç¨‹çš„è¯¦ç»†è§£é‡Šã€‚</p><h3 id="1-ç”¨æˆ·çº¿ç¨‹ï¼ˆUser-Threadï¼‰"><a href="#1-ç”¨æˆ·çº¿ç¨‹ï¼ˆUser-Threadï¼‰" class="headerlink" title="1. ç”¨æˆ·çº¿ç¨‹ï¼ˆUser Threadï¼‰"></a>1. ç”¨æˆ·çº¿ç¨‹ï¼ˆUser Threadï¼‰</h3><h4 id="ç‰¹ç‚¹ï¼š"><a href="#ç‰¹ç‚¹ï¼š" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><ul><li><strong>ç”¨æˆ·ç©ºé—´å®ç°</strong>ï¼šç”¨æˆ·çº¿ç¨‹åœ¨ç”¨æˆ·ç©ºé—´ä¸­å®ç°ï¼Œç”±ç”¨æˆ·æ€çš„çº¿ç¨‹åº“ç®¡ç†å’Œè°ƒåº¦ï¼Œè€Œä¸æ˜¯ç”±æ“ä½œç³»ç»Ÿå†…æ ¸ç®¡ç†ã€‚</li><li><strong>è½»é‡çº§</strong>ï¼šç”±äºçº¿ç¨‹çš„åˆ›å»ºã€åˆ‡æ¢å’ŒåŒæ­¥åœ¨ç”¨æˆ·æ€å®Œæˆï¼Œå¼€é”€è¾ƒå°ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚</li><li><strong>ä¸å¯æŠ¢å </strong>ï¼šç”¨æˆ·çº¿ç¨‹çš„è°ƒåº¦ç”±ç”¨æˆ·ç¨‹åºæ§åˆ¶ï¼Œé€šå¸¸é‡‡ç”¨åä½œå¼è°ƒåº¦ï¼Œçº¿ç¨‹ä¸»åŠ¨è®©å‡ºæ§åˆ¶æƒã€‚</li><li><strong>æ— å†…æ ¸å¹²é¢„</strong>ï¼šå†…æ ¸å¯¹ç”¨æˆ·çº¿ç¨‹ä¸å¯è§ï¼Œçº¿ç¨‹åˆ‡æ¢ä¸æ¶‰åŠå†…æ ¸æ€ï¼Œå› æ­¤ä¸ä¼šå¼•èµ·å†…æ ¸ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</li></ul><h4 id="ä¼˜ç‚¹ï¼š"><a href="#ä¼˜ç‚¹ï¼š" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h4><ul><li><strong>é«˜æ•ˆ</strong>ï¼šçº¿ç¨‹æ“ä½œåœ¨ç”¨æˆ·æ€è¿›è¡Œï¼Œé¿å…äº†ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ã€‚</li><li><strong>çµæ´»</strong>ï¼šç”¨æˆ·ç¨‹åºå¯ä»¥è‡ªå®šä¹‰è°ƒåº¦ç­–ç•¥ï¼Œé€‚åº”ç‰¹å®šåº”ç”¨éœ€æ±‚ã€‚</li></ul><h4 id="ç¼ºç‚¹ï¼š"><a href="#ç¼ºç‚¹ï¼š" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h4><ul><li><strong>é˜»å¡é—®é¢˜</strong>ï¼šå¦‚æœä¸€ä¸ªç”¨æˆ·çº¿ç¨‹è¿›è¡Œé˜»å¡ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚I&#x2F;Oæ“ä½œï¼‰ï¼Œæ•´ä¸ªè¿›ç¨‹éƒ½ä¼šè¢«é˜»å¡ï¼Œå› ä¸ºå†…æ ¸æ— æ³•è¯†åˆ«å’Œè°ƒåº¦å…¶ä»–çº¿ç¨‹ã€‚</li><li><strong>å¤šæ ¸åˆ©ç”¨ä¸è¶³</strong>ï¼šç”¨æˆ·çº¿ç¨‹æ— æ³•åˆ©ç”¨å¤šå¤„ç†å™¨ç³»ç»Ÿçš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ï¼Œå› ä¸ºå†…æ ¸åªçœ‹åˆ°ä¸€ä¸ªå•ä¸€çš„è¿›ç¨‹ã€‚</li></ul><h3 id="2-å†…æ ¸çº¿ç¨‹ï¼ˆKernel-Threadï¼‰"><a href="#2-å†…æ ¸çº¿ç¨‹ï¼ˆKernel-Threadï¼‰" class="headerlink" title="2. å†…æ ¸çº¿ç¨‹ï¼ˆKernel Threadï¼‰"></a>2. å†…æ ¸çº¿ç¨‹ï¼ˆKernel Threadï¼‰</h3><h4 id="ç‰¹ç‚¹ï¼š-1"><a href="#ç‰¹ç‚¹ï¼š-1" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><ul><li><strong>å†…æ ¸ç©ºé—´å®ç°</strong>ï¼šå†…æ ¸çº¿ç¨‹åœ¨å†…æ ¸ç©ºé—´å®ç°ï¼Œç”±æ“ä½œç³»ç»Ÿå†…æ ¸ç›´æ¥ç®¡ç†å’Œè°ƒåº¦ã€‚</li><li><strong>æŠ¢å å¼è°ƒåº¦</strong>ï¼šå†…æ ¸çº¿ç¨‹å¯ä»¥è¢«æ“ä½œç³»ç»Ÿå†…æ ¸æŠ¢å å’Œè°ƒåº¦ï¼Œæ”¯æŒå¤šä»»åŠ¡å¹¶å‘ã€‚</li><li><strong>å¯è§æ€§</strong>ï¼šå†…æ ¸çº¿ç¨‹å¯¹æ“ä½œç³»ç»Ÿå†…æ ¸å¯è§ï¼Œå†…æ ¸å¯ä»¥è¯†åˆ«å’Œç®¡ç†æ¯ä¸ªçº¿ç¨‹çš„çŠ¶æ€ã€‚</li></ul><h4 id="ä¼˜ç‚¹ï¼š-1"><a href="#ä¼˜ç‚¹ï¼š-1" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h4><ul><li><strong>é˜»å¡å¤„ç†</strong>ï¼šå†…æ ¸çº¿ç¨‹çš„é˜»å¡æ“ä½œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹çš„æ‰§è¡Œï¼Œå› ä¸ºå†…æ ¸å¯ä»¥è°ƒåº¦å…¶ä»–å¯è¿è¡Œçš„çº¿ç¨‹ã€‚</li><li><strong>å¤šæ ¸æ”¯æŒ</strong>ï¼šå†…æ ¸çº¿ç¨‹å¯ä»¥åœ¨å¤šä¸ªå¤„ç†å™¨ä¸Šå¹¶è¡Œæ‰§è¡Œï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸ç³»ç»Ÿçš„è®¡ç®—èƒ½åŠ›ã€‚</li></ul><h4 id="ç¼ºç‚¹ï¼š-1"><a href="#ç¼ºç‚¹ï¼š-1" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h4><ul><li><strong>é«˜å¼€é”€</strong>ï¼šçº¿ç¨‹çš„åˆ›å»ºã€åˆ‡æ¢å’ŒåŒæ­¥éœ€è¦ç³»ç»Ÿè°ƒç”¨ï¼Œå¼€é”€è¾ƒå¤§ã€‚</li><li><strong>å¤æ‚æ€§</strong>ï¼šå†…æ ¸çº¿ç¨‹çš„ç®¡ç†å’Œè°ƒåº¦éœ€è¦æ“ä½œç³»ç»Ÿå†…æ ¸çš„æ”¯æŒï¼Œå¢åŠ äº†å®ç°çš„å¤æ‚æ€§ã€‚</li></ul><h3 id="3-è½»é‡çº§è¿›ç¨‹ï¼ˆLightWeight-Process-LWPï¼‰"><a href="#3-è½»é‡çº§è¿›ç¨‹ï¼ˆLightWeight-Process-LWPï¼‰" class="headerlink" title="3. è½»é‡çº§è¿›ç¨‹ï¼ˆLightWeight Process, LWPï¼‰"></a>3. è½»é‡çº§è¿›ç¨‹ï¼ˆLightWeight Process, LWPï¼‰</h3><h4 id="ç‰¹ç‚¹ï¼š-2"><a href="#ç‰¹ç‚¹ï¼š-2" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><ul><li><strong>æ··åˆå®ç°</strong>ï¼šè½»é‡çº§è¿›ç¨‹æ˜¯ä¸€ç§å†…æ ¸æ”¯æŒç”¨æˆ·çº¿ç¨‹çš„å®ç°æ–¹å¼ï¼Œå®ƒåœ¨å†…æ ¸ä¸­ä¸ºæ¯ä¸ªç”¨æˆ·çº¿ç¨‹åˆ›å»ºä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œä»è€Œæä¾›ç”¨æˆ·çº¿ç¨‹çš„çµæ´»æ€§å’Œå†…æ ¸çº¿ç¨‹çš„æ€§èƒ½ã€‚</li><li><strong>ä¸€å¯¹ä¸€æ¨¡å‹</strong>ï¼šæ¯ä¸ªç”¨æˆ·çº¿ç¨‹å¯¹åº”ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸è´Ÿè´£è°ƒåº¦å’Œç®¡ç†è¿™äº›å†…æ ¸çº¿ç¨‹ã€‚</li></ul><h4 id="ä¼˜ç‚¹ï¼š-2"><a href="#ä¼˜ç‚¹ï¼š-2" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h4><ul><li><strong>ç»¼åˆä¼˜åŠ¿</strong>ï¼šç»“åˆäº†ç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çº¿ç¨‹çš„ä¼˜ç‚¹ï¼Œæ—¢æœ‰ç”¨æˆ·çº¿ç¨‹çš„é«˜æ•ˆæ€§ï¼Œåˆæœ‰å†…æ ¸çº¿ç¨‹çš„é˜»å¡å¤„ç†å’Œå¤šæ ¸æ”¯æŒèƒ½åŠ›ã€‚</li><li><strong>å¹¶å‘æ€§</strong>ï¼šæ”¯æŒå¤šçº¿ç¨‹çš„å¹¶å‘æ‰§è¡Œï¼Œèƒ½å¤Ÿå……åˆ†åˆ©ç”¨å¤šå¤„ç†å™¨èµ„æºã€‚</li></ul><h4 id="ç¼ºç‚¹ï¼š-2"><a href="#ç¼ºç‚¹ï¼š-2" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h4><ul><li><strong>å¼€é”€è¾ƒé«˜</strong>ï¼šæ¯ä¸ªç”¨æˆ·çº¿ç¨‹éƒ½éœ€è¦ä¸€ä¸ªå¯¹åº”çš„å†…æ ¸çº¿ç¨‹ï¼Œå› æ­¤çº¿ç¨‹ç®¡ç†çš„å¼€é”€è¾ƒé«˜ã€‚</li><li><strong>å¤æ‚æ€§</strong>ï¼šå®ç°å’Œè°ƒåº¦éƒ½è¾ƒä¸ºå¤æ‚ï¼Œéœ€è¦æ“ä½œç³»ç»Ÿå’Œçº¿ç¨‹åº“çš„ååŒå·¥ä½œã€‚</li></ul><h3 id="çº¿ç¨‹å®ç°æ–¹å¼æ€»ç»“"><a href="#çº¿ç¨‹å®ç°æ–¹å¼æ€»ç»“" class="headerlink" title="çº¿ç¨‹å®ç°æ–¹å¼æ€»ç»“"></a>çº¿ç¨‹å®ç°æ–¹å¼æ€»ç»“</h3><table><thead><tr><th>ç‰¹ç‚¹</th><th>ç”¨æˆ·çº¿ç¨‹ï¼ˆUser Threadï¼‰</th><th>å†…æ ¸çº¿ç¨‹ï¼ˆKernel Threadï¼‰</th><th>è½»é‡çº§è¿›ç¨‹ï¼ˆLightWeight Process, LWPï¼‰</th></tr></thead><tbody><tr><td>å®ç°ä½ç½®</td><td>ç”¨æˆ·ç©ºé—´</td><td>å†…æ ¸ç©ºé—´</td><td>æ··åˆå®ç°ï¼ˆå†…æ ¸æ”¯æŒç”¨æˆ·çº¿ç¨‹ï¼‰</td></tr><tr><td>è°ƒåº¦æ–¹å¼</td><td>ç”¨æˆ·æ€åº“è°ƒåº¦</td><td>å†…æ ¸è°ƒåº¦</td><td>å†…æ ¸è°ƒåº¦</td></tr><tr><td>çº¿ç¨‹å¯è§æ€§</td><td>å†…æ ¸ä¸å¯è§</td><td>å†…æ ¸å¯è§</td><td>å†…æ ¸å¯è§</td></tr><tr><td>é˜»å¡å¤„ç†</td><td>æ•´ä¸ªè¿›ç¨‹é˜»å¡</td><td>ä¸å½±å“å…¶ä»–çº¿ç¨‹</td><td>ä¸å½±å“å…¶ä»–çº¿ç¨‹</td></tr><tr><td>å¤šæ ¸æ”¯æŒ</td><td>åˆ©ç”¨ä¸è¶³</td><td>å……åˆ†åˆ©ç”¨</td><td>å……åˆ†åˆ©ç”¨</td></tr><tr><td>æ“ä½œå¼€é”€</td><td>ä½</td><td>é«˜</td><td>è¾ƒé«˜</td></tr><tr><td>åº”ç”¨åœºæ™¯</td><td>é€‚ç”¨äºè½»é‡çº§å¹¶å‘</td><td>é€‚ç”¨äºé«˜å¹¶å‘å’Œé˜»å¡æ“ä½œ</td><td>ç»¼åˆé«˜æ•ˆå¹¶å‘å’Œå¤šæ ¸æ”¯æŒ</td></tr></tbody></table><p>ç†è§£è¿™ä¸‰ç§çº¿ç¨‹å®ç°æ–¹å¼çš„å·®å¼‚æœ‰åŠ©äºåœ¨å®é™…åº”ç”¨ä¸­é€‰æ‹©åˆé€‚çš„å¹¶å‘ç¼–ç¨‹æ¨¡å‹ï¼Œä»¥å……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºï¼Œæé«˜ç¨‹åºæ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚</p><h3 id="åç¨‹å’Œç”¨æˆ·çº¿ç¨‹å¯¹æ¯”"><a href="#åç¨‹å’Œç”¨æˆ·çº¿ç¨‹å¯¹æ¯”" class="headerlink" title="åç¨‹å’Œç”¨æˆ·çº¿ç¨‹å¯¹æ¯”"></a>åç¨‹å’Œç”¨æˆ·çº¿ç¨‹å¯¹æ¯”</h3><p>åç¨‹å’Œç”¨æˆ·çº¿ç¨‹ç¡®å®æœ‰è®¸å¤šç›¸ä¼¼ä¹‹å¤„ï¼Œä½†å®ƒä»¬å¹¶ä¸æ˜¯å®Œå…¨ç›¸åŒçš„æ¦‚å¿µã€‚ä»¥ä¸‹æ˜¯åç¨‹å’Œç”¨æˆ·çº¿ç¨‹çš„è¯¦ç»†å¯¹æ¯”ï¼Œå¸®åŠ©ç†è§£å®ƒä»¬çš„ç›¸ä¼¼æ€§å’Œå·®å¼‚ã€‚</p><h4 id="ç›¸ä¼¼ä¹‹å¤„"><a href="#ç›¸ä¼¼ä¹‹å¤„" class="headerlink" title="ç›¸ä¼¼ä¹‹å¤„"></a>ç›¸ä¼¼ä¹‹å¤„</h4><ol><li><strong>ç”¨æˆ·æ€ç®¡ç†</strong>ï¼šåç¨‹å’Œç”¨æˆ·çº¿ç¨‹éƒ½åœ¨ç”¨æˆ·æ€å®ç°å’Œç®¡ç†ï¼Œä¸ä¾èµ–äºæ“ä½œç³»ç»Ÿå†…æ ¸çš„è°ƒåº¦ã€‚</li><li><strong>è½»é‡çº§</strong>ï¼šä¸¤è€…éƒ½å…·æœ‰è½»é‡çº§çš„ç‰¹ç‚¹ï¼Œåˆ›å»ºå’Œåˆ‡æ¢çš„å¼€é”€è¾ƒå°ã€‚</li><li><strong>éæŠ¢å å¼</strong>ï¼šé€šå¸¸éƒ½é‡‡ç”¨éæŠ¢å å¼è°ƒåº¦æ–¹å¼ï¼Œéœ€è¦ä¸»åŠ¨è®©å‡ºæ‰§è¡Œæƒã€‚</li></ol><h4 id="å·®å¼‚"><a href="#å·®å¼‚" class="headerlink" title="å·®å¼‚"></a>å·®å¼‚</h4><ol><li><p><strong>è°ƒåº¦æ¨¡å‹</strong>ï¼š</p><ul><li><strong>ç”¨æˆ·çº¿ç¨‹</strong>ï¼šç”±ç”¨æˆ·æ€çš„çº¿ç¨‹åº“è¿›è¡Œç®¡ç†å’Œè°ƒåº¦ï¼Œçº¿ç¨‹è°ƒåº¦é€šå¸¸éœ€è¦æ˜¾å¼è°ƒç”¨åº“å‡½æ•°æ¥åˆ‡æ¢ä¸Šä¸‹æ–‡ã€‚ç”¨æˆ·çº¿ç¨‹æ›´åƒæ˜¯è½»é‡çº§çš„çº¿ç¨‹ï¼Œå¤šä¸ªç”¨æˆ·çº¿ç¨‹å¯èƒ½æ˜ å°„åˆ°ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œä¾èµ–æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹æ¨¡å‹ã€‚</li><li><strong>åç¨‹</strong>ï¼šåç¨‹æ˜¯æ›´åŠ çµæ´»çš„æ§åˆ¶æµç»“æ„ï¼Œå¯ä»¥åœ¨å‡½æ•°å†…éƒ¨æŒ‚èµ·å’Œæ¢å¤æ‰§è¡Œã€‚è°ƒåº¦æ›´ç»†ç²’åº¦ï¼Œå¯ä»¥åœ¨ä»»æ„ä½ç½®æš‚åœå’Œæ¢å¤ã€‚åç¨‹çš„åˆ‡æ¢é€šå¸¸æ˜¯é€šè¿‡è¯­è¨€å†…ç½®çš„å…³é”®å­—æˆ–åº“å‡½æ•°å®ç°çš„ï¼Œè°ƒåº¦å®Œå…¨åœ¨åº”ç”¨ç¨‹åºæ§åˆ¶ä¹‹ä¸‹ã€‚</li></ul></li><li><p><strong>æ‰§è¡Œæ¨¡å‹</strong>ï¼š</p><ul><li><strong>ç”¨æˆ·çº¿ç¨‹</strong>ï¼šé€šå¸¸æœ‰è‡ªå·±çš„æ ˆç©ºé—´å’Œä¸Šä¸‹æ–‡ï¼Œå¯ä»¥è¢«è°ƒåº¦æ‰§è¡Œç±»ä¼¼äºç‹¬ç«‹çš„æ‰§è¡Œå•å…ƒã€‚</li><li><strong>åç¨‹</strong>ï¼šæ›´åƒæ˜¯å…·æœ‰å¯ä¿å­˜çŠ¶æ€çš„å‡½æ•°ï¼Œæ‰§è¡Œåˆ°<code>yield</code>æˆ–<code>await</code>ç­‰å…³é”®å­—æ—¶æŒ‚èµ·ï¼Œå†æ¬¡è°ƒç”¨æ—¶ä»æŒ‚èµ·å¤„ç»§ç»­æ‰§è¡Œã€‚åç¨‹å…±äº«åŒä¸€ä¸ªçº¿ç¨‹çš„æ ˆç©ºé—´ï¼Œåˆ‡æ¢æ—¶åªä¿å­˜å’Œæ¢å¤å°‘é‡çš„çŠ¶æ€ä¿¡æ¯ã€‚</li></ul></li><li><p><strong>å¹¶å‘æ€§</strong>ï¼š</p><ul><li><strong>ç”¨æˆ·çº¿ç¨‹</strong>ï¼šå¤šä¸ªç”¨æˆ·çº¿ç¨‹å¯èƒ½ä¼šåœ¨ä¸åŒçš„å†…æ ¸çº¿ç¨‹ä¸Šå¹¶å‘æ‰§è¡Œï¼ˆå–å†³äºåº•å±‚å®ç°ï¼‰ï¼Œé€‚åˆå¤šæ ¸å¹¶è¡Œè®¡ç®—ã€‚</li><li><strong>åç¨‹</strong>ï¼šé€šå¸¸åœ¨å•ä¸ªçº¿ç¨‹å†…è°ƒåº¦ï¼Œä¸æ¶‰åŠçœŸæ­£çš„å¹¶è¡Œæ‰§è¡Œã€‚é€‚ç”¨äºå¤§é‡I&#x2F;Oæ“ä½œå’Œé«˜å¹¶å‘åœºæ™¯ï¼Œä½†ä¸é€‚åˆCPUå¯†é›†å‹ä»»åŠ¡ã€‚</li></ul></li><li><p><strong>å®ç°å¤æ‚æ€§</strong>ï¼š</p><ul><li><strong>ç”¨æˆ·çº¿ç¨‹</strong>ï¼šéœ€è¦æ˜¾å¼ç®¡ç†çº¿ç¨‹åˆ›å»ºã€åŒæ­¥å’Œè°ƒåº¦ï¼Œç¼–ç¨‹æ¨¡å‹ç±»ä¼¼äºå¤šçº¿ç¨‹ç¼–ç¨‹ã€‚</li><li><strong>åç¨‹</strong>ï¼šæä¾›äº†æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œç®€åŒ–äº†å¼‚æ­¥å’Œå¹¶å‘ç¼–ç¨‹ï¼Œç¼–å†™åç¨‹é€šå¸¸æ›´ç®€å•ç›´è§‚ã€‚</li></ul></li></ol><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>åç¨‹å’Œç”¨æˆ·çº¿ç¨‹è™½ç„¶éƒ½åœ¨ç”¨æˆ·æ€å®ç°ï¼Œä¸”å…·æœ‰è½»é‡çº§å’Œé«˜æ•ˆçš„ç‰¹ç‚¹ï¼Œä½†å®ƒä»¬åœ¨è°ƒåº¦æ¨¡å‹ã€æ‰§è¡Œæ–¹å¼å’Œé€‚ç”¨åœºæ™¯ä¸Šæœ‰æ˜¾è‘—åŒºåˆ«ï¼š</p><ul><li><strong>åç¨‹</strong>ï¼šæ›´é€‚åˆå¤„ç†å¼‚æ­¥I&#x2F;Oæ“ä½œå’Œé«˜å¹¶å‘ä»»åŠ¡ï¼Œæä¾›ç»†ç²’åº¦çš„æ§åˆ¶æµç®¡ç†ï¼Œç¼–ç¨‹æ¨¡å‹ç®€æ´ã€‚</li><li><strong>ç”¨æˆ·çº¿ç¨‹</strong>ï¼šé€‚ç”¨äºå¤šçº¿ç¨‹ç¼–ç¨‹æ¨¡å‹ï¼Œéœ€è¦æ˜¾å¼ç®¡ç†çº¿ç¨‹åŒæ­¥å’Œè°ƒåº¦ï¼Œèƒ½æ›´å¥½åœ°åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨èµ„æºã€‚</li></ul><p>ç†è§£è¿™äº›åŒºåˆ«æœ‰åŠ©äºé€‰æ‹©åˆé€‚çš„å¹¶å‘ç¼–ç¨‹æ¨¡å‹ï¼Œæ ¹æ®å…·ä½“åº”ç”¨åœºæ™¯å’Œéœ€æ±‚å†³å®šä½¿ç”¨åç¨‹è¿˜æ˜¯ç”¨æˆ·çº¿ç¨‹ã€‚</p><h2 id="åƒµå°¸çº¿ç¨‹å’Œå­¤å„¿çº¿ç¨‹"><a href="#åƒµå°¸çº¿ç¨‹å’Œå­¤å„¿çº¿ç¨‹" class="headerlink" title="åƒµå°¸çº¿ç¨‹å’Œå­¤å„¿çº¿ç¨‹"></a>åƒµå°¸çº¿ç¨‹å’Œå­¤å„¿çº¿ç¨‹</h2><p>åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œåƒµå°¸è¿›ç¨‹å’Œå­¤å„¿è¿›ç¨‹æ˜¯ä¸è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’Œè¿›ç¨‹å…³ç³»ç®¡ç†ç›¸å…³çš„ä¸¤ç§ç‰¹æ®ŠçŠ¶æ€ã€‚ç†è§£å®ƒä»¬æœ‰åŠ©äºå¤„ç†è¿›ç¨‹é—´çš„å…³ç³»å’Œèµ„æºç®¡ç†é—®é¢˜ã€‚</p><h3 id="åƒµå°¸è¿›ç¨‹-Zombie-Process"><a href="#åƒµå°¸è¿›ç¨‹-Zombie-Process" class="headerlink" title="åƒµå°¸è¿›ç¨‹ (Zombie Process)"></a>åƒµå°¸è¿›ç¨‹ (Zombie Process)</h3><h4 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><p>åƒµå°¸è¿›ç¨‹æ˜¯<mark>å·²ç»ç»ˆæ­¢ä½†å…¶ç»ˆæ­¢çŠ¶æ€è¿˜æ²¡æœ‰è¢«çˆ¶è¿›ç¨‹è·å–çš„è¿›ç¨‹</mark>ã€‚å½“ä¸€ä¸ªè¿›ç¨‹å®Œæˆå…¶æ‰§è¡Œå¹¶è°ƒç”¨<code>exit</code>ç³»ç»Ÿè°ƒç”¨åï¼Œå®ƒä¼šè¿›å…¥ç»ˆæ­¢çŠ¶æ€ã€‚æ“ä½œç³»ç»Ÿä¼šä¿ç•™è¯¥è¿›ç¨‹çš„éƒ¨åˆ†ä¿¡æ¯ï¼ˆå¦‚è¿›ç¨‹IDå’Œé€€å‡ºçŠ¶æ€ï¼‰ä»¥ä¾¿çˆ¶è¿›ç¨‹é€šè¿‡<code>wait</code>ç³»ç»Ÿè°ƒç”¨è·å–ã€‚å¦‚æœçˆ¶è¿›ç¨‹æ²¡æœ‰åŠæ—¶è°ƒç”¨<code>wait</code>ï¼Œè¯¥è¿›ç¨‹çš„éƒ¨åˆ†ä¿¡æ¯å°†ä¿ç•™åœ¨ç³»ç»Ÿä¸­ï¼Œæ­¤æ—¶è¯¥è¿›ç¨‹è¢«ç§°ä¸ºåƒµå°¸è¿›ç¨‹ã€‚</p><h4 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ul><li><strong>çŠ¶æ€</strong>ï¼šåƒµå°¸è¿›ç¨‹å¤„äºç»ˆæ­¢çŠ¶æ€ï¼Œä¸ä¼šå ç”¨CPUå’Œå†…å­˜èµ„æºï¼Œä½†ä¼šå ç”¨è¿›ç¨‹è¡¨é¡¹ï¼ˆPIDï¼‰ã€‚</li><li><strong>è¯†åˆ«</strong>ï¼šé€šè¿‡å‘½ä»¤<code>ps</code>å¯ä»¥çœ‹åˆ°è¿›ç¨‹çŠ¶æ€ä¸º<code>Z</code>ï¼ˆè¡¨ç¤ºZombieï¼‰ã€‚</li><li><strong>æ¸…ç†</strong>ï¼š<mark>çˆ¶è¿›ç¨‹è°ƒç”¨<code>wait</code>æˆ–<code>waitpid</code>è·å–å­è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€åï¼Œç³»ç»Ÿä¼šæ¸…ç†åƒµå°¸è¿›ç¨‹çš„èµ„æºã€‚å¦‚æœçˆ¶è¿›ç¨‹å·²ç»ç»ˆæ­¢ï¼Œinitè¿›ç¨‹ï¼ˆPID 1ï¼‰ä¼šæ¥ç®¡å¹¶æ¸…ç†å®ƒä»¬ã€‚</mark></li></ul><h3 id="å­¤å„¿è¿›ç¨‹-Orphan-Process"><a href="#å­¤å„¿è¿›ç¨‹-Orphan-Process" class="headerlink" title="å­¤å„¿è¿›ç¨‹ (Orphan Process)"></a>å­¤å„¿è¿›ç¨‹ (Orphan Process)</h3><h4 id="å®šä¹‰-1"><a href="#å®šä¹‰-1" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><p>å­¤å„¿è¿›ç¨‹æ˜¯<mark>å…¶çˆ¶è¿›ç¨‹å·²ç»ç»ˆæ­¢ï¼Œä½†å®ƒè‡ªå·±ä»ç„¶åœ¨è¿è¡Œçš„è¿›ç¨‹</mark>ã€‚å½“ä¸€ä¸ªçˆ¶è¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œå…¶ä»åœ¨è¿è¡Œçš„å­è¿›ç¨‹ä¼šæˆä¸ºå­¤å„¿è¿›ç¨‹ã€‚è¿™äº›å­¤å„¿è¿›ç¨‹<mark>ä¼šè¢«ç³»ç»Ÿçš„initè¿›ç¨‹ï¼ˆPID 1ï¼‰æ¥ç®¡ï¼Œæˆä¸ºinitè¿›ç¨‹çš„å­è¿›ç¨‹</mark>ã€‚</p><h4 id="ç‰¹ç‚¹-1"><a href="#ç‰¹ç‚¹-1" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ul><li><strong>çŠ¶æ€</strong>ï¼šå­¤å„¿è¿›ç¨‹ç»§ç»­è¿è¡Œï¼Œä¸ä¼šå—çˆ¶è¿›ç¨‹ç»ˆæ­¢çš„å½±å“ã€‚</li><li><strong>ç®¡ç†</strong>ï¼šå­¤å„¿è¿›ç¨‹è¢«initè¿›ç¨‹æ¥ç®¡ï¼Œinitè¿›ç¨‹ä¼šè´Ÿè´£å¯¹å®ƒä»¬è¿›è¡Œé€‚å½“çš„ç®¡ç†å’Œæ¸…ç†ã€‚</li></ul><p>åœ¨è¿™æ®µæ—¶é—´å†…ï¼Œå¯ä»¥ä½¿ç”¨<code>ps</code>å‘½ä»¤è§‚å¯Ÿå­è¿›ç¨‹çš„çˆ¶è¿›ç¨‹IDå˜ä¸º1ï¼Œè¡¨ç¤ºå®ƒè¢«initè¿›ç¨‹æ¥ç®¡ã€‚</p><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li><strong>åƒµå°¸è¿›ç¨‹</strong>ï¼šå·²ç»ˆæ­¢ä½†çˆ¶è¿›ç¨‹æœªè·å–å…¶çŠ¶æ€çš„è¿›ç¨‹ï¼Œä¸é‡Šæ”¾è¿›ç¨‹è¡¨é¡¹ã€‚æ¸…ç†æ–¹æ³•æ˜¯çˆ¶è¿›ç¨‹è°ƒç”¨<code>wait</code>æˆ–<code>waitpid</code>ã€‚</li><li><strong>å­¤å„¿è¿›ç¨‹</strong>ï¼šçˆ¶è¿›ç¨‹å·²ç»ˆæ­¢ä½†è¿›ç¨‹è‡ªèº«ä»åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œè¢«initè¿›ç¨‹æ¥ç®¡å¹¶ç®¡ç†ã€‚å­¤å„¿è¿›ç¨‹æ­£å¸¸è¿è¡Œï¼Œä¸éœ€è¦ç‰¹æ®Šæ¸…ç†ã€‚</li></ul><p>ç†è§£å’Œå¤„ç†åƒµå°¸è¿›ç¨‹å’Œå­¤å„¿è¿›ç¨‹å¯¹äºç³»ç»Ÿèµ„æºç®¡ç†å’Œè¿›ç¨‹å…³ç³»ç®¡ç†è‡³å…³é‡è¦ã€‚</p><h2 id="çº¿ç¨‹å´©æºƒäº†ï¼Œè¿›ç¨‹ä¹Ÿä¼šå´©æºƒå—ï¼Ÿ"><a href="#çº¿ç¨‹å´©æºƒäº†ï¼Œè¿›ç¨‹ä¹Ÿä¼šå´©æºƒå—ï¼Ÿ" class="headerlink" title="çº¿ç¨‹å´©æºƒäº†ï¼Œè¿›ç¨‹ä¹Ÿä¼šå´©æºƒå—ï¼Ÿ"></a>çº¿ç¨‹å´©æºƒäº†ï¼Œè¿›ç¨‹ä¹Ÿä¼šå´©æºƒå—ï¼Ÿ</h2><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿä¸ºäº†ä¿è¯ç³»ç»Ÿå®‰å…¨ï¼Œæ‰€ä»¥é’ˆå¯¹éæ³•å†…å­˜è®¿é—®ä¼šå‘é€ä¸€ä¸ª SIGSEGV ä¿¡å·ï¼Œè€Œæ“ä½œç³»ç»Ÿä¸€èˆ¬ä¼šè°ƒç”¨é»˜è®¤çš„ä¿¡å·å¤„ç†å‡½æ•°ï¼ˆä¸€èˆ¬ä¼šè®©ç›¸å…³çš„è¿›ç¨‹å´©æºƒï¼‰ã€‚</p><p>ä½†å¦‚æœè¿›ç¨‹è§‰å¾—â€ç½ªä¸è‡´æ­»â€ï¼Œé‚£ä¹ˆå®ƒä¹Ÿå¯ä»¥é€‰æ‹©è‡ªå®šä¹‰ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œè¿™æ ·çš„è¯å®ƒå°±å¯ä»¥åšä¸€äº›è‡ªå®šä¹‰çš„é€»è¾‘ï¼Œæ¯”å¦‚è®°å½• crash ä¿¡æ¯ç­‰æœ‰æ„ä¹‰çš„äº‹ã€‚</p><p>å›è¿‡å¤´æ¥çœ‹ä¸ºä»€ä¹ˆè™šæ‹Ÿæœºä¼šé’ˆå¯¹ StackoverflowError å’Œ NullPointerException åšé¢å¤–å¤„ç†è®©çº¿ç¨‹æ¢å¤å‘¢ï¼Œé’ˆå¯¹ stackoverflow å…¶å®å®ƒé‡‡ç”¨äº†ä¸€ç§æ ˆå›æº¯çš„æ–¹æ³•ä¿è¯çº¿ç¨‹å¯ä»¥ä¸€ç›´æ‰§è¡Œä¸‹å»ï¼Œè€Œæ•è·ç©ºæŒ‡é’ˆé”™è¯¯ä¸»è¦æ˜¯è¿™ä¸ªé”™è¯¯å®åœ¨å¤ªæ™®éäº†ã€‚</p><p>ä¸ºäº†è¿™ä¸€ä¸ªå¾ˆå¸¸è§çš„é”™è¯¯è€Œè®© JVM å´©æºƒé‚£çº¿ä¸Šçš„ JVM è¦å®•æœºå¤šå°‘æ¬¡ï¼Œæ‰€ä»¥å‡ºäºå·¥ç¨‹å¥å£®æ€§çš„è€ƒè™‘ï¼Œä¸å…¶ç›´æ¥è®© JVM å´©æºƒå€’ä¸å¦‚è®©çº¿ç¨‹èµ·æ­»å›ç”Ÿï¼Œå¹¶ä¸”å°†è¿™ä¸¤ä¸ªé”™è¯¯&#x2F;å¼‚å¸¸æŠ›ç»™ç”¨æˆ·æ¥å¤„ç†ã€‚</p><h2 id="æ­»é”é—®é¢˜"><a href="#æ­»é”é—®é¢˜" class="headerlink" title="æ­»é”é—®é¢˜"></a>æ­»é”é—®é¢˜</h2><p>ç®€å•æ¥è¯´ï¼Œæ­»é”é—®é¢˜çš„äº§ç”Ÿæ˜¯ç”±ä¸¤ä¸ªæˆ–è€…ä»¥ä¸Šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œçš„æ—¶å€™ï¼Œäº‰å¤ºèµ„æºè€Œäº’ç›¸ç­‰å¾…é€ æˆçš„ã€‚</p><p>æ­»é”åªæœ‰åŒæ—¶æ»¡è¶³**<mark>äº’æ–¥ã€æŒæœ‰å¹¶ç­‰å¾…ã€ä¸å¯å‰¥å¤ºã€ç¯è·¯ç­‰å¾…</mark>**è¿™å››ä¸ªæ¡ä»¶çš„æ—¶å€™æ‰ä¼šå‘ç”Ÿã€‚</p><p>æ‰€ä»¥è¦é¿å…æ­»é”é—®é¢˜ï¼Œå°±æ˜¯è¦ç ´åå…¶ä¸­ä¸€ä¸ªæ¡ä»¶å³å¯ï¼Œæœ€å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨**<mark>èµ„æºæœ‰åºåˆ†é…æ³•</mark>**æ¥ç ´åç¯è·¯ç­‰å¾…æ¡ä»¶ã€‚</p><h1 id="è°ƒåº¦ç®—æ³•"><a href="#è°ƒåº¦ç®—æ³•" class="headerlink" title="è°ƒåº¦ç®—æ³•"></a>è°ƒåº¦ç®—æ³•</h1><h2 id="è¿›ç¨‹è°ƒåº¦"><a href="#è¿›ç¨‹è°ƒåº¦" class="headerlink" title="è¿›ç¨‹è°ƒåº¦"></a>è¿›ç¨‹è°ƒåº¦</h2><h3 id="å…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦ç®—æ³•"><a href="#å…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦ç®—æ³•" class="headerlink" title="å…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦ç®—æ³•"></a>å…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦ç®—æ³•</h3><p>æœ€ç®€å•çš„ä¸€ä¸ªè°ƒåº¦ç®—æ³•ï¼Œå°±æ˜¯éæŠ¢å å¼çš„<strong>å…ˆæ¥å…ˆæœåŠ¡ï¼ˆ*First Come First Severd, FCFS*ï¼‰ç®—æ³•</strong>äº†ã€‚</p><p><img src="/../assets/Study-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/24-%E5%85%88%E6%9D%A5%E5%85%88%E6%9C%8D%E5%8A%A1.jpg" alt="FCFS è°ƒåº¦ç®—æ³•"></p><p>é¡¾åæ€ä¹‰ï¼Œå…ˆæ¥ååˆ°ï¼Œ<strong>æ¯æ¬¡ä»å°±ç»ªé˜Ÿåˆ—é€‰æ‹©æœ€å…ˆè¿›å…¥é˜Ÿåˆ—çš„è¿›ç¨‹ï¼Œç„¶åä¸€ç›´è¿è¡Œï¼Œç›´åˆ°è¿›ç¨‹é€€å‡ºæˆ–è¢«é˜»å¡ï¼Œæ‰ä¼šç»§ç»­ä»é˜Ÿåˆ—ä¸­é€‰æ‹©ç¬¬ä¸€ä¸ªè¿›ç¨‹æ¥ç€è¿è¡Œã€‚</strong></p><p>è¿™ä¼¼ä¹å¾ˆå…¬å¹³ï¼Œä½†æ˜¯å½“ä¸€ä¸ªé•¿ä½œä¸šå…ˆè¿è¡Œäº†ï¼Œé‚£ä¹ˆåé¢çš„çŸ­ä½œä¸šç­‰å¾…çš„æ—¶é—´å°±ä¼šå¾ˆé•¿ï¼Œä¸åˆ©äºçŸ­ä½œä¸šã€‚</p><p>FCFS å¯¹é•¿ä½œä¸šæœ‰åˆ©ï¼Œé€‚ç”¨äº CPU ç¹å¿™å‹ä½œä¸šçš„ç³»ç»Ÿï¼Œè€Œä¸é€‚ç”¨äº I&#x2F;O ç¹å¿™å‹ä½œä¸šçš„ç³»ç»Ÿã€‚</p><h3 id="æœ€çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•"><a href="#æœ€çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•" class="headerlink" title="æœ€çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•"></a>æœ€çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•</h3><p><strong>æœ€çŸ­ä½œä¸šä¼˜å…ˆï¼ˆ*Shortest Job First, SJF*ï¼‰è°ƒåº¦ç®—æ³•</strong>åŒæ ·ä¹Ÿæ˜¯é¡¾åæ€ä¹‰ï¼Œå®ƒä¼š<strong>ä¼˜å…ˆé€‰æ‹©è¿è¡Œæ—¶é—´æœ€çŸ­çš„è¿›ç¨‹æ¥è¿è¡Œ</strong>ï¼Œè¿™æœ‰åŠ©äºæé«˜ç³»ç»Ÿçš„ååé‡ã€‚</p><p><img src="/../assets/Study-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/25-%E6%9C%80%E7%9F%AD%E4%BD%9C%E4%B8%9A%E4%BC%98%E5%85%88%E7%AE%97%E6%B3%95.jpg" alt="SJF è°ƒåº¦ç®—æ³•"></p><p>è¿™æ˜¾ç„¶å¯¹é•¿ä½œä¸šä¸åˆ©ï¼Œå¾ˆå®¹æ˜“é€ æˆä¸€ç§æç«¯ç°è±¡ã€‚</p><p>æ¯”å¦‚ï¼Œä¸€ä¸ªé•¿ä½œä¸šåœ¨å°±ç»ªé˜Ÿåˆ—ç­‰å¾…è¿è¡Œï¼Œè€Œè¿™ä¸ªå°±ç»ªé˜Ÿåˆ—æœ‰éå¸¸å¤šçš„çŸ­ä½œä¸šï¼Œé‚£ä¹ˆå°±ä¼šä½¿å¾—é•¿ä½œä¸šä¸æ–­çš„å¾€åæ¨ï¼Œå‘¨è½¬æ—¶é—´å˜é•¿ï¼Œè‡´ä½¿é•¿ä½œä¸šé•¿æœŸä¸ä¼šè¢«è¿è¡Œã€‚</p><h3 id="é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•"><a href="#é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•" class="headerlink" title="é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•"></a>é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•</h3><p>å‰é¢çš„ã€Œå…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦ç®—æ³•ã€å’Œã€Œæœ€çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•ã€éƒ½æ²¡æœ‰å¾ˆå¥½çš„æƒè¡¡çŸ­ä½œä¸šå’Œé•¿ä½œä¸šã€‚</p><p>é‚£ä¹ˆï¼Œ<strong>é«˜å“åº”æ¯”ä¼˜å…ˆ ï¼ˆ*Highest Response Ratio Next, HRRN*ï¼‰è°ƒåº¦ç®—æ³•</strong>ä¸»è¦æ˜¯æƒè¡¡äº†çŸ­ä½œä¸šå’Œé•¿ä½œä¸šã€‚</p><p><strong>æ¯æ¬¡è¿›è¡Œè¿›ç¨‹è°ƒåº¦æ—¶ï¼Œå…ˆè®¡ç®—ã€Œå“åº”æ¯”ä¼˜å…ˆçº§ã€ï¼Œç„¶åæŠŠã€Œå“åº”æ¯”ä¼˜å…ˆçº§ã€æœ€é«˜çš„è¿›ç¨‹æŠ•å…¥è¿è¡Œ</strong>ï¼Œã€Œå“åº”æ¯”ä¼˜å…ˆçº§ã€çš„è®¡ç®—å…¬å¼ï¼š</p><p><img src="/../assets/Study-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/26-%E5%93%8D%E5%BA%94%E6%AF%94%E5%85%AC%E5%BC%8F.jpg" alt="img"></p><p>ä»ä¸Šé¢çš„å…¬å¼ï¼Œå¯ä»¥å‘ç°ï¼š</p><ul><li>å¦‚æœä¸¤ä¸ªè¿›ç¨‹çš„ã€Œç­‰å¾…æ—¶é—´ã€ç›¸åŒæ—¶ï¼Œã€Œè¦æ±‚çš„æœåŠ¡æ—¶é—´ã€è¶ŠçŸ­ï¼Œã€Œå“åº”æ¯”ã€å°±è¶Šé«˜ï¼Œè¿™æ ·çŸ­ä½œä¸šçš„è¿›ç¨‹å®¹æ˜“è¢«é€‰ä¸­è¿è¡Œï¼›</li><li>å¦‚æœä¸¤ä¸ªè¿›ç¨‹ã€Œè¦æ±‚çš„æœåŠ¡æ—¶é—´ã€ç›¸åŒæ—¶ï¼Œã€Œç­‰å¾…æ—¶é—´ã€è¶Šé•¿ï¼Œã€Œå“åº”æ¯”ã€å°±è¶Šé«˜ï¼Œè¿™å°±å…¼é¡¾åˆ°äº†é•¿ä½œä¸šè¿›ç¨‹ï¼Œå› ä¸ºè¿›ç¨‹çš„å“åº”æ¯”å¯ä»¥éšæ—¶é—´ç­‰å¾…çš„å¢åŠ è€Œæé«˜ï¼Œå½“å…¶ç­‰å¾…æ—¶é—´è¶³å¤Ÿé•¿æ—¶ï¼Œå…¶å“åº”æ¯”ä¾¿å¯ä»¥å‡åˆ°å¾ˆé«˜ï¼Œä»è€Œè·å¾—è¿è¡Œçš„æœºä¼šï¼›</li></ul><h3 id="æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•"><a href="#æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•" class="headerlink" title="æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•"></a>æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•</h3><p>æœ€å¤è€ã€æœ€ç®€å•ã€æœ€å…¬å¹³ä¸”ä½¿ç”¨æœ€å¹¿çš„ç®—æ³•å°±æ˜¯<strong>æ—¶é—´ç‰‡è½®è½¬ï¼ˆ*Round Robin, RR*ï¼‰è°ƒåº¦ç®—æ³•</strong>ã€‚</p><p><img src="/../assets/Study-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/27-%E6%97%B6%E9%97%B4%E7%89%87%E8%BD%AE%E8%AF%A2.jpg" alt="RR è°ƒåº¦ç®—æ³•"></p><p><strong>æ¯ä¸ªè¿›ç¨‹è¢«åˆ†é…ä¸€ä¸ªæ—¶é—´æ®µï¼Œç§°ä¸ºæ—¶é—´ç‰‡ï¼ˆ*Quantum*ï¼‰ï¼Œå³å…è®¸è¯¥è¿›ç¨‹åœ¨è¯¥æ—¶é—´æ®µä¸­è¿è¡Œã€‚</strong></p><ul><li>å¦‚æœæ—¶é—´ç‰‡ç”¨å®Œï¼Œè¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆå°†ä¼šæŠŠæ­¤è¿›ç¨‹ä» CPU é‡Šæ”¾å‡ºæ¥ï¼Œå¹¶æŠŠ CPU åˆ†é…å¦å¤–ä¸€ä¸ªè¿›ç¨‹ï¼›</li><li>å¦‚æœè¯¥è¿›ç¨‹åœ¨æ—¶é—´ç‰‡ç»“æŸå‰é˜»å¡æˆ–ç»“æŸï¼Œåˆ™ CPU ç«‹å³è¿›è¡Œåˆ‡æ¢ï¼›</li></ul><p>å¦å¤–ï¼Œæ—¶é—´ç‰‡çš„é•¿åº¦å°±æ˜¯ä¸€ä¸ªå¾ˆå…³é”®çš„ç‚¹ï¼š</p><ul><li>å¦‚æœæ—¶é—´ç‰‡è®¾å¾—å¤ªçŸ­ä¼šå¯¼è‡´è¿‡å¤šçš„è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œé™ä½äº† CPU æ•ˆç‡ï¼›</li><li>å¦‚æœè®¾å¾—å¤ªé•¿åˆå¯èƒ½å¼•èµ·å¯¹çŸ­ä½œä¸šè¿›ç¨‹çš„å“åº”æ—¶é—´å˜é•¿ã€‚å°†</li></ul><p>é€šå¸¸æ—¶é—´ç‰‡è®¾ä¸º <code>20ms~50ms</code> é€šå¸¸æ˜¯ä¸€ä¸ªæ¯”è¾ƒåˆç†çš„æŠ˜ä¸­å€¼ã€‚</p><h3 id="æœ€é«˜ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•"><a href="#æœ€é«˜ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•" class="headerlink" title="æœ€é«˜ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•"></a>æœ€é«˜ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•</h3><p>å‰é¢çš„ã€Œæ—¶é—´ç‰‡è½®è½¬ç®—æ³•ã€åšäº†ä¸ªå‡è®¾ï¼Œå³è®©æ‰€æœ‰çš„è¿›ç¨‹åŒç­‰é‡è¦ï¼Œä¹Ÿä¸åè¢’è°ï¼Œå¤§å®¶çš„è¿è¡Œæ—¶é—´éƒ½ä¸€æ ·ã€‚</p><p>ä½†æ˜¯ï¼Œå¯¹äºå¤šç”¨æˆ·è®¡ç®—æœºç³»ç»Ÿå°±æœ‰ä¸åŒçš„çœ‹æ³•äº†ï¼Œå®ƒä»¬å¸Œæœ›è°ƒåº¦æ˜¯æœ‰ä¼˜å…ˆçº§çš„ï¼Œå³å¸Œæœ›è°ƒåº¦ç¨‹åºèƒ½<strong>ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰æ‹©æœ€é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹è¿›è¡Œè¿è¡Œï¼Œè¿™ç§°ä¸ºæœ€é«˜ä¼˜å…ˆçº§ï¼ˆ*Highest Priority Firstï¼ŒHPF*ï¼‰è°ƒåº¦ç®—æ³•</strong>ã€‚</p><p>è¿›ç¨‹çš„ä¼˜å…ˆçº§å¯ä»¥åˆ†ä¸ºï¼Œé™æ€ä¼˜å…ˆçº§æˆ–åŠ¨æ€ä¼˜å…ˆçº§ï¼š</p><ul><li>é™æ€ä¼˜å…ˆçº§ï¼šåˆ›å»ºè¿›ç¨‹æ—¶å€™ï¼Œå°±å·²ç»ç¡®å®šäº†ä¼˜å…ˆçº§äº†ï¼Œç„¶åæ•´ä¸ªè¿è¡Œæ—¶é—´ä¼˜å…ˆçº§éƒ½ä¸ä¼šå˜åŒ–ï¼›</li><li>åŠ¨æ€ä¼˜å…ˆçº§ï¼šæ ¹æ®è¿›ç¨‹çš„åŠ¨æ€å˜åŒ–è°ƒæ•´ä¼˜å…ˆçº§ï¼Œæ¯”å¦‚å¦‚æœè¿›ç¨‹è¿è¡Œæ—¶é—´å¢åŠ ï¼Œåˆ™é™ä½å…¶ä¼˜å…ˆçº§ï¼Œå¦‚æœè¿›ç¨‹ç­‰å¾…æ—¶é—´ï¼ˆå°±ç»ªé˜Ÿåˆ—çš„ç­‰å¾…æ—¶é—´ï¼‰å¢åŠ ï¼Œåˆ™å‡é«˜å…¶ä¼˜å…ˆçº§ï¼Œä¹Ÿå°±æ˜¯<strong>éšç€æ—¶é—´çš„æ¨ç§»å¢åŠ ç­‰å¾…è¿›ç¨‹çš„ä¼˜å…ˆçº§</strong>ã€‚</li></ul><p>è¯¥ç®—æ³•ä¹Ÿæœ‰ä¸¤ç§å¤„ç†ä¼˜å…ˆçº§é«˜çš„æ–¹æ³•ï¼ŒéæŠ¢å å¼å’ŒæŠ¢å å¼ï¼š</p><ul><li>éæŠ¢å å¼ï¼šå½“å°±ç»ªé˜Ÿåˆ—ä¸­å‡ºç°ä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹ï¼Œè¿è¡Œå®Œå½“å‰è¿›ç¨‹ï¼Œå†é€‰æ‹©ä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹ã€‚</li><li>æŠ¢å å¼ï¼šå½“å°±ç»ªé˜Ÿåˆ—ä¸­å‡ºç°ä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹ï¼Œå½“å‰è¿›ç¨‹æŒ‚èµ·ï¼Œè°ƒåº¦ä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹è¿è¡Œã€‚</li></ul><p>ä½†æ˜¯ä¾ç„¶æœ‰ç¼ºç‚¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä½ä¼˜å…ˆçº§çš„è¿›ç¨‹æ°¸è¿œä¸ä¼šè¿è¡Œã€‚</p><h3 id="å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•"><a href="#å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•" class="headerlink" title="å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•"></a>å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•</h3><p><strong>å¤šçº§åé¦ˆé˜Ÿåˆ—ï¼ˆ*Multilevel Feedback Queue*ï¼‰è°ƒåº¦ç®—æ³•</strong>æ˜¯ã€Œæ—¶é—´ç‰‡è½®è½¬ç®—æ³•ã€å’Œã€Œæœ€é«˜ä¼˜å…ˆçº§ç®—æ³•ã€çš„ç»¼åˆå’Œå‘å±•ã€‚</p><p>é¡¾åæ€ä¹‰ï¼š</p><ul><li>ã€Œå¤šçº§ã€è¡¨ç¤ºæœ‰å¤šä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼ŒåŒæ—¶ä¼˜å…ˆçº§è¶Šé«˜æ—¶é—´ç‰‡è¶ŠçŸ­ã€‚</li><li>ã€Œåé¦ˆã€è¡¨ç¤ºå¦‚æœæœ‰æ–°çš„è¿›ç¨‹åŠ å…¥ä¼˜å…ˆçº§é«˜çš„é˜Ÿåˆ—æ—¶ï¼Œç«‹åˆ»åœæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œè½¬è€Œå»è¿è¡Œä¼˜å…ˆçº§é«˜çš„é˜Ÿåˆ—ï¼›</li></ul><p><img src="/../assets/Study-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/28-%E5%A4%9A%E7%BA%A7%E9%98%9F%E5%88%97.jpg" alt="å¤šçº§åé¦ˆé˜Ÿåˆ—"></p><p>æ¥çœ‹çœ‹ï¼Œå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p><ul><li>è®¾ç½®äº†å¤šä¸ªé˜Ÿåˆ—ï¼Œèµ‹äºˆæ¯ä¸ªé˜Ÿåˆ—ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œæ¯ä¸ª<strong>é˜Ÿåˆ—ä¼˜å…ˆçº§ä»é«˜åˆ°ä½</strong>ï¼ŒåŒæ—¶<strong>ä¼˜å…ˆçº§è¶Šé«˜æ—¶é—´ç‰‡è¶ŠçŸ­</strong>ï¼›</li><li>æ–°çš„è¿›ç¨‹ä¼šè¢«æ”¾å…¥åˆ°ç¬¬ä¸€çº§é˜Ÿåˆ—çš„æœ«å°¾ï¼ŒæŒ‰å…ˆæ¥å…ˆæœåŠ¡çš„åŸåˆ™æ’é˜Ÿç­‰å¾…è¢«è°ƒåº¦ï¼Œå¦‚æœåœ¨ç¬¬ä¸€çº§é˜Ÿåˆ—è§„å®šçš„æ—¶é—´ç‰‡æ²¡è¿è¡Œå®Œæˆï¼Œåˆ™å°†å…¶è½¬å…¥åˆ°ç¬¬äºŒçº§é˜Ÿåˆ—çš„æœ«å°¾ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´è‡³å®Œæˆï¼›</li><li>å½“è¾ƒé«˜ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ä¸ºç©ºï¼Œæ‰è°ƒåº¦è¾ƒä½ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹è¿è¡Œã€‚å¦‚æœè¿›ç¨‹è¿è¡Œæ—¶ï¼Œæœ‰æ–°è¿›ç¨‹è¿›å…¥è¾ƒé«˜ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ï¼Œåˆ™åœæ­¢å½“å‰è¿è¡Œçš„è¿›ç¨‹å¹¶å°†å…¶ç§»å…¥åˆ°åŸé˜Ÿåˆ—æœ«å°¾ï¼Œæ¥ç€è®©è¾ƒé«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹è¿è¡Œï¼›</li></ul><p>å¯ä»¥å‘ç°ï¼Œå¯¹äºçŸ­ä½œä¸šå¯èƒ½å¯ä»¥åœ¨ç¬¬ä¸€çº§é˜Ÿåˆ—å¾ˆå¿«è¢«å¤„ç†å®Œã€‚å¯¹äºé•¿ä½œä¸šï¼Œå¦‚æœåœ¨ç¬¬ä¸€çº§é˜Ÿåˆ—å¤„ç†ä¸å®Œï¼Œå¯ä»¥ç§»å…¥ä¸‹æ¬¡é˜Ÿåˆ—ç­‰å¾…è¢«æ‰§è¡Œï¼Œè™½ç„¶ç­‰å¾…çš„æ—¶é—´å˜é•¿äº†ï¼Œä½†æ˜¯è¿è¡Œæ—¶é—´ä¹Ÿä¼šæ›´é•¿äº†ï¼Œæ‰€ä»¥è¯¥ç®—æ³•å¾ˆå¥½çš„<strong>å…¼é¡¾äº†é•¿çŸ­ä½œä¸šï¼ŒåŒæ—¶æœ‰è¾ƒå¥½çš„å“åº”æ—¶é—´ã€‚</strong></p><h2 id="é¡µé¢ç½®æ¢"><a href="#é¡µé¢ç½®æ¢" class="headerlink" title="é¡µé¢ç½®æ¢"></a>é¡µé¢ç½®æ¢</h2><h2 id="ç£ç›˜è°ƒåº¦ç®—æ³•"><a href="#ç£ç›˜è°ƒåº¦ç®—æ³•" class="headerlink" title="ç£ç›˜è°ƒåº¦ç®—æ³•"></a>ç£ç›˜è°ƒåº¦ç®—æ³•</h2><h1 id="æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h1><h1 id="I-Oè®¾å¤‡ç®¡ç†"><a href="#I-Oè®¾å¤‡ç®¡ç†" class="headerlink" title="I&#x2F;Oè®¾å¤‡ç®¡ç†"></a>I&#x2F;Oè®¾å¤‡ç®¡ç†</h1>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 408 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç®—æœºç½‘ç»œ</title>
      <link href="/2023/10/03/Study-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
      <url>/2023/10/03/Study-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æœ¬ç¯‡æ–‡ç« å‚è€ƒè‡ªï¼š</p><ol><li><p><a href="https://www.bilibili.com/video/BV1c4411d7jb">https://www.bilibili.com/video/BV1c4411d7jb</a></p></li><li><p><a href="https://frxcat.fun/pages/39e2a1/">https://frxcat.fun/pages/39e2a1/</a></p></li><li><p><a href="https://github.com/BloothOfYouth/Computer-Network-Notes">https://github.com/BloothOfYouth/Computer-Network-Notes</a></p></li></ol><p>åšé¢˜è§†é¢‘ï¼šP12ï¼ŒP13ï¼ŒP18ï¼ŒP19ï¼ŒP23ï¼ŒP30</p><h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><ol><li>ç½‘ç»œ</li></ol><p>è®¡ç®—æœºç½‘ç»œç”±è‹¥å¹²çš„<strong>ç»“ç‚¹</strong>(node)å’Œè¿æ¥è¿™äº›ç»“ç‚¹çš„<strong>é“¾è·¯</strong>(link)ç»„æˆã€‚</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231118164945924.png" alt="image-20231118164945924"></p><ol start="2"><li>äº’è”ç½‘</li></ol><p>ç½‘ç»œçš„ç½‘ç»œå°±å«äº’è”ç½‘ï¼Œç½‘ç»œå’Œç½‘ç»œä¹‹é—´è¿˜å¯ä»¥é€šè¿‡è·¯ç”±å™¨ç›¸äº’è¿æ¥èµ·æ¥ï¼Œæ„é€ æˆä¸€ä¸ªæ›´å¤§çš„è®¡ç®—æœºç½‘ç»œã€‚</p><ol start="3"><li>å› ç‰¹ç½‘</li></ol><p>ä¸–ç•Œä¸Šæœ€å¤§çš„äº’è”ç½‘å°±æ˜¯å› ç‰¹ç½‘ã€‚</p><ol start="4"><li>äº’è”ç½‘çš„ç»„æˆ</li></ol><p>äº’è”ç½‘ä¸»è¦åŒ…æ‹¬ä¸‹è¿°ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>è¾¹ç¼˜éƒ¨åˆ†</li></ul><ol><li>æœ‰æ‰€æœ‰è¿æ¥åœ¨äº’è”ç½‘ä¸Šçš„ä¸»æœºç»„æˆ</li><li>æ˜¯ç”¨æˆ·<strong>ç›´æ¥ä½¿ç”¨</strong>çš„</li><li>ç”¨æ¥é€šä¿¡å’Œèµ„æºå…±äº«</li></ol><ul><li>æ ¸å¿ƒéƒ¨åˆ†</li></ul><ol><li>ç”±å¤§é‡ç½‘ç»œå’Œè¿æ¥è¿™äº›ç½‘ç»œçš„è·¯ç”±å™¨ç»„æˆ</li><li>ä¸»è¦ä¸º<strong>è¾¹ç¼˜éƒ¨åˆ†æä¾›æœåŠ¡</strong>çš„</li></ol><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231118165236589.png" alt="image-20231118165236589"></p><h2 id="ä¸‰ç§äº¤æ¢æ–¹å¼"><a href="#ä¸‰ç§äº¤æ¢æ–¹å¼" class="headerlink" title="ä¸‰ç§äº¤æ¢æ–¹å¼"></a>ä¸‰ç§äº¤æ¢æ–¹å¼</h2><p><mark>ä»é€šä¿¡çš„è§’åº¦æ¥çœ‹ï¼Œ<strong>äº¤æ¢</strong> (switching)å°±æ˜¯æŒ‰ç…§æŸç§æ–¹å¼åŠ¨æ€çš„åˆ†é…ä¼ è¾“çº¿è·¯çš„èµ„æºã€‚</mark></p><h3 id="ç”µè·¯äº¤æ¢"><a href="#ç”µè·¯äº¤æ¢" class="headerlink" title="ç”µè·¯äº¤æ¢"></a>ç”µè·¯äº¤æ¢</h3><p>ç›´æ¥ç”¨ç”µè·¯è¿›è¡Œè¿æ¥ä¼ è¾“èµ„æº</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231118165516252.png" alt="image-20231118165516252"></p><p>ç”µè·¯äº¤æ¢é€šå¸¸éœ€è¦ä»¥ä¸‹çš„ä¸‰ä¸ªæ­¥éª¤ã€‚</p><ol><li>å»ºç«‹è¿æ¥ (åˆ†é…é€šä¿¡èµ„æº)</li><li>é€šè¯ (ä¸€ç›´å ç”¨èµ„æº)</li><li>é‡Šæ”¾è¿æ¥ (å½’è¿˜é€šä¿¡èµ„æº)</li></ol><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231118165544003.png" alt="image-20231118165544003"></p><h3 id="åˆ†ç»„äº¤æ¢â­â­â­"><a href="#åˆ†ç»„äº¤æ¢â­â­â­" class="headerlink" title="åˆ†ç»„äº¤æ¢â­â­â­"></a>åˆ†ç»„äº¤æ¢â­â­â­</h3><p><mark>ä¸€æ®µä¿¡æ¯é€šå¸¸ä¼šè¢«åˆ†æˆå¤šæ¡ä¿¡æ¯ã€‚æ¯æ¡éƒ½æ˜¯ä¸€æ®µæŠ¥æ–‡ã€‚</mark></p><p>åœ¨å‘é€å‰ä¼šåœ¨æ¯ä¸ªåˆ†ç»„å‰åŠ ä¸Šå¤´ä¿¡æ¯ã€‚</p><p>åˆ†ç»„äº¤æ¢é€šå¸¸ä¼šéœ€è¦ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ã€‚</p><ol><li>å‘é€æ–¹: æ„é€ åˆ†ç»„ã€å‘é€åˆ†ç»„</li><li>è·¯ç”±å™¨: ç¼“å­˜åˆ†ç»„ã€è½¬å‘åˆ†ç»„</li><li>æ¥æ”¶æ–¹: æ¥å—åˆ†ç»„ã€è¿˜åŸæŠ¥æ–‡</li></ol><h3 id="æŠ¥æ–‡äº¤æ¢"><a href="#æŠ¥æ–‡äº¤æ¢" class="headerlink" title="æŠ¥æ–‡äº¤æ¢"></a>æŠ¥æ–‡äº¤æ¢</h3><p>æŠ¥æ–‡äº¤æ¢ä¸åˆ†ç»„äº¤æ¢ç±»ä¼¼ï¼Œä¸è¿‡ç”±äº<mark>å…¶æŠ¥æ–‡çš„å¤§å°æœªåšé™åˆ¶</mark>ï¼Œå› æ­¤å¯¹è·¯ç”±å™¨ç­‰è®¾å¤‡çš„ç©ºé—´è¦æ±‚è¾ƒé«˜ï¼Œæ‰€ä»¥ä½¿ç”¨çš„è¾ƒå°‘ã€‚</p><h3 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h3><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231118165825500.png" alt="image-20231118165825500"></p><h2 id="å…«ä¸ªæ€§èƒ½æŒ‡æ ‡"><a href="#å…«ä¸ªæ€§èƒ½æŒ‡æ ‡" class="headerlink" title="å…«ä¸ªæ€§èƒ½æŒ‡æ ‡"></a>å…«ä¸ªæ€§èƒ½æŒ‡æ ‡</h2><h3 id="é€Ÿç‡"><a href="#é€Ÿç‡" class="headerlink" title="é€Ÿç‡"></a>é€Ÿç‡</h3><ul><li>åœ¨æ•°å­—ä¿¡é“ä¸Šä¼ è¾“æ¯”ç‰¹çš„é€Ÿç‡</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231118170225088.png" alt="image-20231118170225088"></p><h3 id="å¸¦å®½"><a href="#å¸¦å®½" class="headerlink" title="å¸¦å®½"></a>å¸¦å®½</h3><ul><li><p>ç”¨æ¥è¡¨ç¤ºç½‘ç»œçš„é€šä¿¡çº¿è·¯æ‰€èƒ½ä¼ è¾“æ•°æ®çš„<strong>èƒ½åŠ›</strong>ï¼Œé€šå¸¸ä¸º<mark>ã€Œæœ€é«˜æ•°æ®ç‡ã€</mark>ã€‚</p></li><li><p>å•ä½ <code>b/s</code></p></li></ul><h3 id="ååé‡"><a href="#ååé‡" class="headerlink" title="ååé‡"></a>ååé‡</h3><ul><li><p>åœ¨å•ä½æ—¶é—´å†…é€šè¿‡æŸä¸ªç½‘ç»œ(æˆ–ä¿¡é“ã€æ¥å£)çš„<strong>æ•°æ®é‡</strong></p></li><li><p>ååé‡å—åˆ°<strong>ç½‘ç»œçš„å¸¦å®½æˆ–é¢å®šé€Ÿç‡</strong>çš„é™åˆ¶</p></li></ul><h3 id="æ—¶å»¶"><a href="#æ—¶å»¶" class="headerlink" title="æ—¶å»¶"></a>æ—¶å»¶</h3><ul><li>ä¸»è¦ç”±ä¸‰éƒ¨åˆ†æ—¶å»¶<ul><li>å‘é€æ—¶å»¶ : æ˜¯ç”±æºä¸»æœºå‘é€åˆ°ä¼ è¾“çº¿è·¯çš„æ—¶é—´</li><li>ä¼ æ’­æ—¶å»¶ : ä¿¡å·åœ¨ä¼ è¾“çº¿çº¿è·¯ä¸Šä¼ è¾“çš„æ—¶é—´</li><li>å¤„ç†æ—¶å»¶ : ä¿¡å·åœ¨è·¯ç”±å™¨ä¸Šå¤„ç†çš„æ—¶é—´</li></ul></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231118170422957.png" alt="image-20231118170422957"></p><p>è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ—¶å»¶ç±»åˆ«</th><th>è®¡ç®—æ–¹å¼</th></tr></thead><tbody><tr><td>å‘é€æ—¶å»¶</td><td>åˆ†ç»„é•¿åº¦å‘é€é€Ÿç‡åˆ†ç»„é•¿åº¦(b)&#x2F;å‘é€é€Ÿç‡(b&#x2F;s)</td></tr><tr><td>ä¼ æ’­æ—¶å»¶</td><td>ä¿¡é“é•¿åº¦ç”µç£æ³¢ä¼ æ’­é€Ÿç‡ä¿¡é“é•¿åº¦(m)&#x2F;ç”µç£æ³¢ä¼ æ’­é€Ÿç‡(m&#x2F;s)</td></tr><tr><td>å¤„ç†æ—¶å»¶</td><td>ä¸æ–¹ä¾¿è®¡ç®—</td></tr></tbody></table><h3 id="æ—¶å»¶å¸¦å®½ç§¯"><a href="#æ—¶å»¶å¸¦å®½ç§¯" class="headerlink" title="æ—¶å»¶å¸¦å®½ç§¯"></a>æ—¶å»¶å¸¦å®½ç§¯</h3><p>æ—¶å»¶å¸¦å®½ç§¯ä¼ æ’­æ—¶å»¶å¸¦å®½æ—¶å»¶å¸¦å®½ç§¯&#x3D;ä¼ æ’­æ—¶å»¶Ã—å¸¦å®½</p><ul><li>åœ¨å‘é€ç«¯è¿ç»­å‘é€æ•°æ®çš„æƒ…å†µä¸‹ï¼Œåœ¨ç¬¬ä¸€ä¸ªæ¯”ç‰¹åˆ°è¾¾ç»ˆç‚¹çš„æ—¶å€™ï¼Œå‘é€ç«¯åˆ°ç»ˆç‚¹ä¸­çš„ <code>bit</code> æ•°å°±æ˜¯æ—¶å»¶å¸¦å®½ç§¯</li><li>é“¾è·¯çš„æ—¶å»¶å¸¦å®½ç§¯åˆç§° <strong>ä»¥æ¯”ç‰¹ä¸ºå•ä½çš„é“¾è·¯é•¿åº¦</strong></li><li>èµ·ç‚¹åˆ°ç»ˆç‚¹çš„é“¾è·¯ä¸­æ‰€èƒ½å®¹çº³çš„æœ€å¤§æ•°æ®é‡ã€‚</li></ul><h3 id="å¾€è¿”æ—¶é—´"><a href="#å¾€è¿”æ—¶é—´" class="headerlink" title="å¾€è¿”æ—¶é—´"></a>å¾€è¿”æ—¶é—´</h3><p>å¾€è¿”æ—¶é—´ <strong>RTT</strong>(<strong>R</strong>ound-<strong>T</strong>rip <strong>T</strong>ime) æ˜¯æŒ‡ä»å‡ºå‘ç‚¹å‘å‡ºåˆ†ç»„ä¿¡å·ï¼Œç›´åˆ°å‡ºå‘ç‚¹æ”¶åˆ°ç»ˆç‚¹çš„ç¡®è®¤æ”¶åˆ°ä¸ºæ­¢ã€‚</p><h3 id="åˆ©ç”¨ç‡"><a href="#åˆ©ç”¨ç‡" class="headerlink" title="åˆ©ç”¨ç‡"></a>åˆ©ç”¨ç‡</h3><ol><li><ol><li>ä¿¡é“åˆ©ç”¨ç‡ : ç”¨æ¥è¡¨ç¤ºä¿¡é“æœ‰ç™¾åˆ†ä¹‹å¤šå°‘çš„æ—¶é—´æ˜¯è¢«åˆ©ç”¨çš„</li><li>ç½‘ç»œåˆ©ç”¨ç‡ : å…¨ç½‘ç»œçš„ä¿¡é“åˆ©ç”¨ç»¿çš„åŠ æƒå¹³å‡å€¼</li></ol></li></ol><ul><li>æ ¹æ®æ’é˜Ÿè®ºï¼Œä¿¡é“çš„åˆ©ç”¨ç‡å¢å¤§æ—¶ï¼Œä¿¡é“å¼•èµ·çš„æ—¶å»¶ä¹Ÿä¼šå¢å¤§ã€‚å› æ­¤ä¿¡é“çš„<strong>åˆ©ç”¨ç‡å¹¶éè¶Šå¤§è¶Šå¥½</strong></li><li>ç”¨ D0 è¡¨ç¤ºç½‘ç»œç©ºé—²æ—¶çš„æ—¶å»¶ï¼ŒD è¡¨ç¤ºå½“å‰ç½‘ç»œçš„æ—¶å»¶ï¼ŒU è¡¨ç¤ºåˆ©ç”¨ç‡ã€‚ D&#x3D;D0&#x2F;(1âˆ’U) æœ‰å¦‚ä¸‹æ‰€ç¤ºçš„å…³ç³»</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.610n552gl640.webp" alt="image"></p><ul><li><ul><li>å½“ç½‘ç»œçš„åˆ©ç”¨ç‡è¾¾åˆ°50%æ—¶ï¼Œæ—¶å»¶å°±è¦åŠ å€;</li><li>å½“ç½‘ç»œçš„åˆ©ç”¨ç‡è¶…è¿‡50%æ—¶ï¼Œæ—¶å»¶æ€¥å‰§å¢å¤§;</li><li>å½“ç½‘ç»œçš„åˆ©ç”¨ç‡æ¥è¿‘100%æ—¶ï¼Œæ—¶å»¶å°±è¶‹äºæ— ç©·å¤§;</li><li>å› æ­¤ï¼Œä¸€äº›æ‹¥æœ‰è¾ƒå¤§ä¸»å¹²ç½‘çš„ISPé€šå¸¸ä¼šæ§åˆ¶å®ƒä»¬çš„ä¿¡é“åˆ©ç”¨ç‡ä¸è¶…è¿‡50%ã€‚</li></ul></li></ul><h3 id="ä¸¢åŒ…ç‡"><a href="#ä¸¢åŒ…ç‡" class="headerlink" title="ä¸¢åŒ…ç‡"></a>ä¸¢åŒ…ç‡</h3><ul><li><p>ä¸¢åŒ…ç‡æ˜¯æŒ‡ï¼Œä¸¢å¤±åˆ†ç»„çš„æ•°é‡ä¸æ€»åˆ†ç»„æ•°é‡çš„æ¯”ç‡</p></li><li><p>ä¸¢åŒ…ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§æƒ…å†µ</p></li></ul><ol><li>ä¼ è¾“è¿‡ç¨‹ä¸­å‡ºç°è¯¯ç ï¼Œè¢«ç»“ç‚¹ä¸¢å¼ƒ</li><li>ç½‘ç»œæ‹¥å¡æ—¶è¢«ä¸¢å¼ƒ</li></ol><h2 id="è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„"><a href="#è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„" class="headerlink" title="è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„"></a>è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„</h2><h3 id="æ¯ä¸€å±‚è§£å†³çš„é—®é¢˜"><a href="#æ¯ä¸€å±‚è§£å†³çš„é—®é¢˜" class="headerlink" title="æ¯ä¸€å±‚è§£å†³çš„é—®é¢˜"></a>æ¯ä¸€å±‚è§£å†³çš„é—®é¢˜</h3><ol><li>ç‰©ç†å±‚<ul><li>å®ç°æ¯”ç‰¹ 0\1 çš„ä¼ è¾“</li><li>é‡‡ç”¨æ€æ ·çš„ä¼ è¾“åª’ä½“(ä»‹è´¨)</li><li>é‡‡ç”¨æ€æ ·çš„ç‰©ç†æ¥å£</li><li>ä½¿ç”¨æ€æ ·çš„ä¿¡å·è¡¨ç¤ºæ¯”ç‰¹0å’Œ1</li></ul></li><li>æ•°æ®é“¾è·¯å±‚<ul><li>æ ‡è¯†ç½‘ç»œä¸­å„ä¸ªä¸»æœº</li><li>ä»ä¿¡å·ä¸­åŒºåˆ†å‡ºåœ°å€å’Œæ•°æ®ä¿¡æ¯</li><li>å®ç°<strong>ä¸€ä¸ªç½‘ç»œ</strong>ä¹‹é—´çš„<strong>ç›¸äº’é€šä¿¡</strong></li></ul></li><li>ç½‘ç»œå±‚<ul><li>æ ‡è¯†å„ä¸ªç½‘ç»œä»¥åŠå„ä¸ªç½‘ç»œä¸­çš„å„ä¸»æœº</li><li>è·¯ç”±å™¨å¦‚ä½•è½¬å‘åˆ†ç»„ï¼Œè·¯ç”±å™¨å¦‚ä½•è¿›è¡Œè·¯ç”±é€‰æ‹©</li></ul></li><li>è¿è¾“å±‚<ul><li>è§£å†³è¿›ç¨‹ä¹‹é—´åŸºäºç½‘ç»œçš„é€šä¿¡åŠŸèƒ½</li><li>ä¼ è¾“å‡ºç°é”™è¯¯çš„æ—¶å€™ï¼Œå¦‚ä½•å¤„ç†</li></ul></li><li>åº”ç”¨å±‚<ul><li>é€šè¿‡åº”ç”¨è¿›ç¨‹çš„äº¤äº’æ¥å®Œæˆç‰¹å®šçš„ç½‘ç»œåº”ç”¨</li></ul></li></ol><h3 id="åº”ç”¨è¿›ç¨‹é—´åŸºäºç½‘ç»œçš„é€šä¿¡çš„æµç¨‹"><a href="#åº”ç”¨è¿›ç¨‹é—´åŸºäºç½‘ç»œçš„é€šä¿¡çš„æµç¨‹" class="headerlink" title="åº”ç”¨è¿›ç¨‹é—´åŸºäºç½‘ç»œçš„é€šä¿¡çš„æµç¨‹"></a>åº”ç”¨è¿›ç¨‹é—´åŸºäºç½‘ç»œçš„é€šä¿¡çš„æµç¨‹</h3><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231118170914318.png" alt="image-20231118170914318"></p><h3 id="è®¡ç®—æœºç½‘ç»œä¸­çš„ç›¸å…³æœ¯è¯­"><a href="#è®¡ç®—æœºç½‘ç»œä¸­çš„ç›¸å…³æœ¯è¯­" class="headerlink" title="è®¡ç®—æœºç½‘ç»œä¸­çš„ç›¸å…³æœ¯è¯­"></a>è®¡ç®—æœºç½‘ç»œä¸­çš„ç›¸å…³æœ¯è¯­</h3><ol><li><p>å®ä½“</p><ul><li>å®ä½“æ˜¯æŒ‡ä»»ä½•å¯å‘é€æˆ–æ¥å—ä¿¡æ¯çš„ <strong>ç¡¬ä»¶æˆ–è½¯ä»¶è¿›ç¨‹</strong></li><li>å¯¹ç­‰å®ä½“ï¼Œæ˜¯æŒ‡æ”¶å‘åŒæ–¹ä¸­ <strong>ç›¸åŒå±‚æ¬¡ä¸­çš„å®ä½“</strong></li></ul></li><li><p>åè®®</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.qdst3f2qk40.webp" alt="image"></p><ul><li>åè®®æ˜¯æŒ‡ä¸¤ä¸ªå¯¹ç­‰å®ä½“è¿›è¡Œé€»è¾‘é€šä¿¡çš„è§„åˆ™çš„é›†åˆ</li><li>é€»è¾‘é€šä¿¡å®é™…ä¸­å¹¶ä¸å­˜åœ¨ï¼Œåªæ˜¯å‡è®¾çš„ä¸€ç§é€šä¿¡</li><li>åè®®çš„ä¸‰è¦ç´ <ul><li>è¯­æ³• å®šä¹‰äº¤æ¢ä¿¡æ¯çš„æ ¼å¼</li><li>è¯­ä¹‰ å®šä¹‰åŒæ–¹éœ€è¦å®Œæˆçš„çš„æ“ä½œ</li><li>åŒæ­¥ å®šä¹‰æ”¶å‘åŒæ–¹çš„æ—¶åºå…³ç³»</li></ul></li></ul></li></ol><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.2wbmp47a8u20.webp" alt="image"></p><ol start="3"><li>æœåŠ¡</li></ol><ul><li>åœ¨åè®®çš„æ§åˆ¶ä¸‹ï¼Œä¸¤ä¸ªå¯¹ç­‰å®ä½“é—´çš„é€šä¿¡ä½¿å¾—æœ¬å±‚èƒ½å¤Ÿå‘ä¸Šä¸€å±‚æä¾›æœåŠ¡</li><li>å¦‚æœè¦å®ç°æœ¬å±‚çš„åè®®ï¼Œå¿…é¡»è¦ä¸‹ä¸€å±‚æ‰€æä¾›çš„æœåŠ¡</li><li>åè®®æ˜¯<strong>æ°´å¹³</strong>çš„ï¼Œè€ŒæœåŠ¡æ˜¯<strong>å‚ç›´</strong>çš„</li><li>å®ä½“çœ‹å¾—è§ä¸‹å±‚æä¾›çš„æœåŠ¡ï¼Œä½†å¹¶ä¸çŸ¥é“å®ç°è¯¥æœåŠ¡çš„å…·ä½“åè®®ã€‚</li></ul><ol start="4"><li><p>Other</p></li><li><p>æœåŠ¡è®¿é—®ç‚¹ åœ¨åŒä¸€ç³»ç»Ÿä¸­<strong>ç›¸é‚»ä¸¤å±‚çš„å®ä½“äº¤æ¢ä¿¡æ¯çš„é€»è¾‘æ¥å£</strong>ï¼Œç”¨äºåŒºåˆ†ä¸åŒæœåŠ¡çš„ç±»å‹ã€‚</p></li><li><p>æœåŠ¡åŸè¯­ ä¸Šå±‚ä½¿ç”¨ä¸‹å±‚æ‰€æä¾›çš„æœåŠ¡å¿…é¡»é€šè¿‡ä¸ä¸‹å±‚<strong>äº¤æ¢ä¸€äº›å‘½ä»¤</strong> ï¼Œè¿™äº›å‘½ä»¤æˆä¸ºæœåŠ¡åŸè¯­ã€‚</p></li><li><p>åè®®æ•°æ®å•å…ƒPDU <strong>å¯¹ç­‰å±‚æ¬¡ä¹‹é—´ä¼ é€çš„æ•°æ®åŒ…</strong> ï¼Œæˆä¸ºè¯¥å±‚çš„åè®®æ•°æ®å•å…ƒ</p></li><li><p>æœåŠ¡æ•°æ®å•å…ƒSDU <strong>åŒæ„ç³»ç»Ÿå†…ï¼Œå±‚ä¸å±‚ä¹‹é—´äº¤æ¢çš„æ•°æ®åŒ…</strong> æˆä¸ºæœåŠ¡æ•°æ®å•å…ƒã€‚</p></li><li><p>å¤šä¸ª SDU å¯ä»¥åˆå¹¶ä¸ºä¸€ä¸ª PDU ï¼›ä¸€ä¸ª SDU ä¹Ÿå¯ä»¥åˆ’åˆ†ä¸ºå‡ ä¸ª PDU</p></li></ol><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.6ukjo5tcdsc0.webp" alt="image"></p><h1 id="ç‰©ç†å±‚âœï¸"><a href="#ç‰©ç†å±‚âœï¸" class="headerlink" title="ç‰©ç†å±‚âœï¸"></a>ç‰©ç†å±‚âœï¸</h1><h2 id="ç‰©ç†å±‚çš„åŸºæœ¬æ¦‚å¿µ"><a href="#ç‰©ç†å±‚çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="ç‰©ç†å±‚çš„åŸºæœ¬æ¦‚å¿µ"></a>ç‰©ç†å±‚çš„åŸºæœ¬æ¦‚å¿µ</h2><p><strong>ç‰©ç†å±‚åè®®çš„ä¸»è¦ä»»åŠ¡ï¼š</strong></p><ol><li>æœºæ¢°ç‰¹æ€§</li></ol><p>æŒ‡æ˜æ¥å£æ‰€ç”¨æ¥çº¿å™¨çš„ <strong>å½¢çŠ¶</strong> å’Œ <strong>å°ºå¯¸</strong> ã€ <strong>å¼•è„šæ•°ç›®</strong> å’Œ <strong>æ’åˆ—</strong> ã€ <strong>å›ºå®šå’Œé”å®š</strong> è£…ç½®ã€‚</p><ol start="2"><li>ç”µæ°”ç‰¹æ€§</li></ol><p>æŒ‡æ˜åœ¨æ¥å£ç”µç¼†çš„å„æ¡çº¿ä¸Šå‡ºç°çš„ <strong>ç”µå‹çš„èŒƒå›´</strong> ã€‚</p><ol start="3"><li>åŠŸèƒ½ç‰¹æ€§</li></ol><p>æŒ‡æ˜æŸæ¡æ˜¾ç¤ºè¡Œå‡ºç°æŸä¸€ç”µå¹³çš„ <strong>ç”µå‹è¡¨ç¤ºä½•ç§æ„ä¹‰</strong>ã€‚</p><ol start="4"><li>è¿‡ç¨‹ç‰¹æ€§</li></ol><p>æŒ‡æ˜å¯¹äºä¸åŒåŠŸèƒ½çš„å„ç§å¯èƒ½ <strong>äº‹ä»¶çš„å‡ºç°é¡ºåº</strong>ã€‚</p><p><mark><strong>ç‰©ç†å±‚çš„ä¸»è¦ä½œç”¨ï¼š</strong></mark></p><ol><li>ç‰©ç†å±‚è€ƒè™‘çš„æ˜¯<mark>æ€æ ·æ‰èƒ½è¿æ¥å„ç§ä¼ è¾“åª’ä½“ä¸Šä¼ è¾“æ•°æ®æ¯”ç‰¹æµ</mark></li><li>ç‰©ç†å±‚ä¸ºæ•°æ®é“¾è·¯å±‚å±è”½äº†å„ç§ä¼ è¾“åª’ä½“çš„å·®å¼‚ï¼Œæ˜¯æ•°æ®é“¾è·¯å±‚åªéœ€è¦è€ƒè™‘å¦‚ä½•å®Œæˆæœ¬å±‚çš„åè®®ï¼Œä¸å¿…è€ƒè™‘ç½‘ç»œå…·ä½“ä¼ è¾“çš„åª’ä½“æ˜¯ä»€ä¹ˆ</li></ol><h2 id="ç‰©ç†å±‚ä¸‹é¢çš„ä¼ è¾“åª’ä½“"><a href="#ç‰©ç†å±‚ä¸‹é¢çš„ä¼ è¾“åª’ä½“" class="headerlink" title="ç‰©ç†å±‚ä¸‹é¢çš„ä¼ è¾“åª’ä½“"></a>ç‰©ç†å±‚ä¸‹é¢çš„ä¼ è¾“åª’ä½“</h2><h3 id="å¯¼å¼•å‹ä¼ è¾“åª’ä½“"><a href="#å¯¼å¼•å‹ä¼ è¾“åª’ä½“" class="headerlink" title="å¯¼å¼•å‹ä¼ è¾“åª’ä½“"></a>å¯¼å¼•å‹ä¼ è¾“åª’ä½“</h3><ol><li>åŒç»çº¿</li><li>åŒè½´ç”µç¼†</li><li>å…‰çº¤</li><li>ç”µåŠ›çº¿</li></ol><h3 id="éå¼•å¯¼å‹ä¼ è¾“åª’ä½“"><a href="#éå¼•å¯¼å‹ä¼ è¾“åª’ä½“" class="headerlink" title="éå¼•å¯¼å‹ä¼ è¾“åª’ä½“"></a>éå¼•å¯¼å‹ä¼ è¾“åª’ä½“</h3><ol><li>æ— çº¿ç”µæ³¢</li><li>å¾®æ³¢</li><li>çº¢å¤–çº¿</li><li>å¯è§å…‰</li></ol><h2 id="ä¼ è¾“æ–¹å¼"><a href="#ä¼ è¾“æ–¹å¼" class="headerlink" title="ä¼ è¾“æ–¹å¼"></a>ä¼ è¾“æ–¹å¼</h2><h3 id="ä¸²è¡Œä¸å¹¶è¡Œ"><a href="#ä¸²è¡Œä¸å¹¶è¡Œ" class="headerlink" title="ä¸²è¡Œä¸å¹¶è¡Œ"></a>ä¸²è¡Œä¸å¹¶è¡Œ</h3><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231118195914716.png" alt="image-20231118195914716"></p><h3 id="åŒæ­¥ä¸å¼‚æ­¥"><a href="#åŒæ­¥ä¸å¼‚æ­¥" class="headerlink" title="åŒæ­¥ä¸å¼‚æ­¥"></a>åŒæ­¥ä¸å¼‚æ­¥</h3><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231118195949977.png" alt="image-20231118195949977"></p><ul><li>åŒæ­¥ä¼ è¾“æ—¶ï¼Œæ”¶å‘åŒæ–¹åŒæ­¥çš„æ–¹æ³•<ul><li>å¤–åŒæ­¥ï¼šåœ¨æ”¶å‘åŒæ–¹ä¹‹é—´æ·»åŠ ä¸€æ¡å•ç‹¬çš„æ—¶é’Ÿä¿¡å·çº¿</li><li>å†…åŒæ­¥ï¼šå‘é€ç«¯å°†å§‹ç»ˆåŒæ­¥ä¿¡å·å˜æ…¢åˆ°å‘é€æ•°æ®ä¸­ä¸€èµ·ä¼ è¾“</li></ul></li><li>å¼‚æ­¥å‘é€æ—¶ï¼Œæ¯ä¸ªå­—èŠ‚å•ç‹¬å‘é€ï¼Œä¸”èµ·å§‹æ®µä¸ç»“æŸæ®µæœ‰å•ç‹¬çš„æ ‡è®°ã€‚</li></ul><h3 id="å•å‘é€šä¿¡-åŒå‘äº¤æ›¿é€šä¿¡-åŒæ–¹åŒæ—¶é€šä¿¡-å•å·¥-åŠåŒå·¥-å…¨åŒå·¥"><a href="#å•å‘é€šä¿¡-åŒå‘äº¤æ›¿é€šä¿¡-åŒæ–¹åŒæ—¶é€šä¿¡-å•å·¥-åŠåŒå·¥-å…¨åŒå·¥" class="headerlink" title="å•å‘é€šä¿¡&#x2F;åŒå‘äº¤æ›¿é€šä¿¡&#x2F;åŒæ–¹åŒæ—¶é€šä¿¡(å•å·¥&#x2F;åŠåŒå·¥&#x2F;å…¨åŒå·¥)"></a>å•å‘é€šä¿¡&#x2F;åŒå‘äº¤æ›¿é€šä¿¡&#x2F;åŒæ–¹åŒæ—¶é€šä¿¡(å•å·¥&#x2F;åŠåŒå·¥&#x2F;å…¨åŒå·¥)</h3><p>åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨â€œ<strong>ä¿¡é“ï¼ˆchannelï¼‰</strong>â€è¿™ä¸€åè¯ã€‚ä¿¡é“å’Œç”µè·¯å¹¶ä¸ç­‰åŒã€‚ä¿¡é“ä¸€èˆ¬éƒ½æ˜¯ç”¨æ¥è¡¨ç¤ºå‘æŸä¸€ä¸ªæ–¹å‘ä¼ é€ä¿¡æ¯çš„åª’ä½“ã€‚å› æ­¤ï¼Œä¸€æ¡é€šä¿¡ç”µè·¯å¾€å¾€åŒ…å«ä¸€æ¡å‘é€ä¿¡é“å’Œä¸€æ¡æ¥æ”¶ä¿¡é“ã€‚</p><p>ä»é€šä¿¡çš„åŒæ–¹ä¿¡æ¯äº¤äº’çš„æ–¹å¼æ¥çœ‹ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹ä¸‰ç§åŸºæœ¬æ–¹å¼ï¼š</p><p><strong>å•å‘é€šä¿¡</strong>ï¼š</p><p>åˆç§°ä¸º<strong>å•å·¥é€šä¿¡</strong>ï¼Œå³åªèƒ½æœ‰ä¸€ä¸ªæ–¹å‘çš„é€šä¿¡è€Œæ²¡æœ‰åæ–¹å‘çš„äº¤äº’ã€‚æ— çº¿ç”µå¹¿æ’­æˆ–æœ‰çº¿ç”µä»¥åŠç”µè§†å¹¿æ’­å°±å±äºè¿™ç§ç±»å‹</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201008141345239.png" alt="image-20201008141345239"></p><p><strong>åŒå‘äº¤æ›¿é€šä¿¡</strong>ï¼š</p><p>åˆç§°ä¸º<strong>åŠåŒå·¥é€šä¿¡</strong>ï¼Œå³é€šä¿¡çš„åŒæ–¹å¯ä»¥å‘é€ä¿¡æ¯ï¼Œä½†ä¸èƒ½åŒæ–¹åŒæ—¶å‘é€ï¼ˆå½“ç„¶ä¹Ÿå°±ä¸èƒ½åŒæ—¶æ¥æ”¶ï¼‰ã€‚è¿™ç§é€šä¿¡æ–¹å¼ä½¿ä¸€æ–¹å‘é€å¦ä¸€æ–¹æ¥æ”¶ï¼Œè¿‡ä¸€æ®µæ—¶é—´åå¯ä»¥å†åè¿‡æ¥</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201008141921924.png" alt="image-20201008141921924"></p><p><strong>åŒå‘åŒæ—¶é€šä¿¡</strong>ï¼š</p><p>åˆç§°ä¸º<strong>å…¨åŒå·¥é€šä¿¡</strong>ï¼Œå³é€šä¿¡çš„åŒå‘å¯ä»¥åŒæ—¶å‘é€å’Œæ¥æ”¶ä¿¡æ¯ã€‚</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201008142037846.png" alt="image-20201008142037846"></p><blockquote><p><strong>å•å‘é€šä¿¡</strong>åªéœ€è¦ä¸€æ¡ä¿¡é“ï¼Œè€Œ<strong>åŒå‘äº¤æ›¿é€šä¿¡</strong>æˆ–<strong>åŒå‘åŒæ—¶é€šä¿¡</strong>åˆ™éœ€è¦ä¸¤æ¡ä¿¡é“ï¼ˆæ¯ä¸ªæ–¹å‘å„ä¸€æ¡ï¼‰</p><p><strong>åŒå‘åŒæ—¶é€šä¿¡</strong>çš„ä¼ è¾“æ•ˆç‡æœ€é«˜</p></blockquote><h2 id="ç¼–ç ä¸è°ƒåˆ¶âœï¸"><a href="#ç¼–ç ä¸è°ƒåˆ¶âœï¸" class="headerlink" title="ç¼–ç ä¸è°ƒåˆ¶âœï¸"></a>ç¼–ç ä¸è°ƒåˆ¶âœï¸</h2><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231118201632001.png" alt="image-20231118201632001"></p><p><strong>å¸¸ç”¨æœ¯è¯­ï¼š</strong></p><ul><li><p><strong>æ•°æ® (data)</strong> â€”â€” è¿é€æ¶ˆæ¯çš„å®ä½“ã€‚</p></li><li><p><strong>ä¿¡å· (signal)</strong> â€”â€” æ•°æ®çš„ç”µæ°”çš„æˆ–ç”µç£çš„è¡¨ç°ã€‚ </p></li><li><p><strong>æ¨¡æ‹Ÿä¿¡å· (analogous signal)</strong> â€”â€” ä»£è¡¨æ¶ˆæ¯çš„å‚æ•°çš„å–å€¼æ˜¯è¿ç»­çš„ã€‚ </p></li><li><p><strong>æ•°å­—ä¿¡å· (digital signal)</strong> â€”â€” ä»£è¡¨æ¶ˆæ¯çš„å‚æ•°çš„å–å€¼æ˜¯ç¦»æ•£çš„ã€‚ </p></li><li><p><strong>ç å…ƒ (code)</strong> â€”â€” åœ¨ä½¿ç”¨æ—¶é—´åŸŸï¼ˆæˆ–ç®€ç§°ä¸ºæ—¶åŸŸï¼‰çš„æ³¢å½¢è¡¨ç¤ºæ•°å­—ä¿¡å·æ—¶ï¼Œä»£è¡¨ä¸åŒç¦»æ•£æ•°å€¼çš„åŸºæœ¬æ³¢å½¢ã€‚</p></li><li><p><strong>åŸºå¸¦ä¿¡å·</strong>ï¼ˆå³åŸºæœ¬é¢‘å¸¦ä¿¡å·ï¼‰â€”â€” æ¥è‡ªä¿¡æºçš„ä¿¡å·ã€‚åƒè®¡ç®—æœºè¾“å‡ºçš„ä»£è¡¨å„ç§æ–‡å­—æˆ–å›¾åƒæ–‡ä»¶çš„æ•°æ®ä¿¡å·éƒ½å±äºåŸºå¸¦ä¿¡å·ã€‚</p></li><li><p>åŸºå¸¦ä¿¡å·å¾€å¾€åŒ…å«æœ‰è¾ƒå¤šçš„ä½é¢‘æˆåˆ†ï¼Œç”šè‡³æœ‰ç›´æµæˆåˆ†ï¼Œè€Œè®¸å¤šä¿¡é“å¹¶ä¸èƒ½ä¼ è¾“è¿™ç§ä½é¢‘åˆ†é‡æˆ–ç›´æµåˆ†é‡ã€‚å› æ­¤å¿…é¡»å¯¹åŸºå¸¦ä¿¡å·è¿›è¡Œ<strong>è°ƒåˆ¶</strong>  (modulation)ã€‚</p></li></ul><p>ğŸŒˆè¡¥å……ï¼š</p><ul><li><strong>ç¼–ç ï¼š</strong> é€šè¿‡ç¼–ç ï¼Œå¯ä»¥<mark>å°†åŸå§‹çš„åŸºå¸¦ä¿¡å·è¡¨ç¤ºä¸ºæ›´ç´§å‡‘ã€é«˜æ•ˆçš„å½¢å¼</mark>ï¼Œä»¥ä¾¿åœ¨ç½‘ç»œä¸­ä¼ è¾“ã€‚ç¼–ç ä¹Ÿå¯ä»¥ç”¨äºçº é”™å’Œå®‰å…¨æ€§ï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œä¿å¯†æ€§ã€‚</li><li><strong>è°ƒåˆ¶ï¼š</strong> è°ƒåˆ¶<mark>å…è®¸åŸºå¸¦ä¿¡å·åœ¨ä¼ è¾“ä»‹è´¨ä¸­ä¼ æ’­</mark>ã€‚ä¸åŒçš„è°ƒåˆ¶æ–¹å¼é€‚ç”¨äºä¸åŒçš„ä¼ è¾“ä»‹è´¨å’Œåº”ç”¨åœºæ™¯ã€‚è°ƒåˆ¶å¯ä»¥ä½¿ä¿¡å·é€‚åº”ä¼ è¾“åª’ä½“çš„ç‰¹æ€§ï¼ŒåŒæ—¶æé«˜ä¿¡å·çš„ä¼ è¾“è·ç¦»å’ŒæŠ—å¹²æ‰°èƒ½åŠ›ã€‚</li><li><mark>ç¼–ç æ˜¯å°†æ•°å­—ä¿¡å·æˆ–è€…æ¨¡æ‹Ÿä¿¡å·è½¬æ¢ä¸ºæ•°å­—ä¿¡å·å»åœ¨æ•°å­—ä¿¡é“ä¸­ä¼ è¾“ï¼Œè€Œè°ƒåˆ¶æ˜¯å°†æ•°å­—ä¿¡å·æˆ–è€…æ¨¡æ‹Ÿä¿¡å·è½¬æ¢ä¸ºæ¨¡æ‹Ÿä¿¡å·å»åœ¨æ¨¡æ‹Ÿä¿¡é“ä¸­ä¼ è¾“ã€‚</mark></li></ul><h3 id="å¸¸è§ç¼–ç æ–¹å¼"><a href="#å¸¸è§ç¼–ç æ–¹å¼" class="headerlink" title="å¸¸è§ç¼–ç æ–¹å¼"></a>å¸¸è§ç¼–ç æ–¹å¼</h3><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.z6k4dfxm0io.webp" alt="image"></p><ul><li>ä¸å½’é›¶ç¼–ç ä¸­å­˜åœ¨æ—¶é’Ÿä¸ä¸€è‡´çš„é—®é¢˜</li><li>å½’é›¶ç¼–ç ä¸­å­˜åœ¨æµªè´¹æ•°æ®å¸¦å®½çš„é—®é¢˜</li><li>æ›¼åˆ‡æ–¯ç‰¹ç¼–ç æœ‰è‡ªåŠ¨åŒæ­¥çš„èƒ½åŠ›</li><li>å·®åˆ†æ›¼åˆ‡æ–¯ç‰¹ç¼–ç ç›¸äº¤ä¸Šé¢çš„ç¼–ç å˜åŒ–å°‘ï¼Œæ›´é€‚åˆç½‘ç»œä¼ è¾“</li></ul><h3 id="å¸¸è§è°ƒåˆ¶æ–¹å¼âœï¸"><a href="#å¸¸è§è°ƒåˆ¶æ–¹å¼âœï¸" class="headerlink" title="å¸¸è§è°ƒåˆ¶æ–¹å¼âœï¸"></a>å¸¸è§è°ƒåˆ¶æ–¹å¼âœï¸</h3><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231118202306963.png" alt="image-20231118202306963"></p><p>ä¸è¿‡æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œä½¿ç”¨åŸºæœ¬è°ƒåˆ¶æ–¹å¼ï¼Œä¸€ä¸ªç å…ƒåªèƒ½åŒ…å«ä¸€ä¸ªæ¯”ç‰¹ä¿¡æ¯ã€‚é€šå¸¸æ¥è¯´å¯ä»¥æœ‰æ··åˆè°ƒåˆ¶çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªç»´åº¦ä¸€èµ·è°ƒåˆ¶çš„æ–¹å¼ã€‚</p><p>ä¸‹é¢å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­</p><p>æ­£äº¤æŒ¯å¹…è°ƒåˆ¶ QAM</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.4tc9rfwo3l40.webp" alt="image"></p><blockquote><p>å¬ä¸å¤ªæ‡‚ï¼Œå¾…è¡¥å……ã€‚ã€‚ã€‚ã€‚ã€‚</p></blockquote><h2 id="ä¿¡é“çš„æé™å®¹é‡âœï¸"><a href="#ä¿¡é“çš„æé™å®¹é‡âœï¸" class="headerlink" title="ä¿¡é“çš„æé™å®¹é‡âœï¸"></a>ä¿¡é“çš„æé™å®¹é‡âœï¸</h2><h3 id="é€ æˆä¿¡å·å¤±çœŸçš„å› ç´ "><a href="#é€ æˆä¿¡å·å¤±çœŸçš„å› ç´ " class="headerlink" title="é€ æˆä¿¡å·å¤±çœŸçš„å› ç´ "></a>é€ æˆä¿¡å·å¤±çœŸçš„å› ç´ </h3><ul><li>ä»»ä½•å®é™…çš„ä¿¡é“éƒ½ä¸æ˜¯ç†æƒ³çš„ï¼Œåœ¨ä¼ è¾“ä¿¡å·æ—¶ä¼šäº§ç”Ÿå„ç§å¤±çœŸä»¥åŠå¸¦æ¥å¤šç§å¹²æ‰°ã€‚ </li><li>ç å…ƒä¼ è¾“çš„é€Ÿç‡è¶Šé«˜ï¼Œæˆ–ä¿¡å·ä¼ è¾“çš„è·ç¦»è¶Šè¿œï¼Œæˆ–ä¼ è¾“åª’ä½“è´¨é‡è¶Šå·®ï¼Œåœ¨ä¿¡é“çš„è¾“å‡ºç«¯çš„æ³¢å½¢çš„å¤±çœŸå°±è¶Šä¸¥é‡ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201010204336400.png" alt="image-20201010204336400"></p><p>å¤±çœŸçš„åŸå› ï¼š</p><ul><li>ç å…ƒä¼ è¾“çš„é€Ÿç‡è¶Šé«˜</li><li>ä¿¡å·ä¼ è¾“çš„è·ç¦»è¶Šè¿œ</li><li>å™ªå£°å¹²æ‰°è¶Šå¤§</li><li>ä¼ è¾“åª’ä½“è´¨é‡è¶Šå·®</li></ul><h3 id="å¥ˆæ°å‡†åˆ™å’Œé¦™å†œå…¬å¼"><a href="#å¥ˆæ°å‡†åˆ™å’Œé¦™å†œå…¬å¼" class="headerlink" title="å¥ˆæ°å‡†åˆ™å’Œé¦™å†œå…¬å¼"></a>å¥ˆæ°å‡†åˆ™å’Œé¦™å†œå…¬å¼</h3><blockquote><p>å¾…è¡¥å……ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p><p>å¥ˆæ°å‡†åˆ™</p><p>é¦™å†œå…¬å¼</p></blockquote><h3 id="å¥ˆæ°å‡†åˆ™å’Œé¦™å†œå…¬å¼çš„æ„ä¹‰"><a href="#å¥ˆæ°å‡†åˆ™å’Œé¦™å†œå…¬å¼çš„æ„ä¹‰" class="headerlink" title="å¥ˆæ°å‡†åˆ™å’Œé¦™å†œå…¬å¼çš„æ„ä¹‰"></a>å¥ˆæ°å‡†åˆ™å’Œé¦™å†œå…¬å¼çš„æ„ä¹‰</h3><ul><li>åœ¨ä¿¡é“å¸¦å®½ä¸€å®šçš„æƒ…å†µä¸‹ï¼Œæ ¹æ®å¥ˆæ°å‡†åˆ™å’Œé¦™å†œå…¬å¼ï¼Œè¦æƒ³æé«˜ä¿¡æ¯çš„ä¼ è¾“é€Ÿç‡å°±å¿…é¡»<mark>é‡‡ç”¨å¤šå…ƒåˆ¶</mark> (æ›´å¥½çš„è°ƒåˆ¶æ–¹æ³•)å’Œ<mark>åŠªåŠ›æé«˜ä¿¡é“ä¸­çš„ä¿¡å™ªæ¯”</mark>ã€‚</li><li>è‡ªä»é¦™å†œå…¬å¼å‘è¡¨åï¼Œå„ç§æ–°çš„ä¿¡å·å¤„ç†å’Œè°ƒåˆ¶æ–¹æ³•å°±ä¸æ–­å‡ºç°ï¼Œå…¶ç›®çš„éƒ½æ˜¯ä¸ºäº†å°½å¯èƒ½åœ°<mark>æ¥è¿‘é¦™å†œå…¬å¼ç»™å‡ºçš„ä¼ è¾“é€Ÿç‡æé™</mark></li></ul><h2 id="è¡¥å……ï¼šä¿¡é“å¤ç”¨æŠ€æœ¯"><a href="#è¡¥å……ï¼šä¿¡é“å¤ç”¨æŠ€æœ¯" class="headerlink" title="è¡¥å……ï¼šä¿¡é“å¤ç”¨æŠ€æœ¯"></a>è¡¥å……ï¼šä¿¡é“å¤ç”¨æŠ€æœ¯</h2><h3 id="é¢‘åˆ†å¤ç”¨ã€æ—¶åˆ†å¤ç”¨å’Œç»Ÿè®¡æ—¶åˆ†å¤ç”¨"><a href="#é¢‘åˆ†å¤ç”¨ã€æ—¶åˆ†å¤ç”¨å’Œç»Ÿè®¡æ—¶åˆ†å¤ç”¨" class="headerlink" title="é¢‘åˆ†å¤ç”¨ã€æ—¶åˆ†å¤ç”¨å’Œç»Ÿè®¡æ—¶åˆ†å¤ç”¨"></a>é¢‘åˆ†å¤ç”¨ã€æ—¶åˆ†å¤ç”¨å’Œç»Ÿè®¡æ—¶åˆ†å¤ç”¨</h3><ol><li>é¢‘åˆ†å¤ç”¨</li></ol><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.4hed19sa9cg.webp" alt="image"></p><p>æ¯ä¸ªç”¨æˆ·åˆ’åˆ†å‡ºä¸€ä¸ªé¢‘æ®µæ¥å°±æ˜¯é¢‘åˆ†å¤ç”¨ã€‚ å­˜åœ¨å¤§é‡çš„å¸¦å®½é—²ç½®çš„é—®é¢˜</p><ol start="2"><li>æ—¶åˆ†å¤ç”¨(TDM)</li></ol><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.58cg0bzk2uw0.webp" alt="image"></p><ul><li>æ‰€æœ‰ç”¨æˆ·è¢«åˆ’åˆ†åœ¨äº†ä¸åŒçš„æ—¶é—´å¸§ä¸­ï¼Œæ¯ä¸ªç”¨æˆ·å‘¨æœŸå‡ºç°ã€‚</li><li>å­˜åœ¨å¤§é‡çš„é™åˆ¶</li></ul><ol start="3"><li>ç»Ÿè®¡æ—¶åˆ†å¤ç”¨</li></ol><p>åŠ¨æ€åˆ†é…æ—¶é—´é—´éš™ï¼Œæé«˜åˆ©ç”¨ç‡</p><h3 id="æ³¢åˆ†å¤ç”¨-WDM"><a href="#æ³¢åˆ†å¤ç”¨-WDM" class="headerlink" title="æ³¢åˆ†å¤ç”¨(WDM)"></a>æ³¢åˆ†å¤ç”¨(WDM)</h3><p>æ³¢åˆ†å¤ç”¨å°±æ˜¯å…‰é¢‘æ‹†åˆ†å‡ºæ¥ï¼Œé€šè¿‡ä¸€ä¸ªå…‰çº¤æ¥ä¼ è¾“å¤šä¸ªä¿¡å·ã€‚</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.4jwgzkrt4nq0.webp" alt="image"></p><h3 id="ç åˆ†å¤ç”¨-CDMA"><a href="#ç åˆ†å¤ç”¨-CDMA" class="headerlink" title="ç åˆ†å¤ç”¨(CDMA)"></a>ç åˆ†å¤ç”¨(CDMA)</h3><p>æ‰€æœ‰çš„ç”¨æˆ·åœ¨åŒä¸€æ—¶åˆ»ä½¿ç”¨åŒä¸€é¢‘å¸¦è¿›è¡Œé€šä¿¡ã€‚</p><ul><li>å¸¸ç”¨çš„åè¯æ˜¯<strong>ç åˆ†å¤šå€</strong> CDMA (Code Division Multiple Access)ã€‚</li><li>å„ç”¨æˆ·ä½¿ç”¨ç»è¿‡ç‰¹æ®ŠæŒ‘é€‰çš„ä¸åŒç å‹ï¼Œå› æ­¤å½¼æ­¤ä¸ä¼šé€ æˆå¹²æ‰°ã€‚</li><li>è¿™ç§ç³»ç»Ÿå‘é€çš„ä¿¡å·æœ‰å¾ˆå¼ºçš„æŠ—å¹²æ‰°èƒ½åŠ›ï¼Œå…¶é¢‘è°±ç±»ä¼¼äºç™½å™ªå£°ï¼Œä¸æ˜“è¢«æ•Œäººå‘ç°ã€‚</li></ul><p>ğŸ”´ğŸŸ¢ğŸŸ¡<strong>æ€»ç»“ï¼š</strong></p><ol><li><strong>é¢‘åˆ†å¤ç”¨ï¼ˆFrequency Division Multiplexingï¼ŒFDMï¼‰ï¼š</strong><ul><li><strong>æ¦‚å¿µï¼š</strong> é¢‘åˆ†å¤ç”¨æ˜¯ä¸€ç§å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Œå®ƒé€šè¿‡å°†é¢‘è°±åˆ’åˆ†æˆä¸åŒçš„é¢‘ç‡å¸¦æ¥å…è®¸å¤šä¸ªä¿¡å·åŒæ—¶ä¼ è¾“ã€‚æ¯ä¸ªä¿¡å·å æ®ä¸åŒçš„é¢‘ç‡å¸¦å®½ï¼Œä»è€Œå¯ä»¥åŒæ—¶åœ¨ç›¸åŒçš„ç‰©ç†åª’ä»‹ä¸Šä¼ è¾“ã€‚</li><li><strong>ç”¨é€”ï¼š</strong> å¸¸è§äºå¹¿æ’­ç”µè§†ã€æ— çº¿é€šä¿¡ç­‰é¢†åŸŸï¼Œå¦‚æ— çº¿ç”µå’Œç”µè§†å¹¿æ’­ã€‚</li></ul></li><li><strong>æ—¶åˆ†å¤ç”¨ï¼ˆTime Division Multiplexingï¼ŒTDMï¼‰ï¼š</strong><ul><li><strong>æ¦‚å¿µï¼š</strong> æ—¶åˆ†å¤ç”¨æ˜¯ä¸€ç§å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Œå®ƒé€šè¿‡å°†æ—¶é—´åˆ’åˆ†ä¸ºä¸åŒçš„æ—¶éš™æ¥å…è®¸å¤šä¸ªä¿¡å·è½®æµä¼ è¾“ã€‚æ¯ä¸ªä¿¡å·åœ¨ä¸åŒçš„æ—¶é—´æ®µä¼ è¾“ï¼Œä»è€Œå…±äº«åŒä¸€ç‰©ç†åª’ä»‹ã€‚</li><li><strong>ç”¨é€”ï¼š</strong> å¸¸è§äºç”µè¯ç½‘ç»œã€æ•°å­—ä¼ è¾“ç³»ç»Ÿç­‰ï¼Œå¦‚ T1&#x2F;E1 æ•°å­—ä¼ è¾“çº¿è·¯ã€‚</li></ul></li><li><strong>ç»Ÿè®¡æ—¶åˆ†å¤ç”¨ï¼ˆStatistical Time Division Multiplexingï¼ŒSTDMï¼‰ï¼š</strong><ul><li><strong>æ¦‚å¿µï¼š</strong> ç»Ÿè®¡æ—¶åˆ†å¤ç”¨æ˜¯ä¸€ç§æ—¶åˆ†å¤ç”¨çš„å˜ä½“ï¼Œå…¶ä¸­æ—¶éš™çš„åˆ†é…æ˜¯æ ¹æ®ä¿¡é“ä¸Šå®é™…éœ€è¦ä¼ è¾“çš„æ•°æ®é‡è€ŒåŠ¨æ€å˜åŒ–çš„ã€‚å®ƒå…è®¸çµæ´»åœ°åˆ†é…æ—¶éš™ï¼Œä»¥é€‚åº”ä¸åŒä¿¡é“çš„å˜åŒ–éœ€æ±‚ã€‚</li><li><strong>ç”¨é€”ï¼š</strong> å¸¸è§äºæ•°æ®ç½‘ç»œï¼Œå¦‚ä»¥å¤ªç½‘ã€‚</li></ul></li><li><strong>æ³¢åˆ†å¤ç”¨ï¼ˆWavelength Division Multiplexingï¼ŒWDMï¼‰ï¼š</strong><ul><li><strong>æ¦‚å¿µï¼š</strong> æ³¢åˆ†å¤ç”¨æ˜¯ä¸€ç§å…‰é€šä¿¡ä¸­çš„å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Œå®ƒé€šè¿‡åœ¨å…‰çº¤ä¸­ä¼ è¾“å¤šä¸ªä¸åŒæ³¢é•¿çš„å…‰ä¿¡å·æ¥å®ç°å¤šè·¯å¤ç”¨ã€‚æ¯ä¸ªæ³¢é•¿å¯ä»¥ç‹¬ç«‹ä¼ è¾“æ•°æ®ï¼Œä½¿å¾—å…‰çº¤çš„ä¼ è¾“å®¹é‡å¤§å¹…æå‡ã€‚</li><li><strong>ç”¨é€”ï¼š</strong> å¸¸è§äºå…‰çº¤é€šä¿¡ç³»ç»Ÿï¼Œå¦‚é•¿è·ç¦»ä¼ è¾“ã€å…‰ç½‘ç»œç­‰ã€‚</li></ul></li><li><strong>ç åˆ†å¤ç”¨ï¼ˆCode Division Multiplexingï¼ŒCDMï¼‰ï¼š</strong><ul><li><strong>æ¦‚å¿µï¼š</strong> ç åˆ†å¤ç”¨æ˜¯ä¸€ç§å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Œå®ƒé€šè¿‡ä¸ºæ¯ä¸ªç”¨æˆ·åˆ†é…ç‹¬ç‰¹çš„ç ç‰‡åºåˆ—æ¥å®ç°å¤šç”¨æˆ·åœ¨ç›¸åŒé¢‘ç‡èŒƒå›´å†…åŒæ—¶ä¼ è¾“ã€‚æ¯ä¸ªç”¨æˆ·çš„æ•°æ®é€šè¿‡ä¸å…¶ç›¸å…³çš„ç ç‰‡è¿›è¡Œæ‰©é¢‘ï¼Œç„¶ååœ¨æ¥æ”¶ç«¯ä½¿ç”¨ç›¸åŒçš„ç ç‰‡è¿›è¡Œè§£æ‰©é¢‘ã€‚</li><li><strong>ç”¨é€”ï¼š</strong> å¸¸è§äºæ— çº¿é€šä¿¡ç³»ç»Ÿï¼Œå¦‚ CDMAï¼ˆCode Division Multiple Accessï¼‰ç³»ç»Ÿã€‚</li></ul></li></ol><h1 id="æ•°æ®é“¾è·¯å±‚"><a href="#æ•°æ®é“¾è·¯å±‚" class="headerlink" title="æ•°æ®é“¾è·¯å±‚"></a>æ•°æ®é“¾è·¯å±‚</h1><h2 id="åŸºæœ¬æ¦‚å¿µ-1"><a href="#åŸºæœ¬æ¦‚å¿µ-1" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>è¦è§£å†³çš„é—®é¢˜ï¼š</p><ul><li>æ ‡è¯†ç½‘ç»œä¸­å„ä¸ªä¸»æœº</li><li>ä»ä¿¡å·ä¸­åŒºåˆ†å‡ºåœ°å€å’Œæ•°æ®ä¿¡æ¯</li><li>å®ç°<strong>ä¸€ä¸ªç½‘ç»œ</strong>ä¹‹é—´çš„<strong>ç›¸äº’é€šä¿¡</strong></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231119155147938.png" alt="image-20231119155147938"></p><ul><li><code>é“¾è·¯(Link)</code>ï¼šæŒ‡ä»ä¸€ä¸ªç»“ç‚¹åˆ°ç›¸é‚»ç»“ç‚¹çš„ä¸€æ®µç‰©ç†çº¿è·¯,è€Œä¸­é—´æ²¡æœ‰ä»»ä½•å…¶ä»–çš„äº¤æ¢ç»“ç‚¹ã€‚</li><li><code>æ•°æ®é“¾è·¯(DataLink)</code>ï¼šæŒ‡æŠŠå®ç°é€šä¿¡åè®®çš„ç¡¬ä»¶å’Œè½¯ä»¶åŠ åˆ°é“¾è·¯ä¸Š,å°±æ„æˆäº†æ•°æ®é“¾è·¯ã€‚</li><li><strong>æ•°æ®é“¾è·¯å±‚</strong>ä»¥<code>å¸§</code>ä¸ºå•ä½ä¼ è¾“å’Œå¤„ç†æ•°æ®ã€‚</li></ul><h2 id="ä¸‰ä¸ªé‡è¦é—®é¢˜"><a href="#ä¸‰ä¸ªé‡è¦é—®é¢˜" class="headerlink" title="ä¸‰ä¸ªé‡è¦é—®é¢˜"></a>ä¸‰ä¸ªé‡è¦é—®é¢˜</h2><p>æ•°æ®é“¾è·¯å±‚ä¼ é€çš„åè®®æ•°æ®å•å…ƒæ˜¯<strong>å¸§</strong></p><ol><li><strong>å°è£…æˆå¸§</strong></li></ol><ul><li><strong>å°è£…æˆå¸§</strong> (framing) å°±æ˜¯åœ¨ä¸€æ®µæ•°æ®çš„å‰ååˆ†åˆ«æ·»åŠ é¦–éƒ¨å’Œå°¾éƒ¨ï¼Œç„¶åå°±æ„æˆäº†ä¸€ä¸ªå¸§ã€‚</li><li>é¦–éƒ¨å’Œå°¾éƒ¨çš„ä¸€ä¸ªé‡è¦ä½œç”¨å°±æ˜¯è¿›è¡Œ<strong>å¸§å®šç•Œ</strong>ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201011103650253.png" alt="image-20201011103650253"></p><ol start="2"><li><strong>å·®é”™æ§åˆ¶</strong></li></ol><p>åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½ä¼šäº§ç”Ÿ<strong>æ¯”ç‰¹å·®é”™</strong>ï¼š1 å¯èƒ½ä¼šå˜æˆ 0ï¼Œ è€Œ 0 ä¹Ÿå¯èƒ½å˜æˆ 1ã€‚</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201011103917512.png" alt="image-20201011103917512"></p><ol start="3"><li><strong>å¯é ä¼ è¾“</strong></li></ol><p>æ¥æ”¶æ–¹ä¸»æœºæ”¶åˆ°æœ‰è¯¯ç çš„å¸§åï¼Œæ˜¯ä¸ä¼šæ¥å—è¯¥å¸§çš„ï¼Œä¼šå°†å®ƒä¸¢å¼ƒ</p><p>å¦‚æœæ•°æ®é“¾è·¯å±‚å‘å…¶ä¸Šå±‚æä¾›çš„æ˜¯ä¸å¯é æœåŠ¡ï¼Œé‚£ä¹ˆä¸¢å¼ƒå°±ä¸¢å¼ƒäº†ï¼Œä¸ä¼šå†æœ‰æ›´å¤šæªæ–½</p><p><strong>å¦‚æœæ•°æ®é“¾è·¯å±‚å‘å…¶ä¸Šå±‚æä¾›çš„æ˜¯å¯é æœåŠ¡ï¼Œé‚£å°±è¿˜éœ€è¦å…¶ä»–æªæ–½ï¼Œæ¥ç¡®ä¿æ¥æ”¶æ–¹ä¸»æœºè¿˜å¯ä»¥é‡æ–°æ”¶åˆ°è¢«ä¸¢å¼ƒçš„è¿™ä¸ªå¸§çš„æ­£ç¡®å‰¯æœ¬</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201011105314053.png" alt="image-20201011105314053"></p><blockquote><p>ä»¥ä¸Šä¸‰ä¸ªé—®é¢˜éƒ½æ˜¯ä½¿ç”¨<strong>ç‚¹å¯¹ç‚¹ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚</strong>æ¥ä¸¾ä¾‹çš„</p></blockquote><p><strong>æ•°æ®é“¾è·¯å±‚ä½¿ç”¨çš„ä¿¡é“ï¼š</strong></p><p>æ•°æ®é“¾è·¯å±‚å±äºè®¡ç®—æœºç½‘è·¯çš„ä½å±‚ã€‚<strong>æ•°æ®é“¾è·¯å±‚ä½¿ç”¨çš„ä¿¡é“ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§ç±»å‹ï¼š</strong></p><ul><li>ç‚¹å¯¹ç‚¹ä¿¡é“</li><li>å¹¿æ’­ä¿¡é“</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201014004459744.png" alt="image-20201014004459744"></p><blockquote><p><strong>å±€åŸŸç½‘å±äºæ•°æ®é“¾è·¯å±‚</strong></p><p>å±€åŸŸç½‘è™½ç„¶æ˜¯ä¸ªç½‘ç»œã€‚ä½†æˆ‘ä»¬å¹¶ä¸æŠŠå±€åŸŸç½‘æ”¾åœ¨ç½‘ç»œå±‚ä¸­è®¨è®ºã€‚è¿™æ˜¯å› ä¸ºåœ¨ç½‘ç»œå±‚è¦è®¨è®ºçš„æ˜¯å¤šä¸ªç½‘ç»œäº’è¿çš„é—®é¢˜ï¼Œæ˜¯è®¨è®ºåˆ†ç»„æ€ä¹ˆä»ä¸€ä¸ªç½‘ç»œï¼Œé€šè¿‡è·¯ç”±å™¨ï¼Œè½¬å‘åˆ°å¦ä¸€ä¸ªç½‘ç»œã€‚</p><p>è€Œåœ¨åŒä¸€ä¸ªå±€åŸŸç½‘ä¸­ï¼Œåˆ†ç»„æ€ä¹ˆä»ä¸€å°ä¸»æœºä¼ é€åˆ°å¦ä¸€å°ä¸»æœºï¼Œä½†å¹¶ä¸ç»è¿‡è·¯ç”±å™¨è½¬å‘ã€‚ä»æ•´ä¸ªäº’è”ç½‘æ¥çœ‹ï¼Œ<strong>å±€åŸŸç½‘ä»å±äºæ•°æ®é“¾è·¯å±‚</strong>çš„èŒƒå›´</p></blockquote><p><strong>å¦‚æœä½¿ç”¨å¹¿æ’­ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚é™¤äº†åŒ…å«ä¸Šé¢ä¸‰ä¸ªé—®é¢˜å¤–ï¼Œè¿˜æœ‰ä¸€äº›é—®é¢˜è¦è§£å†³</strong></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œä¸»æœºAï¼ŒBï¼ŒCï¼ŒDï¼ŒEé€šè¿‡ä¸€æ ¹æ€»çº¿è¿›è¡Œäº’è¿ï¼Œä¸»æœºAè¦ç»™ä¸»æœºCå‘é€æ•°æ®ï¼Œä»£è¡¨å¸§çš„ä¿¡å·ä¼šé€šè¿‡æ€»çº¿ä¼ è¾“åˆ°æ€»çº¿ä¸Šçš„å…¶ä»–å„ä¸»æœºï¼Œé‚£ä¹ˆä¸»æœºBï¼ŒDï¼ŒEå¦‚ä½•çŸ¥é“æ‰€æ”¶åˆ°çš„å¸§ä¸æ˜¯å‘é€ç»™å¥¹ä»¬çš„ï¼Œä¸»æœºCå¦‚ä½•çŸ¥é“å‘é€çš„å¸§æ˜¯å‘é€ç»™è‡ªå·±çš„ï¼ˆ<mark>ä»ä¿¡å·ä¸­åŒºåˆ†å‡ºåœ°å€å’Œæ•°æ®ä¿¡æ¯çš„é—®é¢˜</mark>ï¼‰</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201011105824466.png" alt="image-20201011105824466"></p><p>å¯ä»¥ç”¨ç¼–å€ï¼ˆåœ°å€ï¼‰çš„æ¥è§£å†³</p><p>å°†å¸§çš„ç›®çš„åœ°å€æ·»åŠ åœ¨å¸§ä¸­ä¸€èµ·ä¼ è¾“</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201011110017415.png" alt="image-20201011110017415"></p><p>è¿˜æœ‰<mark>æ•°æ®ç¢°æ’é—®é¢˜</mark></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201011110129994.png" alt="image-20201011110129994"></p><blockquote><p>éšç€æŠ€æœ¯çš„å‘å±•ï¼Œäº¤æ¢æŠ€æœ¯çš„æˆç†Ÿï¼Œ</p><p>åœ¨ æœ‰çº¿ï¼ˆå±€åŸŸç½‘ï¼‰é¢†åŸŸ ä½¿ç”¨<strong>ç‚¹å¯¹ç‚¹é“¾è·¯</strong>å’Œ<strong>é“¾è·¯å±‚äº¤æ¢æœº</strong>çš„<strong>äº¤æ¢å¼å±€åŸŸç½‘</strong>å–ä»£äº†<del>å…±äº«å¼å±€åŸŸç½‘</del></p><p>åœ¨æ— çº¿å±€åŸŸç½‘ä¸­ä»ç„¶ä½¿ç”¨çš„æ˜¯å…±äº«ä¿¡é“æŠ€æœ¯</p></blockquote><h2 id="å°è£…æˆå¸§"><a href="#å°è£…æˆå¸§" class="headerlink" title="å°è£…æˆå¸§"></a>å°è£…æˆå¸§</h2><h3 id="åŸºæœ¬æ¦‚å¿µ-2"><a href="#åŸºæœ¬æ¦‚å¿µ-2" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><p>å°è£…æˆå¸§æ˜¯æŒ‡æ•°æ®é“¾è·¯å±‚ç»™ä¸Šå±‚äº¤ä»˜çš„åè®®æ•°æ®å•å…ƒ<mark>æ·»åŠ å¸§å¤´å’Œå¸§å°¾ä½¿ä¹‹æˆä¸ºå¸§</mark></p><ul><li><strong>å¸§å¤´å’Œå¸§å°¾ä¸­åŒ…å«æœ‰é‡è¦çš„<mark>æ§åˆ¶ä¿¡æ¯</mark>ã€‚</strong></li></ul><ul><li><strong>å¸§å¤´å’Œå¸§å°¾çš„ä½œç”¨ä¹‹ä¸€å°±æ˜¯<mark>å¸§å®šç•Œ</mark>ã€‚</strong></li></ul><p>é—®ï¼šæ¥æ”¶æ–¹çš„æ•°æ®é“¾è·¯å±‚å¦‚ä½•ä»ç‰©ç†å±‚äº¤ä»˜çš„æ¯”ç‰¹æµä¸­æå–å‡ºä¸€ä¸ªä¸ªçš„å¸§ï¼Ÿ</p><p>ç­”ï¼šå¸§å®šç•Œã€‚</p><p>ä¾‹å¦‚PPPå¸§ä¸­çš„å¸§å¤´å’Œå¸§å°¾éƒ½ä¼šæœ‰æ ‡å¿—ç¬¦ã€‚</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201011111334052.png" alt="image-20201011111334052"></p><p>ä½†æ¯”ä¸æ˜¯æ¯ä¸€ç§æ•°æ®é“¾è·¯å±‚åè®®çš„å¸§éƒ½åŒ…å«æœ‰å¸§å®šç•Œæ ‡å¿—ï¼Œä¾‹å¦‚ä¸‹é¢ä¾‹å­</p><p>â­â­â­<strong>MACå¸§çš„æ ¼å¼ï¼š</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201011111729324.png" alt="image-20201011111729324"></p><blockquote><p>å‰å¯¼ç </p><ul><li>å‰åŒæ­¥ç ï¼šä½œç”¨æ˜¯ä½¿æ¥æ”¶æ–¹çš„æ—¶é’ŸåŒæ­¥</li><li>å¸§å¼€å§‹å®šç•Œç¬¦ï¼šè¡¨æ˜å…¶åé¢ç´§è·Ÿç€çš„å°±æ˜¯MACå¸§</li></ul></blockquote><p>å¦å¤–ä»¥å¤ªç½‘è¿˜è§„å®šäº†å¸§é—´é—´éš”ä¸º96æ¯”ç‰¹æ—¶é—´ï¼Œå› æ­¤ï¼ŒMACå¸§ä¸éœ€è¦å¸§ç»“æŸå®šç•Œç¬¦</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201011112450187.png" alt="image-20201011112450187"></p><h3 id="é€æ˜ä¼ è¾“"><a href="#é€æ˜ä¼ è¾“" class="headerlink" title="é€æ˜ä¼ è¾“"></a>é€æ˜ä¼ è¾“</h3><p>é€æ˜ä¼ è¾“ï¼šæŒ‡æ•°æ®é“¾è·¯å±‚å¯¹ä¸Šå±‚äº¤ä»˜çš„ä¼ è¾“æ•°æ®<strong>æ²¡æœ‰ä»»ä½•é™åˆ¶</strong>,å°±å¥½åƒæ•°æ®é“¾è·¯å±‚ä¸å­˜åœ¨ä¸€æ ·ã€‚</p><ol><li>é¢å‘å­—èŠ‚çš„ç‰©ç†é“¾è·¯ä½¿ç”¨å­—èŠ‚å¡«å……å®ç°</li></ol><blockquote><p>åœ¨æ¯ä¸ªæ ‡å¿—å­—ç¬¦å’Œè½¬ä¹‰å­—ç¬¦å‰éƒ½åŠ ä¸Šä¸€ä¸ªè½¬ä¹‰å­—ç¬¦ï¼Œè®©æ¥æ”¶æ–¹è®¤ä¸ºå…¶æ˜¯æ•°æ®è€Œä¸æ˜¯ç»“æŸæ ‡å¿—</p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.4zvllsddnng0.webp" alt="image"></p><ol start="2"><li>é¢å‘æ¯”ç‰¹çš„ç‰©ç†é“¾è·¯ä½¿ç”¨æ¯”ç‰¹å¡«å……å®ç°</li></ol><blockquote><p>ä¾‹å¦‚åœ¨æ²¡è¿ç»­5ä¸ª1ä¹‹åæ·»åŠ ä¸€ä¸ª0æ¥é¿å…å‡ºç°ä¸å¸§å¤´å’Œå¸§å°¾å†²çªçš„æƒ…å†µ</p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.56uvouiuuaw0.webp" alt="image"></p><h3 id="å¸§çš„æ•°æ®éƒ¨åˆ†é•¿åº¦"><a href="#å¸§çš„æ•°æ®éƒ¨åˆ†é•¿åº¦" class="headerlink" title="å¸§çš„æ•°æ®éƒ¨åˆ†é•¿åº¦"></a>å¸§çš„æ•°æ®éƒ¨åˆ†é•¿åº¦</h3><p>ä¸ºäº†æé«˜<strong>å¸§çš„ä¼ è¾“æ•ˆç‡</strong>,åº”å½“ä½¿å¸§çš„<mark><strong>æ•°æ®éƒ¨åˆ†çš„é•¿åº¦</strong>å°½å¯èƒ½å¤§äº›</mark>ã€‚</p><p>è€ƒè™‘åˆ°å·®é”™æ§åˆ¶ç­‰å¤šç§å› ç´ ,æ¯ä¸€ç§æ•°æ®é“¾è·¯å±‚åè®®éƒ½è§„å®šäº†å¸§çš„æ•°æ®éƒ¨åˆ†çš„é•¿åº¦ä¸Šé™,å³**æœ€å¤§ä¼ é€å•å…ƒMTU (Maximum Transfer Unit)**ã€‚</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.702czciz8940.webp" alt="image"></p><h2 id="å·®é”™æ£€æµ‹"><a href="#å·®é”™æ£€æµ‹" class="headerlink" title="å·®é”™æ£€æµ‹"></a>å·®é”™æ£€æµ‹</h2><h3 id="åŸºæœ¬æ¦‚å¿µ-3"><a href="#åŸºæœ¬æ¦‚å¿µ-3" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><ul><li>å®é™…çš„é€šä¿¡é“¾è·¯éƒ½ä¸æ˜¯ç†æƒ³çš„ï¼Œæ¯”ç‰¹åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½ä¼šäº§ç”Ÿå·®é”™ï¼š1å¯èƒ½ä¼šå˜æˆ0ï¼Œè€Œ0ä¹Ÿå¯èƒ½å˜æˆ1ã€‚è¿™ç§°ä¸º<mark>æ¯”ç‰¹å·®é”™</mark></li><li>åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œä¼ è¾“é”™è¯¯çš„æ¯”ç‰¹å æ‰€ä¼ è¾“æ¯”ç‰¹æ€»æ•°çš„æ¯”ç‡ç§°ä¸ºè¯¯ç ç‡BER(Bit Error Rate).</li><li>ä½¿ç”¨<mark>å·®é”™æ£€æµ‹ç </mark>æ¥æ£€æµ‹æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦äº§ç”Ÿäº†æ¯”ç‰¹å·®é”™ï¼Œæ˜¯æ•°æ®é“¾è·¯å±‚æ‰€è¦è§£å†³çš„é‡è¦é—®é¢˜ä¹‹ä¸€</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231119163254347.png" alt="image-20231119163254347"></p><blockquote><p>å¦‚å›¾ä¸Šçš„å¸§å°¾éƒ½æœ‰FCSæ¥è¿›è¡Œæ£€æµ‹ï¼Œå¸§æ ¡éªŒåºåˆ— FCS æ˜¯æ·»åŠ åœ¨æ•°æ®åé¢çš„<mark>å†—ä½™ç </mark>æ¥è¿›è¡Œæ£€æµ‹</p></blockquote><h3 id="ä¸¤ç§æ ¡éªŒæ–¹å¼"><a href="#ä¸¤ç§æ ¡éªŒæ–¹å¼" class="headerlink" title="ä¸¤ç§æ ¡éªŒæ–¹å¼"></a>ä¸¤ç§æ ¡éªŒæ–¹å¼</h3><h4 id="å¥‡å¶æ ¡éªŒ"><a href="#å¥‡å¶æ ¡éªŒ" class="headerlink" title="å¥‡å¶æ ¡éªŒ"></a>å¥‡å¶æ ¡éªŒ</h4><ul><li>åœ¨å¾…å‘é€çš„æ•°æ®åé¢æ·»åŠ 1ä½å¥‡å¶æ ¡éªŒä½ï¼Œä½¿æ•´ä¸ªæ•°æ®(åŒ…æ‹¬æ‰€æ·»åŠ çš„æ ¡éªŒä½åœ¨å†…)ä¸­<mark>â€œ1â€çš„ä¸ªæ•°</mark>ä¸ºå¥‡æ•°(å¥‡æ ¡éªŒ)æˆ–å¶æ•°(å¶æ ¡éªŒ)</li><li>å¦‚æœæœ‰<strong>å¥‡æ•°ä¸ªä½å‘ç”Ÿè¯¯ç </strong>ï¼Œåˆ™å¥‡å¶æ€§å‘ç”Ÿå˜åŒ–ï¼Œ<strong>å¯ä»¥æ£€æŸ¥å‡ºè¯¯ç </strong></li><li>å¦‚æœæœ‰<strong>å¶æ•°ä¸ªä½å‘ç”Ÿè¯¯ç </strong>ï¼Œåˆ™å¥‡å¶æ€§ä¸å‘ç”Ÿå˜åŒ–ï¼Œ<strong>ä¸èƒ½æ£€æŸ¥å‡ºè¯¯ç (<mark>æ¼æ£€</mark>)</strong>;</li></ul><blockquote><p>æ¼æ£€çš„æ¦‚ç‡å¾ˆå¤§ï¼Œæ‰€ä»¥ä¸é‡‡ç”¨</p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231119163759281.png" alt="image-20231119163759281"></p><h4 id="å¾ªç¯å†—ä½™æ ¡éªŒCRC-Cyclic-Redundancy-Check-â­â­â­"><a href="#å¾ªç¯å†—ä½™æ ¡éªŒCRC-Cyclic-Redundancy-Check-â­â­â­" class="headerlink" title="å¾ªç¯å†—ä½™æ ¡éªŒCRC(Cyclic Redundancy Check)â­â­â­"></a>å¾ªç¯å†—ä½™æ ¡éªŒCRC(Cyclic Redundancy Check)â­â­â­</h4><ul><li>æ”¶å‘åŒæ–¹çº¦å®šå¥½ä¸€ä¸ªç”Ÿæˆå¤šé¡¹å¼G(x)ï¼›</li><li>å‘é€æ–¹åŸºäºå¾…å‘é€çš„æ•°æ®å’Œç”Ÿæˆå¤šé¡¹å¼è®¡ç®—å‡ºå·®é”™æ£€æµ‹ç ï¼ˆå†—ä½™ç ï¼‰ï¼Œå°†å…¶æ·»åŠ åˆ°å¾…ä¼ è¾“æ•°æ®çš„åé¢ä¸€èµ·ä¼ è¾“ï¼›</li><li>æ¥æ”¶æ–¹é€šè¿‡ç”Ÿæˆå¤šé¡¹å¼æ¥è®¡ç®—æ”¶åˆ°çš„æ•°æ®æ˜¯å¦äº§ç”Ÿäº†è¯¯ç ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231119164219319.png" alt="image-20231119164219319"></p><p><strong>ä¸¾ä¾‹è¯´æ˜ï¼š</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201011234701845-170038338842625.png" alt="image-20201011234701845"></p><p><strong>ä¾‹é¢˜ï¼š</strong></p><blockquote><p>å‘é€æ–¹</p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231119164816418.png" alt="image-20231119164816418"></p><hr><blockquote><p>æ¥æ”¶æ–¹</p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201011235325022-170038338842627.png" alt="image-20201011235325022"></p><hr><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li>æ£€é”™ç åªèƒ½æ£€æµ‹å‡ºå¸§åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å‡ºç°äº†å·®é”™ï¼Œä½†å¹¶ä¸èƒ½å®šä½é”™è¯¯ï¼Œå› æ­¤<mark>æ— æ³•çº æ­£é”™è¯¯</mark>ã€‚</li><li>è¦æƒ³çº æ­£ä¼ è¾“ä¸­çš„å·®é”™ï¼Œå¯ä»¥ä½¿ç”¨å†—ä½™ä¿¡æ¯æ›´å¤šçš„<mark>çº é”™ç è¿›è¡Œå‰å‘çº é”™</mark>ã€‚ä½†çº é”™ç çš„å¼€é”€æ¯”è¾ƒå¤§ï¼Œåœ¨è®¡ç®—æœºç½‘ç»œä¸­<mark>è¾ƒå°‘ä½¿ç”¨</mark>ã€‚</li><li>å¾ªç¯å†—ä½™æ ¡éªŒ<strong>CRC</strong>æœ‰å¾ˆå¥½çš„æ£€é”™èƒ½åŠ›(<mark>æ¼æ£€ç‡éå¸¸ä½</mark>)ï¼Œè™½ç„¶è®¡ç®—æ¯”è¾ƒå¤æ‚ï¼Œä½†éå¸¸æ˜“äºç”¨ç¡¬ä»¶å®ç°ï¼Œå› æ­¤è¢«<mark>å¹¿æ³›åº”ç”¨</mark>äºæ•°æ®é“¾è·¯å±‚ã€‚</li><li>åœ¨è®¡ç®—æœºç½‘ç»œä¸­é€šå¸¸é‡‡ç”¨æˆ‘ä»¬åç»­è¯¾ç¨‹ä¸­å°†è¦è®¨è®ºçš„<mark>æ£€é”™é‡ä¼ æ–¹å¼æ¥çº æ­£ä¼ è¾“ä¸­çš„å·®é”™æˆ–è€…ä»…ä»…æ˜¯ä¸¢å¼ƒæ£€æµ‹åˆ°å·®é”™çš„å¸§</mark>ï¼Œè¿™å–å†³äºæ•°æ®é“¾è·¯å±‚å‘å…¶ä¸Šå±‚æä¾›çš„æ˜¯å¯é ä¼ è¾“æœåŠ¡è¿˜æ˜¯ä¸å¯é ä¼ è¾“æœåŠ¡ã€‚</li></ul><h2 id="å¯é ä¼ è¾“"><a href="#å¯é ä¼ è¾“" class="headerlink" title="å¯é ä¼ è¾“"></a>å¯é ä¼ è¾“</h2><h3 id="åŸºæœ¬æ¦‚å¿µ-4"><a href="#åŸºæœ¬æ¦‚å¿µ-4" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><ul><li>ä½¿ç”¨<mark>å·®é”™æ£€æµ‹æŠ€æœ¯</mark>(ä¾‹å¦‚å¾ªç¯å†—ä½™æ ¡éªŒCRC)ï¼Œå¯ä»¥æ£€æµ‹<strong>æ˜¯å¦äº§ç”Ÿäº†è¯¯ç </strong>(æ¯”ç‰¹é”™è¯¯)ã€‚</li></ul><p><strong>æ•°æ®é“¾è·¯å±‚å‘ä¸Šå±‚æä¾›çš„æœåŠ¡ç±»å‹ï¼š</strong></p><ol><li><p>ä¸å¯é ä¼ è¾“æœåŠ¡ï¼šä»…ä»…<mark>ä¸¢å¼ƒ</mark>æœ‰è¯¯ç çš„å¸§ï¼Œå…¶ä»–ä»€ä¹ˆä¹Ÿä¸åšï¼›</p></li><li><p>å¯é ä¼ è¾“æœåŠ¡ï¼š<mark>æƒ³åŠæ³•å®ç°å‘é€ç«¯å‘é€ä»€ä¹ˆï¼Œæ¥æ”¶ç«¯å°±æ¥æ”¶ä»€ä¹ˆ</mark>ã€‚</p></li></ol><hr><ul><li><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<code>æœ‰çº¿é“¾è·¯çš„è¯¯ç ç‡æ¯”è¾ƒä½</code>ï¼Œä¸ºäº†å‡å°å¼€é”€ï¼Œå¹¶<code>ä¸è¦æ±‚</code>æ•°æ®é“¾è·¯å±‚å‘ä¸Šæä¾›å¯é ä¼ è¾“æœåŠ¡ã€‚å³ä½¿å‡ºç°äº†è¯¯ç ï¼Œå¯é ä¼ è¾“çš„é—®é¢˜ç”±å…¶ä¸Šå±‚å¤„ç†ã€‚</p></li><li><p><code>æ— çº¿é“¾è·¯</code>æ˜“å—å¹²æ‰°ï¼Œè¯¯ç ç‡æ¯”è¾ƒé«˜ï¼Œå› æ­¤<code>è¦æ±‚</code>æ•°æ®é“¾è·¯å±‚å¿…é¡»å‘ä¸Šå±‚æä¾›å¯é ä¼ è¾“æœåŠ¡ã€‚</p></li></ul><hr><ul><li><mark>æ¯”ç‰¹å·®é”™</mark>åªæ˜¯ä¼ è¾“å·®é”™ä¸­çš„ä¸€ç§</li><li>ä»æ•´ä¸ªè®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„æ¥çœ‹ï¼Œä¼ è¾“å·®é”™è¿˜åŒ…æ‹¬<mark>åˆ†ç»„ä¸¢å¤±ã€åˆ†ç»„å¤±åºä»¥åŠåˆ†ç»„é‡å¤</mark>ã€‚</li></ul><hr><ul><li>åˆ†ç»„ä¸¢å¤±ã€åˆ†ç»„å¤±åºä»¥åŠåˆ†ç»„é‡å¤è¿™äº›ä¼ è¾“å·®é”™ï¼Œ<code>ä¸€èˆ¬ä¸ä¼šå‡ºç°åœ¨æ•°æ®é“¾è·¯å±‚</code>ï¼Œè€Œä¼šå‡ºç°åœ¨å…¶ä¸Šå±‚ã€‚</li><li>å¯é ä¼ è¾“æœåŠ¡å¹¶ä¸ä»…å±€é™äºæ•°æ®é“¾è·¯å±‚ï¼Œå…¶ä»–å„å±‚å‡å¯é€‰æ‹©å®ç°<code>å¯é ä¼ è¾“</code>ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.56i9yun4fa40.webp" alt="image"></p><ul><li><strong>å¯é ä¼ è¾“çš„å®ç°æ¯”è¾ƒå¤æ‚ï¼Œå¼€é”€ä¹Ÿæ¯”è¾ƒå¤§</strong>ï¼Œ<mark>æ˜¯å¦ä½¿ç”¨å¯é ä¼ è¾“å–å†³äºåº”ç”¨éœ€æ±‚</mark>ã€‚</li></ul><h3 id="ä¸‰ç§å¯é åè®®"><a href="#ä¸‰ç§å¯é åè®®" class="headerlink" title="ä¸‰ç§å¯é åè®®"></a>ä¸‰ç§å¯é åè®®</h3><p><strong>æ³¨æ„ï¼š</strong></p><p>è¿™ä¸‰ç§å¯é ä¼ è¾“å®ç°æœºåˆ¶çš„åŸºæœ¬åŸç†å¹¶ä¸ä»…é™äºæ•°æ®é“¾è·¯å±‚ï¼Œå¯ä»¥<mark>åº”ç”¨åˆ°è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„çš„å„å±‚åè®®</mark></p><h4 id="åœæ­¢-ç­‰å¾…åè®®SW"><a href="#åœæ­¢-ç­‰å¾…åè®®SW" class="headerlink" title="åœæ­¢-ç­‰å¾…åè®®SW"></a>åœæ­¢-ç­‰å¾…åè®®SW</h4><h5 id="åœæ­¢-ç­‰å¾…åè®®å¯èƒ½é‡åˆ°çš„å››ä¸ªé—®é¢˜"><a href="#åœæ­¢-ç­‰å¾…åè®®å¯èƒ½é‡åˆ°çš„å››ä¸ªé—®é¢˜" class="headerlink" title="åœæ­¢-ç­‰å¾…åè®®å¯èƒ½é‡åˆ°çš„å››ä¸ªé—®é¢˜"></a>åœæ­¢-ç­‰å¾…åè®®å¯èƒ½é‡åˆ°çš„<mark><strong>å››ä¸ªé—®é¢˜</strong></mark></h5><ol><li><strong>ç¡®è®¤ä¸å¦è®¤</strong></li></ol><img src="../assets/è®¡ç®—æœºç½‘ç»œ/image-20201012162009780.png" alt="image-20201012162009780" style="zoom:67%;" /><ol start="2"><li><strong>è¶…æ—¶é‡ä¼ </strong></li></ol><img src="../assets/è®¡ç®—æœºç½‘ç»œ/image-20201012162112151.png" alt="image-20201012162112151" style="zoom:67%;" /><ol start="3"><li><strong>ç¡®è®¤ä¸¢å¤±</strong></li></ol><img src="../assets/è®¡ç®—æœºç½‘ç»œ/image-20201012162318298.png" alt="image-20201012162318298" style="zoom:67%;" /><img src="../assets/è®¡ç®—æœºç½‘ç»œ/image-20201012162348428.png" alt="image-20201012162348428" style="zoom:67%;" /><blockquote><p>é—®ï¼šæ—¢ç„¶æ•°æ®åˆ†ç»„éœ€è¦ç¼–å·ï¼Œç¡®è®¤åˆ†ç»„æ˜¯å¦éœ€è¦ç¼–å·ï¼Ÿ</p><p>ç­”ï¼šè¦ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p></blockquote><ol start="4"><li><strong>ç¡®è®¤è¿Ÿåˆ°</strong></li></ol><img src="../assets/è®¡ç®—æœºç½‘ç»œ/image-20201012162815885.png" alt="image-20201012162815885" style="zoom:67%;" /><blockquote><p>æ³¨æ„ï¼Œå›¾ä¸­æœ€ä¸‹é¢é‚£ä¸ªæ•°æ®åˆ†ç»„ä¸ä¹‹å‰åºå·ä¸º0çš„é‚£ä¸ªæ•°æ®åˆ†ç»„ä¸æ˜¯åŒä¸€ä¸ªæ•°æ®åˆ†ç»„</p></blockquote><p>ğŸŒˆ<strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p><ul><li>æ¥æ”¶ç«¯æ£€æµ‹åˆ°æ•™æ®åˆ†ç»„æœ‰è¯¯ç æ—¶ï¼Œå°†å…¶ä¸¢å¼ƒå¹¶ç­‰å¾…å‘é€æ–¹çš„è¶…æ—¶é‡ä¼ ã€‚ä½†å¯¹äºè¯¯ç ç‡è¾ƒé«˜çš„ç‚¹å¯¹ç‚¹é“¾è·¯ï¼Œä¸ºä½¿å‘é€æ–¹<mark>å°½æ—©é‡ä¼ </mark>ï¼Œä¹Ÿå¯<mark>ç»™å‘é€æ–¹å‘é€NAKåˆ†ç»„</mark></li><li>ä¸ºäº†è®©æ¥æ”¶æ–¹èƒ½å¤Ÿåˆ¤æ–­æ‰€æ”¶åˆ°çš„æ•°æ®åˆ†ç»„æ˜¯å¦æ˜¯é‡å¤çš„ï¼Œéœ€è¦ç»™<mark>æ•°æ®åˆ†ç»„ç¼–å·</mark>ï¼Œç”±äºåœæ­¢-ç­‰å¾…åè®®çš„åœç­‰ç‰¹æ€§ï¼Œ<mark>åªéœ€1ä¸ªæ¯”ç‰¹ç¼–å·</mark>å°±å¤Ÿäº†ï¼Œå³ç¼–å·0å’Œ1ã€‚</li><li>ä¸ºäº†è®©å‘é€æ–¹èƒ½å¤Ÿåˆ¤æ–­æ‰€æ”¶åˆ°çš„ACKåˆ†ç»„æ˜¯å¦æ˜¯é‡å¤çš„ï¼Œéœ€è¦ç»™ACKåˆ†ç»„ç¼–å·ï¼Œæ‰€ç”¨æ¯”ç‰¹æ•°é‡ä¸æ•°æ®åˆ†ç»„ç¼–å·æ‰€ç”¨æ¯”ç‰¹æ•°é‡ä¸€æ ·ï¼Œ<mark>æ•°æ®é“¾è·¯å±‚ä¸€èˆ¬ä¸ä¼šå‡ºç°ACKåˆ†ç»„è¿Ÿåˆ°çš„æƒ…å†µï¼Œå› æ­¤åœ¨æ•°æ®é“¾è·¯å±‚å®ç°åœæ­¢-ç­‰å¾…åè®®å¯ä»¥ä¸ç”¨ç»™ACKåˆ†ç»„ç¼–å·ã€‚</mark></li><li>è¶…æ—¶è®¡æ—¶å™¨è®¾ç½®çš„é‡ä¼ æ—¶é—´åº”ä»”ç»†é€‰æ‹©ã€‚ä¸€èˆ¬å¯å°†é‡ä¼ æ—¶é—´é€‰ä¸º<mark>ç•¥å¤§äºâ€œä»å‘é€æ–¹åˆ°æ¥æ”¶æ–¹çš„å¹³å‡å¾€è¿”æ—¶é—´â€</mark><ul><li>åœ¨æ•°æ®é“¾è·¯å±‚ç‚¹å¯¹ç‚¹çš„å¾€è¿”æ—¶é—´æ¯”è¾ƒç¡®å®šï¼Œé‡ä¼ æ—¶é—´æ¯”è¾ƒå¥½è®¾å®šã€‚</li><li>ç„¶è€Œåœ¨è¿è¾“å±‚ï¼Œç”±äºç«¯åˆ°ç«¯å¾€è¿”æ—¶é—´éå¸¸ä¸ç¡®å®šï¼Œè®¾ç½®åˆé€‚çš„é‡ä¼ æ—¶é—´æœ‰æ—¶å¹¶ä¸å®¹æ˜“</li></ul></li></ul><hr><h5 id="åœæ­¢-ç­‰å¾…åè®®çš„ä¿¡é“åˆ©ç”¨ç‡"><a href="#åœæ­¢-ç­‰å¾…åè®®çš„ä¿¡é“åˆ©ç”¨ç‡" class="headerlink" title="åœæ­¢-ç­‰å¾…åè®®çš„ä¿¡é“åˆ©ç”¨ç‡"></a>åœæ­¢-ç­‰å¾…åè®®çš„<mark><strong>ä¿¡é“åˆ©ç”¨ç‡</strong></mark></h5><p>å‡è®¾æ”¶å‘åŒæ–¹ä¹‹é—´æ˜¯ä¸€æ¡ç›´é€šçš„ä¿¡é“</p><ul><li><strong>TD</strong>ï¼šæ˜¯å‘é€æ–¹å‘é€æ•°æ®åˆ†ç»„æ‰€è€—è´¹çš„å‘é€æ—¶å»¶</li><li><strong>RTT</strong>ï¼šæ˜¯æ”¶å‘åŒæ–¹ä¹‹é—´çš„å¾€è¿”æ—¶é—´</li><li><strong>TA</strong>ï¼šæ˜¯æ¥æ”¶æ–¹å‘é€ç¡®è®¤åˆ†ç»„æ‰€è€—è´¹çš„å‘é€æ—¶å»¶</li></ul><p>TAä¸€èˆ¬éƒ½è¿œå°äºTDï¼Œå¯ä»¥å¿½ç•¥ï¼Œå½“RTTè¿œå¤§äºTDæ—¶ï¼Œä¿¡é“åˆ©ç”¨ç‡ä¼šéå¸¸ä½</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201012164924635.png" alt="image-20201012164924635"></p><ul><li><strong>å½“å¾€è¿”æ—¶å»¶RTTè¿œå¤§äºæ•°æ®å¸§å‘é€æ—¶å»¶T<del>D</del>æ—¶(ä¾‹å¦‚ä½¿ç”¨å«æ˜Ÿé“¾è·¯)ï¼Œä¿¡é“åˆ©ç”¨ç‡éå¸¸ä½ã€‚</strong></li><li>è‹¥å‡ºç°é‡ä¼ ï¼Œåˆ™å¯¹äºä¼ é€æœ‰ç”¨çš„æ•°æ®ä¿¡æ¯æ¥è¯´ï¼Œä¿¡é“åˆ©ç”¨ç‡è¿˜è¦é™ä½ã€‚</li><li>ä¸ºäº†å…‹æœåœæ­¢-ç­‰å¾…åè®®ä¿¡é“åˆ©ç”¨ç‡å¾ˆä½çš„ç¼ºç‚¹ï¼Œå°±äº§ç”Ÿäº†å¦å¤–ä¸¤ç§åè®®ï¼Œå³åé€€Nå¸§åè®®GBNå’Œé€‰æ‹©é‡ä¼ åè®®SRã€‚</li></ul><blockquote><p>åƒåœæ­¢-ç­‰å¾…åè®®è¿™æ ·é€šè¿‡ç¡®è®¤å’Œé‡ä¼ æœºåˆ¶å®ç°çš„å¯é ä¼ è¾“åè®®ï¼Œå¸¸ç§°ä¸ºè‡ªåŠ¨è¯·æ±‚é‡ä¼ åè®®ARQ(<strong>A</strong>utomatic <strong>R</strong>epeat re<strong>Q</strong>uest)ï¼Œæ„æ€æ˜¯é‡ä¼ çš„è¯·æ±‚æ˜¯è‡ªåŠ¨è¿›è¡Œï¼Œå› ä¸ºä¸éœ€è¦æ¥æ”¶æ–¹æ˜¾å¼åœ°è¯·æ±‚ï¼Œå‘é€æ–¹é‡ä¼ æŸä¸ªå‘é€çš„åˆ†ç»„</p></blockquote><h4 id="å›é€€Nå¸§åè®®GBN"><a href="#å›é€€Nå¸§åè®®GBN" class="headerlink" title="å›é€€Nå¸§åè®®GBN"></a>å›é€€Nå¸§åè®®GBN</h4><h5 id="ä¸ºä»€ä¹ˆç”¨å›é€€Nå¸§åè®®"><a href="#ä¸ºä»€ä¹ˆç”¨å›é€€Nå¸§åè®®" class="headerlink" title="ä¸ºä»€ä¹ˆç”¨å›é€€Nå¸§åè®®"></a>ä¸ºä»€ä¹ˆç”¨å›é€€Nå¸§åè®®</h5><p>åœ¨ç›¸åŒçš„æ—¶é—´å†…ï¼Œä½¿ç”¨åœæ­¢-ç­‰å¾…åè®®çš„å‘é€æ–¹åªèƒ½å‘é€ä¸€ä¸ªæ•°æ®åˆ†ç»„ï¼Œè€Œé‡‡ç”¨æµæ°´çº¿ä¼ è¾“çš„å‘é€æ–¹ï¼Œå¯ä»¥å‘é€å¤šä¸ªæ•°æ®åˆ†ç»„</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201012190027828.png" alt="image-20201012190027828"></p><p>å›é€€Nå¸§åè®®åœ¨æµæ°´çº¿ä¼ è¾“çš„åŸºç¡€ä¸Šï¼Œ<mark>åˆ©ç”¨å‘é€çª—å£æ¥é™åˆ¶å‘é€æ–¹å¯è¿ç»­å‘é€æ•°æ®åˆ†ç»„çš„ä¸ªæ•°</mark></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201012190632086.png" alt="image-20201012190632086"></p><h5 id="æ— å·®é”™æƒ…å†µæµç¨‹"><a href="#æ— å·®é”™æƒ…å†µæµç¨‹" class="headerlink" title="æ— å·®é”™æƒ…å†µæµç¨‹"></a>æ— å·®é”™æƒ…å†µ<mark>æµç¨‹</mark></h5><blockquote><p>ä¸€å¥è¯æ€»ç»“æµç¨‹ï¼šç±»ä¼¼äº<mark>æ»‘åŠ¨çª—å£</mark>ï¼Œå‘é€æ–¹åªèƒ½åœ¨å‘é€çª—å£å†…å‘é€åˆ†ç»„ï¼Œæ¥æ”¶æ–¹çš„çª—å£å¤§å°åªèƒ½ä¸º1ï¼Œæ¥å—åˆ°ä¸€ä¸ªå®Œæ•´çš„æ— å—æŸçš„åˆ†ç»„ï¼Œæ¥æ”¶æ–¹çš„çª—å£å°±å¯ä»¥åç§»ä»¥åŒ¹é…ä¸‹ä¸€ä¸ªåºå·ä¸Šçš„åˆ†ç»„ï¼ŒåŒæ—¶æ¥æ”¶æ–¹è¿˜è¦å‘é€ç¡®è®¤åˆ†ç»„ï¼Œå‘é€æ–¹æ”¶åˆ°ç¡®è®¤åˆ†ç»„ä¹Ÿè¦å°†çª—å£å³ç§»ï¼Œæ¯”å¦‚è¿”å›AK<del>3</del>å°±ä»£è¡¨åºå·3ï¼ˆåŒ…æ‹¬3ï¼‰çš„ä½ç½®çš„åˆ†ç»„éƒ½å·²ç»æˆåŠŸæ¥æ”¶äº†ï¼Œæ­¤æ—¶å¯ä»¥å³ç§»åˆ°åºå·3åçš„ä½ç½®ã€‚</p></blockquote><p>å‘é€æ–¹å°†åºå·è½åœ¨å‘é€çª—å£å†…çš„0~4å·æ•°æ®åˆ†ç»„ï¼Œä¾æ¬¡è¿ç»­å‘é€å‡ºå»</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201012191936466.png" alt="image-20201012191936466"></p><p>ä»–ä»¬ç»è¿‡äº’è”ç½‘ä¼ è¾“æ­£ç¡®åˆ°è¾¾æ¥æ”¶æ–¹ï¼Œå°±æ˜¯æ²¡æœ‰ä¹±åºå’Œè¯¯ç ï¼Œæ¥æ”¶æ–¹æŒ‰åºæ¥æ”¶å®ƒä»¬ï¼Œæ¯æ¥æ”¶ä¸€ä¸ªï¼Œæ¥æ”¶çª—å£å°±å‘å‰æ»‘åŠ¨ä¸€ä¸ªä½ç½®ï¼Œå¹¶ç»™å‘é€æ–¹å‘é€é’ˆå¯¹æ‰€æ¥æ”¶åˆ†ç»„çš„ç¡®è®¤åˆ†ç»„ï¼Œåœ¨é€šè¿‡äº’è”ç½‘çš„ä¼ è¾“æ­£ç¡®åˆ°è¾¾äº†å‘é€æ–¹</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201012192932035.png" alt="image-20201012192932035"></p><p>å‘é€æ–¹æ¯æ¥æ”¶ä¸€ä¸ªã€å‘é€çª—å£å°±å‘å‰æ»‘åŠ¨ä¸€ä¸ªä½ç½®ï¼Œè¿™æ ·å°±æœ‰æ–°çš„åºå·è½å…¥å‘é€çª—å£ï¼Œå‘é€æ–¹å¯ä»¥å°†æ”¶åˆ°ç¡®è®¤çš„æ•°æ®åˆ†ç»„ä»ç¼“å­˜ä¸­åˆ é™¤äº†ï¼Œè€Œæ¥æ”¶æ–¹å¯ä»¥æ‹©æœºå°†å·²æ¥æ”¶çš„æ•°æ®åˆ†ç»„äº¤ä»˜ä¸Šå±‚å¤„ç†</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201012193212419.png" alt="image-20201012193212419"></p><h5 id="ç´¯ç§¯ç¡®è®¤"><a href="#ç´¯ç§¯ç¡®è®¤" class="headerlink" title="ç´¯ç§¯ç¡®è®¤"></a>ç´¯ç§¯ç¡®è®¤</h5><ol><li>æ¦‚å¿µï¼š</li></ol><p>æ¥æ”¶æ–¹ä¸ä¸€å®šè¦å¯¹æ”¶åˆ°çš„æ•°æ®åˆ†ç»„é€ä¸ªå‘é€ç¡®è®¤ï¼Œè€Œæ˜¯å¯ä»¥åœ¨æ”¶åˆ°å‡ ä¸ªæ•°æ®åˆ†ç»„å ï¼ˆç”±å…·ä½“å®ç°å†³å®šï¼‰å¯¹æŒ‰åºåˆ°è¾¾çš„æœ€åä¸€ä¸ªæ•°æ®åˆ†ç»„å‘é€ç¡®è®¤ã€‚ACK<del>n</del>è¡¨ç¤ºåºå·ä¸ºnåŠä»¥å‰çš„æ‰€æœ‰æ•°æ®åˆ†ç»„éƒ½å·²æ­£ç¡®æ¥æ”¶ã€‚</p><ol start="2"><li>ä¼˜ç¼ºç‚¹</li></ol><ul><li><p>ä¼˜ç‚¹:</p><ul><li>å³ä½¿ç¡®è®¤åˆ†ç»„ä¸¢å¤±ï¼Œå‘é€æ–¹ä¹Ÿå¯èƒ½ä¸å¿…é‡ä¼ </li><li>å‡å°æ¥æ”¶æ–¹çš„å¼€é”€</li><li>å‡å°å¯¹ç½‘ç»œèµ„æºçš„å ç”¨</li></ul></li><li><p>ç¼ºç‚¹ï¼š</p><ul><li>ä¸èƒ½å‘å‘é€æ–¹åŠæ—¶åæ˜ å‡ºæ¥æ”¶æ–¹å·²ç»æ­£ç¡®æ¥æ”¶çš„æ•°æ®åˆ†ç»„ä¿¡æ¯</li></ul></li></ul><h5 id="æœ‰å·®é”™æƒ…å†µ"><a href="#æœ‰å·®é”™æƒ…å†µ" class="headerlink" title="æœ‰å·®é”™æƒ…å†µ"></a>æœ‰å·®é”™æƒ…å†µ</h5><ol><li><strong>ä¼ è¾“è¿‡ç¨‹ä¸­å‡ºç°è¯¯ç </strong></li></ol><p>åœ¨ä¼ è¾“æ•°æ®åˆ†ç»„æ—¶ï¼Œ5å·æ•°æ®åˆ†ç»„å‡ºç°è¯¯ç ï¼Œæ¥æ”¶æ–¹é€šè¿‡æ•°æ®åˆ†ç»„ä¸­çš„æ£€é”™ç å‘ç°äº†é”™è¯¯</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201012195440780.png" alt="image-20201012195440780"></p><p>äºæ˜¯<mark>ä¸¢å¼ƒè¯¥åˆ†ç»„</mark>ï¼Œè€Œåç»­åˆ°è¾¾çš„è¿™å‰©ä¸‹å››ä¸ªåˆ†ç»„ä¸æ¥æ”¶çª—å£çš„åºå·ä¸åŒ¹é…</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201012195629368.png" alt="image-20201012195629368"></p><p>æ¥æ”¶æ–¹åŒæ ·ä¹Ÿä¸èƒ½æ¥æ”¶å®ƒä»¬ï¼Œå°†å®ƒä»¬<mark>ä¸¢å¼ƒ</mark>ï¼Œå¹¶å¯¹ä¹‹å‰æŒ‰åºæ¥æ”¶çš„æœ€åä¸€ä¸ªæ•°æ®åˆ†ç»„è¿›è¡Œç¡®è®¤ï¼Œå‘é€ACK4ï¼Œ<mark><strong>æ¯ä¸¢å¼ƒä¸€ä¸ªæ•°æ®åˆ†ç»„ï¼Œå°±å‘é€ä¸€ä¸ªACK4</strong></mark></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201012195836902.png" alt="image-20201012195836902"></p><p><mark>å½“æ”¶åˆ°é‡å¤çš„ACK4æ—¶ï¼Œå°±çŸ¥é“ä¹‹å‰æ‰€å‘é€çš„æ•°æ®åˆ†ç»„å‡ºç°äº†å·®é”™</mark>ï¼Œäºæ˜¯å¯ä»¥ä¸ç­‰è¶…æ—¶è®¡æ—¶å™¨è¶…æ—¶å°±ç«‹åˆ»å¼€å§‹é‡ä¼ ï¼Œå…·ä½“æ”¶åˆ°å‡ ä¸ªé‡å¤ç¡®è®¤å°±ç«‹åˆ»é‡ä¼ ï¼Œæ ¹æ®å…·ä½“å®ç°å†³å®š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201012200120166.png" alt="image-20201012200120166"></p><p> å¦‚æœæ”¶åˆ°è¿™4ä¸ªé‡å¤çš„ç¡®è®¤å¹¶ä¸ä¼šè§¦å‘å‘é€ç«‹åˆ»é‡ä¼ ï¼Œä¸€æ®µæ—¶é—´åã€‚è¶…æ—¶è®¡æ—¶å™¨è¶…æ—¶ï¼Œä¹Ÿä¼šå°†å‘é€çª—å£å†…ä»¥å‘é€è¿‡çš„è¿™äº›æ•°æ®åˆ†ç»„å…¨éƒ¨é‡ä¼ </p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201012200454557.png" alt="image-20201012200454557"></p><p>ä¾‹é¢˜ï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231121201715658.png" alt="image-20231121201715658"></p><ol start="2"><li><strong>è‹¥W<del>T</del>æˆ–è€…W<del>R</del>è¶…è¿‡å–å€¼èŒƒå›´ï¼Œä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µï¼Ÿï¼ˆåŒ…å«å›é€€Nå¸§å’Œé€‰æ‹©é‡ä¼ ï¼‰</strong></li></ol><p><mark><strong>æ¥æ”¶æ–¹æ— æ³•åˆ†è¾¨æ–°ã€æ—§æ•°æ®åˆ†ç»„</strong></mark></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231121204447408.png" alt="image-20231121204447408"></p><p>è¿™é‡Œ<mark><strong>æ‹¿åé¢çš„é€‰æ‹©é‡ä¼ çš„ä¾‹å­ä¸¾ä¾‹è¯´æ˜</strong></mark>ï¼š</p><p>â­â­â­<strong>å›ç­”ï¼š</strong></p><blockquote><p>å½“å‘é€æ–¹å‘é€äº†0åˆ°4åºå·çš„åˆ†ç»„ç»™æ¥æ”¶æ–¹ï¼Œæ¥æ”¶æ–¹éƒ½æ­£ç¡®åœ°æ¥æ”¶äº†ï¼Œå¹¶æŠŠæ»‘åŠ¨çª—å£å³ç§»äº†ï¼Œä½†æ˜¯åœ¨ç¡®è®¤åˆ†ç»„è¿”å›ç»™å‘é€æ–¹çš„æ—¶å€™åºå·ä¸º0çš„åˆ†ç»„ä¸¢å¤±äº†ï¼Œé‚£ä¹ˆæ­¤æ—¶ä¼šè®°å½•1åˆ°4æ˜¯æ­£ç¡®æ¥æ”¶äº†çš„ï¼Œé‚£ä¹ˆç­‰é‡ä¼ è®¡æ—¶å™¨è¶…æ—¶äº†ï¼Œå°±ä¼šé‡æ–°å‘é€0ä½ç½®çš„åˆ†ç»„ï¼Œä½†æ˜¯æ¥æ”¶æ–¹å¤„å·²ç»åç§»ï¼Œå› ä¸ºW<del>R</del>çš„é€‰æ‹©è¶…è¿‡äº†å–å€¼èŒƒå›´ï¼Œæ‰€ä»¥åœ¨æ–°çš„æ¥æ”¶çª—å£ä¸­åˆæ‰¾åˆ°äº†åºå·0çš„ä½ç½®ï¼Œé‚£ä¹ˆæ­¤æ—¶æ¥æ”¶æ–¹å°±åˆ†ä¸æ¸…å‰é¢çš„åºå·0å’Œæ­¤æ—¶çš„åºå·0ï¼Œå³æ¥æ”¶æ–¹æ— æ³•åˆ†è¾¨æ–°ã€æ—§æ•°æ®åˆ†ç»„</p></blockquote><p>ğŸ”´ğŸŸ¡ğŸŸ¢<strong>æ€»ç»“ï¼š</strong></p><ul><li>å›é€€Né¡¿åè®®åœ¨<mark>æµæ°´çº¿ä¼ è¾“çš„åŸºç¡€</mark>ä¸Š<mark>åˆ©ç”¨å‘é€çª—å£æ¥é™åˆ¶å‘é€æ–¹è¿ç»­å‘é€æ•°æ®åˆ†ç»„çš„æ•°é‡</mark>ï¼Œæ˜¯ä¸€ç§è¿ç»­ARQåè®®</li><li>åœ¨åè®®çš„å·¥ä½œè¿‡ç¨‹ä¸­å‘é€çª—å£å’Œæ¥æ”¶çª—å£ä¸æ–­å‘å‰æ»‘åŠ¨ï¼Œå› æ­¤è¿™ç±»åè®®åˆç§°ä¸º<mark><strong>æ»‘åŠ¨çª—å£åè®®</strong></mark></li><li>ç”±äºå›é€€Né¡¿åè®®çš„ç‰¹æ€§ï¼Œå½“é€šä¿¡çº¿è·¯è´¨é‡ä¸å¥½æ—¶ï¼Œå…¶ä¿¡é“åˆ©ç”¨ç‡å¹¶ä¸æ¯”åœæ­¢-ç­‰å¾…åè®®é«˜</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231121201901475.png" alt="image-20231121201901475"></p><h4 id="é€‰æ‹©é‡ä¼ åè®®SR"><a href="#é€‰æ‹©é‡ä¼ åè®®SR" class="headerlink" title="é€‰æ‹©é‡ä¼ åè®®SR"></a>é€‰æ‹©é‡ä¼ åè®®SR</h4><p>ğŸ”´ğŸŸ¡ğŸŸ¢<strong>ä¸€å¥è¯æ€»ç»“ï¼š</strong></p><blockquote><p>å…·ä½“æµç¨‹ä¸å›é€€Nå¸§åè®®ç±»ä¼¼ï¼Œåªæ˜¯é€‰æ‹©é‡ä¼ åè®®ä¸­ï¼Œåœ¨æ¥æ”¶æ—¶ä¸éœ€è¦æŒ‰åºæ¥æ”¶äº†ï¼Œ<mark>åªè¦è½åœ¨çª—å£å†…å°±èƒ½æ¥æ”¶</mark>ï¼Œ<mark>ä¾æ¬¡é€ä¸ª</mark>è¿”å›ç›¸åº”åºå·çš„ç¡®è®¤åˆ†ç»„ï¼Œä¸”å‘é€æ–¹åªé‡ä¼ æ²¡æœ‰è¢«æ­£ç¡®æ¥æ”¶çš„åˆ†ç»„ã€‚</p></blockquote><hr><ul><li><strong>å›é€€Nå¸§åè®®</strong>çš„æ¥æ”¶çª—å£å°ºå¯¸<strong>W<del>r</del>åªèƒ½ç­‰äº1</strong>ï¼Œ<strong>å› æ­¤æ¥æ”¶æ–¹åªèƒ½æŒ‰åºæ¥æ”¶æ­£ç¡®åˆ°è¾¾çš„æ•°æ®åˆ†ç»„</strong>ã€‚</li><li>ä¸€ä¸ªæ•°æ®åˆ†ç»„çš„è¯¯ç å°±ä¼šå¯¼è‡´å…¶åç»­å¤šä¸ªæ•°æ®åˆ†ç»„ä¸èƒ½è¢«æ¥æ”¶æ–¹æŒ‰åºæ¥æ”¶è€Œä¸¢å¼ƒ (å°½ç®¡å®ƒä»¬æ— ä¹±åºå’Œè¯¯ç )ã€‚è¿™å¿…ç„¶ä¼šé€ æˆå‘é€æ–¹å¯¹è¿™äº›æ•°æ®åˆ†ç»„çš„è¶…æ—¶é‡ä¼ ï¼Œæ˜¾ç„¶è¿™æ˜¯å¯¹é€šä¿¡<mark>èµ„æºçš„æå¤§æµªè´¹</mark>ã€‚</li><li>ä¸ºäº†è¿›ä¸€æ­¥æé«˜æ€§èƒ½ï¼Œå¯è®¾æ³•åªé‡ä¼ å‡ºç°è¯¯ç çš„æ•°æ®åˆ†ç»„ã€‚å› æ­¤ï¼Œæ¥æ”¶çª—å£çš„å°ºå¯¸<mark>W<del>R</del>ä¸åº”å†ç­‰äº1 (è€Œåº”å¤§äº1)</mark>ï¼Œä»¥ä¾¿<mark>æ¥æ”¶æ–¹å…ˆæ”¶ä¸‹å¤±åºåˆ°è¾¾ä½†æ— è¯¯ç å¹¶ä¸”åºå·è½åœ¨æ¥æ”¶çª—å£å†…çš„é‚£äº›æ•°æ®åˆ†ç»„</mark>ï¼Œç­‰åˆ°æ‰€ç¼ºåˆ†ç»„æ”¶é½åå†ä¸€å¹¶é€äº¤ä¸Šå±‚ã€‚è¿™å°±æ˜¯<mark>é€‰æ‹©é‡ä¼ åè®®</mark>ã€‚</li><li>æ³¨æ„:<ul><li><strong>é€‰æ‹©é‡ä¼ åè®®</strong>ä¸ºäº†ä½¿å‘é€æ–¹ä»…é‡ä¼ å‡ºç°å·®é”™çš„åˆ†ç»„ï¼Œæ¥æ”¶æ–¹<mark>ä¸èƒ½å†é‡‡ç”¨ç´¯ç§¯ç¡®è®¤</mark>ï¼Œè€Œéœ€è¦å¯¹æ¯ä¸ªæ­£ç¡®æ¥æ”¶åˆ°çš„æ•°æ®åˆ†ç»„è¿›è¡Œ<mark>é€ä¸€ç¡®è®¤!</mark></li></ul></li></ul><p>ä¾‹é¢˜ï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231121205516313.png" alt="image-20231121205516313"></p><h2 id="ç‚¹å¯¹ç‚¹åè®®PPP"><a href="#ç‚¹å¯¹ç‚¹åè®®PPP" class="headerlink" title="ç‚¹å¯¹ç‚¹åè®®PPP"></a>ç‚¹å¯¹ç‚¹åè®®PPP</h2><ul><li>ç‚¹å¯¹ç‚¹åè®®PPPï¼ˆPoint-to-Point Protocolï¼‰æ˜¯ç›®å‰<mark>ä½¿ç”¨æœ€å¹¿æ³›çš„ç‚¹å¯¹ç‚¹æ•°æ®é“¾è·¯å±‚åè®®</mark></li><li>PPPåè®®æ˜¯å› ç‰¹ç½‘å·¥ç¨‹ä»»åŠ¡ç»„IEIFåœ¨1992å¹´åˆ¶å®šçš„ã€‚ç»è¿‡1993å¹´å’Œ1994å¹´çš„ä¿®è®¢ï¼Œç°åœ¨çš„PPPåè®®å·²æˆä¸º<mark>å› ç‰¹ç½‘çš„æ­£å¼æ ‡å‡†</mark>[RFC1661ï¼ŒRFC1662]</li><li>æ•°æ®é“¾è·¯å±‚ä½¿ç”¨çš„ä¸€ç§åè®®ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ï¼šç®€å•ï¼›<mark>åªæ£€æµ‹å·®é”™ï¼Œè€Œä¸æ˜¯çº æ­£å·®é”™</mark>ï¼›ä¸ä½¿ç”¨åºå·ï¼Œä¹Ÿä¸è¿›è¡Œæµé‡æ§åˆ¶ï¼›å¯åŒæ—¶æ”¯æŒå¤šç§ç½‘ç»œå±‚åè®®</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201012210844629.png" alt="image-20201012210844629"></p><ul><li>PPPoE æ˜¯ä¸ºå®½å¸¦ä¸Šç½‘çš„ä¸»æœºä½¿ç”¨çš„é“¾è·¯å±‚åè®®</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201012211423528.png" alt="image-20201012211423528"></p><blockquote><p>æ‰¿ä¸Šå¯ä¸‹çš„ä½œç”¨</p></blockquote><h3 id="å¸§æ ¼å¼"><a href="#å¸§æ ¼å¼" class="headerlink" title="å¸§æ ¼å¼"></a>å¸§æ ¼å¼</h3><p>å¿…é¡»è§„å®šç‰¹æ®Šçš„å­—ç¬¦ä½œä¸ºå¸§å®šç•Œç¬¦</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201012211826281.png" alt="image-20201012211826281"></p><h3 id="é€æ˜ä¼ è¾“-1"><a href="#é€æ˜ä¼ è¾“-1" class="headerlink" title="é€æ˜ä¼ è¾“"></a>é€æ˜ä¼ è¾“</h3><p>å¿…é¡»ä¿è¯æ•°æ®ä¼ è¾“çš„é€æ˜æ€§</p><p>å®ç°é€æ˜ä¼ è¾“çš„æ–¹æ³•ï¼š</p><ul><li><strong>é¢å‘å­—èŠ‚çš„å¼‚æ­¥é“¾è·¯</strong>ï¼šå­—èŠ‚å¡«å……æ³•ï¼ˆæ’å…¥â€œè½¬ä¹‰å­—ç¬¦â€ï¼‰</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201012212148803.png" alt="image-20201012212148803"></p><ul><li><strong>é¢å‘æ¯”ç‰¹çš„åŒæ­¥é“¾è·¯</strong>ï¼šæ¯”ç‰¹å¡«å……æ³•ï¼ˆæ’å…¥â€œæ¯”ç‰¹0â€ï¼‰</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201012212255550.png" alt="image-20201012212255550"></p><h3 id="å·®é”™æ£€æµ‹-1"><a href="#å·®é”™æ£€æµ‹-1" class="headerlink" title="å·®é”™æ£€æµ‹"></a>å·®é”™æ£€æµ‹</h3><p>èƒ½å¤Ÿå¯¹æ¥æ”¶ç«¯æ”¶åˆ°çš„å¸§è¿›è¡Œæ£€æµ‹ï¼Œå¹¶<mark>ç«‹å³ä¸¢å¼ƒ</mark>æœ‰å·®é”™çš„å¸§ã€‚<mark>å‘ä¸Šå±‚æä¾›çš„æ˜¯ä¸å¯é çš„æœåŠ¡</mark></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201012212558654.png" alt="image-20201012212558654"></p><h3 id="å·¥ä½œçŠ¶æ€"><a href="#å·¥ä½œçŠ¶æ€" class="headerlink" title="å·¥ä½œçŠ¶æ€"></a>å·¥ä½œçŠ¶æ€</h3><ul><li>å½“ç”¨æˆ·æ‹¨å·æ¥å…¥ ISP æ—¶ï¼Œè·¯ç”±å™¨çš„è°ƒåˆ¶è§£è°ƒå™¨å¯¹æ‹¨å·åšå‡ºç¡®è®¤ï¼Œå¹¶å»ºç«‹ä¸€æ¡ç‰©ç†è¿æ¥ã€‚</li><li>PC æœºå‘è·¯ç”±å™¨å‘é€ä¸€ç³»åˆ—çš„ LCP åˆ†ç»„ï¼ˆå°è£…æˆå¤šä¸ª PPP å¸§ï¼‰ã€‚</li><li>è¿™äº›åˆ†ç»„åŠå…¶å“åº”é€‰æ‹©ä¸€äº› PPP å‚æ•°ï¼Œå¹¶è¿›è¡Œç½‘ç»œå±‚é…ç½®ï¼ŒNCP ç»™æ–°æ¥å…¥çš„ PC æœº</li><li>åˆ†é…ä¸€ä¸ªä¸´æ—¶çš„ IP åœ°å€ï¼Œä½¿ PC æœºæˆä¸ºå› ç‰¹ç½‘ä¸Šçš„ä¸€ä¸ªä¸»æœºã€‚</li><li>é€šä¿¡å®Œæ¯•æ—¶ï¼ŒNCP é‡Šæ”¾ç½‘ç»œå±‚è¿æ¥ï¼Œæ”¶å›åŸæ¥åˆ†é…å‡ºå»çš„ IP åœ°å€ã€‚æ¥ç€ï¼ŒLCP é‡Šæ”¾æ•°æ®é“¾è·¯å±‚è¿æ¥ã€‚æœ€åé‡Šæ”¾çš„æ˜¯ç‰©ç†å±‚çš„è¿æ¥ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201012213021860.png" alt="image-20201012213021860"></p><blockquote><p>å¯è§ï¼ŒPPP åè®®å·²ä¸æ˜¯çº¯ç²¹çš„æ•°æ®é“¾è·¯å±‚çš„åè®®ï¼Œå®ƒè¿˜åŒ…å«äº†ç‰©ç†å±‚å’Œç½‘ç»œå±‚çš„å†…å®¹ã€‚</p></blockquote><h2 id="åª’ä½“æ¥å…¥æ§åˆ¶ï¼ˆä»‹è´¨è®¿é—®æ§åˆ¶ï¼‰MACâ€”å¹¿æ’­ä¿¡é“"><a href="#åª’ä½“æ¥å…¥æ§åˆ¶ï¼ˆä»‹è´¨è®¿é—®æ§åˆ¶ï¼‰MACâ€”å¹¿æ’­ä¿¡é“" class="headerlink" title="åª’ä½“æ¥å…¥æ§åˆ¶ï¼ˆä»‹è´¨è®¿é—®æ§åˆ¶ï¼‰MACâ€”å¹¿æ’­ä¿¡é“"></a>åª’ä½“æ¥å…¥æ§åˆ¶ï¼ˆä»‹è´¨è®¿é—®æ§åˆ¶ï¼‰MACâ€”å¹¿æ’­ä¿¡é“</h2><h3 id="åª’ä½“æ¥å…¥æ§åˆ¶çš„åŸºæœ¬æ¦‚å¿µ"><a href="#åª’ä½“æ¥å…¥æ§åˆ¶çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åª’ä½“æ¥å…¥æ§åˆ¶çš„åŸºæœ¬æ¦‚å¿µ"></a>åª’ä½“æ¥å…¥æ§åˆ¶çš„åŸºæœ¬æ¦‚å¿µ</h3><ul><li><strong>å…±äº«ä¿¡é“</strong>ç€é‡è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼š<mark>å¦‚ä½•åè°ƒåª’ä½“æ¥å…¥æ§åˆ¶MAC</mark>(Medium Access Control)ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.2mhukq83oiq0.webp" alt="image"></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.280s01udv51c.webp" alt="image"></p><blockquote><p>éšç€æŠ€æœ¯çš„å‘å±•ï¼Œäº¤æ¢æŠ€æœ¯çš„æˆç†Ÿå’Œæˆæœ¬çš„é™ä½ï¼Œå…·æœ‰æ›´é«˜æ€§èƒ½çš„ä½¿ç”¨ç‚¹å¯¹ç‚¹é“¾è·¯å’Œé“¾è·¯å±‚äº¤æ¢æœºçš„äº¤æ¢å¼å±€åŸŸç½‘åœ¨æœ‰çº¿é¢†åŸŸå·²å®Œå…¨å–ä»£äº†å…±äº«å¼å±€åŸŸç½‘ï¼Œä½†ç”±äºæ— çº¿ä¿¡é“çš„å¹¿æ’­å¤©æ€§ï¼Œæ— çº¿å±€åŸŸç½‘ä»ç„¶ä½¿ç”¨çš„æ˜¯å…±äº«åª’ä½“æŠ€æœ¯</p></blockquote><h3 id="é™æ€åˆ’åˆ†ä¿¡é“"><a href="#é™æ€åˆ’åˆ†ä¿¡é“" class="headerlink" title="é™æ€åˆ’åˆ†ä¿¡é“"></a>é™æ€åˆ’åˆ†ä¿¡é“</h3><ol><li>ä¿¡é“å¤ç”¨</li></ol><p><strong>å¤ç”¨(Multiplexing)æ˜¯é€šä¿¡æŠ€æœ¯ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µ</strong>ã€‚<mark>å¤ç”¨</mark>å°±æ˜¯é€šè¿‡**ä¸€æ¡ç‰©ç†çº¿è·¯åŒæ—¶ä¼ è¾“å¤šè·¯ç”¨æˆ·çš„<mark>**ä¿¡å·</mark>ã€‚</p><p>å½“ç½‘ç»œä¸­ä¼ è¾“åª’ä½“çš„ä¼ è¾“å®¹é‡å¤§äºå¤šæ¡å•ä¸€ä¿¡é“ä¼ è¾“çš„æ€»é€šä¿¡é‡æ—¶,å¯åˆ©ç”¨å¤ç”¨æŠ€æœ¯åœ¨ä¸€æ¡ç‰©ç†çº¿è·¯ä¸Šå»ºç«‹å¤šæ¡é€šä¿¡ä¿¡é“æ¥å……åˆ†åˆ©ç”¨ä¼ è¾“åª’ä½“çš„å¸¦å®½ã€‚</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.4pu8jh6zvgy0.webp" alt="image"></p><ol start="2"><li>é¢‘åˆ†å¤ç”¨FM</li></ol><ul><li><p>å°†æ•´ä¸ªå¸¦å®½åˆ†ä¸ºå¤šä»½ï¼Œç”¨æˆ·åœ¨åˆ†é…åˆ°ä¸€å®šçš„é¢‘å¸¦åï¼Œåœ¨é€šä¿¡è¿‡ç¨‹ä¸­è‡ªå§‹è‡³ç»ˆéƒ½å ç”¨è¿™ä¸ªé¢‘å¸¦ã€‚</p></li><li><p><strong>é¢‘åˆ†å¤ç”¨</strong>çš„æ‰€æœ‰ç”¨æˆ·åœ¨åŒæ ·çš„æ—¶é—´<strong>å ç”¨ä¸åŒçš„å¸¦å®½èµ„æº</strong>ï¼ˆè¯·æ³¨æ„ï¼Œè¿™é‡Œçš„â€œå¸¦å®½â€æ˜¯é¢‘ç‡å¸¦å®½è€Œä¸æ˜¯æ•°æ®çš„å‘é€é€Ÿç‡ï¼‰ã€‚</p></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.4clh309v96y0.webp" alt="image"></p><blockquote><p>é¢‘åˆ†å¤ç”¨çš„æ‰€æœ‰ç”¨æˆ·åŒæ—¶å ç”¨ä¸åŒçš„é¢‘å¸¦èµ„æºå¹¶è¡Œé€šä¿¡ã€‚</p></blockquote><ol start="3"><li>æ—¶åˆ†å¤ç”¨TDM</li></ol><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.4hv0n06v2360.webp" alt="image"></p><blockquote><p>æ—¶åˆ†å¤ç”¨çš„æ‰€æœ‰ç”¨æˆ·åœ¨ä¸åŒçš„æ—¶é—´å ç”¨åŒæ ·çš„é¢‘å¸¦å®½åº¦ã€‚</p></blockquote><ol start="4"><li>æ³¢åˆ†å¤ç”¨WDM</li></ol><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.2zy3fibqo2u0.webp" alt="image"></p><blockquote><p>æ³¢åˆ†å¤ç”¨å°±æ˜¯å…‰çš„é¢‘åˆ†å¤ç”¨ï¼Œä½¿ç”¨ä¸€æ ¹å…‰çº¤æ¥åŒæ—¶ä¼ è¾“å¤šä¸ªå…‰è½½æ³¢ä¿¡å·</p><p>å…‰ä¿¡å·ä¼ è¾“ä¸€æ®µè·ç¦»åæ‚”è¡°å‡ï¼Œæ‰€ä»¥è¦ç”¨<strong>æºé“’å…‰çº¤æ”¾å¤§å™¨</strong>æ”¾å¤§å…‰ä¿¡å·</p></blockquote><ol start="5"><li>ç åˆ†å¤ç”¨CDM  (Code Division Multiplexing)</li></ol><p><strong>åŸºæœ¬æ¦‚å¿µï¼š</strong></p><ul><li>ä¸FDMå’ŒTDMä¸åŒï¼ŒCDMçš„æ¯ä¸€ä¸ªç”¨æˆ·å¯ä»¥<mark>åœ¨åŒæ ·çš„æ—¶é—´ä½¿ç”¨åŒæ ·çš„é¢‘å¸¦è¿›è¡Œé€šä¿¡</mark>ã€‚</li><li>ç”±äºå„ç”¨æˆ·ä½¿ç”¨ç»è¿‡ç‰¹æ®ŠæŒ‘é€‰çš„ä¸åŒç å‹ï¼Œå› æ­¤<mark>å„ç”¨æˆ·ä¹‹é—´ä¸ä¼šé€ æˆå¹²æ‰°</mark>ã€‚</li></ul><p>â­â­â­<strong>å…³äºè®¡ç®—ï¼š</strong></p><p>åœ¨CDMAä¸­ï¼Œæ¯ä¸€ä¸ªæ¯”ç‰¹æ—¶é—´å†åˆ’åˆ†ä¸ºmä¸ªçŸ­çš„é—´éš”ï¼Œç§°ä¸º<mark>ç ç‰‡</mark> (Chip)ã€‚é€šå¸¸mçš„å€¼æ˜¯64æˆ–128ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œåœ¨åç»­çš„ä¸¾ä¾‹ä¸­ï¼Œæˆ‘ä»¬å‡è®¾mä¸º8ã€‚</p><p>ä½¿ç”¨CDMAçš„æ¯ä¸€ä¸ªç«™è¢«æŒ‡æ´¾ä¸€ä¸ªå”¯ä¸€çš„<mark>m bitç ç‰‡åºåˆ—</mark> (Chip Sequence)</p><ul><li>ä¸€ä¸ªç«™å¦‚æœ<mark>è¦å‘é€æ¯”ç‰¹1</mark>ï¼Œåˆ™<mark>å‘é€å®ƒè‡ªå·±çš„m bitç ç‰‡åºåˆ—</mark>;</li><li>ä¸€ä¸ªç«™å¦‚æœ<mark>è¦å‘é€æ¯”ç‰¹0</mark>ï¼Œåˆ™<mark>å‘é€å®ƒè‡ªå·±çš„m bitç ç‰‡åºåˆ—çš„äºŒè¿›åˆ¶åç </mark></li></ul><p><strong>ä¸¾ä¾‹ï¼š</strong></p><p>æŒ‡æ´¾ç»™CDMAç³»ç»Ÿä¸­æŸä¸ªç«™ç‚¹çš„ç ç‰‡åºåˆ—ä¸º<mark>00011011</mark><br>å‘é€æ¯”ç‰¹1ï¼šå‘é€è‡ªå·±çš„ç ç‰‡åºåˆ—<mark>00011011</mark></p><p>å‘é€æ¯”ç‰¹0ï¼šå‘é€è‡ªå·±çš„ç ç‰‡åºåˆ—çš„äºŒè¿›åˆ¶åç <mark>11100100</mark></p><p>ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬æŒ‰æƒ¯ä¾‹å°†ç ç‰‡åºåˆ—ä¸­çš„0å†™ä¸º-1ï¼Œå°†1å†™ä¸º+1ï¼Œåˆ™è¯¥ç«™ç‚¹çš„ç ç‰‡åºåˆ—æ˜¯<mark>(-1 -1-1 +1 +1-1 +1 +1)</mark>ã€‚</p><p><strong>ç ç‰‡åºåˆ—çš„æŒ‘é€‰åŸåˆ™å¦‚ä¸‹:</strong></p><ol><li>åˆ†é…ç»™æ¯ä¸ªç«™çš„<mark>ç ç‰‡åºåˆ—å¿…é¡»å„ä¸ç›¸åŒ</mark>ï¼Œå®é™…å¸¸é‡‡ç”¨ä¼ªéšæœºç åºåˆ—</li><li>åˆ†é…ç»™æ¯ä¸ªç«™çš„<mark>ç ç‰‡åºåˆ—å¿…é¡»ç›¸äº’æ­£äº¤</mark> (è§„æ ¼åŒ–å†…ç§¯ä¸º0)ã€‚<br>ä»¤å‘é‡Sè¡¨ç¤ºç«™Sçš„ç ç‰‡åºåˆ—ï¼Œä»¤å‘é‡Tè¡¨ç¤ºå…¶ä»–ä»»ä½•ç«™çš„ç ç‰‡åºåˆ—ã€‚<br>ä¸¤ä¸ªä¸åŒç«™Så’ŒTçš„ç ç‰‡åºåˆ—æ­£äº¤ï¼Œå°±æ˜¯å‘é‡Så’ŒTçš„è§„æ ¼åŒ–å†…ç§¯ä¸º0ï¼š</li></ol><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231122153656906.png" alt="image-20231122153656906"></p><p><strong>ä¾‹é¢˜ï¼š</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201013203459640.png" alt="image-20201013203459640"></p><hr><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201013203819578.png" alt="image-20201013203819578"></p><hr><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231122154047803.png" alt="image-20231122154047803"></p><hr><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231122154252843.png" alt="image-20231122154252843"></p><h3 id="åŠ¨æ€æ¥å…¥æ§åˆ¶"><a href="#åŠ¨æ€æ¥å…¥æ§åˆ¶" class="headerlink" title="åŠ¨æ€æ¥å…¥æ§åˆ¶"></a>åŠ¨æ€æ¥å…¥æ§åˆ¶</h3><h4 id="éšæœºæ¥å…¥ï¼ˆCSMA-CDåè®®ï¼‰"><a href="#éšæœºæ¥å…¥ï¼ˆCSMA-CDåè®®ï¼‰" class="headerlink" title="éšæœºæ¥å…¥ï¼ˆCSMA&#x2F;CDåè®®ï¼‰"></a>éšæœºæ¥å…¥ï¼ˆCSMA&#x2F;CDåè®®ï¼‰</h4><h5 id="å¤šå€æ¥å…¥MA"><a href="#å¤šå€æ¥å…¥MA" class="headerlink" title="å¤šå€æ¥å…¥MA"></a>å¤šå€æ¥å…¥MA</h5><p>è¡¨ç¤ºè®¸å¤šä¸»æœºä»¥å¤šç‚¹æ¥å…¥çš„æ–¹å¼è¿æ¥åœ¨ä¸€æ ¹æ€»çº¿ä¸Šã€‚</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201013215400688.png" alt="image-20201013215400688"></p><h5 id="è½½æ³¢ç›‘å¬CS"><a href="#è½½æ³¢ç›‘å¬CS" class="headerlink" title="è½½æ³¢ç›‘å¬CS"></a>è½½æ³¢ç›‘å¬CS</h5><p>æ˜¯æŒ‡æ¯ä¸€ä¸ªç«™åœ¨<mark>å‘é€æ•°æ®ä¹‹å‰</mark>å…ˆè¦<mark>æ£€æµ‹ä¸€ä¸‹æ€»çº¿ä¸Šæ˜¯å¦æœ‰å…¶ä»–è®¡ç®—æœºåœ¨å‘é€æ•°æ®</mark>ï¼Œå¦‚æœæœ‰ï¼Œåˆ™æš‚æ—¶ä¸è¦å‘é€æ•°æ®ï¼Œä»¥å…å‘ç”Ÿç¢°æ’ã€‚</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201013215530979.png" alt="image-20201013215530979"></p><p>æ€»çº¿ä¸Šå¹¶æ²¡æœ‰ä»€ä¹ˆâ€œè½½æ³¢â€ã€‚å› æ­¤ï¼Œ <strong>â€œè½½æ³¢ç›‘å¬â€å°±æ˜¯ç”¨ç”µå­æŠ€æœ¯æ£€æµ‹æ€»çº¿ä¸Šæœ‰æ²¡æœ‰å…¶ä»–è®¡ç®—æœºå‘é€çš„æ•°æ®ä¿¡å·ã€‚</strong></p><h5 id="ç¢°æ’æ£€æµ‹CD"><a href="#ç¢°æ’æ£€æµ‹CD" class="headerlink" title="ç¢°æ’æ£€æµ‹CD"></a>ç¢°æ’æ£€æµ‹CD</h5><ul><li><strong>â€œç¢°æ’æ£€æµ‹â€</strong>å°±æ˜¯è®¡ç®—æœº<strong>è¾¹å‘é€æ•°æ®è¾¹æ£€æµ‹</strong>ä¿¡é“ä¸Šçš„ä¿¡å·ç”µå‹å¤§å°ã€‚</li><li><strong>æ‰€è°“â€œç¢°æ’â€å°±æ˜¯å‘ç”Ÿäº†å†²çªã€‚å› æ­¤â€œ<mark>ç¢°æ’æ£€æµ‹â€ä¹Ÿç§°ä¸ºâ€œå†²çªæ£€æµ‹</mark>â€ã€‚</strong></li><li>åœ¨å‘ç”Ÿç¢°æ’æ—¶ï¼Œæ€»çº¿ä¸Šä¼ è¾“çš„ä¿¡å·äº§ç”Ÿäº†ä¸¥é‡çš„å¤±çœŸï¼Œæ— æ³•ä»ä¸­æ¢å¤å‡ºæœ‰ç”¨çš„ä¿¡æ¯æ¥ã€‚</li><li><strong>æ¯ä¸€ä¸ªæ­£åœ¨å‘é€æ•°æ®çš„ç«™ï¼Œä¸€æ—¦å‘ç°æ€»çº¿ä¸Šå‡ºç°äº†ç¢°æ’ï¼Œå°±è¦ç«‹å³åœæ­¢å‘é€ï¼Œå…å¾—ç»§ç»­æµªè´¹ç½‘ç»œèµ„æºï¼Œç„¶åç­‰å¾…ä¸€æ®µéšæœºæ—¶é—´åå†æ¬¡å‘é€ã€‚</strong></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201013221240514.png" alt="image-20201013221240514"></p><blockquote><p>ä¸ºä»€ä¹ˆè¦è¿›è¡Œç¢°æ’æ£€æµ‹ï¼Ÿ å› ä¸ºä¿¡å·ä¼ æ’­æ—¶å»¶å¯¹è½½æ³¢ç›‘å¬äº§ç”Ÿäº†å½±å“</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201013221834942.png" alt="image-20201013221834942"></p><p>A éœ€è¦å•ç¨‹ä¼ æ’­æ—¶å»¶çš„ 2 å€çš„æ—¶é—´ï¼Œæ‰èƒ½æ£€æµ‹åˆ°ä¸ B çš„å‘é€äº§ç”Ÿäº†å†²çª</p></blockquote><h5 id="CSMA-CD-åè®®å·¥ä½œæµç¨‹"><a href="#CSMA-CD-åè®®å·¥ä½œæµç¨‹" class="headerlink" title="CSMA&#x2F;CD åè®®å·¥ä½œæµç¨‹"></a>CSMA&#x2F;CD åè®®å·¥ä½œæµç¨‹</h5><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201013221705893.png" alt="image-20201013221705893"></p><h5 id="äº‰ç”¨æœŸï¼ˆç¢°æ’çª—å£ï¼‰"><a href="#äº‰ç”¨æœŸï¼ˆç¢°æ’çª—å£ï¼‰" class="headerlink" title="äº‰ç”¨æœŸï¼ˆç¢°æ’çª—å£ï¼‰"></a>äº‰ç”¨æœŸï¼ˆç¢°æ’çª—å£ï¼‰</h5><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231122180352561.png" alt="image-20231122180352561"></p><ul><li>ä¸»æœº<mark>æœ€å¤šç»è¿‡2Ï„çš„æ—¶é•¿</mark>å°±å¯æ£€æµ‹åˆ°æœ¬æ¬¡å‘é€æ˜¯å¦é­å—äº†ç¢°æ’</li><li>å› æ­¤ï¼Œ<mark>ä»¥å¤ªç½‘çš„ç«¯åˆ°ç«¯å¾€è¿”ä¼ æ’­æ—¶å»¶2Ï„ç§°ä¸ºäº‰ç”¨æœŸæˆ–ç¢°æ’çª—å£</mark>ã€‚</li><li>ç»è¿‡äº‰ç”¨æœŸè¿™æ®µæ—¶é—´è¿˜æ²¡æœ‰æ£€æµ‹åˆ°ç¢°æ’ï¼Œæ‰èƒ½è‚¯å®šè¿™æ¬¡å‘é€ä¸ä¼šå‘ç”Ÿç¢°æ’ã€‚</li><li>æ˜¾ç„¶ï¼Œåœ¨ä»¥å¤ªç½‘ä¸­å‘é€é¡¿çš„ä¸»æœºè¶Šå¤šï¼Œç«¯åˆ°ç«¯å¾€è¿”ä¼ æ’­æ—¶å»¶è¶Šå¤§ï¼Œå‘ç”Ÿç¢°æ’çš„æ¦‚ç‡å°±è¶Šå¤§ã€‚å› æ­¤ï¼Œ<mark>å…±äº«å¼ä»¥å¤ªç½‘ä¸èƒ½è¿æ¥å¤ªå¤šçš„ä¸»æœºï¼Œä½¿ç”¨çš„æ€»çº¿ä¹Ÿä¸èƒ½å¤ªé•¿</mark>ã€‚</li></ul><blockquote><p><mark><strong>äº‰ç”¨æœŸ</strong> &#x3D; 2 * ç«¯åˆ°ç«¯è·ç¦» &#x2F; ç”µç£æ³¢ä¿¡å·é€Ÿç‡ &#x3D; 2Ï„</mark></p></blockquote><h5 id="æœ€å°å¸§é•¿"><a href="#æœ€å°å¸§é•¿" class="headerlink" title="æœ€å°å¸§é•¿"></a>æœ€å°å¸§é•¿</h5><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231122180741742.png" alt="image-20231122180741742"></p><ul><li><p><mark>ä»¥å¤ªç½‘è§„å®šæœ€å°å¸§é•¿ä¸º64å­—èŠ‚</mark>ï¼Œå³512æ¯”ç‰¹ (512æ¯”ç‰¹æ—¶é—´å³ä¸ºäº‰ç”¨æœŸ);</p><ul><li>å¦‚æœè¦å‘é€çš„æ•°æ®éå¸¸å°‘ï¼Œé‚£ä¹ˆå¿…é¡»åŠ å…¥ä¸€äº›å¡«å……å­—èŠ‚ï¼Œä½¿å¸§é•¿ä¸å°äº64å­—èŠ‚ã€‚</li></ul></li><li><p>ä»¥å¤ªç½‘çš„<mark>æœ€å°å¸§é•¿ç¡®ä¿äº†ä¸»æœºå¯åœ¨å¸§å‘é€å®Œæˆä¹‹å‰å°±æ£€æµ‹åˆ°è¯¥é¡¿çš„å‘é€è¿‡ç¨‹ä¸­æ˜¯å¦é­é‡äº†ç¢°æ’</mark></p></li></ul><blockquote><p><mark><strong>æœ€å°å¸§é•¿</strong> &#x3D; äº‰ç”¨æœŸ Ã— æ•°æ®ä¼ è¾“é€Ÿç‡</mark></p></blockquote><h5 id="æœ€å¤§å¸§é•¿"><a href="#æœ€å¤§å¸§é•¿" class="headerlink" title="æœ€å¤§å¸§é•¿"></a>æœ€å¤§å¸§é•¿</h5><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201013225400777.png" alt="image-20201013225400777"></p><h5 id="æˆªæ–­äºŒè¿›åˆ¶æŒ‡æ•°é€€é¿ç®—æ³•"><a href="#æˆªæ–­äºŒè¿›åˆ¶æŒ‡æ•°é€€é¿ç®—æ³•" class="headerlink" title="æˆªæ–­äºŒè¿›åˆ¶æŒ‡æ•°é€€é¿ç®—æ³•"></a>æˆªæ–­äºŒè¿›åˆ¶æŒ‡æ•°é€€é¿ç®—æ³•</h5><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201013230717856.png" alt="image-20201013230717856"></p><h5 id="ä¿¡é“åˆ©ç”¨ç‡"><a href="#ä¿¡é“åˆ©ç”¨ç‡" class="headerlink" title="ä¿¡é“åˆ©ç”¨ç‡"></a>ä¿¡é“åˆ©ç”¨ç‡</h5><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201013231430295.png" alt="image-20201013231430295"></p><h5 id="å¸§å‘é€æµç¨‹"><a href="#å¸§å‘é€æµç¨‹" class="headerlink" title="å¸§å‘é€æµç¨‹"></a>å¸§å‘é€æµç¨‹</h5><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231122181358004.png" alt="image-20231122181358004"></p><h5 id="å¸§æ¥æ”¶æµç¨‹"><a href="#å¸§æ¥æ”¶æµç¨‹" class="headerlink" title="å¸§æ¥æ”¶æµç¨‹"></a>å¸§æ¥æ”¶æµç¨‹</h5><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231122181434076.png" alt="image-20231122181434076"></p><h5 id="é‡è¦ç‰¹æ€§"><a href="#é‡è¦ç‰¹æ€§" class="headerlink" title="é‡è¦ç‰¹æ€§"></a>é‡è¦ç‰¹æ€§</h5><ul><li>ä½¿ç”¨ CSMA&#x2F;CD åè®®çš„ä»¥å¤ªç½‘ä¸èƒ½è¿›è¡Œå…¨åŒå·¥é€šä¿¡è€Œ<strong>åªèƒ½è¿›è¡ŒåŒå‘äº¤æ›¿é€šä¿¡ï¼ˆåŠåŒå·¥é€šä¿¡ï¼‰ã€‚</strong></li><li>æ¯ä¸ªç«™åœ¨å‘é€æ•°æ®ä¹‹åçš„ä¸€å°æ®µæ—¶é—´å†…ï¼Œå­˜åœ¨ç€é­é‡ç¢°æ’çš„å¯èƒ½æ€§ã€‚ </li><li>è¿™ç§<strong>å‘é€çš„ä¸ç¡®å®šæ€§</strong>ä½¿æ•´ä¸ªä»¥å¤ªç½‘çš„å¹³å‡é€šä¿¡é‡è¿œå°äºä»¥å¤ªç½‘çš„æœ€é«˜æ•°æ®ç‡ã€‚</li></ul><blockquote><p>CSMA&#x2F;CDåè®®æ›¾ç»ç”¨äºå„ç§æ€»çº¿ç»“æ„ä»¥å¤ªç½‘å’ŒåŒç»çº¿ä»¥å¤ªç½‘çš„æ—©æœŸç‰ˆæœ¬ä¸­ã€‚</p><p><strong>ç°åœ¨çš„ä»¥å¤ªç½‘åŸºäºäº¤æ¢æœºå’Œå…¨åŒå·¥è¿æ¥ï¼Œä¸ä¼šæœ‰ç¢°æ’ï¼Œå› æ­¤æ²¡æœ‰å¿…è¦ä½¿ç”¨CSMA&#x2F;CSåè®®</strong></p></blockquote><h5 id="â­â­â­ä¾‹é¢˜"><a href="#â­â­â­ä¾‹é¢˜" class="headerlink" title="â­â­â­ä¾‹é¢˜"></a>â­â­â­<strong>ä¾‹é¢˜</strong></h5><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231122181741690.png" alt="image-20231122181741690"></p><hr><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231122174456671.png" alt="image-20231122174456671"></p><hr><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231122181843695.png" alt="image-20231122181843695"></p><p>è§£æï¼š<strong>æœ€çŸ­éœ€è¦ç»è¿‡çš„æ—¶é—´</strong>æ˜¯ä¸»æœºç”²å’Œä¸»æœºä¹™åŒæ—¶å‘é€æ•°æ®ï¼Œåˆ°è¾¾ä¸­é—´æ—¶åˆ»åå‘ç”Ÿç¢°æ’ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›ç¢°æ’ä¿¡å·å›å»ï¼Œé‚£ä¹ˆæ—¶é—´å°±ä¸ºèŠ±è´¹ç«¯åˆ°ç«¯è·ç¦»çš„ä¸€åŠçš„æ—¶é—´åŠ ä¸Šè¿”å›ç¢°æ’ä¿¡å·çš„æ—¶é—´ï¼ˆåŒæ ·ä¸ºç«¯åˆ°ç«¯è·ç¦»çš„ä¸€åŠçš„æ—¶é—´ï¼‰ï¼ŒåŠ èµ·æ¥ä¸€å…±å°±æ˜¯èŠ±è´¹ç«¯åˆ°ç«¯è·ç¦»çš„æ—¶é—´ã€‚</p><p><strong>æœ€é•¿éœ€è¦ç»è¿‡çš„æ—¶é—´</strong>ï¼šå‡è®¾ä¸»æœºç”²å‘é€æ•°æ®åï¼Œå·²ç»æ— é™æ¥è¿‘äºä¸»æœºä¹™äº†ï¼Œæ­¤æ—¶ä¸»æœºä¹™æ‰å‘é€æ•°æ®ï¼Œåœ¨æ— é™è¶‹è¿‘äºä¸»æœºä¹™çš„åœ°ç‚¹å‘ç”Ÿäº†ç¢°æ’ï¼Œé‚£ä¹ˆæ—¶é—´èŠ±è´¹å°±ä¸ºä¸»æœºç”²å‘é€æ•°æ®åˆ°ä¸»æœºä¹™çš„æ—¶é—´ï¼ˆå³ç«¯åˆ°ç«¯è·ç¦»çš„çš„æ—¶é—´ï¼‰åŠ ä¸Šç¢°æ’ä¿¡å·è¿”å›ç»™ä¸»æœºç”²çš„æ—¶é—´ï¼ˆä¹Ÿå³ç«¯åˆ°ç«¯è·ç¦»çš„æ—¶é—´ï¼‰&#x3D;ä¸¤å€çš„ç«¯åˆ°ç«¯çš„è·ç¦»æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚</p><h4 id="éšæœºæ¥å…¥ï¼ˆCSMA-CAåè®®ï¼‰"><a href="#éšæœºæ¥å…¥ï¼ˆCSMA-CAåè®®ï¼‰" class="headerlink" title="éšæœºæ¥å…¥ï¼ˆCSMA&#x2F;CAåè®®ï¼‰"></a>éšæœºæ¥å…¥ï¼ˆCSMA&#x2F;CAåè®®ï¼‰</h4><h5 id="ä¸ºä»€ä¹ˆæ— çº¿å±€åŸŸç½‘è¦ä½¿ç”¨CSMA-CAåè®®"><a href="#ä¸ºä»€ä¹ˆæ— çº¿å±€åŸŸç½‘è¦ä½¿ç”¨CSMA-CAåè®®" class="headerlink" title="ä¸ºä»€ä¹ˆæ— çº¿å±€åŸŸç½‘è¦ä½¿ç”¨CSMA&#x2F;CAåè®®"></a>ä¸ºä»€ä¹ˆæ— çº¿å±€åŸŸç½‘è¦ä½¿ç”¨CSMA&#x2F;CAåè®®</h5><blockquote><p>é—®ï¼šæ—¢ç„¶CSMA&#x2F;CDåè®®å·²ç»æˆåŠŸåœ°åº”ç”¨äºä½¿ç”¨å¹¿æ’­ä¿¡é“çš„æœ‰çº¿å±€åŸŸç½‘ï¼Œé‚£ä¹ˆåŒæ ·ä½¿ç”¨å¹¿æ’­ä¿¡é“çš„æ— çº¿å±€åŸŸç½‘èƒ½ä¸èƒ½ä¹Ÿä½¿ç”¨CSMA&#x2F;CDåè®®å‘¢?</p></blockquote><ul><li><mark>åœ¨æ— çº¿å±€åŸŸç½‘ä¸­ï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨è½½æ³¢ç›‘å¬å¤šå€æ¥å…¥CSMA</mark>ï¼Œå³åœ¨å‘é€é¡¿ä¹‹å‰å…ˆå¯¹ä¼ è¾“åª’ä½“è¿›è¡Œè½½æ³¢ç›‘å¬ã€‚è‹¥å‘ç°æœ‰å…¶ä»–ç«™åœ¨å‘é€å¸§ï¼Œå°±æ¨è¿Ÿå‘é€ä»¥å…å‘ç”Ÿç¢°æ’ã€‚</li><li><mark>åœ¨æ— çº¿å±€åŸŸç½‘ä¸­ï¼Œä¸èƒ½ä½¿ç”¨ç¢°æ’æ£€æµ‹CD</mark>ï¼ŒåŸå› å¦‚ä¸‹:<ul><li>ç”±äºæ— çº¿ä¿¡é“çš„ä¼ è¾“æ¡ä»¶ç‰¹æ®Šï¼Œå…¶ä¿¡å·å¼ºåº¦çš„åŠ¨æ€èŒƒå›´éå¸¸å¤§ï¼Œæ— çº¿ç½‘å¡ä¸Šæ¥æ”¶åˆ°çš„ä¿¡å·å¼ºåº¦å¾€å¾€ä¼šè¿œè¿œå°äºå‘é€ä¿¡å·çš„å¼ºåº¦ (å¯èƒ½ç›¸å·®ç™¾ä¸‡å€)ã€‚<mark>å¦‚æœè¦åœ¨æ— çº¿ç½‘å¡ä¸Šå®ç°ç¢°æ’æ£€æµ‹CDï¼Œå¯¹ç¡¬ä»¶çš„è¦æ±‚éå¸¸é«˜</mark>ã€‚</li><li>å³ä½¿èƒ½å¤Ÿåœ¨ç¡¬ä»¶ä¸Šå®ç°æ— çº¿å±€åŸŸç½‘çš„ç¢°æ’æ£€æµ‹åŠŸèƒ½ï¼Œä½†ç”±äºæ— çº¿ç”µæ³¢ä¼ æ’­çš„ç‰¹æ®Šæ€§ï¼ˆ<mark>å­˜åœ¨<strong>éšè”½ç«™é—®é¢˜</strong></mark>ï¼‰ï¼Œ<mark>è¿›è¡Œç¢°æ’æ£€æµ‹çš„æ„ä¹‰ä¹Ÿä¸å¤§</mark>ã€‚</li></ul></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231122220836351.png" alt="éšè”½ç«™é—®é¢˜"></p><ul><li><mark>802.11æ— çº¿å±€åŸŸç½‘</mark>ä½¿ç”¨CSMA&#x2F;CAåè®®ï¼Œåœ¨CSMAçš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€ä¸ª<mark><strong>ç¢°æ’é¿å…CAåŠŸèƒ½</strong></mark>ï¼Œè€Œä¸å†å®ç°ç¢°æ’æ£€æµ‹åŠŸèƒ½ã€‚</li><li>ç”±äºä¸å¯èƒ½é¿å…æ‰€æœ‰çš„ç¢°æ’ï¼Œå¹¶ä¸”<mark>æ— çº¿ä¿¡é“è¯¯ç ç‡è¾ƒé«˜</mark>ï¼Œ802.11æ ‡å‡†è¿˜ä½¿ç”¨äº†æ•°æ®é“¾è·¯å±‚<mark><strong>ç¡®è®¤æœºåˆ¶ï¼ˆåœæ­¢-ç­‰å¾…åè®®ï¼‰</strong></mark>æ¥ä¿è¯æ•°æ®è¢«æ­£ç¡®æ¥æ”¶ã€‚</li><li>802.11çš„MACå±‚æ ‡å‡†å®šä¹‰äº†ä¸¤ç§ä¸åŒçš„åª’ä½“æ¥å…¥æ§åˆ¶æ–¹å¼ï¼š<ul><li><strong>åˆ†å¸ƒå¼åè°ƒåŠŸèƒ½DCF</strong>(Distributed Coordination Function)ã€‚åœ¨DCFæ–¹å¼ä¸‹ï¼Œæ²¡æœ‰ä¸­å¿ƒæ§åˆ¶ç«™ç‚¹ï¼Œæ¯ä¸ªç«™ç‚¹ä½¿ç”¨CSMA&#x2F;CAåè®®é€šè¿‡äº‰ç”¨ä¿¡é“æ¥è·å–å‘é€æƒï¼Œè¿™æ˜¯802.11å®šä¹‰çš„é»˜è®¤æ–¹å¼ã€‚</li><li><strong>ç‚¹åè°ƒåŠŸèƒ½PCF</strong>(Point Coordination Function)ã€‚PCFæ–¹å¼ä½¿ç”¨é›†ä¸­æ§åˆ¶çš„æ¥å…¥ç®—æ³•(ä¸€èˆ¬åœ¨æ¥å…¥ç‚¹APå®ç°é›†ä¸­æ§åˆ¶)ï¼Œæ˜¯802.11å®šä¹‰çš„å¯é€‰æ–¹å¼ï¼Œåœ¨å®é™…ä¸­è¾ƒå°‘ä½¿ç”¨ã€‚</li></ul></li></ul><h5 id="å¸§é—´é—´éš”IFSï¼ˆInterFrame-Spaceï¼‰"><a href="#å¸§é—´é—´éš”IFSï¼ˆInterFrame-Spaceï¼‰" class="headerlink" title="å¸§é—´é—´éš”IFSï¼ˆInterFrame Spaceï¼‰"></a>å¸§é—´é—´éš”IFSï¼ˆInterFrame Spaceï¼‰</h5><ul><li>802.11æ ‡å‡†è§„å®šï¼Œæ‰€æœ‰çš„<mark>ç«™ç‚¹å¿…é¡»åœ¨æŒç»­æ£€æµ‹åˆ°ä¿¡é“ç©ºé—²ä¸€æ®µæŒ‡å®šæ—¶é—´åæ‰èƒ½å‘é€å¸§</mark>ï¼Œè¿™æ®µæ—¶é—´ç§°ä¸ºå¸§é—´é—´éš”IFSã€‚</li><li>å¸§é—´é—´éš”çš„é•¿çŸ­å–å†³äºè¯¥ç«™ç‚¹è¦å‘é€çš„å¸§çš„ç±»å‹ï¼š<ul><li>é«˜ä¼˜å…ˆçº§éœ€è¦ç­‰å¾…çš„æ—¶é—´è¾ƒçŸ­ï¼Œå› æ­¤å¯ä¼˜å…ˆè·å¾—å‘é€æƒï¼›</li><li>ä½ä¼˜å…ˆçº§å¸§éœ€è¦ç­‰å¾…çš„æ—¶é—´è¾ƒé•¿ã€‚è‹¥æŸä¸ªç«™çš„ä½ä¼˜å…ˆçº§å¸§è¿˜æ²¡æ¥å¾—åŠå‘é€ï¼Œè€Œå…¶ä»–ç«™çš„é«˜ä¼˜å…ˆçº§å¸§å·²å‘é€åˆ°ä¿¡é“ä¸Šï¼Œåˆ™ä¿¡é“å˜ä¸ºå¿™æ€ï¼Œå› è€Œä½ä¼˜å…ˆçº§å¸§å°±åªèƒ½å†æ¨è¿Ÿå‘é€äº†ã€‚è¿™æ ·å°±<strong>å‡å°‘äº†å‘ç”Ÿç¢°æ’çš„æœºä¼š</strong>ã€‚</li></ul></li><li>å¸¸ç”¨çš„ä¸¤ç§å¸§é—´é—´éš”å¦‚ä¸‹ï¼š<ul><li>**çŸ­å¸§é—´é—´éš”SIFS(28us)**ï¼Œæ˜¯æœ€çŸ­çš„é¡¿é—´é—´éš”ï¼Œç”¨æ¥åˆ†éš”å¼€å±äºä¸€æ¬¡å¯¹è¯çš„å„ã€‚ä¸€ä¸ªç«™ç‚¹åº”å½“èƒ½å¤Ÿåœ¨è¿™<br>æ®µæ—¶é—´å†…ä»å‘é€æ–¹å¼åˆ‡æ¢åˆ°æ¥æ”¶æ–¹å¼ã€‚ä½¿ç”¨SIFSçš„å¸§ç±»å‹æœ‰ACKå¸§ã€CTSã€ç”±è¿‡é•¿çš„MACåˆ†ç‰‡åçš„æ•°æ®å¸§ã€ä»¥åŠæ‰€æœ‰å›ç­”APæ¢è¯¢çš„å¸§å’Œåœ¨PCFæ–¹å¼ä¸­æ¥å…¥ç‚¹APå‘é€å‡ºçš„ä»»ä½•å¸§ã€‚</li><li>**DCFå¸§é—´é—´éš”DIFS(128us)**ï¼Œå®ƒæ¯”çŸ­é—´é—´éš”SIFSè¦é•¿å¾—å¤šï¼Œåœ¨DCFæ–¹å¼ä¸­ç”¨æ¥å‘é€æ•°æ®é¡¿å’Œç®¡ç†å¸§ã€‚</li></ul></li></ul><h5 id="CSMA-CAåè®®çš„å·¥ä½œåŸç†"><a href="#CSMA-CAåè®®çš„å·¥ä½œåŸç†" class="headerlink" title="CSMA&#x2F;CAåè®®çš„å·¥ä½œåŸç†"></a>CSMA&#x2F;CAåè®®çš„å·¥ä½œåŸç†</h5><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201014200833233.png" alt="image-20201014200833233"></p><blockquote><p><strong>é—®ï¼šæºç«™ä¸ºä»€ä¹ˆåœ¨æ£€æµ‹åˆ°ä¿¡é“ç©ºé—²åè¿˜è¦å†ç­‰å¾…ä¸€æ®µæ—¶é—´DIFSï¼Ÿ</strong></p><ul><li>è€ƒè™‘åˆ°å¯èƒ½æœ‰å…¶ä»–çš„ç«™æœ‰é«˜ä¼˜å…ˆçº§çš„å¸§è¦å‘é€ã€‚è‹¥æœ‰ï¼Œå°±è¦è®©é«˜ä¼˜å…ˆçº§å¸§å…ˆå‘é€</li></ul><p><strong>é—®ï¼šç›®çš„ç«™ä¸ºä»€ä¹ˆæ­£ç¡®æ¥æ”¶æ•°æ®å¸§åè¿˜è¦ç­‰å¾…ä¸€æ®µæ—¶é—´SIFSæ‰èƒ½å‘é€ACKå¸§ï¼Ÿ</strong></p><ul><li>SIFSæ˜¯æœ€çŸ­çš„å¸§é—´é—´éš”ï¼Œç”¨æ¥åˆ†éš”å¼€å±äºä¸€æ¬¡å¯¹è¯çš„å„å¸§ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…ï¼Œä¸€ä¸ªç«™ç‚¹åº”å½“èƒ½å¤Ÿä»å‘é€æ–¹å¼åˆ‡æ¢åˆ°æ¥æ”¶æ–¹å¼</li></ul></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201014201511741.png" alt="image-20201014201511741"></p><blockquote><p><strong>é—®ï¼šä¿¡é“ç”±å¿™è½¬ä¸ºç©ºé—²ä¸”ç»è¿‡DIFSæ—¶é—´åï¼Œè¿˜è¦é€€é¿ä¸€æ®µéšæœºæ—¶é—´æ‰èƒ½ä½¿ç”¨ä¿¡é“ï¼Ÿ</strong></p><p>é˜²æ­¢å¤šä¸ªç«™ç‚¹åŒæ—¶å‘é€æ•°æ®è€Œäº§ç”Ÿç¢°æ’</p></blockquote><h5 id="CSMA-CAåè®®çš„é€€é¿ç®—æ³•"><a href="#CSMA-CAåè®®çš„é€€é¿ç®—æ³•" class="headerlink" title="CSMA&#x2F;CAåè®®çš„é€€é¿ç®—æ³•"></a>CSMA&#x2F;CAåè®®çš„é€€é¿ç®—æ³•</h5><p><strong>ä½¿ç”¨é€€é¿ç®—æ³•çš„åŸå› ï¼š</strong></p><blockquote><p>é˜²æ­¢å¤šä¸ªç«™ç‚¹åŒæ—¶å‘é€æ•°æ®è€Œäº§ç”Ÿç¢°æ’</p></blockquote><p><strong>ä½¿ç”¨é€€é¿ç®—æ³•çš„æ—¶æœºï¼š</strong></p><ul><li><p>ä»¥ä¸‹æƒ…å†µå¿…é¡»ä½¿ç”¨é€€é¿ç®—æ³•:</p><ul><li>åœ¨å‘é€æ•°æ®å¸§ä¹‹å‰æ£€æµ‹åˆ°ä¿¡é“å¤„äºå¿™çŠ¶æ€æ—¶ï¼›</li><li>åœ¨æ¯ä¸€æ¬¡é‡ä¼ ä¸€ä¸ªæ•°æ®å¸§æ—¶ï¼›</li><li>åœ¨æ¯ä¸€æ¬¡æˆåŠŸå‘é€åè¦è¿ç»­å‘é€ä¸‹ä¸€ä¸ªæ—¶(è¿™æ˜¯ä¸ºäº†é¿å…ä¸€ä¸ªç«™ç‚¹é•¿æ—¶é—´å ç”¨ä¿¡é“)ã€‚</li></ul></li><li><p>åœ¨æ‰§è¡Œé€€é¿ç®—æ³•æ—¶ï¼Œç«™ç‚¹ä¸ºé€€é¿è®¡æ—¶å™¨è®¾ç½®ä¸€ä¸ª<mark>éšæœºçš„é€€é¿æ—¶é—´</mark>:</p><ul><li>å½“é€€é¿è®¡æ—¶å™¨çš„æ—¶é—´å‡å°åˆ°é›¶æ—¶ï¼Œå°±å¼€å§‹å‘é€æ•°æ®:</li><li>å½“é€€é¿è®¡æ—¶å™¨çš„æ—¶é—´è¿˜æœªå‡å°åˆ°é›¶æ—¶è€Œä¿¡é“åˆè½¬å˜ä¸ºå¿™çŠ¶æ€ï¼Œè¿™æ—¶å°±<mark>å†»ç»“</mark>é€€é¿è®¡æ—¶å™¨çš„æ•°å€¼ï¼Œé‡æ–°ç­‰å¾…ä¿¡é“å˜ä¸ºç©ºé—²ï¼Œå†ç»è¿‡æ—¶é—´DIFSåï¼Œç»§ç»­å¯åŠ¨é€€é¿è®¡æ—¶å™¨.</li></ul></li><li><p>åœ¨è¿›è¡Œç¬¬iæ¬¡é€€é¿æ—¶ï¼Œé€€é¿æ—¶é—´åœ¨æ—¶éš™ç¼–å·{0ï¼Œ1ï¼Œâ€¦ï¼Œ2?1ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªï¼Œç„¶åä¹˜ä»¥åŸºæœ¬é€€é¿æ—¶é—´(ä¹Ÿå°±æ˜¯ä¸€ä¸ªæ—¶éš™çš„é•¿åº¦)å°±å¯ä»¥å¾—åˆ°éšæœºçš„é€€é¿æ—¶é—´ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†ä½¿ä¸åŒç«™ç‚¹é€‰æ‹©ç›¸åŒé€€é¿æ—¶é—´çš„æ¦‚ç‡å‡å°‘ã€‚å½“æ—¶éš™ç¼–å·è¾¾åˆ°255æ—¶(å¯¹åº”äºç¬¬6æ¬¡é€€é¿)å°±ä¸å†å¢åŠ äº†ã€‚</p></li></ul><p><strong>é€€é¿ç®—æ³•çš„ç¤ºä¾‹ï¼š</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201014202819851.png" alt="image-20201014202819851"></p><h5 id="CSMA-CAåè®®çš„ä¿¡é“é¢„çº¦å’Œè™šæ‹Ÿè½½æ³¢ç›‘å¬"><a href="#CSMA-CAåè®®çš„ä¿¡é“é¢„çº¦å’Œè™šæ‹Ÿè½½æ³¢ç›‘å¬" class="headerlink" title="CSMA&#x2F;CAåè®®çš„ä¿¡é“é¢„çº¦å’Œè™šæ‹Ÿè½½æ³¢ç›‘å¬"></a>CSMA&#x2F;CAåè®®çš„ä¿¡é“é¢„çº¦å’Œè™šæ‹Ÿè½½æ³¢ç›‘å¬</h5><p>ä¸ºäº†<mark>å°½å¯èƒ½å‡å°‘ç¢°æ’çš„æ¦‚ç‡</mark>å’Œé™ä½ç¢°æ’çš„å½±å“ï¼Œ802.11æ ‡å‡†å…è®¸è¦å‘é€æ•°æ®çš„ç«™ç‚¹<mark>å¯¹ä¿¡é“è¿›è¡Œé¢„çº¦</mark>ã€‚</p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>æºç«™åœ¨å‘é€æ•°æ®é¡¿ä¹‹å‰å…ˆå‘é€ä¸€ä¸ªçŸ­çš„æ§åˆ¶ï¼Œç§°ä¸º<mark>è¯·æ±‚å‘é€RTS</mark>(Request To Snd)ï¼Œå®ƒåŒ…æ‹¬æºåœ°å€ç›®çš„åœ°å€ä»¥åŠè¿™æ¬¡é€šä¿¡(åŒ…æ‹¬ç›¸åº”çš„ç¡®è®¤å¸§) æ‰€éœ€çš„æŒç»­æ—¶é—´ã€‚</li><li>è‹¥ç›®çš„ç«™æ­£ç¡®æ”¶åˆ°æºç«™å‘æ¥çš„RTSï¼Œä¸”åª’ä½“ç©ºé—²ï¼Œå°±å‘é€ä¸€ä¸ªå“åº”æ§åˆ¶å¸§ï¼Œç§°ä¸º<mark>å…è®¸å‘é€CTS</mark>(Clear To Send)ï¼Œå®ƒä¹ŸåŒ…æ‹¬è¿™æ¬¡é€šä¿¡æ‰€éœ€çš„æŒç»­æ—¶é—´ (ä»RTSå¸§ä¸­å°†æ­¤æŒç»­æ—¶é—´å¤åˆ¶åˆ°CTSä¸­)ã€‚</li><li>æºç«™æ”¶åˆ°CTSé¡¿åï¼Œå†ç­‰å¾…ä¸€æ®µæ—¶é—´SIFSåï¼Œå°±å¯å‘é€å…¶æ•°æ®å¸§ã€‚</li><li>è‹¥ç›®çš„ç«™æ­£ç¡®æ”¶åˆ°äº†æºç«™å‘æ¥çš„æ•°æ®å¸§ï¼Œåœ¨ç­‰å¾…æ—¶é—´SIFSåï¼Œå°±å‘æºç«™å‘é€ç¡®è®¤å¸§ACKã€‚</li></ol><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231122222251840.png" alt="image-20231122222251840"></p><ul><li>é™¤æºç«™å’Œç›®çš„ç«™ä»¥å¤–çš„<strong>å…¶ä»–å„ç«™</strong>ï¼Œåœ¨<strong>æ”¶åˆ°CTSå¸§(æˆ–æ•°æ®)åå°±<mark>æ¨è¿Ÿæ¥å…¥</mark>åˆ°æ— çº¿å±€åŸŸç½‘ä¸­</strong>ã€‚è¿™æ ·å°±ä¿è¯äº†æºç«™å’Œç›®çš„ç«™ä¹‹é—´çš„é€šä¿¡ä¸ä¼šå—åˆ°å…¶ä»–ç«™çš„å¹²æ‰°ã€‚</li><li>å¦‚æœRTSå¸§å‘ç”Ÿç¢°æ’ï¼Œæºç«™å°±æ”¶ä¸åˆ°CTSé¡¿ï¼Œéœ€æ‰§è¡Œé€€é¿ç®—æ³•é‡ä¼ RTSå¸§ã€‚</li><li>ç”±äº<mark>RTSå¸§å’ŒCTSå¸§å¾ˆçŸ­ï¼Œå‘é€ç¢°æ’çš„æ¦‚ç‡ã€ç¢°æ’äº§ç”Ÿçš„å¼€é”€åŠæœ¬èº«çš„å¼€é”€éƒ½å¾ˆå°</mark>ã€‚è€Œå¯¹äºä¸€èˆ¬çš„æ•°æ®é¡¿ï¼Œå…¶å‘é€æ—¶å»¶å¾€å¾€å¤§äºä¼ æ’­æ—¶å»¶(å› ä¸ºæ˜¯å±€åŸŸç½‘)ï¼Œç¢°æ’çš„æ¦‚ç‡å¾ˆå¤§ï¼Œä¸”ä¸€æ—¦å‘ç”Ÿç¢°æ’è€Œå¯¼è‡´æ•°æ®å¸§é‡å‘ï¼Œåˆ™æµªè´¹çš„æ—¶é—´å°±å¾ˆå¤šï¼Œå› æ­¤<mark>ç”¨å¾ˆå°çš„ä»£ä»·å¯¹ä¿¡é“è¿›è¡Œé¢„çº¦å¾€å¾€æ˜¯å€¼å¾—çš„</mark>ã€‚</li><li>802.11æ ‡å‡†è§„å®šäº†3ç§æƒ…å†µä¾›ç”¨æˆ·é€‰æ‹©ï¼š<ul><li>ä½¿ç”¨RTSå¸§å’ŒCTSå¸§</li><li>ä¸ä½¿ç”¨RTSå¸§å’ŒCTSå¸§</li><li>åªæœ‰å½“æ•°æ®å¸§çš„é•¿åº¦è¶…è¿‡æŸä¸€æ•°å€¼æ—¶æ‰ä½¿ç”¨RTSå¸§å’ŒCTSå¸§</li></ul></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231122222731704.png" alt="image-20231122222731704"></p><ul><li>ç”±äºåˆ©ç”¨è™šæ‹Ÿè½½æ³¢ç›‘å¬æœºåˆ¶ï¼Œ<mark>ç«™ç‚¹åªè¦ç›‘å¬åˆ°RTSå¸§ã€CTSæˆ–æ•°æ®å¸§ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œå°±èƒ½çŸ¥é“ä¿¡é“è¢«å ç”¨çš„æŒç»­æ—¶é—´</mark>ï¼Œè€Œä¸éœ€è¦çœŸæ­£ç›‘å¬åˆ°ä¿¡é“ä¸Šçš„ä¿¡å·ï¼Œå› æ­¤è™šæ‹Ÿè½½æ³¢ç›‘å¬æœºåˆ¶èƒ½å‡å°‘éšè”½ç«™å¸¦æ¥çš„ç¢°æ’é—®é¢˜ã€‚</li></ul><p><strong>è™šæ‹Ÿè½½æ³¢ç›‘å¬æœºåˆ¶èƒ½å‡å°‘éšè”½ç«™å¸¦æ¥çš„ç¢°æ’é—®é¢˜çš„ç¤ºä¾‹</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231122222958453.png" alt="image-20231122222958453"></p><blockquote><p>Cä»Bå‘é€çš„CTSçŸ¥é“äº†å…¶å ç”¨ä¿¡é“çš„æ—¶é—´ï¼Œåˆ™è¯¥æ—¶é—´æ®µå†…Cæ˜¯ä¸ä¼šå‘Bå‘é€æ•°æ®çš„ï¼Œè¿™æ ·å°±èƒ½å‡å°‘éšè”½ç«™å¸¦æ¥çš„ç¢°æ’é—®é¢˜</p></blockquote><h2 id="MACåœ°å€ã€IPåœ°å€ä»¥åŠARPåè®®"><a href="#MACåœ°å€ã€IPåœ°å€ä»¥åŠARPåè®®" class="headerlink" title="MACåœ°å€ã€IPåœ°å€ä»¥åŠARPåè®®"></a>MACåœ°å€ã€IPåœ°å€ä»¥åŠARPåè®®</h2><ul><li>MACåœ°å€æ˜¯ä»¥å¤ªç½‘çš„MACå­å±‚æ‰€ä½¿ç”¨çš„åœ°å€ï¼›ï¼ˆå±äºæ•°æ®é“¾è·¯å±‚ï¼‰</li><li>IPåœ°å€æ˜¯TCP&#x2F;IPä½“ç³»ç»“æ„ç½‘é™…å±‚æ‰€ä½¿ç”¨çš„åœ°å€ï¼›ï¼ˆå±äºç½‘é™…å±‚ï¼‰</li><li>ARPåè®®å±äºTCP&#x2F;IPä½“ç³»ç»“æ„çš„ç½‘é™…å±‚ï¼Œå…¶ä½œç”¨æ˜¯å·²çŸ¥è®¾å¤‡æ‰€åˆ†é…åˆ°çš„IPåœ°å€ï¼Œ<mark>ä½¿ç”¨ARPåè®®å¯ä»¥é€šè¿‡è¯¥IPåœ°å€è·å–åˆ°è®¾å¤‡çš„MACåœ°å€</mark>ï¼›ï¼ˆå±äºç½‘é™…å±‚ï¼‰</li><li>å°½ç®¡IPåœ°å€å’ŒARPåè®®å±äºTCP&#x2F;IPä½“ç³»ç»“æ„çš„ç½‘é™…å±‚(è€Œä¸å±äºæ•°æ®é“¾è·¯å±‚)ï¼Œä½†æ˜¯å®ƒä»¬ä¸MACåœ°å€å­˜åœ¨ä¸€å®šçš„å…³ç³»ï¼Œå¹¶ä¸”æˆ‘ä»¬æ—¥å¸¸çš„ç½‘ç»œåº”ç”¨éƒ½ç¦»ä¸å¼€MACåœ°å€ã€IPåœ°å€ä»¥åŠARPåè®®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†è¿™ä¸‰è€…æ”¾åœ¨ä¸€èµ·è®¨è®ºã€‚</li></ul><h3 id="MACåœ°å€"><a href="#MACåœ°å€" class="headerlink" title="MACåœ°å€"></a>MACåœ°å€</h3><blockquote><ul><li>ä½¿ç”¨ç‚¹å¯¹ç‚¹ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚ä¸éœ€è¦ä½¿ç”¨åœ°å€</li><li>ä½¿ç”¨å¹¿æ’­ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚å¿…é¡»ä½¿ç”¨åœ°å€æ¥åŒºåˆ†å„ä¸»æœº</li></ul></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201014223659993.png" alt="image-20201014223659993"></p><h4 id="å¹¿æ’­ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚å¿…é¡»ä½¿ç”¨åœ°å€ï¼ˆMACï¼‰"><a href="#å¹¿æ’­ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚å¿…é¡»ä½¿ç”¨åœ°å€ï¼ˆMACï¼‰" class="headerlink" title="å¹¿æ’­ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚å¿…é¡»ä½¿ç”¨åœ°å€ï¼ˆMACï¼‰"></a>å¹¿æ’­ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚å¿…é¡»ä½¿ç”¨åœ°å€ï¼ˆMACï¼‰</h4><ul><li>å½“å¤šä¸ªä¸»æœºè¿æ¥åœ¨åŒä¸€ä¸ªå¹¿æ’­ä¿¡é“ä¸Šï¼Œè¦æƒ³å®ç°ä¸¤ä¸ªä¸»æœºä¹‹é—´çš„é€šä¿¡ï¼Œåˆ™æ¯ä¸ªä¸»æœºéƒ½å¿…é¡»æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ï¼Œå³ä¸€ä¸ªæ•°æ®é“¾è·¯å±‚åœ°å€;</li><li>åœ¨æ¯ä¸ªä¸»æœºå‘é€çš„<mark>å¸§ä¸­å¿…é¡»æºå¸¦æ ‡è¯†å‘é€ä¸»æœºå’Œæ¥æ”¶ä¸»æœºçš„åœ°å€</mark>ã€‚ç”±äºè¿™ç±»åœ°å€æ˜¯ç”¨äºåª’ä½“æ¥å…¥æ§åˆ¶<br>MAC(Media Access Control)ï¼Œå› æ­¤è¿™ç±»åœ°å€è¢«ç§°ä¸º<mark>MACåœ°å€</mark>ï¼›</li><li>MACåœ°å€åˆç§°ä½œç¡¬ä»¶åœ°å€æˆ–ç‰©ç†åœ°å€ã€‚ï¼ˆ<mark>æ³¨æ„ï¼šè¿™å¹¶ä¸æ„å‘³ç€MACåœ°å€å±äºç½‘ç»œä½“ç³»ç»“æ„ä¸­çš„ç‰©ç†å±‚</mark>ï¼‰</li><li>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä¸»æœºä¼šåŒ…å«ä¸¤ä¸ªç½‘ç»œé€‚é…å™¨: æœ‰çº¿å±€åŸŸç½‘é€‚é…å™¨(æœ‰ç½‘å¡)å’Œæ— çº¿å±€åŸŸç½‘é€‚é…å™¨(æ— çº¿ç½‘å¡)ã€‚æ¯ä¸ªç½‘ç»œé€‚é…å™¨éƒ½æœ‰ä¸€ä¸ªå…¨çƒå”¯ä¸€çš„MACåœ°å€ã€‚è€Œäº¤æ¢æœºå’Œè·¯ç”±å™¨å¾€å¾€æ‹¥æœ‰æ›´å¤šçš„ç½‘ç»œæ¥å£ï¼Œæ‰€ä»¥ä¼šæ‹¥æœ‰æ›´å¤šçš„MACåœ°å€ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œ<mark>ä¸¥æ ¼æ¥è¯´ï¼ŒMACåœ°å€æ˜¯å¯¹ç½‘ç»œä¸Šå„æ¥å£çš„å”¯ä¸€æ ‡è¯†ï¼Œè€Œä¸æ˜¯å¯¹ç½‘ç»œä¸Šå„è®¾å¤‡çš„å”¯ä¸€æ ‡è¯†</mark>ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231123152543906.png" alt="image-20231123152543906"></p><h4 id="IEEE-802å±€åŸŸç½‘çš„MACåœ°å€æ ¼å¼"><a href="#IEEE-802å±€åŸŸç½‘çš„MACåœ°å€æ ¼å¼" class="headerlink" title="IEEE 802å±€åŸŸç½‘çš„MACåœ°å€æ ¼å¼"></a>IEEE 802å±€åŸŸç½‘çš„MACåœ°å€æ ¼å¼</h4><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201014225358570.png" alt="image-20201014225358570"></p><hr><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201014230248959.png" alt="image-20201014230248959"></p><blockquote><p><strong>å¯¹äºæ£€æŸ¥å‡ºçš„æ— æ•ˆ</strong> <strong>MAC</strong> <strong>å¸§å°±ç®€å•åœ°ä¸¢å¼ƒã€‚ä»¥å¤ªç½‘ä¸è´Ÿè´£é‡ä¼ ä¸¢å¼ƒçš„å¸§ã€‚</strong> </p></blockquote><h4 id="IEEE-802å±€åŸŸç½‘çš„MACåœ°å€å‘é€é¡ºåº"><a href="#IEEE-802å±€åŸŸç½‘çš„MACåœ°å€å‘é€é¡ºåº" class="headerlink" title="IEEE 802å±€åŸŸç½‘çš„MACåœ°å€å‘é€é¡ºåº"></a>IEEE 802å±€åŸŸç½‘çš„MACåœ°å€å‘é€é¡ºåº</h4><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201014230625182.png" alt="image-20201014230625182"></p><h4 id="å•æ’­MACåœ°å€ä¸¾ä¾‹"><a href="#å•æ’­MACåœ°å€ä¸¾ä¾‹" class="headerlink" title="å•æ’­MACåœ°å€ä¸¾ä¾‹"></a>å•æ’­MACåœ°å€ä¸¾ä¾‹</h4><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201014230822305.png" alt="image-20201014230822305"></p><blockquote><p>ä¸»æœºBç»™ä¸»æœºCå‘é€<strong>å•æ’­å¸§</strong>ï¼Œä¸»æœºBé¦–å…ˆè¦æ„å»ºè¯¥<strong>å•æ’­å¸§</strong>ï¼Œ<strong>åœ¨å¸§é¦–éƒ¨ä¸­çš„ç›®çš„åœ°å€å­—æ®µå¡«å…¥ä¸»æœºCçš„MACåœ°å€</strong>ï¼Œæºåœ°å€å­—æ®µå¡«å…¥è‡ªå·±çš„MACåœ°å€ï¼Œå†åŠ ä¸Šå¸§é¦–éƒ¨çš„å…¶ä»–å­—æ®µã€æ•°æ®è½½è·ä»¥åŠå¸§å°¾éƒ¨ï¼Œå°±æ„æˆäº†è¯¥<strong>å•æ’­å¸§</strong></p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201014231244655.png" alt="image-20201014231244655"></p><blockquote><p>ä¸»æœºBå°†è¯¥<strong>å•æ’­å¸§</strong>å‘é€å‡ºå»ï¼Œä¸»æœºAå’ŒCéƒ½ä¼šæ”¶åˆ°è¯¥<strong>å•æ’­å¸§</strong></p><p>ä¸»æœºAçš„ç½‘å¡å‘ç°è¯¥<strong>å•æ’­å¸§</strong>çš„ç›®çš„MACåœ°å€ä¸è‡ªå·±çš„MACåœ°å€ä¸åŒ¹é…ï¼Œä¸¢å¼ƒè¯¥å¸§</p><p>ä¸»æœºCçš„ç½‘å¡å‘ç°è¯¥<strong>å•æ’­å¸§</strong>çš„ç›®çš„MACåœ°å€ä¸è‡ªå·±çš„MACåœ°å€åŒ¹é…ï¼Œæ¥å—è¯¥å¸§ï¼Œå¹¶å°†è¯¥å¸§äº¤ç»™å…¶ä¸Šå±‚å¤„ç†</p></blockquote><h4 id="å¹¿æ’­MACåœ°å€ä¸¾ä¾‹"><a href="#å¹¿æ’­MACåœ°å€ä¸¾ä¾‹" class="headerlink" title="å¹¿æ’­MACåœ°å€ä¸¾ä¾‹"></a>å¹¿æ’­MACåœ°å€ä¸¾ä¾‹</h4><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201014231754669.png" alt="image-20201014231754669"></p><blockquote><p>å‡è®¾ä¸»æœºBè¦å‘é€ä¸€ä¸ª<strong>å¹¿æ’­å¸§</strong>ï¼Œä¸»æœºBé¦–å…ˆè¦æ„å»ºè¯¥<strong>å¹¿æ’­å¸§</strong>ï¼Œ<strong>åœ¨å¸§é¦–éƒ¨ä¸­çš„ç›®çš„åœ°å€å­—æ®µå¡«å…¥å¹¿æ’­åœ°å€</strong>ï¼Œä¹Ÿå°±æ˜¯åå…­è¿›åˆ¶çš„å…¨Fï¼Œæºåœ°å€å­—æ®µå¡«å…¥è‡ªå·±çš„MACåœ°å€ï¼Œå†åŠ ä¸Šå¸§é¦–éƒ¨ä¸­çš„å…¶ä»–å­—æ®µã€æ•°æ®è½½è·ä»¥åŠå¸§å°¾éƒ¨ï¼Œå°±æ„æˆäº†è¯¥<strong>å¹¿æ’­å¸§</strong></p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201014232132424.png" alt="image-20201014232132424"></p><blockquote><p>ä¸»æœºBè®²è¯¥<strong>å¹¿æ’­å¸§</strong>å‘é€å‡ºå»ï¼Œä¸»æœºAå’ŒCéƒ½ä¼šæ”¶åˆ°è¯¥<strong>å¹¿æ’­å¸§</strong>ï¼Œ<strong>å‘ç°è¯¥å¸§é¦–éƒ¨ä¸­çš„ç›®çš„åœ°å€å­—æ®µçš„å†…å®¹æ˜¯å¹¿æ’­åœ°å€</strong>ï¼Œå°±çŸ¥é“è¯¥å¸§æ˜¯<strong>å¹¿æ’­å¸§</strong>ï¼Œä¸»æœºAå’Œä¸»æœºCéƒ½æ¥å—è¯¥å¸§ï¼Œå¹¶å°†è¯¥å¸§äº¤ç»™ä¸Šå±‚å¤„ç†</p></blockquote><h4 id="å¤šæ’­MACåœ°å€ä¸¾ä¾‹"><a href="#å¤šæ’­MACåœ°å€ä¸¾ä¾‹" class="headerlink" title="å¤šæ’­MACåœ°å€ä¸¾ä¾‹"></a>å¤šæ’­MACåœ°å€ä¸¾ä¾‹</h4><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201014232714791.png" alt="image-20201014232714791"></p><blockquote><p>å‡è®¾ä¸»æœºAè¦å‘é€<strong>å¤šæ’­å¸§</strong>ç»™è¯¥<strong>å¤šæ’­åœ°å€</strong>ã€‚å°†è¯¥<strong>å¤šæ’­åœ°å€</strong>çš„å·¦èµ·ç¬¬ä¸€ä¸ªå­—èŠ‚å†™æˆ8ä¸ªæ¯”ç‰¹ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚çš„æœ€ä½æ¯”ç‰¹ä½æ˜¯1ï¼Œè¿™å°±è¡¨æ˜è¯¥åœ°å€æ˜¯<strong>å¤šæ’­åœ°å€</strong>ã€‚</p><p>å¿«é€Ÿåˆ¤æ–­åœ°å€æ˜¯ä¸æ˜¯<strong>å¤šæ’­åœ°å€</strong>ï¼Œå°±æ˜¯ä¸Šå›¾æ‰€ç¤ºç®­å¤´æ‰€æŒ‡çš„ç¬¬åå…­è¿›åˆ¶æ•°ä¸èƒ½æ•´é™¤2ï¼ˆ1,3,5,7,9,B,D,Fï¼‰ï¼Œåˆ™è¯¥åœ°å€æ˜¯<strong>å¤šæ’­åœ°å€</strong></p><p>å‡è®¾ä¸»æœºBï¼ŒCå’ŒDæ”¯æŒå¤šæ’­ï¼Œå„ç”¨æˆ·ç»™è‡ªå·±çš„ä¸»æœºé…ç½®å¤šæ’­ç»„åˆ—è¡¨<strong>å¦‚ä¸‹æ‰€ç¤º</strong></p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201015001243584.png" alt="image-20201015001243584"></p><blockquote><p>ä¸»æœºBå±äºä¸¤ä¸ªå¤šæ’­ç»„ï¼Œä¸»æœºCä¹Ÿå±äºä¸¤ä¸ªå¤šæ’­ç»„ï¼Œè€Œä¸»æœºDä¸å±äºä»»ä½•å¤šæ’­ç»„</p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201015001535528.png" alt="image-20201015001535528"></p><blockquote><p>ä¸»æœºAé¦–å…ˆè¦æ„å»ºè¯¥<strong>å¤šæ’­å¸§</strong>ï¼Œ<strong>åœ¨å¸§é¦–éƒ¨ä¸­çš„ç›®çš„åœ°å€å­—æ®µå¡«å…¥è¯¥å¤šæ’­åœ°å€</strong>ï¼Œæºåœ°å€ç‚¹å¡«å…¥è‡ªå·±çš„MACåœ°å€ï¼Œå†åŠ ä¸Šå¸§é¦–éƒ¨ä¸­çš„å…¶ä»–å­—æ®µã€æ•°æ®è½½è·ä»¥åŠå¸§å°¾éƒ¨ï¼Œå°±æ„æˆäº†è¯¥<strong>å¤šæ’­å¸§</strong></p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201015002054876.png" alt="image-20201015002054876"></p><blockquote><p>ä¸»æœºAå°†è¯¥<strong>å¤šæ’­å¸§</strong>å‘é€å‡ºå»ï¼Œä¸»æœºBã€Cã€Déƒ½ä¼šæ”¶åˆ°è¯¥<strong>å¤šæ’­å¸§</strong></p><p><strong>ä¸»æœºBå’ŒCå‘ç°è¯¥å¤šæ’­å¸§çš„ç›®çš„MACåœ°å€åœ¨è‡ªå·±çš„å¤šæ’­ç»„åˆ—è¡¨ä¸­</strong>ï¼Œä¸»æœºBå’ŒCéƒ½ä¼šæ¥å—è¯¥å¸§</p><p>ä¸»æœºDå‘ç°è¯¥<strong>å¤šæ’­å¸§</strong>çš„ç›®çš„MACåœ°å€ä¸åœ¨è‡ªå·±å¾—å¤šæ’­ç»„åˆ—è¡¨ä¸­ï¼Œåˆ™ä¸¢å¼ƒè¯¥<strong>å¤šæ’­å¸§</strong></p></blockquote><h3 id="IPåœ°å€"><a href="#IPåœ°å€" class="headerlink" title="IPåœ°å€"></a>IPåœ°å€</h3><p><mark><strong>IPåœ°å€å’ŒMACåœ°å€çš„åŒºåˆ«ï¼š</strong></mark></p><ol><li><strong>ä½œç”¨å±‚æ¬¡ä¸åŒï¼š</strong><ul><li><strong>MACåœ°å€ï¼š</strong> ä½œç”¨äºæ•°æ®é“¾è·¯å±‚ï¼ˆç¬¬äºŒå±‚ï¼‰ä¸Šï¼Œç”¨äºåœ¨å±€åŸŸç½‘å†…å”¯ä¸€<strong>æ ‡è¯†ç½‘ç»œè®¾å¤‡çš„ç‰©ç†ç½‘ç»œæ¥å£</strong>ï¼Œä¾‹å¦‚ä»¥å¤ªç½‘å¡ã€‚</li><li><strong>IPåœ°å€ï¼š</strong> ä½œç”¨äºç½‘ç»œå±‚ï¼ˆç¬¬ä¸‰å±‚ï¼‰ä¸Šï¼Œç”¨äºåœ¨å…¨çƒèŒƒå›´å†…å”¯ä¸€<strong>æ ‡è¯†ç½‘ç»œä¸Šçš„è®¾å¤‡</strong>ï¼Œå¹¶æ”¯æŒè®¾å¤‡ä¹‹é—´çš„é€»è¾‘é€šä¿¡ã€‚</li></ul></li><li><strong>å”¯ä¸€æ€§èŒƒå›´ä¸åŒï¼š</strong><ul><li><strong>MACåœ°å€ï¼š</strong> åœ¨ä¸€ä¸ªå±€åŸŸç½‘å†…æ˜¯å”¯ä¸€çš„ï¼Œç”±ç½‘ç»œè®¾å¤‡çš„åˆ¶é€ å•†åˆ†é…ã€‚å½“æ•°æ®åŒ…åœ¨å±€åŸŸç½‘å†…ä¼ è¾“æ—¶ï¼Œè·¯ç”±å™¨é€šå¸¸ä¸ä¿®æ”¹MACåœ°å€ã€‚</li><li><strong>IPåœ°å€ï¼š</strong> åœ¨å…¨çƒèŒƒå›´å†…æ˜¯å”¯ä¸€çš„ï¼Œç”±äº’è”ç½‘æ³¨å†Œæœºæ„ï¼ˆå¦‚ICANNï¼‰åˆ†é…ã€‚IPåœ°å€ç”¨äºåœ¨ä¸åŒç½‘ç»œä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œè·¯ç”±å™¨åœ¨è½¬å‘æ•°æ®åŒ…æ—¶é€šå¸¸ä¼šä¿®æ”¹æºå’Œç›®æ ‡çš„IPåœ°å€ã€‚</li></ul></li><li><strong>å±‚æ¬¡å…³ç³»ï¼š</strong><ul><li><strong>MACåœ°å€ï¼š</strong> ä½äºæ•°æ®é“¾è·¯å±‚ï¼Œç”¨äºåœ¨åŒä¸€å±€åŸŸç½‘å†…ç›´æ¥é€šä¿¡ï¼Œæ˜¯æ•°æ®é“¾è·¯å±‚çš„åœ°å€ã€‚</li><li><strong>IPåœ°å€ï¼š</strong> ä½äºç½‘ç»œå±‚ï¼Œç”¨äºåœ¨ä¸åŒç½‘ç»œä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œæ˜¯ç½‘ç»œå±‚çš„åœ°å€ã€‚</li></ul></li></ol><blockquote><p>IPåœ°å€å±äºç½‘ç»œå±‚çš„èŒƒç•´ï¼Œä¸å±äºæ•°æ®é“¾è·¯å±‚çš„èŒƒç•´</p></blockquote><p>ä¸‹é¢å†…å®¹è®²çš„æ˜¯IPåœ°å€çš„ä½¿ç”¨ï¼Œè¯¦ç»†çš„IPåœ°å€å†…å®¹åœ¨ç½‘ç»œå±‚ä¸­ä»‹ç»</p><h4 id="åŸºæœ¬æ¦‚å¿µ-5"><a href="#åŸºæœ¬æ¦‚å¿µ-5" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h4><ul><li><p>IPåœ°å€æ˜¯å› ç‰¹ç½‘(Internet) ä¸Šçš„ä¸»æœºå’Œè·¯ç”±å™¨æ‰€ä½¿ç”¨çš„åœ°å€ï¼Œç”¨äºæ ‡è¯†ä¸¤éƒ¨åˆ†ä¿¡æ¯:</p><ul><li><strong>ç½‘ç»œç¼–å·</strong>: æ ‡è¯†å› ç‰¹ç½‘ä¸Šæ•°ä»¥ç™¾ä¸‡è®¡çš„ç½‘ç»œ</li><li><strong>ä¸»æœºç¼–å·</strong>: æ ‡è¯†åŒä¸€ç½‘ç»œä¸Šä¸åŒä¸»æœº(æˆ–è·¯ç”±å™¨å„æ¥å£)</li></ul></li><li><p>å¾ˆæ˜¾ç„¶ï¼Œä¹‹å‰ä»‹ç»çš„MACåœ°å€ä¸å…·å¤‡åŒºåˆ†ä¸åŒç½‘ç»œçš„åŠŸèƒ½ã€‚</p><ul><li>å¦‚æœåªæ˜¯ä¸€ä¸ªå•ç‹¬çš„ç½‘ç»œï¼Œä¸æ¥å…¥å› ç‰¹ç½‘ï¼Œå¯ä»¥åªä½¿ç”¨MACåœ°å€ (è¿™ä¸æ˜¯ä¸€èˆ¬ç”¨æˆ·çš„åº”ç”¨æ–¹å¼)</li><li>å¦‚æœä¸»æœºæ‰€åœ¨çš„ç½‘ç»œè¦æ¥å…¥å› ç‰¹ç½‘ï¼Œåˆ™IPåœ°å€å’ŒMACåœ°å€éƒ½éœ€è¦ä½¿ç”¨ã€‚</li></ul></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231123161030825.png" alt="image-20231123161030825"></p><h4 id="ä»ç½‘ç»œä½“ç³»ç»“æ„çœ‹IPåœ°å€ä¸MACåœ°å€"><a href="#ä»ç½‘ç»œä½“ç³»ç»“æ„çœ‹IPåœ°å€ä¸MACåœ°å€" class="headerlink" title="ä»ç½‘ç»œä½“ç³»ç»“æ„çœ‹IPåœ°å€ä¸MACåœ°å€"></a>ä»ç½‘ç»œä½“ç³»ç»“æ„çœ‹IPåœ°å€ä¸MACåœ°å€</h4><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231123161405686.png" alt="image-20231123161405686"></p><h4 id="æ•°æ®åŒ…è½¬å‘è¿‡ç¨‹ä¸­IPåœ°å€ä¸MACåœ°å€çš„å˜åŒ–æƒ…å†µ"><a href="#æ•°æ®åŒ…è½¬å‘è¿‡ç¨‹ä¸­IPåœ°å€ä¸MACåœ°å€çš„å˜åŒ–æƒ…å†µ" class="headerlink" title="æ•°æ®åŒ…è½¬å‘è¿‡ç¨‹ä¸­IPåœ°å€ä¸MACåœ°å€çš„å˜åŒ–æƒ…å†µ"></a>æ•°æ®åŒ…è½¬å‘è¿‡ç¨‹ä¸­IPåœ°å€ä¸MACåœ°å€çš„å˜åŒ–æƒ…å†µ</h4><ul><li>æ•°æ®åŒ…è½¬å‘è¿‡ç¨‹ä¸­<mark>æºIPåœ°å€å’Œç›®çš„IPåœ°å€ä¿æŒä¸å˜</mark></li><li>æ•°æ®åŒ…è½¬å‘è¿‡ç¨‹ä¸­<mark>æºMACåœ°å€å’Œç›®çš„MACåœ°å€é€ä¸ªé“¾è·¯ (æˆ–é€ä¸ªç½‘ç»œ)æ”¹å˜</mark></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231123161720608.png" alt="image-20231123161720608"></p><blockquote><p>å¦‚ä½•ä»IPåœ°å€æ‰¾å‡ºå…¶å¯¹åº”çš„MACåœ°å€ï¼Ÿ</p><p>ARPåè®®</p></blockquote><h3 id="ARPåè®®"><a href="#ARPåè®®" class="headerlink" title="ARPåè®®"></a>ARPåè®®</h3><p>å¦‚ä½•ä»IPåœ°å€æ‰¾å‡ºå…¶å¯¹åº”çš„MACåœ°å€ï¼Ÿ</p><p>ARPï¼ˆåœ°å€è§£æåè®®ï¼‰</p><h4 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h4><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201015113826197.png" alt="image-20201015113826197"></p><p>ARPé«˜é€Ÿç¼“å­˜è¡¨</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201015114052206.png" alt="image-20201015114052206"></p><blockquote><p>å½“ä¸»æœºBè¦ç»™ä¸»æœºCå‘é€æ•°æ®åŒ…æ—¶ï¼Œä¼šé¦–å…ˆåœ¨è‡ªå·±çš„ARPé«˜é€Ÿç¼“å­˜è¡¨ä¸­æŸ¥æ‰¾ä¸»æœºCçš„IPåœ°å€æ‰€å¯¹åº”çš„MACåœ°å€ï¼Œä½†æœªæ‰¾åˆ°ï¼Œå› æ­¤ï¼Œä¸»æœºBéœ€è¦å‘é€ARPè¯·æ±‚æŠ¥æ–‡ï¼Œæ¥è·å–ä¸»æœºCçš„MACåœ°å€</p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201015114444263.png" alt="image-20201015114444263"></p><blockquote><p>ARPè¯·æ±‚æŠ¥æ–‡æœ‰å…·ä½“çš„æ ¼å¼ï¼Œä¸Šå›¾çš„åªæ˜¯ç®€å•æè¿°</p><p>ARPè¯·æ±‚æŠ¥æ–‡è¢«å°è£…åœ¨MACå¸§ä¸­å‘é€ï¼Œç›®çš„åœ°å€ä¸ºå¹¿æ’­åœ°å€</p><p>ä¸»æœºBå‘é€å°è£…æœ‰ARPè¯·æ±‚æŠ¥æ–‡çš„å¹¿æ’­å¸§ï¼Œæ€»çº¿ä¸Šçš„å…¶ä»–ä¸»æœºéƒ½èƒ½æ”¶åˆ°è¯¥å¹¿æ’­å¸§</p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201015114811501.png" alt="image-20201015114811501"></p><blockquote><p>æ”¶åˆ°ARPè¯·æ±‚æŠ¥æ–‡çš„ä¸»æœºAå’Œä¸»æœºCä¼šæŠŠARPè¯·æ±‚æŠ¥æ–‡äº¤ç»™ä¸Šå±‚çš„ARPè¿›ç¨‹</p><p>ä¸»æœºAå‘ç°æ‰€è¯¢é—®çš„IPåœ°å€ä¸æ˜¯è‡ªå·±çš„IPåœ°å€ï¼Œå› æ­¤ä¸ç”¨ç†ä¼š</p><p>ä¸»æœºCçš„å‘ç°æ‰€è¯¢é—®çš„IPåœ°å€æ˜¯è‡ªå·±çš„IPåœ°å€ï¼Œéœ€è¦è¿›è¡Œç›¸åº”</p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201015115212170.png" alt="image-20201015115212170"></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201015115236673.png" alt="image-20201015115236673"></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201015115252972.png" alt="image-20201015115252972"></p><p>åŠ¨æ€ä¸é™æ€çš„åŒºåˆ«</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201015115831543.png" alt="image-20201015115831543"></p><p><strong>ARPåè®®åªèƒ½åœ¨ä¸€æ®µé“¾è·¯æˆ–ä¸€ä¸ªç½‘ç»œä¸Šä½¿ç”¨ï¼Œè€Œä¸èƒ½è·¨ç½‘ç»œä½¿ç”¨</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201015120108028.png" alt="image-20201015120108028"></p><blockquote><p>ARPåè®®çš„ä½¿ç”¨æ˜¯é€æ®µé“¾è·¯è¿›è¡Œçš„</p></blockquote><h4 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ul><li><p>æºä¸»æœºåœ¨è‡ªå·±çš„<mark>ARPé«˜é€Ÿç¼“å­˜è¡¨</mark>ä¸­æŸ¥æ‰¾ç›®çš„ä¸»æœºçš„IPåœ°å€æ‰€å¯¹åº”çš„MACåœ°å€ï¼Œè‹¥æ‰¾åˆ°äº†ï¼Œåˆ™å¯ä»¥å°è£…MACå¸§è¿›è¡Œå‘é€;è‹¥æ‰¾ä¸åˆ°ï¼Œåˆ™å‘é€<mark>ARPè¯·æ±‚(å°è£…åœ¨<strong>å¹¿æ’­MAC</strong>ä¸­)</mark> ï¼›</p></li><li><p>ç›®çš„ä¸»æœºæ”¶åˆ°ARPè¯·æ±‚åï¼Œå°†æºä¸»æœºçš„IPåœ°å€ä¸MACåœ°å€è®°å½•åˆ°è‡ªå·±çš„ARPé«˜é€Ÿç¼“å­˜è¡¨ä¸­ï¼Œç„¶åç»™æºä¸»æœºå‘é€<mark>ARPå“åº” (å°è£…åœ¨<strong>å•æ’­MACå¸§</strong>ä¸­)</mark>ï¼ŒARPå“åº”ä¸­åŒ…å«æœ‰ç›®çš„ä¸»æœºçš„IPåœ°å€å’ŒMACåœ°å€ï¼›</p></li><li><p>æºä¸»æœºæ”¶åˆ°ARPå“åº”åï¼Œå°†ç›®çš„ä¸»æœºçš„IPåœ°å€ä¸MACåœ°å€è®°å½•åˆ°è‡ªå·±çš„ARPé«˜é€Ÿç¼“å­˜è¡¨ä¸­ï¼Œç„¶åå°±å¯ä»¥å°è£…ä¹‹å‰æƒ³å‘é€çš„MACå¸§å¹¶å‘é€ç»™ç›®çš„ä¸»æœºï¼›</p></li><li><p><mark>ARPçš„ä½œç”¨èŒƒå›´: é€æ®µé“¾è·¯æˆ–é€ä¸ªç½‘ç»œä½¿ç”¨</mark></p></li><li><p><strong>é™¤ARPè¯·æ±‚å’Œå“åº”å¤–ï¼ŒARPè¿˜æœ‰å…¶ä»–ç±»å‹çš„æŠ¥æ–‡</strong>(ä¾‹å¦‚ç”¨äºæ£€æŸ¥IPåœ°å€å†²çªçš„â€œæ— æ•…ARPã€å…è´¹ARP(Gratuitous ARP)â€);</p></li><li><p>ARPæ²¡æœ‰å®‰å…¨éªŒè¯æœºåˆ¶ï¼Œ<strong>å­˜åœ¨ARPæ¬ºéª—(æ”»å‡»)é—®é¢˜</strong></p></li><li><p>ARPè¡¨ä¸­çš„IPåœ°å€ä¸MACåœ°å€çš„å¯¹åº”å…³ç³»è®°å½•ï¼Œæ˜¯<strong>ä¼šå®šæœŸè‡ªåŠ¨åˆ é™¤çš„</strong>ï¼Œ<strong>å› ä¸ºIPåœ°å€ä¸MACåœ°å€çš„å¯¹åº”å…³ç³»ä¸æ˜¯æ°¸ä¹…æ€§çš„</strong></p></li></ul><h2 id="é›†çº¿å™¨ä¸äº¤æ¢æœºçš„åŒºåˆ«"><a href="#é›†çº¿å™¨ä¸äº¤æ¢æœºçš„åŒºåˆ«" class="headerlink" title="é›†çº¿å™¨ä¸äº¤æ¢æœºçš„åŒºåˆ«"></a>é›†çº¿å™¨ä¸äº¤æ¢æœºçš„åŒºåˆ«</h2><h3 id="â­â­â­æ€»ç»“"><a href="#â­â­â­æ€»ç»“" class="headerlink" title="â­â­â­æ€»ç»“"></a>â­â­â­æ€»ç»“</h3><p>ğŸ”´ğŸŸ¢ğŸŸ¡<strong>GPTæ€»ç»“ï¼šé›†çº¿å™¨ï¼Œäº¤æ¢æœºï¼Œè·¯ç”±å™¨çš„åŒºåˆ«ï¼š</strong></p><ol><li><strong>åŠŸèƒ½ï¼š</strong><ul><li><strong>é›†çº¿å™¨ï¼ˆHubï¼‰ï¼š</strong> æ˜¯ä¸€ä¸ªç®€å•çš„ç½‘ç»œè®¾å¤‡ï¼Œå®ƒå°†æ”¶åˆ°çš„æ•°æ®åŒ…å¹¿æ’­åˆ°æ‰€æœ‰è¿æ¥çš„è®¾å¤‡ï¼Œè€Œæ— è®ºè¿™äº›è®¾å¤‡æ˜¯å¦æ˜¯ç›®æ ‡è®¾å¤‡ã€‚</li><li><strong>äº¤æ¢æœºï¼ˆSwitchï¼‰ï¼š</strong> æ˜¯ä¸€ä¸ªæ›´æ™ºèƒ½çš„è®¾å¤‡ï¼Œèƒ½å¤Ÿæ ¹æ®MACåœ°å€å­¦ä¹ å’Œè¿‡æ»¤æ•°æ®åŒ…ï¼Œåªå°†æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡è®¾å¤‡ï¼Œæé«˜ç½‘ç»œæ•ˆç‡ã€‚</li><li><strong>è·¯ç”±å™¨ï¼ˆRouterï¼‰ï¼š</strong> æ˜¯ç”¨äºè¿æ¥ä¸åŒç½‘ç»œçš„è®¾å¤‡ï¼Œèƒ½å¤Ÿç†è§£ç½‘ç»œå±‚ï¼ˆIPå±‚ï¼‰çš„åœ°å€ï¼Œå¹¶æ ¹æ®è¿™äº›åœ°å€è½¬å‘æ•°æ®åŒ…ï¼Œå®ç°ä¸åŒç½‘ç»œä¹‹é—´çš„é€šä¿¡ã€‚</li></ul></li><li><strong>å·¥ä½œå±‚æ¬¡ï¼š</strong><ul><li><strong>é›†çº¿å™¨ï¼š</strong> å·¥ä½œåœ¨ç‰©ç†å±‚ï¼Œä¸»è¦æ˜¯é€šè¿‡ç”µç¼†ä¼ è¾“æ¯”ç‰¹ã€‚</li><li><strong>äº¤æ¢æœºï¼š</strong> å·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚ï¼Œä½¿ç”¨MACåœ°å€è¿›è¡Œæ•°æ®åŒ…çš„è½¬å‘ã€‚</li><li><strong>è·¯ç”±å™¨ï¼š</strong> å·¥ä½œåœ¨ç½‘ç»œå±‚ï¼Œä½¿ç”¨IPåœ°å€è¿›è¡Œæ•°æ®åŒ…çš„è½¬å‘ã€‚</li></ul></li><li><strong>åœ°å€å­¦ä¹ å’Œè½¬å‘ï¼š</strong><ul><li><strong>é›†çº¿å™¨ï¼š</strong> ä¸å…·å¤‡åœ°å€å­¦ä¹ åŠŸèƒ½ï¼Œç®€å•åœ°å¹¿æ’­æ‰€æœ‰æ¥æ”¶åˆ°çš„æ•°æ®åŒ…ã€‚</li><li><strong>äº¤æ¢æœºï¼š</strong> é€šè¿‡å­¦ä¹ MACåœ°å€ï¼Œåªå°†æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡è®¾å¤‡ï¼Œ<mark>æé«˜ç½‘ç»œæ•ˆç‡</mark>ã€‚</li><li><strong>è·¯ç”±å™¨ï¼š</strong> é€šè¿‡å­¦ä¹ IPåœ°å€ï¼Œèƒ½å¤Ÿè¯†åˆ«ä¸åŒç½‘ç»œä¹‹é—´çš„æ•°æ®åŒ…ï¼Œå®ç°è·¨ç½‘ç»œçš„é€šä¿¡ã€‚</li></ul></li><li><strong>ç½‘ç»œå±‚æ¬¡ï¼š</strong><ul><li><strong>é›†çº¿å™¨å’Œäº¤æ¢æœºï¼š</strong> ä¸»è¦åœ¨å±€åŸŸç½‘å†…å·¥ä½œï¼Œè¿æ¥åŒä¸€ç½‘ç»œçš„è®¾å¤‡ã€‚</li><li><strong>è·¯ç”±å™¨ï¼š</strong> ä¸»è¦ç”¨äºè¿æ¥ä¸åŒç½‘ç»œï¼Œå®ç°è·¨ç½‘ç»œé€šä¿¡ã€‚</li></ul></li><li><strong>å¹¿æ’­å’Œç¢°æ’ï¼š</strong><ul><li><strong>é›†çº¿å™¨ï¼š</strong> ä¼šå¯¼è‡´ç½‘ç»œä¸­çš„å¹¿æ’­é£æš´å’Œç¢°æ’ï¼Œå½±å“æ€§èƒ½ã€‚</li><li><strong>äº¤æ¢æœºï¼š</strong> é€šè¿‡åˆ’åˆ†å†²çªåŸŸï¼ˆcollision domainï¼‰å’Œå¹¿æ’­åŸŸï¼ˆbroadcast domainï¼‰ï¼Œå‡å°‘äº†å¹¿æ’­å’Œç¢°æ’ã€‚</li><li><strong>è·¯ç”±å™¨ï¼š</strong> å°†ä¸åŒç½‘ç»œéš”ç¦»ï¼Œå‡å°‘äº†å¹¿æ’­åŸŸã€‚</li></ul></li></ol><p>æ€»çš„æ¥è¯´ï¼Œé›†çº¿å™¨ä¸»è¦æ˜¯ç‰©ç†å±‚è®¾å¤‡ï¼Œäº¤æ¢æœºæ˜¯æ•°æ®é“¾è·¯å±‚è®¾å¤‡ï¼Œè€Œè·¯ç”±å™¨åˆ™å·¥ä½œåœ¨ç½‘ç»œå±‚ã€‚å®ƒä»¬å„è‡ªåœ¨ç½‘ç»œä¸­å‘æŒ¥ä¸åŒçš„ä½œç”¨ï¼Œæœ‰åŠ©äºæ„å»ºçµæ´»ä¸”é«˜æ•ˆçš„è®¡ç®—æœºç½‘ç»œã€‚</p><h3 id="é›†çº¿å™¨"><a href="#é›†çº¿å™¨" class="headerlink" title="é›†çº¿å™¨"></a>é›†çº¿å™¨</h3><p><strong>é›†çº¿å™¨</strong>çš„ä»¥å¤ªç½‘åœ¨é€»è¾‘ä¸Šä»æ˜¯ä¸ªæ€»çº¿ç½‘ï¼Œéœ€è¦ä½¿ç”¨CSMA&#x2F;CDåè®®æ¥åè°ƒå„ä¸»æœºäº‰ç”¨æ€»çº¿ï¼Œåªèƒ½å·¥ä½œåœ¨åŠåŒå·¥æ¨¡å¼ï¼Œæ”¶å‘å¸§ä¸èƒ½åŒæ—¶è¿›è¡Œ</p><p><strong>ä½¿ç”¨é›†çº¿å™¨æ‰©å±•</strong>ï¼šå°†å¤šä¸ªä»¥å¤ªç½‘æ®µè¿æˆæ›´å¤§çš„ã€å¤šçº§æ˜Ÿå½¢ç»“æ„çš„ä»¥å¤ªç½‘ï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231123205018297.png" alt="image-20231123205018297"></p><ul><li><strong>ä¼˜ç‚¹</strong><ol><li>ä½¿åŸæ¥å±äºä¸åŒç¢°æ’åŸŸçš„ä»¥å¤ªç½‘ä¸Šçš„è®¡ç®—æœºèƒ½å¤Ÿè¿›è¡Œè·¨ç¢°æ’åŸŸçš„é€šä¿¡ã€‚</li><li>æ‰©å¤§äº†ä»¥å¤ªç½‘è¦†ç›–çš„åœ°ç†èŒƒå›´ã€‚</li></ol></li><li><strong>ç¼ºç‚¹</strong><ol><li><mark><strong>ç¢°æ’åŸŸ</strong>å¢å¤§äº†</mark>ï¼Œä½†æ€»çš„ååé‡å¹¶æœªæé«˜ã€‚</li></ol></li></ul><h3 id="äº¤æ¢æœº"><a href="#äº¤æ¢æœº" class="headerlink" title="äº¤æ¢æœº"></a>äº¤æ¢æœº</h3><p><img src="file://G:/BaiduNetdiskDownload/1.%E8%B5%84%E6%96%99/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%88%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%EF%BC%89.assets/image-20201015152232158.png?lastModify=1700702613" alt="image-20201015152232158"></p><blockquote><p>ä½¿ç”¨<strong>é›†çº¿å™¨</strong>äº’è¿è€Œæˆçš„å…±äº«æ€»çº¿å¼ä»¥å¤ªç½‘ä¸Šçš„æŸä¸ªä¸»æœºï¼Œè¦ç»™å¦ä¸€ä¸ªä¸»æœºå‘é€å•æ’­å¸§ï¼Œè¯¥å•æ’­å¸§ä¼šé€šè¿‡å…±äº«æ€»çº¿ä¼ è¾“åˆ°<strong>æ€»çº¿ä¸Šçš„å…¶ä»–å„ä¸ªä¸»æœº</strong></p><p>ä½¿ç”¨äº¤æ¢æœºäº’è¿è€Œæˆçš„äº¤æ¢å¼ä»¥å¤ªç½‘ä¸Šçš„æŸä¸ªä¸»æœºï¼Œè¦ç»™å¦ä¸€ä¸ªä¸»æœºå‘é€å•æ’­å¸§ï¼Œ<mark>è¯¥å•æ’­å¸§è¿›å…¥äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šå°†è¯¥å•æ’­å¸§è½¬å‘ç»™ç›®çš„ä¸»æœºï¼Œ<strong>è€Œä¸æ˜¯ç½‘ç»œä¸­çš„å…¶ä»–å„ä¸ªä¸»æœº</strong></mark>ã€‚</p><p><strong>è¿™ä¸ªä¾‹å­çš„å‰ææ¡ä»¶æ˜¯å¿½ç•¥ARPè¿‡ç¨‹ï¼Œå¹¶å‡è®¾äº¤æ¢æœºçš„å¸§äº¤æ¢è¡¨å·²ç»å­¦ä¹ æˆ–é…ç½®å¥½äº†</strong></p></blockquote><p><strong>åŸºæœ¬ç‰¹ç‚¹ï¼š</strong></p><ul><li>ä»¥å¤ªç½‘äº¤æ¢æœºé€šå¸¸éƒ½æœ‰<mark>å¤šä¸ªæ¥å£</mark>ã€‚æ¯ä¸ªæ¥å£éƒ½å¯ä»¥ç›´æ¥ä¸ä¸€å°ä¸»æœºæˆ–å¦ä¸€ä¸ªä»¥å¤ªç½‘äº¤æ¢æœºç›¸è¿ã€‚ä¸€èˆ¬éƒ½å·¥ä½œåœ¨<mark>å…¨åŒå·¥æ–¹å¼</mark>ã€‚</li><li>ä»¥å¤ªç½‘äº¤æ¢æœºå…·æœ‰å¹¶è¡Œæ€§ï¼Œèƒ½<mark>åŒæ—¶è¿é€šå¤šå¯¹æ¥å£</mark>ï¼Œä½¿å¤šå¯¹ä¸»æœºèƒ½åŒæ—¶é€šä¿¡ï¼Œ<mark>æ— ç¢°æ’</mark> (ä¸ä½¿ç”¨CSMA&#x2F;CDåè®®)</li><li>ä»¥å¤ªç½‘äº¤æ¢æœºä¸€èˆ¬éƒ½å…·æœ‰å¤šç§é€Ÿç‡çš„æ¥å£ï¼Œä¾‹å¦‚:10Mb&#x2F;sã€100Mb&#x2F;sã€1Gb&#x2F;sã€10Gb&#x2F;sæ¥å£çš„å¤šç§ç»„åˆ</li><li>ä»¥å¤ªç½‘äº¤æ¢æœº<mark>å·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚</mark> (ä¹ŸåŒ…æ‹¬ç‰©ç†å±‚)ï¼Œå®ƒæ”¶åˆ°å¸§åï¼Œåœ¨å¸§äº¤æ¢è¡¨ä¸­<mark>æŸ¥æ‰¾å¸§çš„ç›®çš„MACåœ°å€æ‰€å¯¹åº”çš„æ¥å£å·</mark>ï¼Œç„¶åé€šè¿‡è¯¥æ¥å£è½¬å‘å¸§ã€‚</li><li>ä»¥å¤ªç½‘äº¤æ¢æœºæ˜¯ä¸€ç§å³æ’å³ç”¨è®¾å¤‡ï¼Œå…¶å†…éƒ¨çš„æ¢äº¤æ¢è¡¨æ˜¯é€šè¿‡<mark>è‡ªå­¦ä¹ ç®—æ³•</mark>è‡ªåŠ¨åœ°é€æ¸å»ºç«‹èµ·æ¥çš„ã€‚</li><li>å¸§çš„ä¸¤ç§è½¬å‘æ–¹å¼ï¼š<ol><li><strong>å­˜å‚¨è½¬å‘</strong></li><li><strong>ç›´é€šäº¤æ¢</strong>ï¼šé‡‡ç”¨åŸºäºç¡¬ä»¶çš„äº¤å‰çŸ©é˜µ (äº¤æ¢æ—¶å»¶éå¸¸å°ï¼Œä½†ä¸æ£€æŸ¥å¸§æ˜¯å¦å³å·®é”™)</li></ol></li></ul><p><strong>å¤šå°ä¸»æœºåŒæ—¶ç»™å¦ä¸€å°ä¸»æœºå‘é€å•æ’­å¸§ï¼š</strong></p><ul><li><p>é›†çº¿å™¨ä»¥å¤ªç½‘ï¼šä¼šäº§ç”Ÿç¢°æ’ï¼Œé­é‡ç¢°æ’çš„å¸§ä¼šä¼ æ’­åˆ°æ€»çº¿ä¸Šçš„å„ä¸»æœº</p></li><li><p>äº¤æ¢æœºä»¥å¤ªç½‘ï¼šä¼šå°†å®ƒä»¬ç¼“å­˜èµ·æ¥ï¼Œç„¶åé€ä¸ªè½¬å‘ç»™ç›®çš„ä¸»æœºï¼Œä¸ä¼šäº§ç”Ÿç¢°æ’</p></li></ul><h2 id="ä»¥å¤ªç½‘äº¤æ¢æœºè‡ªå­¦ä¹ å’Œè½¬å‘å¸§çš„æµç¨‹"><a href="#ä»¥å¤ªç½‘äº¤æ¢æœºè‡ªå­¦ä¹ å’Œè½¬å‘å¸§çš„æµç¨‹" class="headerlink" title="ä»¥å¤ªç½‘äº¤æ¢æœºè‡ªå­¦ä¹ å’Œè½¬å‘å¸§çš„æµç¨‹"></a>ä»¥å¤ªç½‘äº¤æ¢æœºè‡ªå­¦ä¹ å’Œè½¬å‘å¸§çš„æµç¨‹</h2><h3 id="åŸºæœ¬æ¦‚å¿µ-6"><a href="#åŸºæœ¬æ¦‚å¿µ-6" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><ul><li>ä»¥å¤ªç½‘äº¤æ¢æœºå·¥ä½œåœ¨<strong>æ•°æ®é“¾è·¯å±‚</strong> ï¼ˆä¹ŸåŒ…æ‹¬ç‰©ç†å±‚ï¼‰</li><li>ä»¥å¤ªç½‘äº¤æ¢æœºæ”¶åˆ°å¸§åï¼Œåœ¨å¸§äº¤æ¢è¡¨ä¸­<strong>æŸ¥æ‰¾å¸§çš„ç›®çš„MACåœ°å€æ‰€å¯¹åº”çš„æ¥å£å·</strong>ï¼Œç„¶åé€šè¿‡è¯¥æ¥å£è½¬å‘å¸§.</li><li>ä»¥å¤ªç½‘äº¤æ¢æœºæ˜¯ä¸€ç§å³æ’å³ç”¨è®¾å¤‡ï¼Œåˆšä¸Šç”µå¯åŠ¨æ—¶å…¶å†…éƒ¨çš„é¡¿äº¤æ¢è¡¨æ˜¯ç©ºçš„ã€‚éšç€ç½‘ç»œä¸­å„ä¸»æœºé—´çš„é€šä¿¡ï¼Œä»¥å¤ªç½‘äº¤æ¢æœºé€šè¿‡<mark>è‡ªå­¦ä¹ ç®—æ³•</mark>è‡ªåŠ¨<mark>é€æ¸å»ºç«‹èµ·å¸§äº¤æ¢è¡¨</mark></li></ul><blockquote><p>ğŸ”´ğŸŸ¢ğŸŸ¡<strong>ä¸€å¥è¯æ€»ç»“ï¼š</strong></p><p>ä¸€å¼€å§‹ä»¥å¤ªç½‘äº¤æ¢æœºæ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆå½“ä¸»æœºBå»å‘é€å¸§ç»™ä¸»æœºCæ—¶ï¼Œä¼šå…ˆå»å¸§äº¤æ¢è¡¨ä¸­æŸ¥è¯¢ç›®çš„MACåœ°å€ï¼Œå¦‚æœå­˜åœ¨è¯¥åœ°å€ï¼Œé‚£ä¹ˆå°±èƒ½æ˜ç¡®åœ°ä»è¯¥åœ°å€æ‰€å¯¹åº”çš„æ¥å£å¤„è½¬å‘è¯¥å¸§ï¼›</p><p>å¦‚æœä¸å­˜åœ¨è¯¥åœ°å€ï¼Œé‚£ä¹ˆå°±ä¼šè¿›è¡Œç›²ç›®è½¬å‘ï¼Œç»™é™¤äº†å‘é€è¯¥å¸§è¿›æ¥çš„æ¥å£å¤–çš„å…¶ä»–æ¥å£å…¨éƒ¨å‘é€è¯¥å¸§ï¼Œè¿™äº›å¸§è½¬å‘å‡ºå»å¦‚æœå‘ç°ç›®çš„MACåœ°å€ä¸æœ¬åœ°çš„MACåœ°å€ä¸ä¸€è‡´å°±ä¼šä¸¢å¼ƒè¯¥å¸§ï¼›</p><p>å¦‚æœä¸æœ¬åœ°çš„MACåœ°å€ä¸€è‡´å°±ä¼šæ¥æ”¶è¯¥å¸§ï¼Œè¿”å›ç¡®è®¤å¸§çš„æƒ…å†µå°±è·Ÿä¸Šé¢ç±»ä¼¼äº†ï¼Œä¹Ÿæ˜¯å…ˆæŸ¥è¡¨ï¼ŒæŸ¥åˆ°å°±ç²¾ç¡®å‘é€ï¼ŒæŸ¥ä¸åˆ°å°±ç›²ç›®å‘é€</p></blockquote><hr><p><strong>ä»¥ä¸‹ä¾‹å­å‡è®¾å„ä¸»æœºçŸ¥é“ç½‘ç»œä¸­å…¶ä»–å„ä¸»æœºçš„MACåœ°å€ï¼ˆæ— éœ€è¿›è¡ŒARPï¼‰</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231123211851067.png" alt="image-20231123211851067"></p><ul><li>å¸§äº¤æ¢è¡¨ä¸­çš„æ¯æ¡è®°å½•éƒ½æœ‰è‡ªå·±çš„<strong>æœ‰æ•ˆæ—¶é—´</strong>ï¼Œåˆ°æœŸåˆ é™¤ã€‚åŸå› å¦‚ä¸‹ï¼š<ul><li>äº¤æ¢æœºçš„æ¥å£æ”¹æ¥äº†å¦ä¸€å°ä¸»æœºï¼›</li><li>ä¸»æœºæ›´æ¢äº†ç½‘å¡</li></ul></li></ul><p><strong>è¡¥å……ï¼š</strong></p><p>å¦‚å›¾çš„G-&gt;Açš„è¿‡ç¨‹ï¼ŒGå‘é€çš„å¸§åœ¨æ€»çº¿å‹ä»¥å¤ªç½‘ä¸Šä¼šåˆ†åˆ«å‘é€ç»™Aï¼ˆ<mark>å‘é€æˆåŠŸå¹¶æ¥æ”¶æˆåŠŸ</mark>ï¼‰å’Œäº¤æ¢æœº1ï¼Œä½†æ˜¯äº¤æ¢æœºæ”¶åˆ°åï¼Œè¿›è¡Œè®°å½•è¡¨åï¼Œ<mark>å‘é€ç›®æ ‡æ¥å£ä¸è¿›æ¥æ—¶çš„æ¥å£ä¸€è‡´å°±ä¸ä¼šå†å‘é€äº†ï¼Œå› ä¸ºæ— æ„ä¹‰ã€‚</mark></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231123213135319.png" alt="image-20231123213135319"></p><h3 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231123211800769.png" alt="image-20231123211800769"></p><hr><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231123211545673.png" alt="image-20231123211545673"></p><h2 id="ä»¥å¤ªç½‘äº¤æ¢æœºçš„ç”Ÿæˆæ ‘åè®®STP"><a href="#ä»¥å¤ªç½‘äº¤æ¢æœºçš„ç”Ÿæˆæ ‘åè®®STP" class="headerlink" title="ä»¥å¤ªç½‘äº¤æ¢æœºçš„ç”Ÿæˆæ ‘åè®®STP"></a>ä»¥å¤ªç½‘äº¤æ¢æœºçš„ç”Ÿæˆæ ‘åè®®STP</h2><h3 id="å¦‚ä½•æé«˜ä»¥å¤ªç½‘çš„å¯é æ€§"><a href="#å¦‚ä½•æé«˜ä»¥å¤ªç½‘çš„å¯é æ€§" class="headerlink" title="å¦‚ä½•æé«˜ä»¥å¤ªç½‘çš„å¯é æ€§"></a>å¦‚ä½•æé«˜ä»¥å¤ªç½‘çš„å¯é æ€§</h3><ul><li>æ·»åŠ <mark>å†—ä½™é“¾è·¯</mark>å¯ä»¥æé«˜ä»¥å¤ªç½‘çš„å¯é æ€§</li><li>ä½†æ˜¯ï¼Œå†—ä½™é“¾è·¯ä¹Ÿä¼šå¸¦æ¥è´Ÿé¢æ•ˆåº”â€”â€”å½¢æˆç½‘ç»œç¯è·¯</li><li>ç½‘ç»œç¯è·¯ä¼šå¸¦æ¥ä»¥ä¸‹é—®é¢˜<ul><li><mark>å¹¿æ’­é£æš´</mark><br>å¤§é‡æ¶ˆè€—ç½‘ç»œèµ„æºï¼Œä½¿å¾—ç½‘ç»œæ— æ³•æ­£å¸¸è½¬å‘å…¶ä»–æ•°æ®å¸§</li><li><mark>ä¸»æœºæ”¶åˆ°é‡å¤çš„å¹¿æ’­é¡¿</mark><br>å¤§é‡æ¶ˆè€—ä¸»æœºèµ„æº</li><li><mark>äº¤æ¢æœºçš„å¸§äº¤æ¢è¡¨éœ‡è¡(æ¼‚ç§»)</mark></li></ul></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231123214653212.png" alt="image-20231123214653212"></p><h3 id="ç”Ÿæˆæ ‘åè®®STP"><a href="#ç”Ÿæˆæ ‘åè®®STP" class="headerlink" title="ç”Ÿæˆæ ‘åè®®STP"></a>ç”Ÿæˆæ ‘åè®®STP</h3><ul><li>ä»¥å¤ªç½‘äº¤æ¢æœºä½¿ç”¨<mark>ç”Ÿæˆæ ‘åè®®STP</mark>(Spanning Tree Protocol)å¯ä»¥åœ¨å¢åŠ å…ƒä½™é“¾è·¯æ¥æé«˜ç½‘ç»œå¯é æ€§çš„åŒæ—¶åˆ<mark>é¿å…ç½‘ç»œç¯è·¯å¸¦æ¥çš„å„ç§é—®é¢˜</mark>ï¼›</li><li>ä¸è®ºäº¤æ¢æœºä¹‹é—´é‡‡ç”¨æ€æ ·çš„ç‰©ç†è¿æ¥ï¼Œäº¤æ¢æœºéƒ½èƒ½å¤Ÿ<mark>è‡ªåŠ¨è®¡ç®—å¹¶æ„å»ºä¸€ä¸ªé€»è¾‘ä¸Š<strong>æ²¡æœ‰ç¯è·¯çš„ç½‘ç»œ</strong></mark>ï¼Œå…¶é€»è¾‘æ‹“æ‰‘ç»“æ„å¿…é¡»æ˜¯æ ‘å‹çš„(æ— é€»è¾‘ç¯è·¯) ï¼›</li><li>æœ€ç»ˆç”Ÿæˆçš„æ ‘å‹é€»è¾‘æ‹“æ‰‘<strong>è¦ç¡®ä¿è¿é€šæ•´ä¸ªç½‘ç»œ</strong>ï¼›</li><li>å½“é¦–æ¬¡è¿æ¥äº¤æ¢æœºæˆ–ç½‘ç»œç‰©ç†æ‹“æ‰‘å‘ç”Ÿå˜åŒ–æ—¶(æœ‰å¯èƒ½æ˜¯äººä¸ºæ”¹å˜æˆ–æ•…éšœ)ï¼Œäº¤æ¢æœºéƒ½å°†è¿›è¡Œ<mark>ç”Ÿæˆæ ‘çš„é‡æ–°è®¡ç®—</mark>ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231123214956562.png" alt="image-20231123214956562"></p><hr><h2 id="è™šæ‹Ÿå±€åŸŸç½‘VLAN"><a href="#è™šæ‹Ÿå±€åŸŸç½‘VLAN" class="headerlink" title="è™šæ‹Ÿå±€åŸŸç½‘VLAN"></a>è™šæ‹Ÿå±€åŸŸç½‘VLAN</h2><h3 id="ä¸ºä»€ä¹ˆè¦è™šæ‹Ÿå±€åŸŸç½‘VLAN"><a href="#ä¸ºä»€ä¹ˆè¦è™šæ‹Ÿå±€åŸŸç½‘VLAN" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è™šæ‹Ÿå±€åŸŸç½‘VLAN"></a>ä¸ºä»€ä¹ˆè¦è™šæ‹Ÿå±€åŸŸç½‘VLAN</h3><p>å·¨å¤§å¹¿æ’­åŸŸçš„å¼Šç«¯ï¼š</p><ul><li>ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªä»¥å¤ªç½‘äº¤æ¢æœºäº’è¿èµ·æ¥çš„äº¤æ¢å¼ä»¥å¤ªç½‘ï¼Œå…¶æ‰€æœ‰ç«™ç‚¹éƒ½å±äºåŒä¸€ä¸ªå¹¿æ’­åŸŸ</li><li>éšç€äº¤æ¢å¼ä»¥å¤ªç½‘è§„æ¨¡çš„æ‰©å¤§ï¼Œå¹¿æ’­åŸŸç›¸åº”æ‰©å¤§</li><li>å·¨å¤§çš„å¹¿æ’­åŸŸä¼šå¸¦æ¥å¾ˆå¤šå¼Šç«¯<ul><li>å¹¿æ’­é£æš´</li><li>éš¾ä»¥ç®¡ç†å’Œç»´æŠ¤</li><li>æ½œåœ¨çš„å®‰å…¨é—®é¢˜</li></ul></li></ul><p><mark><strong>å¹¿æ’­é£æš´ä¼šæµªè´¹ç½‘ç»œèµ„æºå’Œå„ä¸»æœºçš„CPUèµ„æº!</strong></mark></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231123220509612.png" alt="image-20231123220509612"></p><p><strong>åˆ†å‰²å¹¿æ’­åŸŸçš„æ–¹æ³•ï¼š</strong></p><ul><li><p>ä½¿ç”¨è·¯ç”±å™¨å¯ä»¥éš”ç¦»å¹¿æ’­åŸŸï¼Œä½†è·¯ç”±å™¨çš„æˆæœ¬è¾ƒé«˜</p></li><li><p><mark>ä½¿ç”¨VLANæŠ€æœ¯</mark></p></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231123220624181.png" alt="image-20231123220624181"></p><h3 id="VLANåŸºæœ¬æ¦‚å¿µ"><a href="#VLANåŸºæœ¬æ¦‚å¿µ" class="headerlink" title="VLANåŸºæœ¬æ¦‚å¿µ"></a>VLANåŸºæœ¬æ¦‚å¿µ</h3><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šç”¨ä¸åŒçš„VLANåˆ†å‰²å¼€ä¹‹åï¼Œå°±åªèƒ½æ”¶åˆ°åŒä¸€ä¸ªVLANç»„ä¸­çš„å¹¿æ’­ä¿¡å·äº†ã€‚</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231123220755458.png" alt="image-20231123220755458"></p><ul><li><p>åŒä¸€ä¸ªVLANå†…éƒ¨å¯ä»¥å¹¿æ’­é€šä¿¡ï¼Œä¸åŒVLANä¸å¯ä»¥å¹¿æ’­é€šä¿¡</p></li><li><p><strong>è™šæ‹Ÿå±€åŸŸç½‘å…¶å®<mark>ä»…ä»…åªæ˜¯</mark>å±€åŸŸç½‘ç»™ç”¨æˆ·æä¾›çš„<mark>ä¸€ç§æœåŠ¡</mark>ï¼Œè€Œå¹¶ä¸æ˜¯ä¸€ç§æ–°å‹å±€åŸŸç½‘ã€‚</strong></p></li></ul><h3 id="è™šæ‹Ÿå±€åŸŸç½‘VLANçš„å®ç°æœºåˆ¶"><a href="#è™šæ‹Ÿå±€åŸŸç½‘VLANçš„å®ç°æœºåˆ¶" class="headerlink" title="è™šæ‹Ÿå±€åŸŸç½‘VLANçš„å®ç°æœºåˆ¶"></a>è™šæ‹Ÿå±€åŸŸç½‘VLANçš„å®ç°æœºåˆ¶</h3><p>è™šæ‹Ÿå±€åŸŸç½‘VLANæŠ€æœ¯æ˜¯åœ¨äº¤æ¢æœºä¸Šå®ç°çš„ï¼Œéœ€è¦äº¤æ¢æœºèƒ½å¤Ÿå®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ol><li>èƒ½å¤Ÿå¤„ç†å¸¦æœ‰VLANæ ‡è®°çš„å¸§â€”â€”IEEE 802.1 Qå¸§</li><li>äº¤æ¢æœºçš„å„ç«¯å£å¯ä»¥æ”¯æŒä¸åŒçš„ç«¯å£ç±»å‹ï¼Œä¸åŒç«¯å£ç±»å‹çš„ç«¯å£å¯¹å¸§çš„å¤„ç†æ–¹å¼æœ‰æ‰€ä¸åŒ</li></ol><p><strong>â‘ å¯¹äºç¬¬ä¸€ç‚¹ï¼š</strong></p><ul><li>IEEE 802.1Qå¸§å¯¹ä»¥å¤ªç½‘çš„MACæ ¼å¼è¿›è¡Œäº†æ‰©å±•ï¼Œ<mark>æ’å…¥äº†4å­—èŠ‚çš„VLANæ ‡è®°</mark></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231123223855342.png" alt="image-20231123223855342"></p><ul><li><p>VLANæ ‡è®°çš„æœ€å12æ¯”ç‰¹ç§°ä¸º<mark>VLANæ ‡è¯†ç¬¦VID</mark>ï¼Œå®ƒå”¯ä¸€åœ°æ ‡å¿—äº†ä»¥å¤ªç½‘å¸§å±äºå“ªä¸€ä¸ªVLANã€‚</p><ul><li>è¡¨ç¤ºVLANçš„VIDçš„æœ‰æ•ˆå–å€¼èŒƒå›´æ˜¯ 1~4094.</li></ul></li><li><p>802.1Qå¸§æ˜¯ç”±äº¤æ¢æœºæ¥å¤„ç†çš„ï¼Œè€Œä¸æ˜¯ç”¨æˆ·ä¸»æœºæ¥å¤„ç†çš„ï¼ˆ<mark><strong>å³ç”¨æˆ·ä¸»æœºå¤„ç†ä¸äº†802.1Qå¸§ï¼Œåªèƒ½ä¸¢å¼ƒ</strong></mark>ï¼‰</p><ul><li>å½“äº¤æ¢æœº<mark>æ”¶åˆ°æ™®é€šçš„ä»¥å¤ªç½‘å¸§æ—¶</mark>ï¼Œä¼šå°†å…¶æ’å…¥4å­—èŠ‚çš„VLANæ ‡è®°è½¬å˜ä¸º802.1Qï¼Œç®€ç§°<mark>â€œæ‰“æ ‡ç­¾â€</mark></li><li>å½“äº¤æ¢æœº<mark>è½¬å‘802.1Qé¡¿æ—¶</mark>ï¼Œå¯èƒ½ä¼šåˆ é™¤å…¶4å­—èŠ‚VLANæ ‡è®°è½¬å˜ä¸ºæ™®é€šä»¥å¤ªç½‘å¸§ï¼Œç®€ç§°<mark>â€œå»æ ‡ç­¾â€</mark></li></ul></li></ul><p><strong>â‘¡å¯¹äºç¬¬äºŒç‚¹ï¼š</strong></p><p>äº¤æ¢æœºçš„ç«¯å£ç±»å‹æœ‰ä»¥ä¸‹ä¸‰ç§:</p><ol><li>Access</li><li>Trunk</li><li>Hybrid</li></ol><h4 id="Accessç«¯å£"><a href="#Accessç«¯å£" class="headerlink" title="Accessç«¯å£"></a>Accessç«¯å£</h4><p><mark><strong>äº¤æ¢æœºä¸ç”¨æˆ·è®¡ç®—æœºä¹‹é—´çš„äº’è¿</strong></mark></p><ul><li>Accessç«¯å£ä¸€èˆ¬ç”¨äºè¿æ¥ç”¨æˆ·è®¡ç®—æœº</li><li>Accessç«¯å£åªèƒ½å±äºä¸€ä¸ªVLAN</li><li>Accessç«¯å£çš„PVIDå€¼ä¸ç«¯å£æ‰€å±VLANçš„IDç›¸åŒ(é»˜è®¤ä¸º1)</li><li>Accessç«¯å£æ¥æ”¶å¤„ç†æ–¹æ³•:<ul><li>ä¸€èˆ¬åªæ¥å—â€œæœªæ‰“æ ‡ç­¾â€çš„æ™®é€šä»¥å¤ªç½‘MACå¸§ã€‚æ ¹æ®æ¥æ”¶å¸§çš„ç«¯å£çš„PVIDç»™å¸§â€œ<mark>æ‰“æ ‡ç­¾</mark>â€ï¼Œå³æ’å…¥4å­—èŠ‚VLANæ ‡è®°å­—æ®µï¼Œå­—æ®µä¸­çš„VIDå–å€¼ä¸ç«¯å£çš„PVIDå–å€¼ç›¸ç­‰ã€‚</li></ul></li><li>Accessç«¯å£å‘é€å¤„ç†æ–¹æ³•<ul><li>è‹¥å¸§ä¸­çš„VIDä¸ç«¯å£çš„PVIDç›¸ç­‰ï¼Œåˆ™â€œ<mark>å»æ ‡ç­¾</mark>â€å¹¶è½¬å‘è¯¥å¸§ï¼›å¦åˆ™ä¸è½¬å‘ã€‚</li></ul></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231123225022476.png" alt="image-20231123225022476"></p><h4 id="Trunkç«¯å£"><a href="#Trunkç«¯å£" class="headerlink" title="Trunkç«¯å£"></a>Trunkç«¯å£</h4><p><mark><strong>äº¤æ¢æœºä¹‹é—´æˆ–äº¤æ¢æœºä¸è·¯ç”±å™¨ä¹‹é—´çš„äº’è¿</strong></mark></p><ul><li>Trunkç«¯å£ä¸€èˆ¬ç”¨äºäº¤æ¢æœºä¹‹é—´æˆ–äº¤æ¢æœºä¸è·¯ç”±å™¨ä¹‹é—´çš„äº’è¿</li><li>Trunkç«¯å£å¯ä»¥å±äºå¤šä¸ªVLAN</li><li>ç”¨æˆ·å¯ä»¥è®¾ç½®Trunkç«¯å£çš„PVIDå€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒTrunkç«¯å£çš„PVIDå€¼ä¸º1ã€‚</li><li>Trunkç«¯å£å‘é€å¤„ç†æ–¹æ³•<ul><li>å¯¹VIDç­‰äºPVIDçš„å¸§<mark>â€œå»æ ‡ç­¾â€å†è½¬å‘</mark></li><li>å¯¹VIDä¸ç­‰äºPVIDçš„å¸§ï¼Œ<mark>ç›´æ¥è½¬å‘</mark></li></ul></li><li>Trunkç«¯å£æ¥æ”¶å¤„ç†æ–¹æ³•<ul><li>æ¥æ”¶â€œæœªæ‰“æ ‡ç­¾â€çš„å¸§ï¼Œæ ¹æ®æ¥æ”¶å¸§çš„ç«¯å£çš„PVIDç»™å¸§<mark>â€œæ‰“æ ‡ç­¾â€</mark>ï¼Œå³æ’å…¥4å­—èŠ‚VLANæ ‡è®°å­—æ®µï¼Œå­—æ®µä¸­çš„VIDå–å€¼ä¸ç«¯å£çš„PVIDå–å€¼ç›¸ç­‰</li><li>æ¥æ”¶â€œå·²æ‰“æ ‡ç­¾çš„å¸§â€ã€‚</li></ul></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231123225429714.png" alt="image-20231123225429714"></p><p><strong>ä¾‹é¢˜ï¼š</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231123225513451.png" alt="image-20231123225513451"></p><p><strong>ç»“è®ºï¼š</strong></p><blockquote><p><strong>äº’è¿çš„Trunkç«¯å£çš„PVIDå€¼ä¸ç­‰ï¼Œå¯èƒ½ä¼šé€ æˆè½¬å‘é”™è¯¯!</strong></p></blockquote><h4 id="Hybridç«¯å£"><a href="#Hybridç«¯å£" class="headerlink" title="Hybridç«¯å£"></a>Hybridç«¯å£</h4><p>åä¸ºäº¤æ¢æœºç§æœ‰çš„Hybridç«¯å£ç±»å‹</p><p>åŸºæœ¬ç‰¹å¾ä¸Šä¸Trunkç«¯å£ç±»ä¼¼ï¼ŒåŒºåˆ«å¦‚ä¸‹ï¼š</p><p>Hybridç«¯å£å‘é€å¤„ç†æ–¹æ³• (ä¸Trunkç«¯å£ä¸åŒ)ï¼š</p><ul><li>æŸ¥çœ‹å¸§çš„VIDæ˜¯å¦åœ¨ç«¯å£çš„â€œå»æ ‡ç­¾â€åˆ—è¡¨ä¸­:<ul><li>è‹¥å­˜åœ¨ï¼Œåˆ™â€œå»æ ‡ç­¾â€åå†è½¬å‘</li><li>è‹¥ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥è½¬å‘</li></ul></li></ul><p>ä¸¾ä¾‹è¯´æ˜ï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231123225702709.png" alt="image-20231123225702709"></p><h1 id="ç½‘ç»œå±‚"><a href="#ç½‘ç»œå±‚" class="headerlink" title="ç½‘ç»œå±‚"></a>ç½‘ç»œå±‚</h1><h2 id="ç½‘ç»œå±‚æ¦‚è¿°"><a href="#ç½‘ç»œå±‚æ¦‚è¿°" class="headerlink" title="ç½‘ç»œå±‚æ¦‚è¿°"></a>ç½‘ç»œå±‚æ¦‚è¿°</h2><p><strong>ç½‘ç»œå±‚è¦è§£å†³çš„é—®é¢˜ï¼š</strong></p><ul><li><p>æ ‡è¯†å„ä¸ªç½‘ç»œä»¥åŠå„ä¸ªç½‘ç»œä¸­çš„å„ä¸»æœº</p></li><li><p>è·¯ç”±å™¨å¦‚ä½•è½¬å‘åˆ†ç»„ï¼Œè·¯ç”±å™¨å¦‚ä½•è¿›è¡Œè·¯ç”±é€‰æ‹©</p></li><li><p><strong>ç½‘ç»œå±‚çš„ä¸»è¦ä»»åŠ¡</strong>æ˜¯<mark>å®ç°ç½‘ç»œäº’è¿</mark>ï¼Œè¿›è€Œå®ç°<strong>æ•°æ®åŒ…åœ¨å„ç½‘ç»œä¹‹é—´çš„ä¼ è¾“</strong>ã€‚</p></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.3fzdhk9z0yg.webp" alt="image"></p><p><strong>å®ç°ç½‘ç»œå±‚è¦è§£å†³çš„ä¸»è¦é—®é¢˜</strong></p><ol><li>ç½‘ç»œå±‚å‘è¿è¾“å±‚æä¾›æ€æ ·çš„æœåŠ¡ï¼ˆâ€œå¯é ä¼ è¾“â€è¿˜æ˜¯â€œä¸å¯é ä¼ è¾“â€ï¼‰</li></ol><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/00ce2a4ae2e24bd697b3e993cb071a4a.1kcv7yn0vb8g.gif" alt="00ce2a4ae2e24bd697b3e993cb071a4a"></p><ol start="2"><li>ç½‘ç»œå±‚å¯»å€é—®é¢˜</li></ol><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.3nlwnzrjep40.webp" alt="image"></p><blockquote><p>è·¯ç”±å™¨æ”¶åˆ°æ•°æ®åï¼Œæ˜¯ä¾æ®ä»€ä¹ˆæ¥å†³å®šå°†æ•°æ®åŒ…ä»è‡ªå·±çš„å“ªä¸ªæ¥å£è½¬å‘å‡ºå»ï¼Ÿ</p><p><strong>ä¾æ®æ•°æ®åŒ…çš„ç›®çš„åœ°å€å’Œè·¯ç”±å™¨ä¸­çš„è·¯ç”±è¡¨</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201017135914985.png" alt="image-20201017135914985"></p><p>ä½†åœ¨å®é™…å½“ä¸­ï¼Œè·¯ç”±å™¨æ˜¯æ€æ ·çŸ¥é“è¿™äº›è·¯ç”±è®°å½•ï¼Ÿ</p><ul><li>ç”±ç”¨æˆ·æˆ–ç½‘ç»œç®¡ç†å‘˜è¿›è¡Œ<mark>äººå·¥é…ç½®</mark>ï¼Œè¿™ç§æ–¹æ³•åªé€‚ç”¨äºè§„æ¨¡è¾ƒå°ä¸”ç½‘ç»œæ‹“æ‰‘ä¸æ”¹å˜çš„å°å‹äº’è”ç½‘</li><li><strong>å¦ä¸€ç§æ˜¯å®ç°å„ç§è·¯ç”±é€‰æ‹©åè®®ï¼Œç”±è·¯ç”±å™¨æ‰§è¡Œè·¯ç”±é€‰æ‹©åè®®ä¸­æ‰€è§„å®šçš„<mark>è·¯ç”±é€‰æ‹©ç®—æ³•</mark>ï¼Œè€Œ<mark>è‡ªåŠ¨å¾—å‡ºè·¯ç”±è¡¨ä¸­çš„è·¯ç”±è®°å½•</mark>ï¼Œè¿™ç§æ–¹æ³•æ›´é€‚åˆè§„æ¨¡è¾ƒå¤§ä¸”ç½‘ç»œæ‹“æ‰‘ç»å¸¸æ”¹å˜çš„å¤§å‹äº’è”ç½‘</strong></li></ul></blockquote><ol start="3"><li>è·¯ç”±é€‰æ‹©é—®é¢˜</li></ol><h2 id="ç½‘ç»œå±‚æä¾›çš„ä¸¤ç§æœåŠ¡"><a href="#ç½‘ç»œå±‚æä¾›çš„ä¸¤ç§æœåŠ¡" class="headerlink" title="ç½‘ç»œå±‚æä¾›çš„ä¸¤ç§æœåŠ¡"></a>ç½‘ç»œå±‚æä¾›çš„ä¸¤ç§æœåŠ¡</h2><ul><li>åœ¨è®¡ç®—æœºç½‘ç»œé¢†åŸŸï¼Œç½‘ç»œå±‚åº”è¯¥å‘è¿è¾“å±‚æä¾›æ€æ ·çš„æœåŠ¡ï¼ˆâ€œ<strong>é¢å‘è¿æ¥</strong>â€è¿˜æ˜¯â€œ<strong>æ— è¿æ¥</strong>â€ï¼‰æ›¾å¼•èµ·äº†é•¿æœŸçš„äº‰è®ºã€‚</li><li>äº‰è®ºç„¦ç‚¹çš„å®è´¨å°±æ˜¯ï¼š<strong>åœ¨è®¡ç®—æœºé€šä¿¡ä¸­ï¼Œå¯é äº¤ä»˜åº”å½“ç”±è°æ¥è´Ÿè´£</strong>ï¼Ÿæ˜¯<strong>ç½‘ç»œ</strong>è¿˜æ˜¯<strong>ç«¯ç³»ç»Ÿ</strong>ï¼Ÿ</li></ul><h3 id="é¢å‘è¿æ¥çš„è™šç”µè·¯æœåŠ¡"><a href="#é¢å‘è¿æ¥çš„è™šç”µè·¯æœåŠ¡" class="headerlink" title="é¢å‘è¿æ¥çš„è™šç”µè·¯æœåŠ¡"></a>é¢å‘è¿æ¥çš„è™šç”µè·¯æœåŠ¡</h3><p><strong>ä¸€ç§è§‚ç‚¹ï¼šè®©ç½‘ç»œè´Ÿè´£å¯é äº¤ä»˜</strong></p><ul><li>è¿™ç§è§‚ç‚¹è®¤ä¸ºï¼Œåº”å€ŸåŠ©äºç”µä¿¡ç½‘çš„æˆåŠŸç»éªŒï¼Œè®©ç½‘ç»œè´Ÿè´£å¯é äº¤ä»˜ï¼Œè®¡ç®—æœºç½‘ç»œåº”æ¨¡ä»¿ç”µä¿¡ç½‘ç»œï¼Œä½¿ç”¨<strong>é¢å‘è¿æ¥</strong>çš„é€šä¿¡æ–¹å¼ã€‚</li><li>é€šä¿¡ä¹‹å‰å…ˆå»ºç«‹<strong>è™šç”µè·¯</strong> (Virtual Circuit)ï¼Œä»¥ä¿è¯åŒæ–¹é€šä¿¡æ‰€éœ€çš„ä¸€åˆ‡ç½‘ç»œèµ„æºã€‚ </li><li>å¦‚æœå†ä½¿ç”¨å¯é ä¼ è¾“çš„ç½‘ç»œåè®®ï¼Œå°±å¯ä½¿æ‰€å‘é€çš„åˆ†ç»„æ— å·®é”™æŒ‰åºåˆ°è¾¾ç»ˆç‚¹ï¼Œä¸ä¸¢å¤±ã€ä¸é‡å¤ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201017141425892.png" alt="image-20201017141425892"></p><p><strong>å‘é€æ–¹</strong> å‘é€ç»™ <strong>æ¥æ”¶æ–¹</strong> çš„æ‰€æœ‰åˆ†ç»„éƒ½æ²¿ç€åŒä¸€æ¡è™šç”µè·¯ä¼ é€</p><blockquote><ul><li>è™šç”µè·¯è¡¨ç¤ºè¿™åªæ˜¯ä¸€æ¡<strong>é€»è¾‘ä¸Šçš„è¿æ¥</strong>ï¼Œåˆ†ç»„éƒ½æ²¿ç€è¿™æ¡é€»è¾‘è¿æ¥æŒ‰ç…§å­˜å‚¨è½¬å‘æ–¹å¼ä¼ é€ï¼Œè€Œå¹¶ä¸æ˜¯çœŸæ­£å»ºç«‹äº†ä¸€æ¡ç‰©ç†è¿æ¥ã€‚</li><li>è¯·æ³¨æ„ï¼Œç”µè·¯äº¤æ¢çš„ç”µè¯é€šä¿¡æ˜¯å…ˆå»ºç«‹äº†ä¸€æ¡çœŸæ­£çš„è¿æ¥ã€‚</li><li>å› æ­¤åˆ†ç»„äº¤æ¢çš„è™šè¿æ¥å’Œç”µè·¯äº¤æ¢çš„è¿æ¥åªæ˜¯ç±»ä¼¼ï¼Œä½†å¹¶ä¸å®Œå…¨ä¸€æ ·</li></ul></blockquote><h3 id="æ— è¿æ¥çš„æ•°æ®æŠ¥æœåŠ¡"><a href="#æ— è¿æ¥çš„æ•°æ®æŠ¥æœåŠ¡" class="headerlink" title="æ— è¿æ¥çš„æ•°æ®æŠ¥æœåŠ¡"></a>æ— è¿æ¥çš„æ•°æ®æŠ¥æœåŠ¡</h3><p><strong>å¦ä¸€ç§è§‚ç‚¹ï¼šç½‘ç»œæä¾›æ•°æ®æŠ¥æœåŠ¡</strong></p><ul><li>äº’è”ç½‘çš„å…ˆé©±è€…æå‡ºäº†ä¸€ç§å´­æ–°çš„ç½‘ç»œè®¾è®¡æ€è·¯ã€‚</li><li>ç½‘ç»œå±‚å‘ä¸Šåªæä¾›ç®€å•çµæ´»çš„ã€<strong>æ— è¿æ¥çš„</strong>ã€<strong>å°½æœ€å¤§åŠªåŠ›äº¤ä»˜</strong>çš„<strong>æ•°æ®æŠ¥æœåŠ¡</strong>ã€‚</li><li>ç½‘ç»œåœ¨å‘é€åˆ†ç»„æ—¶ä¸éœ€è¦å…ˆå»ºç«‹è¿æ¥ã€‚æ¯ä¸€ä¸ªåˆ†ç»„ï¼ˆå³ IP æ•°æ®æŠ¥ï¼‰ç‹¬ç«‹å‘é€ï¼Œä¸å…¶å‰åçš„åˆ†ç»„æ— å…³ï¼ˆä¸è¿›è¡Œç¼–å·ï¼‰ã€‚</li><li><strong>ç½‘ç»œå±‚ä¸æä¾›æœåŠ¡è´¨é‡çš„æ‰¿è¯º</strong>ã€‚å³æ‰€ä¼ é€çš„åˆ†ç»„å¯èƒ½å‡ºé”™ã€ä¸¢å¤±ã€é‡å¤å’Œå¤±åºï¼ˆä¸æŒ‰åºåˆ°è¾¾ç»ˆç‚¹ï¼‰ï¼Œå½“ç„¶ä¹Ÿä¸ä¿è¯åˆ†ç»„ä¼ é€çš„æ—¶é™ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201017141851030.png" alt="image-20201017141851030"></p><p><strong>å‘é€æ–¹</strong> å‘é€ç»™ <strong>æ¥æ”¶æ–¹</strong> çš„åˆ†ç»„å¯èƒ½æ²¿ç€ä¸åŒè·¯å¾„ä¼ é€</p><blockquote><p><strong>å°½æœ€å¤§åŠªåŠ›äº¤ä»˜</strong></p><ul><li>å¦‚æœä¸»æœºï¼ˆå³ç«¯ç³»ç»Ÿï¼‰ä¸­çš„è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡éœ€è¦æ˜¯å¯é çš„ï¼Œé‚£ä¹ˆå°±ç”±ç½‘ç»œçš„<strong>ä¸»æœºä¸­çš„è¿è¾“å±‚è´Ÿè´£å¯é äº¤ä»˜ï¼ˆåŒ…æ‹¬å·®é”™å¤„ç†ã€æµé‡æ§åˆ¶ç­‰ï¼‰</strong> ã€‚</li><li><strong>é‡‡ç”¨è¿™ç§è®¾è®¡æ€è·¯çš„å¥½å¤„æ˜¯</strong>ï¼šç½‘ç»œçš„é€ ä»·å¤§å¤§é™ä½ï¼Œè¿è¡Œæ–¹å¼çµæ´»ï¼Œèƒ½å¤Ÿé€‚åº”å¤šç§åº”ç”¨ã€‚</li><li>äº’è¿ç½‘èƒ½å¤Ÿå‘å±•åˆ°ä»Šæ—¥çš„è§„æ¨¡ï¼Œå……åˆ†è¯æ˜äº†å½“åˆé‡‡ç”¨è¿™ç§è®¾è®¡æ€è·¯çš„æ­£ç¡®æ€§ã€‚</li></ul></blockquote><h3 id="è™šç”µè·¯æœåŠ¡ä¸æ•°æ®æŠ¥æœåŠ¡çš„å¯¹æ¯”"><a href="#è™šç”µè·¯æœåŠ¡ä¸æ•°æ®æŠ¥æœåŠ¡çš„å¯¹æ¯”" class="headerlink" title="è™šç”µè·¯æœåŠ¡ä¸æ•°æ®æŠ¥æœåŠ¡çš„å¯¹æ¯”"></a>è™šç”µè·¯æœåŠ¡ä¸æ•°æ®æŠ¥æœåŠ¡çš„å¯¹æ¯”</h3><table><thead><tr><th><strong>å¯¹æ¯”çš„æ–¹é¢</strong></th><th><strong>è™šç”µè·¯æœåŠ¡</strong></th><th><strong>æ•°æ®æŠ¥æœåŠ¡</strong></th></tr></thead><tbody><tr><td><strong>æ€è·¯</strong></td><td><strong>å¯é é€šä¿¡åº”å½“ç”±ç½‘ç»œæ¥ä¿è¯</strong></td><td><strong>å¯é é€šä¿¡åº”å½“ç”±ç”¨æˆ·ä¸»æœºæ¥ä¿è¯</strong></td></tr><tr><td><strong>è¿æ¥çš„å»ºç«‹</strong></td><td><strong>å¿…é¡»æœ‰</strong></td><td><strong>ä¸éœ€è¦</strong></td></tr><tr><td><strong>ç»ˆç‚¹åœ°å€</strong></td><td><strong>ä»…åœ¨è¿æ¥å»ºç«‹é˜¶æ®µä½¿ç”¨ï¼Œæ¯ä¸ªåˆ†ç»„ä½¿ç”¨çŸ­çš„è™šç”µè·¯å·</strong></td><td><strong>æ¯ä¸ªåˆ†ç»„éƒ½æœ‰ç»ˆç‚¹çš„å®Œæ•´åœ°å€</strong></td></tr><tr><td><strong>åˆ†ç»„çš„è½¬å‘</strong></td><td><strong>å±äºåŒä¸€æ¡è™šç”µè·¯çš„åˆ†ç»„å‡æŒ‰ç…§åŒä¸€è·¯ç”±è¿›è¡Œè½¬å‘</strong></td><td><strong>æ¯ä¸ªåˆ†ç»„ç‹¬ç«‹é€‰æ‹©è·¯ç”±è¿›è¡Œè½¬å‘</strong></td></tr><tr><td><strong>å½“ç»“ç‚¹å‡ºæ•…éšœæ—¶</strong></td><td><strong>æ‰€æœ‰é€šè¿‡å‡ºæ•…éšœçš„ç»“ç‚¹çš„è™šç”µè·¯å‡ä¸èƒ½å·¥ä½œ</strong></td><td><strong>å‡ºæ•…éšœçš„ç»“ç‚¹å¯èƒ½ä¼šä¸¢å¤±åˆ†ç»„ï¼Œä¸€äº›è·¯ç”±å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–</strong></td></tr><tr><td><strong>åˆ†ç»„çš„é¡ºåº</strong></td><td><strong>æ€»æ˜¯æŒ‰å‘é€é¡ºåºåˆ°è¾¾ç»ˆç‚¹</strong></td><td><strong>åˆ°è¾¾ç»ˆç‚¹æ—¶ä¸ä¸€å®šæŒ‰å‘é€é¡ºåº</strong></td></tr><tr><td><strong>ç«¯åˆ°ç«¯çš„å·®é”™å¤„ç†å’Œæµé‡æ§åˆ¶</strong></td><td><strong>å¯ä»¥ç”±ç½‘ç»œè´Ÿè´£ï¼Œä¹Ÿå¯ä»¥ç”±ç”¨æˆ·ä¸»æœºè´Ÿè´£</strong></td><td><strong>ç”±ç”¨æˆ·ä¸»æœºè´Ÿè´£</strong></td></tr></tbody></table><h2 id="IPv4"><a href="#IPv4" class="headerlink" title="IPv4"></a>IPv4</h2><h3 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><ul><li><p><mark>IPv4åœ°å€</mark>å°±æ˜¯ç»™å› ç‰¹ç½‘ï¼ˆInternetï¼‰ä¸Šçš„<mark>æ¯ä¸€å°ä¸»æœº (æˆ–è·¯ç”±å™¨)çš„æ¯ä¸€ä¸ªæ¥å£</mark>åˆ†é…ä¸€ä¸ªåœ¨å…¨ä¸–ç•ŒèŒƒå›´å†…æ˜¯<mark>å”¯ä¸€çš„32æ¯”ç‰¹çš„æ ‡è¯†ç¬¦</mark>ã€‚</p></li><li><p>IPv4åœ°å€çš„ç¼–å€æ–¹æ³•ç»å†äº†å¦‚ä¸‹ä¸‰ä¸ªå†å²é˜¶æ®µï¼š</p></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231124154837302.png" alt="image-20231124154837302"></p><ul><li>32æ¯”ç‰¹çš„IPv4åœ°å€ä¸æ–¹ä¾¿é˜…è¯»ã€è®°å½•ä»¥åŠè¾“å…¥ç­‰ï¼Œå› æ­¤IPv4åœ°å€é‡‡ç”¨<mark>ç‚¹åˆ†åè¿›åˆ¶è¡¨ç¤ºæ–¹æ³•</mark>ä»¥æ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ã€‚</li></ul><h3 id="åˆ†ç±»ç¼–åˆ¶çš„IPv4åœ°å€"><a href="#åˆ†ç±»ç¼–åˆ¶çš„IPv4åœ°å€" class="headerlink" title="åˆ†ç±»ç¼–åˆ¶çš„IPv4åœ°å€"></a>åˆ†ç±»ç¼–åˆ¶çš„IPv4åœ°å€</h3><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201017144317166.png" alt="image-20201017144317166"></p><ul><li>æ¯ä¸€ç±»åœ°å€éƒ½ç”±ä¸¤ä¸ªå›ºå®šé•¿åº¦çš„å­—æ®µç»„æˆï¼Œå…¶ä¸­ä¸€ä¸ªå­—æ®µæ˜¯<strong>ç½‘ç»œå· net-id</strong>ï¼Œå®ƒæ ‡å¿—ä¸»æœºï¼ˆæˆ–è·¯ç”±å™¨ï¼‰æ‰€è¿æ¥åˆ°çš„ç½‘ç»œï¼Œè€Œå¦ä¸€ä¸ªå­—æ®µåˆ™æ˜¯<strong>ä¸»æœºå· host-id</strong>ï¼Œå®ƒæ ‡å¿—è¯¥ä¸»æœºï¼ˆæˆ–è·¯ç”±å™¨ï¼‰ã€‚</li><li>ä¸»æœºå·åœ¨å®ƒå‰é¢çš„ç½‘ç»œå·æ‰€æŒ‡æ˜çš„ç½‘ç»œèŒƒå›´å†…å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚</li><li>ç”±æ­¤å¯è§ï¼Œ<strong>ä¸€ä¸ª IP åœ°å€åœ¨æ•´ä¸ªäº’è”ç½‘èŒƒå›´å†…æ˜¯å”¯ä¸€çš„</strong>ã€‚</li></ul><p><strong>Aç±»åœ°å€</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201017145210533.png" alt="image-20201017145210533"></p><p><strong>Bç±»åœ°å€</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201017145508001.png" alt="image-20201017145508001"></p><p><strong>Cç±»åœ°å€</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201017150204774.png" alt="image-20201017150204774"></p><p><strong>ç»ƒä¹ </strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201017150543386.png" alt="image-20201017150543386"></p><h4 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p><strong>IP åœ°å€çš„æŒ‡æ´¾èŒƒå›´</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231124163033439.png" alt="image-20231124163033439"></p><p><strong>ä¸€èˆ¬ä¸ä½¿ç”¨çš„ç‰¹æ®Šçš„ IP åœ°å€</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201017152959586.png" alt="image-20201017152959586"></p><p><strong>IP åœ°å€çš„ä¸€äº›é‡è¦ç‰¹ç‚¹</strong></p><ol><li><strong>IP åœ°å€æ˜¯ä¸€ç§åˆ†ç­‰çº§çš„åœ°å€ç»“æ„</strong>ã€‚åˆ†ä¸¤ä¸ªç­‰çº§çš„å¥½å¤„æ˜¯ï¼š</li></ol><ul><li><strong>ç¬¬ä¸€</strong>ï¼ŒIP åœ°å€ç®¡ç†æœºæ„åœ¨åˆ†é… IP åœ°å€æ—¶åªåˆ†é…ç½‘ç»œå·ï¼Œè€Œå‰©ä¸‹çš„ä¸»æœºå·åˆ™ç”±å¾—åˆ°è¯¥ç½‘ç»œå·çš„å•ä½è‡ªè¡Œåˆ†é…ã€‚è¿™æ ·å°±æ–¹ä¾¿äº† IP åœ°å€çš„ç®¡ç†ã€‚</li><li><strong>ç¬¬äºŒ</strong>ï¼Œè·¯ç”±å™¨ä»…æ ¹æ®ç›®çš„ä¸»æœºæ‰€è¿æ¥çš„ç½‘ç»œå·æ¥è½¬å‘åˆ†ç»„ï¼ˆè€Œä¸è€ƒè™‘ç›®çš„ä¸»æœºå·ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿è·¯ç”±è¡¨ä¸­çš„é¡¹ç›®æ•°å¤§å¹…åº¦å‡å°‘ï¼Œä»è€Œå‡å°äº†è·¯ç”±è¡¨æ‰€å çš„å­˜å‚¨ç©ºé—´ã€‚</li></ul><ol start="2"><li><strong>å®é™…ä¸Š IP åœ°å€æ˜¯æ ‡å¿—ä¸€ä¸ªä¸»æœºï¼ˆæˆ–è·¯ç”±å™¨ï¼‰å’Œä¸€æ¡é“¾è·¯çš„æ¥å£</strong>ã€‚</li></ol><ul><li>å½“ä¸€ä¸ªä¸»æœºåŒæ—¶è¿æ¥åˆ°ä¸¤ä¸ªç½‘ç»œä¸Šæ—¶ï¼Œè¯¥ä¸»æœºå°±å¿…é¡»åŒæ—¶å…·æœ‰ä¸¤ä¸ªç›¸åº”çš„ IP åœ°å€ï¼Œå…¶ç½‘ç»œå· net-id å¿…é¡»æ˜¯ä¸åŒçš„ã€‚è¿™ç§ä¸»æœºç§°ä¸º<strong>å¤šå½’å±ä¸»æœº</strong> (multihomed host)ã€‚</li><li>ç”±äºä¸€ä¸ªè·¯ç”±å™¨è‡³å°‘åº”å½“è¿æ¥åˆ°ä¸¤ä¸ªç½‘ç»œï¼ˆè¿™æ ·å®ƒæ‰èƒ½å°† IP æ•°æ®æŠ¥ä»ä¸€ä¸ªç½‘ç»œè½¬å‘åˆ°å¦ä¸€ä¸ªç½‘ç»œï¼‰ï¼Œå› æ­¤<strong>ä¸€ä¸ªè·¯ç”±å™¨è‡³å°‘åº”å½“æœ‰ä¸¤ä¸ªä¸åŒçš„ IP åœ°å€</strong>ã€‚</li></ul><ol start="3"><li><p><strong>ç”¨è½¬å‘å™¨æˆ–ç½‘æ¡¥è¿æ¥èµ·æ¥çš„è‹¥å¹²ä¸ªå±€åŸŸç½‘ä»ä¸ºä¸€ä¸ªç½‘ç»œ</strong>ï¼Œå› æ­¤è¿™äº›å±€åŸŸç½‘éƒ½å…·æœ‰åŒæ ·çš„ç½‘ç»œå· net-idã€‚</p></li><li><p><strong>æ‰€æœ‰åˆ†é…åˆ°ç½‘ç»œå· net-id çš„ç½‘ç»œï¼Œæ— è®ºæ˜¯èŒƒå›´å¾ˆå°çš„å±€åŸŸç½‘ï¼Œè¿˜æ˜¯å¯èƒ½è¦†ç›–å¾ˆå¤§åœ°ç†èŒƒå›´çš„å¹¿åŸŸç½‘ï¼Œéƒ½æ˜¯å¹³ç­‰çš„ã€‚</strong></p></li></ol><h3 id="åˆ’åˆ†å­ç½‘çš„IPv4åœ°å€"><a href="#åˆ’åˆ†å­ç½‘çš„IPv4åœ°å€" class="headerlink" title="åˆ’åˆ†å­ç½‘çš„IPv4åœ°å€"></a>åˆ’åˆ†å­ç½‘çš„IPv4åœ°å€</h3><h4 id="ä¸ºä»€ä¹ˆè¦åˆ’åˆ†å­ç½‘"><a href="#ä¸ºä»€ä¹ˆè¦åˆ’åˆ†å­ç½‘" class="headerlink" title="ä¸ºä»€ä¹ˆè¦åˆ’åˆ†å­ç½‘"></a>ä¸ºä»€ä¹ˆè¦åˆ’åˆ†å­ç½‘</h4><p>åœ¨ ARPANET çš„æ—©æœŸï¼ŒIP åœ°å€çš„è®¾è®¡ç¡®å®ä¸å¤Ÿåˆç†ï¼š</p><ul><li>IP åœ°å€ç©ºé—´çš„<mark>åˆ©ç”¨ç‡æœ‰æ—¶å¾ˆä½</mark>ã€‚ </li><li>ç»™æ¯ä¸€ä¸ªç‰©ç†ç½‘ç»œåˆ†é…ä¸€ä¸ªç½‘ç»œå·ä¼šä½¿<strong>è·¯ç”±è¡¨å˜å¾—å¤ªå¤§</strong>å› è€Œä½¿<mark>ç½‘ç»œæ€§èƒ½å˜å</mark>ã€‚ </li><li>ä¸¤çº§çš„ IP åœ°å€<mark>ä¸å¤Ÿçµæ´»</mark>ã€‚</li></ul><p>å¦‚æœæƒ³è¦å°†åŸæ¥çš„ç½‘ç»œåˆ’åˆ†æˆä¸‰ä¸ªç‹¬ç«‹çš„ç½‘è·¯ï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201017154852896.png" alt="image-20201017154852896"></p><p>æ‰€ä»¥æ˜¯å¦å¯ä»¥<mark><strong>ä»ä¸»æœºå·éƒ¨åˆ†å€Ÿç”¨ä¸€éƒ¨åˆ†ä½œä¸ºå­ç½‘å·</strong></mark></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201017155026814.png" alt="image-20201017155026814"></p><blockquote><p>ä½†æ˜¯å¦‚æœæœªåœ¨å›¾ä¸­æ ‡è®°å­ç½‘å·éƒ¨åˆ†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å’Œè®¡ç®—æœºåˆå¦‚ä½•çŸ¥é“åˆ†ç±»åœ°å€ä¸­ä¸»æœºå·æœ‰å¤šå°‘æ¯”ç‰¹è¢«ç”¨ä½œå­ç½‘å·äº†å‘¢ï¼Ÿ</p><p>æ‰€ä»¥å°±æœ‰äº†åˆ’åˆ†å­ç½‘çš„å·¥å…·ï¼š<strong>å­ç½‘æ©ç </strong></p><ul><li>ä» 1985 å¹´èµ·åœ¨ IP åœ°å€ä¸­åˆå¢åŠ äº†ä¸€ä¸ªâ€œ<strong>å­ç½‘å·å­—æ®µ</strong>â€ï¼Œä½¿ä¸¤çº§çš„ IP åœ°å€å˜æˆä¸º<strong>ä¸‰çº§çš„ IP åœ°å€</strong>ã€‚</li><li>è¿™ç§åšæ³•å«åš<strong>åˆ’åˆ†å­ç½‘</strong> (subnetting) ã€‚</li><li>åˆ’åˆ†å­ç½‘å·²æˆä¸ºäº’è”ç½‘çš„æ­£å¼æ ‡å‡†åè®®ã€‚</li></ul></blockquote><h4 id="å¦‚ä½•åˆ’åˆ†å­ç½‘"><a href="#å¦‚ä½•åˆ’åˆ†å­ç½‘" class="headerlink" title="å¦‚ä½•åˆ’åˆ†å­ç½‘"></a>å¦‚ä½•åˆ’åˆ†å­ç½‘</h4><p>åŸºæœ¬æ€è·¯</p><ul><li>åˆ’åˆ†å­ç½‘çº¯å±ä¸€ä¸ª<strong>å•ä½å†…éƒ¨çš„äº‹æƒ…</strong>ã€‚å•ä½å¯¹å¤–ä»ç„¶è¡¨ç°ä¸ºæ²¡æœ‰åˆ’åˆ†å­ç½‘çš„ç½‘ç»œã€‚</li><li>ä»ä¸»æœºå·<strong>å€Ÿç”¨</strong>è‹¥å¹²ä¸ªä½ä½œä¸º<strong>å­ç½‘å·</strong> subnet-idï¼Œè€Œä¸»æœºå· host-id ä¹Ÿå°±ç›¸åº”å‡å°‘äº†è‹¥å¹²ä¸ªä½ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201017155930011.png" alt="image-20201017155930011"></p><ul><li>å‡¡æ˜¯ä»å…¶ä»–ç½‘ç»œå‘é€ç»™æœ¬å•ä½æŸä¸ªä¸»æœºçš„ IP æ•°æ®æŠ¥ï¼Œä»ç„¶æ˜¯æ ¹æ® IP æ•°æ®æŠ¥çš„<strong>ç›®çš„ç½‘ç»œå·</strong> net-idï¼Œå…ˆæ‰¾åˆ°è¿æ¥åœ¨æœ¬å•ä½ç½‘ç»œä¸Šçš„è·¯ç”±å™¨ã€‚</li><li>ç„¶å<strong>æ­¤è·¯ç”±å™¨</strong>åœ¨æ”¶åˆ° IP æ•°æ®æŠ¥åï¼Œå†æŒ‰<strong>ç›®çš„ç½‘ç»œå·</strong> net-id å’Œ<strong>å­ç½‘å·</strong> subnet-id æ‰¾åˆ°ç›®çš„å­ç½‘ã€‚</li><li>æœ€åå°±å°† IP æ•°æ®æŠ¥ç›´æ¥äº¤ä»˜ç›®çš„ä¸»æœºã€‚</li></ul><p>åˆ’åˆ†ä¸ºä¸‰ä¸ªå­ç½‘åå¯¹å¤–ä»æ˜¯ä¸€ä¸ªç½‘ç»œ</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201017160116239.png" alt="image-20201017160116239"></p><blockquote><ul><li><strong>ä¼˜ç‚¹</strong><ol><li>å‡å°‘äº† IP åœ°å€çš„æµªè´¹</li><li>ä½¿ç½‘ç»œçš„ç»„ç»‡æ›´åŠ çµæ´»</li><li>æ›´ä¾¿äºç»´æŠ¤å’Œç®¡ç†</li></ol></li><li><strong>åˆ’åˆ†å­ç½‘çº¯å±ä¸€ä¸ªå•ä½å†…éƒ¨çš„äº‹æƒ…ï¼Œå¯¹å¤–éƒ¨ç½‘ç»œé€æ˜</strong>ï¼Œå¯¹å¤–ä»ç„¶è¡¨ç°ä¸ºæ²¡æœ‰åˆ’åˆ†å­ç½‘çš„ä¸€ä¸ªç½‘ç»œã€‚</li></ul></blockquote><h4 id="å­ç½‘æ©ç "><a href="#å­ç½‘æ©ç " class="headerlink" title="å­ç½‘æ©ç "></a>å­ç½‘æ©ç </h4><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201017160252066.png" alt="image-20201017160252066"></p><blockquote><p><strong>(IP åœ°å€) AND (å­ç½‘æ©ç ) &#x3D; ç½‘ç»œåœ°å€</strong> é‡è¦ï¼Œä¸‹é¢å¾ˆå¤šç›¸å…³çŸ¥è¯†éƒ½ä¼šç”¨åˆ°</p></blockquote><p>ä¸¾ä¾‹ï¼š</p><p>ä¾‹å­1ï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201017161651058.png" alt="image-20201017161651058"></p><p>ä¾‹å­2</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201017161719339.png" alt="image-20201017161719339"></p><p><strong>ä¾‹é¢˜ï¼š</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231124175138343.png" alt="image-20231124175138343"></p><p><strong>é»˜è®¤å­ç½‘æ©ç ï¼š</strong></p><p><mark>é»˜è®¤çš„å­ç½‘æ©ç æ˜¯æŒ‡åœ¨<strong>æœªåˆ’åˆ†å­ç½‘çš„æƒ…å†µä¸‹</strong>ä½¿ç”¨çš„å­ç½‘æ©ç ã€‚</mark></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231124175338752.png" alt="image-20231124175338752"></p><h4 id="æ€»ç»“-3"><a href="#æ€»ç»“-3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201017162938612.png" alt="image-20201017162938612"></p><blockquote><ul><li>å­ç½‘æ©ç æ˜¯ä¸€ä¸ªç½‘ç»œæˆ–ä¸€ä¸ªå­ç½‘çš„é‡è¦å±æ€§ã€‚</li><li>è·¯ç”±å™¨åœ¨å’Œç›¸é‚»è·¯ç”±å™¨äº¤æ¢è·¯ç”±ä¿¡æ¯æ—¶ï¼Œå¿…é¡»æŠŠè‡ªå·±æ‰€åœ¨ç½‘ç»œï¼ˆæˆ–å­ç½‘ï¼‰çš„å­ç½‘æ©ç å‘Šè¯‰ç›¸é‚»è·¯ç”±å™¨ã€‚</li><li>è·¯ç”±å™¨çš„è·¯ç”±è¡¨ä¸­çš„æ¯ä¸€ä¸ªé¡¹ç›®ï¼Œé™¤äº†è¦ç»™å‡ºç›®çš„ç½‘ç»œåœ°å€å¤–ï¼Œè¿˜å¿…é¡»åŒæ—¶ç»™å‡ºè¯¥ç½‘ç»œçš„å­ç½‘æ©ç ã€‚</li><li>è‹¥ä¸€ä¸ªè·¯ç”±å™¨è¿æ¥åœ¨ä¸¤ä¸ªå­ç½‘ä¸Šï¼Œå°±æ‹¥æœ‰ä¸¤ä¸ªç½‘ç»œåœ°å€å’Œä¸¤ä¸ªå­ç½‘æ©ç ã€‚</li></ul></blockquote><h3 id="æ— åˆ†ç±»ç¼–å€çš„IPv4åœ°å€"><a href="#æ— åˆ†ç±»ç¼–å€çš„IPv4åœ°å€" class="headerlink" title="æ— åˆ†ç±»ç¼–å€çš„IPv4åœ°å€"></a>æ— åˆ†ç±»ç¼–å€çš„IPv4åœ°å€</h3><h4 id="ä¸ºä»€ä¹ˆä½¿ç”¨æ— åˆ†ç±»ç¼–å€"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨æ— åˆ†ç±»ç¼–å€" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨æ— åˆ†ç±»ç¼–å€"></a>ä¸ºä»€ä¹ˆä½¿ç”¨æ— åˆ†ç±»ç¼–å€</h4><ul><li><p>åˆ’åˆ†å­ç½‘åœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£äº†å› ç‰¹ç½‘åœ¨å‘å±•ä¸­é‡åˆ°çš„å›°éš¾ï¼Œä½†æ˜¯<strong>æ•°é‡å·¨å¤§çš„Cç±»ç½‘å› ä¸ºå…¶åœ°å€ç©ºé—´å¤ªå°å¹¶æ²¡æœ‰å¾—åˆ°å……åˆ†ä½¿ç”¨</strong>ï¼Œè€Œå› ç‰¹ç½‘çš„IPåœ°å€ä»åœ¨åŠ é€Ÿæ¶ˆè€—ï¼Œæ•´ä¸ª<mark>IPv4åœ°å€ç©ºé—´é¢ä¸´å…¨éƒ¨è€—å°½çš„å¨èƒ</mark>ã€‚</p></li><li><p><mark>CIDRæ¶ˆé™¤äº†ä¼ ç»Ÿçš„Aç±»ã€Bç±»å’ŒCç±»åœ°å€ï¼Œä»¥åŠåˆ’åˆ†å­ç½‘çš„æ¦‚å¿µ</mark></p></li><li><p><mark>CIDRå¯ä»¥æ›´åŠ æœ‰æ•ˆåœ°åˆ†é…IPv4çš„åœ°å€ç©ºé—´</mark>ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ–°çš„IPv6ä½¿ç”¨ä¹‹å‰å…è®¸å› ç‰¹ç½‘çš„è§„æ¨¡ç»§ç»­å¢é•¿ã€‚</p></li></ul><blockquote><p><strong>CIDR æœ€ä¸»è¦çš„ç‰¹ç‚¹</strong></p><ul><li>CIDRä½¿ç”¨å„ç§é•¿åº¦çš„â€œ<strong>ç½‘ç»œå‰ç¼€</strong>â€(network-prefix)æ¥ä»£æ›¿åˆ†ç±»åœ°å€ä¸­çš„ç½‘ç»œå·å’Œå­ç½‘å·ã€‚</li><li><strong>IP åœ°å€ä»ä¸‰çº§ç¼–å€ï¼ˆä½¿ç”¨å­ç½‘æ©ç ï¼‰åˆå›åˆ°äº†ä¸¤çº§ç¼–å€</strong>ã€‚</li></ul></blockquote><h4 id="å¦‚ä½•ä½¿ç”¨æ— åˆ†ç±»ç¼–å€"><a href="#å¦‚ä½•ä½¿ç”¨æ— åˆ†ç±»ç¼–å€" class="headerlink" title="å¦‚ä½•ä½¿ç”¨æ— åˆ†ç±»ç¼–å€"></a>å¦‚ä½•ä½¿ç”¨æ— åˆ†ç±»ç¼–å€</h4><ul><li>CIDRä½¿ç”¨â€œ<mark>æ–œçº¿è®°æ³•</mark>â€ï¼Œæˆ–ç§°CIDRè®°æ³•ã€‚å³åœ¨IPv4åœ°å€åé¢åŠ ä¸Šæ–œçº¿â€œ&#x2F;â€ï¼Œ<mark>åœ¨æ–œçº¿åé¢å†™ä¸Šç½‘ç»œå‰ç¼€æ‰€å çš„æ¯”ç‰¹æ•°é‡</mark>ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231124200743238.png" alt="image-20231124200743238"></p><ul><li><p>CIDRå®é™…ä¸Šæ˜¯<mark>å°†ç½‘ç»œå‰ç¼€éƒ½ç›¸åŒçš„è¿ç»­çš„IPåœ°å€ç»„æˆä¸€ä¸ª<strong>CIDRåœ°å€å—</strong></mark>ã€‚</p></li><li><p>æˆ‘ä»¬åªè¦çŸ¥é“CIDRåœ°å€å—ä¸­çš„ä»»ä½•ä¸€ä¸ªåœ°å€ï¼Œå°±å¯ä»¥çŸ¥é“è¯¥åœ°å€å—çš„å…¨éƒ¨ç»†èŠ‚</p><ul><li>åœ°å€å—çš„æœ€å°åœ°å€</li><li>åœ°å€å—çš„æœ€å¤§åœ°å€</li><li>åœ°å€å—ä¸­çš„åœ°å€æ•°é‡</li><li>åœ°å€å—èšåˆæŸç±»ç½‘ç»œ(Aç±»ã€Bç±»æˆ–Cç±»)çš„æ•°é‡</li></ul><blockquote><p>è§£é‡Šåœ°å€å—èšåˆCç±»ç½‘ç»œï¼šCIDRå—ä¸­çš„IPåœ°å€å¯ä»¥åˆ’åˆ†ä¸ºå¤šä¸ªCç±»ç½‘ï¼Œæ¯ä¸ªCç±»ç½‘åŒ…å«2^8^ä¸ªIPåœ°å€ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°†ä¸»æœºæ•°é‡é™¤ä»¥2^8^ï¼Œå¾—åˆ°Cç±»ç½‘çš„æ•°é‡ã€‚</p></blockquote><ul><li>åœ°å€æ©ç (ä¹Ÿå¯ç»§ç»­ç§°ä¸ºå­ç½‘æ©ç )</li></ul></li></ul><p>ä¸¾ä¾‹ï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201017165113442.png" alt="image-20201017165113442"></p><h4 id="è·¯ç”±èšåˆï¼ˆæ„é€ è¶…ç½‘ï¼‰"><a href="#è·¯ç”±èšåˆï¼ˆæ„é€ è¶…ç½‘ï¼‰" class="headerlink" title="è·¯ç”±èšåˆï¼ˆæ„é€ è¶…ç½‘ï¼‰"></a>è·¯ç”±èšåˆï¼ˆæ„é€ è¶…ç½‘ï¼‰</h4><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231124201322773.png" alt="image-20231124201322773"></p><ul><li><mark>ç½‘ç»œå‰ç¼€è¶Šé•¿ï¼Œåœ°å€å—è¶Šå°ï¼Œè·¯ç”±è¶Šå…·ä½“ï¼›</mark></li><li>è‹¥è·¯ç”±å™¨æŸ¥è¡¨è½¬å‘åˆ†ç»„æ—¶å‘ç°æœ‰å¤šæ¡è·¯ç”±å¯é€‰ï¼Œåˆ™é€‰æ‹©ç½‘ç»œå‰ç¼€æœ€é•¿çš„é‚£æ¡ï¼Œè¿™ç§°ä¸º<mark>æœ€é•¿å‰ç¼€åŒ¹é…</mark><br>å› ä¸ºè¿™æ ·çš„è·¯ç”±æ›´å…·ä½“ã€‚</li></ul><p><strong>ä¾‹é¢˜ï¼š</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231124201141275.png" alt="image-20231124201141275"></p><hr><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231124200032872.png" alt="image-20231124200032872"></p><h4 id="æ€»ç»“-4"><a href="#æ€»ç»“-4" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201017170552495.png" alt="image-20201017170552495"></p><h3 id="IPv4åœ°å€çš„åº”ç”¨è§„åˆ’"><a href="#IPv4åœ°å€çš„åº”ç”¨è§„åˆ’" class="headerlink" title="IPv4åœ°å€çš„åº”ç”¨è§„åˆ’"></a>IPv4åœ°å€çš„åº”ç”¨è§„åˆ’</h3><p>ç»™å®šä¸€ä¸ªIPv4åœ°å€å¿«ï¼Œå¦‚ä½•å°†å…¶åˆ’åˆ†æˆå‡ ä¸ªæ›´å°çš„åœ°å€å—ï¼Œå¹¶å°†è¿™äº›åœ°å€å—åˆ†é…ç»™äº’è”ç½‘ä¸­ä¸åŒç½‘ç»œï¼Œè¿›è€Œå¯ä»¥ç»™å„ç½‘ç»œä¸­çš„ä¸»æœºå’Œè·¯ç”±å™¨æ¥å£åˆ†é…IPv4åœ°å€</p><h4 id="å®šé•¿çš„å­ç½‘æ©ç FLSMï¼ˆFixed-Length-Subnet-Maskï¼‰"><a href="#å®šé•¿çš„å­ç½‘æ©ç FLSMï¼ˆFixed-Length-Subnet-Maskï¼‰" class="headerlink" title="å®šé•¿çš„å­ç½‘æ©ç FLSMï¼ˆFixed Length Subnet Maskï¼‰"></a>å®šé•¿çš„å­ç½‘æ©ç FLSMï¼ˆFixed Length Subnet Maskï¼‰</h4><ul><li>ä½¿ç”¨<strong>åŒä¸€ä¸ªå­ç½‘æ©ç </strong>æ¥åˆ’åˆ†å­ç½‘</li><li>å­ç½‘åˆ’åˆ†æ–¹å¼ä¸çµæ´»ï¼šåªèƒ½åˆ’åˆ†å‡º2^n^ä¸ªå­ç½‘ï¼ˆnæ˜¯ä»ä¸»æœºå·éƒ¨åˆ†å€Ÿç”¨çš„ç”¨æ¥ä½œä¸ºå­ç½‘å·çš„æ¯”ç‰¹æ•°é‡ï¼‰</li><li>æ¯ä¸ªå­ç½‘æ‰€åˆ†é…çš„IPåœ°å€æ•°é‡ç›¸åŒï¼Œå®¹æ˜“é€ æˆIPåœ°å€æµªè´¹</li></ul><p><mark><strong>åˆ’åˆ†å­ç½‘çš„IPv4å°±æ˜¯å®šé•¿çš„å­ç½‘æ©ç </strong></mark></p><p>ä¸¾ä¾‹ï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018140809079.png" alt="image-20201018140809079"></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018140916631.png" alt="image-20201018140916631"></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018141132446.png" alt="image-20201018141132446"></p><blockquote><p>é€šè¿‡ä¸Šé¢æ­¥éª¤åˆ†æï¼Œå°±å¯ä»¥ä»å­ç½‘1åˆ°8ä¸­ä»»é€‰5ä¸ªåˆ†é…ç»™å·¦å›¾ä¸­çš„N1åˆ°N5</p><p><strong>é‡‡ç”¨å®šé•¿çš„å­ç½‘æ©ç åˆ’åˆ†ï¼Œåªèƒ½åˆ’åˆ†å‡º2^n^ä¸ªå­ç½‘ï¼Œå…¶ä¸­næ˜¯ä»ä¸»æœºå·éƒ¨åˆ†å€Ÿç”¨çš„ç”¨æ¥ä½œä¸ºå­ç½‘å·çš„æ¯”ç‰¹æ•°é‡ï¼Œæ¯ä¸ªå­ç½‘æ‰€åˆ†é…çš„IPåœ°å€æ•°é‡ç›¸åŒ</strong></p><p><strong>ä½†æ˜¯ä¹Ÿå› ä¸ºæ¯ä¸ªå­ç½‘æ‰€åˆ†é…çš„IPåœ°å€æ•°é‡ç›¸åŒï¼Œä¸å¤Ÿçµæ´»ï¼Œå®¹æ˜“é€ æˆIPåœ°å€çš„æµªè´¹</strong></p></blockquote><h4 id="å˜é•¿çš„å­ç½‘æ©ç VLSMï¼ˆVariable-Length-Subnet-Maskï¼‰"><a href="#å˜é•¿çš„å­ç½‘æ©ç VLSMï¼ˆVariable-Length-Subnet-Maskï¼‰" class="headerlink" title="å˜é•¿çš„å­ç½‘æ©ç VLSMï¼ˆVariable Length Subnet Maskï¼‰"></a>å˜é•¿çš„å­ç½‘æ©ç VLSMï¼ˆVariable Length Subnet Maskï¼‰</h4><ul><li>ä½¿ç”¨<strong>ä¸åŒçš„å­ç½‘æ©ç </strong>æ¥åˆ’åˆ†å­ç½‘</li><li>å­ç½‘åˆ’åˆ†æ–¹å¼çµæ´»ï¼šå¯ä»¥æŒ‰éœ€åˆ†é…</li><li>æ¯ä¸ªå­ç½‘æ‰€åˆ†é…çš„IPåœ°å€æ•°é‡å¯ä»¥ä¸åŒï¼Œå°½å¯èƒ½å‡å°‘å¯¹IPåœ°å€çš„æµªè´¹</li></ul><p><mark><strong>æ— åˆ†ç±»ç¼–å€çš„IPv4å°±æ˜¯å˜é•¿çš„å­ç½‘æ©ç </strong></mark></p><p>ä¸¾ä¾‹ï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018142333145.png" alt="image-20201018142333145"></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018143344440.png" alt="image-20201018143344440"></p><h2 id="IPæ•°æ®æŠ¥çš„å‘é€å’Œè½¬å‘è¿‡ç¨‹â­"><a href="#IPæ•°æ®æŠ¥çš„å‘é€å’Œè½¬å‘è¿‡ç¨‹â­" class="headerlink" title="IPæ•°æ®æŠ¥çš„å‘é€å’Œè½¬å‘è¿‡ç¨‹â­"></a>IPæ•°æ®æŠ¥çš„å‘é€å’Œè½¬å‘è¿‡ç¨‹â­</h2><p>IPæ•°æ®æŠ¥çš„å‘é€å’Œè½¬å‘è¿‡ç¨‹åŒ…å«ä»¥ä¸‹ä¸¤éƒ¨åˆ†ï¼š</p><ul><li>ä¸»æœºå‘é€IPæ•°æ®æŠ¥</li><li>è·¯ç”±å™¨è½¬å‘IPæ•°æ®æŠ¥</li></ul><blockquote><p>ä¸ºäº†å°†é‡ç‚¹æ”¾åœ¨TCP&#x2F;IPåè®®æ ˆçš„ç½‘é™…å±‚å‘é€å’Œè½¬å‘IPæ•°æ®æŠ¥çš„è¿‡ç¨‹ä¸Šï¼Œåœ¨ä¹‹åçš„ä¸¾ä¾‹ä¸­ï¼Œæˆ‘ä»¬<mark>å¿½ç•¥ä½¿ç”¨ARPåè®®æ¥è·å–ç›®çš„ä¸»æœºæˆ–è·¯ç”±å™¨æ¥å£çš„MACåœ°å€çš„è¿‡ç¨‹ä»¥åŠä»¥å¤ªç½‘äº¤æ¢æœºè‡ªå­¦ä¹ å’Œè½¬å‘å¸§çš„è¿‡ç¨‹</mark>ã€‚</p></blockquote><h3 id="å‘é€"><a href="#å‘é€" class="headerlink" title="å‘é€"></a>å‘é€</h3><p>ä¸¾ä¾‹</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018151314019.png" alt="image-20201018151314019"></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018150151171.png" alt="image-20201018150151171"></p><p>æºä¸»æœºå¦‚ä½•çŸ¥é“ç›®çš„ä¸»æœºæ˜¯å¦ä¸è‡ªå·±åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ï¼Œæ˜¯ç›´æ¥äº¤ä»˜ï¼Œè¿˜æ˜¯é—´æ¥äº¤ä»˜ï¼Ÿ</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018150223497.png" alt="image-20201018150223497"></p><blockquote><p>å¯ä»¥é€šè¿‡<strong>ç›®çš„åœ°å€IP</strong>å’Œ<strong>æºåœ°å€çš„å­ç½‘æ©ç </strong>è¿›è¡Œ<strong>é€»è¾‘ä¸è¿ç®—</strong>å¾—åˆ°<strong>ç›®çš„ç½‘ç»œåœ°å€</strong></p><ul><li>å¦‚æœ<strong>ç›®çš„ç½‘ç»œåœ°å€</strong>å’Œ<strong>æºç½‘ç»œåœ°å€</strong> <strong>ç›¸åŒ</strong>ï¼Œå°±æ˜¯<strong>åœ¨åŒä¸€ä¸ªç½‘ç»œ</strong>ä¸­ï¼Œå±äº<strong>ç›´æ¥äº¤ä»˜</strong></li><li>å¦‚æœ<strong>ç›®çš„ç½‘ç»œåœ°å€</strong>å’Œ<strong>æºç½‘ç»œåœ°å€</strong> <strong>ä¸ç›¸åŒ</strong>ï¼Œå°±<strong>ä¸åœ¨åŒä¸€ä¸ªç½‘ç»œ</strong>ä¸­ï¼Œå±äº<strong>é—´æ¥äº¤ä»˜</strong>ï¼Œä¼ è¾“ç»™ä¸»æœºæ‰€åœ¨ç½‘ç»œçš„<strong>é»˜è®¤ç½‘å…³</strong>ï¼ˆè·¯ç”±å™¨â€”â€”ä¸‹å›¾ä¼šè®²è§£ï¼‰,ç”±é»˜è®¤ç½‘å…³å¸®å¿™è½¬å‘</li></ul></blockquote><p>ä¸»æœºCå¦‚ä½•çŸ¥é“è·¯ç”±å™¨Rçš„å­˜åœ¨ï¼Ÿ</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018145501063.png" alt="image-20201018145501063"></p><blockquote><p>ç”¨æˆ·ä¸ºäº†è®©æœ¬ç½‘ç»œä¸­çš„ä¸»æœºèƒ½å’Œå…¶ä»–ç½‘ç»œä¸­çš„ä¸»æœºè¿›è¡Œé€šä¿¡ï¼Œå°±å¿…é¡»ç»™å…¶æŒ‡å®šæœ¬ç½‘ç»œçš„ä¸€ä¸ªè·¯ç”±å™¨çš„æ¥å£ï¼Œç”±è¯¥è·¯ç”±å™¨å¸®å¿™è¿›è¡Œè½¬å‘ï¼Œ<strong>æ‰€æŒ‡å®šçš„è·¯ç”±å™¨</strong>ï¼Œä¹Ÿè¢«ç§°ä¸º<strong>é»˜è®¤ç½‘å…³</strong></p><p>ä¾‹å¦‚ã€‚è·¯ç”±å™¨çš„æ¥å£0çš„IPåœ°å€192.168.0.128åšä¸ºå·¦è¾¹ç½‘ç»œçš„é»˜è®¤ç½‘å…³</p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018150029179.png" alt="image-20201018150029179"></p><blockquote><p>ä¸»æœºAä¼šå°†è¯¥IPæ•°æ®æŠ¥ä¼ è¾“ç»™è‡ªå·±çš„é»˜è®¤ç½‘å…³ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­æ‰€ç¤ºçš„è·¯ç”±å™¨æ¥å£0</p></blockquote><h3 id="è½¬å‘"><a href="#è½¬å‘" class="headerlink" title="è½¬å‘"></a>è½¬å‘</h3><p>è·¯ç”±å™¨æ”¶åˆ°IPæ•°æ®æŠ¥åå¦‚ä½•è½¬å‘ï¼Ÿ</p><ul><li>æ£€æŸ¥IPæ•°æ®æŠ¥é¦–éƒ¨æ˜¯å¦å‡ºé”™ï¼š<ul><li><mark>è‹¥å‡ºé”™ï¼Œåˆ™ç›´æ¥ä¸¢å¼ƒ</mark>è¯¥IPæ•°æ®æŠ¥å¹¶é€šå‘Šæºä¸»æœº</li><li>è‹¥æ²¡æœ‰å‡ºé”™ï¼Œåˆ™è¿›è¡Œè½¬å‘</li></ul></li><li>æ ¹æ®IPæ•°æ®æŠ¥çš„ç›®çš„åœ°å€åœ¨è·¯ç”±è¡¨ä¸­æŸ¥æ‰¾åŒ¹é…çš„æ¡ç›®ï¼š<ul><li>è‹¥æ‰¾åˆ°åŒ¹é…çš„æ¡ç›®ï¼Œåˆ™è½¬å‘ç»™æ¡ç›®ä¸­æŒ‡ç¤ºçš„å“ä¸€è·³</li><li><mark>è‹¥æ‰¾ä¸åˆ°ï¼Œåˆ™ä¸¢å¼ƒ</mark>è¯¥æ•°æ®æŠ¥å¹¶é€šå‘Šæºä¸»æœº</li></ul></li></ul><p>å‡è®¾IPæ•°æ®æŠ¥é¦–éƒ¨æ²¡æœ‰å‡ºé”™ï¼Œè·¯ç”±å™¨å–å‡ºIPæ•°æ®æŠ¥é¦–éƒ¨å„åœ°å€å­—æ®µçš„å€¼</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018151108989.png" alt="image-20201018151108989"></p><p>æ¥ä¸‹æ¥è·¯ç”±å™¨å¯¹è¯¥IPæ•°æ®æŠ¥è¿›è¡ŒæŸ¥è¡¨è½¬å‘</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018151528027.png" alt="image-20201018151528027"></p><blockquote><p>é€æ¡æ£€æŸ¥è·¯ç”±æ¡ç›®ï¼Œå°†ç›®çš„åœ°å€ä¸è·¯ç”±æ¡ç›®ä¸­çš„åœ°å€æ©ç è¿›è¡Œé€»è¾‘ä¸è¿ç®—å¾—åˆ°ç›®çš„ç½‘ç»œåœ°å€ï¼Œç„¶åä¸è·¯ç”±æ¡ç›®ä¸­çš„ç›®çš„ç½‘ç»œè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒï¼Œåˆ™è¿™æ¡è·¯ç”±æ¡ç›®å°±æ˜¯åŒ¹é…çš„è·¯ç”±æ¡ç›®ï¼ŒæŒ‰ç…§å®ƒçš„ä¸‹ä¸€æ¡æŒ‡ç¤ºï¼Œå›¾ä¸­æ‰€ç¤ºçš„ä¹Ÿå°±æ˜¯æ¥å£1è½¬å‘è¯¥IPæ•°æ®æŠ¥</p></blockquote><h3 id="ä¾‹é¢˜-1"><a href="#ä¾‹é¢˜-1" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231124214709877.png" alt="image-20231124214709877"></p><hr><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231124214641496.png" alt="image-20231124214641496"></p><hr><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231124214527162.png" alt="image-20231124214527162"></p><h2 id="é™æ€è·¯ç”±é…ç½®åŠå…¶å¯èƒ½äº§ç”Ÿçš„è·¯ç”±ç¯è·¯é—®é¢˜"><a href="#é™æ€è·¯ç”±é…ç½®åŠå…¶å¯èƒ½äº§ç”Ÿçš„è·¯ç”±ç¯è·¯é—®é¢˜" class="headerlink" title="é™æ€è·¯ç”±é…ç½®åŠå…¶å¯èƒ½äº§ç”Ÿçš„è·¯ç”±ç¯è·¯é—®é¢˜"></a>é™æ€è·¯ç”±é…ç½®åŠå…¶å¯èƒ½äº§ç”Ÿçš„è·¯ç”±ç¯è·¯é—®é¢˜</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><ul><li>é™æ€è·¯ç”±é…ç½®æ˜¯æŒ‡ç”¨æˆ·æˆ–ç½‘ç»œç®¡ç†å‘˜ä½¿ç”¨è·¯ç”±å™¨çš„ç›¸å…³å‘½ä»¤ç»™è·¯ç”±å™¨<mark>äººå·¥é…ç½®è·¯ç”±è¡¨</mark><ul><li>è¿™ç§äººå·¥é…ç½®æ–¹å¼ç®€å•ã€å¼€é”€å°ã€‚ä½†<mark>ä¸èƒ½åŠæ—¶é€‚åº”ç½‘ç»œçŠ¶æ€ (æµé‡ã€æ‹“æ‰‘ç­‰)çš„å˜åŒ–</mark></li><li>ä¸€èˆ¬åªåœ¨å°è§„æ¨¡ç½‘ç»œä¸­é‡‡ç”¨ã€‚</li></ul></li><li>ä½¿ç”¨é™æ€è·¯ç”±é…ç½®å¯èƒ½å‡ºç°ä»¥ä¸‹<mark>å¯¼è‡´äº§ç”Ÿè·¯ç”±ç¯è·¯</mark>çš„é”™è¯¯<ul><li>é…ç½®é”™è¯¯</li><li>èšåˆäº†ä¸å­˜åœ¨çš„ç½‘ç»œ</li><li>ç½‘ç»œæ•…éšœ</li></ul></li></ul><h3 id="è·¯ç”±ç›¸å…³é…ç½®"><a href="#è·¯ç”±ç›¸å…³é…ç½®" class="headerlink" title="è·¯ç”±ç›¸å…³é…ç½®"></a>è·¯ç”±ç›¸å…³é…ç½®</h3><h4 id="é™æ€è·¯ç”±é…ç½®"><a href="#é™æ€è·¯ç”±é…ç½®" class="headerlink" title="é™æ€è·¯ç”±é…ç½®"></a>é™æ€è·¯ç”±é…ç½®</h4><p>ä¸¾ä¾‹ï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018160349375.png" alt="image-20201018160349375"></p><h4 id="é»˜è®¤è·¯ç”±"><a href="#é»˜è®¤è·¯ç”±" class="headerlink" title="é»˜è®¤è·¯ç”±"></a>é»˜è®¤è·¯ç”±</h4><p>ä¸¾ä¾‹ï¼š</p><p>é»˜è®¤è·¯ç”±å¯ä»¥è¢«æ‰€æœ‰ç½‘ç»œåŒ¹é…ï¼Œä½†è·¯ç”±åŒ¹é…æœ‰ä¼˜å…ˆçº§ï¼Œ<mark>é»˜è®¤è·¯ç”±æ˜¯ä¼˜å…ˆçº§æœ€ä½çš„</mark></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018160906284.png" alt="image-20201018160906284"></p><h4 id="ç‰¹å®šä¸»æœºè·¯ç”±"><a href="#ç‰¹å®šä¸»æœºè·¯ç”±" class="headerlink" title="ç‰¹å®šä¸»æœºè·¯ç”±"></a>ç‰¹å®šä¸»æœºè·¯ç”±</h4><p>ä¸¾ä¾‹ï¼š</p><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç»™è·¯ç”±å™¨æ·»åŠ é’ˆå¯¹æŸä¸ªä¸»æœºçš„ç‰¹å®šä¸»æœºè·¯ç”±æ¡ç›®</p><p>ä¸€èˆ¬ç”¨äºç½‘ç»œç®¡ç†äººå‘˜å¯¹ç½‘ç»œçš„ç®¡ç†å’Œæµ‹è¯•</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018161440257.png" alt="image-20201018161440257"></p><blockquote><p><strong>å¤šæ¡è·¯ç”±å¯é€‰ï¼ŒåŒ¹é…è·¯ç”±æœ€å…·ä½“çš„</strong></p></blockquote><h3 id="å¯¼è‡´è·¯ç”±ç¯è·¯çš„åŸå› "><a href="#å¯¼è‡´è·¯ç”±ç¯è·¯çš„åŸå› " class="headerlink" title="å¯¼è‡´è·¯ç”±ç¯è·¯çš„åŸå› "></a>å¯¼è‡´è·¯ç”±ç¯è·¯çš„åŸå› </h3><h4 id="é™æ€è·¯ç”±é…ç½®é”™è¯¯"><a href="#é™æ€è·¯ç”±é…ç½®é”™è¯¯" class="headerlink" title="é™æ€è·¯ç”±é…ç½®é”™è¯¯"></a>é™æ€è·¯ç”±é…ç½®é”™è¯¯</h4><p>ä¸¾ä¾‹ï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018161542579.png" alt="image-20201018161542579"></p><p>å‡è®¾å°†R2çš„è·¯ç”±è¡¨ä¸­ç¬¬ä¸‰æ¡ç›®å½•é…ç½®é”™äº†ä¸‹ä¸€è·³</p><p>è¿™å¯¼è‡´R2å’ŒR3ä¹‹é—´äº§ç”Ÿäº†è·¯ç”±ç¯è·¯</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018162041966.png" alt="image-20201018162041966"></p><blockquote><p>è§£å†³åŠæ³•ï¼šè®¾ç½®è¿‡æœŸæ—¶é—´TTL</p></blockquote><h4 id="èšåˆäº†ä¸å­˜åœ¨çš„ç½‘ç»œ"><a href="#èšåˆäº†ä¸å­˜åœ¨çš„ç½‘ç»œ" class="headerlink" title="èšåˆäº†ä¸å­˜åœ¨çš„ç½‘ç»œ"></a>èšåˆäº†ä¸å­˜åœ¨çš„ç½‘ç»œ</h4><p>ä¸¾ä¾‹ï¼š</p><p>æ­£å¸¸æƒ…å†µï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018162333671.png" alt="image-20201018162333671"></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018162759562.png" alt="image-20201018162759562"></p><p>é”™è¯¯æƒ…å†µï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018163323343.png" alt="image-20201018163323343"></p><p>è§£å†³æ–¹æ³•ï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018163933715.png" alt="image-20201018163933715"></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018164453398.png" alt="image-20201018164453398"></p><blockquote><p>è§£å†³åŠæ³•ï¼šè®¾ç½®é»‘æ´è·¯ç”±çš„ä¸‹ä¸€è·³ä¸ºnull0ï¼Œè¿™æ˜¯è·¯ç”±å™¨å†…éƒ¨çš„è™šæ‹Ÿæ¥å£ï¼ŒIPæ•°æ®æŠ¥è¿›å…¥å®ƒåå°±è¢«ä¸¢å¼ƒ</p></blockquote><h4 id="ç½‘ç»œæ•…éšœè€Œå¯¼è‡´è·¯ç”±ç¯è·¯"><a href="#ç½‘ç»œæ•…éšœè€Œå¯¼è‡´è·¯ç”±ç¯è·¯" class="headerlink" title="ç½‘ç»œæ•…éšœè€Œå¯¼è‡´è·¯ç”±ç¯è·¯"></a>ç½‘ç»œæ•…éšœè€Œå¯¼è‡´è·¯ç”±ç¯è·¯</h4><p>ä¸¾ä¾‹ï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018164811811.png" alt="image-20201018164811811"></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018164913684.png" alt="image-20201018164913684"></p><p>è§£å†³æ–¹æ³•ï¼š</p><p><strong>æ·»åŠ æ•…éšœçš„ç½‘ç»œä¸ºé»‘æ´è·¯ç”±</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018165122023.png" alt="image-20201018165122023"></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201018165153517.png" alt="image-20201018165153517"></p><ul><li><p>å‡è®¾ä¸€æ®µæ—¶é—´åæ•…éšœç½‘ç»œæ¢å¤äº†ï¼ŒR1åˆè‡ªåŠ¨åœ°å¾—å‡ºäº†å…¶æ¥å£0çš„ç›´è¿ç½‘ç»œçš„è·¯ç”±æ¡ç›®ï¼Œé’ˆå¯¹è¯¥ç½‘ç»œçš„é»‘æ´ç½‘ç»œä¼š<strong>è‡ªåŠ¨å¤±æ•ˆ</strong></p></li><li><p>å¦‚æœåˆæ•…éšœï¼Œåˆ™<strong>ç”Ÿæ•ˆ</strong>è¯¥ç½‘ç»œçš„é»‘æ´ç½‘ç»œ</p></li></ul><h2 id="è·¯ç”±é€‰æ‹©åè®®"><a href="#è·¯ç”±é€‰æ‹©åè®®" class="headerlink" title="è·¯ç”±é€‰æ‹©åè®®"></a>è·¯ç”±é€‰æ‹©åè®®</h2><h3 id="æ¦‚è¿°-2"><a href="#æ¦‚è¿°-2" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p><strong>ä¸¤ç±»è·¯ç”±é€‰æ‹©ï¼š</strong></p><ol><li><p>é™æ€è·¯ç”±é€‰æ‹©</p><ul><li>ç”±<mark>äººå·¥é…ç½®</mark>çš„ç½‘ç»œè·¯ç”±ã€é»˜è®¤è·¯ç”±ã€ç‰¹å®šä¸»æœºè·¯ç”±ï¼Œé»‘æ´è·¯ç”±ç­‰éƒ½å±äºé™æ€è·¯ç”±ï¼›</li><li>è¿™ç§äººå·¥é…ç½®æ–¹å¼ç®€å•ã€å¼€é”€å°ï¼Œä½†<mark>ä¸èƒ½åŠæ—¶é€‚åº”ç½‘ç»œçŠ¶æ€ (æµé‡ã€æ‹“æ‰‘ç­‰)çš„å˜åŒ–</mark>ï¼›</li><li>ä¸€èˆ¬åªåœ¨<mark>å°è§„æ¨¡ç½‘ç»œ</mark>ä¸­é‡‡ç”¨ã€‚</li></ul></li><li><p>åŠ¨æ€è·¯ç”±é€‰æ‹©</p><ul><li>è·¯ç”±å™¨é€šè¿‡è·¯ç”±é€‰æ‹©åè®®<mark>è‡ªåŠ¨è·å–è·¯ç”±ä¿¡æ¯</mark></li><li>æ¯”è¾ƒå¤æ‚ã€å¼€é”€æ¯”è¾ƒå¤§ã€‚<mark>èƒ½è¾ƒå¥½åœ°é€‚åº”ç½‘ç»œçŠ¶æ€çš„å˜åŒ–</mark></li><li>é€‚ç”¨äº<mark>å¤§è§„æ¨¡ç½‘ç»œ</mark></li></ul></li></ol><p><strong>å› ç‰¹ç½‘æ‰€é‡‡ç”¨çš„è·¯ç”±é€‰æ‹©åè®®çš„ä¸»è¦ç‰¹ç‚¹ï¼š</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201019134946971.png" alt="image-20201019134946971"></p><p><strong>å› ç‰¹ç½‘é‡‡ç”¨åˆ†å±‚æ¬¡çš„è·¯ç”±é€‰æ‹©åè®®ï¼š</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201019135122326.png" alt="image-20201019135122326"></p><blockquote><p>è‡ªæ²»ç³»ç»Ÿä¹‹é—´çš„è·¯ç”±é€‰æ‹©ç®€ç§°ä¸º<mark>åŸŸé—´è·¯ç”±é€‰æ‹©</mark>ï¼Œè‡ªæ²»ç³»ç»Ÿå†…éƒ¨çš„è·¯ç”±é€‰æ‹©ç®€ç§°ä¸º<mark>åŸŸå†…è·¯ç”±é€‰æ‹©</mark></p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201019135328925.png" alt="image-20201019135328925"></p><blockquote><p>åŸŸé—´è·¯ç”±é€‰æ‹©ä½¿ç”¨å¤–éƒ¨ç½‘å…³åè®®EGPè¿™ä¸ªç±»åˆ«çš„è·¯ç”±é€‰æ‹©åè®®</p><p>åŸŸå†…è·¯ç”±é€‰æ‹©ä½¿ç”¨å†…éƒ¨ç½‘å…³åè®®IGPè¿™ä¸ªç±»åˆ«çš„è·¯ç”±é€‰æ‹©åè®®</p><p><strong>ç½‘å…³åè®®</strong>çš„åç§°å¯ç§°ä¸º<strong>è·¯ç”±åè®®</strong></p></blockquote><p><strong>å¸¸è§çš„è·¯ç”±é€‰æ‹©åè®®ï¼š</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201019140009740.png" alt="image-20201019140009740"></p><p><strong>è·¯ç”±å™¨çš„åŸºæœ¬ç»“æ„ï¼š</strong></p><p>è·¯ç”±å™¨æ˜¯ä¸€ç§å…·æœ‰å¤šä¸ªè¾“å…¥ç«¯å£ï¼Œå’Œè¾“å‡ºç«¯å£çš„ä¸“ç”¨è®¡ç®—æœºï¼Œå…¶ä»»åŠ¡æ˜¯è½¬å‘åˆ†ç»„</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201019140234652.png" alt="image-20201019140234652"></p><ul><li><p>è·¯ç”±é€‰æ‹©å¤„ç†æœºé™¤äº†å¤„ç†æ”¶åˆ°çš„è·¯ç”±æŠ¥æ–‡å¤–ï¼Œè¿˜ä¼š<strong>å‘¨æœŸæ€§çš„ç»™å…¶ä»–è·¯ç”±å™¨å‘é€è‡ªå·±æ‰€çŸ¥é“çš„è·¯ç”±ä¿¡æ¯</strong>ã€‚</p></li><li><p>è·¯ç”±å™¨çš„å„ç«¯å£è¿˜åº”å…·æœ‰<strong>è¾“å…¥ç¼“å†²åŒºå’Œè¾“å‡ºç¼“å†²åŒº</strong></p><ul><li>è¾“å…¥ç¼“å†²åŒºç”¨æ¥æš‚å­˜ï¼Œæ–°è¿›å…¥è·¯ç”±å™¨ï¼Œä½†è¿˜æ¥ä¸åŠå¤„ç†çš„åˆ†ç»„</li><li>è¾“å‡ºç¼“å†²åŒºç”¨æ¥æš‚å­˜ï¼Œå·²ç»å¤„ç†å®Œæ¯•ï¼Œä½†è¿˜æ¥ä¸åŠå‘é€çš„åˆ†ç»„</li></ul></li><li><p>éœ€è¦è¯´æ˜çš„æ˜¯<mark>è·¯ç”±å™¨çš„ç«¯å£ä¸€èˆ¬<strong>éƒ½</strong>å…·æœ‰è¾“å…¥å’Œè¾“å‡ºçš„åŠŸèƒ½</mark>ã€‚</p></li></ul><p>ğŸŒˆ<strong>è¡¥å……ï¼šï¼ˆå…³äºè·¯ç”±è¡¨å’Œè½¬å‘è¡¨ï¼‰</strong></p><blockquote><ul><li>è·¯ç”±è¡¨ä¸€èˆ¬ä»…åŒ…å«ä»ç›®çš„ç½‘ç»œåˆ°ä¸‹ä¸€è·³çš„æ˜ </li><li>è·¯ç”±è¡¨éœ€è¦å¯¹ç½‘ç»œæ‹“æ‰‘å˜åŒ–çš„è®¡ç®—æœ€ä¼˜åŒ–</li><li><strong>è½¬å‘è¡¨æ˜¯ä»è·¯ç”±è¡¨å¾—å‡ºçš„</strong></li><li>è½¬å‘è¡¨çš„ç»“æ„åº”å½“ä½¿æŸ¥æ‰¾è¿‡ç¨‹æœ€ä¼˜åŒ–</li><li>æœ¬æ–‡ä¸å¯¹è·¯ç”±è¡¨å’Œè½¬å‘è¡¨åšè¯¦ç»†çš„åŒºåˆ†</li></ul></blockquote><h3 id="è·¯ç”±ä¿¡æ¯åè®®RIP"><a href="#è·¯ç”±ä¿¡æ¯åè®®RIP" class="headerlink" title="è·¯ç”±ä¿¡æ¯åè®®RIP"></a>è·¯ç”±ä¿¡æ¯åè®®RIP</h3><h4 id="åŸºæœ¬æ¦‚å¿µ-7"><a href="#åŸºæœ¬æ¦‚å¿µ-7" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h4><ul><li>RIPä½¿ç”¨<mark>è·³æ•°</mark>(Hop Count)ä½œä¸ºåº¦é‡(Metric)æ¥<mark>è¡¡é‡åˆ°è¾¾ç›®çš„ç½‘ç»œçš„è·ç¦»</mark>ã€‚<ul><li>è·¯ç”±å™¨åˆ°ç›´è¿ç½‘ç»œçš„è·ç¦»å®šä¹‰ä¸º1ã€‚</li><li>è·¯ç”±å™¨åˆ°éç›´è¿ç½‘ç»œçš„è·ç¦»å®šä¹‰ä¸ºæ‰€ç»è¿‡çš„è·¯ç”±å™¨æ•°åŠ 1</li><li>å…è®¸ä¸€æ¡è·¯å¾„æœ€å¤šåªèƒ½åŒ…å«15ä¸ªè·¯ç”±å™¨ã€‚<mark>â€œè·ç¦»â€ç­‰äº16æ—¶ç›¸å½“äºä¸å¯è¾¾</mark>ï¼Œå› æ­¤ï¼ŒRIPåªé€‚ç”¨äº<mark>å°å‹äº’è”ç½‘</mark></li></ul></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231125180054408.png" alt="image-20231125180054408"></p><ul><li>RIPè®¤ä¸º<mark>å¥½çš„è·¯ç”±</mark>å°±æ˜¯â€œè·ç¦»çŸ­â€çš„è·¯ç”±ï¼Œä¹Ÿå°±æ˜¯<mark>æ‰€é€šè¿‡è·¯ç”±å™¨æ•°é‡æœ€å°‘çš„è·¯ç”±</mark></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231125180146423.png" alt="image-20231125180146423"></p><ul><li>å½“åˆ°è¾¾åŒä¸€ç›®çš„ç½‘ç»œæœ‰å¤šæ¡â€œè·ç¦»ç›¸ç­‰â€çš„è·¯ç”±æ—¶ï¼Œå¯ä»¥è¿›è¡Œ<mark>ç­‰ä»·è´Ÿè½½å‡è¡¡</mark></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231125180243578.png" alt="image-20231125180243578"></p><p>RIPåŒ…å«ä»¥ä¸‹ä¸‰ä¸ªè¦ç‚¹:</p><ol><li>å’Œè°äº¤æ¢ä¿¡æ¯ï¼šä»…å’Œç›¸é‚»è·¯ç”±å™¨äº¤æ¢ä¿¡æ¯</li><li>äº¤æ¢ä»€ä¹ˆä¿¡æ¯ï¼šè‡ªå·±çš„è·¯ç”±è¡¨</li><li>ä½•æ—¶äº¤æ¢ä¿¡æ¯ï¼šå‘¨æœŸæ€§äº¤æ¢(ä¾‹å¦‚æ¯30ç§’)</li></ol><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231125180409226.png" alt="image-20231125180409226"></p><h4 id="RIPçš„åŸºæœ¬å·¥ä½œè¿‡ç¨‹"><a href="#RIPçš„åŸºæœ¬å·¥ä½œè¿‡ç¨‹" class="headerlink" title="RIPçš„åŸºæœ¬å·¥ä½œè¿‡ç¨‹"></a>RIPçš„åŸºæœ¬å·¥ä½œè¿‡ç¨‹</h4><ol><li>è·¯ç”±å™¨åˆšå¼€å§‹å·¥ä½œæ—¶ï¼Œ<strong>åªçŸ¥é“è‡ªå·±åˆ°ç›´è¿ç½‘ç»œçš„è·ç¦»ä¸º1</strong></li><li>æ¯ä¸ªè·¯ç”±å™¨ä»…<strong>å’Œ<mark>ç›¸é‚»è·¯ç”±å™¨å‘¨æœŸæ€§</mark>åœ°äº¤æ¢å¹¶æ›´æ–°è·¯ç”±ä¿¡æ¯</strong></li><li>è‹¥å¹²æ¬¡äº¤æ¢å’Œæ›´æ–°åï¼Œ<strong>æ¯ä¸ªè·¯ç”±å™¨éƒ½çŸ¥é“åˆ°è¾¾æœ¬ASå†…å„ç½‘ç»œçš„æœ€çŸ­è·ç¦»å’Œä¸‹ä¸€è·³åœ°å€</strong>ï¼Œç§°ä¸º<mark>æ”¶æ•›</mark>ã€‚</li></ol><h4 id="RIPçš„è·¯ç”±æ¡ç›®çš„æ›´æ–°è§„åˆ™"><a href="#RIPçš„è·¯ç”±æ¡ç›®çš„æ›´æ–°è§„åˆ™" class="headerlink" title="RIPçš„è·¯ç”±æ¡ç›®çš„æ›´æ–°è§„åˆ™"></a>RIPçš„è·¯ç”±æ¡ç›®çš„æ›´æ–°è§„åˆ™</h4><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201019150412666-17009068811776.png" alt="image-20201019150412666"></p><p><strong>â­â­é‡ç‚¹ï¼š</strong></p><ul><li>åˆ°è¾¾ç›®çš„ç½‘ç»œï¼Œç›¸åŒä¸‹ä¸€è·³ï¼Œæœ€æ–°æ¶ˆæ¯ï¼Œæ›´æ–°</li><li>å‘ç°äº†æ–°çš„ç½‘ç»œï¼Œæ·»åŠ </li><li>åˆ°è¾¾ç›®çš„ç½‘ç»œï¼Œä¸åŒä¸‹ä¸€è·³ï¼Œæ–°è·¯ç”±ä¼˜åŠ¿ï¼Œæ›´æ–°</li><li>åˆ°è¾¾ç›®çš„ç½‘ç»œï¼Œä¸åŒä¸‹ä¸€è·³ï¼Œç­‰ä»·è´Ÿè½½å‡è¡¡</li><li>åˆ°è¾¾ç›®çš„ç½‘ç»œï¼Œä¸åŒä¸‹ä¸€è·³ï¼Œæ–°è·¯ç”±åŠ£åŠ¿ï¼Œä¸æ›´æ–°</li></ul><h4 id="è·¯ç”±ç¯è·¯é—®é¢˜"><a href="#è·¯ç”±ç¯è·¯é—®é¢˜" class="headerlink" title="è·¯ç”±ç¯è·¯é—®é¢˜"></a>è·¯ç”±ç¯è·¯é—®é¢˜</h4><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201019151332767.png" alt="image-20201019151332767"></p><p>è§£å†³åŠæ³•ï¼š</p><ol><li>é™åˆ¶æœ€å¤§è·¯å¾„è·ç¦»ä¸º15(16è¡¨ç¤ºä¸å¯è¾¾)</li><li>å½“è·¯ç”±è¡¨å‘ç”Ÿå˜åŒ–æ—¶å°±ç«‹å³å‘é€æ›´æ–°æŠ¥æ–‡ (å³â€œè§¦å‘æ›´æ–°â€)ï¼Œè€Œä¸ä»…æ˜¯å‘¨æœŸæ€§å‘é€</li><li>è®©è·¯ç”±å™¨è®°å½•æ”¶åˆ°æŸç‰¹å®šè·¯ç”±ä¿¡æ¯çš„æ¥å£ï¼Œè€Œä¸è®©åŒä¸€è·¯ç”±ä¿¡æ¯å†é€šè¿‡æ­¤æ¥å£å‘åæ–¹å‘ä¼ é€ (å³â€œæ°´å¹³åˆ†å‰²â€</li></ol><blockquote><p>ä½†æ˜¯ï¼Œè¿™äº›æ–¹æ³•ä¹Ÿä¸èƒ½å®Œå…¨è§£å†³â€œåæ¶ˆæ¯ä¼ æ’­å¾—æ…¢â€çš„é—®é¢˜ï¼Œè¿™æ˜¯è·ç¦»å‘é‡çš„æœ¬è´¨å†³å®š</p></blockquote><h4 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h4><p>ä¼˜ç‚¹ï¼š</p><ol><li>å®ç°ç®€å•ï¼Œå¼€é”€è¾ƒå°ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li><p>RIP é™åˆ¶äº†ç½‘ç»œçš„è§„æ¨¡ï¼Œå®ƒèƒ½ä½¿ç”¨çš„æœ€å¤§è·ç¦»ä¸º 15ï¼ˆ16 è¡¨ç¤ºä¸å¯è¾¾ï¼‰ã€‚</p></li><li><p>è·¯ç”±å™¨ä¹‹é—´äº¤æ¢çš„è·¯ç”±ä¿¡æ¯æ˜¯è·¯ç”±å™¨ä¸­çš„å®Œæ•´è·¯ç”±è¡¨ï¼Œå› è€Œéšç€ç½‘ç»œè§„æ¨¡çš„æ‰©å¤§ï¼Œå¼€é”€ä¹Ÿå°±å¢åŠ ã€‚</p></li><li><p>â€œåæ¶ˆæ¯ä¼ æ’­å¾—æ…¢â€ï¼Œä½¿æ›´æ–°è¿‡ç¨‹çš„æ”¶æ•›æ—¶é—´è¿‡é•¿ã€‚</p></li></ol><h4 id="ä¾‹é¢˜-2"><a href="#ä¾‹é¢˜-2" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h4><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231125181829111.png" alt="image-20231125181829111"></p><blockquote><p>æœ¬é¢˜ä¸­R3å…ˆé€šå‘Šå®ŒR2åï¼ŒR2è¿›è¡Œäº†ä¿®æ”¹ä¸º16ï¼Œä½†æ˜¯ç­‰R1å®šæ—¶å‘é€å‘¨æœŸæŠ¥æ–‡åï¼Œå› ä¸ºR3æ²¡æœ‰å‘é€ç»™R1ï¼Œæ‰€ä»¥R1è®¤ä¸ºå¯ä»¥é€šè¿‡R3è®¿é—®ç½‘ç»œï¼Œç„¶åR1ç»™R2å‘é€æŠ¥æ–‡åï¼Œå› ä¸º<strong>åˆ°è¾¾ç›®çš„ç½‘ç»œï¼Œä¸åŒä¸‹ä¸€è·³ï¼Œæ–°è·¯ç”±ä¼˜åŠ¿ï¼Œæ›´æ–°</strong>çš„åŸåˆ™ï¼Œé‚£ä¹ˆR2å°±ä¼šè®¤ä¸ºå¯ä»¥ä»R1å»è®¿é—®åˆ°è¯¥ç½‘ç»œï¼ŒåˆR1åˆ°è¯¥ç½‘ç»œçš„è·ç¦»ä¸º2ï¼Œåˆ™R2åˆ°è¯¥ç½‘ç»œçš„è·ç¦»ä¸º2+1&#x3D;3</p></blockquote><h3 id="å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆOSPF"><a href="#å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆOSPF" class="headerlink" title="å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆOSPF"></a>å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆOSPF</h3><blockquote><p><strong>æ³¨æ„</strong>ï¼šOSPF åªæ˜¯ä¸€ä¸ªåè®®çš„åå­—ï¼Œå®ƒå¹¶ä¸è¡¨ç¤ºå…¶ä»–çš„è·¯ç”±é€‰æ‹©åè®®ä¸æ˜¯â€œæœ€çŸ­è·¯å¾„ä¼˜å…ˆâ€ã€‚</p></blockquote><h4 id="æ¦‚å¿µ-1"><a href="#æ¦‚å¿µ-1" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><ul><li>â€œæœ€çŸ­è·¯å¾„ä¼˜å…ˆâ€æ˜¯å› ä¸ºä½¿ç”¨äº†Dijkstraæå‡ºçš„<mark>æœ€çŸ­è·¯å¾„ç®—æ³•</mark>SPFã€‚</li><li>OSPFæ˜¯<mark>åŸºäºé“¾è·¯çŠ¶æ€</mark>çš„ï¼Œè€Œä¸åƒRIPé‚£æ ·æ˜¯åŸºäºè·ç¦»å‘é‡çš„ã€‚</li><li>OSPFé‡‡ç”¨SPFç®—æ³•è®¡ç®—è·¯ç”±ï¼Œä»ç®—æ³•ä¸Šä¿è¯äº†<mark>ä¸ä¼šäº§ç”Ÿè·¯ç”±ç¯è·¯</mark></li><li>OSPF<strong>ä¸é™åˆ¶ç½‘ç»œè§„æ¨¡</strong>ï¼Œæ›´æ–°æ•ˆç‡é«˜ï¼Œ<mark>æ”¶æ•›é€Ÿåº¦å¿«</mark></li><li>é“¾è·¯çŠ¶æ€æ˜¯æŒ‡æœ¬è·¯ç”±å™¨éƒ½<strong>å’Œå“ªäº›è·¯ç”±å™¨ç›¸é‚»</strong>ï¼Œä»¥åŠç›¸åº”<strong>é“¾è·¯çš„â€œä»£ä»·â€</strong>(cost)<ul><li>â€œä»£ä»·â€ç”¨æ¥è¡¨ç¤ºè´¹ç”¨ã€è·ç¦»ã€æ—¶å»¶ã€å¸¦å®½ï¼Œç­‰ç­‰ã€‚è¿™äº›éƒ½ç”±ç½‘ç»œç®¡ç†äººå‘˜æ¥å†³å®š</li></ul></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231125211510009.png" alt="image-20231125211510009"></p><h4 id="é—®å€™ï¼ˆHelloï¼‰åˆ†ç»„"><a href="#é—®å€™ï¼ˆHelloï¼‰åˆ†ç»„" class="headerlink" title="é—®å€™ï¼ˆHelloï¼‰åˆ†ç»„"></a>é—®å€™ï¼ˆHelloï¼‰åˆ†ç»„</h4><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201019161653875.png" alt="image-20201019161653875"></p><blockquote><p>IPæ•°æ®æŠ¥é¦–éƒ¨ä¸­åè®®å·å­—æ®µçš„å–å€¼åº”ä¸º89ï¼Œæ¥è¡¨æ˜IPæ•°æ®æŠ¥çš„æ•°æ®è½½è·ä¸ºOSPFåˆ†ç»„</p></blockquote><h4 id="å‘é€é“¾è·¯çŠ¶æ€é€šå‘ŠLSA"><a href="#å‘é€é“¾è·¯çŠ¶æ€é€šå‘ŠLSA" class="headerlink" title="å‘é€é“¾è·¯çŠ¶æ€é€šå‘ŠLSA"></a>å‘é€é“¾è·¯çŠ¶æ€é€šå‘ŠLSA</h4><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201019162341151.png" alt="image-20201019162341151"></p><blockquote><p>æ´ªæ³›æ³•æœ‰ç‚¹<strong>ç±»ä¼¼äºå¹¿æ’­</strong>ï¼Œå°±æ˜¯ä»ä¸€ä¸ªæ¥å£è¿›æ¥ï¼Œä»å…¶ä»–å‰©ä½™æ‰€æœ‰æ¥å£å‡ºå»</p></blockquote><h4 id="é“¾è·¯çŠ¶æ€æ•°æ®åº“åŒæ­¥"><a href="#é“¾è·¯çŠ¶æ€æ•°æ®åº“åŒæ­¥" class="headerlink" title="é“¾è·¯çŠ¶æ€æ•°æ®åº“åŒæ­¥"></a>é“¾è·¯çŠ¶æ€æ•°æ®åº“åŒæ­¥</h4><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201019162933483.png" alt="image-20201019162933483"></p><p><strong>ä½¿ç”¨<mark>SPFç®—æ³•</mark>è®¡ç®—å‡ºå„è‡ªè·¯ç”±å™¨åˆ°è¾¾å…¶ä»–è·¯ç”±å™¨çš„æœ€çŸ­è·¯å¾„</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201019163148068.png" alt="image-20201019163148068"></p><h4 id="OSPFäº”ç§åˆ†ç»„ç±»å‹"><a href="#OSPFäº”ç§åˆ†ç»„ç±»å‹" class="headerlink" title="OSPFäº”ç§åˆ†ç»„ç±»å‹"></a>OSPFäº”ç§åˆ†ç»„ç±»å‹</h4><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201019163250129.png" alt="image-20201019163250129"></p><h4 id="OSPFçš„åŸºæœ¬å·¥ä½œè¿‡ç¨‹"><a href="#OSPFçš„åŸºæœ¬å·¥ä½œè¿‡ç¨‹" class="headerlink" title="OSPFçš„åŸºæœ¬å·¥ä½œè¿‡ç¨‹"></a>OSPFçš„åŸºæœ¬å·¥ä½œè¿‡ç¨‹</h4><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201019163746254.png" alt="image-20201019163746254"></p><h4 id="é‚»å±…å…³ç³»"><a href="#é‚»å±…å…³ç³»" class="headerlink" title="é‚»å±…å…³ç³»"></a>é‚»å±…å…³ç³»</h4><p><strong>OSPFåœ¨å¤šç‚¹æ¥å…¥ç½‘ç»œä¸­çš„è·¯ç”±å™¨é‚»å±…å…³ç³»å»ºç«‹</strong></p><p>å¦‚æœä¸é‡‡ç”¨å…¶ä»–æœºåˆ¶ï¼Œå°†ä¼šäº§ç”Ÿå¤§é‡çš„å¤šæ’­åˆ†ç»„</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201019164657606.png" alt="image-20201019164657606"></p><blockquote><p>è‹¥DRå‡ºç°é—®é¢˜ï¼Œåˆ™ç”±BDRé¡¶æ›¿DR</p></blockquote><h4 id="åŒºåŸŸ"><a href="#åŒºåŸŸ" class="headerlink" title="åŒºåŸŸ"></a>åŒºåŸŸ</h4><p><strong>ä¸ºäº†ä½¿OSPFèƒ½å¤Ÿç”¨äºè§„æ¨¡å¾ˆå¤§çš„ç½‘ç»œï¼ŒOSPFæŠŠä¸€ä¸ªè‡ªæ²»ç³»ç»Ÿå†åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªæ›´å°çš„èŒƒå›´ï¼Œå«åšåŒºåŸŸï¼ˆAreaï¼‰</strong></p><ul><li><p>åœ¨è¯¥è‡ªæ²»ç³»ç»Ÿå†…ï¼Œæ‰€æœ‰è·¯ç”±å™¨éƒ½ä½¿ç”¨OSPFåè®®ï¼ŒOSPFå°†è¯¥è‡ªæ²»ç³»ç»Ÿå†åˆ’åˆ†æˆ4ä¸ªæ›´å°çš„åŒºåŸŸ</p></li><li><p>æ¯ä¸ªåŒºåŸŸéƒ½æœ‰ä¸€ä¸ª32æ¯”ç‰¹çš„åŒºåŸŸæ ‡è¯†ç¬¦</p></li><li><p>ä¸»å¹²åŒºåŸŸçš„åŒºåŸŸæ ‡è¯†ç¬¦å¿…é¡»ä¸º0ï¼Œä¸»å¹²åŒºåŸŸç”¨äºè¿é€šå…¶ä»–åŒºåŸŸ</p></li><li><p>å…¶ä»–åŒºåŸŸçš„åŒºåŸŸæ ‡è¯†ç¬¦ä¸èƒ½ä¸º0ä¸”ä¸ç›¸åŒ</p></li><li><p>æ¯ä¸ªåŒºåŸŸä¸€èˆ¬ä¸åº”åŒ…å«è·¯ç”±å™¨è¶…è¿‡200ä¸ª</p></li><li><p>åˆ’åˆ†åŒºåŸŸçš„å¥½å¤„å°±æ˜¯ï¼Œåˆ©ç”¨æ´ªæ³›æ³•äº¤æ¢é“¾è·¯çŠ¶æ€ä¿¡æ¯å±€é™äºæ¯ä¸€ä¸ªåŒºåŸŸè€Œä¸æ˜¯è‡ªæ²»ç³»ç»Ÿï¼Œè¿™æ ·å‡å°‘æ•´ä¸ªç½‘ç»œä¸Šçš„é€šä¿¡é‡</p></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201019170100568.png" alt="image-20201019170100568"></p><h3 id="è¾¹ç•Œç½‘å…³åè®®BGP"><a href="#è¾¹ç•Œç½‘å…³åè®®BGP" class="headerlink" title="è¾¹ç•Œç½‘å…³åè®®BGP"></a>è¾¹ç•Œç½‘å…³åè®®BGP</h3><p>BGPï¼ˆBorder Gateway Protocolï¼‰ æ˜¯<mark><strong>ä¸åŒè‡ªæ²»ç³»ç»Ÿçš„è·¯ç”±å™¨ä¹‹é—´</strong>äº¤æ¢è·¯ç”±ä¿¡æ¯çš„åè®®</mark></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201019191438399.png" alt="image-20201019191438399"></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201019191718506.png" alt="image-20201019191718506"></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201019191836397.png" alt="image-20201019191836397"></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201019192031087.png" alt="image-20201019192031087"></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201019192059962.png" alt="image-20201019192059962"></p><p><strong>ä¾‹é¢˜ï¼š</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231125213234464.png" alt="image-20231125213234464"></p><h2 id="IPv4æ•°æ®æŠ¥çš„é¦–éƒ¨æ ¼å¼â­â­"><a href="#IPv4æ•°æ®æŠ¥çš„é¦–éƒ¨æ ¼å¼â­â­" class="headerlink" title="IPv4æ•°æ®æŠ¥çš„é¦–éƒ¨æ ¼å¼â­â­"></a>IPv4æ•°æ®æŠ¥çš„é¦–éƒ¨æ ¼å¼â­â­</h2><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.4qv9clittsi0.webp" alt="image"></p><p><strong>1.é¦–éƒ¨é•¿åº¦</strong></p><blockquote><p><strong>å 4æ¯”ç‰¹ï¼Œè¡¨ç¤ºIPæ•°æ®æŠ¥é¦–éƒ¨çš„é•¿åº¦</strong>ã€‚è¯¥å­—æ®µçš„å–å€¼ä»¥<code>4å­—èŠ‚</code>ä¸ºå•ä½ã€‚æœ€å°åè¿›åˆ¶å–å€¼ä¸º5ï¼Œè¡¨ç¤ºIPæ•°æ®æŠ¥é¦–éƒ¨åªæœ‰20å­—èŠ‚å›ºå®šéƒ¨åˆ†;æœ€å¤§åè¿›åˆ¶å–å€¼ä¸º15ï¼Œè¡¨ç¤ºIPæ•°æ®æŠ¥é¦–éƒ¨åŒ…å«20å­—èŠ‚å›ºå®šéƒ¨åˆ†å’Œæœ€å¤§40å­—èŠ‚å¯å˜éƒ¨åˆ†ã€‚</p></blockquote><p><strong>2.å¯é€‰å­—æ®µ</strong></p><blockquote><p><strong>é•¿åº¦ä»1ä¸ªå­—èŠ‚åˆ°40ä¸ªå­—èŠ‚ä¸ç­‰</strong>ã€‚<code>ç”¨æ¥æ”¯æŒæ’é”™ã€æµ‹é‡åŠå®‰å…¨ç­‰æªæ–½</code>ã€‚å¯é€‰å­—æ®µå¢åŠ äº†IPæ•°æ®æŠ¥çš„åŠŸèƒ½,ä½†è¿™åŒæ—¶ä¹Ÿä½¿å¾—IPæ•°æ®æŠ¥çš„é¦–éƒ¨é•¿åº¦æˆä¸ºå¯å˜çš„ã€‚è¿™å°±å¢åŠ äº†æ¯ä¸€ä¸ªè·¯ç”±å™¨å¤„ç†IPæ•°æ®æŠ¥çš„å¼€é”€ã€‚å®é™…ä¸Šå¯é€‰å­—æ®µå¾ˆå°‘è¢«ä½¿ç”¨ã€‚</p></blockquote><p><strong>3.å¡«å……å­—æ®µ</strong></p><blockquote><p><strong>ç¡®ä¿é¦–éƒ¨é•¿åº¦ä¸º4å­—èŠ‚çš„æ•´æ•°å€</strong>ã€‚ä½¿ç”¨<code>å…¨0</code>è¿›è¡Œå¡«å……ã€‚</p></blockquote><p><strong>4.åŒºåˆ†æœåŠ¡</strong></p><blockquote><p><strong>å 8æ¯”ç‰¹ï¼Œç”¨æ¥è·å¾—æ›´å¥½çš„æœåŠ¡ã€‚</strong></p></blockquote><p><strong>5.æ€»é•¿åº¦</strong></p><blockquote><p><strong>å 16æ¯”ç‰¹</strong>ï¼Œè¡¨ç¤º<code>IPæ•°æ®æŠ¥çš„æ€»é•¿åº¦</code>(é¦–éƒ¨+æ•°æ®è½½è·)ã€‚</p><p>æœ€å¤§å–å€¼ä¸ºåè¿›åˆ¶çš„65535ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚</p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.ptm56r0ehn4.webp" alt="image"></p><p><strong>6.æ ‡è¯†</strong></p><blockquote><p><strong>å 16æ¯”ç‰¹</strong>ï¼Œå±äºåŒä¸€ä¸ªæ•°æ®æŠ¥çš„å„åˆ†ç‰‡æ•°æ®æŠ¥åº”è¯¥å…·æœ‰ç›¸åŒçš„æ ‡è¯†ã€‚</p><p>IPè½¯ä»¶ç»´æŒä¸€ä¸ªè®¡æ•°å™¨ï¼Œæ¯äº§ç”Ÿä¸€ä¸ªæ•°æ®æŠ¥ï¼Œè®¡æ•°å™¨å€¼åŠ 1ï¼Œå¹¶å°†æ­¤å€¼èµ‹ç»™æ ‡è¯†å­—æ®µã€‚</p></blockquote><p><strong>7.æ ‡å¿—</strong></p><blockquote><p><strong>å 3æ¯”ç‰¹</strong>ï¼Œ<code>å„æ¯”ç‰¹å«ä¹‰å¦‚ä¸‹</code>ï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.1xqgdajia7c0.webp" alt="image"></p></blockquote><p><strong>8.ç‰‡åç§»</strong></p><blockquote><p><strong>å 13æ¯”ç‰¹</strong>ï¼ŒæŒ‡å‡ºåˆ†ç‰‡æ•°æ®æŠ¥çš„<code>æ•°æ®è½½è·éƒ¨åˆ†åç§»</code>å…¶åœ¨åŸæ•°æ®æŠ¥çš„ä½ç½®<strong>æœ‰å¤šå°‘ä¸ªå•ä½</strong>ã€‚</p><p>ç‰‡åç§»ä»¥8ä¸ªå­—èŠ‚ä¸ºå•ä½ã€‚</p></blockquote><p><strong>9.ç”Ÿå­˜æ—¶é—´TTL</strong></p><blockquote><p><strong>å 8æ¯”ç‰¹</strong>ï¼Œæœ€åˆ<code>ä»¥ç§’ä¸ºå•ä½</code>ï¼Œ<strong>æœ€å¤§ç”Ÿå­˜å‘¨æœŸ</strong>ä¸º<code>255ç§’</code>ï¼›</p></blockquote><p><strong>10.åè®®</strong></p><blockquote><p><strong>å 8æ¯”ç‰¹</strong>ï¼ŒæŒ‡æ˜IPv4æ•°æ®æŠ¥çš„æ•°æ®éƒ¨åˆ†æ˜¯<code>ä½•ç§åè®®æ•°æ®å•å…ƒ</code>ã€‚</p><p>å¸¸ç”¨çš„ä¸€äº›åè®®å’Œç›¸åº”çš„åè®®å­—æ®µå€¼å¦‚ä¸‹ã€‚</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.3rs9fh0g6xm0.webp" alt="image"></p></blockquote><p><strong>11.é¦–éƒ¨æ£€éªŒå’Œ</strong></p><blockquote><p><strong>å 16æ¯”ç‰¹</strong>ï¼Œç”¨æ¥<code>æ£€æµ‹é¦–éƒ¨</code>åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦å‡ºç°å·®é”™ã€‚æ¯”CRCæ£€éªŒç ç®€å•ï¼Œç§°ä¸º<strong>å› ç‰¹ç½‘æ£€éªŒå’Œ</strong>ã€‚</p></blockquote><p><strong>12.æºIPåœ°å€å’Œç›®çš„IPåœ°å€</strong></p><blockquote><p><strong>å„å 32æ¯”ç‰¹</strong>ï¼Œç”¨æ¥å¡«å†™å‘é€è¯¥IPæ•°æ®æŠ¥çš„æºä¸»æœºçš„IPåœ°å€å’Œæ¥æ”¶è¯¥IPæ•°æ®æŠ¥çš„ç›®çš„ä¸»æœºçš„IPåœ°å€ã€‚</p></blockquote><p>â­â­â­â­â­<strong>ä¾‹é¢˜ï¼š</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231125222036580.png" alt="image-20231125222036580"></p><hr><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231125223015654.png" alt="image-20231125223015654"></p><p>ç¬¬äºŒå°é—®ï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231125223134911.png" alt="image-20231125223134911"></p><p>ç¬¬å››å°é—®ï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231125223211334.png" alt="image-20231125223211334"></p><h2 id="ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®ICMP"><a href="#ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®ICMP" class="headerlink" title="ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®ICMP"></a>ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®ICMP</h2><h3 id="ICMPçš„ä½œç”¨"><a href="#ICMPçš„ä½œç”¨" class="headerlink" title="ICMPçš„ä½œç”¨"></a>ICMPçš„ä½œç”¨</h3><ul><li><mark>ä¸ºäº†æ›´æœ‰æ•ˆåœ°è½¬å‘IPæ•°æ®æŠ¥å’Œæé«˜äº¤ä»˜æˆåŠŸçš„æœºä¼š</mark>ï¼Œåœ¨ç½‘é™…å±‚ä½¿ç”¨äº†<strong>ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®ICMPã€‚</strong></li><li>ä¸»æœºæˆ–è·¯ç”±å™¨ä½¿ç”¨ICMPæ¥å‘é€å·®é”™æŠ¥å‘ŠæŠ¥æ–‡å’Œè¯¢é—®æŠ¥æ–‡ã€‚</li><li>ICMPæŠ¥æ–‡è¢«å°è£…åœ¨IPæ•°æ®æŠ¥ä¸­å‘é€ã€‚</li></ul><h3 id="ICMPå·®é”™æŠ¥å‘ŠæŠ¥æ–‡çš„ç§ç±»"><a href="#ICMPå·®é”™æŠ¥å‘ŠæŠ¥æ–‡çš„ç§ç±»" class="headerlink" title="ICMPå·®é”™æŠ¥å‘ŠæŠ¥æ–‡çš„ç§ç±»"></a>ICMPå·®é”™æŠ¥å‘ŠæŠ¥æ–‡çš„ç§ç±»</h3><ol><li>ç»ˆç‚¹ä¸å¯è¾¾</li></ol><ul><li><mark><strong>å½“è·¯ç”±å™¨æˆ–ä¸»æœºä¸èƒ½äº¤ä»˜æ•°æ®æŠ¥æ—¶ï¼Œå°±å‘æºç‚¹å‘é€ç»ˆç‚¹ä¸å¯è¾¾æŠ¥æ–‡ã€‚</strong></mark>å…·ä½“å¯å†æ ¹æ®ICMPçš„ä»£ç å­—æ®µç»†åˆ†ä¸ºç›®çš„ç½‘ç»œä¸å¯è¾¾ã€ç›®çš„ä¸»æœºä¸å¯è¾¾ã€ç›®çš„åè®®ä¸å¯è¾¾ã€ç›®çš„ç«¯å£ä¸å¯è¾¾ã€ç›®çš„ç½‘ç»œæœªçŸ¥ã€ç›®çš„ä¸»æœºæœªçŸ¥ç­‰13ç§é”™è¯¯ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231126152729662.png" alt="image-20231126152729662"></p><ol start="2"><li>æºç‚¹æŠ‘åˆ¶</li></ol><ul><li>å½“è·¯ç”±å™¨æˆ–ä¸»æœº<mark><strong>ç”±äºæ‹¥å¡è€Œä¸¢å¼ƒæ•°æ®æŠ¥æ—¶ï¼Œå°±å‘æºç‚¹å‘é€æºç‚¹æŠ‘åˆ¶æŠ¥æ–‡</strong></mark>ï¼Œä½¿æºç‚¹çŸ¥é“åº”å½“æŠŠæ•°æ®æŠ¥çš„å‘é€é€Ÿç‡æ”¾æ…¢ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231126152814243.png" alt="image-20231126152814243"></p><ol start="3"><li>æ—¶é—´è¶…è¿‡</li></ol><ul><li>å½“è·¯ç”±å™¨æ”¶åˆ°ä¸€ä¸ªç›®çš„IPåœ°å€ä¸æ˜¯è‡ªå·±çš„IPæ•°æ®æŠ¥ï¼Œä¼šå°†å…¶ç”Ÿå­˜æ—¶é—´TTLå­—æ®µçš„å€¼å‡1ã€‚</li><li>è‹¥ç»“æœä¸ä¸º0ï¼Œåˆ™å°†è¯¥IPæ•°æ®æŠ¥è½¬å‘å‡ºå»ï¼Œè‹¥ç»“æœä¸º0ï¼Œé™¤ä¸¢å¼ƒè¯¥IPæ•°æ®æŠ¥å¤–ï¼Œè¿˜è¦<mark><strong>å‘æºç‚¹å‘é€æ—¶é—´è¶…è¿‡æŠ¥æ–‡</strong></mark></li><li>å¦å¤–ï¼Œå½“<strong>ç»ˆç‚¹åœ¨é¢„å…ˆè§„å®šçš„æ—¶é—´å†…ä¸èƒ½æ”¶åˆ°ä¸€ä¸ªæ•°æ®æŠ¥çš„å…¨éƒ¨æ•°æ®æŠ¥ç‰‡æ—¶</strong>å°±æŠŠå·²æ”¶åˆ°çš„æ•°æ®æŠ¥ç‰‡<strong>éƒ½ä¸¢å¼ƒ</strong>ï¼Œä¹Ÿä¼šå‘æºç‚¹å‘é€æ—¶é—´è¶…è¿‡æŠ¥æ–‡ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231126152913751.png" alt="image-20231126152913751"></p><ol start="4"><li>å‚æ•°é—®é¢˜</li></ol><ul><li>å½“è·¯ç”±å™¨æˆ–ç›®çš„ä¸»æœºæ”¶åˆ°IPæ•°æ®æŠ¥åï¼Œæ ¹æ®å…¶<mark><strong>é¦–éƒ¨ä¸­çš„æ£€éªŒå’Œå­—æ®µ</strong></mark>å‘ç°é¦–éƒ¨åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å‡ºç°äº†<strong>è¯¯ç </strong>ï¼Œå°±ä¸¢å¼ƒè¯¥æ•°æ®æŠ¥ï¼Œå¹¶å‘æºç‚¹å‘é€å‚æ•°é—®é¢˜æŠ¥æ–‡ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20231126153116397.png" alt="image-20231126153116397"></p><ol start="5"><li>æ”¹å˜è·¯ç”±ï¼ˆé‡å®šå‘ï¼‰</li></ol><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.3nnaaiytnac0.webp" alt="image"></p><ul><li>ä»¥ä¸‹æƒ…å†µ<strong>ä¸åº”å‘é€ICMPå·®é”™æŠ¥å‘ŠæŠ¥æ–‡ï¼š</strong><ul><li>å¯¹ICMPå·®é”™æŠ¥å‘ŠæŠ¥æ–‡ä¸å†å‘é€ICMPå·®é”™æŠ¥å‘ŠæŠ¥æ–‡</li><li>å¯¹ç¬¬ä¸€ä¸ªåˆ†ç‰‡çš„æ•°æ®æŠ¥ç‰‡çš„æ‰€æœ‰åç»­æ•°æ®æŠ¥ç‰‡éƒ½ä¸å‘é€ICMPå·®é”™æŠ¥å‘ŠæŠ¥æ–‡</li><li>å¯¹å…·æœ‰å¤šæ’­åœ°å€çš„æ•°æ®æŠ¥éƒ½ä¸å‘é€ICMPå·®é”™æŠ¥å‘ŠæŠ¥æ–‡</li><li>å¯¹å…·æœ‰ç‰¹æ®Šåœ°å€(å¦‚127.0.0.0æˆ–0.0.0.0)çš„æ•°æ®æŠ¥ä¸å‘é€ICMPå·®é”™æŠ¥å‘ŠæŠ¥æ–‡</li></ul></li></ul><h3 id="å¸¸ç”¨çš„ICMPè¯¢é—®æŠ¥æ–‡"><a href="#å¸¸ç”¨çš„ICMPè¯¢é—®æŠ¥æ–‡" class="headerlink" title="å¸¸ç”¨çš„ICMPè¯¢é—®æŠ¥æ–‡"></a>å¸¸ç”¨çš„ICMPè¯¢é—®æŠ¥æ–‡</h3><ol><li><strong>å›é€è¯·æ±‚å’Œå›ç­”</strong><ul><li>ICMPå›é€è¯·æ±‚æŠ¥æ–‡æ˜¯ç”±ä¸»æœºæˆ–è·¯ç”±å™¨å‘ä¸€ä¸ªç‰¹å®šçš„ç›®çš„ä¸»æœºå‘å‡ºçš„è¯¢é—®ã€‚</li><li>æ”¶åˆ°æ­¤æŠ¥æ–‡çš„ä¸»æœºå¿…é¡»ç»™æºä¸»æœºæˆ–è·¯ç”±å™¨å‘é€ICMPå›é€å›ç­”æŠ¥æ–‡</li><li>è¿™ç§è¯¢é—®æŠ¥æ–‡ç”¨æ¥<mark><strong>æµ‹è¯•ç›®çš„ç«™æ˜¯å¦å¯è¾¾</strong></mark>åŠäº†è§£å…¶æœ‰å…³çŠ¶æ€</li></ul></li><li><strong>æ—¶é—´æˆ³è¯·æ±‚å’Œå›ç­”</strong><ul><li>ICMPæ—¶é—´æˆ³è¯·æ±‚æŠ¥æ–‡æ˜¯è¯·æŸä¸ªä¸»æœºæˆ–è·¯ç”±å™¨å›ç­”å½“å‰çš„æ—¥æœŸå’Œæ—¶é—´</li><li>åœ¨ICMPæ—¶é—´æˆ³å›ç­”æŠ¥æ–‡ä¸­æœ‰ä¸€ä¸ª32ä½çš„å­—æ®µï¼Œå…¶ä¸­å†™å…¥çš„æ•´æ•°ä»£è¡¨ä»</li><li>1900å¹´1æœˆ1æ—¥èµ·åˆ°å½“å‰æ—¶åˆ»ä¸€å…±æœ‰å¤šå°‘ç§’</li><li>è¿™ç§è¯¢é—®æŠ¥æ–‡<mark><strong>ç”¨æ¥è¿›è¡Œæ—¶é’ŸåŒæ­¥å’Œæµ‹é‡æ—¶é—´</strong></mark></li></ul></li></ol><h3 id="ICMPåº”ç”¨ä¸¾ä¾‹"><a href="#ICMPåº”ç”¨ä¸¾ä¾‹" class="headerlink" title="ICMPåº”ç”¨ä¸¾ä¾‹"></a>ICMPåº”ç”¨ä¸¾ä¾‹</h3><ol><li>åˆ†ç»„ç½‘é—´æ¢æµ‹PING</li></ol><p><strong>ç”¨æ¥æµ‹è¯•ä¸»æœºæˆ–è·¯ç”±å™¨é—´çš„è¿é€šæ€§</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.1ihbjy8iknr4.webp" alt="image"></p><ol start="2"><li>è·Ÿè¸ªè·¯ç”±traceroute</li></ol><p><strong>ç”¨æ¥æµ‹è¯•IPæ•°æ®æŠ¥ä»æºä¸»æœºåˆ°è¾¾ç›®çš„ä¸»æœºä¸»è¦ç»è¿‡å“ªäº›è·¯ç”±å™¨</strong></p><blockquote><p>ä½¿ç”¨çš„æ˜¯è¯¢é—®æŠ¥æ–‡ä¸­çš„<strong>å›é€è¯·æ±‚å’Œå›ç­”</strong>å’Œå·®é”™æŠ¥æ–‡ä¸­çš„<strong>æ—¶é—´è¶…è¿‡</strong></p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.5c7o7ylenas0.webp" alt="image"></p><h2 id="è™šæ‹Ÿä¸“ç”¨ç½‘VPNä¸ç½‘ç»œåœ°å€è½¬æ¢NAT"><a href="#è™šæ‹Ÿä¸“ç”¨ç½‘VPNä¸ç½‘ç»œåœ°å€è½¬æ¢NAT" class="headerlink" title="è™šæ‹Ÿä¸“ç”¨ç½‘VPNä¸ç½‘ç»œåœ°å€è½¬æ¢NAT"></a>è™šæ‹Ÿä¸“ç”¨ç½‘VPNä¸ç½‘ç»œåœ°å€è½¬æ¢NAT</h2><h3 id="è™šæ‹Ÿä¸“ç”¨ç½‘VPN"><a href="#è™šæ‹Ÿä¸“ç”¨ç½‘VPN" class="headerlink" title="è™šæ‹Ÿä¸“ç”¨ç½‘VPN"></a>è™šæ‹Ÿä¸“ç”¨ç½‘VPN</h3><ul><li>ç”±äº <strong>IP åœ°å€çš„ç´§ç¼º</strong>ï¼Œä¸€ä¸ªæœºæ„èƒ½å¤Ÿç”³è¯·åˆ°çš„IPåœ°å€æ•°å¾€å¾€è¿œå°äºæœ¬æœºæ„æ‰€æ‹¥æœ‰çš„ä¸»æœºæ•°ã€‚</li><li>è€ƒè™‘åˆ°<strong>äº’è”ç½‘å¹¶ä¸å¾ˆå®‰å…¨</strong>ï¼Œä¸€ä¸ªæœºæ„å†…ä¹Ÿå¹¶ä¸éœ€è¦æŠŠæ‰€æœ‰çš„ä¸»æœºæ¥å…¥åˆ°å¤–éƒ¨çš„äº’è”ç½‘ã€‚</li><li>å‡å®šåœ¨ä¸€ä¸ªæœºæ„å†…éƒ¨çš„è®¡ç®—æœºé€šä¿¡ä¹Ÿæ˜¯é‡‡ç”¨ TCP&#x2F;IP åè®®ï¼Œé‚£ä¹ˆä»åŸåˆ™ä¸Šè®²ï¼Œå¯¹äºè¿™äº›ä»…åœ¨<strong>æœºæ„å†…éƒ¨ä½¿ç”¨</strong>çš„è®¡ç®—æœºå°±å¯ä»¥ç”±æœ¬æœºæ„<strong>è‡ªè¡Œåˆ†é…å…¶ IP åœ°å€</strong>ã€‚</li></ul><ul><li>åˆ©ç”¨å…¬ç”¨çš„å› ç‰¹ç½‘ä½œä¸ºæœ¬æœºæ„å„ä¸“ç”¨ç½‘ä¹‹é—´çš„é€šä¿¡è½½ä½“ï¼Œè¿™æ ·çš„ä¸“ç”¨ç½‘åˆç§°ä¸º<mark>è™šæ‹Ÿä¸“ç”¨ç½‘</mark>ã€‚</li><li>ä½¿ç”¨ç§æœ‰åœ°å€ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.77f88i6a8780.webp" alt="image"></p><ul><li><strong>æ ¹æ®å…·ä½“ç”¨é€”æœ‰æ‰€ä¸åŒ</strong>ï¼Œå¯åˆ†ä¸ºï¼š<mark>å†…è”ç½‘VPNã€å¤–è”ç½‘VPNã€è¿œç¨‹æ¥å…¥VPN</mark>ã€‚</li></ul><ol><li>å†…è”ç½‘VPN</li></ol><p>åŒä¸€æœºæ„å†…ä¸åŒéƒ¨é—¨çš„å†…éƒ¨ç½‘ç»œæ‰€æ„æˆçš„è™šæ‹Ÿä¸“ç”¨ç½‘VPNåˆç§°ä¸ºå†…è”ç½‘VPNã€‚</p><ol start="2"><li>å¤–è”ç½‘VPN</li></ol><p>æœ‰æ—¶ä¸€ä¸ªæœºæ„çš„VPNéœ€è¦æœ‰æŸäº›å¤–éƒ¨æœºæ„(é€šå¸¸å°±æ˜¯åˆä½œä¼™ä¼´)å‚åŠ è¿›æ¥ã€‚è¿™æ ·çš„VPNå°±ç§°ä¸ºå¤–è”ç½‘VPNã€‚</p><ol start="3"><li>è¿œç¨‹æ¥å…¥VPN</li></ol><p>åœ¨å¤–åœ°å·¥ä½œçš„å‘˜å·¥éœ€è¦è®¿é—®å…¬å¸å†…éƒ¨çš„ä¸“ç”¨ç½‘ç»œæ—¶,åªè¦åœ¨ä»»ä½•åœ°ç‚¹æ¥å…¥åˆ°å› ç‰¹ç½‘,è¿è¡Œé©»ç•™åœ¨å‘˜å·¥PCä¸­çš„VPNè½¯ä»¶ï¼Œåœ¨å‘˜å·¥çš„PCå’Œå…¬å¸çš„ä¸»æœºä¹‹é—´å»ºç«‹VPNéš§é“,å³å¯è®¿é—®ä¸“ç”¨ç½‘ç»œä¸­çš„èµ„æºã€‚è¿™ç§VPNç§°ä¸ºè¿œç¨‹æ¥å…¥VPNã€‚</p><blockquote><p>ç§æœ‰åœ°å€åªèƒ½ç”¨äºä¸€ä¸ªæœºæ„çš„å†…éƒ¨é€šä¿¡ï¼Œè€Œä¸èƒ½ç”¨äºå’Œå› ç‰¹ç½‘ä¸Šçš„ä¸»æœºé€šä¿¡</p><p>ç§æœ‰åœ°å€åªèƒ½ç”¨ä½œæœ¬åœ°åœ°å€è€Œä¸èƒ½ç”¨ä½œå…¨çƒåœ°å€</p><p>å› ç‰¹ç½‘ä¸­æ‰€æœ‰è·¯ç”±å™¨å¯¹ç›®çš„åœ°å€æ˜¯ç§æœ‰åœ°å€çš„IPæ•°æ®æŠ¥ä¸€å¾‹ä¸è¿›è¡Œè½¬å‘</p><p><strong>æœ¬åœ°åœ°å€ä¸å…¨çƒåœ°å€</strong></p><ul><li><strong>æœ¬åœ°åœ°å€</strong>â€”â€”ä»…åœ¨æœºæ„å†…éƒ¨ä½¿ç”¨çš„ IP åœ°å€ï¼Œå¯ä»¥ç”±æœ¬æœºæ„è‡ªè¡Œåˆ†é…ï¼Œè€Œä¸éœ€è¦å‘äº’è”ç½‘çš„ç®¡ç†æœºæ„ç”³è¯·ã€‚</li><li><strong>å…¨çƒåœ°å€</strong>â€”â€”å…¨çƒå”¯ä¸€çš„ IP åœ°å€ï¼Œå¿…é¡»å‘äº’è”ç½‘çš„ç®¡ç†æœºæ„ç”³è¯·ã€‚ </li><li><strong>é—®é¢˜</strong>ï¼šåœ¨å†…éƒ¨ä½¿ç”¨çš„æœ¬åœ°åœ°å€å°±æœ‰å¯èƒ½å’Œäº’è”ç½‘ä¸­æŸä¸ª IP åœ°å€é‡åˆï¼Œè¿™æ ·å°±ä¼šå‡ºç°åœ°å€çš„äºŒä¹‰æ€§é—®é¢˜ã€‚</li></ul></blockquote><p>æ‰€ä»¥éƒ¨é—¨Aå’Œéƒ¨é—¨Bè‡³å°‘éœ€è¦ä¸€ä¸ª è·¯ç”±å™¨å…·æœ‰åˆæ³•çš„å…¨çƒIPåœ°å€ï¼Œè¿™æ ·å„è‡ªçš„ä¸“ç”¨ç½‘æ‰èƒ½åˆ©ç”¨å…¬ç”¨çš„å› ç‰¹ç½‘è¿›è¡Œé€šä¿¡</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201020000618797.png" alt="image-20201020000618797"></p><p>éƒ¨é—¨Aå‘éƒ¨é—¨Bå‘é€æ•°æ®æµç¨‹</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201020001107425.png" alt="image-20201020001107425"></p><blockquote><p>ä¸¤ä¸ªä¸“ç”¨ç½‘å†…çš„ä¸»æœºé—´å‘é€çš„æ•°æ®æŠ¥æ˜¯é€šè¿‡äº†å…¬ç”¨çš„å› ç‰¹ç½‘ï¼Œä½†åœ¨æ•ˆæœä¸Šå°±å¥½åƒæ˜¯åœ¨æœ¬æœºæ„çš„ä¸“ç”¨ç½‘ä¸Šä¼ é€ä¸€æ ·</p><p>æ•°æ®æŠ¥åœ¨å› ç‰¹ç½‘ä¸­å¯èƒ½è¦ç»è¿‡å¤šä¸ªç½‘ç»œå’Œè·¯ç”±å™¨ï¼Œä½†ä»é€»è¾‘ä¸Šçœ‹ï¼ŒR1å’ŒR2ä¹‹é—´å¥½åƒæ˜¯ä¸€æ¡ç›´é€šçš„ç‚¹å¯¹ç‚¹é“¾è·¯</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201020001528569.png" alt="image-20201020001528569"></p><p>å› æ­¤ä¹Ÿè¢«ç§°ä¸ºIPéš§é“æŠ€æœ¯</p></blockquote><h3 id="ç½‘ç»œåœ°å€è½¬æ¢NAT"><a href="#ç½‘ç»œåœ°å€è½¬æ¢NAT" class="headerlink" title="ç½‘ç»œåœ°å€è½¬æ¢NAT"></a>ç½‘ç»œåœ°å€è½¬æ¢NAT</h3><ul><li><p>è™½ç„¶å› ç‰¹ç½‘é‡‡ç”¨äº†æ— åˆ†ç±»ç¼–å€æ–¹å¼æ¥å‡ç¼“IPv4åœ°å€ç©ºé—´è€—å°½çš„é€Ÿåº¦ï¼Œä½†<strong>ç”±äºå› ç‰¹ç½‘ç”¨æˆ·æ•°ç›®çš„æ¿€å¢</strong>ï¼Œç‰¹åˆ«æ˜¯å¤§é‡å°å‹åŠå…¬å®¤ç½‘ç»œå’Œå®¶åº­ç½‘ç»œæ¥å…¥å› ç‰¹ç½‘çš„éœ€æ±‚ä¸æ–­å¢åŠ ï¼Œ<strong>IPv4åœ°å€ç©ºé—´</strong>å³å°†é¢ä¸´è€—å°½çš„å±é™©ä»ç„¶æ²¡æœ‰è¢«è§£é™¤ã€‚</p></li><li><p>1994å¹´æå‡ºäº†ä¸€ç§<strong>ç½‘ç»œåœ°å€è½¬æ¢NATçš„æ–¹æ³•</strong>å†æ¬¡ç¼“è§£äº†IPv4åœ°å€ç©ºé—´å³å°†è€—å°½çš„é—®é¢˜ã€‚</p><p>NATèƒ½ä½¿å¤§é‡ä½¿ç”¨<strong>å†…éƒ¨ä¸“ç”¨åœ°å€</strong>çš„<strong>ä¸“ç”¨ç½‘ç»œ</strong>ç”¨æˆ·å…±äº«å°‘é‡å¤–éƒ¨å…¨çƒåœ°å€æ¥è®¿é—®å› ç‰¹ç½‘ä¸Šçš„ä¸»æœºå’Œèµ„æºã€‚</p></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.18qzhvvvlxvk.webp" alt="image"></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.1r0bxwhrjrgg.webp" alt="image"></p><ul><li>ç”¨ä¸€ä¸ªå…¨çƒIPåœ°å€å°±å¯ä»¥ä½¿å¤šä¸ªæ‹¥æœ‰æœ¬åœ°åœ°å€çš„ä¸»æœºåŒæ—¶å’Œå› ç‰¹ç½‘ä¸Šçš„ä¸»æœºè¿›è¡Œé€šä¿¡ã€‚è¿™ç§å°†ç«¯å£å·å’ŒIPåœ°å€ä¸€èµ·è¿›è¡Œè½¬æ¢çš„æŠ€æœ¯å«ä½œ<code>ç½‘ç»œåœ°å€ä¸ç«¯å£å·è½¬æ¢NAPT</code>(Network Address and Port Translation)ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.5g0c9qkgacg0.webp" alt="image"></p><p><strong>â­æ³¨æ„ï¼šå¯¹äºä¸€äº›P2Pç½‘ç»œåº”ç”¨ï¼Œéœ€è¦å¤–ç½‘ä¸»æœºä¸»åŠ¨ä¸å†…ç½‘ä¸»æœºè¿›è¡Œé€šä¿¡</strong>ï¼Œåœ¨é€šè¿‡NATæ—¶ä¼šé‡åˆ°é—®é¢˜ï¼Œéœ€è¦ç½‘ç»œåº”ç”¨è‡ªå·±ä½¿ç”¨ä¸€äº›ç‰¹æ®Šçš„<code>NATç©¿è¶ŠæŠ€æœ¯</code>æ¥è§£å†³é—®é¢˜ã€‚</p><p>å¦å¤–ï¼Œç”±äº<strong>NAT</strong>å¯¹å¤–ç½‘å±è”½äº†å†…ç½‘ä¸»æœºçš„<strong>ç½‘ç»œåœ°å€</strong>ï¼Œèƒ½ä¸ºå†…ç½‘çš„ä¸»æœºæä¾›ä¸€å®šçš„<code>å®‰å…¨ä¿æŠ¤</code>ã€‚</p><h1 id="è¿è¾“å±‚"><a href="#è¿è¾“å±‚" class="headerlink" title="è¿è¾“å±‚"></a>è¿è¾“å±‚</h1><h2 id="æ¦‚è¿°-3"><a href="#æ¦‚è¿°-3" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>è¦è§£å†³çš„é—®é¢˜ï¼š</p><ul><li>è§£å†³è¿›ç¨‹ä¹‹é—´åŸºäºç½‘ç»œçš„é€šä¿¡åŠŸèƒ½</li><li>ä¼ è¾“å‡ºç°é”™è¯¯çš„æ—¶å€™ï¼Œå¦‚ä½•å¤„ç†</li></ul><hr><ul><li>ä¹‹å‰æ‰€äº†è§£åˆ°çš„<strong>ç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚ä»¥åŠç½‘ç»œå±‚</strong>ï¼Œå®ƒä»¬å…±åŒè§£å†³äº†<strong>å°†ä¸»æœºé€šè¿‡å¼‚æ„ç½‘ç»œäº’è”èµ·æ¥</strong>æ‰€é¢ä¸´çš„é—®é¢˜ï¼Œå®ç°äº†<mark>ä¸»æœºåˆ°ä¸»æœºçš„é€šä¿¡</mark>ã€‚</li></ul><ul><li><p>ä½†å®é™…ä¸Šåœ¨è®¡ç®—æœºç½‘ç»œä¸­è¿›è¡Œé€šä¿¡çš„<mark>çœŸæ­£å®ä½“</mark>æ˜¯ä½äº<strong>é€šä¿¡ä¸¤ç«¯ä¸»æœºä¸­çš„è¿›ç¨‹</strong>ã€‚</p></li><li><p>å¦‚ä½•ä¸ºè¿è¡Œåœ¨ä¸åŒä¸»æœºä¸Šçš„åº”ç”¨è¿›ç¨‹æä¾›ç›´æ¥çš„é€šä¿¡æœåŠ¡æ˜¯<strong>è¿è¾“å±‚çš„ä»»åŠ¡</strong>ï¼Œè¿è¾“å±‚åè®®åˆç§°ä¸º<mark>ç«¯åˆ°ç«¯åè®®</mark>ã€‚</p></li></ul><h2 id="è¿è¾“å±‚ç«¯å£å·ã€å¤ç”¨ä¸åˆ†ç”¨çš„æ¦‚å¿µ"><a href="#è¿è¾“å±‚ç«¯å£å·ã€å¤ç”¨ä¸åˆ†ç”¨çš„æ¦‚å¿µ" class="headerlink" title="è¿è¾“å±‚ç«¯å£å·ã€å¤ç”¨ä¸åˆ†ç”¨çš„æ¦‚å¿µ"></a>è¿è¾“å±‚ç«¯å£å·ã€å¤ç”¨ä¸åˆ†ç”¨çš„æ¦‚å¿µ</h2><ul><li>è¿è¡Œåœ¨è®¡ç®—æœºä¸Šçš„è¿›ç¨‹ä½¿ç”¨<strong>è¿›ç¨‹æ ‡è¯†ç¬¦</strong><code>PID</code>æ¥æ ‡å¿—ã€‚</li><li>å› ç‰¹ç½‘ä¸Šçš„è®¡ç®—æœºå¹¶ä¸æ˜¯ä½¿ç”¨ç»Ÿä¸€çš„æ“ä½œç³»ç»Ÿï¼Œä¸åŒçš„æ“ä½œç³»ç»Ÿ(windows, Linux, Mac OS)åˆä½¿ç”¨ä¸åŒæ ¼å¼çš„è¿›ç¨‹æ ‡è¯†ç¬¦ã€‚</li><li>ä¸ºäº†ä½¿è¿è¡Œ<strong>ä¸åŒæ“ä½œç³»ç»Ÿçš„è®¡ç®—æœºçš„åº”ç”¨è¿›ç¨‹ä¹‹é—´</strong>èƒ½å¤Ÿè¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œå°±å¿…é¡»ä½¿ç”¨<strong>ç»Ÿä¸€çš„æ–¹æ³•å¯¹TCP&#x2F;IPä½“ç³»çš„åº”ç”¨è¿›ç¨‹è¿›è¡Œæ ‡è¯†</strong>ã€‚</li></ul><hr><ul><li><p><strong>TCP&#x2F;IPä½“ç³»çš„è¿è¾“å±‚</strong>ä½¿ç”¨<mark>ç«¯å£å·</mark>æ¥åŒºåˆ†åº”ç”¨å±‚çš„ä¸åŒåº”ç”¨è¿›ç¨‹ã€‚</p></li><li><p>ç«¯å£å·ä½¿ç”¨16æ¯”ç‰¹è¡¨ç¤º, å–å€¼èŒƒå›´0~65535;</p><ul><li><p>ç«¯å£å·åªå…·æœ‰æœ¬åœ°æ„ä¹‰ï¼Œå³ç«¯å£å·åªæ˜¯ä¸ºäº†æ ‡è¯†æœ¬è®¡ç®—æœºåº”ç”¨å±‚ä¸­çš„å„è¿›ç¨‹ï¼Œåœ¨å› ç‰¹ç½‘ä¸­ï¼Œä¸åŒè®¡ç®—æœºä¸­çš„ç›¸åŒç«¯å£å·æ˜¯æ²¡æœ‰è”ç³»çš„ã€‚</p><ul><li><strong>ç†ŸçŸ¥ç«¯å£å·</strong>:0~1023ï¼ŒIANAæŠŠè¿™äº›ç«¯å£å·æŒ‡æ´¾ç»™äº†TCP&#x2F;IPä½“ç³»ä¸­æœ€é‡è¦çš„ä¸€äº›åº”ç”¨åè®®ï¼Œä¾‹å¦‚:FTPä½¿ç”¨21&#x2F;20ï¼ŒHTTPä½¿ç”¨80ï¼ŒDNSä½¿ç”¨53ã€‚</li><li><strong>ç™»è®°ç«¯å£å·</strong>:1024~49151ï¼Œä¸ºæ²¡æœ‰ç†ŸçŸ¥ç«¯å£å·çš„åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚ä½¿ç”¨è¿™ç±»ç«¯å£å·å¿…é¡»åœ¨IANAæŒ‰ç…§è§„å®šçš„æ‰‹ç»­ç™»è®°ï¼Œä»¥é˜²æ­¢é‡å¤ã€‚ä¾‹å¦‚: Microsoft RDPå¾®è½¯è¿œç¨‹æ¡Œé¢ä½¿ç”¨çš„ç«¯å£æ˜¯3389ã€‚</li><li><strong>çŸ­æš‚ç«¯å£å·</strong>:49152~65535ï¼Œç•™ç»™å®¢æˆ·è¿›ç¨‹é€‰æ‹©æš‚æ—¶ä½¿ç”¨ã€‚å½“æœåŠ¡å™¨è¿›ç¨‹æ”¶åˆ°å®¢æˆ·è¿›ç¨‹çš„æŠ¥æ–‡æ—¶ï¼Œå°±çŸ¥é“äº†å®¢æˆ·è¿›ç¨‹æ‰€ä½¿ç”¨çš„åŠ¨æ€ç«¯ã€‚</li></ul></li></ul></li><li><p><strong>å‘é€æ–¹</strong>çš„<mark>å¤ç”¨</mark>å’Œ<strong>æ¥æ”¶æ–¹</strong>çš„<mark>åˆ†ç”¨</mark></p></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.3kewg9zvtcq0.webp" alt="image"></p><blockquote><p><strong>å¤šä¸ªè¿›ç¨‹ï¼ˆè¿™é‡Œä¸€ä¸ªç«¯å£è¡¨ç¤ºä¸€ä¸ªè¿›ç¨‹ï¼‰</strong> åˆ©ç”¨ä¸€ä¸ªè¿è¾“å±‚åè®®ï¼ˆæˆ–è€…ç§°ä¸ºè¿è¾“å±‚æ¥å£ï¼‰<strong>å‘é€</strong>æ•°æ®ç§°ä¸º <strong>å¤ç”¨</strong></p><p><strong>å¤šä¸ªè¿›ç¨‹ï¼ˆè¿™é‡Œä¸€ä¸ªç«¯å£è¡¨ç¤ºä¸€ä¸ªè¿›ç¨‹ï¼‰</strong> åˆ©ç”¨ä¸€ä¸ªè¿è¾“å±‚åè®®ï¼ˆæˆ–è€…ç§°ä¸ºè¿è¾“å±‚æ¥å£ï¼‰<strong>æ¥æ”¶</strong>æ—¶å«åš  <strong>åˆ†ç”¨</strong>ã€‚</p></blockquote><ul><li><strong>TCP&#x2F;IPä½“ç³»çš„åº”ç”¨å±‚å¸¸ç”¨åè®®</strong>æ‰€ä½¿ç”¨çš„<mark>è¿è¾“å±‚ç†ŸçŸ¥ç«¯å£å·</mark></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.4r06l2f4lyg0.webp" alt="image"></p><h2 id="UDPå’ŒTCPçš„å¯¹æ¯”"><a href="#UDPå’ŒTCPçš„å¯¹æ¯”" class="headerlink" title="UDPå’ŒTCPçš„å¯¹æ¯”"></a>UDPå’ŒTCPçš„å¯¹æ¯”</h2><ul><li><mark>UDPå’ŒTCP</mark>æ˜¯<strong>TCP&#x2F;IPä½“ç³»ç»“æ„è¿è¾“å±‚ä¸­</strong>çš„<strong>ä¸¤ä¸ªé‡è¦åè®®</strong></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.1aja6sjf1wsg.webp" alt="image"></p><ul><li>å½“è¿è¾“å±‚é‡‡ç”¨é¢å‘è¿æ¥çš„ <strong>TCP</strong> åè®®æ—¶ï¼Œå°½ç®¡ä¸‹é¢çš„ç½‘ç»œæ˜¯ä¸å¯é çš„ï¼ˆåªæä¾›å°½æœ€å¤§åŠªåŠ›æœåŠ¡ï¼‰ï¼Œä½†è¿™ç§é€»è¾‘é€šä¿¡ä¿¡é“å°±ç›¸å½“äºä¸€æ¡<strong>å…¨åŒå·¥çš„å¯é ä¿¡é“</strong>ã€‚</li><li>å½“è¿è¾“å±‚é‡‡ç”¨æ— è¿æ¥çš„ <strong>UDP</strong> åè®®æ—¶ï¼Œè¿™ç§é€»è¾‘é€šä¿¡ä¿¡é“æ˜¯ä¸€æ¡<strong>ä¸å¯é ä¿¡é“</strong>ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.1mc21iy1ld4w.webp" alt="image"></p><h2 id="TCPçš„æµé‡æ§åˆ¶"><a href="#TCPçš„æµé‡æ§åˆ¶" class="headerlink" title="TCPçš„æµé‡æ§åˆ¶"></a>TCPçš„æµé‡æ§åˆ¶</h2><ul><li>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬æ€»æ˜¯å¸Œæœ›<code>æ•°æ®ä¼ è¾“</code>å¾—æ›´å¿«ä¸€äº›ã€‚</li><li>ä½†å¦‚æœå‘é€æ–¹æŠŠæ•°æ®å‘é€å¾—è¿‡å¿«ï¼Œæ¥æ”¶æ–¹å°±å¯èƒ½æ¥ä¸åŠæ¥æ”¶ï¼Œè¿™å°±ä¼šé€ æˆæ•°æ®çš„ä¸¢å¤±ã€‚</li><li>æ‰€è°“<code>æµé‡æ§åˆ¶(flow control)</code>å°±æ˜¯<strong>è®©å‘é€æ–¹çš„å‘é€é€Ÿç‡ä¸è¦å¤ªå¿«ï¼Œè¦è®©æ¥æ”¶æ–¹æ¥å¾—åŠæ¥æ”¶</strong>ã€‚</li><li>æµé‡æ§åˆ¶æ€ä¹ˆæ›´å¥½åœ°å®ç°ï¼Ÿ<ul><li>åˆ©ç”¨<code>æ»‘åŠ¨çª—å£æœºåˆ¶</code>å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åœ¨TCPè¿æ¥ä¸Šå®ç°å¯¹å‘é€æ–¹çš„æµé‡æ§åˆ¶ã€‚</li><li>TCPæ¥æ”¶æ–¹åˆ©ç”¨è‡ªå·±çš„æ¥æ”¶çª—å£çš„å¤§å°æ¥é™åˆ¶å‘é€æ–¹å‘é€çª—å£çš„å¤§å°ã€‚</li></ul></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.2data3orpc2s.webp" alt="image"></p><ul><li>TCPå‘é€æ–¹æ”¶åˆ°æ¥æ”¶æ–¹çš„é›¶çª—å£é€šçŸ¥åï¼Œåº”å¯åŠ¨<mark>æŒç»­è®¡æ—¶å™¨</mark>ã€‚æŒç»­è®¡æ—¶å™¨è¶…æ—¶åï¼Œå‘æ¥æ”¶æ–¹å‘é€<mark>é›¶çª—å£æ¢æµ‹æŠ¥æ–‡</mark>ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.1383702862lc.webp" alt="image"></p><blockquote><p>ä¸Šå›¾å¦‚æœé›¶çª—å£æ¢æµ‹æŠ¥æ–‡åœ¨å‘é€è¿‡ç¨‹ä¸­å¦‚æœä¸¢å¤±ï¼Œè¿˜æ˜¯èƒ½æ‰“ç ´æ­»é”å±€é¢</p><p>å› ä¸ºé›¶çª—å£æ¢æµ‹æŠ¥æ–‡æ®µä¹Ÿæœ‰é‡ä¼ è®¡æ—¶å™¨ï¼Œé‡ä¼ è®¡æ—¶å™¨è¶…æ—¶åï¼Œé›¶çª—å£æ¢æµ‹æŠ¥æ–‡æ®µä¼šè¢«é‡ä¼ </p></blockquote><h2 id="TCPçš„æ‹¥å¡æ§åˆ¶"><a href="#TCPçš„æ‹¥å¡æ§åˆ¶" class="headerlink" title="TCPçš„æ‹¥å¡æ§åˆ¶"></a>TCPçš„æ‹¥å¡æ§åˆ¶</h2><ul><li>åœ¨æŸæ®µæ—¶é—´,è‹¥å¯¹<strong>ç½‘ç»œä¸­æŸä¸€èµ„æºçš„éœ€æ±‚è¶…è¿‡äº†è¯¥èµ„æºæ‰€èƒ½æä¾›çš„å¯ç”¨éƒ¨åˆ†ç½‘ç»œæ€§èƒ½å°±è¦å˜å</strong>ã€‚è¿™ç§æƒ…å†µå°±å«åš<strong>æ‹¥å¡</strong>(congestion)ã€‚</li><li>åœ¨è®¡ç®—æœºç½‘ç»œä¸­çš„é“¾è·¯å®¹é‡(å³å¸¦å®½)ã€äº¤æ¢ç»“ç‚¹ä¸­çš„ç¼“å­˜å’Œå¤„ç†æœºç­‰ï¼Œéƒ½æ˜¯ç½‘ç»œçš„èµ„æºã€‚</li><li>è‹¥å‡ºç°æ‹¥å¡è€Œä¸è¿›è¡Œæ§åˆ¶ï¼Œæ•´ä¸ªç½‘ç»œçš„ååé‡å°†éšè¾“å…¥è´Ÿè·çš„å¢å¤§è€Œä¸‹é™ã€‚</li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.2rhjnsq8mt20.webp" alt="image"></p><h3 id="æ‹¥å¡çª—å£ä¸çŠ¶æ€å˜é‡"><a href="#æ‹¥å¡çª—å£ä¸çŠ¶æ€å˜é‡" class="headerlink" title="æ‹¥å¡çª—å£ä¸çŠ¶æ€å˜é‡"></a>æ‹¥å¡çª—å£ä¸çŠ¶æ€å˜é‡</h3><ul><li>å‘é€æ–¹ç»´æŠ¤ä¸€ä¸ªå«åšæ‹¥å¡çª—å£cwndçš„çŠ¶æ€å˜é‡ï¼Œå…¶å€¼å–å†³äºç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦ï¼Œå¹¶ä¸”åŠ¨æ€å˜åŒ–ã€‚<ul><li>æ‹¥å¡çª—å£cwndçš„ç»´æŠ¤åŸåˆ™ï¼šåªè¦ç½‘ç»œæ²¡æœ‰å‡ºç°æ‹¥å¡ï¼Œæ‹¥å¡çª—å£å°±å†å¢å¤§ä¸€äº›;ä½†åªè¦ç½‘ç»œå‡ºç°æ‹¥å¡ï¼Œæ‹¥å¡çª—å£å°±å‡å°‘ä¸€äº›ã€‚</li><li>åˆ¤æ–­å‡ºç°ç½‘ç»œæ‹¥å¡çš„ä¾æ®ï¼šæ²¡æœ‰æŒ‰æ—¶æ”¶åˆ°åº”å½“åˆ°è¾¾çš„ç¡®è®¤æŠ¥æ–‡(å³å‘ç”Ÿè¶…æ—¶é‡ä¼ )ã€‚</li></ul></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.295xorkv93i8.webp" alt="image"></p><ul><li>å‘é€æ–¹å°†<code>æ‹¥å¡çª—å£</code>ä½œä¸ºå‘é€çª—å£swndï¼Œå³<strong>swnd&#x3D; cwnd</strong>ã€‚</li><li>ç»´æŠ¤ä¸€ä¸ªæ…¢å¼€å§‹é—¨é™<code>ssthreshçŠ¶æ€å˜é‡</code>:<ul><li>å½“<code>cwnd &lt; ssthresh</code>æ—¶ï¼Œä½¿ç”¨<strong>æ…¢å¼€å§‹ç®—æ³•</strong>:</li><li>å½“<code>cwnd &gt; ssthresh</code>æ—¶ï¼Œåœæ­¢ä½¿ç”¨æ…¢å¼€å§‹ç®—æ³•è€Œ<strong>æ”¹ç”¨æ‹¥å¡é¿å…ç®—æ³•</strong>;</li><li>å½“<code>cwnd = ssthresh</code>æ—¶ï¼Œæ—¢<strong>å¯ä½¿ç”¨æ…¢å¼€å§‹ç®—æ³•ï¼Œä¹Ÿå¯ä½¿ç”¨æ‹¥å¡é¿å…ç®—æ³•</strong>ã€‚</li></ul></li></ul><blockquote><p>æ…¢å¼€å§‹ç®—æ³•æŒ‡çš„æ˜¯æ¯ç»è¿‡ä¸€ä¸ªä¼ è¾“è½®æ¬¡ï¼Œæ‹¥å¡çª—å£å°±åŠ å€ï¼Œçª—å£å¤§å°æŒ‰<strong>æŒ‡æ•°å¢åŠ </strong>ï¼Œ2çš„n-1æ¬¡æ–¹</p></blockquote><blockquote><p>æ‹¥å¡é¿å…ç®—æ³•æ¯ç»è¿‡ä¸€ä¸ªä¼ è¾“è½®æ¬¡ï¼Œæ‹¥å¡çª—å£ <strong>cwnd &#x3D; cwnd + 1</strong>ã€‚ä½¿æ‹¥å¡çª—å£ cwnd æŒ‰çº¿æ€§è§„å¾‹ç¼“æ…¢å¢é•¿ã€‚</p></blockquote><hr><blockquote><p>æ…¢å¼€å§‹æ˜¯æŒ‡ä¸€å¼€å§‹å‘ç½‘ç»œæ³¨å…¥çš„æŠ¥æ–‡æ®µå°‘ï¼Œå¹¶ä¸æ˜¯æŒ‡æ‹¥å¡çª—å£cwndå¢é•¿é€Ÿåº¦æ…¢;</p><p>æ‹¥å¡é¿å…å¹¶éæŒ‡å®Œå…¨èƒ½å¤Ÿé¿å…æ‹¥å¡ï¼Œè€Œæ˜¯æŒ‡åœ¨æ‹¥å¡é¿å…é˜¶æ®µå°†æ‹¥å¡çª—å£æ§åˆ¶ä¸ºæŒ‰çº¿æ€§è§„å¾‹å¢é•¿ï¼Œä½¿ç½‘ç»œæ¯”è¾ƒä¸å®¹æ˜“å‡ºç°æ‹¥å¡.</p></blockquote><ul><li>æ‰€è°“å¿«é‡ä¼ ï¼Œå°±æ˜¯ä½¿å‘é€æ–¹<strong>å°½å¿«è¿›è¡Œé‡ä¼ </strong>ï¼Œè€Œ<strong>ä¸æ˜¯ç­‰è¶…æ—¶é‡ä¼ è®¡æ—¶å™¨è¶…æ—¶</strong>å†é‡ä¼ ã€‚<ul><li>è¦æ±‚æ¥æ”¶æ–¹ä¸è¦ç­‰å¾…è‡ªå·±å‘é€æ•°æ®æ—¶æ‰è¿›è¡Œæå¸¦ç¡®è®¤ï¼Œè€Œæ˜¯è¦<strong>ç«‹å³å‘é€ç¡®è®¤</strong>;</li><li>å³ä½¿æ”¶åˆ°äº†å¤±åºçš„æŠ¥æ–‡æ®µä¹Ÿè¦ç«‹å³å‘å‡ºå¯¹å·²æ”¶åˆ°çš„æŠ¥æ–‡æ®µçš„<strong>é‡å¤ç¡®è®¤</strong>ã€‚</li><li>å‘é€æ–¹ä¸€æ—¦<strong>æ”¶åˆ°3ä¸ªè¿ç»­çš„é‡å¤ç¡®è®¤</strong>ï¼Œå°±å°†ç›¸åº”çš„æŠ¥æ–‡æ®µ<strong>ç«‹å³é‡ä¼ </strong>ï¼Œè€Œä¸æ˜¯ç­‰è¯¥æŠ¥æ–‡æ®µçš„è¶…æ—¶é‡ä¼ è®¡æ—¶å™¨è¶…æ—¶å†é‡ä¼ ã€‚</li><li>å¯¹äºä¸ªåˆ«ä¸¢å¤±çš„æŠ¥æ–‡æ®µï¼Œå‘é€æ–¹ä¸ä¼šå‡ºç°è¶…æ—¶é‡ä¼ ï¼Œä¹Ÿå°±ä¸ä¼šè¯¯è®¤ä¸ºå‡ºç°äº†æ‹¥å¡ï¼ˆè¿›è€Œé™ä½æ‹¥å¡çª—å£cwndä¸º1)ã€‚ä½¿ç”¨å¿«é‡ä¼ å¯ä»¥ä½¿æ•´ä¸ªç½‘ç»œçš„ååé‡æé«˜çº¦20%ã€‚</li></ul></li><li>å‘é€æ–¹ä¸€æ—¦<strong>æ”¶åˆ°3ä¸ªé‡å¤ç¡®è®¤</strong>ï¼Œå°±çŸ¥é“ç°åœ¨åªæ˜¯ä¸¢å¤±äº†ä¸ªåˆ«çš„æŠ¥æ–‡æ®µã€‚äºæ˜¯ä¸å¯åŠ¨æ…¢å¼€å§‹ç®—æ³•ï¼Œè€Œæ‰§è¡Œå¿«æ¢å¤ç®—æ³•;<ul><li><strong>å‘é€æ–¹å°†æ…¢å¼€å§‹é—¨é™ssthreshå€¼å’Œæ‹¥å¡çª—å£cwndå€¼è°ƒæ•´ä¸ºå½“å‰çª—å£çš„ä¸€åŠ;å¼€å§‹æ‰§è¡Œæ‹¥å¡é¿å…ç®—æ³•</strong>ã€‚</li><li>ä¹Ÿæœ‰çš„å¿«æ¢å¤å®ç°æ˜¯æŠŠå¿«æ¢å¤å¼€å§‹æ—¶çš„æ‹¥å¡çª—å£cwndå€¼å†å¢å¤§ä¸€äº›ï¼Œå³ç­‰äºæ–°çš„ssthresh + 3ã€‚<ul><li>æ—¢ç„¶å‘é€æ–¹æ”¶åˆ°3ä¸ªé‡å¤çš„ç¡®è®¤ï¼Œå°±è¡¨æ˜æœ‰3ä¸ªæ•°æ®æŠ¥æ–‡æ®µå·²ç»ç¦»å¼€äº†ç½‘ç»œ;</li><li>è¿™3ä¸ªæŠ¥æ–‡æ®µä¸å†æ¶ˆè€—ç½‘ç»œèµ„æºè€Œæ˜¯åœç•™åœ¨æ¥æ”¶æ–¹çš„æ¥æ”¶ç¼“å­˜ä¸­;</li><li>å¯è§ç°åœ¨ç½‘ç»œä¸­ä¸æ˜¯å †ç§¯äº†æŠ¥æ–‡æ®µè€Œæ˜¯å‡å°‘äº†3ä¸ªæŠ¥æ–‡æ®µã€‚å› æ­¤å¯ä»¥é€‚å½“æŠŠæ‹¥å¡çª—å£æ‰©å¤§äº›ã€‚</li></ul></li></ul></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.5ftqrwvw4n80.webp" alt="image"></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.434aom9plea0.webp" alt="image"></p><h2 id="TCPè¶…æ—¶é‡ä¼ æ—¶é—´çš„é€‰æ‹©"><a href="#TCPè¶…æ—¶é‡ä¼ æ—¶é—´çš„é€‰æ‹©" class="headerlink" title="TCPè¶…æ—¶é‡ä¼ æ—¶é—´çš„é€‰æ‹©"></a>TCPè¶…æ—¶é‡ä¼ æ—¶é—´çš„é€‰æ‹©</h2><p>å­˜åœ¨çš„é—®é¢˜ï¼š</p><ul><li><p>å¦‚æœè¶…æ—¶é‡ä¼ æ—¶é—´RTOçš„å€¼è®¾ç½®å¾—æ¯”RTT0çš„å€¼å°å¾ˆå¤šï¼Œè¿™ä¼šå¼•èµ·æŠ¥æ–‡æ®µä¸å¿…è¦çš„é‡ä¼ ï¼Œä½¿ç½‘ç»œè´Ÿè·å¢å¤§</p></li><li><p>å¦‚æœè¶…æ—¶é‡ä¼ æ—¶é—´RTOçš„å€¼è®¾ç½®å¾—è¿œå¤§äºRTT0çš„å€¼ï¼Œè¿™ä¼šä½¿é‡ä¼ æ—¶é—´æ¨è¿Ÿçš„å¤ªé•¿ï¼Œä½¿ç½‘ç»œçš„ç©ºé—²æ—¶é—´å¢å¤§ï¼Œé™ä½ä¼ è¾“æ•ˆç‡</p></li></ul><p><strong>ä¸¾ä¾‹ï¼š</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201022154350745-170124572999443.png" alt="image-20201022154350745"></p><p><strong>æ€»ç»“ï¼š</strong></p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201022154418863-170124572999444.png" alt="image-20201022154418863"></p><h2 id="TCPå¯é ä¼ è¾“çš„å®ç°"><a href="#TCPå¯é ä¼ è¾“çš„å®ç°" class="headerlink" title="TCPå¯é ä¼ è¾“çš„å®ç°"></a>TCPå¯é ä¼ è¾“çš„å®ç°</h2><ul><li><strong>TCP</strong>åŸºäºä»¥<code>å­—èŠ‚</code>ä¸ºå•ä½çš„<mark><strong>æ»‘åŠ¨çª—å£</strong></mark>æ¥å®ç°<code>å¯é ä¼ è¾“</code></li></ul><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image.58li4eiigd80.webp" alt="image"></p><ul><li>è™½ç„¶å‘é€æ–¹çš„å‘é€çª—å£æ˜¯æ ¹æ®æ¥æ”¶æ–¹çš„æ¥æ”¶çª—å£è®¾ç½®çš„ï¼Œä½†åœ¨åŒä¸€æ—¶åˆ»ï¼Œå‘é€æ–¹çš„å‘é€çª—å£å¹¶ä¸æ€»æ˜¯å’Œæ¥æ”¶æ–¹çš„æ¥æ”¶çª—å£<code>ä¸€æ ·å¤§</code>ã€‚<mark>å› ä¸ºå‘é€çª—å£æ˜¯ä»æ¥æ”¶æ–¹çš„æ¥æ”¶çª—å£å’Œæ‹¥å¡çª—å£ä¸­å–æœ€å°å€¼ã€‚</mark></li></ul><p>ğŸŒˆè¡¥å……ï¼š</p><ol><li>å¯¹äºä¸æŒ‰åºåˆ°è¾¾çš„æ•°æ®åº”å¦‚ä½•å¤„ç†ï¼ŒTCPå¹¶æ— æ˜ç¡®è§„å®šã€‚</li><li>TCPè¦æ±‚æ¥æ”¶æ–¹å¿…é¡»æœ‰<code>ç´¯ç§¯ç¡®è®¤å’Œæå¸¦ç¡®è®¤</code>æœºåˆ¶</li><li>TCPçš„é€šä¿¡æ˜¯<strong>å…¨åŒå·¥é€šä¿¡</strong>ã€‚é€šä¿¡ä¸­çš„æ¯ä¸€æ–¹éƒ½åœ¨å‘é€å’Œæ¥æ”¶æŠ¥æ–‡æ®µã€‚å› æ­¤ï¼Œæ¯ä¸€æ–¹éƒ½æœ‰è‡ªå·±çš„å‘é€çª—å£å’Œæ¥æ”¶çª—å£ã€‚åœ¨è°ˆåˆ°è¿™äº›çª—å£æ—¶ï¼Œä¸€å®šè¦å¼„æ¸…æ¥šæ˜¯å“ªä¸€æ–¹çš„çª—å£ã€‚</li></ol><h2 id="TCPçš„è¿è¾“è¿æ¥ç®¡ç†â­â­â­"><a href="#TCPçš„è¿è¾“è¿æ¥ç®¡ç†â­â­â­" class="headerlink" title="TCPçš„è¿è¾“è¿æ¥ç®¡ç†â­â­â­"></a>TCPçš„è¿è¾“è¿æ¥ç®¡ç†â­â­â­</h2><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201022193215183-170124013647719.png" alt="image-20201022193215183"></p><h3 id="TCPçš„è¿æ¥å»ºç«‹"><a href="#TCPçš„è¿æ¥å»ºç«‹" class="headerlink" title="TCPçš„è¿æ¥å»ºç«‹"></a>TCPçš„è¿æ¥å»ºç«‹</h3><ul><li>TCP è¿æ¥çš„å»ºç«‹<strong>é‡‡ç”¨å®¢æˆ·æœåŠ¡å™¨æ–¹å¼</strong>ã€‚</li><li>ä¸»åŠ¨å‘èµ·è¿æ¥å»ºç«‹çš„åº”ç”¨è¿›ç¨‹å«åš<strong>TCPå®¢æˆ·</strong> (client)ã€‚</li><li>è¢«åŠ¨ç­‰å¾…è¿æ¥å»ºç«‹çš„åº”ç”¨è¿›ç¨‹å«åš<strong>TCPæœåŠ¡å™¨</strong> (server)ã€‚</li></ul><p>â€œæ¡æ‰‹â€éœ€è¦åœ¨TCPå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´äº¤æ¢ä¸‰ä¸ªTCPæŠ¥æ–‡æ®µ</p><p>è¿‡ç¨‹</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201022194219693.png" alt="image-20201022194219693"></p><blockquote><p>æœ€åˆä¸¤ç«¯çš„TCPè¿›ç¨‹éƒ½å¤„äºå…³é—­çŠ¶æ€</p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201022194350899.png" alt="image-20201022194350899"></p><blockquote><p>ä¸€å¼€å§‹ï¼ŒTCPæœåŠ¡å™¨è¿›ç¨‹é¦–å…ˆåˆ›å»ºä¼ è¾“æ§åˆ¶å—ï¼Œç”¨æ¥å­˜å‚¨TCPè¿æ¥ä¸­çš„ä¸€äº›é‡è¦ä¿¡æ¯ã€‚ä¾‹å¦‚TCPè¿æ¥è¡¨ã€æŒ‡å‘å‘é€å’Œæ¥æ”¶ç¼“å­˜çš„æŒ‡é’ˆã€æŒ‡å‘é‡ä¼ é˜Ÿåˆ—çš„æŒ‡é’ˆï¼Œå½“å‰çš„å‘é€å’Œæ¥æ”¶åºå·ç­‰</p><p>ä¹‹åï¼Œå°±å‡†å¤‡æ¥å—TCPå®¢æˆ·ç«¯è¿›ç¨‹çš„è¿æ¥è¯·æ±‚</p><p>æ­¤æ—¶ï¼ŒTCPæœåŠ¡å™¨è¿›ç¨‹å°±è¿›å…¥ç›‘å¬çŠ¶æ€ï¼Œç­‰å¾…TCPå®¢æˆ·ç«¯è¿›ç¨‹çš„è¿æ¥è¯·æ±‚</p></blockquote><p>TCPæœåŠ¡å™¨è¿›ç¨‹æ˜¯è¢«åŠ¨ç­‰å¾…æ¥è‡ªTCPå®¢æˆ·ç«¯è¿›ç¨‹çš„è¿æ¥è¯·æ±‚ï¼Œå› æ­¤æˆä¸º<strong>è¢«åŠ¨æ‰“å¼€</strong>è¿æ¥</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201022194926877.png" alt="image-20201022194926877"></p><blockquote><p>TCPå®¢æˆ·è¿›ç¨‹ä¹Ÿæ˜¯é¦–å…ˆåˆ›å»ºä¼ è¾“æ§åˆ¶å—</p></blockquote><p>ç”±äºTCPè¿æ¥å»ºç«‹æ˜¯ç”±TCPå®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·çš„ï¼Œå› æ­¤ç§°ä¸º<strong>ä¸»åŠ¨æ‰“å¼€</strong>è¿æ¥</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201022195108616.png" alt="image-20201022195108616"></p><blockquote><p>ç„¶åï¼Œåœ¨æ‰“ç®—å»ºç«‹TCPè¿æ¥æ—¶ï¼Œå‘TCPæœåŠ¡å™¨è¿›ç¨‹å‘é€TCPè¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µï¼Œå¹¶è¿›å…¥åŒæ­¥å·²å‘é€çŠ¶æ€</p><p>TCPè¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µé¦–éƒ¨ä¸­</p><ul><li>åŒæ­¥ä½SYNè¢«è®¾ç½®ä¸º1ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªTCPè¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µ</li><li>åºå·å­—æ®µseqè¢«è®¾ç½®äº†ä¸€ä¸ªåˆå§‹å€¼xï¼Œä½œä¸ºTCPå®¢æˆ·ç«¯è¿›ç¨‹æ‰€é€‰æ‹©çš„åˆå§‹åºå·</li></ul><p>è¯·æ³¨æ„ï¼šTCPè§„å®šSYNè¢«è®¾ç½®ä¸º1çš„æŠ¥æ–‡æ®µä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†è¦æ¶ˆè€—æ‰ä¸€ä¸ªåºå·</p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201022195847144.png" alt="image-20201022195847144"></p><blockquote><p>TCPæœåŠ¡å™¨è¿›ç¨‹æ”¶åˆ°TCPè¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µåï¼Œå¦‚æœåŒæ„å»ºç«‹è¿æ¥ï¼Œåˆ™å‘TCPå®¢æˆ·è¿›ç¨‹å‘é€TCPè¿æ¥è¯·æ±‚ç¡®è®¤æŠ¥æ–‡æ®µï¼Œå¹¶è¿›å…¥åŒæ­¥å·²æ¥æ”¶çŠ¶æ€</p><p>TCPè¿æ¥è¯·æ±‚ç¡®è®¤æŠ¥æ–‡æ®µé¦–éƒ¨ä¸­</p><ul><li>åŒæ­¥ä½SYNå’Œç¡®è®¤ä¸ºACKéƒ½è®¾ç½®ä¸º1ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªTCPè¿æ¥è¯·æ±‚ç¡®è®¤æŠ¥æ–‡æ®µ</li><li>åºå·å­—æ®µseqè¢«è®¾ç½®äº†ä¸€ä¸ªåˆå§‹å€¼yï¼Œä½œä¸ºTCPæœåŠ¡å™¨è¿›ç¨‹æ‰€é€‰æ‹©çš„åˆå§‹åºå·ï¼Œ</li><li>ç¡®è®¤å·å­—æ®µackçš„å€¼è¢«è®¾ç½®æˆäº†x+1ï¼Œè¿™æ˜¯å¯¹TCPå®¢æˆ·è¿›ç¨‹æ‰€é€‰æ‹©çš„åˆå§‹åºå·ï¼ˆseqï¼‰çš„ç¡®è®¤</li></ul><p>è¯·æ³¨æ„ï¼šè¿™ä¸ªæŠ¥æ–‡æ®µä¹Ÿä¸èƒ½æºå¸¦æ•°æ®ï¼Œå› ä¸ºå®ƒæ˜¯SYNè¢«è®¾ç½®ä¸º1çš„æŠ¥æ–‡æ®µï¼Œä½†åŒæ ·è¦æ¶ˆè€—æ‰ä¸€ä¸ªåºå·</p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201022202010182.png" alt="image-20201022202010182"></p><blockquote><p>TCPå®¢æˆ·è¿›ç¨‹æ”¶åˆ°TCPè¿æ¥è¯·æ±‚ç¡®è®¤æŠ¥æ–‡æ®µåï¼Œè¿˜è¦å‘TCPæœåŠ¡å™¨è¿›ç¨‹å‘é€ä¸€ä¸ªæ™®é€šçš„TCPç¡®è®¤æŠ¥æ–‡æ®µï¼Œå¹¶è¿›å…¥è¿æ¥å·²è¿æ¥çŠ¶æ€</p><p>æ™®é€šçš„TCPç¡®è®¤æŠ¥æ–‡æ®µé¦–éƒ¨ä¸­</p><ul><li>ç¡®è®¤ä½ACKè¢«è®¾ç½®ä¸º1ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„TCPç¡®è®¤æŠ¥æ–‡æ®µ</li><li>åºå·å­—æ®µseqè¢«è®¾ç½®ä¸ºx+1ï¼Œè¿™æ˜¯å› ä¸ºTCPå®¢æˆ·è¿›ç¨‹å‘é€çš„ç¬¬ä¸€ä¸ªTCPæŠ¥æ–‡æ®µçš„åºå·ä¸ºxï¼Œæ‰€ä»¥TCPå®¢æˆ·è¿›ç¨‹å‘é€çš„ç¬¬äºŒä¸ªæŠ¥æ–‡æ®µçš„åºå·ä¸ºx+1</li><li>ç¡®è®¤å·å­—æ®µackè¢«è®¾ç½®ä¸ºy+1ï¼Œè¿™æ˜¯å¯¹TCPæœåŠ¡å™¨è¿›ç¨‹æ‰€é€‰æ‹©çš„åˆå§‹åºå·çš„ç¡®è®¤</li></ul><p>è¯·æ³¨æ„ï¼šTCPè§„å®šæ™®é€šçš„TCPç¡®è®¤æŠ¥æ–‡æ®µå¯ä»¥æºå¸¦æ•°æ®ï¼Œä½†å¦‚æœä¸æºå¸¦æ•°æ®ï¼Œåˆ™ä¸æ¶ˆè€—åºå·</p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201022202932905.png" alt="image-20201022202932905"></p><blockquote><p>TCPæœåŠ¡å™¨è¿›ç¨‹æ”¶åˆ°è¯¥ç¡®è®¤æŠ¥æ–‡æ®µåä¹Ÿè¿›å…¥è¿æ¥å·²å»ºç«‹çŠ¶æ€</p><p>ç°åœ¨ï¼ŒTCPåŒæ–¹éƒ½è¿›å…¥äº†è¿æ¥å·²å»ºç«‹çŠ¶æ€ï¼Œå®ƒä»¬å¯ä»¥åŸºäºå·²å»ºç«‹å¥½çš„TCPè¿æ¥ï¼Œè¿›è¡Œå¯é çš„æ•°æ®ä¼ è¾“</p></blockquote><p>ä¸ºä»€ä¹ˆTCPå®¢æˆ·è¿›ç¨‹æœ€åè¿˜è¦å‘é€ä¸€ä¸ªæ™®é€šçš„TCPç¡®è®¤æŠ¥æ–‡æ®µï¼Ÿèƒ½å¦ä½¿ç”¨â€œä¸¤æŠ¥æ–‡æ¡æ‰‹â€å»ºç«‹è¿æ¥ï¼Ÿ</p><p>ä¸‹å›¾å®ä¾‹æ˜¯â€œä¸¤æŠ¥æ–‡æ¡æ‰‹â€</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201022203744174.png" alt="image-20201022203744174"></p><blockquote><p>ä¸ºäº†é˜²æ­¢å·²ç»å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µçªç„¶åˆä¼ åˆ°æœåŠ¡ç«¯ï¼Œå› è€Œäº§ç”Ÿé”™è¯¯â€ï¼Œè¿™ç§æƒ…å†µæ˜¯ï¼šä¸€ç«¯(client)Aå‘å‡ºå»çš„ç¬¬ä¸€ä¸ªè¿æ¥è¯·æ±‚æŠ¥æ–‡å¹¶æ²¡æœ‰&gt; ä¸¢å¤±ï¼Œè€Œæ˜¯å› ä¸ºæŸäº›æœªçŸ¥çš„åŸå› åœ¨æŸä¸ªç½‘ç»œèŠ‚ç‚¹ä¸Šå‘ç”Ÿæ»ç•™ï¼Œå¯¼è‡´å»¶è¿Ÿåˆ°è¿æ¥é‡Šæ”¾ä»¥åçš„æŸä¸ªæ—¶é—´æ‰åˆ°è¾¾å¦ä¸€ç«¯(server)Bã€‚æœ¬æ¥è¿™æ˜¯ä¸€ä¸ªæ—©å·²å¤±æ•ˆçš„æŠ¥æ–‡æ®µï¼Œä½†æ˜¯Bæ”¶åˆ°æ­¤å¤±æ•ˆçš„æŠ¥æ–‡ä¹‹åï¼Œä¼šè¯¯è®¤ä¸ºæ˜¯Aå†æ¬¡å‘å‡ºçš„ä¸€ä¸ªæ–°çš„è¿æ¥è¯·æ±‚ï¼Œäºæ˜¯Bç«¯å°±å‘Aåˆå‘å‡ºç¡®è®¤æŠ¥æ–‡ï¼Œè¡¨ç¤ºåŒæ„å»ºç«‹è¿æ¥ã€‚å¦‚æœä¸é‡‡ç”¨â€œä¸‰æ¬¡æ¡æ‰‹â€ï¼Œé‚£ä¹ˆåªè¦Bç«¯å‘å‡ºç¡®è®¤æŠ¥æ–‡å°±ä¼šè®¤ä¸ºæ–°çš„è¿æ¥å·²ç»å»ºç«‹äº†ï¼Œä½†æ˜¯Aç«¯å¹¶æ²¡æœ‰å‘å‡ºå»ºç«‹è¿æ¥çš„è¯·æ±‚ï¼Œå› æ­¤ä¸ä¼šå»å‘Bç«¯å‘é€æ•°æ®ï¼ŒBç«¯æ²¡æœ‰æ”¶åˆ°æ•°æ®å°±ä¼šä¸€ç›´ç­‰å¾…ï¼Œè¿™æ ·Bç«¯å°±ä¼šç™½ç™½æµªè´¹æ‰å¾ˆå¤šèµ„æºã€‚</p><p><mark>æ‰€ä»¥å¹¶ä¸<strong>å¤šä½™</strong>ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢å·²å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µçªç„¶åˆä¼ é€åˆ°äº†TCPæœåŠ¡å™¨ï¼Œå› è€Œå¯¼è‡´é”™è¯¯</mark></p></blockquote><h3 id="TCPçš„è¿æ¥é‡Šæ”¾"><a href="#TCPçš„è¿æ¥é‡Šæ”¾" class="headerlink" title="TCPçš„è¿æ¥é‡Šæ”¾"></a>TCPçš„è¿æ¥é‡Šæ”¾</h3><ul><li>TCP è¿æ¥çš„å»ºç«‹<strong>é‡‡ç”¨å®¢æˆ·æœåŠ¡å™¨æ–¹å¼</strong>ã€‚</li><li>ä¸»åŠ¨å‘èµ·è¿æ¥å»ºç«‹çš„åº”ç”¨è¿›ç¨‹å«åš<strong>TCPå®¢æˆ·</strong> (client)ã€‚</li><li>è¢«åŠ¨ç­‰å¾…è¿æ¥å»ºç«‹çš„åº”ç”¨è¿›ç¨‹å«åš<strong>TCPæœåŠ¡å™¨</strong> (server)ã€‚</li><li><strong>ä»»ä½•ä¸€æ–¹éƒ½å¯ä»¥åœ¨æ•°æ®ä¼ é€ç»“æŸåå‘å‡ºè¿æ¥é‡Šæ”¾çš„é€šçŸ¥</strong></li></ul><p>è¿‡ç¨‹</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201022205124204.png" alt="image-20201022205124204"></p><blockquote><p>ç°åœ¨TCPå®¢æˆ·è¿›ç¨‹å’ŒTCPæœåŠ¡å™¨è¿›ç¨‹éƒ½å¤„äºè¿æ¥å·²å»ºç«‹çŠ¶æ€</p><p>TCPå®¢æˆ·è¿›ç¨‹çš„åº”ç”¨è¿›ç¨‹é€šçŸ¥å…¶ä¸»åŠ¨å…³é—­TCPè¿æ¥</p><p>TCPå®¢æˆ·è¿›ç¨‹ä¼šå‘é€TCPè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µï¼Œå¹¶è¿›å…¥ç»ˆæ­¢ç­‰å¾…1çŠ¶æ€</p><p>TCPè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µé¦–éƒ¨ä¸­</p><ul><li>ç»ˆæ­¢ä½FINå’Œç¡®è®¤ä¸ºACKçš„å€¼éƒ½è¢«è®¾ç½®ä¸º1ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªTCPè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µï¼ŒåŒæ—¶ä¹Ÿå¯¹ä¹‹å‰æ”¶åˆ°çš„æŠ¥æ–‡æ®µè¿›è¡Œç¡®è®¤</li><li>åºå·seqå­—æ®µçš„å€¼è®¾ç½®ä¸ºuï¼Œå®ƒç­‰äºTCPå®¢æˆ·è¿›ç¨‹ä¹‹å‰å·²ä¼ é€è¿‡çš„æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·åŠ 1</li><li>ç¡®è®¤å·ackå­—æ®µçš„å€¼è®¾ç½®ä¸ºvï¼Œå®ƒç­‰äºTCPå®¢æˆ·è¿›ç¨‹ä¹‹å‰å·²æ”¶åˆ°çš„ã€æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·åŠ 1</li></ul><p>è¯·æ³¨æ„ï¼šTCPè§„å®šç»ˆæ­¢ä½FINç­‰äº1çš„æŠ¥æ–‡æ®µå³ä½¿ä¸æºå¸¦æ•°æ®ï¼Œä¹Ÿè¦æ¶ˆè€—æ‰ä¸€ä¸ªåºå·</p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201022210030419.png" alt="image-20201022210030419"></p><blockquote><p>TCPæœåŠ¡å™¨è¿›ç¨‹æ”¶åˆ°TCPè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µåï¼Œä¼šå‘é€ä¸€ä¸ªæ™®é€šçš„TCPç¡®è®¤æŠ¥æ–‡æ®µå¹¶è¿›å…¥å…³é—­ç­‰å¾…çŠ¶æ€</p><p>æ™®é€šçš„TCPç¡®è®¤æŠ¥æ–‡æ®µé¦–éƒ¨ä¸­</p><ul><li>ç¡®è®¤ä½ACKçš„å€¼è¢«è®¾ç½®ä¸º1ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„TCPç¡®è®¤æŠ¥æ–‡æ®µ</li><li>åºå·seqå­—æ®µçš„å€¼è®¾ç½®ä¸ºvï¼Œå®ƒç­‰äºTCPæœåŠ¡å™¨è¿›ç¨‹ä¹‹å‰å·²ä¼ é€è¿‡çš„æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·åŠ 1ï¼Œè¿™ä¹Ÿä¸ä¹‹å‰æ”¶åˆ°çš„TCPè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µä¸­çš„ç¡®è®¤å·åŒ¹é…</li><li>ç¡®è®¤å·ackå­—æ®µçš„å€¼è®¾ç½®ä¸ºu+1ï¼Œè¿™æ˜¯å¯¹TCPè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µçš„ç¡®è®¤</li></ul></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201022232158631.png" alt="image-20201022232158631"></p><blockquote><p>TCPæœåŠ¡å™¨è¿›ç¨‹åº”è¯¥é€šçŸ¥é«˜å±‚åº”ç”¨è¿›ç¨‹ï¼ŒTCPå®¢æˆ·è¿›ç¨‹è¦æ–­å¼€ä¸è‡ªå·±çš„TCPè¿æ¥</p><p>æ­¤æ—¶ï¼Œä»TCPå®¢æˆ·è¿›ç¨‹åˆ°TCPæœåŠ¡å™¨è¿›ç¨‹è¿™ä¸ªæ–¹å‘çš„è¿æ¥å°±é‡Šæ”¾äº†</p><p>è¿™æ—¶çš„TCPè¿æ¥å±äºåŠå…³é—­çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯TCPå®¢æˆ·è¿›ç¨‹å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†</p><p>ä½†å¦‚æœTCPæœåŠ¡å™¨è¿›ç¨‹è¿˜æœ‰æ•°æ®è¦å‘é€ï¼ŒTCPå®¢æˆ·è¿›ç¨‹ä»è¦æ¥æ”¶ï¼Œä¹Ÿå°±æ˜¯è¯´ä»TCPæœåŠ¡å™¨è¿›ç¨‹åˆ°TCPå®¢æˆ·è¿›ç¨‹è¿™ä¸ªæ–¹å‘çš„è¿æ¥å¹¶æœªå…³é—­</p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201022233050922.png" alt="image-20201022233050922"></p><blockquote><p>TCPå®¢æˆ·è¿›ç¨‹æ”¶åˆ°TCPç¡®è®¤æŠ¥æ–‡æ®µåå°±è¿›å…¥ç»ˆæ­¢ç­‰å¾…2çŠ¶æ€ï¼Œç­‰å¾…TCPæœåŠ¡å™¨è¿›ç¨‹å‘å‡ºçš„TCPè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µ</p><p>è‹¥ä½¿ç”¨TCPæœåŠ¡å™¨è¿›ç¨‹çš„åº”ç”¨è¿›ç¨‹å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œåº”ç”¨è¿›ç¨‹å°±é€šçŸ¥å…¶TCPæœåŠ¡å™¨è¿›ç¨‹é‡Šæ”¾è¿æ¥</p><p>ç”±äºTCPè¿æ¥é‡Šæ”¾æ˜¯ç”±TCPå®¢æˆ·è¿›ç¨‹ä¸»åŠ¨å‘èµ·çš„ï¼Œå› æ­¤TCPæœåŠ¡å™¨è¿›ç¨‹å¯¹TCPè¿æ¥çš„é‡Šæ”¾ç§°ä¸ºè¢«åŠ¨å…³é—­è¿æ¥</p></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201022233941557.png" alt="image-20201022233941557"></p><blockquote><p>TCPæœåŠ¡å™¨è¿›ç¨‹å‘é€TCPè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µå¹¶è¿›å…¥æœ€åç¡®è®¤çŠ¶æ€</p><p>è¯¥æŠ¥æ–‡æ®µé¦–éƒ¨ä¸­</p><ul><li>ç»ˆæ­¢ä½FINå’Œç¡®è®¤ä½ACKçš„å€¼éƒ½è¢«è®¾ç½®ä¸º1ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªTCPè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µï¼ŒåŒæ—¶ä¹Ÿå¯¹ä¹‹å‰æ”¶åˆ°çš„æŠ¥æ–‡æ®µè¿›è¡Œç¡®è®¤</li><li>åºå·seqå­—æ®µçš„å€¼ä¸ºwï¼Œè¿™æ˜¯å› ä¸ºåœ¨åŠå…³é—­çŠ¶æ€ä¸‹ï¼ŒTCPæœåŠ¡å™¨è¿›ç¨‹å¯èƒ½åˆå‘é€</li><li>ç¡®è®¤å·ackå­—æ®µçš„å€¼ä¸ºu+1ï¼Œè¿™æ˜¯å¯¹ä¹‹å‰æ”¶åˆ°çš„TCPè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µçš„é‡å¤ç¡®è®¤</li></ul></blockquote><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201022234741310.png" alt="image-20201022234741310"></p><blockquote><p>TCPå®¢æˆ·è¿›ç¨‹æ”¶åˆ°TCPè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µåï¼Œå¿…é¡»é’ˆå¯¹è¯¥æŠ¥æ–‡æ®µå‘é€æ™®é€šçš„TCPç¡®è®¤æŠ¥æ–‡æ®µï¼Œä¹‹åè¿›å…¥æ—¶é—´ç­‰å¾…çŠ¶æ€</p><p>è¯¥æŠ¥æ–‡æ®µé¦–éƒ¨ä¸­</p><ul><li>ç¡®è®¤ä¸ºACKçš„å€¼è¢«è®¾ç½®ä¸º1ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„TCPç¡®è®¤æŠ¥æ–‡æ®µ</li><li>åºå·seqå­—æ®µçš„å€¼è®¾ç½®ä¸ºu+1ï¼Œè¿™æ˜¯å› ä¸ºTCPå®¢æˆ·è¿›ç¨‹ä¹‹å‰å‘é€çš„TCPè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µè™½ç„¶ä¸æºå¸¦æ•°æ®ï¼Œä½†è¦æ¶ˆè€—æ‰ä¸€ä¸ªåºå·</li><li>ç¡®è®¤å·ackå­—æ®µçš„å€¼è®¾ç½®ä¸ºw+1ï¼Œè¿™æ˜¯å¯¹æ‰€æ”¶åˆ°çš„TCPè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µçš„ç¡®è®¤</li></ul><p>TCPæœåŠ¡å™¨è¿›ç¨‹æ”¶åˆ°è¯¥æŠ¥æ–‡æ®µåå°±è¿›å…¥å…³é—­çŠ¶æ€ï¼Œè€ŒTCPå®¢æˆ·è¿›ç¨‹è¿˜è¦è¿›è¿‡2MSLåæ‰èƒ½è¿›å…¥å…³é—­çŠ¶æ€</p></blockquote><p>TCPå®¢æˆ·è¿›ç¨‹åœ¨å‘é€å®Œæœ€åä¸€ä¸ªç¡®è®¤æŠ¥æ–‡åï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥è¿›å…¥å…³é—­çŠ¶æ€ï¼Ÿè€Œæ˜¯è¦è¿›å…¥æ—¶é—´ç­‰å¾…çŠ¶æ€ï¼Ÿ</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201022234942562.png" alt="image-20201022234942562"></p><blockquote><p>å› ä¸ºæ—¶é—´ç­‰å¾…çŠ¶æ€ä»¥åŠå¤„äºè¯¥çŠ¶æ€2MSLæ—¶é•¿ï¼Œå¯ä»¥ç¡®ä¿TCPæœåŠ¡å™¨è¿›ç¨‹å¯ä»¥æ”¶åˆ°æœ€åä¸€ä¸ªTCPç¡®è®¤æŠ¥æ–‡æ®µè€Œè¿›å…¥å…³é—­çŠ¶æ€</p><p>å¦å¤–ï¼ŒTCPå®¢æˆ·è¿›ç¨‹åœ¨å‘é€å®Œæœ€åä¸€ä¸ªTCPç¡®è®¤æŠ¥æ–‡æ®µåï¼Œåœ¨ç»è¿‡2MSLæ—¶é•¿ï¼Œå°±å¯ä»¥ä½¿æœ¬æ¬¡è¿æ¥æŒç»­æ—¶é—´å†…æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡æ®µéƒ½ä»ç½‘ç»œä¸­æ¶ˆå¤±ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ä¸‹ä¸€ä¸ªæ–°çš„TCPè¿æ¥ä¸­ï¼Œä¸ä¼šå‡ºç°æ—§è¿æ¥ä¸­çš„æŠ¥æ–‡æ®µ</p></blockquote><h3 id="TCPä¿æ´»è®¡æ—¶å™¨çš„ä½œç”¨"><a href="#TCPä¿æ´»è®¡æ—¶å™¨çš„ä½œç”¨" class="headerlink" title="TCPä¿æ´»è®¡æ—¶å™¨çš„ä½œç”¨"></a>TCPä¿æ´»è®¡æ—¶å™¨çš„ä½œç”¨</h3><p>TCPåŒæ–¹å·²ç»å»ºç«‹äº†è¿æ¥ï¼Œåæ¥ï¼ŒTCPå®¢æˆ·è¿›ç¨‹æ‰€åœ¨çš„ä¸»æœºçªç„¶å‡ºç°äº†æ•…éšœ</p><p>TCPæœåŠ¡å™¨è¿›ç¨‹ä»¥åå°±ä¸èƒ½å†æ”¶åˆ°TCPå®¢æˆ·è¿›ç¨‹å‘æ¥çš„æ•°æ®</p><p>å› æ­¤ï¼Œåº”å½“æœ‰æªæ–½ä½¿TCPæœåŠ¡å™¨è¿›ç¨‹ä¸è¦å†ç™½ç™½ç­‰å¾…ä¸‹å»</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201022235800155.png" alt="image-20201022235800155"></p><h2 id="é¦–éƒ¨æ ¼å¼"><a href="#é¦–éƒ¨æ ¼å¼" class="headerlink" title="é¦–éƒ¨æ ¼å¼"></a>é¦–éƒ¨æ ¼å¼</h2><h3 id="UDPç”¨æˆ·æ•°æ®æŠ¥çš„é¦–éƒ¨æ ¼å¼"><a href="#UDPç”¨æˆ·æ•°æ®æŠ¥çš„é¦–éƒ¨æ ¼å¼" class="headerlink" title="UDPç”¨æˆ·æ•°æ®æŠ¥çš„é¦–éƒ¨æ ¼å¼"></a>UDPç”¨æˆ·æ•°æ®æŠ¥çš„é¦–éƒ¨æ ¼å¼</h3><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201021205214512-170124400660329.png" alt="image-20201021205214512"></p><h3 id="TCPæŠ¥æ–‡æ®µçš„é¦–éƒ¨æ ¼å¼"><a href="#TCPæŠ¥æ–‡æ®µçš„é¦–éƒ¨æ ¼å¼" class="headerlink" title="TCPæŠ¥æ–‡æ®µçš„é¦–éƒ¨æ ¼å¼"></a>TCPæŠ¥æ–‡æ®µçš„é¦–éƒ¨æ ¼å¼</h3><p>æºç«¯å£å’Œç›®çš„ç«¯å£ï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201023005210010.png" alt="image-20201023005210010"></p><p>åºå·ã€ç¡®è®¤å·å’Œç¡®è®¤æ ‡å¿—ä½ï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201023003826059.png" alt="image-20201023003826059"></p><p>æ•°æ®åç§»ï¼ˆ<mark><strong>é¦–éƒ¨é•¿åº¦</strong></mark>ï¼‰ã€ä¿ç•™ã€çª—å£å’Œæ ¡éªŒå’Œï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201023004227265.png" alt="image-20201023004227265"></p><p>åŒæ­¥æ ‡å¿—ä½ã€ç»ˆæ­¢æ ‡å¿—ä½ã€å¤ä½æ ‡å¿—ä½ã€æ¨é€æ ‡å¿—ä½ã€ç´§æ€¥æ ‡å¿—ä½å’Œç´§æ€¥æŒ‡é’ˆï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201023005001450.png" alt="image-20201023005001450"></p><p>é€‰é¡¹å’Œå¡«å……ï¼š</p><p><img src="/../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20201023005132426.png" alt="image-20201023005132426"></p><h1 id="åº”ç”¨å±‚âœï¸"><a href="#åº”ç”¨å±‚âœï¸" class="headerlink" title="åº”ç”¨å±‚âœï¸"></a>åº”ç”¨å±‚âœï¸</h1><h2 id="æ¦‚è¿°-4"><a href="#æ¦‚è¿°-4" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h2 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h2><p><img src="/../assets/Study-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/6.jpg" alt="åŸŸåè§£æçš„å·¥ä½œæµç¨‹"></p>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 408 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBooté¢è¯•é¢˜</title>
      <link href="/2023/10/03/%E9%9D%A2%E8%AF%95-SpringBoot/"/>
      <url>/2023/10/03/%E9%9D%A2%E8%AF%95-SpringBoot/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>è‡ªåŠ¨è£…é…ï¼Ÿ</p><p>@SpringBootApplication</p><p>IOCï¼Ÿ</p><p>@Beanå’Œ@Import</p><p>ç¬¬ä¹é›†-Beanæ³¨å†Œ</p><p><a href="https://www.bilibili.com/video/BV14z4y1N7pg?p=9&spm_id_from=pageDriver&vd_source=fa7ba4ae353f08f1d08d1bb24528e96c">https://www.bilibili.com/video/BV14z4y1N7pg?p=9&amp;spm_id_from=pageDriver&amp;vd_source=fa7ba4ae353f08f1d08d1bb24528e96c</a></p><p>ç¬¬åé›†-æ³¨å†Œbeançš„æ¡ä»¶</p><p>æ€»ç»“ï¼š7~11é›†çœ‹çœ‹</p><p>è¿™ä¸ªè§†é¢‘é‡Œè¿˜æœ‰å‚æ•°æ ¡éªŒï¼ˆSpring Valicationï¼‰</p><p><img src="/../assets/SpringBoot/image-20231222154613637.png" alt="image-20231222154613637"></p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaé›†åˆ</title>
      <link href="/2023/09/05/Study-Java%E9%9B%86%E5%90%88/"/>
      <url>/2023/09/05/Study-Java%E9%9B%86%E5%90%88/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æœ¬ç¯‡æ–‡ç« å­¦ä¹ è‡ª<a href="https://www.bilibili.com/video/BV1YA411T76k/">ã€éŸ©é¡ºå¹³è®²Javaã€‘Javaé›†åˆä¸“é¢˜</a></p><h1 id="æ€»è§ˆ"><a href="#æ€»è§ˆ" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h1><p>Javaé›†åˆå­¦ä¹ æ€»è§ˆå›¾ï¼š</p><p><img src="/../assets/Java%E9%9B%86%E5%90%88/image-20230905215900101.png" alt="Javaé›†åˆå­¦ä¹ æ€»è§ˆå›¾"></p><h1 id="é›†åˆæ¡†æ¶ä½“ç³»"><a href="#é›†åˆæ¡†æ¶ä½“ç³»" class="headerlink" title="é›†åˆæ¡†æ¶ä½“ç³»"></a>é›†åˆæ¡†æ¶ä½“ç³»</h1><ol><li>å•åˆ—é›†åˆ</li></ol><p><img src="/../assets/Java%E9%9B%86%E5%90%88/image-20230905221342150.png" alt="å•åˆ—é›†åˆ"></p><ol start="2"><li>åŒåˆ—é›†åˆ</li></ol><p><img src="/../assets/Java%E9%9B%86%E5%90%88/image-20230905221800749.png" alt="åŒåˆ—é›†åˆ"></p><h1 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h1><h2 id="Colectionæ¥å£å¸¸ç”¨æ–¹æ³•"><a href="#Colectionæ¥å£å¸¸ç”¨æ–¹æ³•" class="headerlink" title="Colectionæ¥å£å¸¸ç”¨æ–¹æ³•"></a>Colectionæ¥å£å¸¸ç”¨æ–¹æ³•</h2><ol><li>add:æ·»åŠ å•ä¸ªå…ƒç´ </li><li>remove:åˆ é™¤æŒ‡å®šå…ƒç´ </li><li>contains:æŸ¥æ‰¾å…ƒç´ æ˜¯å¦å­˜åœ¨</li><li>size:è·å–å…ƒç´ ä¸ªæ•°</li><li>isEmpty:åˆ¤æ–­æ˜¯å¦ä¸ºç©º</li><li>clear:æ¸…ç©º</li><li>addAIl:æ·»åŠ å¤šä¸ªå…ƒç´ </li><li>containsAll:æŸ¥æ‰¾å¤šä¸ªå…ƒç´ æ˜¯å¦éƒ½å­˜åœ¨</li><li>removeAll: åˆ é™¤å¤šä¸ªå…ƒç´ </li></ol><h2 id="éå†æ–¹å¼"><a href="#éå†æ–¹å¼" class="headerlink" title="éå†æ–¹å¼"></a>éå†æ–¹å¼</h2><ol><li>è¿­ä»£å™¨ï¼šiteratorï¼Œéå†å®Œè¿˜æƒ³éå†è¦é‡ç½®è¿­ä»£å™¨ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸</li><li>é›†åˆçš„å¢å¼ºforï¼šåº•å±‚åŸç†è¿˜æ˜¯è¿­ä»£å™¨</li></ol><blockquote><p>å…³äºJVMå­¦ä¹ åçš„è¡¥å……ï¼š</p><ul><li><p>å¯¹äºé›†åˆçš„å¢å¼ºforçš„åº•å±‚å®ç°ï¼Œé€šè¿‡ç¼–è¯‘æœŸå¾—åˆ°çš„å­—èŠ‚ç æ–‡ä»¶å¾—çŸ¥æ˜¯ä½¿ç”¨çš„è¿­ä»£å™¨ï¼›</p></li><li><p>ä½†æ˜¯å¯¹äºæ™®é€šæ•°ç»„çš„å¢å¼ºforï¼Œä»–çš„åº•å±‚å®ç°å…¶å®æ˜¯æœ€æ™®é€šçš„å¸¦ç´¢å¼•çš„forå¾ªç¯ï¼›</p></li><li><p>æ‰€ä»¥ä¸èƒ½è¯´å¢å¼ºforçš„åº•å±‚æ˜¯è¿­ä»£å™¨ï¼Œæ˜¯è¦åˆ†æƒ…å†µçš„ã€‚</p></li></ul></blockquote><h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><h3 id="Listæ¥å£åŸºæœ¬ä»‹ç»"><a href="#Listæ¥å£åŸºæœ¬ä»‹ç»" class="headerlink" title="Listæ¥å£åŸºæœ¬ä»‹ç»"></a>Listæ¥å£åŸºæœ¬ä»‹ç»</h3><p>List æ¥å£æ˜¯ Collection æ¥å£çš„å­æ¥å£ </p><ol><li><p>List .javaListé›†åˆç±»ä¸­å…ƒç´ æœ‰åº(å³æ·»åŠ é¡ºåºå’Œå–å‡ºé¡ºåºä¸€è‡´)ã€ä¸”å¯é‡å¤[æ¡ˆä¾‹]</p></li><li><p>Listé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æœ‰å…¶å¯¹åº”çš„é¡ºåºç´¢å¼•ï¼Œå³æ”¯æŒç´¢å¼•ã€‚</p></li><li><p>Listå®¹å™¨ä¸­çš„å…ƒç´ éƒ½å¯¹åº”ä¸€ä¸ªæ•´æ•°å‹çš„åºå·è®°è½½å…¶åœ¨å®¹å™¨ä¸­çš„ä½ç½®ï¼Œå¯ä»¥æ ¹æ®åºå·å­˜å–å®¹å™¨ä¸­çš„å…ƒç´ </p></li></ol><h3 id="Listæ¥å£å¸¸ç”¨æ–¹æ³•"><a href="#Listæ¥å£å¸¸ç”¨æ–¹æ³•" class="headerlink" title="Listæ¥å£å¸¸ç”¨æ–¹æ³•"></a>Listæ¥å£å¸¸ç”¨æ–¹æ³•</h3><ol><li>void add(int index, Object ele):åœ¨indexä½ç½®æ’å…¥eleå…ƒç´ </li><li>boolean addAll(int index, Collection eles):ä»indexä½ç½®å¼€å§‹å°†elesä¸­çš„æ‰€æœ‰å…ƒç´ æ·»åŠ è¿›æ¥</li><li>Object get(int index):è·å–æŒ‡å®šindexä½ç½®çš„å…ƒç´ </li><li>int indexOf(Object obi):è¿”å›obiåœ¨é›†åˆä¸­é¦–æ¬¡å‡ºç°çš„ä½ç½®</li><li>int lastlndexof(Object obj):è¿”å›objåœ¨å½“å‰é›†åˆä¸­æœ«æ¬¡å‡ºç°çš„ä½ç½®</li><li>Object remove(int index):ç§»é™¤æŒ‡å®šindexä½ç½®çš„å…ƒç´ ï¼Œå¹¶è¿”å›æ­¤å…ƒç´ </li><li>Object set(int index, Object ele):è®¾ç½®æŒ‡å®šindexä½ç½®çš„å…ƒç´ ä¸ºeleç›¸å½“äºæ˜¯æ›¿æ¢</li><li>List subList(int fromlndex, int tolndex):è¿”å›ä»fromIndexåˆ°tolndexä½ç½®çš„å­é›†åˆ</li></ol><h3 id="ArrayListæºç åˆ†æâ­â­â­"><a href="#ArrayListæºç åˆ†æâ­â­â­" class="headerlink" title="ArrayListæºç åˆ†æâ­â­â­"></a>ArrayListæºç åˆ†æâ­â­â­</h3><ol><li>ArrayListä¸­ç»´æŠ¤äº†ä¸€ä¸ªObjectç±»å‹çš„<strong>æ•°ç»„</strong>elementData<br><strong>transient</strong> Objectll elementData:</li></ol><blockquote><p>transientï¼šè¢«è¯¥å…³é”®å­—ä¿®é¥°çš„å¯¹è±¡ç­‰ï¼Œè¡¨ç¤ºè¯¥å±æ€§<strong>ä¸ä¼šè¢«åºåˆ—åŒ–</strong></p></blockquote><ol><li>å½“åˆ›å»ºArrayListå¯¹è±¡æ—¶ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯æ— å‚æ„é€ å™¨ï¼Œåˆ™åˆå§‹elementDataå®¹é‡ä¸º0ï¼Œç¬¬1æ¬¡æ·»åŠ ï¼Œåˆ™æ‰©å®¹elementDataä¸º10ï¼Œå¦‚éœ€è¦å†æ¬¡æ‰©å®¹ï¼Œåˆ™æ‰©å®¹elementDataä¸º1.5å€ã€‚</li></ol><p><img src="/../assets/Java%E9%9B%86%E5%90%88/image-20230906150045877.png" alt="ä¸‰ç§æ„é€ å™¨"></p><ol start="3"><li>å¦‚æœä½¿ç”¨çš„æ˜¯æŒ‡å®šå¤§å°çš„æ„é€ å™¨ï¼Œåˆ™åˆå§‹elementDataå®¹é‡ä¸ºæŒ‡å®šå¤§å°ï¼Œå¦‚æœéœ€è¦æ‰©å®¹åˆ™ç›´æ¥æ‰©å®¹elementDataä¸º1.5å€</li></ol><h3 id="Vector"><a href="#Vector" class="headerlink" title="Vector"></a>Vector</h3><ul><li><p>Vectoråº•å±‚ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼Œprotected Objectp[ ] elementData;</p></li><li><p>Vectoræ˜¯çº¿ç¨‹åŒæ­¥çš„ï¼Œå³çº¿ç¨‹å®‰å…¨ï¼ŒVectorç±»çš„æ“ä½œæ–¹æ³•å¸¦æœ‰<strong>synchronized</strong></p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(index &gt;= elementCount)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ArrayIndexOutBoundsException</span>(index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> elementData(index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åœ¨å¼€å‘ä¸­ï¼Œéœ€è¦çº¿ç¨‹åŒæ­¥å®‰å…¨æ—¶ï¼Œè€ƒè™‘ä½¿ç”¨Vector</li></ul><blockquote><p>ArrayListæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œæ²¡æœ‰åŠ synchronizedï¼Œåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ä¸å»ºè®®ä½¿ç”¨ArrayListï¼Œè€Œæ˜¯ä½¿ç”¨Vector</p></blockquote><table><thead><tr><th>ç±»å‹</th><th>åº•å±‚ç»“æ„</th><th>çº¿ç¨‹å®‰å…¨ï¼ˆåŒæ­¥ï¼‰ æ•ˆç‡</th><th>æ‰©å®¹å€æ•°</th></tr></thead><tbody><tr><td>ArrayList</td><td>å¯å˜æ•°ç»„</td><td>ä¸å®‰å…¨ï¼Œæ•ˆç‡é«˜</td><td>æ— å‚é»˜è®¤0ä¸ªï¼Œç¬¬ä¸€æ¬¡æ‰©å®¹10ä¸ªï¼Œåç»­1.5å€æ‰©</td></tr><tr><td>Vector</td><td>å¯å˜æ•°ç»„</td><td>å®‰å…¨ï¼Œæ•ˆç‡ä¸é«˜</td><td>æ— å‚é»˜è®¤10ä¸ªï¼Œåç»­2å€æ‰©</td></tr></tbody></table><h3 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h3><ul><li>LinkedListåº•å±‚å®ç°äº†<strong>åŒå‘é“¾è¡¨</strong>å’Œ<strong>åŒç«¯é˜Ÿåˆ—</strong>ç‰¹ç‚¹</li><li>å¯ä»¥æ·»åŠ ä»»æ„å…ƒç´ (å…ƒç´ å¯ä»¥é‡å¤)ï¼ŒåŒ…æ‹¬null</li><li><strong>çº¿ç¨‹ä¸å®‰å…¨</strong>ï¼Œæ²¡æœ‰å®ç°åŒæ­¥</li></ul><h4 id="LinkedList-ä¸ºä»€ä¹ˆä¸èƒ½å®ç°-RandomAccess-æ¥å£"><a href="#LinkedList-ä¸ºä»€ä¹ˆä¸èƒ½å®ç°-RandomAccess-æ¥å£" class="headerlink" title="LinkedList ä¸ºä»€ä¹ˆä¸èƒ½å®ç° RandomAccess æ¥å£"></a>LinkedList ä¸ºä»€ä¹ˆä¸èƒ½å®ç° RandomAccess æ¥å£</h4><p><code>RandomAccess</code> æ˜¯ä¸€ä¸ªæ ‡è®°æ¥å£ï¼Œç”¨æ¥è¡¨æ˜å®ç°è¯¥æ¥å£çš„ç±»æ”¯æŒéšæœºè®¿é—®ï¼ˆå³å¯ä»¥é€šè¿‡ç´¢å¼•å¿«é€Ÿè®¿é—®å…ƒç´ ï¼‰ã€‚ç”±äº <code>LinkedList</code> åº•å±‚æ•°æ®ç»“æ„æ˜¯é“¾è¡¨ï¼Œå†…å­˜åœ°å€ä¸è¿ç»­ï¼Œåªèƒ½é€šè¿‡æŒ‡é’ˆæ¥å®šä½ï¼Œä¸æ”¯æŒéšæœºå¿«é€Ÿè®¿é—®ï¼Œæ‰€ä»¥ä¸èƒ½å®ç° <code>RandomAccess</code> æ¥å£ã€‚</p><h3 id="CopyOnWriteArrayList"><a href="#CopyOnWriteArrayList" class="headerlink" title="CopyOnWriteArrayList"></a>CopyOnWriteArrayList</h3><p>çº¿ç¨‹å®‰å…¨ <code>List</code> å®ç°å°±æ˜¯ <code>CopyOnWriteArrayList</code> </p><h4 id="CopyOnWriteArrayList-åˆ°åº•æœ‰ä»€ä¹ˆå‰å®³ä¹‹å¤„ï¼Ÿ"><a href="#CopyOnWriteArrayList-åˆ°åº•æœ‰ä»€ä¹ˆå‰å®³ä¹‹å¤„ï¼Ÿ" class="headerlink" title="CopyOnWriteArrayList åˆ°åº•æœ‰ä»€ä¹ˆå‰å®³ä¹‹å¤„ï¼Ÿ"></a>CopyOnWriteArrayList åˆ°åº•æœ‰ä»€ä¹ˆå‰å®³ä¹‹å¤„ï¼Ÿ</h4><p>å¯¹äºå¤§éƒ¨åˆ†ä¸šåŠ¡åœºæ™¯æ¥è¯´ï¼Œè¯»å–æ“ä½œå¾€å¾€æ˜¯è¿œå¤§äºå†™å…¥æ“ä½œçš„ã€‚ç”±äºè¯»å–æ“ä½œä¸ä¼šå¯¹åŸæœ‰æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œå› æ­¤ï¼Œå¯¹äºæ¯æ¬¡è¯»å–éƒ½è¿›è¡ŒåŠ é”å…¶å®æ˜¯ä¸€ç§èµ„æºæµªè´¹ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—® <code>List</code> çš„å†…éƒ¨æ•°æ®ï¼Œæ¯•ç«Ÿå¯¹äºè¯»å–æ“ä½œæ¥è¯´æ˜¯å®‰å…¨çš„ã€‚</p><p>è¿™ç§æ€è·¯ä¸ <code>ReentrantReadWriteLock</code> è¯»å†™é”çš„è®¾è®¡æ€æƒ³éå¸¸ç±»ä¼¼ï¼Œå³è¯»è¯»ä¸äº’æ–¥ã€è¯»å†™äº’æ–¥ã€å†™å†™äº’æ–¥ï¼ˆåªæœ‰è¯»è¯»ä¸äº’æ–¥ï¼‰ã€‚<code>CopyOnWriteArrayList</code> æ›´è¿›ä¸€æ­¥åœ°å®ç°äº†è¿™ä¸€æ€æƒ³ã€‚ä¸ºäº†å°†è¯»æ“ä½œæ€§èƒ½å‘æŒ¥åˆ°æè‡´ï¼Œ<code>CopyOnWriteArrayList</code> ä¸­çš„è¯»å–æ“ä½œæ˜¯å®Œå…¨æ— éœ€åŠ é”çš„ã€‚æ›´åŠ å‰å®³çš„æ˜¯ï¼Œå†™å…¥æ“ä½œä¹Ÿä¸ä¼šé˜»å¡è¯»å–æ“ä½œï¼Œåªæœ‰å†™å†™æ‰ä¼šäº’æ–¥ã€‚è¿™æ ·ä¸€æ¥ï¼Œè¯»æ“ä½œçš„æ€§èƒ½å°±å¯ä»¥å¤§å¹…åº¦æå‡ã€‚</p><p><code>CopyOnWriteArrayList</code> çº¿ç¨‹å®‰å…¨çš„æ ¸å¿ƒåœ¨äºå…¶é‡‡ç”¨äº† <strong>å†™æ—¶å¤åˆ¶ï¼ˆCopy-On-Writeï¼‰</strong> çš„ç­–ç•¥ï¼Œä» <code>CopyOnWriteArrayList</code> çš„åå­—å°±èƒ½çœ‹å‡ºäº†ã€‚</p><h4 id="Copy-On-Write-çš„æ€æƒ³æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Copy-On-Write-çš„æ€æƒ³æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Copy-On-Write çš„æ€æƒ³æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Copy-On-Write çš„æ€æƒ³æ˜¯ä»€ä¹ˆï¼Ÿ</h4><blockquote><p>å†™å…¥æ—¶å¤åˆ¶ï¼ˆè‹±è¯­ï¼šCopy-on-writeï¼Œç®€ç§° COWï¼‰æ˜¯ä¸€ç§è®¡ç®—æœºç¨‹åºè®¾è®¡é¢†åŸŸçš„ä¼˜åŒ–ç­–ç•¥ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå¦‚æœæœ‰å¤šä¸ªè°ƒç”¨è€…ï¼ˆcallersï¼‰åŒæ—¶è¯·æ±‚ç›¸åŒèµ„æºï¼ˆå¦‚å†…å­˜æˆ–ç£ç›˜ä¸Šçš„æ•°æ®å­˜å‚¨ï¼‰ï¼Œä»–ä»¬ä¼šå…±åŒè·å–ç›¸åŒçš„æŒ‡é’ˆæŒ‡å‘ç›¸åŒçš„èµ„æºï¼Œç›´åˆ°æŸä¸ªè°ƒç”¨è€…è¯•å›¾ä¿®æ”¹èµ„æºçš„å†…å®¹æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šçœŸæ­£å¤åˆ¶ä¸€ä»½ä¸“ç”¨å‰¯æœ¬ï¼ˆprivate copyï¼‰ç»™è¯¥è°ƒç”¨è€…ï¼Œè€Œå…¶ä»–è°ƒç”¨è€…æ‰€è§åˆ°çš„æœ€åˆçš„èµ„æºä»ç„¶ä¿æŒä¸å˜ã€‚è¿™è¿‡ç¨‹å¯¹å…¶ä»–çš„è°ƒç”¨è€…éƒ½æ˜¯é€æ˜çš„ã€‚æ­¤ä½œæ³•ä¸»è¦çš„ä¼˜ç‚¹æ˜¯å¦‚æœè°ƒç”¨è€…æ²¡æœ‰ä¿®æ”¹è¯¥èµ„æºï¼Œå°±ä¸ä¼šæœ‰å‰¯æœ¬ï¼ˆprivate copyï¼‰è¢«åˆ›å»ºï¼Œå› æ­¤å¤šä¸ªè°ƒç”¨è€…åªæ˜¯è¯»å–æ“ä½œæ—¶å¯ä»¥å…±äº«åŒä¸€ä»½èµ„æºã€‚</p></blockquote><p>è¿™é‡Œå†ä»¥ <code>CopyOnWriteArrayList</code>ä¸ºä¾‹ä»‹ç»ï¼šå½“éœ€è¦ä¿®æ”¹ï¼ˆ <code>add</code>ï¼Œ<code>set</code>ã€<code>remove</code> ç­‰æ“ä½œï¼‰ <code>CopyOnWriteArrayList</code> çš„å†…å®¹æ—¶ï¼Œä¸ä¼šç›´æ¥ä¿®æ”¹åŸæ•°ç»„ï¼Œè€Œæ˜¯ä¼šå…ˆåˆ›å»ºåº•å±‚æ•°ç»„çš„å‰¯æœ¬ï¼Œå¯¹å‰¯æœ¬æ•°ç»„è¿›è¡Œä¿®æ”¹ï¼Œä¿®æ”¹å®Œä¹‹åå†å°†ä¿®æ”¹åçš„æ•°ç»„èµ‹å€¼å›å»ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯å†™æ“ä½œä¸ä¼šå½±å“è¯»æ“ä½œäº†ã€‚</p><h4 id="addæ–¹æ³•"><a href="#addæ–¹æ³•" class="headerlink" title="addæ–¹æ³•"></a>addæ–¹æ³•</h4><ul><li><code>add</code>æ–¹æ³•å†…éƒ¨ç”¨åˆ°äº†<mark> ReentrantLock</mark>åŠ é”ï¼Œä¿è¯äº†åŒæ­¥ï¼Œé¿å…äº†å¤šçº¿ç¨‹å†™çš„æ—¶å€™ä¼šå¤åˆ¶å‡ºå¤šä¸ªå‰¯æœ¬å‡ºæ¥ã€‚é”è¢«ä¿®é¥°ä¿è¯äº†é”çš„å†…å­˜åœ°å€è‚¯å®šä¸ä¼šè¢«ä¿®æ”¹ï¼Œå¹¶ä¸”ï¼Œé‡Šæ”¾é”çš„é€»è¾‘æ”¾åœ¨ <code>finally</code> ä¸­ï¼Œå¯ä»¥ä¿è¯é”èƒ½è¢«é‡Šæ”¾ã€‚</li><li><code>CopyOnWriteArrayList</code> é€šè¿‡å¤åˆ¶åº•å±‚æ•°ç»„çš„æ–¹å¼å®ç°å†™æ“ä½œï¼Œå³å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„æ¥å®¹çº³æ–°æ·»åŠ çš„å…ƒç´ ï¼Œç„¶ååœ¨æ–°æ•°ç»„ä¸­è¿›è¡Œå†™æ“ä½œï¼Œæœ€åå°†æ–°æ•°ç»„èµ‹å€¼ç»™åº•å±‚æ•°ç»„çš„å¼•ç”¨ï¼Œæ›¿æ¢æ‰æ—§çš„æ•°ç»„ã€‚è¿™ä¹Ÿå°±è¯æ˜äº†æˆ‘ä»¬å‰é¢è¯´çš„ï¼š<code>CopyOnWriteArrayList</code> çº¿ç¨‹å®‰å…¨çš„æ ¸å¿ƒåœ¨äºå…¶é‡‡ç”¨äº† <strong>å†™æ—¶å¤åˆ¶ï¼ˆCopy-On-Writeï¼‰</strong> çš„ç­–ç•¥ã€‚</li><li>æ¯æ¬¡å†™æ“ä½œéƒ½éœ€è¦é€šè¿‡ <code>Arrays.copyOf</code> å¤åˆ¶åº•å±‚æ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(n) çš„ï¼Œä¸”ä¼šå ç”¨é¢å¤–çš„å†…å­˜ç©ºé—´ã€‚å› æ­¤ï¼Œ<code>CopyOnWriteArrayList</code> é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œåœ¨å†™æ“ä½œä¸é¢‘ç¹ä¸”å†…å­˜èµ„æºå……è¶³çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æå‡ç³»ç»Ÿçš„æ€§èƒ½è¡¨ç°ã€‚</li></ul><h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><h3 id="Setæ¥å£åŸºæœ¬ä»‹ç»"><a href="#Setæ¥å£åŸºæœ¬ä»‹ç»" class="headerlink" title="Setæ¥å£åŸºæœ¬ä»‹ç»"></a>Setæ¥å£åŸºæœ¬ä»‹ç»</h3><ul><li><p>æ— åº (æ·»åŠ å’Œå–å‡ºçš„é¡ºåºä¸ä¸€è‡´)ï¼Œæ²¡æœ‰ç´¢å¼•</p></li><li><p>ä¸å…è®¸é‡å¤æ— ç´ ï¼Œæ‰€ä»¥æœ€å¤šåŒ…å«ä¸€ä¸ªnull</p></li></ul><blockquote><p>æ³¨æ„ï¼šè™½ç„¶å–å‡ºå…ƒç´ æ—¶æ˜¯æ— åºçš„ï¼Œä½†æ¯æ¬¡å–å‡ºå´éƒ½æ˜¯å›ºå®šçš„ã€‚</p></blockquote><h3 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h3><p>HashSetåº•å±‚å…¶å®å°±æ˜¯HashMapï¼Œè€ŒHashMapåº•å±‚åˆæ˜¯<strong>é‚»æ¥é“¾è¡¨</strong>ï¼Œå½“æ•ˆç‡ä¸å¤Ÿæ—¶ä¼šå˜ä¸º<strong>çº¢é»‘æ ‘</strong></p><p>æ„é€ å™¨æºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">HashSet</span><span class="params">()</span> &#123;</span><br><span class="line">    map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>HashSetä¸ä¿è¯å…ƒç´ æ˜¯æœ‰åºçš„ï¼Œå–å†³äºhashåï¼Œå†ç¡®å®šç´¢å¼•çš„ç»“æœ</p></blockquote><h4 id="æ€»ä½“ç»“è®º"><a href="#æ€»ä½“ç»“è®º" class="headerlink" title="æ€»ä½“ç»“è®º"></a>æ€»ä½“ç»“è®º</h4><ol><li>æ·»åŠ ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå…ˆå¾—åˆ°hashå€¼ï¼Œä¼šè½¬æˆç´¢å¼•å€¼</li><li>æ‰¾åˆ°å­˜å‚¨æ•°æ®è¡¨tableï¼Œçœ‹è¿™ä¸ªç´¢å¼•ä½ç½®æ˜¯å¦å·²ç»å­˜æ”¾çš„æœ‰å…ƒç´ </li><li>å¦‚æœæ²¡æœ‰ï¼Œç›´æ¥åŠ å…¥</li><li>å¦‚æœæœ‰ï¼Œè°ƒç”¨ equals æ¯”è¾ƒï¼Œå¦‚æœç›¸åŒï¼Œå°±æ”¾å¼ƒæ·»åŠ ï¼Œå¦‚æœä¸ç›¸åŒï¼Œåˆ™æ·»åŠ åˆ°æœ€å</li><li>åœ¨Java8ä¸­,å¦‚æœä¸€æ¡é“¾è¡¨çš„å…ƒç´ ä¸ªæ•°åˆ°è¾¾<code>TREEIFY THRESHOLD</code>(é»˜è®¤æ˜¯ 8)ï¼Œå¹¶ä¸”tableçš„å¤§å° &gt;&#x3D;<code>MIN TREEIFY CAPACITY</code>(é»˜è®¤64)å°±ä¼šè¿›è¡Œæ ‘åŒ–(çº¢é»‘æ ‘)</li></ol><p><img src="/../assets/Java%E9%9B%86%E5%90%88/image-20230907160829758.png" alt="image-20230907160829758"></p><hr><p><img src="/../assets/Java%E9%9B%86%E5%90%88/image-20230907225342640.png" alt="image-20230907225342640"></p><h4 id="æºç è¯¦ç»†è§£é‡Šï¼šâ­â­â­â­â­"><a href="#æºç è¯¦ç»†è§£é‡Šï¼šâ­â­â­â­â­" class="headerlink" title="æºç è¯¦ç»†è§£é‡Šï¼šâ­â­â­â­â­"></a>æºç è¯¦ç»†è§£é‡Šï¼šâ­â­â­â­â­</h4><ol><li><p>HashSetåº•å±‚å°±æ˜¯HashMapï¼Œæ‰€ä»¥ä¼šä»¥å€¼ä¸ºkeyï¼Œç„¶åä¸€ä¸ªé€šç”¨çš„å ä½ç¬¦ä¸ºvalueè¿›è¡Œè°ƒç”¨mapçš„putæ–¹æ³•</p></li><li><p>åœ¨putæ–¹æ³•è°ƒç”¨åè¿›å…¥putVauleæ–¹æ³•ä¸­</p></li><li><p>åœ¨è¯¥æ–¹æ³•ä¸­æ ¹æ®keyå¾—åˆ°çš„hashå€¼å¹¶ä¸æ˜¯æœ€ç»ˆç»“æœï¼Œè¿˜è¦ç»è¿‡è®¡ç®—å¾—åˆ°ä¸€ä¸ªhçš„å¸¸é‡ï¼Œæœ€ç»ˆå†é€šè¿‡hæ¥åˆ¤æ–­å‡ºç´¢å¼•ä½</p></li><li><p>ç„¶åå…ˆå¯¹å­˜æ”¾åœ¨æ•°ç»„ä¸­çš„å…ƒç´ è¿›è¡Œç­‰å€¼åˆ¤æ–­ï¼Œè‹¥è¯¥å¤„æ²¡å…ƒç´ åˆ™ç›´æ¥å­˜å…¥ï¼Œè‹¥å­˜åœ¨ä¸”ç›¸åŒåˆ™é€€å‡º</p></li><li><p>ç¬¬äºŒä¸ªifå°±æ˜¯å¦‚æœæ•°ç»„ä¸­å­˜æ”¾çš„æ˜¯çº¢é»‘æ ‘ï¼Œåˆ™è¿›è¡Œçº¢é»‘æ ‘çš„æ·»åŠ </p></li><li><p>ç¬¬ä¸‰ç§æƒ…å†µå°±æ˜¯æ•°ç»„ä¸­å­˜æ”¾çš„æ˜¯é“¾è¡¨ï¼Œé‚£ä¹ˆå°†è¿›å…¥forå¾ªç¯ä¾æ¬¡å¯¹æ¯”å„ä¸ªå…ƒç´ ï¼Œè¦ä¹ˆé“¾è¡¨ä¸­å…¨éƒ¨å…ƒç´ éƒ½ä¸ç›¸åŒåˆ™æ’åˆ°é“¾è¡¨æœ«å°¾ï¼Œå¦‚æœç¢°åˆ°æœ‰ä¸€ä¸ªç›¸åŒçš„å°±ç›´æ¥é€€å‡º</p></li><li><p>åœ¨æœ«å°¾æ·»åŠ æ—¶ä¼šç»Ÿè®¡è¯¥é“¾è¡¨çš„é•¿åº¦ï¼Œè‹¥åˆ°è¾¾8åˆ™ä¼šè€ƒè™‘æ ‘åŒ–ï¼Œæ ‘åŒ–çš„æ¡ä»¶ä¸ä»…æ˜¯é“¾è¡¨é•¿åº¦åˆ°è¾¾8ï¼Œè€Œä¸”è¡¨é•¿åº¦è¦åˆ°è¾¾64</p></li></ol><hr><p><strong>çœ‹æºç å†™æ³¨é‡Šç†è§£ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> V <span class="title function_">putVal</span><span class="params">(<span class="type">int</span> hash, K key, V value, <span class="type">boolean</span> onlyIfAbsent,</span></span><br><span class="line"><span class="params">                   <span class="type">boolean</span> evict)</span> &#123;</span><br><span class="line">        <span class="comment">//è¿™é‡Œéƒ½æ˜¯å®šä¹‰ä¸€äº›éœ€è¦çš„å˜é‡</span></span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="type">int</span> n, i;</span><br><span class="line">        <span class="comment">//å¦‚æœæ•°ç»„ï¼ˆtableï¼‰ä¸ºç©ºï¼Œå°±å»è°ƒç”¨resizeæ‰©å®¹æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> ((tab = table) == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">            n = (tab = resize()).length;</span><br><span class="line">        <span class="comment">//å¦‚æœå¾—åˆ°çš„ç´¢å¼•å€¼å¤„çš„ä½ç½®ä¸ºç©ºï¼Œåˆ™ç›´æ¥å°†Nodeç»“ç‚¹å­˜å…¥è¯¥å¤„</span></span><br><span class="line">        <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="literal">null</span>)</span><br><span class="line">            tab[i] = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            Node&lt;K,V&gt; e; K k;</span><br><span class="line">            <span class="comment">//å¦åˆ™ç¬¬ä¸€ç§æƒ…å†µï¼šå¦‚æœæ­¤æ—¶hashå€¼ç›¸åŒä¸”equalæ¯”è¾ƒåç›¸åŒï¼Œé‚£ä¹ˆå°±ä¼šæ›¿æ¢valueå€¼</span></span><br><span class="line">            <span class="comment">//åœ¨HashMapä¸­æ˜¯æ›¿æ¢valueå€¼ï¼Œåœ¨HashSetä¸­ä¹Ÿæ˜¯æ›¿æ¢valueå€¼ï¼Œåªä¸è¿‡å€¼ç›¸åŒè€Œå·²</span></span><br><span class="line">            <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">                ((k = p.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                e = p;</span><br><span class="line">            <span class="comment">//ç¬¬äºŒç§æƒ…å†µï¼šå‘ç°æ•°ç»„ä¸­å­˜æ”¾çš„çº¢é»‘æ ‘ç»“æ„ï¼Œåˆ™è¿›è¡Œçº¢é»‘æ ‘çš„åç»­æ·»åŠ æ“ä½œ</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="built_in">this</span>, tab, hash, key, value);</span><br><span class="line">            <span class="comment">//ç¬¬ä¸‰ç§æƒ…å†µï¼šå‰©ä¸‹çš„æƒ…å†µå°±æ˜¯åœ¨é“¾è¡¨ä¸­æŸ¥çœ‹æ˜¯å¦æœ‰hashå€¼ç›¸åŒä¸”equalæ¯”è¾ƒåç›¸åŒçš„</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//ä¸€ç›´å¾ªç¯éå†æ•´æ¡é“¾è¡¨ï¼Œåªä¼šæœ‰ä¸‹é¢ä¸¤ç§æƒ…å†µé€€å‡º</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">binCount</span> <span class="operator">=</span> <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                    <span class="comment">//ç¬¬ä¸€ç§æƒ…å†µï¼šæ‰¾åˆ°æœ€åéƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œç›´æ¥æŠŠå…ƒç´ æ·»åŠ åˆ°é“¾è¡¨æœ«å°¾</span></span><br><span class="line">                    <span class="keyword">if</span> ((e = p.next) == <span class="literal">null</span>) &#123;</span><br><span class="line">                        p.next = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">                        <span class="comment">//æ·»åŠ åè¦åˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯ä¸æ˜¯åˆ°è¾¾8ï¼Œå¯èƒ½è¿›è¡Œç›¸åº”çš„æ ‘åŒ–æ“ä½œ</span></span><br><span class="line">                        <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) </span><br><span class="line">                            treeifyBin(tab, hash);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//ç¬¬äºŒç§æƒ…å†µï¼šæ‰¾åˆ°äº†ç›¸åŒçš„ï¼Œé‚£ä¹ˆå°±æ›¿æ¢å€¼å³å¯</span></span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                        ((k = e.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    p = e;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//è¿™é‡Œæ˜¯æ›¿æ¢å€¼çš„æ“ä½œ</span></span><br><span class="line">            <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123; </span><br><span class="line">                <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> e.value;</span><br><span class="line">                <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="literal">null</span>)</span><br><span class="line">                    e.value = value;</span><br><span class="line">                afterNodeAccess(e);</span><br><span class="line">                <span class="keyword">return</span> oldValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ++modCount;</span><br><span class="line">    <span class="comment">//å¦‚æœæ­¤æ—¶æ·»åŠ </span></span><br><span class="line">        <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">            resize();</span><br><span class="line">        afterNodeInsertion(evict);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="HashSetæ‰©å®¹å’Œè½¬æˆçº¢é»‘æ ‘æœºåˆ¶â­â­â­â­â­"><a href="#HashSetæ‰©å®¹å’Œè½¬æˆçº¢é»‘æ ‘æœºåˆ¶â­â­â­â­â­" class="headerlink" title="HashSetæ‰©å®¹å’Œè½¬æˆçº¢é»‘æ ‘æœºåˆ¶â­â­â­â­â­"></a>HashSetæ‰©å®¹å’Œè½¬æˆçº¢é»‘æ ‘æœºåˆ¶â­â­â­â­â­</h4><ol><li>HashSetåº•å±‚æ˜¯HashMapï¼Œç¬¬ä¸€æ¬¡æ·»åŠ æ—¶ï¼Œtable æ•°ç»„æ‰©å®¹åˆ° 16ï¼Œ ä¸´ç•Œå€¼<code>threshold</code>æ˜¯ 16ä¹˜ä»¥åŠ è½½å› å­<code>loadFactor</code>0.75 &#x3D; 12</li><li>å¦‚æœtableæ•°ç»„ä½¿ç”¨åˆ°äº†ä¸´ç•Œå€¼ 12,å°±ä¼šæ‰©å®¹åˆ°16* 2 &#x3D; 32ï¼Œæ–°çš„ä¸´ç•Œå€¼å°±æ˜¯32*0.75 &#x3D; 24ï¼Œä¾æ¬¡ç±»æ¨</li></ol><blockquote><p>è¡¥å……ï¼šæ ¹æ®ä¸‹é¢çš„æºç å¯çŸ¥ï¼Œæ¯æ·»åŠ ä¸€ä¸ªå…ƒç´ éƒ½ç®—æ˜¯sizeåŠ ä¸€ï¼Œè€Œä¸æ˜¯è¦ç­‰åˆ°è¡¨ä¸­æ¯ä¸ªä½ç½®åˆ°è¾¾ä¸´ç•Œå€¼ï¼Œå³åŒ…æ‹¬é“¾è¡¨ä¸­çš„å…ƒç´ åœ¨å†…çš„å…ƒç´ ä¸ªæ•°åˆ°è¾¾ä¸´ç•Œå€¼å°±ä¼šæ‰©å®¹ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(++size &gt; threshold)</span><br><span class="line">    resize();</span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼šå°±ç®—å…¨éƒ¨å…ƒç´ éƒ½åŠ åˆ°åŒä¸€ä¸ªé“¾è¡¨ä¸­ï¼Œåªè¦å…ƒç´ ä¸ªæ•°åˆ°è¾¾ä¸´ç•Œå€¼å°±è¦æ‰©å®¹</p></blockquote><ol><li>åœ¨Java8ä¸­ï¼Œå¦‚æœä¸€æ¡é“¾è¡¨çš„å…ƒç´ ä¸ªæ•°åˆ°è¾¾ <code>TREEIFY THRESHOLD</code>ï¼ˆé»˜è®¤æ˜¯ 8ï¼‰å¹¶ä¸”tableçš„å¤§å° &gt;&#x3D;<code>MIN TREEIFY CAPACITY</code>ï¼ˆé»˜è®¤64ï¼‰å°±ä¼šè¿›è¡Œæ ‘åŒ–ï¼ˆçº¢é»‘æ ‘ï¼‰,å¦åˆ™ä»ç„¶é‡‡ç”¨æ•°ç»„æ‰©å®¹æœºåˆ¶</li></ol><p>åˆ©ç”¨ä¸‹é¢è¿™æ®µä»£ç è¿›è¡ŒdebugæŸ¥çœ‹ï¼š</p><blockquote><p>å› ä¸ºè¦hashå€¼ç›¸åŒæ‰ä¼šæŒ‚åˆ°åŒä¸€ä¸ªåœ°æ–¹ï¼Œæ‰€ä»¥é‡å†™äº†ä»–ä»¬çš„hashCodeéƒ½è¿”å›ä¸€æ ·çš„å€¼ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        HashSet&lt;A&gt; hashSet = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">15</span>; i++) &#123;</span><br><span class="line">            hashSet.add(<span class="keyword">new</span> <span class="title class_">A</span>(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">A</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.n = n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ç›´éå†åˆ°i&#x3D;8æ—¶ï¼ˆåŒ…æ‹¬i&#x3D;8ï¼‰ï¼Œæ­¤æ—¶éƒ½æ˜¯å­˜æ”¾åœ¨ä¸€æ¡é“¾è¡¨ä¸Šçš„</p><p><img src="/../assets/Java%E9%9B%86%E5%90%88/image-20230907231345653.png" alt="image-20230907231345653"></p><p>æ­¤æ—¶åˆ°i&#x3D;9æ—¶ï¼Œå› ä¸ºé“¾è¡¨é•¿åº¦åˆ°è¾¾äº†8ï¼Œæ­¤æ—¶å°±å‡ºå‘äº†æ‰©å®¹æœºåˆ¶ï¼Œè¡¨é•¿åº¦å°±ä¼šå˜ä¸º16*2&#x3D;32ï¼Œè€Œç¬¬9ä¸ªå…ƒç´ ä¼šè¢«å­˜æ”¾åœ¨åŸé“¾è¡¨çš„æœ«å°¾ï¼Œæ­¤æ—¶é•¿åº¦ä¸º9ï¼Œä¸”<strong>ç´¢å¼•å€¼ä¼šé‡æ–°è¿›è¡Œhashè®¡ç®—ï¼Œä¸ä¸€å®šè¿˜æ˜¯åŸæ¥çš„ç´¢å¼•å€¼äº†</strong>ã€‚</p><p><img src="/../assets/Java%E9%9B%86%E5%90%88/image-20230907231658335.png" alt="image-20230907231658335"></p><p>æ­¤æ—¶è¿è¡Œåˆ°i&#x3D;10çš„æ—¶å€™ï¼Œä¼šå†æ¬¡è§¦å‘æ‰©å®¹æœºåˆ¶ï¼Œåˆ™ç¬¬10ä¸ªå…ƒç´ ä¼šå†æ¬¡è¢«æ·»åŠ åˆ°é“¾è¡¨æœ«å°¾ï¼Œé“¾è¡¨é•¿åº¦ä¸º10ï¼Œç„¶åè¡¨å†æ¬¡æ‰©å®¹ä¸º64</p><p><img src="/../assets/Java%E9%9B%86%E5%90%88/image-20230907232000347.png" alt="image-20230907232000347"></p><p>æ­¤æ—¶åˆ°i&#x3D;11çš„æ—¶å€™ï¼Œå†æ¬¡æ·»åŠ å…ƒç´ å°±åŒæ—¶æ»¡è¶³é“¾è¡¨é•¿åº¦åˆ°è¾¾8ä¸”è¡¨é•¿åº¦åˆ°è¾¾64çš„ä¸¤ä¸ªæ¡ä»¶äº†ï¼Œåˆ™ä¼šå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘</p><p><img src="/../assets/Java%E9%9B%86%E5%90%88/image-20230907231052305.png" alt="image-20230907231052305"></p><h3 id="LinkedHashSet"><a href="#LinkedHashSet" class="headerlink" title="LinkedHashSet"></a>LinkedHashSet</h3><ol><li><p>LinkedHashSet æ˜¯ HashSet çš„å­ç±»</p></li><li><p>LinkedHashSet åº•å±‚æ˜¯ä¸€ä¸ª LinkedHashMapï¼Œåº•å±‚ç»´æŠ¤äº†ä¸€ä¸ª <strong>æ•°ç»„+ åŒå‘é“¾è¡¨</strong></p></li><li><p>LinkedHashSet æ ¹æ®å…ƒç´ çš„ hashCode å€¼æ¥å†³å®šå…ƒç´ çš„å­˜å‚¨ä½ç½®ï¼ŒåŒæ—¶<strong>ä½¿ç”¨é“¾è¡¨ç»´æŠ¤å…ƒç´ çš„æ¬¡åº</strong>(å›¾)ï¼Œè¿™ä½¿å¾—å…ƒç´ çœ‹èµ·æ¥æ˜¯ä»¥æ’å…¥é¡ºåºä¿å­˜çš„ã€‚</p></li><li><p>LinkedHashSet ä¸å…è®¸æ·»é‡å¤å…ƒç´ </p></li></ol><p>æ‰§è¡Œä¸‹é¢ä»£ç ï¼Œæ‰€ç»´æŠ¤çš„åŒå‘é“¾è¡¨å¦‚å›¾ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">LinkedHashSet&lt;Object&gt; set = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;();</span><br><span class="line">        set.add(<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;AA&quot;</span>));</span><br><span class="line">        set.add(<span class="number">456</span>);</span><br><span class="line">        set.add(<span class="number">456</span>);</span><br><span class="line">        set.add(<span class="keyword">new</span> <span class="title class_">Customer</span>(<span class="string">&quot;åˆ˜&quot;</span>, <span class="number">1001</span>));</span><br><span class="line">        set.add(<span class="number">123</span>);</span><br><span class="line">        set.add(<span class="string">&quot;HSP&quot;</span>);</span><br></pre></td></tr></table></figure><hr><p><img src="/../assets/Java%E9%9B%86%E5%90%88/image-20230908154435929.png" alt="image-20230908154435929"></p><hr><p>åœ¨LinkedHashSetä¸­çš„tableä¸­å­˜æ”¾çš„æ˜¯LinkedHashMap$Entryï¼Œä»–ç»§æ‰¿äº†HashMap$Node</p><p><img src="/../assets/Java%E9%9B%86%E5%90%88/image-20230908160006697.png" alt="image-20230908160006697"></p><p>ğŸ”´ğŸŸ¡ğŸŸ¢æ€»ç»“ï¼š</p><blockquote><p>å…¶å®åªæ˜¯å¢åŠ äº†ä¸€ä¸ªåŒå‘é“¾è¡¨è€Œå·²ï¼Œå…¶ä»–ä»€ä¹ˆéƒ½æ²¡å˜HashSetï¼ŒåŒ…æ‹¬åŸæ¥çš„nextä¹Ÿæ˜¯ä¿ç•™äº†çš„</p></blockquote><h3 id="TreeSet"><a href="#TreeSet" class="headerlink" title="TreeSet"></a>TreeSet</h3><ol><li><p>TreeSetåº•å±‚å…¶å®æ˜¯TreeMap</p></li><li><p>keyä¸èƒ½ä¸ºnull</p></li><li><p>åº•å±‚ç»´æŠ¤äº†ä¸€ä¸ªçº¢é»‘æ ‘</p></li></ol><p><img src="/../assets/Java%E9%9B%86%E5%90%88/image-20230908224358603.png" alt="image-20230908224358603"></p><hr><p>åœ¨å‘ç°æ¯”è¾ƒç›¸åŒçš„æ—¶å€™ï¼Œä¼šé‡ç½®valueçš„å€¼ï¼Œåœ¨TreeSetæƒ…å†µä¸‹ï¼Œç›¸å¯¹äºkeyæ¥è¯´ï¼Œå…¶å®æ˜¯<strong>åŠ ä¸è¿›å»çš„</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (cpr != <span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        parent = t;</span><br><span class="line">        cmp = cpr.compare(key, t.key);</span><br><span class="line">        <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>)</span><br><span class="line">            t = t.left;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>)</span><br><span class="line">            t = t.right;</span><br><span class="line">        <span class="keyword">else</span>   <span class="comment">//åœ¨å‘ç°æ¯”è¾ƒç›¸åŒçš„æ—¶å€™ï¼Œä¼šé‡ç½®valueçš„å€¼ï¼Œä½†æ˜¯ç›¸å¯¹äºkeyæ¥è¯´ï¼Œå…¶å®æ˜¯åŠ ä¸è¿›å»çš„</span></span><br><span class="line">            <span class="keyword">return</span> t.setValue(value);</span><br><span class="line">    &#125;<span class="keyword">while</span> (t != <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>æ¯”å¦‚åœ¨è¿è¡Œä¸‹é¢è¿™æ®µä»£ç æ—¶å­—ç¬¦ä¸²<code>php</code>å…¶å®æ˜¯åŠ ä¸è¿›å»çš„ï¼Œæ¯”è¾ƒåˆ¤æ–­é€»è¾‘æ˜¯æ¯”è¾ƒå­—ç¬¦ä¸²é•¿åº¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        TreeSet&lt;String&gt; treeSet = <span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;&gt;((o1, o2) -&gt; o1.length() - o2.length());</span><br><span class="line">        treeSet.add(<span class="string">&quot;java&quot;</span>);</span><br><span class="line">        treeSet.add(<span class="string">&quot;c++&quot;</span>);</span><br><span class="line">        treeSet.add(<span class="string">&quot;php&quot;</span>);</span><br><span class="line">        treeSet.add(<span class="string">&quot;python&quot;</span>);</span><br><span class="line">        System.out.println(treeSet);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[c++, java, python]</span><br></pre></td></tr></table></figure><h2 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h2><h3 id="Queue-ä¸-Deque-çš„åŒºåˆ«"><a href="#Queue-ä¸-Deque-çš„åŒºåˆ«" class="headerlink" title="Queue ä¸ Deque çš„åŒºåˆ«"></a>Queue ä¸ Deque çš„åŒºåˆ«</h3><p><code>Queue</code> æ˜¯å•ç«¯é˜Ÿåˆ—ï¼Œåªèƒ½ä»ä¸€ç«¯æ’å…¥å…ƒç´ ï¼Œå¦ä¸€ç«¯åˆ é™¤å…ƒç´ ï¼Œå®ç°ä¸Šä¸€èˆ¬éµå¾ª <strong>å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰</strong> è§„åˆ™ã€‚</p><p><code>Deque</code> æ˜¯åŒç«¯é˜Ÿåˆ—ï¼Œåœ¨é˜Ÿåˆ—çš„ä¸¤ç«¯å‡å¯ä»¥æ’å…¥æˆ–åˆ é™¤å…ƒç´ ã€‚</p><h3 id="PriorityQueue"><a href="#PriorityQueue" class="headerlink" title="PriorityQueue"></a>PriorityQueue</h3><p><code>PriorityQueue</code> æ˜¯åœ¨ JDK1.5 ä¸­è¢«å¼•å…¥çš„, å…¶ä¸ <code>Queue</code> çš„åŒºåˆ«åœ¨äºå…ƒç´ å‡ºé˜Ÿé¡ºåºæ˜¯ä¸ä¼˜å…ˆçº§ç›¸å…³çš„ï¼Œå³æ€»æ˜¯ä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ å…ˆå‡ºé˜Ÿã€‚</p><p>è¿™é‡Œåˆ—ä¸¾å…¶ç›¸å…³çš„ä¸€äº›è¦ç‚¹ï¼š</p><ul><li><code>PriorityQueue</code> åˆ©ç”¨äº†äºŒå‰å †çš„æ•°æ®ç»“æ„æ¥å®ç°çš„ï¼Œåº•å±‚ä½¿ç”¨å¯å˜é•¿çš„æ•°ç»„æ¥å­˜å‚¨æ•°æ®</li><li><code>PriorityQueue</code> é€šè¿‡å †å…ƒç´ çš„ä¸Šæµ®å’Œä¸‹æ²‰ï¼Œå®ç°äº†åœ¨ O(logn) çš„æ—¶é—´å¤æ‚åº¦å†…æ’å…¥å…ƒç´ å’Œåˆ é™¤å †é¡¶å…ƒç´ ã€‚</li><li><code>PriorityQueue</code> æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œä¸”ä¸æ”¯æŒå­˜å‚¨ <code>NULL</code> å’Œ <code>non-comparable</code> çš„å¯¹è±¡ã€‚</li><li><code>PriorityQueue</code> é»˜è®¤æ˜¯å°é¡¶å †ï¼Œä½†å¯ä»¥æ¥æ”¶ä¸€ä¸ª <code>Comparator</code> ä½œä¸ºæ„é€ å‚æ•°ï¼Œä»è€Œæ¥è‡ªå®šä¹‰å…ƒç´ ä¼˜å…ˆçº§çš„å…ˆåã€‚</li></ul><p><code>PriorityQueue</code> åœ¨é¢è¯•ä¸­å¯èƒ½æ›´å¤šçš„ä¼šå‡ºç°åœ¨æ‰‹æ’•ç®—æ³•çš„æ—¶å€™ï¼Œå…¸å‹ä¾‹é¢˜åŒ…æ‹¬<strong>å †æ’åºã€æ±‚ç¬¬ K å¤§çš„æ•°ã€å¸¦æƒå›¾çš„éå†</strong>ç­‰ï¼Œæ‰€ä»¥éœ€è¦ä¼šç†Ÿç»ƒä½¿ç”¨æ‰è¡Œ</p><h1 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h1><h2 id="Mapæ¥å£ç‰¹ç‚¹"><a href="#Mapæ¥å£ç‰¹ç‚¹" class="headerlink" title="Mapæ¥å£ç‰¹ç‚¹"></a>Mapæ¥å£ç‰¹ç‚¹</h2><ol><li>Mapä¸Collectionå¹¶åˆ—å­˜åœ¨ï¼Œç”¨äºä¿å­˜å…·æœ‰æ˜ å°„å…³ç³»çš„æ•°æ®ï¼šKey-Value</li><li>Map ä¸­çš„ key å’Œ value å¯ä»¥æ˜¯ä»»ä½•å¼•ç”¨ç±»å‹çš„æ•°æ®ï¼Œä¼šå°è£…åˆ°HashMap$Nodeå¯¹è±¡ä¸­</li><li>Map ä¸­çš„ key ä¸å…è®¸é‡å¤ï¼ŒåŸå› å’ŒHashSet ä¸€æ ·ï¼Œå‰é¢åˆ†æè¿‡æºç </li><li>Map ä¸­çš„ value å¯ä»¥é‡å¤</li><li>Map çš„key å¯ä»¥ä¸º nullï¼Œvalue ä¹Ÿå¯ä»¥ä¸ºnullï¼Œæ³¨æ„ key ä¸ºnullï¼Œåªèƒ½æœ‰ä¸€ä¸ªvalueä¸ºnullï¼Œå¯ä»¥å¤šä¸ªã€‚</li><li>å¸¸ç”¨Stringç±»ä½œä¸ºMapçš„ key</li><li>key å’Œ value ä¹‹é—´å­˜åœ¨å•å‘ä¸€å¯¹ä¸€å…³ç³»ï¼Œå³é€šè¿‡æŒ‡å®šçš„ key æ€»èƒ½æ‰¾åˆ°å¯¹åº”çš„ value</li></ol><ol start="8"><li>ä¸€å¯¹ k-v æ˜¯æ”¾åœ¨ä¸€ä¸ªHashMap$Nodeä¸­çš„ï¼Œåˆå› ä¸ºNodeå®ç°äº†Entry æ¥å£ï¼Œæœ‰äº›ä¹¦ä¸Šä¹Ÿè¯´ ä¸€å¯¹k-vå°±æ˜¯ä¸€ä¸ªEntry</li></ol><blockquote><p>ç¬¬8ç‚¹è¡¥å……ï¼šå…¶å®å°±æ˜¯ä¸ºäº†<strong>æ–¹ä¾¿éå†</strong>ï¼Œæ‰€ä»¥æŠŠNodeç±»å‹çš„æ•°æ®è½¬æˆentryç±»å‹çš„æ•°æ®ï¼Œåœ¨ä½¿ç”¨ä¸€ä¸ªentrySeté›†åˆæ¥è¿›è¡Œä¿å­˜å„ä¸ªentryã€‚</p></blockquote><h2 id="Mapæ¥å£å¸¸ç”¨æ–¹æ³•"><a href="#Mapæ¥å£å¸¸ç”¨æ–¹æ³•" class="headerlink" title="Mapæ¥å£å¸¸ç”¨æ–¹æ³•"></a>Mapæ¥å£å¸¸ç”¨æ–¹æ³•</h2><ol><li>put:æ·»åŠ </li><li>remove:æ ¹æ®é”®åˆ é™¤æ˜ å°„å…³ç³»</li><li>get: æ ¹æ®é”®è·å–å€¼</li><li>size:è·å–å…ƒç´ ä¸ªæ•°</li><li>isEmpty:åˆ¤æ–­ä¸ªæ•°æ˜¯å¦ä¸º0</li><li>clear:æ¸…é™¤</li><li>containsKey:æŸ¥æ‰¾é”®æ˜¯å¦å­˜åœ¨</li></ol><h2 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h2><p>HashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„</p><h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><ul><li>keyç›¸åŒæ˜¯<strong>å€¼æ›¿æ¢</strong>ï¼Œè€Œä¸æ˜¯æ•´ä¸ªé”®å€¼å¯¹æ›¿æ¢</li></ul><p>æŸ¥çœ‹æºç å¯çŸ¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(e != <span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> e.value;</span><br><span class="line">    <span class="keyword">if</span>(!onlyIfAbsent || oldValue == <span class="literal">null</span>)</span><br><span class="line">        e.value = value;</span><br><span class="line">    afterNodeAccess(e);</span><br><span class="line">    <span class="keyword">return</span> oldValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å…·ä½“æºç åˆ†æ</li></ul><blockquote><p>å…·ä½“å¯çœ‹ä¸Šé¢çš„HashSetè®²è§£ï¼Œå› ä¸ºHashSetåº•å±‚å°±æ˜¯HashMap</p></blockquote><ol><li>HashMapåº•å±‚ç»´æŠ¤äº†Nodeç±»å‹çš„æ•°ç»„tableï¼Œé»˜è®¤ä¸ºnullå½“åˆ›å»ºå¯¹è±¡æ—¶ï¼Œå°†åŠ è½½å› å­<code>loadfactor</code>åˆå§‹åŒ–ä¸º0.75</li><li>å½“æ·»åŠ key-valæ—¶ï¼Œé€šè¿‡keyçš„å“ˆå¸Œå€¼å¾—åˆ°åœ¨tableçš„ç´¢å¼•ï¼Œç„¶ååˆ¤æ–­è¯¥ç´¢å¼•å¤„æ˜¯å¦æœ‰å…ƒç´ </li><li>å¦‚æœæ²¡æœ‰å…ƒç´ ç›´æ¥æ·»åŠ ã€‚å¦‚æœè¯¥ç´¢å¼•å¤„æœ‰å…ƒç´ ï¼Œç»§ç»­åˆ¤æ–­è¯¥å…ƒç´ çš„keyå’Œå‡†å¤‡åŠ å…¥çš„keyç›¸æ˜¯å¦ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™ç›´æ¥æ›¿æ¢valï¼›å¦‚æœä¸ç›¸ç­‰éœ€è¦åˆ¤æ–­æ˜¯æ ‘ç»“æ„è¿˜æ˜¯é“¾è¡¨ç»“æ„ï¼Œåšå‡ºç›¸åº”å¤„ç†ã€‚å¦‚æœæ·»åŠ æ—¶å‘ç°å®¹é‡ä¸å¤Ÿï¼Œåˆ™éœ€è¦æ‰©å®¹ã€‚</li><li>ç¬¬1æ¬¡æ·»åŠ ï¼Œåˆ™éœ€è¦æ‰©å®¹tableå®¹é‡ä¸º16ï¼Œä¸´ç•Œå€¼<code>threshold</code>ä¸º12ï¼ˆ16*0.75ï¼‰</li><li>ä»¥åå†æ‰©å®¹ï¼Œåˆ™éœ€è¦æ‰©å®¹tableå®¹é‡ä¸ºåŸæ¥çš„2å€ï¼ˆ32ï¼‰ï¼Œä¸´ç•Œå€¼ä¸ºåŸæ¥çš„2å€,å³24,ä¾æ¬¡ç±»æ¨</li><li>åœ¨Java8ä¸­,å¦‚æœä¸€æ¡é“¾è¡¨çš„å…ƒç´ ä¸ªæ•°è¶…è¿‡<code>TREEIFY_THRESHOLD</code>ï¼ˆé»˜è®¤æ˜¯ 8ï¼‰ï¼Œå¹¶ä¸”tableçš„å¤§å° &gt;&#x3D; <code>MIN TREEIFY CAPACITY</code>ï¼ˆé»˜è®¤64ï¼‰ï¼Œå°±ä¼šè¿›è¡Œæ ‘åŒ–ï¼ˆçº¢é»‘æ ‘ï¼‰</li></ol><h3 id="â­â­â­è¡¥å……ï¼šå¤´æ’æ³•çš„ä¸å®‰å…¨æ€§"><a href="#â­â­â­è¡¥å……ï¼šå¤´æ’æ³•çš„ä¸å®‰å…¨æ€§" class="headerlink" title="â­â­â­è¡¥å……ï¼šå¤´æ’æ³•çš„ä¸å®‰å…¨æ€§"></a>â­â­â­è¡¥å……ï¼šå¤´æ’æ³•çš„ä¸å®‰å…¨æ€§</h3><p>æ–‡ç« å‚è€ƒè‡ªï¼š<a href="https://juejin.cn/post/7236009910147825719?searchId=202307221616567C1AAB8045817A64ED43">https://juejin.cn/post/7236009910147825719?searchId=202307221616567C1AAB8045817A64ED43</a></p><p>åœ¨<code>jdk8</code>ä»¥å‰ï¼Œhashmapä½¿ç”¨çš„æ˜¯å¤´æ’æ³•ï¼Œå¤´æ’æ³•çš„å¥½å¤„å°±æ˜¯åœ¨å“ˆå¸Œå†²çªçš„æ—¶å€™ï¼Œä¸ç”¨ä¾æ¬¡éå†é“¾è¡¨ä¸­çš„å„ä¸ªå…ƒç´ å»è¿›è¡Œå°¾æ’åˆ°æœ«å°¾ï¼Œå³æ—¶é—´å¤æ‚åº¦ä»O(n)è½¬å˜ä¸ºäº†O(1)ã€‚</p><p>ä½†æ˜¯å¤´æ’æ³•æœ‰å¯èƒ½ä¼šå‡ºç°<mark>å¾ªç¯é“¾è¡¨çš„æƒ…å†µ</mark>ï¼Œå¯¼è‡´æ­»å¾ªç¯ã€‚</p><p>HashMap æ­»å¾ªç¯å‘ç”Ÿåœ¨ JDK 1.8 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå®ƒæ˜¯æŒ‡åœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œå› ä¸ºå¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œ put æ“ä½œï¼Œå¯¼è‡´é“¾è¡¨å½¢æˆç¯å½¢æ•°æ®ç»“æ„ï¼Œä¸€æ—¦å½¢æˆç¯å½¢æ•°æ®ç»“æ„ï¼Œåœ¨ get(key) çš„æ—¶å€™å°±ä¼šäº§ç”Ÿæ­»å¾ªç¯ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š <img src="/../assets/Java%E9%9B%86%E5%90%88/0affbdf35acf45aca3c3dbe6a5bbee78tplv-k3u1fbpfcp-zoom-in-crop-mark1512000.webp" alt="image.png"></p><h4 id="æ­»å¾ªç¯åŸå› "><a href="#æ­»å¾ªç¯åŸå› " class="headerlink" title="æ­»å¾ªç¯åŸå› "></a>æ­»å¾ªç¯åŸå› </h4><p>HashMap å¯¼è‡´æ­»å¾ªç¯çš„åŸå› æ˜¯ç”±ä»¥ä¸‹æ¡ä»¶å…±åŒå¯¼è‡´çš„ï¼š</p><ol><li>HashMap ä½¿ç”¨å¤´æ’æ³•è¿›è¡Œæ•°æ®æ’å…¥ï¼ˆJDK 1.8 ä¹‹å‰ï¼‰ï¼›</li><li>å¤šçº¿ç¨‹åŒæ—¶æ·»åŠ ï¼›</li><li>è§¦å‘äº† HashMap æ‰©å®¹ã€‚</li></ol><h4 id="å¤´æ’æ³•-æ‰©å®¹å¯¼è‡´é“¾è¡¨ç¿»è½¬"><a href="#å¤´æ’æ³•-æ‰©å®¹å¯¼è‡´é“¾è¡¨ç¿»è½¬" class="headerlink" title="å¤´æ’æ³•+æ‰©å®¹å¯¼è‡´é“¾è¡¨ç¿»è½¬"></a>å¤´æ’æ³•+æ‰©å®¹å¯¼è‡´é“¾è¡¨ç¿»è½¬</h4><p>å¤´æ’æ³•æ˜¯æŒ‡æ–°æ¥çš„å€¼ä¼šå–ä»£åŸæœ‰çš„å€¼ï¼Œæ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p>åŸé“¾è¡¨å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š <img src="/../assets/Java%E9%9B%86%E5%90%88/ce7c5f5bc801434c80734f489aa5d68btplv-k3u1fbpfcp-zoom-in-crop-mark1512000.webp" alt="img"> æ­¤æ—¶ä½¿ç”¨å¤´æ’å…¥æ’å…¥ä¸€ä¸ªå…ƒç´  Zï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š <img src="/../assets/Java%E9%9B%86%E5%90%88/b2804dde2e0b414fa4c8abf92682ad25tplv-k3u1fbpfcp-zoom-in-crop-mark1512000.webp" alt="img"> å¤´æ’æ³•ä¼šå¯¼è‡´ HashMap åœ¨è¿›è¡Œæ‰©å®¹æ—¶ï¼Œé“¾è¡¨çš„é¡ºåºå‘ç”Ÿåè½¬ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š <img src="/../assets/Java%E9%9B%86%E5%90%88/8a16390f2fc945a7a4b921604f3c2649tplv-k3u1fbpfcp-zoom-in-crop-mark1512000.webp" alt="img"> å› ä¸ºåœ¨ HashMap æ‰©å®¹æ—¶ï¼Œä¼šå…ˆä»æ—§ HashMap çš„å¤´èŠ‚ç‚¹è¯»å–å¹¶æ’å…¥åˆ°æ–° HashMap èŠ‚ç‚¹ä¸­ï¼Œæ—§èŠ‚ç‚¹çš„è¯»å–é¡ºåºæ˜¯ A -&gt; B -&gt; Cï¼Œäºæ˜¯æ’å…¥åˆ°æ–° HashMap ä¸­çš„é¡ºåºå°±å˜æˆäº† C -&gt; B -&gt; Aï¼Œè¿™æ ·å°±ç ´åäº†é“¾è¡¨çš„é¡ºåºï¼Œå¯¼è‡´äº†é“¾è¡¨åè½¬ã€‚</p><h4 id="æ­»å¾ªç¯äº§ç”Ÿè¿‡ç¨‹"><a href="#æ­»å¾ªç¯äº§ç”Ÿè¿‡ç¨‹" class="headerlink" title="æ­»å¾ªç¯äº§ç”Ÿè¿‡ç¨‹"></a>æ­»å¾ªç¯äº§ç”Ÿè¿‡ç¨‹</h4><ol><li>æ­»å¾ªç¯æ‰§è¡Œæ­¥éª¤1</li></ol><p>æ­»å¾ªç¯æ˜¯å› ä¸ºå¹¶å‘ HashMap æ‰©å®¹å¯¼è‡´çš„ï¼Œå¹¶å‘æ‰©å®¹çš„ç¬¬ä¸€æ­¥ï¼Œçº¿ç¨‹ T1 å’Œçº¿ç¨‹ T2 è¦å¯¹ HashMap è¿›è¡Œæ‰©å®¹æ“ä½œï¼Œæ­¤æ—¶ T1 å’Œ T2 æŒ‡å‘çš„æ˜¯é“¾è¡¨çš„å¤´ç»“ç‚¹å…ƒç´  Aï¼Œè€Œ T1 å’Œ T2 çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ T1.next å’Œ T2.next æŒ‡å‘çš„æ˜¯ B èŠ‚ç‚¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š <img src="/../assets/Java%E9%9B%86%E5%90%88/3eefc80bb23e483881dbacc01e8c0dbftplv-k3u1fbpfcp-zoom-in-crop-mark1512000.webp" alt="image.png"></p><ol start="2"><li>æ­»å¾ªç¯æ‰§è¡Œæ­¥éª¤2</li></ol><p>æ­»å¾ªç¯çš„ç¬¬äºŒæ­¥æ“ä½œæ˜¯ï¼Œçº¿ç¨‹ T2 æ—¶é—´ç‰‡ç”¨å®Œè¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œè€Œçº¿ç¨‹ T1 å¼€å§‹æ‰§è¡Œæ‰©å®¹æ“ä½œï¼Œä¸€ç›´åˆ°çº¿ç¨‹ T1 æ‰©å®¹å®Œæˆåï¼Œçº¿ç¨‹ T2 æ‰è¢«å”¤é†’ï¼Œæ‰©å®¹ä¹‹åçš„åœºæ™¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š <img src="/../assets/Java%E9%9B%86%E5%90%88/a274c3e03b934b41bd186d830da25fc8tplv-k3u1fbpfcp-zoom-in-crop-mark1512000.webp" alt="image.png"> ä»ä¸Šå›¾å¯çŸ¥çº¿ç¨‹ T1 æ‰§è¡Œä¹‹åï¼Œå› ä¸ºæ˜¯å¤´æ’æ³•ï¼Œæ‰€ä»¥ HashMap çš„é¡ºåºå·²ç»å‘ç”Ÿäº†æ”¹å˜ï¼Œä½†çº¿ç¨‹ T2 å¯¹äºå‘ç”Ÿçš„ä¸€åˆ‡æ˜¯ä¸å¯çŸ¥çš„ï¼Œæ‰€ä»¥å®ƒçš„æŒ‡å‘å…ƒç´ ä¾ç„¶æ²¡å˜ï¼Œå¦‚ä¸Šå›¾å±•ç¤ºçš„é‚£æ ·ï¼ŒT2 æŒ‡å‘çš„æ˜¯ A å…ƒç´ ï¼ŒT2.next æŒ‡å‘çš„èŠ‚ç‚¹æ˜¯ B å…ƒç´ ã€‚</p><ol start="3"><li>æ­»å¾ªç¯æ‰§è¡Œæ­¥éª¤3</li></ol><p>å½“çº¿ç¨‹ T1 æ‰§è¡Œå®Œï¼Œè€Œçº¿ç¨‹ T2 æ¢å¤æ‰§è¡Œæ—¶ï¼Œæ­»å¾ªç¯å°±å»ºç«‹äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š <img src="/../assets/Java%E9%9B%86%E5%90%88/195338f01b8c4c7590235fcb26432e45tplv-k3u1fbpfcp-zoom-in-crop-mark1512000.webp" alt="image.png"> å› ä¸º T1 æ‰§è¡Œå®Œæ‰©å®¹ä¹‹å B èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ Aï¼Œè€Œ T2 çº¿ç¨‹æŒ‡å‘çš„é¦–èŠ‚ç‚¹æ˜¯ Aï¼Œç¬¬äºŒä¸ªèŠ‚ç‚¹æ˜¯ Bï¼Œè¿™ä¸ªé¡ºåºåˆšå¥½å’Œ T1 æ‰©å®Œå®¹å®Œä¹‹åçš„èŠ‚ç‚¹é¡ºåºæ˜¯ç›¸åçš„ã€‚<strong>T1 æ‰§è¡Œå®Œä¹‹åçš„é¡ºåºæ˜¯ B åˆ° Aï¼Œè€Œ T2 çš„é¡ºåºæ˜¯ A åˆ° Bï¼Œè¿™æ · A èŠ‚ç‚¹å’Œ B èŠ‚ç‚¹å°±å½¢æˆæ­»å¾ªç¯äº†</strong>ï¼Œè¿™å°±æ˜¯ HashMap æ­»å¾ªç¯å¯¼è‡´çš„åŸå› ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p>HashMap æ­»å¾ªç¯çš„å¸¸ç”¨è§£å†³æ–¹æ¡ˆæœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><ol><li>å‡çº§åˆ°é«˜ç‰ˆæœ¬ JDKï¼ˆJDK 1.8 ä»¥ä¸Šï¼‰ï¼Œé«˜ç‰ˆæœ¬ JDK ä½¿ç”¨çš„æ˜¯å°¾æ’æ³•æ’å…¥æ–°å…ƒç´ çš„ï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿæ­»å¾ªç¯çš„é—®é¢˜ï¼›</li><li>ä½¿ç”¨çº¿ç¨‹å®‰å…¨å®¹å™¨ ConcurrentHashMap æ›¿ä»£ï¼ˆæ¨èä½¿ç”¨æ­¤æ–¹æ¡ˆï¼‰ï¼›</li><li>ä½¿ç”¨çº¿ç¨‹å®‰å…¨å®¹å™¨ Hashtable æ›¿ä»£ï¼ˆæ€§èƒ½ä½ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼‰ï¼›</li><li>ä½¿ç”¨ synchronized æˆ– Lock åŠ é” HashMap ä¹‹åï¼Œå†è¿›è¡Œæ“ä½œï¼Œç›¸å½“äºå¤šçº¿ç¨‹æ’é˜Ÿæ‰§è¡Œï¼ˆæ¯”è¾ƒéº»çƒ¦ï¼Œä¹Ÿä¸å»ºè®®ä½¿ç”¨ï¼‰ã€‚</li></ol><h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>HashMap æ­»å¾ªç¯å‘ç”Ÿåœ¨ JDK 1.7 ç‰ˆæœ¬ä¸­ï¼Œå½¢æˆæ­»å¾ªç¯çš„åŸå› æ˜¯ HashMap åœ¨ JDK 1.7 ä½¿ç”¨çš„æ˜¯å¤´æ’æ³•ï¼Œå¤´æ’æ³• + å¤šçº¿ç¨‹å¹¶å‘æ“ä½œ + HashMap æ‰©å®¹ï¼Œè¿™å‡ ä¸ªç‚¹åŠ åœ¨ä¸€èµ·å°±å½¢æˆäº† HashMap çš„æ­»å¾ªç¯ï¼Œè§£å†³æ­»å¾ªç¯å¯ä»¥é‡‡ç”¨çº¿ç¨‹å®‰å…¨å®¹å™¨ ConcurrentHashMap æ›¿ä»£ã€‚</p><blockquote><p>JDKå®˜æ–¹æ–‡æ¡£è¯´hashmapæœ¬èº«å°±æ˜¯è®©å•çº¿ç¨‹å»æ“ä½œçš„ï¼Œè¦æ˜¯å¤šçº¿ç¨‹è¿˜æ˜¯ä½¿ç”¨ConcurrentHashMap</p></blockquote><h3 id="â­â­â­ä¸ºä»€ä¹ˆHashMap-æ€»æ˜¯ä½¿ç”¨-2-çš„å¹‚ä½œä¸ºå“ˆå¸Œè¡¨çš„å¤§å°"><a href="#â­â­â­ä¸ºä»€ä¹ˆHashMap-æ€»æ˜¯ä½¿ç”¨-2-çš„å¹‚ä½œä¸ºå“ˆå¸Œè¡¨çš„å¤§å°" class="headerlink" title="â­â­â­ä¸ºä»€ä¹ˆHashMap æ€»æ˜¯ä½¿ç”¨ 2 çš„å¹‚ä½œä¸ºå“ˆå¸Œè¡¨çš„å¤§å°"></a>â­â­â­ä¸ºä»€ä¹ˆ<code>HashMap</code> æ€»æ˜¯ä½¿ç”¨ 2 çš„å¹‚ä½œä¸ºå“ˆå¸Œè¡¨çš„å¤§å°</h3><p>ä¸ºäº†èƒ½è®© HashMap å­˜å–é«˜æ•ˆï¼Œå°½é‡è¾ƒå°‘ç¢°æ’ï¼Œä¹Ÿå°±æ˜¯è¦å°½é‡æŠŠæ•°æ®åˆ†é…å‡åŒ€ã€‚</p><p>HashMap ä¸­çš„æ¡¶ï¼ˆæ•°ç»„ï¼‰é•¿åº¦ä¸º 2 çš„å¹‚æ¬¡æ–¹ï¼Œè¿™æ˜¯ä¸ºäº†é«˜æ•ˆä¸”å‡åŒ€åœ°åˆ†é…æ•°æ®ï¼Œå‡å°‘ç¢°æ’ï¼Œä¼˜åŒ–å†…å­˜ä½¿ç”¨å’ŒæŸ¥æ‰¾é€Ÿåº¦ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£é‡Šï¼š</p><ol><li>å‡åŒ€åˆ†é…ä¸ç¢°æ’å‡å°‘</li></ol><p>å“ˆå¸Œè¡¨çš„å…³é”®åœ¨äºå“ˆå¸Œå‡½æ•°çš„è´¨é‡ï¼Œå³å¦‚ä½•å°†é”®ï¼ˆkeyï¼‰å‡åŒ€åœ°åˆ†é…åˆ°æ•°ç»„çš„å„ä¸ªä½ç½®ï¼ˆæ¡¶ï¼‰ä¸­ã€‚å“ˆå¸Œå‡½æ•°çš„ç›®æ ‡æ˜¯å°½å¯èƒ½åœ°å‡å°‘ç¢°æ’ï¼ˆå³ä¸åŒçš„é”®æ˜ å°„åˆ°ç›¸åŒçš„ä½ç½®ï¼‰ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œå“ˆå¸Œå€¼çš„åˆ†å¸ƒåº”è¯¥è¶³å¤Ÿå‡åŒ€ï¼Œä½¿å¾—æ¯ä¸ªé”®çš„å­˜å–æ“ä½œéƒ½å¯ä»¥åœ¨æ¥è¿‘å¸¸æ•°æ—¶é—´å†…å®Œæˆã€‚</p><ol start="2"><li>å“ˆå¸Œå€¼çš„èŒƒå›´å’Œå†…å­˜é™åˆ¶</li></ol><p>å“ˆå¸Œå€¼çš„èŒƒå›´æ˜¯ -2147483648 åˆ° 2147483647ï¼ˆæ€»å…±çº¦ 40 äº¿ä¸ªå€¼ï¼‰ã€‚ç›´æ¥ä½¿ç”¨è¿™ä¹ˆå¤§çš„æ•°ç»„æ˜¾ç„¶æ˜¯ä¸ç°å®çš„ï¼Œå› ä¸ºå†…å­˜æ— æ³•å®¹çº³ã€‚å› æ­¤ï¼Œå“ˆå¸Œå€¼éœ€è¦è¿›è¡Œä¸€å®šçš„å¤„ç†ï¼Œä»¥é€‚åº”è¾ƒå°çš„æ•°ç»„é•¿åº¦ã€‚</p><ol start="3"><li>æ•°ç»„ä¸‹æ ‡è®¡ç®—æ–¹æ³•</li></ol><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå“ˆå¸Œå€¼éœ€è¦æ˜ å°„åˆ°æ•°ç»„ä¸‹æ ‡ï¼Œè¿™ä¸ªä¸‹æ ‡çš„è®¡ç®—æ–¹å¼æ˜¯é€šè¿‡å¯¹æ•°ç»„é•¿åº¦å–æ¨¡ï¼ˆmodï¼‰è¿ç®—å¾—åˆ°çš„ã€‚æ•°ç»„ä¸‹æ ‡çš„è®¡ç®—æ–¹æ³•æ˜¯ï¼š</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">index</span> = hash % <span class="keyword">length</span></span><br></pre></td></tr></table></figure><p>ä½†åœ¨é•¿åº¦ä¸º 2 çš„å¹‚æ¬¡æ–¹æ—¶ï¼Œå¯ä»¥ç”¨æ›´é«˜æ•ˆçš„ä½æ“ä½œä»£æ›¿å–æ¨¡è¿ç®—ï¼Œå³ï¼š</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">index</span> = hash &amp; (<span class="keyword">length</span> - <span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ³•æ¯”ç›´æ¥å–æ¨¡è¿ç®—æ›´å¿«ï¼Œè¿™æ˜¯å› ä¸ºä½æ“ä½œæ¯”å–æ¨¡è¿ç®—çš„è®¡ç®—æ•ˆç‡æ›´é«˜ã€‚</p><h3 id="HashMap-ä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ"><a href="#HashMap-ä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ" class="headerlink" title="HashMap ä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ"></a>HashMap ä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ</h3><p>å¤šä¸ªçº¿ç¨‹å¯¹ <code>HashMap</code> çš„ <code>put</code> æ“ä½œä¼šå¯¼è‡´çº¿ç¨‹ä¸å®‰å…¨ï¼Œå…·ä½“æ¥è¯´ä¼šæœ‰æ•°æ®è¦†ç›–çš„é£é™©ã€‚</p><blockquote><p>çº¿ç¨‹ 1 æ‰§è¡Œ <code>if(++size &gt; threshold)</code> åˆ¤æ–­æ—¶ï¼Œå‡è®¾è·å¾— <code>size</code> çš„å€¼ä¸º 10ï¼Œç”±äºæ—¶é—´ç‰‡è€—å°½æŒ‚èµ·ã€‚</p><p>çº¿ç¨‹ 2 ä¹Ÿæ‰§è¡Œ <code>if(++size &gt; threshold)</code> åˆ¤æ–­ï¼Œè·å¾— <code>size</code> çš„å€¼ä¹Ÿä¸º 10ï¼Œå¹¶å°†å…ƒç´ æ’å…¥åˆ°è¯¥æ¡¶ä½ä¸­ï¼Œå¹¶å°† <code>size</code> çš„å€¼æ›´æ–°ä¸º 11ã€‚</p><p>éšåï¼Œçº¿ç¨‹ 1 è·å¾—æ—¶é—´ç‰‡ï¼Œå®ƒä¹Ÿå°†å…ƒç´ æ”¾å…¥æ¡¶ä½ä¸­ï¼Œå¹¶å°† size çš„å€¼æ›´æ–°ä¸º 11ã€‚</p><p>çº¿ç¨‹ 1ã€2 éƒ½æ‰§è¡Œäº†ä¸€æ¬¡ <code>put</code> æ“ä½œï¼Œä½†æ˜¯ <code>size</code> çš„å€¼åªå¢åŠ äº† 1ï¼Œä¹Ÿå°±å¯¼è‡´å®é™…ä¸Šåªæœ‰ä¸€ä¸ªå…ƒç´ è¢«æ·»åŠ åˆ°äº† <code>HashMap</code> ä¸­ã€‚</p></blockquote><h2 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h2><p>å¾…è¡¥å……ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p><h2 id="Hashtable"><a href="#Hashtable" class="headerlink" title="Hashtable"></a>Hashtable</h2><ol><li>çº¿ç¨‹å®‰å…¨ï¼Œå› ä¸ºæ–¹æ³•ä¸Šæœ‰åŠ synchronized</li><li>Hashtableä¸­keyå’Œvalueéƒ½ä¸èƒ½æ˜¯nullï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸</li><li>åº•å±‚æ˜¯Hashtable&amp;Entry[ ] æ•°ç»„ï¼Œç¬¬ä¸€æ¬¡é»˜è®¤æ‰©å®¹å¤§å°ä¸º11</li><li>åŠ è½½å› å­<code>loadfactor</code>åˆå§‹åŒ–ä¸º0.75</li><li>ç¬¬ä¸€æ¬¡ä¸´ç•Œå€¼<code>threshold</code>ä¸º8ï¼ˆ11*0.75ï¼‰</li><li>è¿›è¡Œæ‰©å®¹æ—¶æ˜¯æŒ‰**<mark>ä¸¤å€åŠ ä¸€</mark>*<em>æ¥æ‰©å®¹ï¼Œä¾‹å¦‚11</em>2+1&#x3D;23ï¼Œç¬¬äºŒæ¬¡æ‰©å®¹å¤§å°å°±ä¸º23</li></ol><h2 id="Propoties"><a href="#Propoties" class="headerlink" title="Propoties"></a>Propoties</h2><ol><li>Propotiesæ˜¯Hashtableçš„å­ç±»</li><li>Properties è¿˜å¯ä»¥ç”¨äºä»<code>xxx.properties</code>æ–‡ä»¶ä¸­ï¼ŒåŠ è½½æ•°æ®åˆ°Propertiesç±»å¯¹è±¡å¹¶è¿›è¡Œè¯»å–å’Œä¿®æ”¹</li></ol><h2 id="TreeMap"><a href="#TreeMap" class="headerlink" title="TreeMap"></a>TreeMap</h2><ol><li><p>åº•å±‚ç»´æŠ¤äº†ä¸€ä¸ªçº¢é»‘æ ‘</p></li><li><p>keyä¸èƒ½ä¸ºnull</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TreeMap&lt;Object, Object&gt; treeMap = <span class="keyword">new</span> <span class="title class_">TreeMap</span>&lt;&gt;();</span><br><span class="line">        treeMap.put(<span class="string">&quot;java&quot;</span>,<span class="literal">null</span>);</span><br><span class="line">        treeMap.put(<span class="literal">null</span>,<span class="string">&quot;java&quot;</span>);</span><br></pre></td></tr></table></figure><hr><ol start="3"><li>åœ¨å‘ç°æ¯”è¾ƒç›¸åŒçš„æ—¶å€™ï¼Œä¼šé‡ç½®valueçš„å€¼ï¼Œå› ä¸ºkeyä¼šè¢«è®¤ä¸ºæ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥åªä¼šé‡ç½®valueå€¼</li></ol><blockquote><p>ä¾‹å¦‚ä¸‹é¢ä¾‹å­ä¸­<code>c++</code>å…ˆè¢«æ·»åŠ ï¼Œå†æ·»åŠ <code>php</code>æ—¶å› ä¸ºå­—ç¬¦ä¸²é•¿åº¦ä¸€è‡´æ‰€ä»¥è¢«è®¤ä¸ºæ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥åªä¼šä¿®æ”¹å€¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;     </span><br><span class="line">        TreeMap&lt;String, Integer&gt; treeMap = <span class="keyword">new</span> <span class="title class_">TreeMap</span>&lt;&gt;((o1, o2) -&gt; o1.length() - o2.length());</span><br><span class="line">        treeMap.put(<span class="string">&quot;java&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        treeMap.put(<span class="string">&quot;c++&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        treeMap.put(<span class="string">&quot;python&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        treeMap.put(<span class="string">&quot;php&quot;</span>, <span class="number">2</span>);</span><br><span class="line">        System.out.println(treeMap);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;c++=<span class="number">2</span>, java=<span class="number">1</span>, python=<span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure><h1 id="Collections"><a href="#Collections" class="headerlink" title="Collections"></a>Collections</h1><h2 id="å¸¸ç”¨API"><a href="#å¸¸ç”¨API" class="headerlink" title="å¸¸ç”¨API"></a>å¸¸ç”¨API</h2><ol><li>reverse(List): åè½¬ List ä¸­å…ƒç´ çš„é¡ºåº</li><li>shuffle(List): å¯¹ List é›†åˆå…ƒç´ è¿›è¡Œéšæœºæ’åº</li><li>sort(List): æ ¹æ®å…ƒç´ çš„è‡ªç„¶é¡ºåºå¯¹æŒ‡å®š List é›†åˆå…ƒç´ æŒ‰å‡åºæ’åº</li><li>sort(Listï¼ŒComparator): æ ¹æ®æŒ‡å®šçš„ Comparator äº§ç”Ÿçš„é¡ºåºå¯¹ List é›†åˆå…ƒç´ è¿›è¡Œæ’åº</li><li>swap(Listï¼Œintï¼Œ int): å°†æŒ‡å®š list é›†åˆä¸­çš„i å¤„å…ƒç´ å’Œjå¤„å…ƒç´ è¿›è¡Œäº¤æ¢</li><li>Object max(Collection): æ ¹æ®å…ƒç´ çš„è‡ªç„¶é¡ºåºï¼Œè¿”å›ç»™å®šé›†åˆä¸­çš„æœ€å¤§å…ƒç´ </li><li>Object max(Collection,Comparator): æ ¹æ® Comparator æŒ‡å®šçš„é¡ºåºè¿”å›ç»™å®šé›†åˆä¸­çš„æœ€å¤§å…ƒç´ </li><li>Object min(Collection)</li><li>Object min(Collection, Comparator)</li><li>int frequency(Collectionï¼ŒObject): è¿”å›æŒ‡å®šé›†åˆä¸­æŒ‡å®šå…ƒç´ çš„å‡ºç°æ¬¡æ•°</li><li>void copy(List dest,List src): å°†srcä¸­çš„å†…å®¹å¤åˆ¶åˆ°destä¸­</li><li>boolean replaceAll(List list,Object oldValï¼Œobject newVal): ä½¿ç”¨æ–°å€¼æ›¿æ¢ List å¯¹è±¡çš„æ‰€æœ‰æ—§å€¼</li></ol>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaé›†åˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JUCå¹¶å‘ç¼–ç¨‹</title>
      <link href="/2023/08/28/Study-JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
      <url>/2023/08/28/Study-JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="æ€»è§ˆ"><a href="#æ€»è§ˆ" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h1><p><img src="/../assets/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/image-20230828164359091.png" alt="image-20230828164359091"></p><p><img src="/../assets/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/image-20230828164436283.png" alt="image-20230828164436283"></p><h1 id="è¿›ç¨‹ä¸çº¿ç¨‹"><a href="#è¿›ç¨‹ä¸çº¿ç¨‹" class="headerlink" title="è¿›ç¨‹ä¸çº¿ç¨‹"></a>è¿›ç¨‹ä¸çº¿ç¨‹</h1><h2 id="è¿›ç¨‹ä¸çº¿ç¨‹-1"><a href="#è¿›ç¨‹ä¸çº¿ç¨‹-1" class="headerlink" title="è¿›ç¨‹ä¸çº¿ç¨‹"></a>è¿›ç¨‹ä¸çº¿ç¨‹</h2><ol><li>è¿›ç¨‹</li></ol><p>ç¨‹åºç”±æŒ‡ä»¤å’Œæ•°æ®ç»„æˆï¼Œä½†è¿™äº›æŒ‡ä»¤è¦è¿è¡Œï¼Œæ•°æ®è¦è¯»å†™ï¼Œå°±å¿…é¡»å°†æŒ‡ä»¤åŠ è½½è‡³ CPUï¼Œæ•°æ®åŠ è½½è‡³å†…å­˜ã€‚åœ¨æŒ‡ä»¤è¿è¡Œè¿‡ç¨‹ä¸­è¿˜éœ€è¦ç”¨åˆ°ç£ç›˜ã€ç½‘ç»œç­‰è®¾å¤‡ã€‚è¿›ç¨‹å°±æ˜¯ç”¨æ¥åŠ è½½æŒ‡ä»¤ã€ç®¡ç†å†…å­˜ã€ç®¡ç† IO çš„ å½“ä¸€ä¸ªç¨‹åºè¢«è¿è¡Œï¼Œä»ç£ç›˜åŠ è½½è¿™ä¸ªç¨‹åºçš„ä»£ç è‡³å†…å­˜ï¼Œè¿™æ—¶å°±å¼€å¯äº†ä¸€ä¸ªè¿›ç¨‹ã€‚ <strong>è¿›ç¨‹å°±å¯ä»¥è§†ä¸ºç¨‹åºçš„ä¸€ä¸ªå®ä¾‹ã€‚</strong>å¤§éƒ¨åˆ†ç¨‹åºå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªå®ä¾‹è¿›ç¨‹ï¼ˆä¾‹å¦‚è®°äº‹æœ¬ã€ç”»å›¾ã€æµè§ˆå™¨ç­‰ï¼‰ï¼Œä¹Ÿæœ‰çš„ç¨‹åºåªèƒ½å¯åŠ¨ä¸€ä¸ªå®ä¾‹è¿›ç¨‹ï¼ˆä¾‹å¦‚ç½‘æ˜“äº‘éŸ³ä¹ã€360 å®‰å…¨å«å£«ç­‰ï¼‰ </p><ol start="2"><li>çº¿ç¨‹</li></ol><p><strong>ä¸€ä¸ªè¿›ç¨‹ä¹‹å†…å¯ä»¥åˆ†ä¸ºä¸€åˆ°å¤šä¸ªçº¿ç¨‹ã€‚</strong> ä¸€ä¸ªçº¿ç¨‹å°±æ˜¯ä¸€ä¸ªæŒ‡ä»¤æµï¼Œå°†æŒ‡ä»¤æµä¸­çš„ä¸€æ¡æ¡æŒ‡ä»¤ä»¥ä¸€å®šçš„é¡ºåºäº¤ç»™ CPU æ‰§è¡Œ Java ä¸­ï¼Œçº¿ç¨‹ä½œä¸ºæœ€å°è°ƒåº¦å•ä½ï¼Œè¿›ç¨‹ä½œä¸ºèµ„æºåˆ†é…çš„æœ€å°å•ä½ã€‚ åœ¨ windows ä¸­è¿›ç¨‹æ˜¯ä¸æ´»åŠ¨çš„ï¼Œåªæ˜¯ä½œä¸ºçº¿ç¨‹çš„å®¹å™¨</p><ol start="3"><li>äºŒè€…å¯¹æ¯”</li></ol><ul><li><p>è¿›ç¨‹åŸºæœ¬ä¸Šç›¸äº’ç‹¬ç«‹çš„ï¼Œè€Œçº¿ç¨‹å­˜åœ¨äºè¿›ç¨‹å†…ï¼Œæ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå­é›† </p></li><li><p>è¿›ç¨‹æ‹¥æœ‰å…±äº«çš„èµ„æºï¼Œå¦‚å†…å­˜ç©ºé—´ç­‰ï¼Œä¾›å…¶å†…éƒ¨çš„çº¿ç¨‹å…±äº« </p></li><li><p>è¿›ç¨‹é—´é€šä¿¡è¾ƒä¸ºå¤æ‚ï¼ŒåŒä¸€å°è®¡ç®—æœºçš„è¿›ç¨‹é€šä¿¡ç§°ä¸º IPCï¼Œ ä¸åŒè®¡ç®—æœºä¹‹é—´çš„è¿›ç¨‹é€šä¿¡ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œï¼Œå¹¶éµå®ˆå…±åŒçš„åè®®ï¼Œä¾‹å¦‚ HTTP çº¿ç¨‹é€šä¿¡ç›¸å¯¹ç®€å•ï¼Œå› ä¸ºå®ƒä»¬å…±äº«è¿›ç¨‹å†…çš„å†…å­˜ï¼Œä¸€ä¸ªä¾‹å­æ˜¯å¤šä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®åŒä¸€ä¸ªå…±äº«å˜é‡ </p></li><li><p>çº¿ç¨‹æ›´è½»é‡ï¼Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ä¸€èˆ¬ä¸Šè¦æ¯”è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä½</p></li></ul><h2 id="å¹¶è¡Œä¸å¹¶å‘"><a href="#å¹¶è¡Œä¸å¹¶å‘" class="headerlink" title="å¹¶è¡Œä¸å¹¶å‘"></a>å¹¶è¡Œä¸å¹¶å‘</h2><p>å¼•ç”¨ Rob Pike çš„ä¸€æ®µæè¿°ï¼š </p><blockquote><p>å¹¶å‘ï¼ˆconcurrentï¼‰æ˜¯åŒä¸€æ—¶é—´åº”å¯¹ï¼ˆdealing withï¼‰å¤šä»¶äº‹æƒ…çš„èƒ½åŠ› </p><p>å¹¶è¡Œï¼ˆparallelï¼‰æ˜¯åŒä¸€æ—¶é—´åŠ¨æ‰‹åšï¼ˆdoingï¼‰å¤šä»¶äº‹æƒ…çš„èƒ½åŠ› </p></blockquote><hr><p>ä¾‹å­ï¼š</p><ol><li><p>å®¶åº­ä¸»å¦‡åšé¥­ã€æ‰“æ‰«å«ç”Ÿã€ç»™å­©å­å–‚å¥¶ï¼Œå¥¹ä¸€ä¸ªäººè½®æµäº¤æ›¿åšè¿™å¤šä»¶äº‹ï¼Œè¿™æ—¶å°±æ˜¯å¹¶å‘ </p></li><li><p>å®¶åº­ä¸»å¦‡é›‡äº†ä¸ªä¿å§†ï¼Œå¥¹ä»¬ä¸€èµ·è¿™äº›äº‹ï¼Œè¿™æ—¶æ—¢æœ‰å¹¶å‘ï¼Œä¹Ÿæœ‰å¹¶è¡Œï¼ˆè¿™æ—¶ä¼šäº§ç”Ÿç«äº‰ï¼Œä¾‹å¦‚é”…åªæœ‰ä¸€å£ï¼Œä¸€ ä¸ªäººç”¨é”…æ—¶ï¼Œå¦ä¸€ä¸ªäººå°±å¾—ç­‰å¾…ï¼‰</p></li><li><p>é›‡äº†3ä¸ªä¿å§†ï¼Œä¸€ä¸ªä¸“åšé¥­ã€ä¸€ä¸ªä¸“æ‰“æ‰«å«ç”Ÿã€ä¸€ä¸ªä¸“å–‚å¥¶ï¼Œäº’ä¸å¹²æ‰°ï¼Œè¿™æ—¶æ˜¯å¹¶è¡Œ</p></li></ol><h2 id="å¼‚æ­¥è°ƒç”¨"><a href="#å¼‚æ­¥è°ƒç”¨" class="headerlink" title="å¼‚æ­¥è°ƒç”¨"></a>å¼‚æ­¥è°ƒç”¨</h2><p>åŒæ­¥ï¼šéœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œæ‰èƒ½ç»§ç»­è¿è¡Œ</p><p>å¼‚æ­¥ï¼šä¸éœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œå°±èƒ½ç»§ç»­è¿è¡Œ</p><hr><p><strong>å¤šçº¿ç¨‹å¯ä»¥è®©æ–¹æ³•æ‰§è¡Œå˜ä¸ºå¼‚æ­¥çš„</strong>ï¼ˆå³ä¸è¦å·´å·´å¹²ç­‰ç€ï¼‰æ¯”å¦‚è¯´è¯»å–ç£ç›˜æ–‡ä»¶æ—¶ï¼Œå‡è®¾è¯»å–æ“ä½œèŠ±è´¹äº† 5 ç§’é’Ÿï¼Œå¦‚æœæ²¡æœ‰çº¿ç¨‹è°ƒåº¦æœºåˆ¶ï¼Œè¿™ 5 ç§’ cpu ä»€ä¹ˆéƒ½åšä¸äº†ï¼Œå…¶å®ƒä»£ç éƒ½å¾—æš‚åœâ€¦</p><h2 id="æé«˜æ•ˆç‡"><a href="#æé«˜æ•ˆç‡" class="headerlink" title="æé«˜æ•ˆç‡"></a>æé«˜æ•ˆç‡</h2><p>å……åˆ†åˆ©ç”¨å¤šæ ¸ cpu çš„ä¼˜åŠ¿ï¼Œæé«˜è¿è¡Œæ•ˆç‡ã€‚æƒ³è±¡ä¸‹é¢çš„åœºæ™¯ï¼Œæ‰§è¡Œ 3 ä¸ªè®¡ç®—ï¼Œæœ€åå°†è®¡ç®—ç»“æœæ±‡æ€»ã€‚ </p><table><thead><tr><th>è®¡ç®— 1 èŠ±è´¹ 10 ms</th></tr></thead><tbody><tr><td>è®¡ç®— 2 èŠ±è´¹ 11 ms</td></tr><tr><td>è®¡ç®— 3 èŠ±è´¹ 9 ms</td></tr><tr><td>æ±‡æ€»éœ€è¦ 1 ms</td></tr></tbody></table><hr><p>å¦‚æœæ˜¯ä¸²è¡Œæ‰§è¡Œï¼Œé‚£ä¹ˆæ€»å…±èŠ±è´¹çš„æ—¶é—´æ˜¯ 10 + 11 + 9 + 1 &#x3D; 31ms ä½†å¦‚æœæ˜¯å››æ ¸ cpuï¼Œå„ä¸ªæ ¸å¿ƒåˆ†åˆ«ä½¿ç”¨çº¿ç¨‹ 1 æ‰§è¡Œè®¡ç®— 1ï¼Œçº¿ç¨‹ 2 æ‰§è¡Œè®¡ç®— 2ï¼Œçº¿ç¨‹ 3 æ‰§è¡Œè®¡ç®— 3ï¼Œé‚£ä¹ˆ 3 ä¸ª çº¿ç¨‹æ˜¯å¹¶è¡Œçš„ï¼ŒèŠ±è´¹æ—¶é—´åªå–å†³äºæœ€é•¿çš„é‚£ä¸ªçº¿ç¨‹è¿è¡Œçš„æ—¶é—´ï¼Œå³ 11ms æœ€ååŠ ä¸Šæ±‡æ€»æ—¶é—´åªä¼šèŠ±è´¹ 12ms </p><blockquote><p><strong>æ³¨æ„</strong>ï¼šéœ€è¦åœ¨å¤šæ ¸ cpu æ‰èƒ½æé«˜æ•ˆç‡ï¼Œå•æ ¸ä»ç„¶æ—¶æ˜¯è½®æµæ‰§è¡Œ</p></blockquote><p><strong>ç»“è®ºï¼š</strong> </p><ol><li><p>å•æ ¸ cpu ä¸‹ï¼Œå¤šçº¿ç¨‹ä¸èƒ½å®é™…æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ï¼Œåªæ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨ä¸åŒçš„ä»»åŠ¡ä¹‹é—´åˆ‡æ¢ï¼Œä¸åŒçº¿ç¨‹è½®æµä½¿ç”¨ cpu ï¼Œä¸è‡³äºä¸€ä¸ªçº¿ç¨‹æ€»å ç”¨ cpuï¼Œåˆ«çš„çº¿ç¨‹æ²¡æ³•å¹²æ´» </p></li><li><p>å¤šæ ¸ cpu å¯ä»¥å¹¶è¡Œè·‘å¤šä¸ªçº¿ç¨‹ï¼Œä½†èƒ½å¦æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡è¿˜æ˜¯è¦åˆ†æƒ…å†µçš„</p></li></ol><ul><li>æœ‰äº›ä»»åŠ¡ï¼Œç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œå°†ä»»åŠ¡æ‹†åˆ†ï¼Œå¹¶è¡Œæ‰§è¡Œï¼Œå½“ç„¶å¯ä»¥æé«˜ç¨‹åºçš„è¿è¡Œæ•ˆç‡</li><li>ä½†ä¸æ˜¯æ‰€æœ‰è®¡ç®—ä»»åŠ¡éƒ½èƒ½æ‹†åˆ†ï¼ˆå‚è€ƒåæ–‡çš„ã€é˜¿å§†è¾¾å°”å®šå¾‹ã€‘ï¼‰ </li><li>ä¹Ÿä¸æ˜¯æ‰€æœ‰ä»»åŠ¡éƒ½éœ€è¦æ‹†åˆ†ï¼Œä»»åŠ¡çš„ç›®çš„å¦‚æœä¸åŒï¼Œè°ˆæ‹†åˆ†å’Œæ•ˆç‡æ²¡å•¥æ„ä¹‰</li></ul><ol start="3"><li>IO æ“ä½œä¸å ç”¨ cpuï¼Œåªæ˜¯æˆ‘ä»¬ä¸€èˆ¬æ‹·è´æ–‡ä»¶ä½¿ç”¨çš„æ˜¯ã€é˜»å¡ IOã€‘ï¼Œè¿™æ—¶ç›¸å½“äºçº¿ç¨‹è™½ç„¶ä¸ç”¨ cpuï¼Œä½†éœ€è¦ä¸€ ç›´ç­‰å¾… IO ç»“æŸï¼Œæ²¡èƒ½å……åˆ†åˆ©ç”¨çº¿ç¨‹ã€‚æ‰€ä»¥æ‰æœ‰åé¢çš„ã€éé˜»å¡ IOã€‘å’Œã€å¼‚æ­¥ IOã€‘ä¼˜åŒ–</li></ol><h1 id="Javaçº¿ç¨‹"><a href="#Javaçº¿ç¨‹" class="headerlink" title="Javaçº¿ç¨‹"></a>Javaçº¿ç¨‹</h1><h2 id="åˆ›å»ºå’Œè¿è¡Œçº¿ç¨‹"><a href="#åˆ›å»ºå’Œè¿è¡Œçº¿ç¨‹" class="headerlink" title="åˆ›å»ºå’Œè¿è¡Œçº¿ç¨‹"></a>åˆ›å»ºå’Œè¿è¡Œçº¿ç¨‹</h2><ol><li>åˆ›å»ºRunnableæ¥å£å¯¹è±¡é…åˆThread</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä»»åŠ¡å¯¹è±¡</span></span><br><span class="line"><span class="type">Runnable</span> <span class="variable">task2</span> <span class="operator">=</span> () -&gt; log.debug(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="comment">// å‚æ•°1 æ˜¯ä»»åŠ¡å¯¹è±¡; å‚æ•°2 æ˜¯çº¿ç¨‹åå­—ï¼Œæ¨è</span></span><br><span class="line"><span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(task2, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line">t2.start();</span><br></pre></td></tr></table></figure><blockquote><p>ç”¨ Runnable æ›´å®¹æ˜“ä¸çº¿ç¨‹æ± ç­‰é«˜çº§ API é…åˆ </p><p>ç”¨ Runnable è®©ä»»åŠ¡ç±»è„±ç¦»äº† Thread ç»§æ‰¿ä½“ç³»ï¼Œæ›´çµæ´»</p></blockquote><hr><ol start="2"><li>FutureTask é…åˆ Thread</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test_JUC</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        FutureTask&lt;Integer&gt; task = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;Integer&gt;(<span class="keyword">new</span> <span class="title class_">Callable</span>&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Integer <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;hhhhhhhhhhh&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(task, <span class="string">&quot;çº¿ç¨‹1&quot;</span>);</span><br><span class="line">        thread.start();</span><br><span class="line">        System.out.println(task.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>FutureTask èƒ½å¤Ÿæ¥æ”¶ Callable ç±»å‹çš„å‚æ•°ï¼Œç”¨æ¥å¤„ç†æœ‰è¿”å›ç»“æœçš„æƒ…å†µ</p></blockquote><h2 id="è§‚å¯Ÿå¤šä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œ"><a href="#è§‚å¯Ÿå¤šä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œ" class="headerlink" title="è§‚å¯Ÿå¤šä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œ"></a>è§‚å¯Ÿå¤šä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œ</h2><p>ä¸¤ä¸ªçº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œè°å…ˆè°åä¸å—æˆ‘ä»¬æ§åˆ¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">            log.debug(<span class="string">&quot;running&quot;</span>);</span><br><span class="line">    &#125;, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">            log.debug(<span class="string">&quot;running&quot;</span>);</span><br><span class="line">    &#125;, <span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹è¿›ç¨‹çº¿ç¨‹çš„æ–¹æ³•"><a href="#æŸ¥çœ‹è¿›ç¨‹çº¿ç¨‹çš„æ–¹æ³•" class="headerlink" title="æŸ¥çœ‹è¿›ç¨‹çº¿ç¨‹çš„æ–¹æ³•"></a>æŸ¥çœ‹è¿›ç¨‹çº¿ç¨‹çš„æ–¹æ³•</h2><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><ul><li>åœ¨Windowsç¯å¢ƒä¸‹ï¼Œå¯ä»¥é€šè¿‡ä»»åŠ¡ç®¡ç†å™¨æ¥æŸ¥çœ‹è¿›ç¨‹å’Œçº¿ç¨‹æ•°ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥æ€æ­»è¿›ç¨‹<ul><li>tasklist æŸ¥çœ‹è¿›ç¨‹</li><li>taskkill æ€æ­»è¿›ç¨‹</li></ul></li></ul><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><ul><li>Linuxç¯å¢ƒä¸‹æœ‰å…³è¿›ç¨‹çš„æŒ‡ä»¤<ul><li><code>ps -ef</code> æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹</li><li><code>ps -fT -p &lt;PID&gt;</code> æŸ¥çœ‹æŸä¸ªè¿›ç¨‹(PID)çš„æ‰€æœ‰çº¿ç¨‹</li><li><code>kill</code> æ€æ­»è¿›ç¨‹</li><li><code>top</code> æŒ‰å¤§å†™Håˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºè¿›ç¨‹</li><li><code>top -H -p &lt;PID&gt;</code> æŸ¥çœ‹æŸä¸ªè¿›ç¨‹(PID)çš„æ‰€æœ‰çº¿ç¨‹</li></ul></li></ul><h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><ul><li>jpså‘½ä»¤æŸ¥çœ‹æ‰€æœ‰Javaè¿›ç¨‹</li><li>jstack æŸ¥çœ‹æŸä¸ªJavaè¿›ç¨‹(PID)çš„æ‰€æœ‰çº¿ç¨‹çŠ¶æ€</li><li>jconsole æŸ¥çœ‹æŸä¸ªJavaè¿›ç¨‹ä¸­çº¿ç¨‹çš„è¿è¡Œæƒ…å†µ(å›¾å½¢ç•Œé¢)</li></ul><hr><p>jconsole è¿œç¨‹ç›‘æ§é…ç½®ï¼š</p><p>éœ€è¦ä»¥å¦‚ä¸‹æ–¹å¼è¿è¡Œä½ çš„ java ç±»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Djava.rmi.server.hostname=`ipåœ°å€` -Dcom.sun.management.jmxremote Dcom.sun.management.jmxremote.port=`è¿æ¥ç«¯å£` -Dcom.sun.management.jmxremote.ssl=æ˜¯å¦å®‰å…¨è¿æ¥ -Dcom.sun.management.jmxremote.authenticate=æ˜¯å¦è®¤è¯ javaç±»</span><br></pre></td></tr></table></figure><h2 id="åŸç†ä¹‹çº¿ç¨‹è¿è¡Œ"><a href="#åŸç†ä¹‹çº¿ç¨‹è¿è¡Œ" class="headerlink" title="åŸç†ä¹‹çº¿ç¨‹è¿è¡Œ"></a>åŸç†ä¹‹çº¿ç¨‹è¿è¡Œ</h2><h3 id="æ ˆä¸æ ˆå¸§"><a href="#æ ˆä¸æ ˆå¸§" class="headerlink" title="æ ˆä¸æ ˆå¸§"></a>æ ˆä¸æ ˆå¸§</h3><ol><li><p>è™šæ‹Ÿæœºæ ˆï¼š<strong>çº¿ç¨‹</strong>è¿è¡Œéœ€è¦çš„å†…å­˜ç©ºé—´</p></li><li><p>æ ˆå¸§ï¼šæ¯ä¸ª<strong>æ–¹æ³•</strong>è¿è¡Œæ—¶éœ€è¦çš„å†…å­˜</p></li></ol><p>ç»“åˆJVMå­¦ä¹ çŸ¥è¯†</p><p><img src="/../assets/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/image-20230903213826052.png" alt="çº¿ç¨‹è¿è¡Œå›¾è§£"></p><blockquote><p>å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆå†…å­˜ï¼Œäº’ä¸å¹²æ‰°</p></blockquote><h3 id="çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"></a>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</h3><p>å› ä¸ºä»¥ä¸‹ä¸€äº›åŸå› å¯¼è‡´ <strong>cpu ä¸å†æ‰§è¡Œå½“å‰çš„çº¿ç¨‹ï¼Œè½¬è€Œæ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹çš„ä»£ç </strong> </p><ul><li>çº¿ç¨‹çš„ cpu æ—¶é—´ç‰‡ç”¨å®Œ </li><li>åƒåœ¾å›æ”¶ </li><li>æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹éœ€è¦è¿è¡Œ </li><li>çº¿ç¨‹è‡ªå·±è°ƒç”¨äº† sleepã€yieldã€waitã€joinã€parkã€synchronizedã€lock ç­‰æ–¹æ³•</li></ul><p>å½“çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å‘ç”Ÿæ—¶ï¼Œéœ€è¦ç”±æ“ä½œç³»ç»Ÿä¿å­˜å½“å‰çº¿ç¨‹çš„çŠ¶æ€ï¼Œå¹¶æ¢å¤å¦ä¸€ä¸ªçº¿ç¨‹çš„çŠ¶æ€ï¼ŒJava ä¸­å¯¹åº”çš„æ¦‚å¿µå°±æ˜¯<strong>ç¨‹åºè®¡æ•°å™¨</strong>ï¼ˆProgram Counter Registerï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯<strong>è®°ä½ä¸‹ä¸€æ¡ jvm æŒ‡ä»¤çš„æ‰§è¡Œåœ°å€ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„</strong> </p><ul><li>çŠ¶æ€åŒ…æ‹¬<strong>ç¨‹åºè®¡æ•°å™¨</strong>ã€<strong>è™šæ‹Ÿæœºæ ˆä¸­æ¯ä¸ªæ ˆå¸§çš„ä¿¡æ¯</strong>ï¼Œå¦‚å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆã€è¿”å›åœ°å€ç­‰ </li><li>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢<strong>é¢‘ç¹</strong>å‘ç”Ÿä¼š<strong>å½±å“æ€§èƒ½</strong></li></ul><h2 id="å¸¸è§æ–¹æ³•"><a href="#å¸¸è§æ–¹æ³•" class="headerlink" title="å¸¸è§æ–¹æ³•"></a>å¸¸è§æ–¹æ³•</h2><table><thead><tr><th align="center">æ–¹æ³•å</th><th align="center">static</th><th align="center">åŠŸèƒ½è¯´æ˜</th><th align="center">æ³¨æ„</th></tr></thead><tbody><tr><td align="center">start()</td><td align="center"></td><td align="center">å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œåœ¨æ–°çš„çº¿ç¨‹è¿è¡Œrunæ–¹æ³•ä¸­çš„ä»£ç </td><td align="center">startæ–¹æ³•åªæ˜¯è®©çº¿ç¨‹è¿›å…¥å°±ç»ªï¼Œé‡Œé¢ä»£ç ä¸ä¸€å®šç«‹åˆ»è¿è¡Œï¼ˆCPUçš„æ—¶é—´ç‰‡è¿˜æ²¡åˆ†ç»™å®ƒï¼‰ã€‚æ¯ä¸ªçº¿ç¨‹å¯¹è±¡çš„startæ–¹æ³•åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œå¦‚æœè°ƒç”¨äº†å¤šæ¬¡ä¼šå‡ºç°IllegalThreadStateExceptionçš„é”™è¯¯</td></tr><tr><td align="center">run()</td><td align="center"></td><td align="center">æ–°çº¿ç¨‹å¯åŠ¨åä¼šè°ƒç”¨çš„æ–¹æ³•</td><td align="center">å¦‚æœåœ¨æ„é€ Threadå¯¹è±¡æ—¶ä¼ é€’äº†Runnableå‚æ•°ï¼Œåˆ™çº¿ç¨‹å¯åŠ¨åä¼šè°ƒç”¨Runnableä¸­çš„runæ–¹æ³•ï¼Œå¦åˆ™é»˜è®¤ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ä½†å¯ä»¥åˆ›å»ºThreadçš„å­ç±»å¯¹è±¡ï¼Œæ¥è¦†ç›–é»˜è®¤è¡Œä¸º</td></tr><tr><td align="center">join()</td><td align="center"></td><td align="center">ç­‰å¾…çº¿ç¨‹è¿è¡Œç»“æŸ</td><td align="center"></td></tr><tr><td align="center">join(long n)</td><td align="center"></td><td align="center">ç­‰å¾…çº¿ç¨‹è¿è¡Œç»“æŸï¼Œæœ€å¤šç­‰å¾…næ¯«ç§’</td><td align="center"></td></tr><tr><td align="center">getId()</td><td align="center"></td><td align="center">è·å–çº¿ç¨‹é•¿æ•´å‹çš„id</td><td align="center">idå”¯ä¸€</td></tr><tr><td align="center">getName()</td><td align="center"></td><td align="center">è·å–çº¿ç¨‹å</td><td align="center"></td></tr><tr><td align="center">setName(String)</td><td align="center"></td><td align="center">ä¿®æ”¹çº¿ç¨‹å</td><td align="center"></td></tr><tr><td align="center">getPriority()</td><td align="center"></td><td align="center">è·å–çº¿ç¨‹ä¼˜å…ˆçº§</td><td align="center"></td></tr><tr><td align="center">setPriority(int)</td><td align="center"></td><td align="center">ä¿®æ”¹çº¿ç¨‹ä¼˜å…ˆçº§</td><td align="center">Javaä¸­è§„å®šçº¿ç¨‹ä¼˜å…ˆçº§æ˜¯1~10çš„æ•´æ•°ï¼Œè¾ƒå¤§çš„ä¼˜å…ˆçº§èƒ½æé«˜è¯¥çº¿ç¨‹è¢«CPUè°ƒåº¦çš„æœºç‡</td></tr><tr><td align="center">getState()</td><td align="center"></td><td align="center">è·å–çº¿ç¨‹çŠ¶æ€</td><td align="center">Javaä¸­çº¿ç¨‹çŠ¶æ€æ˜¯ç”¨6ä¸ªenumè¡¨ç¤ºï¼Œåˆ†åˆ«ä¸ºï¼šNEW, RUNNABLE, BLOCKED, WAITING, TIMED_WAITING, TERMINATED</td></tr><tr><td align="center">isInterrupted()</td><td align="center">static</td><td align="center">åˆ¤æ–­æ˜¯å¦è¢«æ‰“æ–­</td><td align="center"><strong>ä¸ä¼šæ¸…é™¤æ‰“æ–­æ ‡è®°</strong></td></tr><tr><td align="center">isAlive()</td><td align="center">static</td><td align="center">çº¿ç¨‹æ˜¯å¦å­˜æ´»ï¼ˆè¿˜æ²¡æœ‰è¿è¡Œå®Œæ¯•ï¼‰</td><td align="center"></td></tr><tr><td align="center">interrupt()</td><td align="center">static</td><td align="center">æ‰“æ–­çº¿ç¨‹</td><td align="center">å¦‚æœè¢«æ‰“æ–­çº¿ç¨‹æ­£åœ¨sleepã€waitã€joinä¼šå¯¼è‡´è¢«æ‰“æ–­çš„çº¿ç¨‹æŠ›å‡ºInterruptedExceptionï¼Œå¹¶æ¸…é™¤æ‰“æ–­æ ‡è®°ï¼›å¦‚æœæ‰“æ–­çš„æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Œåˆ™ä¼šè®¾ç½®æ‰“æ–­æ ‡è®°ï¼›parkçš„çº¿ç¨‹è¢«æ‰“æ–­ï¼Œä¹Ÿä¼šè®¾ç½®æ‰“æ–­æ ‡è®°</td></tr><tr><td align="center">interrupted()</td><td align="center">static</td><td align="center">åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦è¢«æ‰“æ–­</td><td align="center"><strong>ä¼šæ¸…é™¤æ‰“æ–­æ ‡è®°</strong></td></tr></tbody></table><h2 id="startä¸run"><a href="#startä¸run" class="headerlink" title="startä¸run"></a>startä¸run</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            log.debug(Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                read(MP4_FULL_PATH);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>).run();</span><br><span class="line">        log.debug(<span class="string">&quot;do other things ...&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç çš„è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">17</span>:<span class="number">42</span>:<span class="number">59</span> [main] c.Sync - main</span><br><span class="line"><span class="number">17</span>:<span class="number">43</span>:<span class="number">03</span> [main] c.Sync - è¯»å–æ–‡ä»¶è€—æ—¶ï¼š3925ms</span><br><span class="line"><span class="number">17</span>:<span class="number">43</span>:<span class="number">03</span> [main] c.Sync - <span class="keyword">do</span> other things ...</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹è§ä½¿ç”¨runæ–¹æ³•å»æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹æ—¶æ˜¯å•çº¿ç¨‹çš„ï¼Œå¹¶ä¸ä¼šå¼‚æ­¥åœ°å»è°ƒç”¨æ–°çº¿ç¨‹<code>t1</code>ã€‚</p><p>å°†runæ–¹æ³•æ”¹ä¸ºstartæ–¹æ³•åï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">17</span>:<span class="number">50</span>:<span class="number">13</span> [main] c.Sync - <span class="keyword">do</span> other things ...</span><br><span class="line"><span class="number">17</span>:<span class="number">50</span>:<span class="number">13</span> [t1] c.Sync - t1</span><br><span class="line"><span class="number">17</span>:<span class="number">50</span>:<span class="number">17</span> [t1] c.Sync - è¯»å–æ–‡ä»¶è€—æ—¶ï¼š3844ms</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°çº¿ç¨‹å¼‚æ­¥è°ƒç”¨ã€‚</p><hr><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><blockquote><ul><li>ç›´æ¥è°ƒç”¨run()æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œäº†run()ï¼Œå¹¶æ²¡æœ‰ç›´æ¥å¯åŠ¨æ–°çº¿ç¨‹</li><li>ä½¿ç”¨startæ˜¯å¯åŠ¨æ–°çš„çº¿ç¨‹ï¼Œé€šè¿‡æ–°çš„çº¿ç¨‹é—´æ¥æ‰§è¡Œrun()ä¸­çš„ä»£ç </li></ul></blockquote><h2 id="sleepä¸yield"><a href="#sleepä¸yield" class="headerlink" title="sleepä¸yield"></a>sleepä¸yield</h2><h3 id="sleep"><a href="#sleep" class="headerlink" title="sleep"></a>sleep</h3><ol><li>è°ƒç”¨ sleep ä¼šè®©å½“å‰çº¿ç¨‹ä» Running è¿›å…¥ Timed Waiting çŠ¶æ€ï¼ˆé˜»å¡ï¼‰ </li><li>å…¶å®ƒçº¿ç¨‹å¯ä»¥ä½¿ç”¨ interrupt æ–¹æ³•æ‰“æ–­æ­£åœ¨ç¡çœ çš„çº¿ç¨‹ï¼Œè¿™æ—¶ sleep æ–¹æ³•ä¼šæŠ›å‡º InterruptedException </li><li>ç¡çœ ç»“æŸåçš„çº¿ç¨‹æœªå¿…ä¼šç«‹åˆ»å¾—åˆ°æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯å°±ç»ªæ€ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿæœªå¿…ä¼šç»™äºˆcpuè¿›è¡Œæ‰§è¡Œ</li><li>å»ºè®®ç”¨ TimeUnit çš„ sleep ä»£æ›¿ Thread çš„ sleep æ¥è·å¾—æ›´å¥½çš„å¯è¯»æ€§ï¼Œä¾‹å¦‚<code>TimeUnit.SECONDS.sleep(1)</code>è¡¨ç¤ºçº¿ç¨‹ä¼‘çœ 1ç§’</li></ol><h3 id="yield"><a href="#yield" class="headerlink" title="yield"></a>yield</h3><ol><li>è°ƒç”¨ yield ä¼šè®©å½“å‰çº¿ç¨‹ä» Running è¿›å…¥ Runnable å°±ç»ªçŠ¶æ€ï¼Œç„¶åè°ƒåº¦æ‰§è¡Œå…¶å®ƒçº¿ç¨‹ </li><li>å…·ä½“çš„å®ç°ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦å™¨</li></ol><h3 id="äºŒè€…åŒºåˆ«â­â­â­"><a href="#äºŒè€…åŒºåˆ«â­â­â­" class="headerlink" title="äºŒè€…åŒºåˆ«â­â­â­"></a>äºŒè€…åŒºåˆ«â­â­â­</h3><ul><li><code>sleep</code>æ–¹æ³•å°†çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€è½¬ç§»åˆ°é˜»å¡çŠ¶æ€ï¼Œçº¿ç¨‹åœ¨æŒ‡å®šçš„æ—¶é—´åè¿”å›åˆ°å°±ç»ªçŠ¶æ€ã€‚</li><li><code>yield</code>æ–¹æ³•å°†çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€è½¬ç§»åˆ°å°±ç»ªçŠ¶æ€ï¼Œçº¿ç¨‹æ„¿æ„è®©å‡ºCPUæ—¶é—´ç‰‡ç»™å…¶ä»–çº¿ç¨‹ã€‚</li></ul><ul><li>çº¿ç¨‹åªæœ‰åœ¨å°±ç»ªçŠ¶æ€ä¸‹æ‰èƒ½è·å¾—æ—¶é—´ç‰‡ï¼Œè€Œåœ¨é˜»å¡çŠ¶æ€ä¸ä¼šåˆ†é…æ—¶é—´ç‰‡ã€‚</li></ul><h3 id="çº¿ç¨‹ä¼˜å…ˆçº§"><a href="#çº¿ç¨‹ä¼˜å…ˆçº§" class="headerlink" title="çº¿ç¨‹ä¼˜å…ˆçº§"></a>çº¿ç¨‹ä¼˜å…ˆçº§</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t1.setPriority(Thread.MIN_PRIORITY);</span><br></pre></td></tr></table></figure><p>è¯¥æ–¹æ³•æœ‰åä¸ªä¼˜å…ˆçº§ï¼Œä»1åˆ°10ï¼Œé»˜è®¤ä¸º5ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šå¤§</p><blockquote><p>éœ€æ³¨æ„ï¼šyieldå’Œè¿™ä¸ªçº¿ç¨‹ä¼˜å…ˆçº§éƒ½æ˜¯ä½œä¸ºæç¤ºåŠŸèƒ½ï¼Œå…·ä½“è¿˜æ˜¯çœ‹ä»»åŠ¡è°ƒåº¦å™¨åˆ†é…çš„æ—¶é—´ç‰‡</p></blockquote><h3 id="sleepå®ç”¨æ¡ˆä¾‹"><a href="#sleepå®ç”¨æ¡ˆä¾‹" class="headerlink" title="sleepå®ç”¨æ¡ˆä¾‹"></a>sleepå®ç”¨æ¡ˆä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"> <span class="keyword">try</span> &#123;</span><br><span class="line"> Thread.sleep(<span class="number">50</span>);</span><br><span class="line"> &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"> e.printStackTrace();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œä¸ºé˜²æ­¢æ— é™æ­»å¾ªç¯ä¸€ç›´å ç”¨cpuï¼Œå¯ä½¿ç”¨sleepæˆ–yieldæ–¹æ³•è¿›è¡Œä¼‘çœ ï¼Œä¸è®©è¿™ä¸ªç¨‹åºä¸€ç›´å ç”¨cpu</p><h2 id="joinæ–¹æ³•è¯¦è§£"><a href="#joinæ–¹æ³•è¯¦è§£" class="headerlink" title="joinæ–¹æ³•è¯¦è§£"></a>joinæ–¹æ³•è¯¦è§£</h2><h3 id="joinæ–¹æ³•"><a href="#joinæ–¹æ³•" class="headerlink" title="joinæ–¹æ³•"></a>joinæ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    log.debug(<span class="string">&quot;ä¸»çº¿ç¨‹å¼€å§‹&quot;</span>);</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;t1å¼€å§‹&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        r = <span class="number">10</span>;</span><br><span class="line">        log.debug(<span class="string">&quot;t1ç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line">    t1.start();</span><br><span class="line">    t1.join();</span><br><span class="line">    log.debug(<span class="string">&quot;ç»“æœä¸ºï¼š&#123;&#125;&quot;</span>, r);</span><br><span class="line">    log.debug(<span class="string">&quot;ä¸»çº¿ç¨‹ç»“æŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¸­ä¸»çº¿ç¨‹ä¼šç­‰å¾…t1çº¿ç¨‹è¿è¡Œç»“æŸåæ‰æ‰§è¡Œåç»­çš„æ“ä½œï¼Œå¦‚ä¸‹ä¸ºå›¾è§£ï¼š</p><p><img src="/../assets/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/image-20230904132856038.png" alt="image-20230904132856038"></p><h3 id="ç­‰å¾…å¤šä¸ªç»“æœ"><a href="#ç­‰å¾…å¤šä¸ªç»“æœ" class="headerlink" title="ç­‰å¾…å¤šä¸ªç»“æœ"></a>ç­‰å¾…å¤šä¸ªç»“æœ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// ä¼‘çœ 1s</span></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        r1 = <span class="number">10</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// ä¼‘çœ 2s</span></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        r2 = <span class="number">20</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    t1.start();</span><br><span class="line">    t2.start();</span><br><span class="line">    t1.join();</span><br><span class="line">    t2.join();</span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    log.debug(<span class="string">&quot;r1ï¼š&#123;&#125;ï¼Œr2ï¼š&#123;&#125;ï¼Œè€—æ—¶ï¼š&#123;&#125;ms&quot;</span>, r1, r2, end - start);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™æ®µä»£ç ä¸­æœ‰t1çº¿ç¨‹å’Œt2çº¿ç¨‹ï¼Œå³ä½¿é¢ å€’ä¸¤ä¸ªjoinæ–¹æ³•çš„æ‰§è¡Œé¡ºåºï¼Œç­‰å¾…æ—¶é—´ä¾ç„¶æ˜¯ä¸¤ç§’ï¼Œå¦‚ä¸‹ä¸ºå›¾è§£ï¼š</p><p><img src="/../assets/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/image-20230904133129345.png" alt="image-20230904133129345"></p><h3 id="æœ‰æ—¶æ•ˆçš„joinæ–¹æ³•"><a href="#æœ‰æ—¶æ•ˆçš„joinæ–¹æ³•" class="headerlink" title="æœ‰æ—¶æ•ˆçš„joinæ–¹æ³•"></a>æœ‰æ—¶æ•ˆçš„joinæ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t1.join(<span class="number">500</span>);<span class="comment">//æœ€å¤šç­‰0.5s</span></span><br></pre></td></tr></table></figure><ul><li><p>å¦‚æœçº¿ç¨‹è¶…è¿‡è¿™ä¸ªæ—¶é—´è¿˜æœªç»“æŸï¼Œåˆ™å°±ä¸ç­‰å¾…äº†ã€‚</p></li><li><p>å¦‚æœçº¿ç¨‹åœ¨è¿™ä¸ªæ—¶é—´å†…æå‰ç»“æŸï¼Œé‚£ä¹ˆä¹Ÿç›´æ¥ç»“æŸäº†ï¼Œå¹¶ä¸ä¼šä¸€ç›´ç­‰å¤Ÿé‚£ä¹ˆå¤šæ—¶é—´ã€‚</p></li></ul><h2 id="interruptæ–¹æ³•è¯¦è§£"><a href="#interruptæ–¹æ³•è¯¦è§£" class="headerlink" title="interruptæ–¹æ³•è¯¦è§£"></a>interruptæ–¹æ³•è¯¦è§£</h2><blockquote><p>è¿™é‡Œè¯´çš„æ‰“æ–­å¹¶ä¸æ˜¯çœŸçš„ç›´æ¥æ‰“æ–­ï¼Œä¹Ÿåªæ˜¯èµ·åˆ°ä¸€ä¸ª<strong>æç¤º</strong>çš„ä½œç”¨è€Œå·²</p></blockquote><h3 id="æ‰“æ–­-sleepï¼Œwaitï¼Œjoin-çš„çº¿ç¨‹"><a href="#æ‰“æ–­-sleepï¼Œwaitï¼Œjoin-çš„çº¿ç¨‹" class="headerlink" title="æ‰“æ–­ sleepï¼Œwaitï¼Œjoin çš„çº¿ç¨‹"></a>æ‰“æ–­ sleepï¼Œwaitï¼Œjoin çš„çº¿ç¨‹</h3><p>è¿™å‡ ä¸ªæ–¹æ³•éƒ½ä¼šè®©çº¿ç¨‹è¿›å…¥<strong>é˜»å¡çŠ¶æ€</strong></p><p>æ‰“æ–­ sleep çš„çº¿ç¨‹, ä¼šæ¸…ç©ºæ‰“æ–­çŠ¶æ€ï¼Œä»¥ sleep ä¸ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"> <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line"> sleep(<span class="number">1</span>);</span><br><span class="line"> &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line"> t1.start();</span><br><span class="line"> sleep(<span class="number">0.5</span>);</span><br><span class="line"> t1.interrupt();</span><br><span class="line"> log.debug(<span class="string">&quot; æ‰“æ–­çŠ¶æ€: &#123;&#125;&quot;</span>, t1.isInterrupted());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">java.lang.InterruptedException: sleep interrupted</span><br><span class="line"> at java.lang.Thread.sleep(Native Method)</span><br><span class="line"> at java.lang.Thread.sleep(Thread.java:<span class="number">340</span>)</span><br><span class="line"> at java.util.concurrent.TimeUnit.sleep(TimeUnit.java:<span class="number">386</span>)</span><br><span class="line"> at cn.itcast.n2.util.Sleeper.sleep(Sleeper.java:<span class="number">8</span>)</span><br><span class="line"> at cn.itcast.n4.TestInterrupt.lambda$test1$<span class="number">3</span>(TestInterrupt.java:<span class="number">59</span>)</span><br><span class="line"> at java.lang.Thread.run(Thread.java:<span class="number">745</span>)</span><br><span class="line"><span class="number">21</span>:<span class="number">18</span>:<span class="number">10.374</span> [main] c.TestInterrupt - æ‰“æ–­çŠ¶æ€: <span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="æ‰“æ–­æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹"><a href="#æ‰“æ–­æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹" class="headerlink" title="æ‰“æ–­æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹"></a>æ‰“æ–­æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹</h3><p>æ‰“æ–­æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹, ä¸ä¼šæ¸…ç©ºæ‰“æ–­çŠ¶æ€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"> <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line"> <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"> <span class="type">Thread</span> <span class="variable">current</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line"> <span class="type">boolean</span> <span class="variable">interrupted</span> <span class="operator">=</span> current.isInterrupted();</span><br><span class="line"> <span class="keyword">if</span>(interrupted) &#123;</span><br><span class="line"> log.debug(<span class="string">&quot; æ‰“æ–­çŠ¶æ€: &#123;&#125;&quot;</span>, interrupted);</span><br><span class="line"> <span class="keyword">break</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line"> t2.start();</span><br><span class="line"> sleep(<span class="number">0.5</span>);</span><br><span class="line"> t2.interrupt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å…¥ç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">20</span>:<span class="number">57</span>:<span class="number">37.964</span> [t2] c.TestInterrupt - æ‰“æ–­çŠ¶æ€: <span class="literal">true</span> </span><br></pre></td></tr></table></figure><h3 id="ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ï¼ˆé€šè¿‡interruptå®ç°ï¼‰â­â­â­"><a href="#ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ï¼ˆé€šè¿‡interruptå®ç°ï¼‰â­â­â­" class="headerlink" title="ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ï¼ˆé€šè¿‡interruptå®ç°ï¼‰â­â­â­"></a>ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ï¼ˆé€šè¿‡interruptå®ç°ï¼‰â­â­â­</h3><blockquote><p>ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼æ˜¯è½¯ä»¶å·¥ç¨‹é¢†åŸŸä¸­çš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œé€šå¸¸ç”¨äºç¡®ä¿åœ¨ç»ˆæ­¢ç¨‹åºæˆ–ç³»ç»Ÿæ—¶æ‰§è¡Œå¿…è¦çš„æ¸…ç†å·¥ä½œï¼Œä»¥é˜²æ­¢èµ„æºæ³„æ¼æˆ–å…¶ä»–ä¸è‰¯å½±å“ã€‚è¿™ä¸ªæ¨¡å¼åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p><ol><li>ç¬¬ä¸€é˜¶æ®µï¼ˆå‡†å¤‡é˜¶æ®µï¼‰ï¼š</li></ol><ul><li>åœ¨è¿™ä¸ªé˜¶æ®µï¼Œç¨‹åºæˆ–ç³»ç»Ÿå¼€å§‹å‡†å¤‡å…³é—­æ“ä½œã€‚å®ƒå¯èƒ½åŒ…æ‹¬ä»¥ä¸‹ä»»åŠ¡ï¼š<ul><li>åœæ­¢æ¥å—æ–°çš„è¯·æ±‚æˆ–äº‹åŠ¡ã€‚</li><li>å®Œæˆæ­£åœ¨è¿›è¡Œçš„ä»»åŠ¡æˆ–äº‹åŠ¡ã€‚</li><li>ç¡®ä¿ä¸å†åˆ†é…æˆ–ä½¿ç”¨æ–°çš„èµ„æºã€‚</li></ul></li></ul><ol start="2"><li>ç¬¬äºŒé˜¶æ®µï¼ˆç»ˆæ­¢é˜¶æ®µï¼‰ï¼š</li></ol><ul><li>åœ¨è¿™ä¸ªé˜¶æ®µï¼Œç¨‹åºæˆ–ç³»ç»Ÿæ‰§è¡Œå®é™…çš„å…³é—­æ“ä½œã€‚è¿™é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹ä»»åŠ¡ï¼š<ul><li>é‡Šæ”¾å·²åˆ†é…çš„èµ„æºï¼Œå¦‚å†…å­˜ã€æ–‡ä»¶å¥æŸ„ã€æ•°æ®åº“è¿æ¥ç­‰ã€‚</li><li>æ‰§è¡Œæ¸…ç†å·¥ä½œï¼Œä¾‹å¦‚å…³é—­æ‰“å¼€çš„æ–‡ä»¶ã€æ–­å¼€ç½‘ç»œè¿æ¥ã€ä¿å­˜çŠ¶æ€ä¿¡æ¯ç­‰ã€‚</li><li>å‘é€ç»ˆæ­¢é€šçŸ¥æˆ–äº‹ä»¶ï¼Œä»¥ä¾¿å…¶ä»–ç»„ä»¶æˆ–ç³»ç»Ÿå¯ä»¥åšå‡ºç›¸åº”çš„å“åº”ã€‚</li></ul></li></ul><p>ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼çš„ç›®æ ‡æ˜¯ç¡®ä¿ç¨‹åºæˆ–ç³»ç»Ÿåœ¨å…³é—­æ—¶èƒ½å¤Ÿå®‰å…¨åœ°é‡Šæ”¾èµ„æºå¹¶ç»´æŠ¤æ•°æ®çš„å®Œæ•´æ€§ã€‚è¿™æœ‰åŠ©äºé¿å…èµ„æºæ³„æ¼å’Œä¸ç¨³å®šçš„çŠ¶æ€ã€‚</p></blockquote><blockquote><p>åœ¨ä¸€ä¸ªçº¿ç¨‹T1ä¸­å¦‚ä½•ä¼˜é›…çš„ç»ˆæ­¢çº¿ç¨‹T2ï¼Ÿè¿™é‡Œçš„ä¼˜é›…æŒ‡çš„æ˜¯ç»™T2ä¸€ä¸ªæ–™ç†åäº‹çš„æœºä¼š</p></blockquote><p><img src="/../assets/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/image-20230904215106648.png" alt="å®ç°æ€è·¯"></p><p>ä»£ç å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TPTInterrupt</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Thread thread;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        thread = <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="type">Thread</span> <span class="variable">current</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">                <span class="keyword">if</span> (current.isInterrupted()) &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;æ–™ç†åäº‹&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                    log.debug(<span class="string">&quot;å°†ç»“æœä¿å­˜&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    current.interrupt();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// æ‰§è¡Œç›‘æ§æ“ä½œ</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;ç›‘æ§çº¿ç¨‹&quot;</span>);</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span> &#123;</span><br><span class="line">        thread.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TPTInterrupt</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TPTInterrupt</span>();</span><br><span class="line">t.start();</span><br><span class="line">Thread.sleep(<span class="number">3500</span>);</span><br><span class="line">log.debug(<span class="string">&quot;stop&quot;</span>);</span><br><span class="line">t.stop();</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">11</span>:<span class="number">49</span>:<span class="number">42.915</span> c.TwoPhaseTermination [ç›‘æ§çº¿ç¨‹] - å°†ç»“æœä¿å­˜</span><br><span class="line"><span class="number">11</span>:<span class="number">49</span>:<span class="number">43.919</span> c.TwoPhaseTermination [ç›‘æ§çº¿ç¨‹] - å°†ç»“æœä¿å­˜</span><br><span class="line"><span class="number">11</span>:<span class="number">49</span>:<span class="number">44.919</span> c.TwoPhaseTermination [ç›‘æ§çº¿ç¨‹] - å°†ç»“æœä¿å­˜</span><br><span class="line"><span class="number">11</span>:<span class="number">49</span>:<span class="number">45.413</span> c.TestTwoPhaseTermination [main] - stop</span><br><span class="line"><span class="number">11</span>:<span class="number">49</span>:<span class="number">45.413</span> c.TwoPhaseTermination [ç›‘æ§çº¿ç¨‹] - æ–™ç†åäº‹</span><br></pre></td></tr></table></figure><h3 id="æ‰“æ–­parkçº¿ç¨‹"><a href="#æ‰“æ–­parkçº¿ç¨‹" class="headerlink" title="æ‰“æ–­parkçº¿ç¨‹"></a>æ‰“æ–­parkçº¿ç¨‹</h3><p>ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼Œæ‰§è¡Œparkå‘½ä»¤æ—¶ï¼Œçº¿ç¨‹ä¼šæš‚åœåœ¨é‚£é‡Œï¼Œåªæœ‰å½“interruptä¸ºå‡æ—¶æ‰ä¼šæš‚åœåœ¨é‚£é‡Œï¼Œå½“interruptä¸ºçœŸæ—¶çº¿ç¨‹å°±ä¸ä¼šå› è¯¥æ¡è¯­å¥è€Œæš‚åœï¼Œä¼šè·³è¿‡è¿™è¡Œä»£ç è€Œè¿›è¡Œä¸‹é¢çš„æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LockSupport.park();</span><br></pre></td></tr></table></figure><blockquote><p>parkçš„çº¿ç¨‹è¢«æ‰“æ–­ï¼Œä¹Ÿä¼šè®¾ç½®æ‰“æ–­æ ‡è®°ï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è¿›è¡Œparkæ‰“æ–­åï¼Œæ­¤æ—¶çš„interruptå°±ä¸ºçœŸäº†ï¼Œåªæœ‰åœ¨åé¢æ‰‹åŠ¨ä¿®æ”¹interruptä¸ºå‡æ‰èƒ½ç»§ç»­ä½¿ç”¨parkæ‰“æ–­ã€‚</p></blockquote><h2 id="ä¸æ¨èçš„æ–¹æ³•"><a href="#ä¸æ¨èçš„æ–¹æ³•" class="headerlink" title="ä¸æ¨èçš„æ–¹æ³•"></a>ä¸æ¨èçš„æ–¹æ³•</h2><p>è¿™ä¸‰ä¸ªæ–¹æ³•å·²ç»è¿‡æ—¶ï¼Œè€Œä¸”å®¹æ˜“ç ´ååŒæ­¥ä»£ç å—ï¼Œé€ æˆçº¿ç¨‹æ­»é”</p><table><thead><tr><th align="center">æ–¹æ³•å</th><th align="center">static</th><th align="center">åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td align="center">stop()</td><td align="center"></td><td align="center">åœæ­¢çº¿ç¨‹è¿è¡Œ</td></tr><tr><td align="center">suspend()</td><td align="center"></td><td align="center">æŒ‚èµ·ï¼ˆæš‚åœï¼‰çº¿ç¨‹è¿è¡Œ</td></tr><tr><td align="center">resume()</td><td align="center"></td><td align="center">æ¢å¤çº¿ç¨‹è¿è¡Œ</td></tr></tbody></table><h2 id="ä¸»çº¿ç¨‹ä¸å®ˆæŠ¤çº¿ç¨‹"><a href="#ä¸»çº¿ç¨‹ä¸å®ˆæŠ¤çº¿ç¨‹" class="headerlink" title="ä¸»çº¿ç¨‹ä¸å®ˆæŠ¤çº¿ç¨‹"></a>ä¸»çº¿ç¨‹ä¸å®ˆæŠ¤çº¿ç¨‹</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒJavaçº¿ç¨‹éœ€è¦ç­‰å¾…æ‰€æœ‰çº¿ç¨‹éƒ½è¿è¡Œç»“æŸï¼Œæ‰ä¼šç»“æŸã€‚</p><p>æœ‰ä¸€ç§ç‰¹æ®Šçš„çº¿ç¨‹å«åšå®ˆæŠ¤çº¿ç¨‹ï¼Œåªè¦å…¶å®ƒéå®ˆæŠ¤çº¿ç¨‹è¿è¡Œç»“æŸäº†ï¼Œå³ä½¿å®ˆæŠ¤çº¿ç¨‹çš„ä»£ç æ²¡æœ‰æ‰§è¡Œå®Œï¼Œä¹Ÿä¼šå¼ºåˆ¶ç»“æŸ</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;å®ˆæŠ¤çº¿ç¨‹å¼€å§‹æ‰§è¡Œ&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        log.debug(<span class="string">&quot;å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line">    <span class="comment">// è®¾ç½®è¯¥çº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹</span></span><br><span class="line">    t1.setDaemon(<span class="literal">true</span>);</span><br><span class="line">    t1.start();</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    log.debug(<span class="string">&quot;éå®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œå› ä¸ºt1çº¿ç¨‹è¢«è®¾ç½®ä¸ºäº†å®ˆæŠ¤çº¿ç¨‹ï¼Œå› ä¸ºå…¶ä»–éå®ˆæŠ¤çº¿ç¨‹ï¼Œå³è¿™é‡Œçš„ä¸»çº¿ç¨‹åœæ­¢äº†ï¼Œå³ä½¿t1é‡Œé¢æœ‰ä¸ªæ­»å¾ªç¯ä¹Ÿè¦å¼ºåˆ¶åœæ­¢ã€‚</p><hr><ul><li>åƒåœ¾å›æ”¶çº¿ç¨‹å°±æ˜¯ä¸€ç§å®ˆæŠ¤çº¿ç¨‹</li><li>Tomcatä¸­çš„Acceptorå’ŒPollerçº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œæ‰€ä»¥Tomcatæ¥æ”¶åˆ°shutdownå‘½ä»¤åç§’å›ç­‰å¾…å®ƒä»¬å¤„ç†å®Œå½“å‰è¯·æ±‚</li></ul><h2 id="äº”ç§çŠ¶æ€"><a href="#äº”ç§çŠ¶æ€" class="headerlink" title="äº”ç§çŠ¶æ€"></a>äº”ç§çŠ¶æ€</h2><p>äº”ç§çŠ¶æ€æ˜¯ä»<strong>æ“ä½œç³»ç»Ÿå±‚é¢</strong>è€ƒè™‘çš„</p><p><img src="/../assets/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/image-20230904222706849.png" alt="äº”ç§çŠ¶æ€"></p><ul><li><p><code>åˆå§‹çŠ¶æ€</code>ä»…æ˜¯åœ¨è¯­è¨€å±‚é¢åˆ›å»ºäº†çº¿ç¨‹å¯¹è±¡ï¼Œè¿˜æœªä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹å…³è” </p></li><li><p><code>å¯è¿è¡ŒçŠ¶æ€</code>ï¼ˆå°±ç»ªçŠ¶æ€ï¼‰æŒ‡è¯¥çº¿ç¨‹å·²ç»è¢«åˆ›å»ºï¼ˆä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹å…³è”ï¼‰ï¼Œå¯ä»¥ç”± CPU è°ƒåº¦æ‰§è¡Œ </p></li><li><p><code>è¿è¡ŒçŠ¶æ€</code>æŒ‡è·å–äº† CPU æ—¶é—´ç‰‡è¿è¡Œä¸­çš„çŠ¶æ€ å½“ CPU æ—¶é—´ç‰‡ç”¨å®Œï¼Œä¼šä»<code>è¿è¡ŒçŠ¶æ€</code>è½¬æ¢è‡³<code>å¯è¿è¡ŒçŠ¶æ€</code>ï¼Œä¼šå¯¼è‡´çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢<code>é˜»å¡çŠ¶æ€</code></p><ul><li>å¦‚æœè°ƒç”¨äº†é˜»å¡ APIï¼Œå¦‚ BIO è¯»å†™æ–‡ä»¶ï¼Œè¿™æ—¶è¯¥çº¿ç¨‹å®é™…ä¸ä¼šç”¨åˆ° CPUï¼Œä¼šå¯¼è‡´çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿›å…¥<code>é˜»å¡çŠ¶æ€</code> </li><li>ç­‰ BIO æ“ä½œå®Œæ¯•ï¼Œä¼šç”±æ“ä½œç³»ç»Ÿå”¤é†’é˜»å¡çš„çº¿ç¨‹ï¼Œè½¬æ¢<code>è¿è¡ŒçŠ¶æ€</code> </li><li>ä¸<code>å¯è¿è¡ŒçŠ¶æ€</code>çš„åŒºåˆ«æ˜¯ï¼Œå¯¹<code>é˜»å¡çŠ¶æ€</code>çš„çº¿ç¨‹æ¥è¯´åªè¦å®ƒä»¬ä¸€ç›´ä¸å”¤é†’ï¼Œè°ƒåº¦å™¨å°±ä¸€ç›´ä¸ä¼šè€ƒè™‘ è°ƒåº¦å®ƒä»¬</li></ul></li><li><p><code>ç»ˆæ­¢çŠ¶æ€</code>è¡¨ç¤ºçº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸï¼Œä¸ä¼šå†è½¬æ¢ä¸ºå…¶å®ƒçŠ¶æ€</p></li></ul><h2 id="å…­ç§çŠ¶æ€"><a href="#å…­ç§çŠ¶æ€" class="headerlink" title="å…­ç§çŠ¶æ€"></a>å…­ç§çŠ¶æ€</h2><p>å…­ç§çŠ¶æ€æ˜¯ä» Java API å±‚é¢æ¥æè¿°çš„</p><p><img src="/../assets/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/image-20230904223924307.png" alt="å…­ç§çŠ¶æ€"></p><ul><li><p><code>NEW</code>ï¼šçº¿ç¨‹åˆšè¢«åˆ›å»ºï¼Œä½†è¿˜æ²¡æœ‰è°ƒç”¨start()æ–¹æ³•</p></li><li><p><code>RUNNABLE</code>ï¼šå½“è°ƒç”¨äº†start()æ–¹æ³•å</p><blockquote><p>æ³¨æ„ï¼šJava APIå±‚é¢çš„RUNNABLEçŠ¶æ€æ¶µç›–äº†æ“ä½œç³»ç»Ÿå±‚é¢çš„<strong>å¯è¿è¡ŒçŠ¶æ€ã€è¿è¡ŒçŠ¶æ€å’Œé˜»å¡çŠ¶æ€</strong></p></blockquote></li><li><p><code>BLOCKED</code>ã€<code>WAITINT</code>ã€<code>TIMED_WAITING</code>éƒ½æ˜¯Java APIå±‚é¢å¯¹é˜»å¡çŠ¶æ€çš„ç»†åˆ†ï¼Œåé¢ä¼šåœ¨çŠ¶æ€è½¬æ¢ä¸€èŠ‚è¯¦ç»†æè¿°</p></li><li><p><code>TERMINATED</code>ï¼šå½“çº¿ç¨‹ä»£ç è¿è¡Œç»“æŸ</p></li></ul><hr><ul><li>ä»£ç å±•ç¤º</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j(topic = &quot;c.TestState&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestState</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1. t1çº¿ç¨‹åˆšè¢«åˆ›å»ºï¼Œè¿˜æœªè°ƒç”¨start()æ–¹æ³•ï¼Œæ­¤æ—¶çŠ¶æ€ä¸º NEW</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t1&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;running...&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. t2çº¿ç¨‹å·²è¢«åˆ›å»ºï¼Œå¹¶ä¸”è°ƒç”¨äº†start()æ–¹æ³•ï¼Œç©ºå¾ªåä¼šä¿è¯t2çº¿ç¨‹ä¸ä¼šç»“æŸï¼Œæ­¤æ—¶çŠ¶æ€ä¸ºRUNNABLE</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t2&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">while</span>(<span class="literal">true</span>) &#123; <span class="comment">// runnable</span></span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        t2.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. t3çº¿ç¨‹åªæ˜¯æ‰“å°ä¸€æ¡æ—¥å¿—ï¼Œç”±äºä¸»çº¿ç¨‹ä¸­è°ƒç”¨äº†sleep()ï¼Œæ•…å½“æˆ‘ä»¬æŸ¥çœ‹t3çº¿ç¨‹çŠ¶æ€æ—¶ï¼Œt3å·²ç»æ‰§è¡Œå®Œæ¯•ï¼ŒçŠ¶æ€ä¸ºTERMINATED</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t3&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;running...&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        t3.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. t4çº¿ç¨‹ä¸­è°ƒç”¨äº†sleep()æ–¹æ³•ï¼ŒçŠ¶æ€ä¸ºtimed_waitingï¼Œå³æœ‰æ—¶é™çš„ç­‰å¾…ï¼Œæ³¨æ„æ­¤æ—¶t4è¿˜æ‹¿åˆ°äº†ä¸€æŠŠé”ï¼Œåé¢è¦ç”¨</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t4&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (TestState.class) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">1000000</span>); <span class="comment">// timed_waiting</span></span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        t4.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. t5çº¿ç¨‹ä¸­è°ƒç”¨äº†t2.join()ï¼Œéœ€è¦ç­‰å¾…t2çº¿ç¨‹ç»“æŸï¼Œæ•…çŠ¶æ€ä¸ºwaitingï¼Œå³æ— æ—¶é™çš„ç­‰å¾…</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t5&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    t2.join(); <span class="comment">// waiting</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        t5.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6. ç”±äºt4çº¿ç¨‹æ‹¿åˆ°äº†é”ï¼Œä½†ç”±äºt4åœ¨sleepï¼Œæ•…t6çº¿ç¨‹æ‹¿ä¸åˆ°é”ï¼Œä¼šè¢«é˜»å¡ï¼ŒçŠ¶æ€ä¸ºblocked</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t6</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t6&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (TestState.class) &#123; <span class="comment">// blocked</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">1000000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        t6.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        log.debug(<span class="string">&quot;t1 state &#123;&#125;&quot;</span>, t1.getState());</span><br><span class="line">        log.debug(<span class="string">&quot;t2 state &#123;&#125;&quot;</span>, t2.getState());</span><br><span class="line">        log.debug(<span class="string">&quot;t3 state &#123;&#125;&quot;</span>, t3.getState());</span><br><span class="line">        log.debug(<span class="string">&quot;t4 state &#123;&#125;&quot;</span>, t4.getState());</span><br><span class="line">        log.debug(<span class="string">&quot;t5 state &#123;&#125;&quot;</span>, t5.getState());</span><br><span class="line">        log.debug(<span class="string">&quot;t6 state &#123;&#125;&quot;</span>, t6.getState());</span><br><span class="line">        System.in.read();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">11</span>:<span class="number">02</span>:<span class="number">48.753</span> c.TestState [t3] - running...</span><br><span class="line"><span class="number">11</span>:<span class="number">02</span>:<span class="number">49.264</span> c.TestState [main] - t1 state NEW</span><br><span class="line"><span class="number">11</span>:<span class="number">02</span>:<span class="number">49.265</span> c.TestState [main] - t2 state RUNNABLE</span><br><span class="line"><span class="number">11</span>:<span class="number">02</span>:<span class="number">49.265</span> c.TestState [main] - t3 state TERMINATED</span><br><span class="line"><span class="number">11</span>:<span class="number">02</span>:<span class="number">49.265</span> c.TestState [main] - t4 state TIMED_WAITING</span><br><span class="line"><span class="number">11</span>:<span class="number">02</span>:<span class="number">49.265</span> c.TestState [main] - t5 state WAITING</span><br><span class="line"><span class="number">11</span>:<span class="number">02</span>:<span class="number">49.265</span> c.TestState [main] - t6 state BLOCKED</span><br></pre></td></tr></table></figure><h3 id="ç»Ÿç­¹ï¼ˆçƒ§æ°´æ³¡èŒ¶ï¼‰"><a href="#ç»Ÿç­¹ï¼ˆçƒ§æ°´æ³¡èŒ¶ï¼‰" class="headerlink" title="ç»Ÿç­¹ï¼ˆçƒ§æ°´æ³¡èŒ¶ï¼‰"></a>ç»Ÿç­¹ï¼ˆçƒ§æ°´æ³¡èŒ¶ï¼‰</h3><p>å…¶å®å°±æ˜¯ä¸ªå¤šçº¿ç¨‹çš„é—®é¢˜ï¼Œå¼€å››ä¸ªçº¿ç¨‹å¤ªæµªè´¹äº†æ‰€ä»¥å°±å¼€ä¸¤ä¸ªçº¿ç¨‹å®ç°å³å¯ã€‚</p><p><img src="/../assets/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/image-20230904231936646.png" alt="çƒ§æ°´æ³¡èŒ¶"></p><p>ä»£ç å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test_JUC</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ´—èŒ¶å£¶&quot;</span>);</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;çƒ§å¼€æ°´&quot;</span>);</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">15</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ´—èŒ¶å£¶,æ´—èŒ¶æ¯,æ‹¿èŒ¶å¶&quot;</span>);</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">4</span>);</span><br><span class="line">                    t1.join();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤ç§è§£æ³•çš„ç¼ºé™·</p><ul><li>ä¸Šé¢æ¨¡æ‹Ÿçš„æ˜¯Lucyç­‰Kyleçš„æ°´çƒ§å¼€äº†ï¼ŒLucyæ³¡èŒ¶ï¼Œå¦‚æœç°åœ¨è¦è®©Kyleç­‰LucyæŠŠèŒ¶å¶æ‹¿è¿‡æ¥ï¼Œç”±Kyleæ³¡èŒ¶å‘¢ï¼Ÿ</li><li>ä¸Šé¢ä¸¤ä¸ªçº¿ç¨‹å…¶å®æ˜¯å„æ‰§è¡Œå„çš„ï¼Œå¦‚æœè¦æ¨¡æ‹ŸKyleæŠŠæ°´å£¶äº¤ç»™Lucyæ³¡èŒ¶ï¼Œæˆ–è€…æ¨¡æ‹ŸLucyæŠŠèŒ¶å¶äº¤ç»™Kyleæ³¡èŒ¶å‘¢ï¼Ÿ</li></ul><p>è¿™ä¸ªç¼ºé™·åé¢ä¼šè§£å†³</p><h2 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æœ¬ç« çš„é‡ç‚¹åœ¨äºæŒæ¡ </p><ul><li><p>çº¿ç¨‹åˆ›å»º </p></li><li><p>çº¿ç¨‹é‡è¦ apiï¼Œå¦‚ startï¼Œrunï¼Œsleepï¼Œjoinï¼Œinterrupt ç­‰ </p></li><li><p>çº¿ç¨‹çŠ¶æ€ </p></li><li><p>åº”ç”¨æ–¹é¢ </p><ul><li>å¼‚æ­¥è°ƒç”¨ï¼šä¸»çº¿ç¨‹æ‰§è¡ŒæœŸé—´ï¼Œå…¶å®ƒçº¿ç¨‹å¼‚æ­¥æ‰§è¡Œè€—æ—¶æ“ä½œ </li><li>æé«˜æ•ˆç‡ï¼šå¹¶è¡Œè®¡ç®—ï¼Œç¼©çŸ­è¿ç®—æ—¶é—´ </li><li>åŒæ­¥ç­‰å¾…ï¼šjoin </li><li>ç»Ÿç­¹è§„åˆ’ï¼šåˆç†ä½¿ç”¨çº¿ç¨‹ï¼Œå¾—åˆ°æœ€ä¼˜æ•ˆæœ</li></ul></li><li><p>åŸç†æ–¹é¢ </p><ul><li>çº¿ç¨‹è¿è¡Œæµç¨‹ï¼šæ ˆã€æ ˆå¸§ã€ä¸Šä¸‹æ–‡åˆ‡æ¢ã€ç¨‹åºè®¡æ•°å™¨ </li><li>Thread ä¸¤ç§åˆ›å»ºæ–¹å¼çš„æºç </li></ul></li><li><p>æ¨¡å¼æ–¹é¢ </p><ul><li>ç»ˆæ­¢æ¨¡å¼ä¹‹ä¸¤é˜¶æ®µç»ˆæ­¢</li></ul></li></ul><h1 id="å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹"><a href="#å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹" class="headerlink" title="å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹"></a>å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹</h1><h2 id="å…±äº«å¸¦æ¥çš„é—®é¢˜"><a href="#å…±äº«å¸¦æ¥çš„é—®é¢˜" class="headerlink" title="å…±äº«å¸¦æ¥çš„é—®é¢˜"></a>å…±äº«å¸¦æ¥çš„é—®é¢˜</h2><p>åœ¨ä¸‹é¢è¿™æ®µä»£ç ä¸­ï¼Œè¿è¡Œå¾—åˆ°çš„ç»“æœå¹¶ä¸æ˜¯0ï¼Œè¿™å°±æ˜¯çº¿ç¨‹å…±äº«æ‰€å¸¦æ¥çš„é—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test_JUC</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++) &#123;</span><br><span class="line">                counter++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++) &#123;</span><br><span class="line">                counter--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t1.join();</span><br><span class="line">        t2.join();</span><br><span class="line">        System.out.println(counter);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="synchronizedè§£å†³æ–¹æ¡ˆ"><a href="#synchronizedè§£å†³æ–¹æ¡ˆ" class="headerlink" title="synchronizedè§£å†³æ–¹æ¡ˆ"></a>synchronizedè§£å†³æ–¹æ¡ˆ</h2><h2 id="æ–¹æ³•ä¸Šçš„synchronized"><a href="#æ–¹æ³•ä¸Šçš„synchronized" class="headerlink" title="æ–¹æ³•ä¸Šçš„synchronized"></a>æ–¹æ³•ä¸Šçš„synchronized</h2><h2 id="å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ"><a href="#å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ" class="headerlink" title="å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ"></a>å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ</h2><h2 id="Monitoræ¦‚å¿µ"><a href="#Monitoræ¦‚å¿µ" class="headerlink" title="Monitoræ¦‚å¿µ"></a>Monitoræ¦‚å¿µ</h2><h2 id="wait-notify"><a href="#wait-notify" class="headerlink" title="wait notify"></a>wait notify</h2><h2 id="Park-Unpark"><a href="#Park-Unpark" class="headerlink" title="Park &amp; Unpark"></a>Park &amp; Unpark</h2><h2 id="é‡æ–°ç†è§£çº¿ç¨‹çŠ¶æ€è½¬æ¢"><a href="#é‡æ–°ç†è§£çº¿ç¨‹çŠ¶æ€è½¬æ¢" class="headerlink" title="é‡æ–°ç†è§£çº¿ç¨‹çŠ¶æ€è½¬æ¢"></a>é‡æ–°ç†è§£çº¿ç¨‹çŠ¶æ€è½¬æ¢</h2><h2 id="å¤šæŠŠé”"><a href="#å¤šæŠŠé”" class="headerlink" title="å¤šæŠŠé”"></a>å¤šæŠŠé”</h2><h2 id="æ´»è·ƒæ€§"><a href="#æ´»è·ƒæ€§" class="headerlink" title="æ´»è·ƒæ€§"></a>æ´»è·ƒæ€§</h2><h2 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h2><h2 id="å°ç»“-2"><a href="#å°ç»“-2" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p><img src="/../assets/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/image-20231222155004346.png" alt="image-20231222155004346"></p>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¹¶å‘ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM</title>
      <link href="/2023/08/27/Study-JVM/"/>
      <url>/2023/08/27/Study-JVM/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>ğŸš—æœ¬ç¯‡æ–‡ç« å‚è€ƒè‡ªä»¥ä¸‹å­¦ä¹ èµ„æ–™ï¼š</p><p><a href="https://cyborg2077.github.io/">Kyleâ€™s Blog</a></p><p><a href="https://javaguide.cn/">JavaGuide</a></p><h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><ol><li>JVMï¼ŒJREï¼ŒJDKä¹‹é—´çš„åŒºåˆ«</li></ol><ul><li><code>JVM</code>ï¼ˆJava Virtual Machineï¼‰ï¼ŒJavaè™šæ‹Ÿæœº</li><li><code>JRE</code>ï¼ˆJava Runtime Environmentï¼‰ï¼ŒJavaè¿è¡Œç¯å¢ƒï¼ŒåŒ…å«äº†JVMå’ŒJavaçš„æ ¸å¿ƒç±»åº“ï¼ˆJava APIï¼‰</li><li><code>JDK</code>ï¼ˆJava Development Kitï¼‰ç§°ä¸ºJavaå¼€å‘å·¥å…·ï¼ŒåŒ…å«äº†JREå’Œå¼€å‘å·¥å…·</li></ul><p><img src="/../assets/JVM/image-20230827213038167.png" alt="image-20230827213038167"></p><hr><ol start="2"><li>å­¦ä¹ è·¯çº¿</li></ol><p><img src="/../assets/JVM/image-20230827212904317.png" alt="image-20230827212904317"></p><h1 id="å†…å­˜ç»“æ„"><a href="#å†…å­˜ç»“æ„" class="headerlink" title="å†…å­˜ç»“æ„"></a>å†…å­˜ç»“æ„</h1><p>æ–‡ç« å‚è€ƒè‡ªï¼š<a href="https://cyborg2077.github.io/2023/03/27/JvmPart2/">https://cyborg2077.github.io/2023/03/27/JvmPart2/</a></p><h2 id="ç¨‹åºè®¡æ•°å™¨"><a href="#ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨"></a>ç¨‹åºè®¡æ•°å™¨</h2><p>ç¨‹åºè®¡æ•°å™¨çš„ä½œç”¨å°±æ˜¯<strong>è®°ä½ä¸‹ä¸€æ¡jvmæŒ‡ä»¤çš„æ‰§è¡Œåœ°å€</strong></p><ul><li><p>çº¿ç¨‹ç§æœ‰ï¼šæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œç”¨äºä¿å­˜å½“å‰æ‰§è¡ŒæŒ‡ä»¤çš„åœ°å€ ï¼Œä¸€æ—¦æŒ‡ä»¤æ‰§è¡Œï¼Œç¨‹åºè®¡æ•°å™¨å°†è¢«ä¸‹ä¸€æ¡æŒ‡ä»¤æ›´æ–°</p></li><li><p>ä¸ä¼šå­˜åœ¨å†…å­˜æº¢å‡º</p></li></ul><p><img src="/../assets/JVM/image-20230828100657668.png" alt="image-20230828100657668"></p><h2 id="è™šæ‹Ÿæœºæ ˆ"><a href="#è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="è™šæ‹Ÿæœºæ ˆ"></a>è™šæ‹Ÿæœºæ ˆ</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><ol><li><p>è™šæ‹Ÿæœºæ ˆï¼š<strong>çº¿ç¨‹</strong>è¿è¡Œéœ€è¦çš„å†…å­˜ç©ºé—´</p></li><li><p>æ ˆå¸§ï¼šæ¯ä¸ª<strong>æ–¹æ³•</strong>è¿è¡Œæ—¶éœ€è¦çš„å†…å­˜</p></li></ol><blockquote><p>æ¯ä¸ªæ ˆç”±å¤šä¸ªæ ˆå¸§ï¼ˆFrameï¼‰ç»„æˆï¼Œå¯¹åº”ç€æ¯æ¬¡æ–¹æ³•è°ƒç”¨æ—¶æ‰€å ç”¨çš„å†…å­˜</p><p>æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§ï¼Œå¯¹åº”ç€å½“å‰æ­£åœ¨æ‰§è¡Œçš„é‚£ä¸ªæ–¹æ³•</p></blockquote><p><img src="/../assets/JVM/image-20230828101229662.png" alt="image-20230828101229662"></p><hr><blockquote><p>ä¾‹ï¼šæ–¹æ³•ä¸€è°ƒç”¨æ–¹æ³•äºŒï¼Œæ–¹æ³•äºŒè°ƒç”¨æ–¹æ³•ä¸‰ï¼Œæ–¹æ³•ä¸‰ç»“æŸæ‰èƒ½è®©æ–¹æ³•äºŒå’Œæ–¹æ³•ä¸€ä¾æ¬¡è¿”å›</p></blockquote><p><img src="/../assets/JVM/image-20230828101315797.png" alt="image-20230828101315797"></p><hr><ol><li>åƒåœ¾å›æ”¶æ˜¯å¦æ¶‰åŠæ ˆå†…å­˜ï¼Ÿ</li></ol><blockquote><p>ä¸æ¶‰åŠï¼Œæ ˆä¸­çš„æ ˆå¸§åœ¨è°ƒç”¨å®Œåä¼šè‡ªåŠ¨å¼¹å‡ºæ ˆï¼Œåƒåœ¾å›æ”¶åªç”¨äºå †ã€‚</p></blockquote><ol start="2"><li>æ ˆå†…å­˜åˆ†é…è¶Šå¤§è¶Šå¥½å—ï¼Ÿ</li></ol><blockquote><p>ä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œä¸€èˆ¬æ¥è¯´ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„å°±å¥½ï¼Œå› ä¸ºç‰©ç†å†…å­˜æ˜¯ä¸€å®šçš„ï¼Œæ ˆå†…å­˜åˆ†é…å¤šäº†åè€Œçº¿ç¨‹æ•°å°±å°‘äº†ï¼Œå¹¶å‘é‡ä¹Ÿä¸‹é™äº†ï¼Œåªæ˜¯æ¯ä¸ªæ ˆä¸­èƒ½è¿›è¡Œæ–¹æ³•é—´çš„è°ƒç”¨å¤šäº†è€Œå·²ã€‚</p></blockquote><ol start="3"><li>æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ</li></ol><blockquote><p>å¦‚æœæ–¹æ³•å†…å±€éƒ¨å˜é‡æ²¡æœ‰é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„</p><p>å¦‚æœæ˜¯å±€éƒ¨å˜é‡å¼•ç”¨äº†å¯¹è±¡ï¼Œå¹¶é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨</p></blockquote><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        method();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++) &#123;</span><br><span class="line">            x++;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">thread3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line"></span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">        thread3.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œçš„ä¸‰ä¸ªçº¿ç¨‹äº’ä¸å½±å“ï¼Œxä¸å—å½±å“æ¯ä¸ªéƒ½æ˜¯5000</p></blockquote><hr><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo_01</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        sb.append(<span class="number">4</span>);</span><br><span class="line">        sb.append(<span class="number">5</span>);</span><br><span class="line">        sb.append(<span class="number">6</span>);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            m2(sb);</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">m1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        sb.append(<span class="number">1</span>);</span><br><span class="line">        sb.append(<span class="number">2</span>);</span><br><span class="line">        sb.append(<span class="number">3</span>);</span><br><span class="line">        System.out.println(sb.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">m2</span><span class="params">(StringBuilder sb)</span> &#123;</span><br><span class="line">        sb.append(<span class="number">1</span>);</span><br><span class="line">        sb.append(<span class="number">2</span>);</span><br><span class="line">        sb.append(<span class="number">3</span>);</span><br><span class="line">        System.out.println(sb);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> StringBuilder <span class="title function_">m3</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        sb.append(<span class="number">1</span>);</span><br><span class="line">        sb.append(<span class="number">2</span>);</span><br><span class="line">        sb.append(<span class="number">3</span>);</span><br><span class="line">        <span class="keyword">return</span> sb;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œçš„m2å’Œm3å°±æ˜¯æ‰€è°“çš„é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œå› ä¸ºå…¶ä»–çº¿ç¨‹éƒ½æœ‰å¯èƒ½é€šè¿‡æ–¹æ³•å‚æ•°æˆ–è€…è¿”å›å€¼å»å¾—åˆ°æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡ï¼Œå°±è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜äº†</p></blockquote><h3 id="æ ˆå†…å­˜æº¢å‡º"><a href="#æ ˆå†…å­˜æº¢å‡º" class="headerlink" title="æ ˆå†…å­˜æº¢å‡º"></a>æ ˆå†…å­˜æº¢å‡º</h3><p>ç®€å•æ€»ç»“ä¸€ä¸‹ç¨‹åºè¿è¡Œä¸­æ ˆå¯èƒ½ä¼šå‡ºç°ä¸¤ç§é”™è¯¯ï¼š</p><ul><li><strong><code>StackOverFlowError</code>ï¼š</strong> è‹¥æ ˆçš„å†…å­˜å¤§å°ä¸å…è®¸åŠ¨æ€æ‰©å±•ï¼Œé‚£ä¹ˆå½“çº¿ç¨‹è¯·æ±‚æ ˆçš„æ·±åº¦è¶…è¿‡å½“å‰ Java è™šæ‹Ÿæœºæ ˆçš„æœ€å¤§æ·±åº¦çš„æ—¶å€™ï¼Œå°±æŠ›å‡º <code>StackOverFlowError</code> é”™è¯¯ã€‚</li><li><strong><code>OutOfMemoryError</code>ï¼š</strong> å¦‚æœæ ˆçš„å†…å­˜å¤§å°å¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œ å¦‚æœè™šæ‹Ÿæœºåœ¨åŠ¨æ€æ‰©å±•æ ˆæ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œåˆ™æŠ›å‡º<code>OutOfMemoryError</code>å¼‚å¸¸ã€‚</li></ul><ol><li>æ ˆå¸§è¿‡å¤šå¯¼è‡´æ ˆå†…å­˜æº¢å‡º</li></ol><p><img src="/../assets/JVM/image-20230828104644939.png" alt="image-20230828104644939"></p><hr><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            method();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(count);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">        count++;</span><br><span class="line">        method();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å‡ºç°StackOverFlowErrorçš„é”™è¯¯</p></blockquote><ol start="2"><li>æ ˆå¸§è¿‡å¤§å¯¼è‡´æ ˆå†…å­˜æº¢å‡º</li></ol><p><img src="/../assets/JVM/image-20230828104711119.png" alt="image-20230828104711119"></p><hr><p>ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼ŒEmpä¸­å¼•å…¥äº†Deptï¼Œè€ŒDeptä¸­åˆå¼•å…¥äº†Empï¼Œä»–ä»¬ç°åœ¨åœ¨å¾ªç¯å¼•ç”¨ï¼Œå¯¼è‡´jsonè§£ææ—¶ä¼šå‡ºç°StackOverFlow</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo_03</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">        <span class="type">Dept</span> <span class="variable">d</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dept</span>();</span><br><span class="line">        d.setName(<span class="string">&quot;Market&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Emp</span> <span class="variable">e1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>();</span><br><span class="line">        e1.setName(<span class="string">&quot;zhang&quot;</span>);</span><br><span class="line">        e1.setDept(d);</span><br><span class="line"></span><br><span class="line">        <span class="type">Emp</span> <span class="variable">e2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>();</span><br><span class="line">        e2.setName(<span class="string">&quot;li&quot;</span>);</span><br><span class="line">        e2.setDept(d);</span><br><span class="line"></span><br><span class="line">        d.setEmps(Arrays.asList(e1, e2));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// &#123; name: &#x27;Market&#x27;, emps: [&#123; name:&#x27;zhang&#x27;, dept:&#123; name:&#x27;&#x27;, emps: [ &#123;&#125;]&#125; &#125;,] &#125;</span></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        System.out.println(mapper.writeValueAsString(d));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Emp</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"><span class="comment">//    @JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> Dept dept;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Dept <span class="title function_">getDept</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dept;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDept</span><span class="params">(Dept dept)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dept = dept;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dept</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Emp&gt; emps;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">getEmps</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> emps;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEmps</span><span class="params">(List&lt;Emp&gt; emps)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.emps = emps;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çº¿ç¨‹è¿è¡Œè¯Šæ–­â­â­â­â­â­â­â­"><a href="#çº¿ç¨‹è¿è¡Œè¯Šæ–­â­â­â­â­â­â­â­" class="headerlink" title="çº¿ç¨‹è¿è¡Œè¯Šæ–­â­â­â­â­â­â­â­"></a>çº¿ç¨‹è¿è¡Œè¯Šæ–­â­â­â­â­â­â­â­</h3><p>æ¡ˆä¾‹1ï¼š cpu å ç”¨è¿‡å¤š </p><ol><li><p>å®šä½ ç”¨topå®šä½å“ªä¸ªè¿›ç¨‹å¯¹cpuçš„å ç”¨è¿‡é«˜ </p></li><li><p>ps H -eo pid,tid,%cpu | grep è¿›ç¨‹id ï¼ˆç”¨pså‘½ä»¤è¿›ä¸€æ­¥å®šä½æ˜¯å“ªä¸ªçº¿ç¨‹å¼•èµ·çš„cpuå ç”¨è¿‡é«˜ï¼‰ </p></li><li><p>jstack è¿›ç¨‹id å¯ä»¥æ ¹æ®çº¿ç¨‹id æ‰¾åˆ°æœ‰é—®é¢˜çš„çº¿ç¨‹ï¼Œè¿›ä¸€æ­¥å®šä½åˆ°é—®é¢˜ä»£ç çš„æºç è¡Œå·</p></li></ol><p>æ¡ˆä¾‹2ï¼šç¨‹åºè¿è¡Œå¾ˆé•¿æ—¶é—´æ²¡æœ‰ç»“æœï¼ˆæ­»é”ï¼‰</p><blockquote><p>æŸ¥é”™èƒ½åŠ›ï¼Œè¡¥å……topå‘½ä»¤åˆ°Linuxä¸­â€¦â€¦â­â­â­â­â­â­â­â­</p></blockquote><h3 id="æ„æˆ"><a href="#æ„æˆ" class="headerlink" title="æ„æˆ"></a>æ„æˆ</h3><h4 id="å±€éƒ¨å˜é‡è¡¨"><a href="#å±€éƒ¨å˜é‡è¡¨" class="headerlink" title="å±€éƒ¨å˜é‡è¡¨"></a>å±€éƒ¨å˜é‡è¡¨</h4><blockquote><p><strong>ä¸€ä¸ªæ ˆå¸§ä¸­å­˜æ”¾çš„æœ‰å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆ</strong></p></blockquote><p><strong>å±€éƒ¨å˜é‡è¡¨</strong>ï¼ˆLocal Variable Tableï¼‰æ˜¯Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸­çš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œ<strong>ç”¨äºå­˜å‚¨æ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€ä½¿ç”¨çš„å±€éƒ¨å˜é‡</strong>ã€‚æ¯ä¸ªæ–¹æ³•åœ¨è¿è¡Œæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå±€éƒ¨å˜é‡è¡¨ï¼Œç”¨äºå­˜å‚¨è¯¥æ–¹æ³•å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡ï¼Œè¿™äº›å±€éƒ¨å˜é‡é€šå¸¸åŒ…æ‹¬æ–¹æ³•å‚æ•°ä»¥åŠåœ¨æ–¹æ³•å†…éƒ¨å£°æ˜çš„ä¸´æ—¶å˜é‡ã€‚</p><p>ä»¥ä¸‹æ˜¯å±€éƒ¨å˜é‡è¡¨çš„ä¸»è¦ç‰¹ç‚¹å’Œä½œç”¨ï¼š</p><ol><li><p>å­˜å‚¨å±€éƒ¨å˜é‡ï¼šå±€éƒ¨å˜é‡è¡¨ç”¨äºå­˜å‚¨æ–¹æ³•å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡ï¼Œè¿™äº›å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä»…é™äºæ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ã€‚å±€éƒ¨å˜é‡é€šå¸¸åŒ…æ‹¬æ–¹æ³•å‚æ•°ã€ä¸´æ—¶å˜é‡å’Œæ–¹æ³•å†…éƒ¨çš„å…¶ä»–å±€éƒ¨å˜é‡ã€‚</p></li><li><p>åŠ©äºæ–¹æ³•æ‰§è¡Œï¼šå±€éƒ¨å˜é‡è¡¨ä¸­çš„å±€éƒ¨å˜é‡å­˜å‚¨äº†æ–¹æ³•çš„è¾“å…¥å’Œä¸­é—´è®¡ç®—ç»“æœï¼Œè¿™äº›å€¼è¢«ç”¨äºæ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œä½ å¯ä»¥å£°æ˜ä¸€ä¸ªå±€éƒ¨å˜é‡æ¥å­˜å‚¨ä¸€ä¸ªæ•´æ•°å€¼ï¼Œç„¶ååœ¨æ–¹æ³•ä¸­è¿›è¡Œè®¡ç®—å’Œæ“ä½œã€‚</p></li><li><p>ç±»å‹æ£€æŸ¥ï¼šå±€éƒ¨å˜é‡è¡¨ä¼šæ ¹æ®å˜é‡çš„å£°æ˜ç±»å‹è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œç¡®ä¿åœ¨æ–¹æ³•ä¸­æ­£ç¡®ä½¿ç”¨è¿™äº›å˜é‡ã€‚è¿™æœ‰åŠ©äºJavaç¼–è¯‘å™¨æ•è·ç±»å‹é”™è¯¯ã€‚</p></li><li><p>æä¾›æ–¹æ³•è°ƒç”¨ä¿¡æ¯ï¼šå±€éƒ¨å˜é‡è¡¨è¿˜åŒ…å«äº†æ–¹æ³•è°ƒç”¨æ—¶æ‰€éœ€çš„ä¿¡æ¯ï¼Œå¦‚æ–¹æ³•çš„å‚æ•°å’Œè¿”å›å€¼ã€‚è¿™äº›ä¿¡æ¯æœ‰åŠ©äºè°ƒç”¨æ–¹æ³•å’Œè¿”å›ç»“æœã€‚</p></li><li><p>è¿è¡Œæ—¶å†…å­˜åˆ†é…ï¼šå±€éƒ¨å˜é‡è¡¨ä¸­çš„å±€éƒ¨å˜é‡åœ¨æ–¹æ³•çš„è¿è¡Œæ—¶è¢«åˆ†é…å†…å­˜ç©ºé—´ï¼Œä»¥ä¾¿å­˜å‚¨æ•°æ®ã€‚è¿™äº›å˜é‡åœ¨æ–¹æ³•æ‰§è¡Œç»“æŸåä¼šè¢«é”€æ¯ï¼Œé‡Šæ”¾å†…å­˜ã€‚</p></li></ol><p>æ€»ä¹‹ï¼Œå±€éƒ¨å˜é‡è¡¨æ˜¯Javaè™šæ‹Ÿæœºä¸­ç”¨äºå­˜å‚¨æ–¹æ³•å†…éƒ¨å±€éƒ¨å˜é‡çš„æ•°æ®ç»“æ„ï¼Œå®ƒåœ¨æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­èµ·åˆ°é‡è¦ä½œç”¨ï¼ŒåŒ…æ‹¬å­˜å‚¨æ•°æ®ã€è¿›è¡Œç±»å‹æ£€æŸ¥ã€æä¾›æ–¹æ³•è°ƒç”¨ä¿¡æ¯ç­‰ã€‚å±€éƒ¨å˜é‡è¡¨çš„å¤§å°å’Œå†…å®¹æ˜¯ç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ç¡®å®šçš„ï¼Œå¹¶åœ¨æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«åŠ¨æ€ä½¿ç”¨ã€‚</p><h4 id="æ“ä½œæ•°æ ˆ"><a href="#æ“ä½œæ•°æ ˆ" class="headerlink" title="æ“ä½œæ•°æ ˆ"></a>æ“ä½œæ•°æ ˆ</h4><p><strong>æ“ä½œæ•°æ ˆ</strong> ä¸»è¦ä½œä¸ºæ–¹æ³•è°ƒç”¨çš„ä¸­è½¬ç«™ä½¿ç”¨ï¼Œç”¨äºå­˜æ”¾æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸­é—´è®¡ç®—ç»“æœã€‚å¦å¤–ï¼Œè®¡ç®—è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸´æ—¶å˜é‡ä¹Ÿä¼šæ”¾åœ¨æ“ä½œæ•°æ ˆä¸­ã€‚</p><h4 id="åŠ¨æ€é“¾æ¥"><a href="#åŠ¨æ€é“¾æ¥" class="headerlink" title="åŠ¨æ€é“¾æ¥"></a>åŠ¨æ€é“¾æ¥</h4><p><strong>åŠ¨æ€é“¾æ¥</strong> ä¸»è¦æœåŠ¡ä¸€ä¸ªæ–¹æ³•éœ€è¦è°ƒç”¨å…¶ä»–æ–¹æ³•çš„åœºæ™¯ã€‚Class æ–‡ä»¶çš„å¸¸é‡æ± é‡Œä¿å­˜æœ‰å¤§é‡çš„ç¬¦å·å¼•ç”¨æ¯”å¦‚æ–¹æ³•å¼•ç”¨çš„ç¬¦å·å¼•ç”¨ã€‚å½“ä¸€ä¸ªæ–¹æ³•è¦è°ƒç”¨å…¶ä»–æ–¹æ³•ï¼Œéœ€è¦å°†å¸¸é‡æ± ä¸­æŒ‡å‘æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºå…¶åœ¨å†…å­˜åœ°å€ä¸­çš„ç›´æ¥å¼•ç”¨ã€‚<strong>åŠ¨æ€é“¾æ¥çš„ä½œç”¨å°±æ˜¯ä¸ºäº†å°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºè°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨</strong>ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿè¢«ç§°ä¸º <strong>åŠ¨æ€è¿æ¥</strong> ã€‚</p><h2 id="æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆ"></a>æœ¬åœ°æ–¹æ³•æ ˆ</h2><ul><li>æœ¬åœ°æ–¹æ³•æ˜¯æŒ‡ç”±éJavaè¯­è¨€ç¼–å†™çš„ä»£ç ï¼Œå¦‚Cæˆ–C++ï¼Œå¹¶è¢«ç¼–è¯‘ä¸ºæœ¬åœ°äºŒè¿›åˆ¶ä»£ç ã€‚</li><li>æœ¬åœ°æ–¹æ³•æ ˆå°±æ˜¯æœ¬åœ°æ–¹æ³•çš„å†…å­˜ç©ºé—´ã€‚</li></ul><p>å› ä¸º<code>JAVA</code>æ²¡æ³•ç›´æ¥å’Œæ“ä½œç³»ç»Ÿåº•å±‚äº¤äº’ï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ°æœ¬åœ°æ–¹æ³•æ ˆæ¥è°ƒç”¨æœ¬åœ°çš„Cæˆ–C++çš„æ–¹æ³•</p><ul><li>ä¾‹å¦‚Objectç±»çš„æºç ä¸­å°±æœ‰æœ¬åœ°æ–¹æ³•ï¼Œç”¨<code>native</code>å…³é”®å­—ä¿®é¥°æœ¬åœ°æ–¹æ³•ï¼ˆä¾‹å¦‚notifyAllç­‰ï¼‰<ul><li>æœ¬åœ°æ–¹æ³•åªæœ‰å‡½æ•°å£°æ˜ï¼Œæ²¡æœ‰å‡½æ•°ä½“ï¼Œå› ä¸ºå‡½æ•°ä½“æ˜¯Cæˆ–C++å†™çš„ï¼Œé€šå¸¸æ˜¯é€šè¿‡JNIï¼ˆJava Native Interfaceï¼‰æŠ€æœ¯æ¥å®ç°çš„ã€‚</li></ul></li></ul><h2 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h2><h3 id="å®šä¹‰-1"><a href="#å®šä¹‰-1" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><ul><li><p>Heap å †</p><ul><li>é€šè¿‡ new å…³é”®å­—ï¼Œåˆ›å»ºå¯¹è±¡éƒ½ä¼šä½¿ç”¨å †å†…å­˜</li></ul></li><li><p>ç‰¹ç‚¹ </p><ul><li>å®ƒæ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œå †ä¸­å¯¹è±¡éƒ½éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ </li><li>æœ‰åƒåœ¾å›æ”¶æœºåˆ¶</li></ul></li></ul><h3 id="å †å†…å­˜æº¢å‡º"><a href="#å †å†…å­˜æº¢å‡º" class="headerlink" title="å †å†…å­˜æº¢å‡º"></a>å †å†…å­˜æº¢å‡º</h3><blockquote><p>é”™è¯¯ï¼šjava.lang.OutOfMemoryErrorï¼šJava heap space</p></blockquote><p>åƒåœ¾å›æ”¶ä¼šå›æ”¶ä¸ç”¨çš„å¯¹è±¡ï¼Œä½†æ˜¯ä¸€ç›´ä½¿ç”¨çš„å°±ä¸ä¼šå›æ”¶ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¼šæœ‰å †å†…å­˜æº¢å‡ºçš„é—®é¢˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¼”ç¤ºå †å†…å­˜æº¢å‡ºï¼šjava.lang.OutOfMemoryError: Java heap space</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo_04</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(); <span class="comment">//Hello, HelloHello, HelloHelloHelloHello Â·Â·Â·</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                list.add(a);</span><br><span class="line">                a = a + a;  <span class="comment">// HelloHelloHelloHello</span></span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å †å†…å­˜è¯Šæ–­"><a href="#å †å†…å­˜è¯Šæ–­" class="headerlink" title="å †å†…å­˜è¯Šæ–­"></a>å †å†…å­˜è¯Šæ–­</h3><ol><li><p>jpså·¥å…·</p><ul><li>æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­æœ‰å“ªäº›Javaè¿›ç¨‹</li></ul></li><li><p>jmapå·¥å…·</p><ul><li><p>æŸ¥çœ‹å †å†…å­˜å ç”¨æƒ…å†µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmap -heap è¿›ç¨‹<span class="built_in">id</span> <span class="comment"># è¿›ç¨‹idå°±æ˜¯jpsæŸ¥å‡ºæ¥çš„è¿›ç¨‹</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>jconsoleå·¥å…·</p><ul><li>å›¾å½¢åŒ–ç•Œé¢çš„å¤šåŠŸèƒ½ç›‘æµ‹å·¥å…·ï¼Œå¯ä»¥è¿ç»­ç›‘æµ‹</li></ul></li><li><p>jvisualvmå·¥å…·</p></li></ol><h3 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h3><blockquote><p>åœ¨å †å†…å­˜çš„å®šä¹‰ä¸‹ï¼Œæ–°ç”Ÿä»£å’Œè€å¹´ä»£æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</p></blockquote><p>åœ¨Javaç­‰ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå †å†…å­˜ï¼ˆHeap Memoryï¼‰æ˜¯ç”¨äºå­˜å‚¨å¯¹è±¡å®ä¾‹çš„ä¸€å—å†…å­˜åŒºåŸŸã€‚åœ¨å †å†…å­˜ä¸­ï¼Œå¯¹è±¡å®ä¾‹è¢«åŠ¨æ€åœ°åˆ†é…å’Œå›æ”¶ï¼Œè¿™ä½¿å¾—å †å†…å­˜æˆä¸ºåƒåœ¾å›æ”¶çš„ä¸»è¦åœºæ‰€ã€‚</p><p>åœ¨å †å†…å­˜ä¸­ï¼Œä¸€èˆ¬ä¼šæ ¹æ®å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå°†å…¶åˆ†ä¸ºä¸åŒçš„åŒºåŸŸï¼Œå…¶ä¸­æœ€å¸¸è§çš„åˆ’åˆ†æ˜¯â€œæ–°ç”Ÿä»£â€ï¼ˆYoung Generationï¼‰å’Œâ€œè€å¹´ä»£â€ï¼ˆOld Generationï¼‰ï¼Œè¿™æœ‰åŠ©äºè¿›è¡Œæ›´æœ‰æ•ˆçš„åƒåœ¾å›æ”¶ã€‚ä»¥ä¸‹æ˜¯å®ƒä»¬çš„è§£é‡Šï¼š</p><ol><li><p>æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰ï¼š<br>æ–°ç”Ÿä»£æ˜¯å †å†…å­˜çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜å‚¨æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚ç”±äºå¤§éƒ¨åˆ†å¯¹è±¡åœ¨åˆ›å»ºåå¾ˆå¿«å°±å˜å¾—ä¸å†ä½¿ç”¨ï¼Œå› æ­¤å°†å®ƒä»¬æ”¾åœ¨æ–°ç”Ÿä»£ä¸­ã€‚æ–°ç”Ÿä»£åˆåˆ†ä¸ºä¸‰ä¸ªåŒºåŸŸï¼šEdenåŒºåŸŸå’Œä¸¤ä¸ªSurvivoråŒºåŸŸï¼ˆé€šå¸¸ç§°ä¸ºFromåŒºå’ŒToåŒºï¼‰ã€‚</p><ul><li>EdenåŒºåŸŸï¼šè¿™æ˜¯å¯¹è±¡æœ€åˆè¢«åˆ›å»ºçš„åœ°æ–¹ã€‚å½“EdenåŒºåŸŸæ»¡äº†ä¹‹åï¼Œå°†è§¦å‘ä¸€æ¬¡â€œMinor GCâ€ï¼ˆæ–°ç”Ÿä»£åƒåœ¾å›æ”¶ï¼‰ï¼Œè¿™æ—¶ä¼šæŠŠä»ç„¶å­˜æ´»çš„å¯¹è±¡ç§»åˆ°SurvivoråŒºåŸŸã€‚</li><li>SurvivoråŒºåŸŸï¼šè¿™ä¸¤ä¸ªåŒºåŸŸç”¨æ¥å­˜æ”¾åœ¨EdenåŒºåŸŸä¸­å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡ã€‚åœ¨Minor GCåï¼Œå­˜æ´»çš„å¯¹è±¡ä¼šä»EdenåŒºåŸŸç§»åŠ¨åˆ°ä¸€ä¸ªSurvivoråŒºåŸŸã€‚åœ¨ä¸æ–­çš„Minor GCä¸­ï¼Œå¯¹è±¡å¯èƒ½ä¼šåœ¨ä¸åŒçš„SurvivoråŒºåŸŸä¹‹é—´æ¥å›ç§»åŠ¨ï¼Œæœ€ç»ˆè¾¾åˆ°ä¸€å®šçš„å¹´é¾„åï¼Œä¼šè¢«ç§»åŠ¨åˆ°è€å¹´ä»£ã€‚</li></ul></li><li><p>è€å¹´ä»£ï¼ˆOld Generationï¼‰ï¼š<br>è€å¹´ä»£ç”¨äºå­˜å‚¨é•¿æ—¶é—´å­˜æ´»çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡ç»è¿‡ä¸€å®šæ•°é‡çš„Minor GCåä»ç„¶å­˜æ´»ä¸‹æ¥ã€‚è€å¹´ä»£ä¸­çš„åƒåœ¾å›æ”¶é€šå¸¸è¢«ç§°ä¸ºâ€œMajor GCâ€æˆ–â€œFull GCâ€ï¼ˆå…¨å †åƒåœ¾å›æ”¶ï¼‰ï¼Œå› ä¸ºå®ƒæ¶‰åŠæ•´ä¸ªå †å†…å­˜çš„æ¸…ç†ã€‚Major GCå‘ç”Ÿçš„é¢‘ç‡ç›¸å¯¹è¾ƒä½ï¼Œå› ä¸ºè€å¹´ä»£ä¸­çš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿ï¼Œæ‰€ä»¥å®ƒä»¬ä¸ä¼šé¢‘ç¹åœ°è§¦å‘åƒåœ¾å›æ”¶ã€‚</p></li></ol><p>é€šè¿‡å°†å †å†…å­˜åˆ’åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç­–ç•¥ï¼Œä»¥æé«˜ç³»ç»Ÿæ€§èƒ½å’Œå†…å­˜åˆ©ç”¨ç‡ã€‚è¿™ç§åˆ’åˆ†èƒ½å¤Ÿå‡å°‘åƒåœ¾å›æ”¶å¯¹æ•´ä¸ªåº”ç”¨ç¨‹åºæ€§èƒ½çš„å½±å“ï¼Œä½¿å¾—åƒåœ¾å›æ”¶å˜å¾—æ›´åŠ é«˜æ•ˆã€‚</p><h2 id="æ–¹æ³•åŒº"><a href="#æ–¹æ³•åŒº" class="headerlink" title="æ–¹æ³•åŒº"></a>æ–¹æ³•åŒº</h2><h3 id="å®šä¹‰-2"><a href="#å®šä¹‰-2" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><ol><li><p>åœ¨JVMä¸­ï¼Œæ–¹æ³•åŒºæ˜¯ä¸€å—ç”¨äºå­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ï¼ˆ<code>ClassLoader</code>ï¼‰ç­‰æ•°æ®çš„å†…å­˜åŒºåŸŸï¼Œå®ƒæ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒä¸­çš„ä¸€ä¸ªæ¦‚å¿µã€‚<code>Java SE 7</code>åŠä¹‹å‰ç‰ˆæœ¬ä¸­ï¼Œæ–¹æ³•åŒºçš„å®ç°è¢«ç§°ä¸º<code>æ°¸ä¹…ä»£</code>ï¼Œä½†åœ¨<code>Java SE 8</code>ä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œ<code>æ°¸ä¹…ä»£</code>è¢«åºŸå¼ƒäº†ï¼Œè¢«<code>å…ƒç©ºé—´</code>æ‰€æ›¿ä»£ã€‚</p></li><li><p>ä¸æ°¸ä¹…ä»£ä¸åŒçš„æ˜¯ï¼Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯<code>æœ¬åœ°å†…å­˜ï¼ˆNative Memoryï¼‰</code>ï¼Œè€Œä¸æ˜¯<code>è™šæ‹Ÿæœºå†…å­˜ï¼ˆå †å†…å­˜ï¼‰</code>ï¼Œè¿™æ ·å°±é¿å…äº†OutOfMemoryErroré”™è¯¯ï¼Œå› ä¸ºåœ¨ä½¿ç”¨æœ¬åœ°å†…å­˜æ—¶ï¼Œå¯ä»¥åŠ¨æ€åœ°è°ƒæ•´å¤§å°ï¼Œè€Œä¸”å¯ä»¥ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜æœºåˆ¶ï¼Œä½¿å¾—Javaåº”ç”¨ç¨‹åºä¸ä¼šè¢«é™åˆ¶åœ¨å›ºå®šçš„å†…å­˜å¤§å°ä¸­ã€‚</p></li></ol><h3 id="ç»„æˆ"><a href="#ç»„æˆ" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h3><p><img src="/../assets/JVM/image-20230919155327596.png" alt="1.6ä»¥å‰"></p><hr><p><img src="/../assets/JVM/image-20230919155353326.png" alt="1.8ä»¥å"></p><h3 id="æ–¹æ³•åŒºå†…å­˜æº¢å‡º"><a href="#æ–¹æ³•åŒºå†…å­˜æº¢å‡º" class="headerlink" title="æ–¹æ³•åŒºå†…å­˜æº¢å‡º"></a>æ–¹æ³•åŒºå†…å­˜æº¢å‡º</h3><ol><li>æ°¸ä¹…ä»£å†…å­˜æº¢å‡º</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.OutOfMemoryError: PermGen space</span><br></pre></td></tr></table></figure><ol start="2"><li>å…ƒç©ºé—´å†…å­˜æº¢å‡º</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.OutOfMemoryError: Metaspace</span><br></pre></td></tr></table></figure><h3 id="è¿è¡Œæ—¶å¸¸é‡æ± "><a href="#è¿è¡Œæ—¶å¸¸é‡æ± " class="headerlink" title="è¿è¡Œæ—¶å¸¸é‡æ± "></a>è¿è¡Œæ—¶å¸¸é‡æ± </h3><p>å¸¸é‡æ± å°±æ˜¯ä¸€è¡Œè¡¨ï¼Œè™šæ‹ŸæœºæŒ‡ä»¤æ ¹æ®è¿™å¼ å¸¸é‡è¡¨æ‰¾åˆ°è¦æ‰§è¡Œçš„ç±»åã€æ–¹æ³•åã€å‚æ•°ç±»å‹ã€å­—é¢é‡ç­‰ä¿¡æ¯</p><ul><li>å¸¸é‡æ± æ˜¯ *.class æ–‡ä»¶ä¸­çš„<code>Constant pool</code>ä¸­çš„å†…å®¹ï¼Œå­˜åœ¨äºŒè¿›åˆ¶å­—èŠ‚ç æ–‡ä»¶ä¸­</li><li>è€Œè¿è¡Œæ—¶å¸¸é‡æ± æ˜¯å½“è¯¥ç±»è¢«åŠ è½½æ—¶ï¼Œå°†å¸¸é‡æ± ä¿¡æ¯æ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œå¹¶æŠŠé‡Œé¢çš„ç¬¦å·åœ°å€(#2ã€#3)å˜ä¸ºå†…å­˜åœ°å€</li></ul><blockquote><p>ç¬¦å·å¼•ç”¨(Symbolic References):ç¬¦å·å¼•ç”¨ä»¥ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦ä½¿ç”¨æ—¶èƒ½æ— æ­§ä¹‰åœ°å®šä½åˆ°ç›®æ ‡å³å¯ã€‚ç¬¦å·å¼•ç”¨ä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€æ— å…³ï¼Œå¼•ç”¨çš„ç›®æ ‡å¹¶ä¸ä¸€å®šæ˜¯å·²ç»åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜å½“ä¸­çš„å†…å®¹ã€‚å„ç§è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€å¯ä»¥å„ä¸ç›¸åŒï¼Œä½†æ˜¯å®ƒä»¬èƒ½æ¥å—çš„ç¬¦å·å¼•ç”¨å¿…é¡»éƒ½æ˜¯ä¸€è‡´çš„ï¼Œå› ä¸ºç¬¦å·å¼•ç”¨çš„å­—é¢é‡å½¢å¼æ˜ç¡®å®šä¹‰åœ¨ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹çš„Classæ–‡ä»¶æ ¼å¼ä¸­ã€‚</p><p>Â·ç›´æ¥å¼•ç”¨(Direct References)ç›´æ¥å¼•ç”¨æ˜¯å¯ä»¥ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–è€…æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚ç›´æ¥å¼•ç”¨æ˜¯å’Œè™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€ç›´æ¥ç›¸å…³çš„ï¼ŒåŒä¸€ä¸ªç¬¦å·å¼•ç”¨åœ¨ä¸åŒè™šæ‹Ÿæœºå®ä¾‹ä¸Šç¿»è¯‘å‡ºæ¥çš„ç›´æ¥å¼•ç”¨ä¸€èˆ¬ä¸ä¼šç›¸åŒã€‚å¦‚æœæœ‰äº†ç›´æ¥å¼•ç”¨ï¼Œé‚£å¼•ç”¨çš„ç›®æ ‡å¿…å®šå·²ç»åœ¨è™šæ‹Ÿæœº<br>çš„å†…å­˜ä¸­å­˜åœ¨ã€‚</p></blockquote><h3 id="StringTable"><a href="#StringTable" class="headerlink" title="StringTable"></a>StringTable</h3><p><strong>JDK 1.7 ä¸ºä»€ä¹ˆè¦å°†å­—ç¬¦ä¸²å¸¸é‡æ± ç§»åŠ¨åˆ°å †ä¸­ï¼Ÿ</strong></p><p>ä¸»è¦æ˜¯å› ä¸ºæ°¸ä¹…ä»£ï¼ˆæ–¹æ³•åŒºå®ç°ï¼‰çš„ GC å›æ”¶æ•ˆç‡å¤ªä½ï¼Œåªæœ‰åœ¨æ•´å †æ”¶é›† (Full GC)çš„æ—¶å€™æ‰ä¼šè¢«æ‰§è¡Œ GCã€‚</p><p>StringTableç±»ä¼¼äºæ˜¯ä¸€ä¸ªHashTable</p><p>åœ¨ä¸‹é¢è¿™æ®µDemo_08ä»£ç ä¸­ï¼Œè¿›è¡Œç¼–è¯‘åçš„ç±»çš„ä¿¡æ¯åœ¨å¸¸é‡æ± ä¸­ï¼Œå½“è¯¥ç±»è¢«åŠ è½½æ—¶ï¼Œä¿¡æ¯å°±è¢«åŠ è½½åˆ°äº†è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œæ­¤æ—¶çš„<code>a</code>ï¼Œ<code>b</code>ï¼Œ<code>ab</code>éƒ½æ²¡å˜ä¸ºJavaçš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå½“è¿è¡Œåˆ°è¯¥è¯­å¥æ—¶æ‰ä¼šè½¬æ¢ã€‚</p><p>è€Œå¯¹äºç¬¬7è¡Œä»£ç è€Œè¨€ï¼Œå®è´¨ä¸Šæ˜¯åšäº†ä¸‹é¢çš„æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">StringBuilder</span>().append(<span class="string">&quot;a&quot;</span>).append(<span class="string">&quot;b&quot;</span>).toSting()</span><br></pre></td></tr></table></figure><p>è€Œåœ¨<code>StringBuilder</code>ä¸­çš„<code>toString</code>æ–¹æ³•ä¸­æ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œæ‰€ä»¥ï¼Œs3æ˜¯åœ¨å¸¸é‡æ± ä¸­çš„ï¼Œè€Œs4æ˜¯åœ¨å †ä¸­çš„ï¼Œæ‰€ä»¥è¿™é‡Œæ‰“å°ä¸ºfalse</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo_08</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;b&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> s1 + s2;</span><br><span class="line">        System.out.println(s3 == s4);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="ç¼–è¯‘æœŸä¼˜åŒ–"><a href="#ç¼–è¯‘æœŸä¼˜åŒ–" class="headerlink" title="ç¼–è¯‘æœŸä¼˜åŒ–"></a>ç¼–è¯‘æœŸä¼˜åŒ–</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo_08</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;b&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span> + <span class="string">&quot;b&quot;</span>;</span><br><span class="line">        System.out.println(s3 == s4);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ®µä»£ç ä¸æœ€åˆçš„ä»£ç ç›¸æ¯”ï¼Œå°±æ˜¯ç”¨å¸¸é‡ä»£æ›¿äº†å˜é‡å»æ‹¼æ¥ï¼Œåœ¨ç¼–è¯‘æœŸé—´ï¼Œjvmè®¤ä¸ºå¸¸é‡ä¸ä¼šå†å˜åŒ–ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘æ—¶å°±å®Œæˆäº†æ‹¼æ¥ï¼Œè¿™é‡Œçš„æ‹¼æ¥æ˜¯åœ¨StringTableä¸²æ± ä¸­å»å¯»æ‰¾ï¼Œæ‰¾åˆ°äº†<code>ab</code>çš„å­—ç¬¦ä¸²ï¼Œå°±ä¸ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ª<code>ab</code>å­—ç¬¦ä¸²äº†ï¼Œæ‰€ä»¥ç¬¬5è¡Œå’Œç¬¬6è¡Œåœ¨åº•å±‚å­˜å…¥çš„éƒ½æ˜¯ä¸²æ± ä¸­çš„<code>ab</code>å¯¹è±¡ï¼Œæ•…è¿™é‡Œä¼šæ‰“å°True</p><h4 id="å­—ç¬¦ä¸²å»¶è¿ŸåŠ è½½"><a href="#å­—ç¬¦ä¸²å»¶è¿ŸåŠ è½½" class="headerlink" title="å­—ç¬¦ä¸²å»¶è¿ŸåŠ è½½"></a>å­—ç¬¦ä¸²å»¶è¿ŸåŠ è½½</h4><p>å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²ä»…æ˜¯ç¬¦å·ï¼Œç¬¬ä¸€æ¬¡ç”¨åˆ°æ—¶æ‰å˜ä¸ºå¯¹è±¡</p><h4 id="internæ–¹æ³•"><a href="#internæ–¹æ³•" class="headerlink" title="internæ–¹æ³•"></a>internæ–¹æ³•</h4><p>å¯ä»¥ä½¿ç”¨internæ–¹æ³•ï¼Œä¸»åŠ¨å°†ä¸²æ± ä¸­è¿˜æ²¡æœ‰çš„å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥ä¸²æ± </p><p>1.8ä¸­ï¼Œå°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± </p><ul><li>å¦‚æœä¸²æ± ä¸­å·²æœ‰ï¼Œåˆ™ä¸ä¼šæ”¾å…¥</li><li>å¦‚æœä¸²æ± ä¸­æ²¡æœ‰ï¼Œåˆ™æ”¾å…¥ä¸²æ± ï¼Œå¹¶å°†ä¸²æ± ä¸­çš„ç»“æœè¿”å›</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo_10</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;            <span class="comment">// å¸¸é‡æ± ï¼š[&quot;a&quot;]</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;b&quot;</span>;            <span class="comment">// å¸¸é‡æ± ï¼š[&quot;a&quot;, &quot;b&quot;]</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span> + <span class="string">&quot;b&quot;</span>;      <span class="comment">// å¸¸é‡æ± ï¼š[&quot;a&quot;, &quot;b&quot;, &quot;ab&quot;]</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> s1 + s2;        <span class="comment">// å †ï¼šnew String(&quot;ab&quot;)</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s5</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;           <span class="comment">// s5å¼•ç”¨å¸¸é‡æ± ä¸­å·²æœ‰çš„å¯¹è±¡</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s6</span> <span class="operator">=</span> s4.intern();    <span class="comment">// å¸¸é‡æ± ä¸­å·²æœ‰&quot;ab&quot;ï¼Œå°†å¸¸é‡æ± ä¸­çš„&quot;ab&quot;çš„å¼•ç”¨è¿”å›ï¼Œs6å¼•ç”¨å¸¸é‡æ± ä¸­å·²æœ‰çš„å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">        System.out.println(s3 == s4);   <span class="comment">// s3åœ¨å¸¸é‡æ± ï¼Œs4åœ¨å †ï¼Œfalse</span></span><br><span class="line">        System.out.println(s3 == s5);   <span class="comment">// s3åœ¨å¸¸é‡æ± ï¼Œs5åœ¨å¸¸é‡æ± ï¼Œtrue</span></span><br><span class="line">        System.out.println(s3 == s6);   <span class="comment">// s3åœ¨å¸¸é‡æ± ï¼Œs6åœ¨å¸¸é‡æ± ï¼Œtrue</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;cd&quot;</span>;     <span class="comment">// å¸¸é‡æ± ï¼š[&quot;cd&quot;]</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;c&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;d&quot;</span>);    <span class="comment">// å †ï¼šnew String(&quot;cd&quot;)</span></span><br><span class="line">        str2.intern();  <span class="comment">// å¸¸é‡æ± ä¸­å·²æœ‰&quot;cd&quot;ï¼Œæ”¾å…¥å¤±è´¥</span></span><br><span class="line">        System.out.println(str1 == str2);   <span class="comment">// str1åœ¨å¸¸é‡æ± ï¼Œstr2åœ¨å †ï¼Œfalse</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">str4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;e&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;f&quot;</span>);    <span class="comment">// å †ï¼šnew String(&quot;ef&quot;)</span></span><br><span class="line">        str4.intern();          <span class="comment">// å¸¸é‡æ± ä¸­æ²¡æœ‰&quot;ef&quot;ï¼Œæ”¾å…¥æˆåŠŸï¼Œå¹¶è¿”å›å¸¸é‡æ± &quot;ef&quot;çš„å¼•ç”¨</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str3</span> <span class="operator">=</span> <span class="string">&quot;ef&quot;</span>;     <span class="comment">// å¸¸é‡æ± ï¼š[&quot;ef&quot;]</span></span><br><span class="line">        System.out.println(str3 == str4);   <span class="comment">// str4æ˜¯å¸¸é‡æ± çš„å¼•ç”¨ï¼Œstr3ä¹Ÿæ˜¯å¸¸é‡æ± çš„å¼•ç”¨ï¼Œtrue</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>1.6 ä¸­ å°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ï¼Œå¦‚æœæœ‰åˆ™å¹¶ä¸ä¼šæ”¾å…¥ï¼Œå¦‚æœæ²¡æœ‰ä¼šæŠŠæ­¤å¯¹è±¡å¤åˆ¶ä¸€ä»½ï¼Œ<br>æ”¾å…¥ä¸²æ± ï¼Œä¼šæŠŠä¸²æ± ä¸­çš„å¯¹è±¡è¿”å›</p><blockquote><p>ä¹Ÿå°±æ˜¯è°ƒç”¨internæ–¹æ³•çš„å¯¹è±¡å¹¶ä¸æ˜¯å­˜å…¥ä¸²æ± ä¸­çš„å¯¹è±¡ï¼Œè€Œæ˜¯å¤åˆ¶å‡ºæ¥çš„ä¸€ä¸ªæ–°çš„å¯¹è±¡</p><p>ä¾‹å¦‚s.intern()ï¼Œåœ¨1.8ä¸­å¦‚æœä¸²æ± ä¸­æ²¡æœ‰è¯¥å…ƒç´ åˆ™æ”¾å…¥ï¼Œæ­¤æ—¶sä¹Ÿå˜æˆå¸¸é‡æ± ä¸­çš„å¯¹è±¡ï¼Œè€Œåœ¨1.6ä¸­ï¼Œsè¿˜æ˜¯å †å¯¹è±¡</p></blockquote><h4 id="StringTable-ä½ç½®"><a href="#StringTable-ä½ç½®" class="headerlink" title="StringTable ä½ç½®"></a>StringTable ä½ç½®</h4><p>åœ¨ <code>JDK 1.6</code> ä¸­ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆä¹Ÿå°±æ˜¯ StringTableï¼‰æ˜¯ä½äº<code>æ°¸ä¹…ä»£</code>ä¸­çš„ã€‚è€Œåœ¨ <code>JDK 1.8</code> ä¸­ï¼Œæ°¸ä¹…ä»£å·²ç»è¢«ç§»é™¤ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰ï¼Œè€Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¹Ÿéšä¹‹ç§»åŠ¨åˆ°äº†<code>å †</code>ä¸­ã€‚è¿™æ„å‘³ç€åœ¨ JDK 1.8 ä¸­ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ï¼Œè€Œåœ¨ JDK 1.6 ä¸­åˆ™ä¸è¡Œã€‚</p><blockquote><p>åŸå› ï¼šå› ä¸ºå­—ç¬¦ä¸²æ˜¯å¾ˆå¸¸ç”¨çš„ï¼Œå¦‚æœåœ¨æ°¸ä¹…ä»£ä¸­ä¿å­˜æ˜¯è¦ç­‰åˆ°è€å¹´ä»£çš„æ—¶å€™æ‰ä¼šå»å›æ”¶ï¼Œä¸ç¬¦åˆå¸¸ç”¨çš„ç‰¹æ€§ã€‚</p><ul><li>å­—ç¬¦ä¸²å¸¸é‡æ± çš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œå¦‚æœå¤§é‡å­—ç¬¦ä¸²è¢«åˆ›å»ºï¼Œæ°¸ä¹…ä»£å¯èƒ½ä¼šå‡ºç°å†…å­˜æº¢å‡ºã€‚</li><li>å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡éš¾ä»¥è¢«åƒåœ¾å›æ”¶ï¼Œå³ä½¿å®ƒä»¬ä¸å†è¢«å¼•ç”¨ï¼Œä¹Ÿä¸ä¼šè¢«å›æ”¶ï¼Œå®¹æ˜“å¯¼è‡´æ°¸ä¹…ä»£çš„å†…å­˜æ³„æ¼ã€‚</li></ul></blockquote><h4 id="StringTableåƒåœ¾å›æ”¶"><a href="#StringTableåƒåœ¾å›æ”¶" class="headerlink" title="StringTableåƒåœ¾å›æ”¶"></a>StringTableåƒåœ¾å›æ”¶</h4><p>åœ¨ Java 8 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä½äºå †ä¸­ï¼Œè€Œå †æ˜¯ JVM ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²å¯ä»¥è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚å…·ä½“æ¥è¯´ï¼Œåªæœ‰å½“å­—ç¬¦ä¸²æ²¡æœ‰è¢«ä»»ä½•å¯¹è±¡å¼•ç”¨æ—¶ï¼Œå®ƒæ‰èƒ½è¢«åƒåœ¾å›æ”¶ã€‚å½“å­—ç¬¦ä¸²è¢«å›æ”¶æ—¶ï¼Œå®ƒçš„å­˜å‚¨ç©ºé—´å°†è¢«é‡Šæ”¾å¹¶å¯ä»¥è¢«é‡æ–°åˆ©ç”¨ã€‚</p><h4 id="StringTable-æ€§èƒ½è°ƒä¼˜"><a href="#StringTable-æ€§èƒ½è°ƒä¼˜" class="headerlink" title="StringTable æ€§èƒ½è°ƒä¼˜"></a>StringTable æ€§èƒ½è°ƒä¼˜</h4><ol><li>è°ƒæ•´ -XX:StringTableSize&#x3D;æ¡¶ä¸ªæ•°</li></ol><blockquote><p>Stringtableç±»ä¼¼äºhashtableï¼Œè¿™é‡Œçš„æ¡¶çš„ä¸ªæ•°æŒ‡çš„å°±æ˜¯å­˜æ”¾é“¾è¡¨çš„æ•°ç»„çš„ä¸ªæ•°ï¼Œé€‚å½“å¢å¤§èƒ½æœ‰æ•ˆé¿å…å“ˆå¸Œç¢°æ’ï¼Œèƒ½æå¤§åœ°æé«˜æ•ˆç‡</p></blockquote><ol start="2"><li>è€ƒè™‘å°†å­—ç¬¦ä¸²å¯¹è±¡æ˜¯å¦å…¥æ± </li></ol><blockquote><p>é‡å¤çš„å­—ç¬¦ä¸²è¿‡å¤šæ—¶è€ƒè™‘å…¥æ± </p></blockquote><h2 id="ç›´æ¥å†…å­˜"><a href="#ç›´æ¥å†…å­˜" class="headerlink" title="ç›´æ¥å†…å­˜"></a>ç›´æ¥å†…å­˜</h2><h3 id="å®šä¹‰-3"><a href="#å®šä¹‰-3" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><ul><li>å¸¸è§äº NIO æ“ä½œæ—¶ï¼Œç”¨äºæ•°æ®ç¼“å†²åŒº </li><li>åˆ†é…å›æ”¶æˆæœ¬è¾ƒé«˜ï¼Œä½†è¯»å†™æ€§èƒ½é«˜ </li><li>ä¸å— JVM å†…å­˜å›æ”¶ç®¡ç†</li><li>ç›´æ¥å†…å­˜ä¹Ÿä¼šå¯¼è‡´å†…å­˜æº¢å‡º</li></ul><p>ä¼ ç»ŸIOï¼Œå°†æ–‡ä»¶è¯»å–åˆ°ç³»ç»Ÿç¼“å†²åŒºä¸­ï¼Œä½†æ˜¯Javaä»£ç ä¸èƒ½ç›´æ¥è¯»å–ç³»ç»Ÿç¼“å†²åŒºï¼Œæ‰€ä»¥éœ€è¦åœ¨å †å†…å­˜ä¸­åˆ†é…ä¸€å—Javaç¼“å†²åŒºï¼Œå°†æ•°æ®ä»ç³»ç»Ÿç¼“å†²åŒºè¯»å–åˆ°Javaç¼“å†²åŒºåï¼Œæ‰èƒ½è¿›è¡Œå†™æ“ä½œ</p><p><img src="/../assets/JVM/image-20230919223640091.png" alt="image-20230919223640091"></p><p>ç›´æ¥å†…å­˜çš„Direct Memoryå¯¹Javaå †å†…å­˜å’Œç³»ç»Ÿå†…å­˜æ˜¯å…±äº«çš„ä¸€å—å†…å­˜åŒºï¼Œé‚£ä¹ˆç£ç›˜æ–‡ä»¶å°±å¯ä»¥ç›´æ¥è¯»å–åˆ°Direct Memoryï¼Œè€ŒJavaå †å†…å­˜ä¹Ÿå¯ä»¥ç›´æ¥è®¿é—®Direct Memory</p><p><img src="/../assets/JVM/image-20230919223613085.png" alt="image-20230919223613085"></p><blockquote><p>å‡å°‘äº†ä¸å¿…è¦çš„æ•°æ®å¤åˆ¶ï¼Œä»è€Œæé«˜äº†æ•ˆç‡</p></blockquote><h3 id="åˆ†é…å’Œå›æ”¶åŸç†"><a href="#åˆ†é…å’Œå›æ”¶åŸç†" class="headerlink" title="åˆ†é…å’Œå›æ”¶åŸç†"></a>åˆ†é…å’Œå›æ”¶åŸç†</h3><p>å¯¹äºç›´æ¥å†…å­˜éœ€è¦ä½¿ç”¨<code>Unsafe</code>å¯¹è±¡å®Œæˆç›´æ¥å†…å­˜çš„åˆ†é…å›æ”¶ï¼Œå¹¶ä¸”å›æ”¶éœ€è¦ä¸»åŠ¨è°ƒç”¨<code>freeMemory</code>æ–¹æ³•</p><p>å›æ”¶æ–¹æ³•<code>freeMemory</code></p><ul><li>å…¶å®é‡Šæ”¾çš„æ–¹æ³•æ˜¯åœ¨Deallocator()è¿™ä¸ªå›è°ƒæ–¹æ³•ä¸­</li><li>è€Œå®ƒæ˜¯ç”±Cleanerè°ƒç”¨çš„ï¼Œ Cleanerï¼ˆè™šå¼•ç”¨ç±»å‹ï¼‰æ˜¯ç”¨æ¥ç›‘æµ‹<code>ByteBuffer</code>å¯¹è±¡çš„ï¼Œä¸€æ—¦<code>ByteBuffer</code>å¯¹è±¡è¢«åƒåœ¾<code>å›æ”¶</code>ï¼Œé‚£ä¹ˆå°±ä¼šç”±<code>ReferenceHandler</code>çº¿ç¨‹é€šè¿‡<code>Cleaner</code>çš„<code>clean</code>æ–¹æ³•è°ƒç”¨<code>freeMemory</code>æ¥é‡Šæ”¾ç›´æ¥å†…å­˜</li><li><strong>ByteBuï¬€er çš„å®ç°ç±»å†…éƒ¨ï¼Œä½¿ç”¨äº† Cleaner ï¼ˆè™šå¼•ç”¨ï¼‰æ¥ç›‘æµ‹ ByteBuï¬€er å¯¹è±¡ï¼Œä¸€æ—¦ ByteBuï¬€er å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼Œé‚£ä¹ˆå°±ä¼šç”± ReferenceHandler çº¿ç¨‹é€šè¿‡ Cleaner çš„ clean æ–¹æ³•è°ƒ ç”¨ freeMemory æ¥é‡Šæ”¾ç›´æ¥å†…å­˜</strong></li></ul><h3 id="ç¦ç”¨åƒåœ¾å›æ”¶å¯¹ç›´æ¥å†…å­˜çš„å½±å“"><a href="#ç¦ç”¨åƒåœ¾å›æ”¶å¯¹ç›´æ¥å†…å­˜çš„å½±å“" class="headerlink" title="ç¦ç”¨åƒåœ¾å›æ”¶å¯¹ç›´æ¥å†…å­˜çš„å½±å“"></a>ç¦ç”¨åƒåœ¾å›æ”¶å¯¹ç›´æ¥å†…å­˜çš„å½±å“</h3><ul><li>ç”±äºåƒåœ¾å›æ”¶æ˜¯ä¸€ä¸ªç›¸å¯¹æ˜‚è´µçš„æ“ä½œï¼Œéœ€è¦æ¶ˆè€—CPUæ—¶é—´å’Œç³»ç»Ÿèµ„æºã€‚é¢‘ç¹è°ƒç”¨System.gc()å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œå¹¶ä¸”åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šé€ æˆåº”ç”¨ç¨‹åºçš„ä¸ç¨³å®šæ€§ã€‚</li><li>æ‰€ä»¥ä¸ºäº†é¿å…æœ‰äº›ç¨‹åºå‘˜è€æ˜¯æ‰‹åŠ¨è°ƒç”¨åƒåœ¾å›æ”¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šè¿›åˆ¶æ˜¾å¼æ‰‹åŠ¨åƒåœ¾å›æ”¶ï¼Œæ·»åŠ VMå‚æ•°<code>-XX:+DisableExplicitGC</code>ç¦ç”¨æ˜¾å¼çš„åƒåœ¾å›æ”¶</li></ul><h2 id="ğŸŒˆè¡¥å……ï¼šå¯¹è±¡"><a href="#ğŸŒˆè¡¥å……ï¼šå¯¹è±¡" class="headerlink" title="ğŸŒˆè¡¥å……ï¼šå¯¹è±¡"></a>ğŸŒˆè¡¥å……ï¼šå¯¹è±¡</h2><h3 id="Java-å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹"><a href="#Java-å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="Java å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹"></a>Java å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹</h3><p>æ–‡ç« å–è‡ª<a href="https://javaguide.cn/java/jvm/memory-area.html#%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA">JavaGuide</a></p><h4 id="Step1-ç±»åŠ è½½æ£€æŸ¥"><a href="#Step1-ç±»åŠ è½½æ£€æŸ¥" class="headerlink" title="Step1:ç±»åŠ è½½æ£€æŸ¥"></a>Step1:ç±»åŠ è½½æ£€æŸ¥</h4><p>è™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡ new æŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆå°†å»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«åŠ è½½è¿‡ã€è§£æå’Œåˆå§‹åŒ–è¿‡ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£å¿…é¡»å…ˆæ‰§è¡Œç›¸åº”çš„ç±»åŠ è½½è¿‡ç¨‹ã€‚</p><h4 id="Step2-åˆ†é…å†…å­˜"><a href="#Step2-åˆ†é…å†…å­˜" class="headerlink" title="Step2:åˆ†é…å†…å­˜"></a>Step2:åˆ†é…å†…å­˜</h4><p>åœ¨<strong>ç±»åŠ è½½æ£€æŸ¥</strong>é€šè¿‡åï¼Œæ¥ä¸‹æ¥è™šæ‹Ÿæœºå°†ä¸ºæ–°ç”Ÿå¯¹è±¡<strong>åˆ†é…å†…å­˜</strong>ã€‚å¯¹è±¡æ‰€éœ€çš„å†…å­˜å¤§å°åœ¨ç±»åŠ è½½å®Œæˆåä¾¿å¯ç¡®å®šï¼Œä¸ºå¯¹è±¡åˆ†é…ç©ºé—´çš„ä»»åŠ¡ç­‰åŒäºæŠŠä¸€å—ç¡®å®šå¤§å°çš„å†…å­˜ä» Java å †ä¸­åˆ’åˆ†å‡ºæ¥ã€‚<strong>åˆ†é…æ–¹å¼</strong>æœ‰ <strong>â€œæŒ‡é’ˆç¢°æ’â€</strong> å’Œ <strong>â€œç©ºé—²åˆ—è¡¨â€</strong> ä¸¤ç§ï¼Œ<strong>é€‰æ‹©å“ªç§åˆ†é…æ–¹å¼ç”± Java å †æ˜¯å¦è§„æ•´å†³å®šï¼Œè€Œ Java å †æ˜¯å¦è§„æ•´åˆç”±æ‰€é‡‡ç”¨çš„åƒåœ¾æ”¶é›†å™¨æ˜¯å¦å¸¦æœ‰å‹ç¼©æ•´ç†åŠŸèƒ½å†³å®š</strong>ã€‚</p><p><strong>å†…å­˜åˆ†é…çš„ä¸¤ç§æ–¹å¼</strong> ï¼ˆè¡¥å……å†…å®¹ï¼Œéœ€è¦æŒæ¡ï¼‰ï¼š</p><ul><li>æŒ‡é’ˆç¢°æ’ï¼š <ul><li>é€‚ç”¨åœºåˆï¼šå †å†…å­˜è§„æ•´ï¼ˆå³æ²¡æœ‰å†…å­˜ç¢ç‰‡ï¼‰çš„æƒ…å†µä¸‹ã€‚</li><li>åŸç†ï¼šç”¨è¿‡çš„å†…å­˜å…¨éƒ¨æ•´åˆåˆ°ä¸€è¾¹ï¼Œæ²¡æœ‰ç”¨è¿‡çš„å†…å­˜æ”¾åœ¨å¦ä¸€è¾¹ï¼Œä¸­é—´æœ‰ä¸€ä¸ªåˆ†ç•ŒæŒ‡é’ˆï¼Œåªéœ€è¦å‘ç€æ²¡ç”¨è¿‡çš„å†…å­˜æ–¹å‘å°†è¯¥æŒ‡é’ˆç§»åŠ¨å¯¹è±¡å†…å­˜å¤§å°ä½ç½®å³å¯ã€‚</li><li>ä½¿ç”¨è¯¥åˆ†é…æ–¹å¼çš„ GC æ”¶é›†å™¨ï¼šSerial, ParNew</li></ul></li><li>ç©ºé—²åˆ—è¡¨ï¼š <ul><li>é€‚ç”¨åœºåˆï¼šå †å†…å­˜ä¸è§„æ•´çš„æƒ…å†µä¸‹ã€‚</li><li>åŸç†ï¼šè™šæ‹Ÿæœºä¼šç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨ä¸­ä¼šè®°å½•å“ªäº›å†…å­˜å—æ˜¯å¯ç”¨çš„ï¼Œåœ¨åˆ†é…çš„æ—¶å€™ï¼Œæ‰¾ä¸€å—å„¿è¶³å¤Ÿå¤§çš„å†…å­˜å—å„¿æ¥åˆ’åˆ†ç»™å¯¹è±¡å®ä¾‹ï¼Œæœ€åæ›´æ–°åˆ—è¡¨è®°å½•ã€‚</li><li>ä½¿ç”¨è¯¥åˆ†é…æ–¹å¼çš„ GC æ”¶é›†å™¨ï¼šCMS</li></ul></li></ul><p>é€‰æ‹©ä»¥ä¸Šä¸¤ç§æ–¹å¼ä¸­çš„å“ªä¸€ç§ï¼Œå–å†³äº Java å †å†…å­˜æ˜¯å¦è§„æ•´ã€‚è€Œ Java å †å†…å­˜æ˜¯å¦è§„æ•´ï¼Œå–å†³äº GC æ”¶é›†å™¨çš„ç®—æ³•æ˜¯â€æ ‡è®°-æ¸…é™¤â€ï¼Œè¿˜æ˜¯â€æ ‡è®°-æ•´ç†â€ï¼ˆä¹Ÿç§°ä½œâ€æ ‡è®°-å‹ç¼©â€ï¼‰ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¤åˆ¶ç®—æ³•å†…å­˜ä¹Ÿæ˜¯è§„æ•´çš„ã€‚</p><h4 id="Step3-åˆå§‹åŒ–é›¶å€¼"><a href="#Step3-åˆå§‹åŒ–é›¶å€¼" class="headerlink" title="Step3:åˆå§‹åŒ–é›¶å€¼"></a>Step3:åˆå§‹åŒ–é›¶å€¼</h4><p>å†…å­˜åˆ†é…å®Œæˆåï¼Œè™šæ‹Ÿæœºéœ€è¦å°†åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼ˆä¸åŒ…æ‹¬å¯¹è±¡å¤´ï¼‰ï¼Œè¿™ä¸€æ­¥æ“ä½œä¿è¯äº†å¯¹è±¡çš„å®ä¾‹å­—æ®µåœ¨ Java ä»£ç ä¸­å¯ä»¥ä¸èµ‹åˆå§‹å€¼å°±ç›´æ¥ä½¿ç”¨ï¼Œç¨‹åºèƒ½è®¿é—®åˆ°è¿™äº›å­—æ®µçš„æ•°æ®ç±»å‹æ‰€å¯¹åº”çš„é›¶å€¼ã€‚</p><h4 id="Step4-è®¾ç½®å¯¹è±¡å¤´"><a href="#Step4-è®¾ç½®å¯¹è±¡å¤´" class="headerlink" title="Step4:è®¾ç½®å¯¹è±¡å¤´"></a>Step4:è®¾ç½®å¯¹è±¡å¤´</h4><p>åˆå§‹åŒ–é›¶å€¼å®Œæˆä¹‹åï¼Œ<strong>è™šæ‹Ÿæœºè¦å¯¹å¯¹è±¡è¿›è¡Œå¿…è¦çš„è®¾ç½®</strong>ï¼Œä¾‹å¦‚è¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€å¦‚ä½•æ‰èƒ½æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„å“ˆå¸Œç ã€å¯¹è±¡çš„ GC åˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ã€‚ <strong>è¿™äº›ä¿¡æ¯å­˜æ”¾åœ¨å¯¹è±¡å¤´ä¸­ã€‚</strong></p><h4 id="Step5-æ‰§è¡Œ-init-æ–¹æ³•"><a href="#Step5-æ‰§è¡Œ-init-æ–¹æ³•" class="headerlink" title="Step5:æ‰§è¡Œ init æ–¹æ³•"></a>Step5:æ‰§è¡Œ init æ–¹æ³•</h4><p>åœ¨ä¸Šé¢å·¥ä½œéƒ½å®Œæˆä¹‹åï¼Œä»è™šæ‹Ÿæœºçš„è§†è§’æ¥çœ‹ï¼Œä¸€ä¸ªæ–°çš„å¯¹è±¡å·²ç»äº§ç”Ÿäº†ï¼Œä½†ä» Java ç¨‹åºçš„è§†è§’æ¥çœ‹ï¼Œå¯¹è±¡åˆ›å»ºæ‰åˆšå¼€å§‹ï¼Œ<code>&lt;init&gt;</code> æ–¹æ³•è¿˜æ²¡æœ‰æ‰§è¡Œï¼Œæ‰€æœ‰çš„å­—æ®µéƒ½è¿˜ä¸ºé›¶ã€‚æ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œæ‰§è¡Œ new æŒ‡ä»¤ä¹‹åä¼šæ¥ç€æ‰§è¡Œ <code>&lt;init&gt;</code> æ–¹æ³•ï¼ŒæŠŠå¯¹è±¡æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ ·ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„å¯¹è±¡æ‰ç®—å®Œå…¨äº§ç”Ÿå‡ºæ¥ã€‚</p><h3 id="å¯¹è±¡çš„è®¿é—®å®šä½çš„ä¸¤ç§æ–¹å¼"><a href="#å¯¹è±¡çš„è®¿é—®å®šä½çš„ä¸¤ç§æ–¹å¼" class="headerlink" title="å¯¹è±¡çš„è®¿é—®å®šä½çš„ä¸¤ç§æ–¹å¼"></a>å¯¹è±¡çš„è®¿é—®å®šä½çš„ä¸¤ç§æ–¹å¼</h3><p>æ–‡ç« å–è‡ª<a href="https://javaguide.cn/java/jvm/memory-area.html#%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%AE%BF%E9%97%AE%E5%AE%9A%E4%BD%8D">JavaGuide</a></p><p>å»ºç«‹å¯¹è±¡å°±æ˜¯ä¸ºäº†ä½¿ç”¨å¯¹è±¡ï¼Œæˆ‘ä»¬çš„ Java ç¨‹åºé€šè¿‡æ ˆä¸Šçš„ reference æ•°æ®æ¥æ“ä½œå †ä¸Šçš„å…·ä½“å¯¹è±¡ã€‚å¯¹è±¡çš„è®¿é—®æ–¹å¼ç”±è™šæ‹Ÿæœºå®ç°è€Œå®šï¼Œç›®å‰ä¸»æµçš„è®¿é—®æ–¹å¼æœ‰ï¼š<strong>ä½¿ç”¨å¥æŸ„</strong>ã€<strong>ç›´æ¥æŒ‡é’ˆ</strong>ã€‚</p><h4 id="å¥æŸ„"><a href="#å¥æŸ„" class="headerlink" title="å¥æŸ„"></a>å¥æŸ„</h4><p>å¦‚æœä½¿ç”¨å¥æŸ„çš„è¯ï¼Œé‚£ä¹ˆ Java å †ä¸­å°†ä¼šåˆ’åˆ†å‡ºä¸€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± ï¼Œreference ä¸­å­˜å‚¨çš„å°±æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œè€Œå¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡å®ä¾‹æ•°æ®ä¸å¯¹è±¡ç±»å‹æ•°æ®å„è‡ªçš„å…·ä½“åœ°å€ä¿¡æ¯ã€‚</p><p><img src="/../assets/JVM/image-20231023095835562.png" alt="image-20231023095835562"></p><h4 id="ç›´æ¥æŒ‡é’ˆ"><a href="#ç›´æ¥æŒ‡é’ˆ" class="headerlink" title="ç›´æ¥æŒ‡é’ˆ"></a>ç›´æ¥æŒ‡é’ˆ</h4><p>å¦‚æœä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼Œreference ä¸­å­˜å‚¨çš„ç›´æ¥å°±æ˜¯å¯¹è±¡çš„åœ°å€ã€‚</p><p><img src="/../assets/JVM/image-20231023095911060.png" alt="image-20231023095911060"></p><p>è¿™ä¸¤ç§å¯¹è±¡è®¿é—®æ–¹å¼å„æœ‰ä¼˜åŠ¿ã€‚ä½¿ç”¨å¥æŸ„æ¥è®¿é—®çš„æœ€å¤§å¥½å¤„æ˜¯ reference ä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šçš„å¥æŸ„åœ°å€ï¼Œåœ¨å¯¹è±¡è¢«ç§»åŠ¨æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­çš„å®ä¾‹æ•°æ®æŒ‡é’ˆï¼Œè€Œ reference æœ¬èº«ä¸éœ€è¦ä¿®æ”¹ã€‚ä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®æ–¹å¼æœ€å¤§çš„å¥½å¤„å°±æ˜¯é€Ÿåº¦å¿«ï¼Œå®ƒèŠ‚çœäº†ä¸€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€ã€‚</p><p>HotSpot è™šæ‹Ÿæœºä¸»è¦ä½¿ç”¨çš„å°±æ˜¯è¿™ç§æ–¹å¼æ¥è¿›è¡Œå¯¹è±¡è®¿é—®ã€‚</p><h1 id="åƒåœ¾å›æ”¶âœï¸"><a href="#åƒåœ¾å›æ”¶âœï¸" class="headerlink" title="åƒåœ¾å›æ”¶âœï¸"></a>åƒåœ¾å›æ”¶âœï¸</h1><p>æ–‡ç« å‚è€ƒè‡ªï¼š<a href="https://cyborg2077.github.io/2023/04/01/JvmPart3/">https://cyborg2077.github.io/2023/04/01/JvmPart3/</a></p><ul><li><p><strong>å†…å­˜æ³„éœ²</strong>ï¼šç”³è¯·ä½¿ç”¨å®Œçš„å†…å­˜æ²¡æœ‰é‡Šæ”¾ï¼Œå¯¼è‡´è™šæ‹Ÿæœºä¸èƒ½å†æ¬¡ä½¿ç”¨è¯¥å†…å­˜ï¼Œæ­¤æ—¶è¿™æ®µå†…å­˜å°±æ³„éœ²äº†ï¼Œå› ä¸ºç”³è¯·è€…ä¸ç”¨äº†ï¼Œè€Œåˆä¸èƒ½è¢«è™šæ‹Ÿæœºåˆ†é…ç»™åˆ«äººç”¨ã€‚</p></li><li><p><strong>å†…å­˜æº¢å‡º</strong>ï¼šç”³è¯·çš„å†…å­˜è¶…å‡ºäº†JVMèƒ½æä¾›çš„å†…å­˜å¤§å°ï¼Œæ­¤æ—¶ç§°ä¹‹ä¸ºæº¢å‡ºã€‚</p></li></ul><h2 id="å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¸¸é‡æ˜¯åºŸå¼ƒå¸¸é‡"><a href="#å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¸¸é‡æ˜¯åºŸå¼ƒå¸¸é‡" class="headerlink" title="å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¸¸é‡æ˜¯åºŸå¼ƒå¸¸é‡"></a>å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¸¸é‡æ˜¯åºŸå¼ƒå¸¸é‡</h2><p>å‡å¦‚åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­˜åœ¨å­—ç¬¦ä¸² â€œabcâ€ï¼Œå¦‚æœå½“å‰æ²¡æœ‰ä»»ä½• String å¯¹è±¡å¼•ç”¨è¯¥å­—ç¬¦ä¸²å¸¸é‡çš„è¯ï¼Œå°±è¯´æ˜å¸¸é‡ â€œabcâ€ å°±æ˜¯åºŸå¼ƒå¸¸é‡ï¼Œå¦‚æœè¿™æ—¶å‘ç”Ÿå†…å­˜å›æ”¶çš„è¯è€Œä¸”æœ‰å¿…è¦çš„è¯ï¼Œâ€abcâ€ å°±ä¼šè¢«ç³»ç»Ÿæ¸…ç†å‡ºå¸¸é‡æ± äº†ã€‚</p><h2 id="å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±»"><a href="#å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±»" class="headerlink" title="å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±»"></a>å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±»</h2><p>æ–¹æ³•åŒºä¸»è¦å›æ”¶çš„æ˜¯æ— ç”¨çš„ç±»ï¼Œé‚£ä¹ˆå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±»çš„å‘¢ï¼Ÿ</p><p>åˆ¤å®šä¸€ä¸ªå¸¸é‡æ˜¯å¦æ˜¯â€œåºŸå¼ƒå¸¸é‡â€æ¯”è¾ƒç®€å•ï¼Œè€Œè¦åˆ¤å®šä¸€ä¸ªç±»æ˜¯å¦æ˜¯â€œæ— ç”¨çš„ç±»â€çš„æ¡ä»¶åˆ™ç›¸å¯¹è‹›åˆ»è®¸å¤šã€‚ç±»éœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢ 3 ä¸ªæ¡ä»¶æ‰èƒ½ç®—æ˜¯ <strong>â€œæ— ç”¨çš„ç±»â€</strong>ï¼š</p><ul><li>è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯ Java å †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ã€‚</li><li>åŠ è½½è¯¥ç±»çš„ <code>ClassLoader</code> å·²ç»è¢«å›æ”¶ã€‚</li><li>è¯¥ç±»å¯¹åº”çš„ <code>java.lang.Class</code> å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚</li></ul><p>è™šæ‹Ÿæœºå¯ä»¥å¯¹æ»¡è¶³ä¸Šè¿° 3 ä¸ªæ¡ä»¶çš„æ— ç”¨ç±»è¿›è¡Œå›æ”¶ï¼Œè¿™é‡Œè¯´çš„ä»…ä»…æ˜¯â€œå¯ä»¥â€ï¼Œè€Œå¹¶ä¸æ˜¯å’Œå¯¹è±¡ä¸€æ ·ä¸ä½¿ç”¨äº†å°±ä¼šå¿…ç„¶è¢«å›æ”¶ã€‚</p><h2 id="å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶"><a href="#å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶" class="headerlink" title="å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶"></a>å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶</h2><h3 id="å¼•ç”¨è®¡æ•°æ³•"><a href="#å¼•ç”¨è®¡æ•°æ³•" class="headerlink" title="å¼•ç”¨è®¡æ•°æ³•"></a>å¼•ç”¨è®¡æ•°æ³•</h3><p>å½“ä¸€ä¸ªå¯¹è±¡è¢«å¼•ç”¨æ˜¯ï¼Œå°±å½“å¼•ç”¨å¯¹è±¡çš„å€¼<code>+1</code>ï¼Œå½“å¼•ç”¨å¯¹è±¡çš„å€¼ä¸º<code>0</code>æ—¶ï¼Œåˆ™è¯´æ˜è¯¥å¯¹è±¡æ²¡æœ‰è¢«å¼•ç”¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶</p><p>è¿™ä¸ªå¼•ç”¨è®¡æ•°æ³•å¬èµ·æ¥å¾ˆä¸é”™ï¼Œè€Œä¸”å®ç°èµ·æ¥ä¹Ÿéå¸¸çš„ç®€å•ï¼Œå¯æ˜¯å®ƒæœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“ä¸¤ä¸ªå¯¹è±¡å¾ªç¯å¼•ç”¨æ—¶ï¼Œä¸¤ä¸ªå¯¹è±¡çš„è®¡æ•°éƒ½æœª1ï¼Œå°±å¯¼è‡´è¿™ä¸¤ä¸ªå¯¹è±¡éƒ½æ— æ³•è¢«é‡Šæ”¾</p><p><img src="/../assets/JVM/image-20230920103843316.png" alt="å¼•ç”¨è®¡æ•°æ³•å¼Šç«¯"></p><h3 id="å¯è¾¾æ€§åˆ†æç®—æ³•"><a href="#å¯è¾¾æ€§åˆ†æç®—æ³•" class="headerlink" title="å¯è¾¾æ€§åˆ†æç®—æ³•"></a>å¯è¾¾æ€§åˆ†æç®—æ³•</h3><p>æ–‡ç« å‚è€ƒè‡ªï¼š<a href="https://blog.csdn.net/qq_32099833/article/details/109253339">https://blog.csdn.net/qq_32099833/article/details/109253339</a></p><ul><li>JVMåƒåœ¾å›æ”¶æœºåˆ¶çš„å¯è¾¾æ€§åˆ†æç®—æ³•ï¼Œæ˜¯ä¸€ç§åŸºäºå¼•ç”¨çš„åƒåœ¾å›æ”¶ç®—æ³•ã€‚å…¶åŸºæœ¬æ€æƒ³æ˜¯é€šè¿‡ä¸€ç³»åˆ—è¢«ç§°ä¸ºâ€GC Rootsâ€çš„æ ¹å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œå¯»æ‰¾æ‰€æœ‰è¢«æ ¹å¯¹è±¡ç›´æ¥æˆ–é—´æ¥å¼•ç”¨çš„å¯¹è±¡ï¼Œå°†è¿™äº›å¯¹è±¡ç§°ä¸ºâ€å¯è¾¾å¯¹è±¡â€ï¼Œè€Œæ²¡æœ‰è¢«æ‰¾åˆ°çš„å¯¹è±¡åˆ™è¢«è§†ä¸ºâ€ä¸å¯è¾¾å¯¹è±¡â€ï¼Œéœ€è¦è¢«å›æ”¶ã€‚</li></ul><p><img src="/../assets/JVM/image-20230920114845138.png" alt="image-20230920114845138"></p><ul><li><p>å¯è¾¾æ€§åˆ†æç®—æ³•çš„ä¸»è¦ä¼˜ç‚¹æ˜¯å¯ä»¥å¤„ç†å¤æ‚çš„å¼•ç”¨ç»“æ„ï¼Œä¾‹å¦‚å¾ªç¯å¼•ç”¨ã€äº¤å‰å¼•ç”¨ç­‰æƒ…å†µï¼Œèƒ½å¤Ÿè¯†åˆ«å‡ºæ‰€æœ‰å¯è¾¾å¯¹è±¡ï¼Œä»è€Œå‡†ç¡®åœ°è¿›è¡Œåƒåœ¾å›æ”¶ã€‚ä½†æ˜¯ï¼Œå®ƒä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œä¾‹å¦‚éœ€è¦è€—è´¹è¾ƒå¤šçš„æ—¶é—´è¿›è¡Œåƒåœ¾å›æ”¶ã€å¯èƒ½ä¼šå‡ºç°æ¼æ ‡å’Œè¯¯æ ‡ç­‰é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒJVMä¸­è¿˜é‡‡ç”¨äº†å…¶ä»–çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œå¦‚æ ‡è®°-æ¸…é™¤ç®—æ³•ã€å¤åˆ¶ç®—æ³•ã€æ ‡è®°-æ•´ç†ç®—æ³•ç­‰ï¼Œä»¥æé«˜åƒåœ¾å›æ”¶çš„æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚</p></li><li><p>åœ¨JVMä¸­ï¼Œæœ‰å‡ ç§ç±»å‹çš„GC Rootså¯¹è±¡ï¼š</p><ol><li><code>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</code>ï¼šè™šæ‹Ÿæœºæ ˆæ˜¯ç”¨äºå­˜å‚¨æ–¹æ³•è°ƒç”¨å’Œæ‰§è¡Œçš„æ ˆç©ºé—´ã€‚å½“ä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šåœ¨æ ˆä¸­åˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œç”¨äºå­˜å‚¨è¯¥æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€å‚æ•°å’Œè¿”å›å€¼ç­‰ä¿¡æ¯ã€‚å¦‚æœæ ˆå¸§ä¸­åŒ…å«å¯¹æŸä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±è¢«è§†ä¸ºGC Rootså¯¹è±¡ã€‚</li><li><code>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</code>ï¼šæ–¹æ³•åŒºæ˜¯ç”¨äºå­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡æ± ã€é™æ€å˜é‡ç­‰ä¿¡æ¯çš„å†…å­˜åŒºåŸŸã€‚å½“ä¸€ä¸ªç±»è¢«åŠ è½½åˆ°æ–¹æ³•åŒºæ—¶ï¼Œå…¶ä¸­çš„é™æ€å±æ€§ä¼šè¢«åˆ†é…åœ¨æ–¹æ³•åŒºä¸­ï¼Œå¦‚æœè¿™äº›é™æ€å±æ€§ä¸­åŒ…å«å¯¹æŸä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±è¢«è§†ä¸ºGC Rootså¯¹è±¡ã€‚</li><li><code>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</code>ï¼šå¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜å‚¨å¸¸é‡ã€‚å¦‚æœå¸¸é‡æ± ä¸­åŒ…å«å¯¹æŸä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±è¢«è§†ä¸ºGC Rootså¯¹è±¡ã€‚</li><li><code>æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIå¼•ç”¨çš„å¯¹è±¡</code>ï¼šJNIæ˜¯Java Native Interfaceçš„ç¼©å†™ï¼Œç”¨äºåœ¨Javaç¨‹åºä¸­è°ƒç”¨æœ¬åœ°æ–¹æ³•ï¼ˆå³ç”±Cæˆ–C++ç­‰è¯­è¨€ç¼–å†™çš„æ–¹æ³•ï¼‰ã€‚å½“æœ¬åœ°æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šåœ¨æœ¬åœ°æ–¹æ³•æ ˆä¸­åˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œå¦‚æœè¯¥æ ˆå¸§ä¸­åŒ…å«å¯¹æŸä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±è¢«è§†ä¸ºGC Rootså¯¹è±¡ã€‚</li><li><code>è¢«åŒæ­¥é”æŒæœ‰çš„å¯¹è±¡</code>ï¼šè¢«synchronizedé”ä½çš„å¯¹è±¡ä¹Ÿæ˜¯ç»å¯¹ä¸èƒ½å›æ”¶çš„ï¼Œå½“å‰æœ‰çº¿ç¨‹æŒæœ‰å¯¹è±¡é”å‘¢ï¼ŒGCå¦‚æœå›æ”¶äº†å¯¹è±¡ï¼Œé”ä¸å°±å¤±æ•ˆäº†å˜›ã€‚</li></ol></li></ul><h3 id="å››ç§å¼•ç”¨"><a href="#å››ç§å¼•ç”¨" class="headerlink" title="å››ç§å¼•ç”¨"></a>å››ç§å¼•ç”¨</h3><p>å‚è€ƒæ–‡ç« è‡ªï¼š<a href="https://blog.csdn.net/l540675759/article/details/73733763">https://blog.csdn.net/l540675759/article/details/73733763</a></p><h4 id="å¼ºå¼•ç”¨"><a href="#å¼ºå¼•ç”¨" class="headerlink" title="å¼ºå¼•ç”¨"></a>å¼ºå¼•ç”¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">Object</span>();</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°Objectè¿™ç±»å¯¹è±¡å°±å…·æœ‰å¼ºå¼•ç”¨ï¼Œå±äºä¸å¯å›æ”¶çš„èµ„æºï¼Œåƒåœ¾å›æ”¶å™¨ç»ä¸ä¼šå›æ”¶å®ƒã€‚å½“å†…å­˜ç©ºé—´ä¸è¶³ï¼ŒJavaè™šæ‹Ÿæœºå®æ„¿æŠ›å‡ºOutOfMemoryErroré”™è¯¯ï¼Œä½¿ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ï¼Œä¹Ÿä¸ä¼šé å›æ”¶å…·æœ‰å¼ºå¼•ç”¨çš„å¯¹è±¡ï¼Œæ¥è§£å†³å†…å­˜ä¸è¶³çš„é—®é¢˜ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šå¦‚æœæƒ³ä¸­æ–­æˆ–è€…å›æ”¶å¼ºå¼•ç”¨å¯¹è±¡ï¼Œå¯ä»¥æ˜¾å¼åœ°å°†å¼•ç”¨èµ‹å€¼ä¸ºnullï¼Œè¿™æ ·çš„è¯JVMå°±ä¼šåœ¨åˆé€‚çš„æ—¶é—´ï¼Œè¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p><h4 id="è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰"><a href="#è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰" class="headerlink" title="è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰"></a>è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰</h4><p>å¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰è½¯å¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒçš„æ€§è´¨å±äºå¯æœ‰å¯æ— çš„é‚£ç§ã€‚å¦‚æœæ­¤æ—¶å†…å­˜ç©ºé—´è¶³å¤Ÿï¼Œåƒåœ¾å›æ”¶å™¨å°±ä¸ä¼šå›æ”¶å®ƒï¼Œå¦‚æœå†…å­˜ç©ºé—´ä¸è¶³äº†ï¼Œå°±ä¼šå›æ”¶è¿™äº›å¯¹è±¡çš„å†…å­˜ã€‚åªè¦åƒåœ¾å›æ”¶å™¨æ²¡æœ‰å›æ”¶å®ƒï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«ç¨‹åºä½¿ç”¨ã€‚</p><p>è½¯å¼•ç”¨å¯ä»¥å’Œå¼•ç”¨é˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨ã€‚</p><p>å½“ä¸å†æœ‰å¼ºå¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡ï¼Œæ­¤æ—¶åªæœ‰è½¯å¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œè¯¥å¯¹è±¡ä¼šåœ¨å†…å­˜ä¸è¶³ä¸”åƒåœ¾å›æ”¶çš„æƒ…å†µä¸‹è¢«å›æ”¶ã€‚</p><p><img src="/../assets/JVM/image-20230920121439505.png" alt="image-20230920121439505"></p><p>è€Œè½¯å¼•ç”¨æœ¬èº«ä¹Ÿæ˜¯ä¸ªè¢«å¼ºå¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡</p><p><img src="/../assets/JVM/image-20230920121310033.png" alt="image-20230920121310033"></p><hr><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.ref.SoftReference;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¼”ç¤ºè½¯å¼•ç”¨</span></span><br><span class="line"><span class="comment"> * -Xmx20m -XX:+PrintGCDetails -verbose:gc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo_18</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_4MB</span> <span class="operator">=</span> <span class="number">4</span> * <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="comment">/*        List&lt;byte[]&gt; list = new ArrayList&lt;&gt;();</span></span><br><span class="line"><span class="comment">        for (int i = 0; i &lt; 15; i++) &#123;</span></span><br><span class="line"><span class="comment">            list.add(new byte[_4MB]);</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">        soft();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">soft</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;SoftReference&lt;<span class="type">byte</span>[]&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            SoftReference&lt;<span class="type">byte</span>[]&gt; ref = <span class="keyword">new</span> <span class="title class_">SoftReference</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">byte</span>[_4MB]);</span><br><span class="line">            System.out.println(ref.get());</span><br><span class="line">            list.add(ref);</span><br><span class="line">            System.out.println(list.size());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¾ªç¯ç»“æŸï¼š&quot;</span> + list.size());</span><br><span class="line">        <span class="keyword">for</span> (SoftReference&lt;<span class="type">byte</span>[]&gt; ref : list) &#123;</span><br><span class="line">            System.out.println(ref.get());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¼±å¼•ç”¨-WeakReference"><a href="#å¼±å¼•ç”¨-WeakReference" class="headerlink" title="å¼±å¼•ç”¨(WeakReference)"></a>å¼±å¼•ç”¨(WeakReference)</h4><p>å¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰å¼±å¼•ç”¨ï¼Œé‚£å…¶çš„æ€§è´¨ä¹Ÿæ˜¯å¯æœ‰å¯æ— çš„çŠ¶æ€ã€‚</p><p>è€Œå¼±å¼•ç”¨å’Œè½¯å¼•ç”¨çš„åŒºåˆ«åœ¨äºï¼šå¼±å¼•ç”¨çš„å¯¹è±¡æ‹¥æœ‰æ›´çŸ­çš„ç”Ÿå‘½å‘¨æœŸï¼Œåªè¦åƒåœ¾å›æ”¶å™¨æ‰«æåˆ°å®ƒï¼Œä¸ç®¡å†…å­˜ç©ºé—´å……è¶³ä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜ã€‚</p><p>å¼±å¼•ç”¨ä¹Ÿå¯ä»¥å’Œå¼•ç”¨é˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨ã€‚</p><h4 id="è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰"><a href="#è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰" class="headerlink" title="è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰"></a>è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰</h4><p>è™šå¼•ç”¨å’Œå‰é¢çš„è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ä¸åŒï¼Œå®ƒå¹¶ä¸å½±å“å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä¸è™šå¼•ç”¨å…³è”ï¼Œåˆ™è·Ÿæ²¡æœ‰å¼•ç”¨ä¸ä¹‹å…³è”ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚</p><p>æ³¨æ„ï¼šè™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—å…³è”ä½¿ç”¨ï¼Œå½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</p><p>ç¨‹åºå¯ä»¥é€šè¿‡åˆ¤æ–­å¼•ç”¨é˜Ÿåˆ—ä¸­æ˜¯å¦å·²ç»åŠ å…¥äº†è™šå¼•ç”¨ï¼Œæ¥äº†è§£è¢«å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å°†è¦è¢«åƒåœ¾å›æ”¶ã€‚å¦‚æœç¨‹åºå‘ç°æŸä¸ªè™šå¼•ç”¨å·²ç»è¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜è¢«å›æ”¶ä¹‹å‰é‡‡å–å¿…è¦çš„è¡ŒåŠ¨ã€‚</p><h4 id="å¼•ç”¨æ€»ç»“"><a href="#å¼•ç”¨æ€»ç»“" class="headerlink" title="å¼•ç”¨æ€»ç»“"></a>å¼•ç”¨æ€»ç»“</h4><p><img src="/../assets/JVM/image-20230920113244283.png" alt="image-20230920113244283"></p><hr><p><img src="/../assets/JVM/image-20230920114442159.png" alt="image-20230920114442159"></p><h2 id="åƒåœ¾å›æ”¶ç®—æ³•"><a href="#åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="åƒåœ¾å›æ”¶ç®—æ³•"></a>åƒåœ¾å›æ”¶ç®—æ³•</h2><h3 id="æ ‡è®°æ¸…é™¤ï¼ˆMark-Sweepï¼‰"><a href="#æ ‡è®°æ¸…é™¤ï¼ˆMark-Sweepï¼‰" class="headerlink" title="æ ‡è®°æ¸…é™¤ï¼ˆMark Sweepï¼‰"></a>æ ‡è®°æ¸…é™¤ï¼ˆMark Sweepï¼‰</h3><ul><li>é€Ÿåº¦è¾ƒå¿«</li><li>ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡</li></ul><p><img src="/../assets/JVM/image-20230920205051128.png" alt="æ ‡è®°æ¸…é™¤"></p><h3 id="æ ‡è®°æ•´ç†ï¼ˆMark-Compactï¼‰"><a href="#æ ‡è®°æ•´ç†ï¼ˆMark-Compactï¼‰" class="headerlink" title="æ ‡è®°æ•´ç†ï¼ˆMark Compactï¼‰"></a>æ ‡è®°æ•´ç†ï¼ˆMark Compactï¼‰</h3><ul><li>é€Ÿåº¦æ…¢</li><li>æ²¡æœ‰å†…å­˜ç¢ç‰‡</li></ul><p><img src="/../assets/JVM/image-20230920205412941.png" alt="æ ‡è®°æ•´ç†"></p><h3 id="å¤åˆ¶ï¼ˆCopyï¼‰"><a href="#å¤åˆ¶ï¼ˆCopyï¼‰" class="headerlink" title="å¤åˆ¶ï¼ˆCopyï¼‰"></a>å¤åˆ¶ï¼ˆCopyï¼‰</h3><ul><li>æ²¡æœ‰å†…å­˜ç¢ç‰‡</li><li>éœ€è¦å ç”¨åŒå€å†…å­˜ç©ºé—´</li></ul><p><img src="/../assets/JVM/image-20230920205522420.png" alt="å¤åˆ¶"></p><h2 id="åˆ†ä»£åƒåœ¾å›æ”¶"><a href="#åˆ†ä»£åƒåœ¾å›æ”¶" class="headerlink" title="åˆ†ä»£åƒåœ¾å›æ”¶"></a>åˆ†ä»£åƒåœ¾å›æ”¶</h2><p><img src="/../assets/JVM/image-20230920205716241.png" alt="åˆ†ä»£åƒåœ¾å›æ”¶"></p><ul><li>å¯¹è±¡é¦–å…ˆåˆ†é…åœ¨ä¼Šç”¸å›­åŒºåŸŸ</li><li>æ–°ç”Ÿä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œè§¦å‘ minor gcï¼Œä¼Šç”¸å›­å’Œ from å­˜æ´»çš„å¯¹è±¡ä½¿ç”¨ copy å¤åˆ¶åˆ° to ä¸­ï¼Œå­˜æ´»çš„å¯¹è±¡å¹´é¾„åŠ  1å¹¶ä¸”äº¤æ¢ from to</li><li>minor gc ä¼šå¼•å‘ stop the worldï¼Œæš‚åœå…¶å®ƒç”¨æˆ·çš„çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ‰æ¢å¤è¿è¡Œ </li><li>å½“å¯¹è±¡å¯¿å‘½è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œä¼šæ™‹å‡è‡³è€å¹´ä»£ï¼Œæœ€å¤§å¯¿å‘½æ˜¯15ï¼ˆ4bitï¼‰</li><li>å½“è€å¹´ä»£ç©ºé—´ä¸è¶³ï¼Œä¼šå…ˆå°è¯•è§¦å‘ minor gcï¼Œå¦‚æœä¹‹åç©ºé—´ä»ä¸è¶³ï¼Œé‚£ä¹ˆè§¦å‘ full gcï¼ŒSTWï¼ˆ stop the worldï¼‰çš„æ—¶é—´æ›´é•¿</li></ul><h3 id="è¡¥å……-1"><a href="#è¡¥å……-1" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h3><ul><li><p>å½“ä¸€æ¬¡ç”³è¯·çš„å†…å­˜å¤§è¿‡ä¼Šç”¸å›­ï¼Œå¤§è¿‡å¹¸å­˜åŒºæ—¶ï¼Œä¸”è€å¹´ä»£æœ‰è¶³å¤Ÿå†…å­˜ç©ºé—´æ—¶ï¼Œå¯ä»¥ç›´æ¥æ”¾å…¥è€å¹´ä»£</p></li><li><p>ä¸€ä¸ªçº¿ç¨‹å†…å‡ºç°äº†å†…å­˜æº¢å‡ºæ—¶ä¸ä¼šå½±å“åˆ«çš„è¿›ç¨‹çš„æ‰§è¡Œ</p></li></ul><h2 id="GCåˆ†ç±»"><a href="#GCåˆ†ç±»" class="headerlink" title="GCåˆ†ç±»"></a>GCåˆ†ç±»</h2><p>é’ˆå¯¹ HotSpot VM çš„å®ç°ï¼Œå®ƒé‡Œé¢çš„ GC å…¶å®å‡†ç¡®åˆ†ç±»åªæœ‰ä¸¤å¤§ç§ï¼š</p><p>éƒ¨åˆ†æ”¶é›† (Partial GC)ï¼š</p><ul><li>æ–°ç”Ÿä»£æ”¶é›†ï¼ˆMinor GC &#x2F; Young GCï¼‰ï¼šåªå¯¹æ–°ç”Ÿä»£è¿›è¡Œåƒåœ¾æ”¶é›†ï¼›</li><li>è€å¹´ä»£æ”¶é›†ï¼ˆMajor GC &#x2F; Old GCï¼‰ï¼šåªå¯¹è€å¹´ä»£è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ Major GC åœ¨æœ‰çš„è¯­å¢ƒä¸­ä¹Ÿç”¨äºæŒ‡ä»£æ•´å †æ”¶é›†ï¼›</li><li>æ··åˆæ”¶é›†ï¼ˆMixed GCï¼‰ï¼šå¯¹æ•´ä¸ªæ–°ç”Ÿä»£å’Œéƒ¨åˆ†è€å¹´ä»£è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚</li></ul><p>æ•´å †æ”¶é›† (Full GC)ï¼šæ”¶é›†æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºã€‚</p><h2 id="åƒåœ¾å›æ”¶å™¨"><a href="#åƒåœ¾å›æ”¶å™¨" class="headerlink" title="åƒåœ¾å›æ”¶å™¨"></a>åƒåœ¾å›æ”¶å™¨</h2><p>æ–‡ç« å‚è€ƒè‡ªï¼š<a href="https://cloud.tencent.com/developer/article/1592943">https://cloud.tencent.com/developer/article/1592943</a></p><p>å¦‚æœä¸¤ä¸ªæ”¶é›†å™¨ä¹‹é—´å­˜åœ¨è¿çº¿ï¼Œå°±è¯´æ˜å®ƒä»¬å¯ä»¥æ­é…ä½¿ç”¨ã€‚</p><p><img src="/../assets/JVM/image-20230925224500405.png" alt="image-20230925224500405"></p><h3 id="æ–°ç”Ÿä»£æ”¶é›†å™¨"><a href="#æ–°ç”Ÿä»£æ”¶é›†å™¨" class="headerlink" title="æ–°ç”Ÿä»£æ”¶é›†å™¨"></a>æ–°ç”Ÿä»£æ”¶é›†å™¨</h3><h4 id="Serial"><a href="#Serial" class="headerlink" title="Serial"></a>Serial</h4><ul><li>å•çº¿ç¨‹ï¼Œç®€å•é«˜æ•ˆ</li><li>å †å†…å­˜è¾ƒå°ï¼Œé€‚åˆä¸ªäººç”µè„‘</li><li>åœ¨å¤§å‹åº”ç”¨ç¨‹åºä¸­å¯èƒ½ä¼šå‡ºç°åœé¡¿æ—¶é—´è¿‡é•¿çš„é—®é¢˜</li></ul><hr><p>Serialæ–°ç”Ÿä»£ï¼šå¤åˆ¶                       SerialOldè€å¹´ä»£ï¼šæ ‡è®°æ•´ç†</p><p><img src="/../assets/JVM/image-20230921214603737.png" alt="image-20230921214603737"></p><h4 id="ParNew"><a href="#ParNew" class="headerlink" title="ParNew"></a>ParNew</h4><p>ParNewæ”¶é›†å™¨å°±æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªæ–°ç”Ÿä»£æ”¶é›†å™¨ã€‚é™¤äº†ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†å¤–ï¼Œå…¶ä½™è¡Œä¸ºåŒ…æ‹¬Serialæ”¶é›†å™¨å¯ç”¨çš„æ‰€æœ‰æ§åˆ¶å‚æ•°ã€æ”¶é›†ç®—æ³•ï¼ˆå¤åˆ¶ç®—æ³•ï¼‰ã€Stop The Worldã€å¯¹è±¡åˆ†é…è§„åˆ™ã€å›æ”¶ç­–ç•¥ç­‰ä¸Serialæ”¶é›†å™¨å®Œå…¨ç›¸åŒï¼Œä¸¤è€…å…±ç”¨äº†ç›¸å½“å¤šçš„ä»£ç ã€‚</p><p>ParNewæ”¶é›†å™¨çš„å·¥ä½œè¿‡ç¨‹å¦‚ä¸‹å›¾ï¼ˆè€å¹´ä»£é‡‡ç”¨Serial Oldæ”¶é›†å™¨ï¼‰ï¼š</p><p><img src="/../assets/JVM/image-20230925224749631.png" alt="image-20230925224749631"></p><h4 id="Parallel-Scavenge"><a href="#Parallel-Scavenge" class="headerlink" title="Parallel Scavenge"></a>Parallel Scavenge</h4><ul><li>å¤šçº¿ç¨‹</li><li>å †å†…å­˜è¾ƒå¤§ï¼Œå¤šæ ¸ cpu</li><li>è®©å•ä½æ—¶é—´å†…ï¼ŒSTW çš„æ—¶é—´æœ€çŸ­ 0.2 0.2 &#x3D; 0.4ï¼Œåƒåœ¾å›æ”¶æ—¶é—´å æ¯”æœ€ä½ï¼Œè¿™æ ·å°±ç§°ååé‡é«˜</li></ul><ul><li>JDK 1.8 é»˜è®¤é‡‡ç”¨çš„å°±æ˜¯è¿™ç§åƒåœ¾å›æ”¶å™¨</li><li>ä¸è®¾ç½®å‚æ•°æ—¶ï¼Œåƒåœ¾å›æ”¶çº¿ç¨‹æ•°é»˜è®¤å°±æ˜¯cpuçš„ä¸ªæ•°</li></ul><p>Parallel Scavengeæ”¶é›†å™¨ä¹Ÿæ˜¯ä¸€ä¸ªå¹¶è¡Œçš„å¤šçº¿ç¨‹æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå®ƒä¹Ÿä½¿ç”¨å¤åˆ¶ç®—æ³•ã€‚Parallel Scavengeæ”¶é›†å™¨çš„ç‰¹ç‚¹æ˜¯å®ƒçš„å…³æ³¨ç‚¹ä¸å…¶ä»–æ”¶é›†å™¨ä¸åŒï¼ŒCMSç­‰æ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ˜¯å°½å¯èƒ½ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼Œè€ŒParallel Scavengeæ”¶é›†å™¨çš„ç›®æ ‡æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ï¼ˆThroughputï¼‰ã€‚</p><p>åœé¡¿æ—¶é—´è¶ŠçŸ­å°±è¶Šé€‚åˆéœ€è¦ä¸ç”¨æˆ·äº¤äº’çš„ç¨‹åºï¼Œè‰¯å¥½çš„å“åº”é€Ÿåº¦èƒ½æå‡ç”¨æˆ·ä½“éªŒã€‚è€Œé«˜ååé‡åˆ™å¯ä»¥é«˜æ•ˆç‡åœ°åˆ©ç”¨CPUæ—¶é—´ï¼Œå°½å¿«å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡ï¼Œä¸»è¦é€‚åˆåœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ã€‚</p><p><img src="/../assets/JVM/image-20230921215041545.png" alt="image-20230921215041545"></p><h3 id="è€å¹´ä»£æ”¶é›†å™¨"><a href="#è€å¹´ä»£æ”¶é›†å™¨" class="headerlink" title="è€å¹´ä»£æ”¶é›†å™¨"></a>è€å¹´ä»£æ”¶é›†å™¨</h3><h4 id="Serial-Oldæ”¶é›†å™¨"><a href="#Serial-Oldæ”¶é›†å™¨" class="headerlink" title="Serial Oldæ”¶é›†å™¨"></a>Serial Oldæ”¶é›†å™¨</h4><p>Serial Old æ˜¯ Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œä½¿ç”¨â€œæ ‡è®°-æ•´ç†â€ï¼ˆMark-Compactï¼‰ç®—æ³•ã€‚</p><p>æ­¤æ”¶é›†å™¨çš„ä¸»è¦æ„ä¹‰ä¹Ÿæ˜¯åœ¨äºç»™Clientæ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºä½¿ç”¨ã€‚å¦‚æœåœ¨Serveræ¨¡å¼ä¸‹ï¼Œå®ƒè¿˜æœ‰ä¸¤å¤§ç”¨é€”ï¼š</p><ul><li>åœ¨JDK1.5 ä»¥åŠä¹‹å‰ç‰ˆæœ¬ï¼ˆParallel Oldè¯ç”Ÿä»¥å‰ï¼‰ä¸­ä¸Parallel Scavengeæ”¶é›†å™¨æ­é…ä½¿ç”¨ã€‚</li><li>ä½œä¸ºCMSæ”¶é›†å™¨çš„åå¤‡é¢„æ¡ˆï¼Œåœ¨å¹¶å‘æ”¶é›†å‘ç”ŸConcurrent Mode Failureæ—¶ä½¿ç”¨ã€‚</li></ul><blockquote><p>å®ƒçš„å·¥ä½œæµç¨‹ä¸Serialæ”¶é›†å™¨ç›¸åŒ</p></blockquote><h4 id="Parallel-Old"><a href="#Parallel-Old" class="headerlink" title="Parallel Old"></a>Parallel Old</h4><p>Parallel Oldæ”¶é›†å™¨æ˜¯Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä½¿ç”¨å¤šçº¿ç¨‹å’Œâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•ã€‚</p><hr><p>Parallelæ–°ç”Ÿä»£ï¼šå¤åˆ¶            ParallelOldè€å¹´ä»£ï¼šæ ‡è®°æ•´ç†</p><p><img src="/../assets/JVM/image-20230921215041545.png" alt="image-20230921215041545"></p><h4 id="å“åº”æ—¶é—´ä¼˜å…ˆï¼ˆCMS-â€“-Concurrent-Mark-Sweepï¼‰â­â­â­"><a href="#å“åº”æ—¶é—´ä¼˜å…ˆï¼ˆCMS-â€“-Concurrent-Mark-Sweepï¼‰â­â­â­" class="headerlink" title="å“åº”æ—¶é—´ä¼˜å…ˆï¼ˆCMS â€“&gt; Concurrent Mark Sweepï¼‰â­â­â­"></a>å“åº”æ—¶é—´ä¼˜å…ˆï¼ˆCMS â€“&gt; Concurrent Mark Sweepï¼‰â­â­â­</h4><ul><li>å¤šçº¿ç¨‹</li><li>å †å†…å­˜è¾ƒå¤§ï¼Œå¤šæ ¸ cpu</li><li>å°½å¯èƒ½è®©å•æ¬¡ STW çš„æ—¶é—´æœ€çŸ­   0.1 0.1 0.1 0.1 0.1 &#x3D; 0.5</li></ul><hr><p>CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ä¸€ç§ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œå®ƒéå¸¸ç¬¦åˆé‚£äº›é›†ä¸­åœ¨äº’è”ç½‘ç«™æˆ–è€…B&#x2F;Sç³»ç»Ÿçš„æœåŠ¡ç«¯ä¸Šçš„Javaåº”ç”¨ï¼Œè¿™äº›åº”ç”¨éƒ½éå¸¸é‡è§†æœåŠ¡çš„å“åº”é€Ÿåº¦ã€‚ä»åå­—ä¸Šï¼ˆâ€œMark Sweepâ€ï¼‰å°±å¯ä»¥çœ‹å‡ºå®ƒæ˜¯åŸºäºâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•å®ç°çš„ã€‚</p><h5 id="æ‰§è¡Œæµç¨‹"><a href="#æ‰§è¡Œæµç¨‹" class="headerlink" title="æ‰§è¡Œæµç¨‹"></a>æ‰§è¡Œæµç¨‹</h5><p>CMSæ”¶é›†å™¨å·¥ä½œçš„æ•´ä¸ªæµç¨‹åˆ†ä¸ºä»¥ä¸‹4ä¸ªæ­¥éª¤ï¼š</p><ul><li>åˆå§‹æ ‡è®°ï¼ˆCMS initial markï¼‰ï¼šä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œéœ€è¦â€œStop The Worldâ€ã€‚</li><li>å¹¶å‘æ ‡è®°ï¼ˆCMS concurrent markï¼‰ï¼šè¿›è¡ŒGC Roots Tracingçš„è¿‡ç¨‹ï¼Œåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿ã€‚</li><li>é‡æ–°æ ‡è®°ï¼ˆCMS remarkï¼‰ï¼šä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´ä¸€èˆ¬ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µç¨é•¿ä¸€äº›ï¼Œä½†è¿œæ¯”å¹¶å‘æ ‡è®°çš„æ—¶é—´çŸ­ã€‚æ­¤é˜¶æ®µä¹Ÿéœ€è¦â€œStop The Worldâ€ã€‚</li><li>å¹¶å‘æ¸…é™¤ï¼ˆCMS concurrent sweepï¼‰</li></ul><p>ç”±äºæ•´ä¸ªè¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿çš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤è¿‡ç¨‹æ”¶é›†å™¨çº¿ç¨‹éƒ½å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œã€‚</p><p>æ‰€ä»¥ï¼Œä»æ€»ä½“ä¸Šæ¥è¯´ï¼ŒCMSæ”¶é›†å™¨çš„å†…å­˜å›æ”¶è¿‡ç¨‹æ˜¯ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å¹¶å‘æ‰§è¡Œçš„ã€‚é€šè¿‡ä¸‹å›¾å¯ä»¥æ¯”è¾ƒæ¸…æ¥šåœ°çœ‹åˆ°CMSæ”¶é›†å™¨çš„è¿ä½œæ­¥éª¤ä¸­å¹¶å‘å’Œéœ€è¦åœé¡¿çš„æ—¶é—´ï¼š</p><p><img src="/../assets/JVM/image-20230921220451317.png" alt="image-20230921220451317"></p><h5 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h5><ol><li><strong>ä¼˜ç‚¹</strong></li></ol><p>CMSæ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æ”¶é›†å™¨ï¼Œå®ƒçš„ä¸»è¦ä¼˜ç‚¹åœ¨åå­—ä¸Šå·²ç»ä½“ç°å‡ºæ¥äº†ï¼šå¹¶å‘æ”¶é›†ã€ä½åœé¡¿ï¼Œå› æ­¤CMSæ”¶é›†å™¨ä¹Ÿè¢«ç§°ä¸ºå¹¶å‘ä½åœé¡¿æ”¶é›†å™¨ï¼ˆConcurrent Low Pause Collectorï¼‰ã€‚</p><ol start="2"><li><strong>ç¼ºç‚¹</strong></li></ol><ul><li>å¯¹CPUèµ„æºéå¸¸æ•æ„Ÿ å…¶å®ï¼Œé¢å‘å¹¶å‘è®¾è®¡çš„ç¨‹åºéƒ½å¯¹CPUèµ„æºæ¯”è¾ƒæ•æ„Ÿã€‚åœ¨å¹¶å‘é˜¶æ®µï¼Œå®ƒè™½ç„¶ä¸ä¼šå¯¼è‡´ç”¨æˆ·çº¿ç¨‹åœé¡¿ï¼Œä½†ä¼šå› ä¸ºå ç”¨äº†ä¸€éƒ¨åˆ†çº¿ç¨‹ï¼ˆæˆ–è€…è¯´CPUèµ„æºï¼‰è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå˜æ…¢ï¼Œæ€»ååé‡ä¼šé™ä½ã€‚</li><li>CMSé»˜è®¤å¯åŠ¨çš„å›æ”¶çº¿ç¨‹æ•°æ˜¯ï¼ˆCPUæ•°é‡+3ï¼‰&#x2F;4ï¼Œä¹Ÿå°±æ˜¯å½“CPUåœ¨4ä¸ªä»¥ä¸Šæ—¶ï¼Œå¹¶å‘å›æ”¶æ—¶åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸å°‘äº25%çš„CPUèµ„æºï¼Œå¹¶ä¸”éšç€CPUæ•°é‡çš„å¢åŠ è€Œä¸‹é™ã€‚ä½†æ˜¯å½“CPUä¸è¶³4ä¸ªæ—¶ï¼ˆæ¯”å¦‚2ä¸ªï¼‰ï¼ŒCMSå¯¹ç”¨æˆ·ç¨‹åºçš„å½±å“å°±å¯èƒ½å˜å¾—å¾ˆå¤§ï¼Œå¦‚æœæœ¬æ¥CPUè´Ÿè½½å°±æ¯”è¾ƒå¤§ï¼Œè¿˜è¦åˆ†å‡ºä¸€åŠçš„è¿ç®—èƒ½åŠ›å»æ‰§è¡Œæ”¶é›†å™¨çº¿ç¨‹ï¼Œå°±å¯èƒ½å¯¼è‡´ç”¨æˆ·ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦å¿½ç„¶é™ä½äº†50%ï¼Œå…¶å®ä¹Ÿè®©äººæ— æ³•æ¥å—ã€‚</li><li>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼ˆFloating Garbageï¼‰ å¯èƒ½å‡ºç°â€œConcurrent Mode Failureâ€å¤±è´¥è€Œå¯¼è‡´å¦ä¸€æ¬¡Full GCçš„äº§ç”Ÿã€‚</li><li>ç”±äºCMSå¹¶å‘æ¸…ç†é˜¶æ®µç”¨æˆ·çº¿ç¨‹è¿˜åœ¨è¿è¡Œç€ï¼Œä¼´éšç¨‹åºè¿è¡Œè‡ªç„¶å°±è¿˜ä¼šæœ‰æ–°çš„åƒåœ¾ä¸æ–­äº§ç”Ÿã€‚è¿™ä¸€éƒ¨åˆ†åƒåœ¾å‡ºç°åœ¨æ ‡è®°è¿‡ç¨‹ä¹‹åï¼ŒCMSæ— æ³•å†å½“æ¬¡æ”¶é›†ä¸­å¤„ç†æ‰å®ƒä»¬ï¼Œåªå¥½ç•™å¾…ä¸‹ä¸€æ¬¡GCæ—¶å†æ¸…ç†æ‰ã€‚</li><li>è¿™ä¸€éƒ¨åˆ†åƒåœ¾å°±è¢«ç§°ä¸ºâ€œæµ®åŠ¨åƒåœ¾â€ã€‚ä¹Ÿæ˜¯ç”±äºåœ¨åƒåœ¾æ”¶é›†é˜¶æ®µç”¨æˆ·çº¿ç¨‹è¿˜éœ€è¦è¿è¡Œï¼Œé‚£ä¹Ÿå°±è¿˜éœ€è¦é¢„ç•™æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ç»™ç”¨æˆ·çº¿ç¨‹ä½¿ç”¨ï¼Œå› æ­¤CMSæ”¶é›†å™¨ä¸èƒ½åƒå…¶ä»–æ”¶é›†å™¨é‚£æ ·ç­‰åˆ°è€å¹´ä»£å‡ ä¹å®Œå…¨è¢«å¡«æ»¡äº†å†è¿›è¡Œæ”¶é›†ï¼Œéœ€è¦é¢„ç•™ä¸€éƒ¨åˆ†ç©ºé—´æä¾›å¹¶å‘æ”¶é›†æ—¶çš„ç¨‹åºè¿ä½œä½¿ç”¨ã€‚</li><li>æ ‡è®°-æ¸…é™¤ç®—æ³•å¯¼è‡´çš„ç©ºé—´ç¢ç‰‡ CMSæ˜¯ä¸€æ¬¾åŸºäºâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œè¿™æ„å‘³ç€æ”¶é›†ç»“æŸæ—¶ä¼šæœ‰å¤§é‡ç©ºé—´ç¢ç‰‡äº§ç”Ÿã€‚</li><li>ç©ºé—´ç¢ç‰‡è¿‡å¤šæ—¶ï¼Œå°†ä¼šç»™å¤§å¯¹è±¡åˆ†é…å¸¦æ¥å¾ˆå¤§éº»çƒ¦ï¼Œå¾€å¾€å‡ºç°è€å¹´ä»£ç©ºé—´å‰©ä½™ï¼Œä½†æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§è¿ç»­ç©ºé—´æ¥åˆ†é…å½“å‰å¯¹è±¡ã€‚</li></ul><h3 id="G1"><a href="#G1" class="headerlink" title="G1"></a>G1</h3><h4 id="G1ç‰¹ç‚¹"><a href="#G1ç‰¹ç‚¹" class="headerlink" title="G1ç‰¹ç‚¹"></a>G1ç‰¹ç‚¹</h4><ul><li><code>å¹¶è¡Œä¸å¹¶å‘</code>ï¼š G1 èƒ½å……åˆ†åˆ©ç”¨å¤šCPUã€å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼Œä½¿ç”¨å¤šä¸ªCPUæ¥ç¼©çŸ­â€œStop The Worldâ€åœé¡¿æ—¶é—´ï¼Œéƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæœ¬éœ€è¦åœé¡¿Javaçº¿ç¨‹æ‰§è¡Œçš„GCåŠ¨ä½œï¼ŒG1æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡å¹¶å‘çš„æ–¹å¼è®©Javaç¨‹åºç»§ç»­æ‰§è¡Œã€‚</li><li><code>åˆ†ä»£æ”¶é›†</code> ï¼šä¸å…¶ä»–æ”¶é›†å™¨ä¸€æ ·ï¼Œåˆ†ä»£æ¦‚å¿µåœ¨G1ä¸­ä¾ç„¶å¾—ä»¥ä¿ç•™ã€‚è™½ç„¶G1å¯ä»¥ä¸éœ€è¦å…¶ä»–æ”¶é›†å™¨é…åˆå°±èƒ½ç‹¬ç«‹ç®¡ç†æ•´ä¸ªGCå †ï¼Œä½†å®ƒèƒ½å¤Ÿé‡‡ç”¨ä¸åŒæ–¹å¼å»å¤„ç†æ–°åˆ›å»ºçš„å¯¹è±¡å’Œå·²å­˜æ´»ä¸€æ®µæ—¶é—´ã€ç†¬è¿‡å¤šæ¬¡GCçš„æ—§å¯¹è±¡æ¥è·å–æ›´å¥½çš„æ”¶é›†æ•ˆæœã€‚</li><li><code>ç©ºé—´æ•´åˆ</code> ï¼šG1ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œä»å±€éƒ¨ï¼ˆä¸¤ä¸ªRegionä¹‹é—´ï¼‰ä¸Šæ¥çœ‹æ˜¯åŸºäºâ€œå¤åˆ¶â€ç®—æ³•å®ç°çš„ã€‚è¿™æ„å‘³ç€G1è¿è¡ŒæœŸé—´ä¸ä¼šäº§ç”Ÿå†…å­˜ç©ºé—´ç¢ç‰‡ï¼Œæ”¶é›†åèƒ½æä¾›è§„æ•´çš„å¯ç”¨å†…å­˜ã€‚æ­¤ç‰¹æ€§æœ‰åˆ©äºç¨‹åºé•¿æ—¶é—´è¿è¡Œï¼Œåˆ†é…å¤§å¯¹è±¡æ—¶ä¸ä¼šå› ä¸ºæ— æ³•æ‰¾åˆ°è¿ç»­å†…å­˜ç©ºé—´è€Œæå‰è§¦å‘ä¸‹ä¸€æ¬¡GCã€‚</li><li><code>å¯é¢„æµ‹çš„åœé¡¿</code>ï¼š è¿™æ˜¯G1ç›¸å¯¹CMSçš„ä¸€å¤§ä¼˜åŠ¿ï¼Œé™ä½åœé¡¿æ—¶é—´æ˜¯G1å’ŒCMSå…±åŒçš„å…³æ³¨ç‚¹ï¼Œä½†G1é™¤äº†é™ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸ºMæ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨GCä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡Næ¯«ç§’ï¼Œè¿™å‡ ä¹å·²ç»æ˜¯å®æ—¶Javaï¼ˆRTSJï¼‰çš„åƒåœ¾æ”¶é›†å™¨çš„ç‰¹å¾äº†ã€‚</li></ul><h4 id="æ¨ªè·¨æ•´ä¸ªå †å†…å­˜"><a href="#æ¨ªè·¨æ•´ä¸ªå †å†…å­˜" class="headerlink" title="æ¨ªè·¨æ•´ä¸ªå †å†…å­˜"></a>æ¨ªè·¨æ•´ä¸ªå †å†…å­˜</h4><p>åœ¨G1ä¹‹å‰çš„å…¶ä»–æ”¶é›†å™¨è¿›è¡Œæ”¶é›†çš„èŒƒå›´éƒ½æ˜¯æ•´ä¸ªæ–°ç”Ÿä»£æˆ–è€…è€ç”Ÿä»£ï¼Œè€ŒG1ä¸å†æ˜¯è¿™æ ·ã€‚</p><p>G1åœ¨ä½¿ç”¨æ—¶ï¼ŒJavaå †çš„å†…å­˜å¸ƒå±€ä¸å…¶ä»–æ”¶é›†å™¨æœ‰å¾ˆå¤§åŒºåˆ«ï¼Œå®ƒå°†æ•´ä¸ªJavaå †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼Œè™½ç„¶è¿˜ä¿ç•™æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¦‚å¿µï¼Œä½†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸å†æ˜¯ç‰©ç†éš”ç¦»çš„äº†ï¼Œè€Œéƒ½æ˜¯ä¸€éƒ¨åˆ†Regionï¼ˆä¸éœ€è¦è¿ç»­ï¼‰çš„é›†åˆã€‚</p><h4 id="å»ºç«‹å¯é¢„æµ‹çš„æ—¶é—´æ¨¡å‹"><a href="#å»ºç«‹å¯é¢„æµ‹çš„æ—¶é—´æ¨¡å‹" class="headerlink" title="å»ºç«‹å¯é¢„æµ‹çš„æ—¶é—´æ¨¡å‹"></a>å»ºç«‹å¯é¢„æµ‹çš„æ—¶é—´æ¨¡å‹</h4><p>G1æ”¶é›†å™¨ä¹‹æ‰€ä»¥èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œæ˜¯å› ä¸ºå®ƒå¯ä»¥æœ‰è®¡åˆ’åœ°é¿å…åœ¨æ•´ä¸ªJavaå †ä¸­è¿›è¡Œå…¨åŒºåŸŸçš„åƒåœ¾æ”¶é›†ã€‚G1è·Ÿè¸ªå„ä¸ªRegioné‡Œé¢çš„åƒåœ¾å †ç§¯çš„ä»·å€¼å¤§å°ï¼ˆå›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°ä»¥åŠå›æ”¶æ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼ï¼‰ï¼Œåœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„Regionï¼ˆè¿™ä¹Ÿå°±æ˜¯Garbage-Firståç§°çš„æ¥ç”±ï¼‰ã€‚è¿™ç§ä½¿ç”¨Regionåˆ’åˆ†å†…å­˜ç©ºé—´ä»¥åŠæœ‰ä¼˜å…ˆçº§çš„åŒºåŸŸå›æ”¶æ–¹å¼ï¼Œä¿è¯äº†G1æ”¶é›†å™¨åœ¨æœ‰é™çš„æ—¶é—´å†…å¯ä»¥è·å–å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡ã€‚</p><h4 id="é¿å…å…¨å †æ‰«æâ€”â€”Remembered-Set"><a href="#é¿å…å…¨å †æ‰«æâ€”â€”Remembered-Set" class="headerlink" title="é¿å…å…¨å †æ‰«æâ€”â€”Remembered Set"></a>é¿å…å…¨å †æ‰«æâ€”â€”Remembered Set</h4><p>G1æŠŠJavaå †åˆ†ä¸ºå¤šä¸ªRegionï¼Œå°±æ˜¯â€œåŒ–æ•´ä¸ºé›¶â€ã€‚ä½†æ˜¯Regionä¸å¯èƒ½æ˜¯å­¤ç«‹çš„ï¼Œä¸€ä¸ªå¯¹è±¡åˆ†é…åœ¨æŸä¸ªRegionä¸­ï¼Œå¯ä»¥ä¸æ•´ä¸ªJavaå †ä»»æ„çš„å¯¹è±¡å‘ç”Ÿå¼•ç”¨å…³ç³»ã€‚åœ¨åšå¯è¾¾æ€§åˆ†æç¡®å®šå¯¹è±¡æ˜¯å¦å­˜æ´»çš„æ—¶å€™ï¼Œéœ€è¦æ‰«ææ•´ä¸ªJavaå †æ‰èƒ½ä¿è¯å‡†ç¡®æ€§ï¼Œè¿™æ˜¾ç„¶æ˜¯å¯¹GCæ•ˆç‡çš„æå¤§ä¼¤å®³ã€‚</p><p>ä¸ºäº†é¿å…å…¨å †æ‰«æçš„å‘ç”Ÿï¼Œè™šæ‹Ÿæœºä¸ºG1ä¸­æ¯ä¸ªRegionç»´æŠ¤äº†ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„Remembered Setã€‚è™šæ‹Ÿæœºå‘ç°ç¨‹åºåœ¨å¯¹Referenceç±»å‹çš„æ•°æ®è¿›è¡Œå†™æ“ä½œæ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªWrite Barrieræš‚æ—¶ä¸­æ–­å†™æ“ä½œã€‚</p><p>æ£€æŸ¥Referenceå¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å¤„äºä¸åŒçš„Regionä¹‹ä¸­ï¼ˆåœ¨åˆ†ä»£çš„ä¾‹å­ä¸­å°±æ˜¯æ£€æŸ¥æ˜¯å¦è€å¹´ä»£ä¸­çš„å¯¹è±¡å¼•ç”¨äº†æ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡ï¼‰ï¼Œå¦‚æœæ˜¯ï¼Œä¾¿é€šè¿‡CardTableæŠŠç›¸å…³å¼•ç”¨ä¿¡æ¯è®°å½•åˆ°è¢«å¼•ç”¨å¯¹è±¡æ‰€å±çš„Regionçš„Remembered Setä¹‹ä¸­ã€‚å½“è¿›è¡Œå†…å­˜å›æ”¶æ—¶ï¼Œåœ¨GCæ ¹èŠ‚ç‚¹çš„æšä¸¾èŒƒå›´ä¸­åŠ å…¥Remembered Setå³å¯ä¿è¯ä¸å¯¹å…¨å †æ‰«æä¹Ÿä¸ä¼šæœ‰é—æ¼ã€‚</p><h4 id="G1è¿è¡Œæµç¨‹"><a href="#G1è¿è¡Œæµç¨‹" class="headerlink" title="G1è¿è¡Œæµç¨‹"></a>G1è¿è¡Œæµç¨‹</h4><ul><li><code>åˆå§‹æ ‡è®°</code>ï¼š ä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¿®æ”¹TAMSï¼ˆNest Top Mark Startï¼‰çš„å€¼ï¼Œè®©ä¸‹ä¸€é˜¶æ®µç”¨æˆ·ç¨‹åºå¹¶å‘è¿è¡Œæ—¶ï¼Œèƒ½æ­£ç¡®çš„åœ¨Regionä¸­åˆ›å»ºå¯¹è±¡ï¼Œæ­¤é˜¶æ®µéœ€è¦<strong>åœé¡¿çº¿ç¨‹</strong>ï¼Œä½†è€—æ—¶å¾ˆçŸ­ã€‚</li><li><code>å¹¶å‘æ ‡è®°</code>ï¼š ä»GC Root å¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ‰¾åˆ°å­˜æ´»å¯¹è±¡ï¼Œæ­¤é˜¶æ®µè€—æ—¶è¾ƒé•¿ï¼Œä½†å¯ä¸ç”¨æˆ·ç¨‹åº<strong>å¹¶å‘æ‰§è¡Œ</strong>ã€‚</li><li><code>æœ€ç»ˆæ ‡è®°</code>ï¼šä¸ºäº†ä¿®æ­£åœ¨å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†æ ‡è®°è®°å½•ï¼Œè™šæ‹Ÿæœºå°†è¿™æ®µæ—¶é—´å¯¹è±¡å˜åŒ–è®°å½•åœ¨çº¿ç¨‹çš„Remembered Set Logsé‡Œé¢ï¼Œæœ€ç»ˆæ ‡è®°é˜¶æ®µéœ€è¦æŠŠRemembered Set Logsçš„æ•°æ®åˆå¹¶åˆ°Remembered Setä¸­ï¼Œè¿™é˜¶æ®µéœ€è¦<strong>åœé¡¿çº¿ç¨‹ï¼Œä½†æ˜¯å¯å¹¶è¡Œæ‰§è¡Œ</strong>ã€‚</li><li><code>ç­›é€‰å›æ”¶</code>ï¼š é¦–å…ˆå¯¹å„ä¸ªRegionä¸­çš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„GC åœé¡¿æ˜¯æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ã€‚æ­¤é˜¶æ®µå…¶å®ä¹Ÿå¯ä»¥åšåˆ°ä¸ç”¨æˆ·ç¨‹åºä¸€èµ·å¹¶å‘æ‰§è¡Œï¼Œä½†æ˜¯å› ä¸ºåªå›æ”¶ä¸€éƒ¨åˆ†Regionï¼Œæ—¶é—´æ˜¯ç”¨æˆ·å¯æ§åˆ¶çš„ï¼Œè€Œä¸”åœé¡¿ç”¨æˆ·çº¿ç¨‹å°†å¤§å¹…åº¦æé«˜æ”¶é›†æ•ˆç‡ã€‚</li></ul><p><img src="/../assets/JVM/image-20230925225550414.png" alt="image-20230925225550414"></p><h4 id="G1å’ŒCMSæ¯”è¾ƒ"><a href="#G1å’ŒCMSæ¯”è¾ƒ" class="headerlink" title="G1å’ŒCMSæ¯”è¾ƒ"></a>G1å’ŒCMSæ¯”è¾ƒ</h4><p>CMSï¼ˆConcurrent Mark-Sweepï¼‰å’ŒG1ï¼ˆGarbage-Firstï¼‰æ˜¯ä¸¤ç§ä¸åŒçš„Javaåƒåœ¾å›æ”¶å™¨ï¼Œå®ƒä»¬åœ¨åƒåœ¾å›æ”¶çš„å·¥ä½œæµç¨‹å’Œæ€§èƒ½ç‰¹ç‚¹ä¸Šæœ‰ä¸€äº›é‡è¦åŒºåˆ«ï¼š</p><ol><li>å·¥ä½œæµç¨‹ï¼š<ul><li>CMSï¼šCMSå›æ”¶å™¨çš„å·¥ä½œæµç¨‹åŒ…æ‹¬åˆå§‹æ ‡è®°ã€å¹¶å‘æ ‡è®°ã€é‡æ–°æ ‡è®°å’Œå¹¶å‘æ¸…é™¤å››ä¸ªé˜¶æ®µã€‚åˆå§‹æ ‡è®°å’Œé‡æ–°æ ‡è®°éœ€è¦â€Stop The Worldâ€ï¼Œè€Œå¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤å¯ä»¥ä¸åº”ç”¨ç¨‹åºå¹¶è¡Œæ‰§è¡Œã€‚å®ƒä»¥å°½é‡å‡å°‘åœé¡¿æ—¶é—´ä¸ºç›®æ ‡ï¼Œä½†åœ¨åˆå§‹æ ‡è®°å’Œé‡æ–°æ ‡è®°é˜¶æ®µä»ç„¶éœ€è¦è¾ƒé•¿çš„åœé¡¿æ—¶é—´ã€‚</li><li>G1ï¼šG1å›æ”¶å™¨çš„å·¥ä½œæµç¨‹åŒ…æ‹¬åˆå§‹æ ‡è®°ã€å¹¶å‘æ ‡è®°ã€æœ€ç»ˆæ ‡è®°å’Œç­›é€‰å›æ”¶å››ä¸ªé˜¶æ®µã€‚åˆå§‹æ ‡è®°å’Œæœ€ç»ˆæ ‡è®°éœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†è€—æ—¶çŸ­æš‚ã€‚å¹¶å‘æ ‡è®°å’Œç­›é€‰å›æ”¶å¯ä»¥ä¸åº”ç”¨ç¨‹åºå¹¶è¡Œæ‰§è¡Œã€‚G1å›æ”¶å™¨ä»¥â€Garbage-Firstâ€ä¸ºç›®æ ‡ï¼Œå°è¯•åœ¨æ»¡è¶³ç”¨æˆ·æŒ‡å®šçš„åœé¡¿æ—¶é—´ç›®æ ‡çš„æƒ…å†µä¸‹ï¼Œå°½é‡å›æ”¶åƒåœ¾å¯¹è±¡ã€‚</li></ul></li><li>åƒåœ¾å›æ”¶æ–¹å¼ï¼š<ul><li>CMSï¼šCMSå›æ”¶å™¨ä½¿ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•ã€‚å®ƒé¦–å…ˆæ ‡è®°å­˜æ´»å¯¹è±¡ï¼Œç„¶åæ¸…é™¤æœªæ ‡è®°çš„å¯¹è±¡ã€‚è¿™ä¼šå¯¼è‡´å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œå¯èƒ½éœ€è¦æ›´é¢‘ç¹çš„Full GCæ¥è§£å†³ã€‚</li><li>G1ï¼šG1å›æ”¶å™¨ä½¿ç”¨åˆ†ä»£åƒåœ¾å›æ”¶ï¼Œå°†å †å†…å­˜åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼ˆRegionï¼‰ï¼Œå¯ä»¥æœ‰é€‰æ‹©æ€§åœ°å›æ”¶è¿™äº›åŒºåŸŸã€‚G1å›æ”¶å™¨ä¼šå°½é‡é¿å…å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œå› ä¸ºå®ƒå¯ä»¥è¿›è¡ŒåŒºåŸŸä¹‹é—´çš„å†…å­˜æ‹·è´æ¥å‹ç¼©ç¢ç‰‡ã€‚</li></ul></li><li>åƒåœ¾å›æ”¶åœé¡¿æ—¶é—´ï¼š<ul><li>CMSï¼šCMSå›æ”¶å™¨çš„åœé¡¿æ—¶é—´ç›¸å¯¹è¾ƒçŸ­ï¼Œä½†åœ¨åˆå§‹æ ‡è®°å’Œé‡æ–°æ ‡è®°é˜¶æ®µä»ç„¶éœ€è¦è¾ƒé•¿çš„åœé¡¿æ—¶é—´ï¼Œè¿™å¯èƒ½åœ¨æŸäº›æƒ…å†µä¸‹å¯¹å“åº”æ—¶é—´æ•æ„Ÿçš„åº”ç”¨ç¨‹åºé€ æˆé—®é¢˜ã€‚</li><li>G1ï¼šG1å›æ”¶å™¨çš„åœé¡¿æ—¶é—´å¯æ§ï¼Œç”¨æˆ·å¯ä»¥æŒ‡å®šç›®æ ‡åœé¡¿æ—¶é—´ã€‚è¿™ä½¿å¾—G1æ›´é€‚åˆéœ€è¦å¯é¢„æµ‹åœé¡¿æ—¶é—´çš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥æ›´å¥½åœ°æ»¡è¶³å®æ—¶æ€§è¦æ±‚ã€‚</li></ul></li></ol><p>æ€»çš„æ¥è¯´ï¼ŒCMSå’ŒG1å›æ”¶å™¨éƒ½æ˜¯ä¸ºäº†å‡å°‘åƒåœ¾å›æ”¶å¼•èµ·çš„åœé¡¿æ—¶é—´è€Œè®¾è®¡çš„ï¼Œä½†å®ƒä»¬çš„å·¥ä½œæ–¹å¼å’Œæ€§èƒ½ç‰¹ç‚¹æœ‰æ‰€ä¸åŒã€‚G1åœ¨å†…å­˜ç¢ç‰‡å¤„ç†å’Œåœé¡¿æ—¶é—´å¯æ§æ€§æ–¹é¢æä¾›äº†æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œè€ŒCMSåˆ™åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½æ›´é€‚åˆç‰¹å®šçš„åº”ç”¨ç¨‹åºã€‚é€‰æ‹©å“ªä¸ªå›æ”¶å™¨åº”æ ¹æ®å…·ä½“åº”ç”¨ç¨‹åºçš„éœ€æ±‚å’Œæ€§èƒ½ç‰¹ç‚¹æ¥å†³å®šã€‚</p><h2 id="åƒåœ¾å›æ”¶è°ƒä¼˜"><a href="#åƒåœ¾å›æ”¶è°ƒä¼˜" class="headerlink" title="åƒåœ¾å›æ”¶è°ƒä¼˜"></a>åƒåœ¾å›æ”¶è°ƒä¼˜</h2><p>çœ‹ä¸æ‡‚ï¼Œåç»­è¡¥å……â€¦â€¦â€¦.</p><h1 id="ç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯âœï¸"><a href="#ç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯âœï¸" class="headerlink" title="ç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯âœï¸"></a>ç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯âœï¸</h1><h2 id="ç±»æ–‡ä»¶ç»“æ„"><a href="#ç±»æ–‡ä»¶ç»“æ„" class="headerlink" title="ç±»æ–‡ä»¶ç»“æ„"></a>ç±»æ–‡ä»¶ç»“æ„</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ClassFile &#123;</span><br><span class="line">    u4 magic;                  <span class="comment">// é­”æ•°ï¼Œç”¨äºæ ‡è¯†æ–‡ä»¶ç±»å‹</span></span><br><span class="line">    u2 minor_version;          <span class="comment">// Javaè™šæ‹Ÿæœºçš„æ¬¡ç‰ˆæœ¬å·</span></span><br><span class="line">    u2 major_version;          <span class="comment">// Javaè™šæ‹Ÿæœºçš„ä¸»ç‰ˆæœ¬å·</span></span><br><span class="line">    u2 constant_pool_count;    <span class="comment">// å¸¸é‡æ± å¤§å°</span></span><br><span class="line">    cp_info constant_pool[constant_pool_count-<span class="number">1</span>]; <span class="comment">// å¸¸é‡æ± æ•°ç»„</span></span><br><span class="line">    u2 access_flags;           <span class="comment">// è®¿é—®æ ‡è¯†ç¬¦ï¼Œç”¨äºè¡¨ç¤ºç±»æˆ–æ¥å£çš„è®¿é—®æ§åˆ¶</span></span><br><span class="line">    u2 this_class;             <span class="comment">// å½“å‰ç±»æˆ–æ¥å£çš„ç´¢å¼•</span></span><br><span class="line">    u2 super_class;            <span class="comment">// å½“å‰ç±»çš„è¶…ç±»(çˆ¶ç±»)ç´¢å¼•</span></span><br><span class="line">    u2 interfaces_count;       <span class="comment">// æ¥å£æ•°é‡</span></span><br><span class="line">    u2 interfaces[interfaces_count]; <span class="comment">// æ¥å£ç´¢å¼•åˆ—è¡¨</span></span><br><span class="line">    u2 fields_count;           <span class="comment">// å­—æ®µæ•°é‡</span></span><br><span class="line">    field_info fields[fields_count]; <span class="comment">// å­—æ®µä¿¡æ¯æ•°ç»„</span></span><br><span class="line">    u2 methods_count;          <span class="comment">// æ–¹æ³•æ•°é‡</span></span><br><span class="line">    method_info methods[methods_count]; <span class="comment">// æ–¹æ³•ä¿¡æ¯æ•°ç»„</span></span><br><span class="line">    u2 attributes_count;       <span class="comment">// ç±»æˆ–æ¥å£çš„é™„åŠ å±æ€§æ•°é‡</span></span><br><span class="line">    attribute_info attributes[attributes_count]; <span class="comment">// ç±»æˆ–æ¥å£çš„é™„åŠ å±æ€§ä¿¡æ¯æ•°ç»„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€æ®µjavaä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorld</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello, World!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿›è¡Œç¼–è¯‘åå¾—åˆ°çš„äºŒè¿›åˆ¶å­—èŠ‚ç æ–‡ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0000000</span> ca fe ba be <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">34</span> <span class="number">00</span> <span class="number">23</span> 0a <span class="number">00</span> <span class="number">06</span> <span class="number">00</span> <span class="number">15</span> 09</span><br><span class="line"><span class="number">0000020</span> <span class="number">00</span> <span class="number">16</span> <span class="number">00</span> <span class="number">17</span> 08 <span class="number">00</span> <span class="number">18</span> 0a <span class="number">00</span> <span class="number">19</span> <span class="number">00</span> 1a <span class="number">07</span> <span class="number">00</span> 1b <span class="number">07</span></span><br><span class="line"><span class="number">0000040</span> <span class="number">00</span> 1c <span class="number">01</span> <span class="number">00</span> <span class="number">06</span> 3c <span class="number">69</span> 6e <span class="number">69</span> <span class="number">74</span> 3e <span class="number">01</span> <span class="number">00</span> <span class="number">03</span> <span class="number">28</span> <span class="number">29</span></span><br><span class="line"><span class="number">0000060</span> <span class="number">56</span> <span class="number">01</span> <span class="number">00</span> <span class="number">04</span> <span class="number">43</span> <span class="number">6f</span> <span class="number">64</span> <span class="number">65</span> <span class="number">01</span> <span class="number">00</span> <span class="number">0f</span> 4c <span class="number">69</span> 6e <span class="number">65</span> 4e</span><br><span class="line"><span class="number">0000100</span> <span class="number">75</span> <span class="number">6d</span> <span class="number">62</span> <span class="number">65</span> <span class="number">72</span> <span class="number">54</span> <span class="number">61</span> <span class="number">62</span> 6c <span class="number">65</span> <span class="number">01</span> <span class="number">00</span> <span class="number">12</span> 4c <span class="number">6f</span> <span class="number">63</span></span><br><span class="line"><span class="number">0000120</span> <span class="number">61</span> 6c <span class="number">56</span> <span class="number">61</span> <span class="number">72</span> <span class="number">69</span> <span class="number">61</span> <span class="number">62</span> 6c <span class="number">65</span> <span class="number">54</span> <span class="number">61</span> <span class="number">62</span> 6c <span class="number">65</span> <span class="number">01</span></span><br><span class="line"><span class="number">0000140</span> <span class="number">00</span> <span class="number">04</span> <span class="number">74</span> <span class="number">68</span> <span class="number">69</span> <span class="number">73</span> <span class="number">01</span> <span class="number">00</span> <span class="number">1d</span> 4c <span class="number">63</span> 6e <span class="number">2f</span> <span class="number">69</span> <span class="number">74</span> <span class="number">63</span></span><br><span class="line"><span class="number">0000160</span> <span class="number">61</span> <span class="number">73</span> <span class="number">74</span> <span class="number">2f</span> 6a <span class="number">76</span> <span class="number">6d</span> <span class="number">2f</span> <span class="number">74</span> <span class="number">35</span> <span class="number">2f</span> <span class="number">48</span> <span class="number">65</span> 6c 6c <span class="number">6f</span></span><br><span class="line"><span class="number">0000200</span> <span class="number">57</span> <span class="number">6f</span> <span class="number">72</span> 6c <span class="number">64</span> 3b <span class="number">01</span> <span class="number">00</span> <span class="number">04</span> <span class="number">6d</span> <span class="number">61</span> <span class="number">69</span> 6e <span class="number">01</span> <span class="number">00</span> <span class="number">16</span></span><br><span class="line"><span class="number">0000220</span> <span class="number">28</span> 5b 4c 6a <span class="number">61</span> <span class="number">76</span> <span class="number">61</span> <span class="number">2f</span> 6c <span class="number">61</span> 6e <span class="number">67</span> <span class="number">2f</span> <span class="number">53</span> <span class="number">74</span> <span class="number">72</span></span><br><span class="line"><span class="number">0000240</span> <span class="number">69</span> 6e <span class="number">67</span> 3b <span class="number">29</span> <span class="number">56</span> <span class="number">01</span> <span class="number">00</span> <span class="number">04</span> <span class="number">61</span> <span class="number">72</span> <span class="number">67</span> <span class="number">73</span> <span class="number">01</span> <span class="number">00</span> <span class="number">13</span></span><br><span class="line"><span class="number">0000260</span> 5b 4c 6a <span class="number">61</span> <span class="number">76</span> <span class="number">61</span> <span class="number">2f</span> 6c <span class="number">61</span> 6e <span class="number">67</span> <span class="number">2f</span> <span class="number">53</span> <span class="number">74</span> <span class="number">72</span> <span class="number">69</span></span><br><span class="line"><span class="number">0000300</span> 6e <span class="number">67</span> 3b <span class="number">01</span> <span class="number">00</span> <span class="number">10</span> <span class="number">4d</span> <span class="number">65</span> <span class="number">74</span> <span class="number">68</span> <span class="number">6f</span> <span class="number">64</span> <span class="number">50</span> <span class="number">61</span> <span class="number">72</span> <span class="number">61</span></span><br><span class="line"><span class="number">0000320</span> <span class="number">6d</span> <span class="number">65</span> <span class="number">74</span> <span class="number">65</span> <span class="number">72</span> <span class="number">73</span> <span class="number">01</span> <span class="number">00</span> 0a <span class="number">53</span> <span class="number">6f</span> <span class="number">75</span> <span class="number">72</span> <span class="number">63</span> <span class="number">65</span> <span class="number">46</span></span><br><span class="line"><span class="number">0000340</span> <span class="number">69</span> 6c <span class="number">65</span> <span class="number">01</span> <span class="number">00</span> <span class="number">0f</span> <span class="number">48</span> <span class="number">65</span> 6c 6c <span class="number">6f</span> <span class="number">57</span> <span class="number">6f</span> <span class="number">72</span> 6c <span class="number">64</span></span><br><span class="line"><span class="number">0000360</span> 2e 6a <span class="number">61</span> <span class="number">76</span> <span class="number">61</span> 0c <span class="number">00</span> <span class="number">07</span> <span class="number">00</span> 08 <span class="number">07</span> <span class="number">00</span> <span class="number">1d</span> 0c <span class="number">00</span> 1e</span><br><span class="line"><span class="number">0000400</span> <span class="number">00</span> <span class="number">1f</span> <span class="number">01</span> <span class="number">00</span> 0b <span class="number">68</span> <span class="number">65</span> 6c 6c <span class="number">6f</span> <span class="number">20</span> <span class="number">77</span> <span class="number">6f</span> <span class="number">72</span> 6c <span class="number">64</span></span><br><span class="line"><span class="number">0000420</span> <span class="number">07</span> <span class="number">00</span> <span class="number">20</span> 0c <span class="number">00</span> <span class="number">21</span> <span class="number">00</span> <span class="number">22</span> <span class="number">01</span> <span class="number">00</span> 1b <span class="number">63</span> 6e <span class="number">2f</span> <span class="number">69</span> <span class="number">74</span></span><br><span class="line"><span class="number">0000440</span> <span class="number">63</span> <span class="number">61</span> <span class="number">73</span> <span class="number">74</span> <span class="number">2f</span> 6a <span class="number">76</span> <span class="number">6d</span> <span class="number">2f</span> <span class="number">74</span> <span class="number">35</span> <span class="number">2f</span> <span class="number">48</span> <span class="number">65</span> 6c 6c</span><br><span class="line"><span class="number">0000460</span> <span class="number">6f</span> <span class="number">57</span> <span class="number">6f</span> <span class="number">72</span> 6c <span class="number">64</span> <span class="number">01</span> <span class="number">00</span> <span class="number">10</span> 6a <span class="number">61</span> <span class="number">76</span> <span class="number">61</span> <span class="number">2f</span> 6c <span class="number">61</span></span><br><span class="line"><span class="number">0000500</span> 6e <span class="number">67</span> <span class="number">2f</span> <span class="number">4f</span> <span class="number">62</span> 6a <span class="number">65</span> <span class="number">63</span> <span class="number">74</span> <span class="number">01</span> <span class="number">00</span> <span class="number">10</span> 6a <span class="number">61</span> <span class="number">76</span> <span class="number">61</span></span><br><span class="line"><span class="number">0000520</span> <span class="number">2f</span> 6c <span class="number">61</span> 6e <span class="number">67</span> <span class="number">2f</span> <span class="number">53</span> <span class="number">79</span> <span class="number">73</span> <span class="number">74</span> <span class="number">65</span> <span class="number">6d</span> <span class="number">01</span> <span class="number">00</span> <span class="number">03</span> <span class="number">6f</span></span><br><span class="line"><span class="number">0000540</span> <span class="number">75</span> <span class="number">74</span> <span class="number">01</span> <span class="number">00</span> <span class="number">15</span> 4c 6a <span class="number">61</span> <span class="number">76</span> <span class="number">61</span> <span class="number">2f</span> <span class="number">69</span> <span class="number">6f</span> <span class="number">2f</span> <span class="number">50</span> <span class="number">72</span></span><br><span class="line"><span class="number">0000560</span> <span class="number">69</span> 6e <span class="number">74</span> <span class="number">53</span> <span class="number">74</span> <span class="number">72</span> <span class="number">65</span> <span class="number">61</span> <span class="number">6d</span> 3b <span class="number">01</span> <span class="number">00</span> <span class="number">13</span> 6a <span class="number">61</span> <span class="number">76</span></span><br><span class="line"><span class="number">0000600</span> <span class="number">61</span> <span class="number">2f</span> <span class="number">69</span> <span class="number">6f</span> <span class="number">2f</span> <span class="number">50</span> <span class="number">72</span> <span class="number">69</span> 6e <span class="number">74</span> <span class="number">53</span> <span class="number">74</span> <span class="number">72</span> <span class="number">65</span> <span class="number">61</span> <span class="number">6d</span></span><br><span class="line"><span class="number">0000620</span> <span class="number">01</span> <span class="number">00</span> <span class="number">07</span> <span class="number">70</span> <span class="number">72</span> <span class="number">69</span> 6e <span class="number">74</span> 6c 6e <span class="number">01</span> <span class="number">00</span> <span class="number">15</span> <span class="number">28</span> 4c 6a</span><br><span class="line"><span class="number">0000640</span> <span class="number">61</span> <span class="number">76</span> <span class="number">61</span> <span class="number">2f</span> 6c <span class="number">61</span> 6e <span class="number">67</span> <span class="number">2f</span> <span class="number">53</span> <span class="number">74</span> <span class="number">72</span> <span class="number">69</span> 6e <span class="number">67</span> 3b</span><br><span class="line"><span class="number">0000660</span> <span class="number">29</span> <span class="number">56</span> <span class="number">00</span> <span class="number">21</span> <span class="number">00</span> <span class="number">05</span> <span class="number">00</span> <span class="number">06</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">02</span> <span class="number">00</span> <span class="number">01</span></span><br><span class="line"><span class="number">0000700</span> <span class="number">00</span> <span class="number">07</span> <span class="number">00</span> 08 <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> 09 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">2f</span> <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">01</span></span><br><span class="line"><span class="number">0000720</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">05</span> 2a b7 <span class="number">00</span> <span class="number">01</span> b1 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">02</span> <span class="number">00</span> 0a <span class="number">00</span></span><br><span class="line"><span class="number">0000740</span> <span class="number">00</span> <span class="number">00</span> <span class="number">06</span> <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">04</span> <span class="number">00</span> 0b <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 0c <span class="number">00</span></span><br><span class="line"><span class="number">0000760</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">05</span> <span class="number">00</span> 0c <span class="number">00</span> <span class="number">0d</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 09 <span class="number">00</span> 0e <span class="number">00</span></span><br><span class="line"><span class="number">0001000</span> <span class="number">0f</span> <span class="number">00</span> <span class="number">02</span> <span class="number">00</span> 09 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">37</span> <span class="number">00</span> <span class="number">02</span> <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">0001020</span> 09 b2 <span class="number">00</span> <span class="number">02</span> <span class="number">12</span> <span class="number">03</span> b6 <span class="number">00</span> <span class="number">04</span> b1 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">02</span> <span class="number">00</span> 0a</span><br><span class="line"><span class="number">0001040</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 0a <span class="number">00</span> <span class="number">02</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">06</span> <span class="number">00</span> 08 <span class="number">00</span> <span class="number">07</span> <span class="number">00</span> 0b</span><br><span class="line"><span class="number">0001060</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 0c <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> 09 <span class="number">00</span> <span class="number">10</span> <span class="number">00</span> <span class="number">11</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">0001100</span> <span class="number">00</span> <span class="number">12</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">05</span> <span class="number">01</span> <span class="number">00</span> <span class="number">10</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">13</span> <span class="number">00</span></span><br><span class="line"><span class="number">0001120</span> <span class="number">00</span> <span class="number">00</span> <span class="number">02</span> <span class="number">00</span> <span class="number">14</span></span><br></pre></td></tr></table></figure><h2 id="å­—èŠ‚ç æŒ‡ä»¤"><a href="#å­—èŠ‚ç æŒ‡ä»¤" class="headerlink" title="å­—èŠ‚ç æŒ‡ä»¤"></a>å­—èŠ‚ç æŒ‡ä»¤</h2><h3 id="å…¥é—¨"><a href="#å…¥é—¨" class="headerlink" title="å…¥é—¨"></a>å…¥é—¨</h3><p>åœ¨ä¸Šé¢è¿™ä¸ªhelloworldä¸­æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œå¯¹åº”ç€ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤</p><ul><li><p>ä¸€ä¸ªæ˜¯<code>public cn.itcast.jvm.t5.HelloWorld();</code>æ„é€ æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2a b7 00 01 b1</span><br></pre></td></tr></table></figure><ol><li>2a &#x3D;&gt; aload_0 åŠ è½½ slot 0 çš„å±€éƒ¨å˜é‡ï¼Œå³ thisï¼Œåšä¸ºä¸‹é¢çš„ invokespecial æ„é€ æ–¹æ³•è°ƒç”¨çš„å‚æ•°</li><li>b7 &#x3D;&gt; invokespecial é¢„å¤‡è°ƒç”¨æ„é€ æ–¹æ³•ï¼Œå“ªä¸ªæ–¹æ³•å‘¢ï¼Ÿ</li><li>00 01 å¼•ç”¨å¸¸é‡æ± ä¸­ #1 é¡¹ï¼Œå³<code>Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</code></li><li>b1 è¡¨ç¤ºè¿”å›</li></ol></li><li><p>å¦ä¸€ä¸ªæ˜¯<code>public static void main(java.lang.String[]);</code>ä¸»æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b2 00 02 12 03 b6 00 04 b1</span><br></pre></td></tr></table></figure><ol><li>b2 &#x3D;&gt; getstatic ç”¨æ¥åŠ è½½é™æ€å˜é‡ï¼Œå“ªä¸ªé™æ€å˜é‡å‘¢ï¼Ÿ</li><li>00 02 å¼•ç”¨å¸¸é‡æ± ä¸­ #2 é¡¹ï¼Œå³<code>Field java/lang/System.out:Ljava/io/PrintStream;</code></li><li>12 &#x3D;&gt; ldc åŠ è½½å‚æ•°ï¼Œå“ªä¸ªå‚æ•°å‘¢ï¼Ÿ</li><li>03 å¼•ç”¨å¸¸é‡æ± ä¸­ #3 é¡¹ï¼Œå³ <code>String hello world</code></li><li>b6 &#x3D;&gt; invokevirtual é¢„å¤‡è°ƒç”¨æˆå‘˜æ–¹æ³•ï¼Œå“ªä¸ªæ–¹æ³•å‘¢ï¼Ÿ</li><li>00 04 å¼•ç”¨å¸¸é‡æ± ä¸­ #4 é¡¹ï¼Œå³<code>Method java/io/PrintStream.println:(Ljava/lang/String;)V</code></li><li>b1 è¡¨ç¤ºè¿”å›</li></ol></li></ul><h3 id="javapå·¥å…·"><a href="#javapå·¥å…·" class="headerlink" title="javapå·¥å…·"></a>javapå·¥å…·</h3><p>å¯ä»¥ä½¿ç”¨javapå·¥å…·æ¥åç¼–è¯‘classæ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">$ javap -v HelloWorld.<span class="keyword">class</span></span><br><span class="line"><span class="title class_">Classfile</span> /D:/Workspace/JVM/demo/target/classes/com/demo/HelloWorld.<span class="keyword">class</span></span><br><span class="line">  <span class="title class_">Last</span> modified <span class="number">2023</span>-<span class="number">4</span>-<span class="number">5</span>; size <span class="number">551</span> bytes</span><br><span class="line">  MD5 checksum 1389d939c65ba536eb81d1a5c61d99be</span><br><span class="line">  Compiled from <span class="string">&quot;HelloWorld.java&quot;</span>              </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">com</span>.demo.HelloWorld               </span><br><span class="line">  minor version: <span class="number">0</span>                             </span><br><span class="line">  major version: <span class="number">52</span>                            </span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">Constant pool:</span><br><span class="line">   #<span class="number">1</span> = Methodref          #<span class="number">6.</span>#<span class="number">20</span>         <span class="comment">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">   #<span class="number">2</span> = Fieldref           #<span class="number">21.</span>#<span class="number">22</span>        <span class="comment">// java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">   #<span class="number">3</span> = String             #<span class="number">23</span>            <span class="comment">// hello world</span></span><br><span class="line">   #<span class="number">4</span> = Methodref          #<span class="number">24.</span>#<span class="number">25</span>        <span class="comment">// java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">   #<span class="number">5</span> = Class              #<span class="number">26</span>            <span class="comment">// com/demo/HelloWorld</span></span><br><span class="line">   #<span class="number">6</span> = Class              #<span class="number">27</span>            <span class="comment">// java/lang/Object</span></span><br><span class="line">   #<span class="number">7</span> = Utf8               &lt;init&gt;</span><br><span class="line">   #<span class="number">8</span> = Utf8               ()V</span><br><span class="line">   #<span class="number">9</span> = Utf8               Code</span><br><span class="line">  #<span class="number">10</span> = Utf8               LineNumberTable</span><br><span class="line">  #<span class="number">11</span> = Utf8               LocalVariableTable</span><br><span class="line">  #<span class="number">12</span> = Utf8               <span class="built_in">this</span></span><br><span class="line">  #<span class="number">13</span> = Utf8               Lcom/demo/HelloWorld;</span><br><span class="line">  #<span class="number">14</span> = Utf8               main</span><br><span class="line">  #<span class="number">15</span> = Utf8               ([Ljava/lang/String;)V</span><br><span class="line">  #<span class="number">16</span> = Utf8               args</span><br><span class="line">  #<span class="number">17</span> = Utf8               [Ljava/lang/String;</span><br><span class="line">  #<span class="number">18</span> = Utf8               SourceFile</span><br><span class="line">  #<span class="number">19</span> = Utf8               HelloWorld.java</span><br><span class="line">  #<span class="number">20</span> = NameAndType        #<span class="number">7</span>:#<span class="number">8</span>          <span class="comment">// &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">  #<span class="number">21</span> = Class              #<span class="number">28</span>            <span class="comment">// java/lang/System</span></span><br><span class="line">  #<span class="number">22</span> = NameAndType        #<span class="number">29</span>:#<span class="number">30</span>        <span class="comment">// out:Ljava/io/PrintStream;</span></span><br><span class="line">  #<span class="number">23</span> = Utf8               hello world</span><br><span class="line">  #<span class="number">24</span> = Class              #<span class="number">31</span>            <span class="comment">// java/io/PrintStream</span></span><br><span class="line">  #<span class="number">25</span> = NameAndType        #<span class="number">32</span>:#<span class="number">33</span>        <span class="comment">// println:(Ljava/lang/String;)V</span></span><br><span class="line">  #<span class="number">26</span> = Utf8               com/demo/HelloWorld</span><br><span class="line">  #<span class="number">27</span> = Utf8               java/lang/Object</span><br><span class="line">  #<span class="number">28</span> = Utf8               java/lang/System</span><br><span class="line">  #<span class="number">29</span> = Utf8               out</span><br><span class="line">  #<span class="number">30</span> = Utf8               Ljava/io/PrintStream;</span><br><span class="line">  #<span class="number">31</span> = Utf8               java/io/PrintStream</span><br><span class="line">  #<span class="number">32</span> = Utf8               println</span><br><span class="line">  #<span class="number">33</span> = Utf8               (Ljava/lang/String;)V</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> com.demo.HelloWorld();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="number">1</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: getstatic     #<span class="number">2</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">         <span class="number">3</span>: ldc           #<span class="number">3</span>                  <span class="comment">// String hello world</span></span><br><span class="line">         <span class="number">5</span>: invokevirtual #<span class="number">4</span>                  <span class="comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">         <span class="number">8</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">5</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">6</span>: <span class="number">8</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">9</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: <span class="string">&quot;HelloWorld.java&quot;</span></span><br></pre></td></tr></table></figure><h3 id="å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹"><a href="#å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹" class="headerlink" title="å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹"></a>å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹</h3><ol><li>åŸå§‹javaä»£ç </li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo3_1</span> &#123;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">Â  Â  Â  Â <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">Â  Â  Â  Â <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> Short.MAX_VALUE + <span class="number">1</span>;</span><br><span class="line">Â  Â  Â  Â <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> a + b;</span><br><span class="line">Â  Â  Â  Â System.out.println(c); </span><br><span class="line">Â &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>ç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">$ javap -v Demo_20.<span class="keyword">class</span></span><br><span class="line"><span class="title class_">Classfile</span> /D:/Workspace/JVM/demo/target/classes/com/demo/Demo_20.<span class="keyword">class</span></span><br><span class="line">  <span class="title class_">Last</span> modified <span class="number">2023</span>-<span class="number">4</span>-<span class="number">7</span>; size <span class="number">601</span> bytes       </span><br><span class="line">  MD5 checksum 0f9e41fb2a7334a69c89d2661540f4f1</span><br><span class="line">  Compiled from <span class="string">&quot;Demo_20.java&quot;</span>                 </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">com</span>.demo.Demo_20                  </span><br><span class="line">  minor version: <span class="number">0</span>                             </span><br><span class="line">  major version: <span class="number">52</span>                            </span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER                 </span><br><span class="line">Constant pool:                                 </span><br><span class="line">   #<span class="number">1</span> = Methodref          #<span class="number">7.</span>#<span class="number">25</span>         <span class="comment">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V             </span></span><br><span class="line">   #<span class="number">2</span> = Class              #<span class="number">26</span>            <span class="comment">// java/lang/Short                           </span></span><br><span class="line">   #<span class="number">3</span> = Integer            <span class="number">32768</span>                                                       </span><br><span class="line">   #<span class="number">4</span> = Fieldref           #<span class="number">27.</span>#<span class="number">28</span>        <span class="comment">// java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">   #<span class="number">5</span> = Methodref          #<span class="number">29.</span>#<span class="number">30</span>        <span class="comment">// java/io/PrintStream.println:(I)V</span></span><br><span class="line">   #<span class="number">6</span> = Class              #<span class="number">31</span>            <span class="comment">// com/demo/Demo_20</span></span><br><span class="line">   #<span class="number">7</span> = Class              #<span class="number">32</span>            <span class="comment">// java/lang/Object</span></span><br><span class="line">   #<span class="number">8</span> = Utf8               &lt;init&gt;</span><br><span class="line">   #<span class="number">9</span> = Utf8               ()V</span><br><span class="line">  #<span class="number">10</span> = Utf8               Code</span><br><span class="line">  #<span class="number">11</span> = Utf8               LineNumberTable</span><br><span class="line">  #<span class="number">12</span> = Utf8               LocalVariableTable</span><br><span class="line">  #<span class="number">13</span> = Utf8               <span class="built_in">this</span></span><br><span class="line">  #<span class="number">14</span> = Utf8               Lcom/demo/Demo_20;</span><br><span class="line">  #<span class="number">15</span> = Utf8               main</span><br><span class="line">  #<span class="number">16</span> = Utf8               ([Ljava/lang/String;)V</span><br><span class="line">  #<span class="number">17</span> = Utf8               args</span><br><span class="line">  #<span class="number">18</span> = Utf8               [Ljava/lang/String;</span><br><span class="line">  #<span class="number">19</span> = Utf8               a</span><br><span class="line">  #<span class="number">20</span> = Utf8               I</span><br><span class="line">  #<span class="number">21</span> = Utf8               b</span><br><span class="line">  #<span class="number">22</span> = Utf8               c</span><br><span class="line">  #<span class="number">23</span> = Utf8               SourceFile</span><br><span class="line">  #<span class="number">24</span> = Utf8               Demo_20.java</span><br><span class="line">  #<span class="number">25</span> = NameAndType        #<span class="number">8</span>:#<span class="number">9</span>          <span class="comment">// &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">  #<span class="number">26</span> = Utf8               java/lang/Short</span><br><span class="line">  #<span class="number">27</span> = Class              #<span class="number">33</span>            <span class="comment">// java/lang/System</span></span><br><span class="line">  #<span class="number">28</span> = NameAndType        #<span class="number">34</span>:#<span class="number">35</span>        <span class="comment">// out:Ljava/io/PrintStream;</span></span><br><span class="line">  #<span class="number">29</span> = Class              #<span class="number">36</span>            <span class="comment">// java/io/PrintStream</span></span><br><span class="line">  #<span class="number">30</span> = NameAndType        #<span class="number">37</span>:#<span class="number">38</span>        <span class="comment">// println:(I)V</span></span><br><span class="line">  #<span class="number">31</span> = Utf8               com/demo/Demo_20</span><br><span class="line">  #<span class="number">32</span> = Utf8               java/lang/Object</span><br><span class="line">  #<span class="number">33</span> = Utf8               java/lang/System</span><br><span class="line">  #<span class="number">34</span> = Utf8               out</span><br><span class="line">  #<span class="number">35</span> = Utf8               Ljava/io/PrintStream;</span><br><span class="line">  #<span class="number">36</span> = Utf8               java/io/PrintStream</span><br><span class="line">  #<span class="number">37</span> = Utf8               println</span><br><span class="line">  #<span class="number">38</span> = Utf8               (I)V</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> com.demo.Demo_20();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="number">1</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">6</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="built_in">this</span>   Lcom/demo/Demo_20;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(java.lang.String[])</span>;</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">4</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: bipush        <span class="number">10</span></span><br><span class="line">         <span class="number">2</span>: istore_1</span><br><span class="line">         <span class="number">3</span>: ldc           #<span class="number">3</span>                  <span class="comment">// int 32768</span></span><br><span class="line">         <span class="number">5</span>: istore_2</span><br><span class="line">         <span class="number">6</span>: iload_1</span><br><span class="line">         <span class="number">7</span>: iload_2</span><br><span class="line">         <span class="number">8</span>: iadd</span><br><span class="line">         <span class="number">9</span>: istore_3</span><br><span class="line">        <span class="number">10</span>: getstatic     #<span class="number">4</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">        <span class="number">13</span>: iload_3</span><br><span class="line">        <span class="number">14</span>: invokevirtual #<span class="number">5</span>                  <span class="comment">// Method java/io/PrintStream.println:(I)V</span></span><br><span class="line">        <span class="number">17</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">8</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">9</span>: <span class="number">3</span></span><br><span class="line">        line <span class="number">10</span>: <span class="number">6</span></span><br><span class="line">        line <span class="number">11</span>: <span class="number">10</span></span><br><span class="line">        line <span class="number">12</span>: <span class="number">17</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>      <span class="number">18</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">            <span class="number">3</span>      <span class="number">15</span>     <span class="number">1</span>     a   I</span><br><span class="line">            <span class="number">6</span>      <span class="number">12</span>     <span class="number">2</span>     b   I</span><br><span class="line">           <span class="number">10</span>       <span class="number">8</span>     <span class="number">3</span>     c   I</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: <span class="string">&quot;Demo_20.java&quot;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>å¸¸é‡æ± è½½å…¥è¿è¡Œæ—¶å¸¸é‡æ± </li></ol><p><img src="/../assets/JVM/image-20231010162136501.png" alt="image-20231010162136501"></p><ol start="4"><li>æ–¹æ³•å­—èŠ‚ç è½½å…¥æ–¹æ³•åŒº</li></ol><p><img src="/../assets/JVM/image-20231010162213690.png" alt="image-20231010162213690"></p><ol start="5"><li>main çº¿ç¨‹å¼€å§‹è¿è¡Œï¼Œåˆ†é…æ ˆå¸§å†…å­˜</li></ol><p>ï¼ˆstack&#x3D;2ï¼Œlocals&#x3D;4ï¼‰ï¼šæ“ä½œæ•°æ ˆæ·±åº¦ä¸º2ï¼Œå±€éƒ¨å˜é‡è¡¨æ•°é‡ä¸º4</p><p><img src="/../assets/JVM/image-20231010162352755.png" alt="image-20231010162352755"></p><ol start="6"><li>æ‰§è¡Œå¼•æ“å¼€å§‹æ‰§è¡Œå­—èŠ‚ç </li></ol><ul><li>bipush 10<ul><li>å°†ä¸€ä¸ª byte å‹å…¥æ“ä½œæ•°æ ˆï¼ˆå…¶é•¿åº¦ä¼šè¡¥é½ 4 ä¸ªå­—èŠ‚ï¼‰ï¼Œç±»ä¼¼çš„æŒ‡ä»¤è¿˜æœ‰ </li><li>sipush å°†ä¸€ä¸ª short å‹å…¥æ“ä½œæ•°æ ˆï¼ˆå…¶é•¿åº¦ä¼šè¡¥é½ 4 ä¸ªå­—èŠ‚ï¼‰</li><li>ldc å°†ä¸€ä¸ª int å‹å…¥æ“ä½œæ•°æ ˆ</li><li>ldc2_w å°†ä¸€ä¸ª long å‹å…¥æ“ä½œæ•°æ ˆï¼ˆåˆ†ä¸¤æ¬¡å‹å…¥ï¼Œå› ä¸º long æ˜¯ 8 ä¸ªå­—èŠ‚ï¼‰</li><li><strong>è¿™é‡Œå°çš„æ•°å­—éƒ½æ˜¯å’Œå­—èŠ‚ç æŒ‡ä»¤å­˜åœ¨ä¸€èµ·ï¼Œè¶…è¿‡ short èŒƒå›´çš„æ•°å­—å­˜å…¥äº†å¸¸é‡æ± </strong></li></ul></li></ul><p><img src="/../assets/JVM/image-20231010163015751.png" alt="image-20231010163015751"></p><ul><li>istore_1<ul><li>å°†æ“ä½œæ•°æ ˆé¡¶æ•°æ®å¼¹å‡ºï¼Œå­˜å…¥å±€éƒ¨å˜é‡è¡¨çš„ slot 1</li></ul></li></ul><p><img src="/../assets/JVM/image-20231010163105787.png" alt="image-20231010163105787"></p><ul><li>ldc #3<ul><li>ä»å¸¸é‡æ± åŠ è½½ #3 æ•°æ®åˆ°æ“ä½œæ•°æ ˆ</li><li>æ³¨æ„ Short.MAX_VALUE æ˜¯ 32767ï¼Œæ‰€ä»¥ 32768 &#x3D; Short.MAX_VALUE + 1 å®é™…æ˜¯åœ¨ç¼–è¯‘æœŸé—´è®¡ç®—<br>å¥½çš„</li></ul></li></ul><p><img src="/../assets/JVM/image-20231010163201925.png" alt="image-20231010163201925"></p><ul><li>istore_2</li></ul><p><img src="/../assets/JVM/image-20231010163243864.png" alt="image-20231010163243864"></p><ul><li>iload_1</li></ul><p><img src="/../assets/JVM/image-20231010163355144.png" alt="image-20231010163355144"></p><ul><li>iload_2</li></ul><p><img src="/../assets/JVM/image-20231010163433368.png" alt="image-20231010163433368"></p><ul><li>iadd</li></ul><p><img src="/../assets/JVM/image-20231010163623499.png" alt="image-20231010163623499"></p><ul><li>istore_3</li></ul><p><img src="/../assets/JVM/image-20231010164657704.png" alt="image-20231010164657704"></p><ul><li>getstatic #4</li></ul><p><img src="/../assets/JVM/image-20231010165829176.png" alt="image-20231010165829176"></p><p><img src="/../assets/JVM/image-20231010165852971.png" alt="image-20231010165852971"></p><ul><li>iload_3</li></ul><p><img src="/../assets/JVM/image-20231010170007711.png" alt="image-20231010170007711"></p><ul><li>invokevirtual #5<ul><li>æ‰¾åˆ°å¸¸é‡æ±  #5 é¡¹</li><li>å®šä½åˆ°æ–¹æ³•åŒº   java&#x2F;io&#x2F;PrintStream.println:(I)V æ–¹æ³• </li><li>ç”Ÿæˆæ–°çš„æ ˆå¸§ï¼ˆåˆ†é… localsã€stackç­‰ï¼‰</li><li>ä¼ é€’å‚æ•°ï¼Œæ‰§è¡Œæ–°æ ˆå¸§ä¸­çš„å­—èŠ‚ç </li></ul></li></ul><p><img src="/../assets/JVM/image-20231010170131429.png" alt="image-20231010170131429"></p><ul><li><p>æ‰§è¡Œå®Œæ¯•ï¼Œå¼¹å‡ºæ ˆå¸§ </p></li><li><p>æ¸…é™¤ main æ“ä½œæ•°æ ˆå†…å®¹</p></li></ul><p><img src="/../assets/JVM/image-20231010170243175.png" alt="image-20231010170243175"></p><ul><li>return<ul><li>å®Œæˆ main æ–¹æ³•è°ƒç”¨ï¼Œå¼¹å‡º main æ ˆå¸§ </li><li>ç¨‹åºç»“æŸ</li></ul></li></ul><h3 id="ä¾‹å­ï¼šä»å­—èŠ‚ç è§’åº¦åˆ†æ-a"><a href="#ä¾‹å­ï¼šä»å­—èŠ‚ç è§’åº¦åˆ†æ-a" class="headerlink" title="ä¾‹å­ï¼šä»å­—èŠ‚ç è§’åº¦åˆ†æ a++"></a>ä¾‹å­ï¼šä»å­—èŠ‚ç è§’åº¦åˆ†æ a++</h3><ul><li>æºç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo3_2</span> &#123;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">Â  Â  Â  Â <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">Â  Â  Â  Â <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> a++ + ++a + a--; </span><br><span class="line">Â  Â  Â  Â System.out.println(a); <span class="comment">//11</span></span><br><span class="line">Â  Â  Â  Â System.out.println(b); <span class="comment">//34</span></span><br><span class="line">Â &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å­—èŠ‚ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">$ javap -v Demo_21.<span class="keyword">class</span></span><br><span class="line"><span class="title class_">Classfile</span> /D:/Workspace/JVM/demo/target/classes/com/demo/Demo_21.<span class="keyword">class</span></span><br><span class="line">  <span class="title class_">Last</span> modified <span class="number">2023</span>-<span class="number">4</span>-<span class="number">7</span>; size <span class="number">576</span> bytes</span><br><span class="line">  MD5 checksum 5bc962752b10ca4b57350ca9814ec5b0</span><br><span class="line">  Compiled from <span class="string">&quot;Demo_21.java&quot;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">com</span>.demo.Demo_21</span><br><span class="line">  minor version: <span class="number">0</span></span><br><span class="line">  major version: <span class="number">52</span></span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">Constant pool:</span><br><span class="line">   #<span class="number">1</span> = Methodref          #<span class="number">5.</span>#<span class="number">22</span>         <span class="comment">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">   #<span class="number">2</span> = Fieldref           #<span class="number">23.</span>#<span class="number">24</span>        <span class="comment">// java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">   #<span class="number">3</span> = Methodref          #<span class="number">25.</span>#<span class="number">26</span>        <span class="comment">// java/io/PrintStream.println:(I)V</span></span><br><span class="line">   #<span class="number">4</span> = Class              #<span class="number">27</span>            <span class="comment">// com/demo/Demo_21</span></span><br><span class="line">   #<span class="number">5</span> = Class              #<span class="number">28</span>            <span class="comment">// java/lang/Object</span></span><br><span class="line">   #<span class="number">6</span> = Utf8               &lt;init&gt;</span><br><span class="line">   #<span class="number">7</span> = Utf8               ()V</span><br><span class="line">   #<span class="number">8</span> = Utf8               Code</span><br><span class="line">   #<span class="number">9</span> = Utf8               LineNumberTable</span><br><span class="line">  #<span class="number">10</span> = Utf8               LocalVariableTable</span><br><span class="line">  #<span class="number">11</span> = Utf8               <span class="built_in">this</span></span><br><span class="line">  #<span class="number">12</span> = Utf8               Lcom/demo/Demo_21;</span><br><span class="line">  #<span class="number">13</span> = Utf8               main</span><br><span class="line">  #<span class="number">14</span> = Utf8               ([Ljava/lang/String;)V</span><br><span class="line">  #<span class="number">15</span> = Utf8               args</span><br><span class="line">  #<span class="number">16</span> = Utf8               [Ljava/lang/String;</span><br><span class="line">  #<span class="number">17</span> = Utf8               a</span><br><span class="line">  #<span class="number">18</span> = Utf8               I</span><br><span class="line">  #<span class="number">19</span> = Utf8               b</span><br><span class="line">  #<span class="number">20</span> = Utf8               SourceFile</span><br><span class="line">  #<span class="number">21</span> = Utf8               Demo_21.java</span><br><span class="line">  #<span class="number">22</span> = NameAndType        #<span class="number">6</span>:#<span class="number">7</span>          <span class="comment">// &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">  #<span class="number">23</span> = Class              #<span class="number">29</span>            <span class="comment">// java/lang/System</span></span><br><span class="line">  #<span class="number">24</span> = NameAndType        #<span class="number">30</span>:#<span class="number">31</span>        <span class="comment">// out:Ljava/io/PrintStream;</span></span><br><span class="line">  #<span class="number">25</span> = Class              #<span class="number">32</span>            <span class="comment">// java/io/PrintStream</span></span><br><span class="line">  #<span class="number">26</span> = NameAndType        #<span class="number">33</span>:#<span class="number">34</span>        <span class="comment">// println:(I)V</span></span><br><span class="line">  #<span class="number">27</span> = Utf8               com/demo/Demo_21</span><br><span class="line">  #<span class="number">28</span> = Utf8               java/lang/Object</span><br><span class="line">  #<span class="number">29</span> = Utf8               java/lang/System</span><br><span class="line">  #<span class="number">30</span> = Utf8               out</span><br><span class="line">  #<span class="number">31</span> = Utf8               Ljava/io/PrintStream;</span><br><span class="line">  #<span class="number">32</span> = Utf8               java/io/PrintStream</span><br><span class="line">  #<span class="number">33</span> = Utf8               println</span><br><span class="line">  #<span class="number">34</span> = Utf8               (I)V</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> com.demo.Demo_21();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="number">1</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">3</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="built_in">this</span>   Lcom/demo/Demo_21;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(java.lang.String[])</span>;</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">3</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: bipush        <span class="number">10</span></span><br><span class="line">         <span class="number">2</span>: istore_1</span><br><span class="line">         <span class="number">3</span>: iload_1</span><br><span class="line">         <span class="number">4</span>: iinc          <span class="number">1</span>, <span class="number">1</span></span><br><span class="line">         <span class="number">7</span>: iinc          <span class="number">1</span>, <span class="number">1</span></span><br><span class="line">        <span class="number">10</span>: iload_1</span><br><span class="line">        <span class="number">11</span>: iadd</span><br><span class="line">        <span class="number">12</span>: iload_1</span><br><span class="line">        <span class="number">13</span>: iinc          <span class="number">1</span>, -<span class="number">1</span></span><br><span class="line">        <span class="number">16</span>: iadd</span><br><span class="line">        <span class="number">17</span>: istore_2</span><br><span class="line">        <span class="number">18</span>: getstatic     #<span class="number">2</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">        <span class="number">21</span>: iload_1</span><br><span class="line">        <span class="number">22</span>: invokevirtual #<span class="number">3</span>                  <span class="comment">// Method java/io/PrintStream.println:(I)V</span></span><br><span class="line">        <span class="number">25</span>: getstatic     #<span class="number">2</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">        <span class="number">28</span>: iload_2</span><br><span class="line">        <span class="number">29</span>: invokevirtual #<span class="number">3</span>                  <span class="comment">// Method java/io/PrintStream.println:(I)V</span></span><br><span class="line">        <span class="number">32</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">5</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">6</span>: <span class="number">3</span></span><br><span class="line">        line <span class="number">7</span>: <span class="number">18</span></span><br><span class="line">        line <span class="number">8</span>: <span class="number">25</span></span><br><span class="line">        line <span class="number">9</span>: <span class="number">32</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>      <span class="number">33</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">            <span class="number">3</span>      <span class="number">30</span>     <span class="number">1</span>     a   I</span><br><span class="line">           <span class="number">18</span>      <span class="number">15</span>     <span class="number">2</span>     b   I</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: <span class="string">&quot;Demo_21.java&quot;</span></span><br></pre></td></tr></table></figure><ul><li>åˆ†æâ­â­â­ï¼š<ul><li>æ³¨æ„ iinc æŒ‡ä»¤æ˜¯ç›´æ¥åœ¨å±€éƒ¨å˜é‡ slot ä¸Šè¿›è¡Œè¿ç®— </li><li>a++ å’Œ ++a çš„åŒºåˆ«æ˜¯å…ˆæ‰§è¡Œ iload è¿˜æ˜¯ å…ˆæ‰§è¡Œ iinc</li></ul></li></ul><h3 id="æ¡ä»¶åˆ¤æ–­æŒ‡ä»¤"><a href="#æ¡ä»¶åˆ¤æ–­æŒ‡ä»¤" class="headerlink" title="æ¡ä»¶åˆ¤æ–­æŒ‡ä»¤"></a>æ¡ä»¶åˆ¤æ–­æŒ‡ä»¤</h3><table><thead><tr><th align="center">æŒ‡ä»¤</th><th align="center">åŠ©è®°ç¬¦</th><th align="center">å«ä¹‰</th></tr></thead><tbody><tr><td align="center">0x99</td><td align="center">ifeq</td><td align="center">åˆ¤æ–­æ˜¯å¦ &#x3D;&#x3D; 0</td></tr><tr><td align="center">0x9a</td><td align="center">ifne</td><td align="center">åˆ¤æ–­æ˜¯å¦ !&#x3D; 0</td></tr><tr><td align="center">0x9b</td><td align="center">iflt</td><td align="center">åˆ¤æ–­æ˜¯å¦ &lt; 0</td></tr><tr><td align="center">0x9c</td><td align="center">ifge</td><td align="center">åˆ¤æ–­æ˜¯å¦ &gt;&#x3D; 0</td></tr><tr><td align="center">0x9d</td><td align="center">ifgt</td><td align="center">åˆ¤æ–­æ˜¯å¦ &gt; 0</td></tr><tr><td align="center">0x9e</td><td align="center">ifle</td><td align="center">åˆ¤æ–­æ˜¯å¦ &lt;&#x3D; 0</td></tr><tr><td align="center">0x9f</td><td align="center">if_icmpeq</td><td align="center">ä¸¤ä¸ªintæ˜¯å¦ &#x3D;&#x3D;</td></tr><tr><td align="center">0xa0</td><td align="center">if_icmpne</td><td align="center">ä¸¤ä¸ªintæ˜¯å¦ !&#x3D;</td></tr><tr><td align="center">0xa1</td><td align="center">if_icmplt</td><td align="center">ä¸¤ä¸ªintæ˜¯å¦ &lt;</td></tr><tr><td align="center">0xa2</td><td align="center">if_icmpge</td><td align="center">ä¸¤ä¸ªintæ˜¯å¦ &gt;&#x3D;</td></tr><tr><td align="center">0xa3</td><td align="center">if_icmpgt</td><td align="center">ä¸¤ä¸ªintæ˜¯å¦ &gt;</td></tr><tr><td align="center">0xa4</td><td align="center">if_icmple</td><td align="center">ä¸¤ä¸ªintæ˜¯å¦ &lt;&#x3D;</td></tr><tr><td align="center">0xa5</td><td align="center">if_acmpeq</td><td align="center">ä¸¤ä¸ªå¼•ç”¨æ˜¯å¦ &#x3D;&#x3D;</td></tr><tr><td align="center">0xa6</td><td align="center">if_acmpne</td><td align="center">ä¸¤ä¸ªå¼•ç”¨æ˜¯å¦ !&#x3D;</td></tr><tr><td align="center">0xc6</td><td align="center">ifnull</td><td align="center">åˆ¤æ–­æ˜¯å¦ &#x3D;&#x3D; null</td></tr><tr><td align="center">0xc7</td><td align="center">ifnonnull</td><td align="center">åˆ¤æ–­æ˜¯å¦ !&#x3D; null</td></tr></tbody></table><ul><li>åŸå§‹Javaä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo3_3</span> &#123;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">Â  Â  Â  Â <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">Â  Â  Â  Â <span class="keyword">if</span>(a == <span class="number">0</span>) &#123; </span><br><span class="line">Â  Â  Â  Â  Â  Â a = <span class="number">10</span>; </span><br><span class="line">Â  Â  Â  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â a = <span class="number">20</span>; </span><br><span class="line">Â Â Â   &#125;</span><br><span class="line">Â &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å­—èŠ‚ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: iconst_0</span><br><span class="line"><span class="number">1</span>: istore_1</span><br><span class="line"><span class="number">2</span>: iload_1 Â  Â  Â </span><br><span class="line"><span class="number">3</span>: ifne Â  Â  Â  Â   <span class="number">12</span> </span><br><span class="line"><span class="number">6</span>: bipush Â  Â  Â   <span class="number">10</span> </span><br><span class="line"><span class="number">8</span>: istore_1</span><br><span class="line"><span class="number">9</span>: goto Â  Â  Â  Â  <span class="number">15</span> </span><br><span class="line"><span class="number">12</span>: bipush Â  Â  Â  <span class="number">20</span> </span><br><span class="line"><span class="number">14</span>: istore_1</span><br><span class="line"><span class="number">15</span>: <span class="keyword">return</span></span><br></pre></td></tr></table></figure><h3 id="å¾ªç¯æ§åˆ¶æŒ‡ä»¤"><a href="#å¾ªç¯æ§åˆ¶æŒ‡ä»¤" class="headerlink" title="å¾ªç¯æ§åˆ¶æŒ‡ä»¤"></a>å¾ªç¯æ§åˆ¶æŒ‡ä»¤</h3><ul><li>æºä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo_23</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (a &lt; <span class="number">10</span>) &#123;</span><br><span class="line">            a++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å­—èŠ‚ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">0</span>: iconst_0                <span class="comment">// å°†æ•´æ•°å¸¸é‡å€¼0ï¼ˆintç±»å‹ï¼‰å‹å…¥æ“ä½œæ•°æ ˆä¸­ã€‚</span></span><br><span class="line"> <span class="number">1</span>: istore_1                <span class="comment">// å°†æ ˆé¡¶æ•°æ®å­˜å…¥å±€éƒ¨å˜é‡è¡¨ slot 1</span></span><br><span class="line"> <span class="number">2</span>: iload_1                 <span class="comment">// å°†å±€éƒ¨å˜é‡è¡¨slot 1çš„å€¼å‹å…¥æ“ä½œæ•°æ ˆ</span></span><br><span class="line"> <span class="number">3</span>: bipush        <span class="number">10</span>        <span class="comment">// å°†10å‹å…¥æ“ä½œæ•°æ ˆ</span></span><br><span class="line"> <span class="number">5</span>: if_icmpge     <span class="number">14</span>        <span class="comment">// åˆ¤æ–­ i &gt;= 10 ï¼Œæˆç«‹åˆ™è·³è½¬åˆ°14è¡Œï¼Œä¸æˆç«‹åˆ™æ‰§è¡Œä¸‹ä¸€è¡Œ</span></span><br><span class="line"> <span class="number">8</span>: iinc          <span class="number">1</span>, <span class="number">1</span>      <span class="comment">// iè‡ªå¢</span></span><br><span class="line"><span class="number">11</span>: goto          <span class="number">2</span>         <span class="comment">// è·³è½¬åˆ°ç¬¬2è¡Œ</span></span><br><span class="line"><span class="number">14</span>: <span class="keyword">return</span></span><br></pre></td></tr></table></figure><h3 id="ç»ƒä¹ -åˆ¤æ–­ç»“æœ"><a href="#ç»ƒä¹ -åˆ¤æ–­ç»“æœ" class="headerlink" title="ç»ƒä¹ -åˆ¤æ–­ç»“æœ"></a>ç»ƒä¹ -åˆ¤æ–­ç»“æœ</h3><ul><li>æºä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo_26</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; <span class="number">10</span>) &#123;</span><br><span class="line">            x = x++;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æœ€ç»ˆxçš„ç»“æœæ˜¯0<ul><li>æ‰§è¡Œ<code>x++</code>æ—¶ï¼Œå…ˆæ‰§è¡Œ<code>iload_x</code>ï¼Œå°†0åŠ è½½åˆ°æ“ä½œæ•°æ ˆä¸­</li><li>ç„¶åæ‰§è¡Œiincï¼Œå°†å±€éƒ¨å˜é‡è¡¨ä¸­çš„xè‡ªå¢ï¼Œæ­¤æ—¶å±€éƒ¨å˜é‡è¡¨ä¸­çš„<code>x = 1</code></li><li>æ­¤æ—¶åˆæ‰§è¡Œäº†ä¸€ä¸ªèµ‹å€¼æ“ä½œï¼Œ<code>istore_x</code>ï¼Œå°†æ“ä½œæ•°æ ˆä¸­çš„0ï¼Œé‡æ–°èµ‹ç»™äº†å±€éƒ¨å˜é‡è¡¨ä¸­çš„xï¼Œå¯¼è‡´xä¸º0</li></ul></li></ul><h3 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h3><h4 id="V"><a href="#V" class="headerlink" title="&lt;cinit&gt;()V"></a><code>&lt;cinit&gt;()V</code></h4><ul><li>æºä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo_27</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        i = <span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        i = <span class="number">30</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å­—èŠ‚ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">0</span>: bipush        <span class="number">10</span></span><br><span class="line"> <span class="number">2</span>: putstatic     #<span class="number">2</span>                  <span class="comment">// Field i:I</span></span><br><span class="line"> <span class="number">5</span>: bipush        <span class="number">20</span></span><br><span class="line"> <span class="number">7</span>: putstatic     #<span class="number">2</span>                  <span class="comment">// Field i:I</span></span><br><span class="line"><span class="number">10</span>: bipush        <span class="number">30</span></span><br><span class="line"><span class="number">12</span>: putstatic     #<span class="number">2</span>                  <span class="comment">// Field i:I</span></span><br><span class="line"><span class="number">15</span>: <span class="keyword">return</span></span><br></pre></td></tr></table></figure><ul><li>ç¼–è¯‘å™¨ä¼šæŒ‰ç…§ä»ä¸Šè‡³ä¸‹çš„é¡ºåºï¼Œæ”¶é›†æ‰€æœ‰çš„staticé™æ€ä»£ç å—å’Œé™æ€æˆå‘˜èµ‹å€¼çš„ä»£ç ï¼Œåˆå¹¶æˆä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³•<code>&lt;cinit&gt;()V</code></li><li><code>&lt;cinit&gt;()V</code>æ–¹æ³•ä¼šåœ¨ç±»åŠ è½½çš„åˆå§‹åŒ–é˜¶æ®µè¢«è°ƒç”¨</li></ul><h4 id="V-1"><a href="#V-1" class="headerlink" title=" &lt;init&gt;()V"></a><code> &lt;init&gt;()V</code></h4><ul><li>æºä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo_28</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> <span class="string">&quot;s1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        b = <span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        a = <span class="string">&quot;s2&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Demo_28</span><span class="params">(String a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.a = a;</span><br><span class="line">        <span class="built_in">this</span>.b = b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Demo_28</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo_28</span>(<span class="string">&quot;s3&quot;</span>, <span class="number">30</span>);</span><br><span class="line">        System.out.println(demo.a);</span><br><span class="line">        System.out.println(demo.b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å­—èŠ‚ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">0</span>: aload_0</span><br><span class="line"> <span class="number">1</span>: invokespecial #<span class="number">1</span>      <span class="comment">// super.&lt;init&gt;()V</span></span><br><span class="line"> <span class="number">4</span>: aload_0</span><br><span class="line"> <span class="number">5</span>: ldc #<span class="number">2</span>                <span class="comment">// &lt;- &quot;s1&quot;</span></span><br><span class="line"> <span class="number">7</span>: putfield #<span class="number">3</span>           <span class="comment">// -&gt; this.a</span></span><br><span class="line"><span class="number">10</span>: aload_0</span><br><span class="line"><span class="number">11</span>: bipush <span class="number">20</span>             <span class="comment">// &lt;- 20</span></span><br><span class="line"><span class="number">13</span>: putfield #<span class="number">4</span>           <span class="comment">// -&gt; this.b</span></span><br><span class="line"><span class="number">16</span>: aload_0</span><br><span class="line"><span class="number">17</span>: bipush <span class="number">10</span>             <span class="comment">// &lt;- 10</span></span><br><span class="line"><span class="number">19</span>: putfield #<span class="number">4</span>           <span class="comment">// -&gt; this.b</span></span><br><span class="line"><span class="number">22</span>: aload_0</span><br><span class="line"><span class="number">23</span>: ldc #<span class="number">5</span>                <span class="comment">// &lt;- &quot;s2&quot;</span></span><br><span class="line"><span class="number">25</span>: putfield #<span class="number">3</span>           <span class="comment">// -&gt; this.a</span></span><br><span class="line"><span class="number">28</span>: aload_0               <span class="comment">// ------------------------------</span></span><br><span class="line"><span class="number">29</span>: aload_1               <span class="comment">// &lt;- slot 1(a) &quot;s3&quot;            |</span></span><br><span class="line"><span class="number">30</span>: putfield #<span class="number">3</span>           <span class="comment">// -&gt; this.a                    |</span></span><br><span class="line"><span class="number">33</span>: aload_0                                               |</span><br><span class="line"><span class="number">34</span>: iload_2               <span class="comment">// &lt;- slot 2(b) 30              |</span></span><br><span class="line"><span class="number">35</span>: putfield #<span class="number">4</span>           <span class="comment">// -&gt; this.b --------------------</span></span><br><span class="line"><span class="number">38</span>: <span class="keyword">return</span></span><br></pre></td></tr></table></figure><ul><li>ç¼–è¯‘å™¨ä¼šæŒ‰ç…§ä»ä¸Šè‡³ä¸‹çš„é¡ºåºï¼Œæ”¶é›†æ‰€æœ‰ä»£ç å—å’Œæ‰€æœ‰æˆå‘˜å˜é‡èµ‹å€¼çš„ä»£ç ï¼Œå½¢æˆæ–°çš„æ„é€ æ–¹æ³•ï¼Œä½†åŸå§‹æ„é€ æ–¹æ³•å†…çš„ä»£ç æ€»æ˜¯ä¼šåœ¨æœ€å</li></ul><h3 id="æ–¹æ³•è°ƒç”¨"><a href="#æ–¹æ³•è°ƒç”¨" class="headerlink" title="æ–¹æ³•è°ƒç”¨"></a>æ–¹æ³•è°ƒç”¨</h3><ul><li>æºä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo_29</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Demo_29</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Demo_29</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo_29</span>();</span><br><span class="line">        demo.test1();</span><br><span class="line">        demo.test2();</span><br><span class="line">        demo.test3();</span><br><span class="line">        demo.test4();</span><br><span class="line">        Demo_29.test4();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å­—èŠ‚ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">0</span>: <span class="keyword">new</span>           #<span class="number">2</span>                  <span class="comment">// class com/demo/Demo_29</span></span><br><span class="line"> <span class="number">3</span>: dup</span><br><span class="line"> <span class="number">4</span>: invokespecial #<span class="number">3</span>                  <span class="comment">// Method &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line"> <span class="number">7</span>: astore_1</span><br><span class="line"> <span class="number">8</span>: aload_1</span><br><span class="line"> <span class="number">9</span>: invokespecial #<span class="number">4</span>                  <span class="comment">// Method test1:()V</span></span><br><span class="line"><span class="number">12</span>: aload_1</span><br><span class="line"><span class="number">13</span>: invokespecial #<span class="number">5</span>                  <span class="comment">// Method test2:()V</span></span><br><span class="line"><span class="number">16</span>: aload_1</span><br><span class="line"><span class="number">17</span>: invokevirtual #<span class="number">6</span>                  <span class="comment">// Method test3:()V</span></span><br><span class="line"><span class="number">20</span>: aload_1</span><br><span class="line"><span class="number">21</span>: pop</span><br><span class="line"><span class="number">22</span>: invokestatic  #<span class="number">7</span>                  <span class="comment">// Method test4:()V</span></span><br><span class="line"><span class="number">25</span>: invokestatic  #<span class="number">7</span>                  <span class="comment">// Method test4:()V</span></span><br><span class="line"><span class="number">28</span>: <span class="keyword">return</span></span><br></pre></td></tr></table></figure><ul><li>new æ˜¯åˆ›å»ºã€å¯¹è±¡ã€‘ï¼Œç»™å¯¹è±¡åˆ†é…å †å†…å­˜ï¼Œæ‰§è¡ŒæˆåŠŸä¼šå°†ã€å¯¹è±¡å¼•ç”¨ã€‘å‹å…¥æ“ä½œæ•°æ ˆ</li><li>dup æ˜¯èµ‹å€¼æ“ä½œæ•°æ ˆæ ˆé¡¶çš„å†…å®¹ï¼Œæœ¬ä¾‹å³ä¸ºã€å¯¹è±¡å¼•ç”¨ã€‘ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä»½å¼•ç”¨å‘¢ï¼Œä¸€ä¸ªæ˜¯è¦é…<br>åˆ invokespecial è°ƒç”¨è¯¥å¯¹è±¡çš„æ„é€ æ–¹æ³•   â€œ<init>â€œ:()V ï¼ˆä¼šæ¶ˆè€—æ‰æ ˆé¡¶ä¸€ä¸ªå¼•ç”¨ï¼‰ï¼Œå¦ä¸€ä¸ªè¦é…åˆ astore_1 èµ‹å€¼ç»™å±€éƒ¨å˜é‡</li><li>æœ€ç»ˆæ–¹æ³•ï¼ˆï¬nalï¼‰ï¼Œç§æœ‰æ–¹æ³•ï¼ˆprivateï¼‰ï¼Œæ„é€ æ–¹æ³•éƒ½æ˜¯ç”± invokespecial æŒ‡ä»¤æ¥è°ƒç”¨ï¼Œå±äºé™<br>æ€ç»‘å®š</li><li>æ™®é€šæˆå‘˜æ–¹æ³•æ˜¯ç”± invokevirtual è°ƒç”¨ï¼Œå±äºåŠ¨æ€ç»‘å®šï¼Œå³æ”¯æŒå¤šæ€</li><li>æˆå‘˜æ–¹æ³•ä¸é™æ€æ–¹æ³•è°ƒç”¨çš„å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œæ‰§è¡Œæ–¹æ³•å‰æ˜¯å¦éœ€è¦ã€å¯¹è±¡å¼•ç”¨ã€‘</li><li>æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯   d.test4();æ˜¯é€šè¿‡ã€å¯¹è±¡å¼•ç”¨ã€‘è°ƒç”¨ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°åœ¨è°ƒç”¨invokestatic ä¹‹å‰æ‰§è¡Œäº† pop æŒ‡ä»¤ï¼ŒæŠŠã€å¯¹è±¡å¼•ç”¨ã€‘ä»æ“ä½œæ•°æ ˆå¼¹æ‰äº†</li></ul><blockquote><p>æ‰€ä»¥åœ¨è°ƒç”¨é™æ€æ–¹æ³•çš„æ—¶å€™å°±ä¸è¦ç”¨å¯¹è±¡å»è°ƒç”¨äº†ï¼Œå¦åˆ™ä¼šå¤šå‡ºæ¥20ï¼Œ21è¿™ä¸¤è¡Œçš„å¤šä½™çš„ä»£ç </p></blockquote><h3 id="å¤šæ€çš„åŸç†"><a href="#å¤šæ€çš„åŸç†" class="headerlink" title="å¤šæ€çš„åŸç†"></a>å¤šæ€çš„åŸç†</h3><p>å½“æ‰§è¡Œ invokevirtual æŒ‡ä»¤æ—¶ï¼Œ</p><ol><li><strong>é€šè¿‡æ ˆå¸§ä¸­çš„å¯¹è±¡å¼•ç”¨æ‰¾åˆ°å¯¹è±¡</strong>ï¼š<ul><li>åœ¨å¤šæ€æƒ…å†µä¸‹ï¼Œå¯¹è±¡å¼•ç”¨å¯ä»¥æŒ‡å‘å­ç±»å¯¹è±¡ï¼Œå³çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å®ä¾‹ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥é€šè¿‡çˆ¶ç±»å¼•ç”¨è°ƒç”¨å­ç±»å¯¹è±¡çš„æ–¹æ³•ã€‚</li></ul></li><li><strong>åˆ†æå¯¹è±¡å¤´ï¼Œæ‰¾åˆ°å¯¹è±¡çš„å®é™… Class</strong>ï¼š<ul><li>JVMéœ€è¦ç¡®å®šå®é™…å¯¹è±¡çš„ç±»å‹ï¼Œè¿™æ˜¯å¤šæ€çš„å…³é”®ã€‚é€šè¿‡å¯¹è±¡çš„å¤´éƒ¨ä¿¡æ¯ï¼ŒJVMå¯ä»¥ç¡®å®šå®ƒå±äºå“ªä¸ªç±»ã€‚</li></ul></li><li><strong>Class ç»“æ„ä¸­æœ‰ vtableï¼Œå®ƒåœ¨ç±»åŠ è½½çš„é“¾æ¥é˜¶æ®µå°±å·²ç»æ ¹æ®æ–¹æ³•çš„é‡å†™è§„åˆ™ç”Ÿæˆå¥½äº†</strong>ï¼š<ul><li>vtableï¼ˆè™šæ–¹æ³•è¡¨ï¼‰æ˜¯æ¯ä¸ªç±»çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒåŒ…å«äº†è¯¥ç±»åŠå…¶çˆ¶ç±»ä¸­çš„è™šæ‹Ÿæ–¹æ³•çš„å¼•ç”¨ã€‚åœ¨ç±»åŠ è½½çš„é“¾æ¥é˜¶æ®µï¼ŒJVMä¼šæ„å»ºvtableï¼Œç¡®ä¿æ­£ç¡®çš„æ–¹æ³•å¼•ç”¨ä¸ç±»çš„å±‚æ¬¡ç»“æ„ä¸€è‡´ã€‚</li></ul></li><li><strong>æŸ¥è¡¨å¾—åˆ°æ–¹æ³•çš„å…·ä½“åœ°å€</strong>ï¼š<ul><li>å½“ä½ è°ƒç”¨ä¸€ä¸ªè™šæ‹Ÿæ–¹æ³•æ—¶ï¼ŒJVMä¼šæ ¹æ®å¯¹è±¡çš„å®é™…ç±»å‹ï¼ŒæŸ¥æ‰¾ä¸æ–¹æ³•ååŒ¹é…çš„è™šæ–¹æ³•è¡¨ä¸­çš„æ–¹æ³•å¼•ç”¨ã€‚è¿™ç¡®ä¿äº†è°ƒç”¨çš„æ˜¯å®é™…å¯¹è±¡çš„ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯å¼•ç”¨ç±»å‹çš„ç‰ˆæœ¬ã€‚</li></ul></li><li><strong>æ‰§è¡Œæ–¹æ³•çš„å­—èŠ‚ç </strong>ï¼š<ul><li>ä¸€æ—¦æ‰¾åˆ°äº†æ­£ç¡®çš„æ–¹æ³•å¼•ç”¨ï¼ŒJVMå°†æ‰§è¡Œè¯¥æ–¹æ³•çš„å­—èŠ‚ç ã€‚è¿™æ˜¯å¤šæ€çš„æœ€ç»ˆä½“ç°ï¼Œå› ä¸ºä¸åŒå¯¹è±¡çš„ä¸åŒå®ç°å°†æ ¹æ®å…¶å®é™…ç±»å‹è€Œæ‰§è¡Œä¸åŒçš„è¡Œä¸ºã€‚</li></ul></li></ol><h3 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h3><h4 id="try-catch"><a href="#try-catch" class="headerlink" title="try-catch"></a>try-catch</h4><ul><li>æºä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo3_11_1</span> &#123;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">Â  Â  Â  Â <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">Â  Â  Â  Â <span class="keyword">try</span> &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â i = <span class="number">10</span>;</span><br><span class="line">Â  Â  Â   &#125; <span class="keyword">catch</span> (Exception e) &#123; </span><br><span class="line">Â  Â  Â  Â  Â  Â i = <span class="number">20</span>;</span><br><span class="line">Â Â Â   &#125; </span><br><span class="line">Â &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>éƒ¨åˆ†å…³é”®å­—èŠ‚ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(java.lang.String[])</span>; </span><br><span class="line">Â  Â descriptor: ([Ljava/lang/String;)V</span><br><span class="line">Â  Â flags: ACC_PUBLIC, ACC_STATIC </span><br><span class="line">Â  Â Code:</span><br><span class="line">Â  Â  Â stack=<span class="number">1</span>, locals=<span class="number">3</span>, args_size=<span class="number">1</span> </span><br><span class="line">Â  Â  Â  Â  <span class="number">0</span>: iconst_0</span><br><span class="line">Â  Â  Â  Â  <span class="number">1</span>: istore_1</span><br><span class="line">Â  Â  Â  Â  <span class="number">2</span>: bipush Â  Â  Â  Â <span class="number">10</span> </span><br><span class="line">Â  Â  Â  Â  <span class="number">4</span>: istore_1</span><br><span class="line">Â  Â  Â  Â  <span class="number">5</span>: goto Â  Â  Â  Â  Â <span class="number">12</span> </span><br><span class="line">Â  Â  Â  Â  <span class="number">8</span>: astore_2</span><br><span class="line">Â  Â  Â  Â  <span class="number">9</span>: bipush Â  Â  Â  Â <span class="number">20</span> </span><br><span class="line">Â  Â  Â  Â <span class="number">11</span>: istore_1</span><br><span class="line">Â  Â  Â  Â <span class="number">12</span>: <span class="keyword">return</span></span><br><span class="line">Â  Â  Â Exception table:</span><br><span class="line">Â  Â  Â  Â  from Â  Â to Â target type</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="number">2</span> Â  Â  <span class="number">5</span> Â  Â  <span class="number">8</span> Â  Class java/lang/Exception </span><br><span class="line">Â  Â  Â LineNumberTable: ... Â  Â  Â  Â </span><br><span class="line">Â  Â  Â LocalVariableTable:</span><br><span class="line">Â  Â  Â  Â Start Â Length Â Slot Â Name Â  Signature</span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="number">9</span> Â  Â  Â  <span class="number">3</span> Â  Â  <span class="number">2</span> Â  Â  e Â  Ljava/lang/Exception; </span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="number">0</span> Â  Â  Â <span class="number">13</span> Â  Â  <span class="number">0</span> Â args Â  [Ljava/lang/String; </span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="number">2</span> Â  Â  Â <span class="number">11</span> Â  Â  <span class="number">1</span> Â  Â  i Â  I</span><br><span class="line">Â  Â  Â StackMapTable: ... </span><br><span class="line">Â  Â MethodParameters: ... </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯ä»¥çœ‹åˆ°å¤šå‡ºæ¥ä¸€ä¸ª Exception table çš„ç»“æ„ï¼Œ[from, to) æ˜¯å‰é—­åå¼€çš„æ£€æµ‹èŒƒå›´ï¼Œä¸€æ—¦è¿™ä¸ªèŒƒå›´<br>å†…çš„å­—èŠ‚ç æ‰§è¡Œå‡ºç°å¼‚å¸¸ï¼Œåˆ™é€šè¿‡ type åŒ¹é…å¼‚å¸¸ç±»å‹ï¼Œå¦‚æœä¸€è‡´ï¼Œè¿›å…¥ target æ‰€æŒ‡ç¤ºè¡Œå· </li><li>8 è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ astore_2 æ˜¯å°†å¼‚å¸¸å¯¹è±¡å¼•ç”¨å­˜å…¥å±€éƒ¨å˜é‡è¡¨çš„ slot 2 ä½ç½®</li></ul><h4 id="å¤šä¸ª-single-catch-å—çš„æƒ…å†µ"><a href="#å¤šä¸ª-single-catch-å—çš„æƒ…å†µ" class="headerlink" title="å¤šä¸ª single-catch å—çš„æƒ…å†µ"></a>å¤šä¸ª single-catch å—çš„æƒ…å†µ</h4><ul><li>æºä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo3_11_2</span> &#123;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">Â  Â  Â  Â <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">Â  Â  Â  Â <span class="keyword">try</span> &#123;Â </span><br><span class="line">å› ä¸ºå¼‚å¸¸å‡ºç°æ—¶ï¼Œåªèƒ½è¿›å…¥ Exception table ä¸­ä¸€ä¸ªåˆ†æ”¯ï¼Œæ‰€ä»¥å±€éƒ¨å˜é‡è¡¨ slot <span class="number">2</span> ä½ç½®è¢«å…±ç”¨</span><br><span class="line">multi-<span class="keyword">catch</span> çš„æƒ…å†µ</span><br><span class="line">Â  Â  Â  Â  Â  Â i = <span class="number">10</span>;</span><br><span class="line">Â  Â  Â   &#125; <span class="keyword">catch</span> (ArithmeticException e) &#123; </span><br><span class="line">Â  Â  Â  Â  Â  Â i = <span class="number">30</span>;</span><br><span class="line">Â  Â  Â   &#125; <span class="keyword">catch</span> (NullPointerException e) &#123; </span><br><span class="line">Â  Â  Â  Â  Â  Â i = <span class="number">40</span>;</span><br><span class="line">Â  Â  Â   &#125; <span class="keyword">catch</span> (Exception e) &#123; </span><br><span class="line">Â  Â  Â  Â  Â  Â i = <span class="number">50</span>;</span><br><span class="line">Â Â Â   &#125; </span><br><span class="line">Â &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>éƒ¨åˆ†å…³é”®å­—èŠ‚ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(java.lang.String[])</span>; </span><br><span class="line">Â  Â descriptor: ([Ljava/lang/String;)V</span><br><span class="line">Â  Â flags: ACC_PUBLIC, ACC_STATIC </span><br><span class="line">Â  Â Code:</span><br><span class="line">Â  Â  Â stack=<span class="number">1</span>, locals=<span class="number">3</span>, args_size=<span class="number">1</span> </span><br><span class="line">Â  Â  Â  Â  <span class="number">0</span>: iconst_0</span><br><span class="line">Â  Â  Â  Â  <span class="number">1</span>: istore_1</span><br><span class="line">Â  Â  Â  Â  <span class="number">2</span>: bipush Â  Â  Â  Â <span class="number">10</span> </span><br><span class="line">Â  Â  Â  Â  <span class="number">4</span>: istore_1</span><br><span class="line">Â  Â  Â  Â  <span class="number">5</span>: goto Â  Â  Â  Â  Â <span class="number">26</span> </span><br><span class="line">Â  Â  Â  Â  <span class="number">8</span>: astore_2</span><br><span class="line">Â  Â  Â  Â  <span class="number">9</span>: bipush Â  Â  Â  Â <span class="number">30</span> </span><br><span class="line">Â  Â  Â  Â <span class="number">11</span>: istore_1</span><br><span class="line">Â  Â  Â  Â <span class="number">12</span>: goto Â  Â  Â  Â  Â <span class="number">26</span> </span><br><span class="line">Â  Â  Â  Â <span class="number">15</span>: astore_2</span><br><span class="line">Â  Â  Â  Â <span class="number">16</span>: bipush Â  Â  Â  Â <span class="number">40</span> </span><br><span class="line">Â  Â  Â  Â <span class="number">18</span>: istore_1</span><br><span class="line">Â  Â  Â  Â <span class="number">19</span>: goto Â  Â  Â  Â  Â <span class="number">26</span> </span><br><span class="line">Â  Â  Â  Â <span class="number">22</span>: astore_2</span><br><span class="line">Â  Â  Â  Â <span class="number">23</span>: bipush Â  Â  Â  Â <span class="number">50</span> </span><br><span class="line">Â  Â  Â  Â <span class="number">25</span>: istore_1</span><br><span class="line">Â  Â  Â  Â <span class="number">26</span>: <span class="keyword">return</span></span><br><span class="line">Â  Â  Â Exception table:</span><br><span class="line">Â  Â  Â  Â  from Â  Â to Â target type</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="number">2</span> Â  Â  <span class="number">5</span> Â  Â  <span class="number">8</span> Â  Class java/lang/ArithmeticException </span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="number">2</span> Â  Â  <span class="number">5</span> Â  Â <span class="number">15</span> Â  Class java/lang/NullPointerException </span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="number">2</span> Â  Â  <span class="number">5</span> Â  Â <span class="number">22</span> Â  Class java/lang/Exception</span><br><span class="line">Â  Â  Â LineNumberTable: ... </span><br><span class="line">Â  Â  Â LocalVariableTable:</span><br><span class="line">Â  Â  Â  Â Start Â Length Â Slot Â Name Â  Signature</span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="number">9</span> Â  Â  Â  <span class="number">3</span> Â  Â  <span class="number">2</span> Â  Â  e Â  Ljava/lang/ArithmeticException; </span><br><span class="line">Â  Â  Â  Â  Â  <span class="number">16</span> Â  Â  Â  <span class="number">3</span> Â  Â  <span class="number">2</span> Â  Â  e Â  Ljava/lang/NullPointerException; </span><br><span class="line">Â  Â  Â  Â  Â  <span class="number">23</span> Â  Â  Â  <span class="number">3</span> Â  Â  <span class="number">2</span> Â  Â  e Â  Ljava/lang/Exception;</span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="number">0</span> Â  Â  Â <span class="number">27</span> Â  Â  <span class="number">0</span> Â args Â  [Ljava/lang/String; </span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="number">2</span> Â  Â  Â <span class="number">25</span> Â  Â  <span class="number">1</span> Â  Â  i Â  I</span><br><span class="line">Â  Â  Â StackMapTable: ... </span><br><span class="line">Â  Â MethodParameters: ...</span><br></pre></td></tr></table></figure><blockquote><p>å› ä¸ºå¼‚å¸¸å‡ºç°æ—¶ï¼Œåªèƒ½è¿›å…¥ Exception table ä¸­ä¸€ä¸ªåˆ†æ”¯ï¼Œæ‰€ä»¥å±€éƒ¨å˜é‡è¡¨ slot 2 ä½ç½®è¢«å…±ç”¨</p></blockquote><h4 id="multi-catch-çš„æƒ…å†µ"><a href="#multi-catch-çš„æƒ…å†µ" class="headerlink" title="multi-catch çš„æƒ…å†µ"></a>multi-catch çš„æƒ…å†µ</h4><ul><li>æºä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo3_11_3</span> &#123;ï¬nally</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">Â  Â  Â  Â <span class="keyword">try</span> &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="type">Method</span> <span class="variable">test</span> <span class="operator">=</span> Demo3_11_3.class.getMethod(<span class="string">&quot;test&quot;</span>); </span><br><span class="line">Â  Â  Â  Â  Â  Â test.invoke(<span class="literal">null</span>);</span><br><span class="line">Â  Â  Â   &#125; <span class="keyword">catch</span> (NoSuchMethodException | IllegalAccessException | </span><br><span class="line">InvocationTargetException e) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â e.printStackTrace(); </span><br><span class="line">Â Â Â   &#125;</span><br><span class="line">Â &#125;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123; </span><br><span class="line">Â  Â  Â  Â System.out.println(<span class="string">&quot;ok&quot;</span>); </span><br><span class="line">Â &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>éƒ¨åˆ†å…³é”®å­—èŠ‚ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(java.lang.String[])</span>; </span><br><span class="line">Â  Â descriptor: ([Ljava/lang/String;)V</span><br><span class="line">Â  Â flags: ACC_PUBLIC, ACC_STATIC </span><br><span class="line">Â  Â Code:</span><br><span class="line">Â  Â  Â stack=<span class="number">3</span>, locals=<span class="number">2</span>, args_size=<span class="number">1</span></span><br><span class="line">Â  Â  Â  Â  <span class="number">0</span>: ldc Â  Â  Â  Â  Â  #<span class="number">2</span> Â  Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  <span class="number">2</span>: ldc Â  Â  Â  Â  Â  #<span class="number">3</span> Â  Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  <span class="number">4</span>: iconst_0</span><br><span class="line">Â  Â  Â  Â  <span class="number">5</span>: anewarray Â  Â  #<span class="number">4</span> Â  Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  <span class="number">8</span>: invokevirtual #<span class="number">5</span> Â  Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â <span class="number">11</span>: astore_1</span><br><span class="line">Â  Â  Â  Â <span class="number">12</span>: aload_1</span><br><span class="line">Â  Â  Â  Â <span class="number">13</span>: aconst_null </span><br><span class="line">Â  Â  Â  Â <span class="number">14</span>: iconst_0</span><br><span class="line">Â  Â  Â  Â <span class="number">15</span>: anewarray Â  Â  #<span class="number">6</span> Â  Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â <span class="number">18</span>: invokevirtual #<span class="number">7</span> Â  Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â <span class="number">21</span>: pop</span><br><span class="line">Â  Â  Â  Â <span class="number">22</span>: goto Â  Â  Â  Â  Â <span class="number">30</span> </span><br><span class="line">Â  Â  Â  Â <span class="number">25</span>: astore_1</span><br><span class="line">Â  Â  Â  Â <span class="number">26</span>: aload_1</span><br><span class="line">Â  Â  Â  Â <span class="number">27</span>: invokevirtual #<span class="number">11</span> <span class="comment">// e.printStackTrace:()V </span></span><br><span class="line">Â  Â  Â  Â <span class="number">30</span>: <span class="keyword">return</span></span><br><span class="line">Â  Â  Â Exception table:</span><br><span class="line">Â  Â  Â  Â  from Â  Â to Â target type</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="number">0</span> Â  Â <span class="number">22</span> Â  Â <span class="number">25</span> Â  Class java/lang/NoSuchMethodException</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="number">0</span> Â  Â <span class="number">22</span> Â  Â <span class="number">25</span> Â  Class java/lang/IllegalAccessException</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="number">0</span> Â  Â <span class="number">22</span> Â  Â <span class="number">25</span> Â  Class java/lang/reflect/InvocationTargetException </span><br><span class="line">Â  Â  Â LineNumberTable: ...</span><br><span class="line">Â  Â  Â LocalVariableTable:</span><br><span class="line">Â  Â  Â  Â Start Â Length Â Slot Â Name Â  Signature</span><br><span class="line">Â  Â  Â  Â  Â  <span class="number">12</span> Â  Â  Â <span class="number">10</span> Â  Â  <span class="number">1</span> Â test Â  Ljava/lang/reflect/Method;</span><br><span class="line">Â  Â  Â  Â  Â  <span class="number">26</span> Â  Â  Â  <span class="number">4</span> Â  Â  <span class="number">1</span> Â  Â  e Â  Ljava/lang/ReflectiveOperationException; </span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="number">0</span> Â  Â  Â <span class="number">31</span> Â  Â  <span class="number">0</span> Â args Â  [Ljava/lang/String;</span><br><span class="line">Â  Â  Â StackMapTable: ... </span><br><span class="line">Â  Â MethodParameters: ...</span><br></pre></td></tr></table></figure><p>Exception tableä¸­çš„targetéƒ½æŒ‡å‘ä¸€ä¸ªåœ°æ–¹</p><h4 id="finally"><a href="#finally" class="headerlink" title="finally"></a>finally</h4><ul><li>æºä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo3_11_4</span> &#123;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">Â  Â  Â  Â <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">Â  Â  Â  Â <span class="keyword">try</span> &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â i = <span class="number">10</span>;</span><br><span class="line">Â  Â  Â   &#125; <span class="keyword">catch</span> (Exception e) &#123; </span><br><span class="line">Â  Â  Â  Â  Â  Â i = <span class="number">20</span>;</span><br><span class="line">Â  Â  Â  &#125; <span class="keyword">finally</span> &#123; </span><br><span class="line">Â  Â  Â  Â  Â  Â i = <span class="number">30</span>; </span><br><span class="line">Â Â Â  &#125;</span><br><span class="line">Â &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>éƒ¨åˆ†å…³é”®å­—èŠ‚ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(java.lang.String[])</span>; </span><br><span class="line">Â  Â descriptor: ([Ljava/lang/String;)V</span><br><span class="line">Â  Â flags: ACC_PUBLIC, ACC_STATIC </span><br><span class="line">Â  Â Code:</span><br><span class="line">Â  Â  Â stack=<span class="number">1</span>, locals=<span class="number">4</span>, args_size=<span class="number">1</span> </span><br><span class="line">Â  Â  Â  Â  <span class="number">0</span>: iconst_0</span><br><span class="line">Â  Â  Â  Â  <span class="number">1</span>: istore_1 Â  Â         <span class="comment">// 0 -&gt; i</span></span><br><span class="line">Â  Â  Â  Â  <span class="number">2</span>: bipush Â  Â  Â  Â <span class="number">10</span> Â  Â <span class="comment">// try -------------------------------------- </span></span><br><span class="line">Â  Â  Â  Â  <span class="number">4</span>: istore_1 Â  Â  Â  Â  Â  Â <span class="comment">// 10 -&gt; i Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  | </span></span><br><span class="line">Â  Â  Â  Â  <span class="number">5</span>: bipush Â  Â  Â  Â <span class="number">30</span> Â  Â <span class="comment">// finally Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  | </span></span><br><span class="line">Â  Â  Â  Â  <span class="number">7</span>: istore_1 Â  Â  Â  Â  Â  Â <span class="comment">// 30 -&gt; i Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  | </span></span><br><span class="line">Â  Â  Â  Â  <span class="number">8</span>: goto Â  Â  Â  Â  Â <span class="number">27</span> Â  Â <span class="comment">// return ----------------------------------- </span></span><br><span class="line">Â  Â  Â  Â <span class="number">11</span>: astore_2 Â  Â  Â  Â  Â  Â <span class="comment">// catch Exceptin -&gt; e ---------------------- </span></span><br><span class="line">Â  Â  Â  Â <span class="number">12</span>: bipush Â  Â  Â  Â <span class="number">20</span> Â  Â <span class="comment">// Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  | </span></span><br><span class="line">Â  Â  Â  Â <span class="number">14</span>: istore_1 Â  Â  Â  Â  Â  Â <span class="comment">// 20 -&gt; i Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  | </span></span><br><span class="line">Â  Â  Â  Â <span class="number">15</span>: bipush Â  Â  Â  Â <span class="number">30</span> Â  Â <span class="comment">// finally Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  | </span></span><br><span class="line">Â  Â  Â  Â <span class="number">17</span>: istore_1 Â  Â  Â  Â  Â  Â <span class="comment">// 30 -&gt; i Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  | </span></span><br><span class="line">Â  Â  Â  Â <span class="number">18</span>: goto Â  Â  Â  Â  Â <span class="number">27</span> Â  Â <span class="comment">// return ----------------------------------- </span></span><br><span class="line">Â  Â  Â  Â <span class="number">21</span>: astore_3 Â  Â  Â  Â  Â  Â <span class="comment">// catch any -&gt; slot 3 ---------------------- </span></span><br><span class="line">Â  Â  Â  Â <span class="number">22</span>: bipush Â  Â  Â  Â <span class="number">30</span> Â  Â <span class="comment">// finally Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  | </span></span><br><span class="line">Â  Â  Â  Â <span class="number">24</span>: istore_1 Â  Â  Â  Â  Â  Â <span class="comment">// 30 -&gt; i Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  | </span></span><br><span class="line">Â  Â  Â  Â <span class="number">25</span>: aload_3 Â  Â  Â  Â  Â  Â  <span class="comment">// &lt;- slot 3 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  | </span></span><br><span class="line">Â  Â  Â  Â <span class="number">26</span>: athrow Â  Â  Â  Â  Â  Â  Â <span class="comment">// throw ------------------------------------ </span></span><br><span class="line">Â  Â  Â  Â <span class="number">27</span>: <span class="keyword">return</span></span><br><span class="line">Â  Â  Â Exception table:</span><br><span class="line">Â  Â  Â  Â  from Â  Â to Â target type</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="number">2</span> Â  Â  <span class="number">5</span> Â  Â <span class="number">11</span> Â  Class java/lang/Exception</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="number">2</span> Â  Â  <span class="number">5</span> Â  Â <span class="number">21</span> Â  any Â  Â <span class="comment">// å‰©ä½™çš„å¼‚å¸¸ç±»å‹ï¼Œæ¯”å¦‚ Error </span></span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="number">11</span> Â  Â <span class="number">15</span> Â  Â <span class="number">21</span> Â  any Â  Â <span class="comment">// å‰©ä½™çš„å¼‚å¸¸ç±»å‹ï¼Œæ¯”å¦‚ Error </span></span><br><span class="line">Â  Â  Â LineNumberTable: ...</span><br><span class="line">Â  Â  Â LocalVariableTable:</span><br><span class="line">Â  Â  Â  Â Start Â Length Â Slot Â Name Â  Signature</span><br><span class="line">Â  Â  Â  Â  Â  <span class="number">12</span> Â  Â  Â  <span class="number">3</span> Â  Â  <span class="number">2</span> Â  Â  e Â  Ljava/lang/Exception; </span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="number">0</span> Â  Â  Â <span class="number">28</span> Â  Â  <span class="number">0</span> Â args Â  [Ljava/lang/String; </span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="number">2</span> Â  Â  Â <span class="number">26</span> Â  Â  <span class="number">1</span> Â  Â  i Â  I</span><br><span class="line">Â  Â  Â StackMapTable: ... </span><br><span class="line">Â  Â MethodParameters: ...</span><br></pre></td></tr></table></figure><ul><li>å¯ä»¥çœ‹åˆ°æœ‰3ä¸ª[from, to)<ul><li>ç¬¬ä¸€ä¸ª<code>[2, 5)</code>æ˜¯æ£€æµ‹tryå—ä¸­æ˜¯å¦æœ‰Exceptionå¼‚å¸¸ï¼Œå¦‚æœæœ‰åˆ™è·³è½¬è‡³11è¡Œæ‰§è¡Œcatchå—</li><li>ç¬¬äºŒä¸ª<code>[2, 5)</code>æ˜¯æ£€æµ‹tryå—ä¸­æ˜¯å¦æœ‰å…¶ä»–å¼‚å¸¸ï¼ˆéExceptionå¼‚å¸¸ï¼‰ï¼Œå¦‚æœæœ‰åˆ™è·³è½¬è‡³21è¡Œæ‰§è¡Œfinallyå—</li><li>ç¬¬ä¸‰ä¸ª<code>[11, 15)</code>æ˜¯æ£€æµ‹catchå¿«ä¸­æ˜¯å¦æœ‰å…¶ä»–å¼‚å¸¸ï¼Œå¦‚æœæœ‰åˆ™è·³è½¬è‡³21è¡Œæ‰§è¡Œfinallyå—</li></ul></li><li>ç»“è®ºï¼šfinallyä¸­çš„ä»£ç è¢«å¤åˆ¶äº†ä¸‰åˆ†ï¼Œåˆ†åˆ«æ”¾è¿›tryæµç¨‹ã€catchæµç¨‹ä»¥åŠcatchå‰©ä½™çš„å¼‚å¸¸ç±»å‹æµç¨‹</li></ul><h3 id="finallyé¢è¯•é¢˜"><a href="#finallyé¢è¯•é¢˜" class="headerlink" title="finallyé¢è¯•é¢˜"></a>finallyé¢è¯•é¢˜</h3><ul><li>æºä»£ç ï¼Œç»“æœä¸º20</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo_35</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> test();</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å­—èŠ‚ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">test</span><span class="params">()</span>;</span><br><span class="line">  descriptor: ()I</span><br><span class="line">  flags: ACC_PRIVATE, ACC_STATIC</span><br><span class="line">  Code:</span><br><span class="line">    stack=<span class="number">1</span>, locals=<span class="number">2</span>, args_size=<span class="number">0</span></span><br><span class="line">       <span class="number">0</span>: bipush        <span class="number">10</span>      <span class="comment">// å°† int 10 å‹å…¥æ ˆé¡¶</span></span><br><span class="line">       <span class="number">2</span>: istore_0              <span class="comment">// å°†æ ˆé¡¶çš„ int 10 å­˜å…¥åˆ°å±€éƒ¨å˜é‡ slot 0 ä¸­ï¼Œå¹¶ä»æ ˆé¡¶å¼¹å‡º</span></span><br><span class="line">       <span class="number">3</span>: bipush        <span class="number">20</span>      <span class="comment">// å°† int 20 å‹å…¥æ ˆé¡¶</span></span><br><span class="line">       <span class="number">5</span>: ireturn               <span class="comment">// è¿”å›æ ˆé¡¶çš„ int 20</span></span><br><span class="line">       <span class="number">6</span>: astore_1              <span class="comment">// æ•è·ä»»ä½•å¼‚å¸¸</span></span><br><span class="line">       <span class="number">7</span>: bipush        <span class="number">20</span>      <span class="comment">// å°† int 20 å‹å…¥æ ˆé¡¶</span></span><br><span class="line">       <span class="number">9</span>: ireturn</span><br><span class="line">    Exception table:</span><br><span class="line">       from    to  target type</span><br><span class="line">           <span class="number">0</span>     <span class="number">3</span>     <span class="number">6</span>   any</span><br><span class="line">    LineNumberTable:</span><br><span class="line">      line <span class="number">11</span>: <span class="number">0</span></span><br><span class="line">      line <span class="number">13</span>: <span class="number">3</span></span><br><span class="line">    StackMapTable: number_of_entries = <span class="number">1</span></span><br><span class="line">      frame_type = <span class="number">70</span> <span class="comment">/* same_locals_1_stack_item */</span></span><br><span class="line">        stack = [ <span class="keyword">class</span> <span class="title class_">java</span>/lang/Throwable ]</span><br></pre></td></tr></table></figure><ul><li><p>ç”±äº ï¬nally ä¸­çš„ ireturn è¢«æ’å…¥äº†æ‰€æœ‰å¯èƒ½çš„æµç¨‹ï¼Œå› æ­¤è¿”å›ç»“æœè‚¯å®šä»¥ ï¬nally çš„ä¸ºå‡† </p></li><li><p>è‡³äºå­—èŠ‚ç ä¸­ç¬¬ 2 è¡Œï¼Œä¼¼ä¹æ²¡å•¥ç”¨ï¼Œä¸”ç•™ä¸ªä¼ç¬”ï¼Œçœ‹ä¸‹ä¸ªä¾‹å­</p></li><li><p>è·Ÿä¸Šä¾‹ä¸­çš„ ï¬nally ç›¸æ¯”ï¼Œå‘ç°æ²¡æœ‰ athrow äº†ï¼Œè¿™å‘Šè¯‰æˆ‘ä»¬ï¼šå¦‚æœåœ¨ ï¬nally ä¸­å‡ºç°äº† returnï¼Œä¼š<br>åæ‰å¼‚å¸¸</p></li><li><p>æºä»£ç </p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo_37</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> test();</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            i = <span class="number">20</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å­—èŠ‚ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">test</span><span class="params">()</span>;</span><br><span class="line">  descriptor: ()I</span><br><span class="line">  flags: ACC_PRIVATE, ACC_STATIC</span><br><span class="line">  Code:</span><br><span class="line">    stack=<span class="number">1</span>, locals=<span class="number">3</span>, args_size=<span class="number">0</span></span><br><span class="line">       <span class="number">0</span>: bipush        <span class="number">10</span>      <span class="comment">// å°† 10 æ”¾å…¥æ ˆé¡¶</span></span><br><span class="line">       <span class="number">2</span>: istore_0              <span class="comment">// 10 -&gt; i</span></span><br><span class="line">       <span class="number">3</span>: iload_0               <span class="comment">// &lt;- i(10)</span></span><br><span class="line">       <span class="number">4</span>: istore_1              <span class="comment">// å°† i(10) æš‚å­˜è‡³ slot 1ï¼Œç›®çš„æ˜¯ä¸ºäº†å›ºå®šè¿”å›å€¼</span></span><br><span class="line">       <span class="number">5</span>: bipush        <span class="number">20</span>      <span class="comment">// å°† 20 æ”¾å…¥æ ˆé¡¶</span></span><br><span class="line">       <span class="number">7</span>: istore_0              <span class="comment">// 20 -&gt; i</span></span><br><span class="line">       <span class="number">8</span>: iload_1               <span class="comment">// è½½å…¥ slot 1 æš‚å­˜çš„å€¼ (10)</span></span><br><span class="line">       <span class="number">9</span>: ireturn               <span class="comment">// è¿”å›æ ˆé¡¶çš„å€¼</span></span><br><span class="line">      <span class="number">10</span>: astore_2</span><br><span class="line">      <span class="number">11</span>: bipush        <span class="number">20</span></span><br><span class="line">      <span class="number">13</span>: istore_0</span><br><span class="line">      <span class="number">14</span>: aload_2</span><br><span class="line">      <span class="number">15</span>: athrow</span><br><span class="line">    Exception table:</span><br><span class="line">       from    to  target type</span><br><span class="line">           <span class="number">3</span>     <span class="number">5</span>    <span class="number">10</span>   any</span><br><span class="line">    LineNumberTable:</span><br><span class="line">      line <span class="number">10</span>: <span class="number">0</span></span><br><span class="line">      line <span class="number">12</span>: <span class="number">3</span></span><br><span class="line">      line <span class="number">14</span>: <span class="number">5</span></span><br><span class="line">      line <span class="number">12</span>: <span class="number">8</span></span><br><span class="line">      line <span class="number">14</span>: <span class="number">10</span></span><br><span class="line">      line <span class="number">15</span>: <span class="number">14</span></span><br><span class="line">    LocalVariableTable:</span><br><span class="line">      Start  Length  Slot  Name   Signature</span><br><span class="line">          <span class="number">3</span>      <span class="number">13</span>     <span class="number">0</span>     i   I</span><br><span class="line">    StackMapTable: number_of_entries = <span class="number">1</span></span><br><span class="line">      frame_type = <span class="number">255</span> <span class="comment">/* full_frame */</span></span><br><span class="line">        offset_delta = <span class="number">10</span></span><br><span class="line">        locals = [ <span class="type">int</span> ]</span><br><span class="line">        stack = [ <span class="keyword">class</span> <span class="title class_">java</span>/lang/Throwable ]</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå› ä¸ºåªåœ¨<code>try</code>å—ä¸­æœ‰ä¸€ä¸ª<code>return</code>è¯­å¥ï¼Œè€Œåœ¨<code>finally</code>å—ä¸­æ²¡æœ‰<code>return</code>è¯­å¥ï¼Œæ‰€ä»¥<code>ireturn</code>ä¼šåŠ è½½<code>try</code>å—ä¸­çš„å±€éƒ¨å˜é‡<code>i</code>ï¼Œè€Œä¸æ˜¯<code>finally</code>å—ä¸­çš„å±€éƒ¨å˜é‡<code>i</code>ã€‚å¦‚æœåœ¨<code>finally</code>å—ä¸­ä¹Ÿæœ‰ä¸€ä¸ª<code>return</code>è¯­å¥ï¼Œé‚£ä¹ˆ<code>ireturn</code>å°†åŠ è½½<code>finally</code>å—ä¸­çš„å±€éƒ¨å˜é‡<code>i</code> å¹¶è¿”å›å®ƒçš„å€¼ã€‚</p><h3 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h3><ul><li>æºä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo_38</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å­—èŠ‚ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(java.lang.String[])</span>;</span><br><span class="line">  descriptor: ([Ljava/lang/String;)V</span><br><span class="line">  flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">  Code:</span><br><span class="line">    stack=<span class="number">2</span>, locals=<span class="number">4</span>, args_size=<span class="number">1</span></span><br><span class="line">       <span class="number">0</span>: <span class="keyword">new</span>           #<span class="number">2</span>                  <span class="comment">// class java/lang/Object</span></span><br><span class="line">       <span class="number">3</span>: dup</span><br><span class="line">       <span class="number">4</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">       <span class="number">7</span>: astore_1                          <span class="comment">// lockå¼•ç”¨ -&gt; lock</span></span><br><span class="line">       <span class="number">8</span>: aload_1                           <span class="comment">// &lt;- lock ï¼ˆsynchronizedå¼€å§‹ï¼‰</span></span><br><span class="line">       <span class="number">9</span>: dup</span><br><span class="line">      <span class="number">10</span>: astore_2                          <span class="comment">// lockå¼•ç”¨ -&gt; slot 2</span></span><br><span class="line">      <span class="number">11</span>: monitorenter                      <span class="comment">// monitorenter(lockå¼•ç”¨)</span></span><br><span class="line">      <span class="number">12</span>: getstatic     #<span class="number">3</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">      <span class="number">15</span>: ldc           #<span class="number">4</span>                  <span class="comment">// String ok</span></span><br><span class="line">      <span class="number">17</span>: invokevirtual #<span class="number">5</span>                  <span class="comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">      <span class="number">20</span>: aload_2                           <span class="comment">// &lt;- slot 2(lockå¼•ç”¨)</span></span><br><span class="line">      <span class="number">21</span>: monitorexit                       <span class="comment">// monitorexit(lockå¼•ç”¨)</span></span><br><span class="line">      <span class="number">22</span>: goto          <span class="number">30</span></span><br><span class="line">      <span class="number">25</span>: astore_3                          <span class="comment">// any -&gt; slot 3</span></span><br><span class="line">      <span class="number">26</span>: aload_2                           <span class="comment">// &lt;- slot 2(lockå¼•ç”¨)</span></span><br><span class="line">      <span class="number">27</span>: monitorexit                       <span class="comment">// monitorexit(lockå¼•ç”¨)</span></span><br><span class="line">      <span class="number">28</span>: aload_3</span><br><span class="line">      <span class="number">29</span>: athrow</span><br><span class="line">      <span class="number">30</span>: <span class="keyword">return</span></span><br><span class="line">    Exception table:</span><br><span class="line">       from    to  target type</span><br><span class="line">          <span class="number">12</span>    <span class="number">22</span>    <span class="number">25</span>   any</span><br><span class="line">          <span class="number">25</span>    <span class="number">28</span>    <span class="number">25</span>   any</span><br><span class="line">    LineNumberTable:</span><br><span class="line">      line <span class="number">5</span>: <span class="number">0</span></span><br><span class="line">      line <span class="number">6</span>: <span class="number">8</span></span><br><span class="line">      line <span class="number">7</span>: <span class="number">12</span></span><br><span class="line">      line <span class="number">8</span>: <span class="number">20</span></span><br><span class="line">      line <span class="number">9</span>: <span class="number">30</span></span><br><span class="line">    LocalVariableTable:</span><br><span class="line">      Start  Length  Slot  Name   Signature</span><br><span class="line">          <span class="number">0</span>      <span class="number">31</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">          <span class="number">8</span>      <span class="number">23</span>     <span class="number">1</span>  lock   Ljava/lang/Object;</span><br></pre></td></tr></table></figure><h2 id="ç¼–è¯‘æœŸå¤„ç†"><a href="#ç¼–è¯‘æœŸå¤„ç†" class="headerlink" title="ç¼–è¯‘æœŸå¤„ç†"></a>ç¼–è¯‘æœŸå¤„ç†</h2><blockquote><p>æ‰€è°“çš„è¯­æ³•ç³–ï¼Œå…¶å®å°±æ˜¯æŒ‡ java ç¼–è¯‘å™¨æŠŠ java æºç ç¼–è¯‘ä¸º class å­—èŠ‚ç çš„è¿‡ç¨‹ä¸­ï¼Œè‡ªåŠ¨ç”Ÿæˆå’Œè½¬æ¢çš„ä¸€äº›ä»£ç ï¼Œä¸»è¦æ˜¯ä¸ºäº†å‡è½»ç¨‹åºå‘˜çš„è´Ÿæ‹…ï¼Œç®—æ˜¯ java ç¼–è¯‘å™¨ç»™æˆ‘ä»¬çš„ä¸€ä¸ªé¢å¤–ç¦åˆ©</p></blockquote><h3 id="é»˜è®¤æ„é€ å™¨"><a href="#é»˜è®¤æ„é€ å™¨" class="headerlink" title="é»˜è®¤æ„é€ å™¨"></a>é»˜è®¤æ„é€ å™¨</h3><ul><li>å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å£°æ˜ä»»ä½•æ„é€ å‡½æ•°ï¼ŒJava ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºè¯¥ç±»ç”Ÿæˆä¸€ä¸ªæ— å‚æ„é€ å‡½æ•°ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy01</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¼–è¯‘æˆclassåçš„ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy1</span> &#123;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ— å‚æ„é€ æ˜¯ç¼–è¯‘å™¨å¸®åŠ©æˆ‘ä»¬åŠ ä¸Šçš„</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Candy1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(); <span class="comment">// å³è°ƒç”¨çˆ¶ç±» Object çš„æ— å‚æ„é€ æ–¹æ³•ï¼Œå³è°ƒç”¨ java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªåŠ¨æ‹†è£…ç®±"><a href="#è‡ªåŠ¨æ‹†è£…ç®±" class="headerlink" title="è‡ªåŠ¨æ‹†è£…ç®±"></a>è‡ªåŠ¨æ‹†è£…ç®±</h3><p>è¿™ä¸ªç‰¹æ€§æ˜¯JDK5å¼€å§‹åŠ å…¥çš„ï¼Œä»£ç ç‰‡æ®µ1ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy2</span> &#123;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">Â  Â  Â  Â <span class="type">Integer</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">Â  Â  Â  Â <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> x; </span><br><span class="line">Â &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç åœ¨JDK5ä¹‹å‰æ˜¯æ— æ³•ç¼–è¯‘é€šè¿‡çš„ï¼Œå¿…é¡»æ”¹å†™ä¸ºä»£ç ç‰‡æ®µ2ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy2</span> &#123;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">Â  Â  Â  Â <span class="type">Integer</span> <span class="variable">x</span> <span class="operator">=</span> Integer.valueOf(<span class="number">1</span>);</span><br><span class="line">Â  Â  Â  Â <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> x.intValue(); </span><br><span class="line">Â &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶ä¹‹å‰ç‰ˆæœ¬çš„ä»£ç å¤ªéº»çƒ¦äº†ï¼Œéœ€è¦åœ¨åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹ä¹‹é—´æ¥å›è½¬æ¢ï¼ˆå°¤å…¶æ˜¯é›†åˆç±»ä¸­æ“ä½œçš„éƒ½æ˜¯åŒ…è£…ç±»å‹ï¼‰ï¼Œå› æ­¤è¿™äº›è½¬æ¢çš„äº‹æƒ…åœ¨ JDK5ä»¥åéƒ½ç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘é˜¶æ®µå®Œæˆã€‚å³ä»£ç ç‰‡æ®µ1 éƒ½ä¼šåœ¨ç¼–è¯‘é˜¶æ®µè¢«è½¬æ¢ä¸ºä»£ç ç‰‡æ®µ2ã€‚</p><h3 id="æ³›å‹é›†åˆå–å€¼"><a href="#æ³›å‹é›†åˆå–å€¼" class="headerlink" title="æ³›å‹é›†åˆå–å€¼"></a>æ³›å‹é›†åˆå–å€¼</h3><p>æ³›å‹ä¹Ÿæ˜¯åœ¨JDK 5 å¼€å§‹åŠ å…¥çš„ç‰¹æ€§ï¼Œä½† java åœ¨ç¼–è¯‘æ³›å‹ä»£ç åä¼šæ‰§è¡Œ å‹é™¤çš„åŠ¨ä½œï¼Œå³æ³›å‹ä¿¡æ¯åœ¨ç¼–è¯‘ä¸ºå­—èŠ‚ç ä¹‹åå°±ä¸¢å¤±äº†ï¼Œå®é™…çš„ç±»å‹éƒ½å½“åšäº† object ç±»å‹æ¥å¤„ç†:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy3</span> &#123;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">Â  Â  Â  Â List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">Â  Â  Â  Â list.add(<span class="number">10</span>); <span class="comment">// å®é™…è°ƒç”¨çš„æ˜¯    List.add(Object e)</span></span><br><span class="line">Â  Â  Â  Â <span class="type">Integer</span> <span class="variable">x</span> <span class="operator">=</span> list.get(<span class="number">0</span>); <span class="comment">// å®é™…è°ƒç”¨çš„æ˜¯    Object obj = List.get(int index); </span></span><br><span class="line">Â &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä»¥ä¸‹æ˜¯<strong>æ³›å‹æ“¦é™¤çš„ä¸€äº›é‡è¦åŸå› å’Œæ„ä¹‰</strong>ï¼š</p></blockquote><ol><li>å‘åå…¼å®¹æ€§ï¼šæ³›å‹åœ¨Java 5åŠä»¥åçš„ç‰ˆæœ¬å¼•å…¥ï¼Œä½†ä¸ºäº†ä¿æŒä¸ä¹‹å‰çš„ç‰ˆæœ¬çš„å…¼å®¹æ€§ï¼ŒJavaç¼–è¯‘å™¨é‡‡ç”¨äº†æ³›å‹æ“¦é™¤ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ç¼–å†™ä½¿ç”¨æ³›å‹çš„ä»£ç ï¼Œä½†åœ¨ç¼–è¯‘åï¼Œæ³›å‹ä¿¡æ¯å°†è¢«æ“¦é™¤ï¼Œä»¥ä¾¿åœ¨æ—§ç‰ˆæœ¬çš„Javaä¸­è¿è¡Œã€‚</li><li>å‡å°‘å†—ä½™ä»£ç ï¼šæ³›å‹æ“¦é™¤å¯ä»¥å‡å°‘ç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶çš„å¤§å°ã€‚å› ä¸ºæ³›å‹ä¿¡æ¯åœ¨è¿è¡Œæ—¶è¢«æ“¦é™¤ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ä¸ä¼šä¸ºæ¯ä¸ªä¸åŒçš„æ³›å‹ç±»å‹ç”Ÿæˆæ–°çš„ç±»æ–‡ä»¶ï¼Œä»è€Œå‡å°äº†ç”Ÿæˆçš„å­—èŠ‚ç çš„ä½“ç§¯ã€‚</li><li>é¿å…ç±»å‹ç›¸å…³çš„é”™è¯¯ï¼šæ³›å‹æ“¦é™¤ç¡®ä¿åœ¨è¿è¡Œæ—¶ä¸ä¼šå¼•å…¥ç±»å‹ç›¸å…³çš„é”™è¯¯ã€‚è¿™æ˜¯å› ä¸ºåœ¨æ³›å‹æ“¦é™¤ä¹‹åï¼Œç¼–è¯‘å™¨ä¼šæ’å…¥å¿…è¦çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä»¥ç¡®ä¿ç±»å‹å®‰å…¨æ€§ã€‚è¿™æœ‰åŠ©äºå‡å°‘åœ¨è¿è¡Œæ—¶å‡ºç°ClassCastExceptionç­‰ç±»å‹é”™è¯¯çš„å¯èƒ½æ€§ã€‚</li><li>å¯ä»¥å®ç°é€šç”¨æ€§ï¼šæ³›å‹æ“¦é™¤ä½¿å¾—å¯ä»¥ç¼–å†™é€šç”¨çš„æ³›å‹ä»£ç ï¼Œè¿™äº›ä»£ç ä¸ä¾èµ–äºå…·ä½“çš„æ³›å‹ç±»å‹ã€‚è¿™æœ‰åŠ©äºç¼–å†™æ›´é€šç”¨ã€å¯é‡ç”¨çš„ä»£ç åº“ï¼Œä¾‹å¦‚é›†åˆæ¡†æ¶ã€‚</li></ol><h3 id="å¯å˜å‚æ•°"><a href="#å¯å˜å‚æ•°" class="headerlink" title="å¯å˜å‚æ•°"></a>å¯å˜å‚æ•°</h3><p>å¯å˜å‚æ•°ä¹Ÿæ˜¯JDK5åŠ å…¥çš„æ–°ç‰¹æ€§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy4</span> &#123;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">(String... args)</span> &#123; </span><br><span class="line">Â  Â  Â  Â String[] array = args; <span class="comment">// ç›´æ¥èµ‹å€¼ </span></span><br><span class="line">Â  Â  Â  Â System.out.println(array);</span><br><span class="line">Â &#125;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">Â  Â  Â  Â foo(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>);</span><br><span class="line">Â &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯å˜å‚æ•°   Stringâ€¦ args å…¶å®æ˜¯ä¸€ä¸ª   String[] args ï¼Œä»ä»£ç ä¸­çš„èµ‹å€¼è¯­å¥ä¸­å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚<br>åŒæ · java ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸé—´å°†ä¸Šè¿°ä»£ç å˜æ¢ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy4</span> &#123;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">Â  Â  Â  Â String[] array = args; <span class="comment">// ç›´æ¥èµ‹å€¼ </span></span><br><span class="line">Â  Â  Â  Â System.out.println(array);</span><br><span class="line">Â &#125;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">Â  Â  Â  Â foo(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>&#125;); </span><br><span class="line">Â &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šå¦‚æœè°ƒç”¨foo()æ—¶æ²¡æœ‰æä¾›ä»»ä½•å‚æ•°ï¼Œé‚£ä¹ˆåˆ™ç­‰ä»·ä¸ºfoo(new String)ï¼Œåˆ›å»ºäº†ä¸€ä¸ªç©ºçš„æ•°ç»„ï¼Œè€Œä¸æ˜¯ä¼ ä¸€ä¸ªnullè¿›å»</p></blockquote><h3 id="foreach-å¾ªç¯"><a href="#foreach-å¾ªç¯" class="headerlink" title="foreach å¾ªç¯"></a>foreach å¾ªç¯</h3><ol><li>æ•°ç»„çš„å¾ªç¯</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy5_1</span> &#123;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">Â  Â  Â  Â <span class="type">int</span>[] array = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;; <span class="comment">// æ•°ç»„èµ‹åˆå€¼çš„ç®€åŒ–å†™æ³•ä¹Ÿæ˜¯è¯­æ³•ç³–å“¦ </span></span><br><span class="line">Â  Â  Â  Â <span class="keyword">for</span> (<span class="type">int</span> e : array) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â System.out.println(e); </span><br><span class="line">Â Â Â   &#125;</span><br><span class="line">Â &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼šè¢«ç¼–è¯‘å™¨è½¬æ¢ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy5_1</span> &#123; </span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="title function_">Candy5_1</span><span class="params">()</span> &#123; </span><br><span class="line">Â &#125;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">Â  Â  Â  Â <span class="type">int</span>[] array = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;; </span><br><span class="line">Â  Â  Â  Â <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; array.length; ++i) &#123; </span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="type">int</span> <span class="variable">e</span> <span class="operator">=</span> array[i];</span><br><span class="line">Â  Â  Â  Â  Â  Â System.out.println(e); </span><br><span class="line">Â Â Â   &#125;</span><br><span class="line">Â &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ol start="2"><li>é›†åˆçš„å¾ªç¯</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy5_2</span> &#123;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">Â  Â  Â  Â List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>); </span><br><span class="line">Â  Â  Â  Â <span class="keyword">for</span> (Integer i : list) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â System.out.println(i); </span><br><span class="line">Â Â Â   &#125;</span><br><span class="line">Â &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®é™…è¢«ç¼–è¯‘å™¨è½¬æ¢ä¸ºå¯¹è¿­ä»£å™¨çš„è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy5_2</span> &#123; </span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="title function_">Candy5_2</span><span class="params">()</span> &#123; </span><br><span class="line">Â &#125;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">Â  Â  Â  Â List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>); </span><br><span class="line">Â  Â  Â  Â <span class="type">Iterator</span> <span class="variable">iter</span> <span class="operator">=</span> list.iterator();</span><br><span class="line">Â  Â  Â  Â <span class="keyword">while</span>(iter.hasNext()) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="type">Integer</span> <span class="variable">e</span> <span class="operator">=</span> (Integer)iter.next(); </span><br><span class="line">Â  Â  Â  Â  Â  Â System.out.println(e);</span><br><span class="line">Â Â Â   &#125; </span><br><span class="line">Â &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="switch-å­—ç¬¦ä¸²"><a href="#switch-å­—ç¬¦ä¸²" class="headerlink" title="switch å­—ç¬¦ä¸²"></a>switch å­—ç¬¦ä¸²</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy6_1</span> &#123;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">choose</span><span class="params">(String str)</span> &#123; </span><br><span class="line">Â  Â  Â  Â <span class="keyword">switch</span> (str) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="keyword">case</span> <span class="string">&quot;hello&quot;</span>: &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â System.out.println(<span class="string">&quot;h&quot;</span>); </span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â <span class="keyword">break</span>;</span><br><span class="line">Â Â Â Â Â   &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="keyword">case</span> <span class="string">&quot;world&quot;</span>: &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â System.out.println(<span class="string">&quot;w&quot;</span>); </span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â <span class="keyword">break</span>;</span><br><span class="line">Â Â Â Â Â   &#125; </span><br><span class="line">Â Â Â   &#125;</span><br><span class="line">Â &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼šè¢«ç¼–è¯‘å™¨è½¬æ¢ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy07</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Candy07</span><span class="params">()</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">choose</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="type">byte</span> <span class="variable">x</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">switch</span> (str.hashCode()) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">99162322</span>:                  <span class="comment">// hello çš„ hashCode</span></span><br><span class="line">                <span class="keyword">if</span> (str.equals(<span class="string">&quot;hello&quot;</span>)) &#123;</span><br><span class="line">                    x = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">113318802</span>:                 <span class="comment">// world çš„ hashCode</span></span><br><span class="line">                <span class="keyword">if</span> (str.equals(<span class="string">&quot;world&quot;</span>)) &#123;</span><br><span class="line">                    x = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">switch</span> (x) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                System.out.println(<span class="string">&quot;h&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                System.out.println(<span class="string">&quot;w&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œäº†ä¸¤é switchï¼Œç¬¬ä¸€éæ˜¯æ ¹æ®å­—ç¬¦ä¸²çš„ hashCode å’Œ equals å°†å­—ç¬¦ä¸²çš„è½¬æ¢ä¸ºç›¸åº”<br>byte ç±»å‹ï¼Œç¬¬äºŒéæ‰æ˜¯åˆ©ç”¨ byte æ‰§è¡Œè¿›è¡Œæ¯”è¾ƒã€‚</li><li>ä¸ºä»€ä¹ˆç¬¬ä¸€éæ—¶å¿…é¡»æ—¢æ¯”è¾ƒ hashCodeï¼Œåˆåˆ©ç”¨ equals æ¯”è¾ƒå‘¢ï¼ŸhashCode æ˜¯ä¸ºäº†æé«˜æ•ˆç‡ï¼Œå‡å°‘å¯<br>èƒ½çš„æ¯”è¾ƒï¼›è€Œ equals æ˜¯ä¸ºäº†é˜²æ­¢ hashCode å†²çªï¼Œä¾‹å¦‚ BM å’Œ C. è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„hashCodeå€¼éƒ½æ˜¯<br>2123 ï¼Œå¦‚æœæœ‰å¦‚ä¸‹ä»£ç ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy6_2</span> &#123;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">choose</span><span class="params">(String str)</span> &#123; </span><br><span class="line">Â  Â  Â  Â <span class="keyword">switch</span> (str) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="keyword">case</span> <span class="string">&quot;BM&quot;</span>: &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â System.out.println(<span class="string">&quot;h&quot;</span>); </span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â <span class="keyword">break</span>;</span><br><span class="line">Â Â Â Â Â   &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="keyword">case</span> <span class="string">&quot;C.&quot;</span>: &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â System.out.println(<span class="string">&quot;w&quot;</span>); </span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â <span class="keyword">break</span>;</span><br><span class="line">Â Â Â Â Â   &#125; </span><br><span class="line">Â Â Â   &#125;</span><br><span class="line">Â &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼šè¢«ç¼–è¯‘å™¨è½¬æ¢ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">choose</span><span class="params">(String str)</span> &#123;</span><br><span class="line">    <span class="type">byte</span> <span class="variable">x</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">switch</span> (str.hashCode()) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2123</span>:                  <span class="comment">// hashCode å€¼å¯èƒ½ç›¸åŒï¼Œéœ€è¦è¿›ä¸€æ­¥ç”¨ equals æ¯”è¾ƒ</span></span><br><span class="line">            <span class="keyword">if</span> (str.equals(<span class="string">&quot;C.&quot;</span>)) &#123;</span><br><span class="line">                x = <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str.equals(<span class="string">&quot;BM&quot;</span>)) &#123;</span><br><span class="line">                x = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">switch</span> (x) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                    System.out.println(<span class="string">&quot;h&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    System.out.println(<span class="string">&quot;w&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="switch-æšä¸¾"><a href="#switch-æšä¸¾" class="headerlink" title="switch æšä¸¾"></a>switch æšä¸¾</h3><p>switch æšä¸¾çš„ä¾‹å­ï¼ŒåŸå§‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Sex</span> &#123;</span><br><span class="line">Â  Â MALE, FEMALE </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy7</span> &#123;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">(Sex sex)</span> &#123; </span><br><span class="line">Â  Â  Â  Â <span class="keyword">switch</span> (sex) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="keyword">case</span> MALE:</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â System.out.println(<span class="string">&quot;ç”·&quot;</span>); <span class="keyword">break</span>; </span><br><span class="line">Â  Â  Â  Â  Â  Â <span class="keyword">case</span> FEMALE:</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â System.out.println(<span class="string">&quot;å¥³&quot;</span>); <span class="keyword">break</span>; </span><br><span class="line">Â Â Â   &#125;</span><br><span class="line">Â &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è½¬æ¢åä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy08</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šä¹‰ä¸€ä¸ªåˆæˆç±»ï¼ˆä»… jvm ä½¿ç”¨ï¼Œå¯¹æˆ‘ä»¬ä¸å¯è§ï¼‰</span></span><br><span class="line"><span class="comment">     * ç”¨æ¥æ˜ å°„æšä¸¾çš„ ordinal ä¸æ•°ç»„å…ƒç´ çš„å…³ç³»</span></span><br><span class="line"><span class="comment">     * æšä¸¾çš„ ordinal è¡¨ç¤ºæšä¸¾å¯¹è±¡çš„åºå·ï¼Œä» 0 å¼€å§‹</span></span><br><span class="line"><span class="comment">     * å³ MALE çš„ ordinal()=0ï¼ŒFEMALE çš„ ordinal()=1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">$MAP</span> &#123;</span><br><span class="line">        <span class="comment">// æ•°ç»„å¤§å°å³ä¸ºæšä¸¾å…ƒç´ ä¸ªæ•°ï¼Œé‡Œé¢å­˜å‚¨caseç”¨æ¥å¯¹æ¯”çš„æ•°å­—</span></span><br><span class="line">        <span class="keyword">static</span> <span class="type">int</span>[] map = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            map[Sex.MALE.ordinal()] = <span class="number">1</span>;</span><br><span class="line">            map[Sex.FEMALE.ordinal()] = <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">(Sex sex)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> $MAP.map[sex.ordinal()];</span><br><span class="line">        <span class="keyword">switch</span> (x) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                System.out.println(<span class="string">&quot;ç”·&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                System.out.println(<span class="string">&quot;å¥³&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ordinal()æ˜¯è·å–æšä¸¾ç¼–å·çš„æ–¹æ³•</p></blockquote><h3 id="æšä¸¾ç±»"><a href="#æšä¸¾ç±»" class="headerlink" title="æšä¸¾ç±»"></a>æšä¸¾ç±»</h3><ul><li>æºä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Sex</span> &#123;</span><br><span class="line">    MALE, FEMALE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å­—èŠ‚ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Sex</span> <span class="keyword">extends</span> <span class="title class_">Enum</span>&lt;Sex&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Sex MALE;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Sex FEMALE;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Sex[] $VALUES;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        MALE = <span class="keyword">new</span> <span class="title class_">Sex</span>(<span class="string">&quot;MALE&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        FEMALE = <span class="keyword">new</span> <span class="title class_">Sex</span>(<span class="string">&quot;FEMALE&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        $VALUES = <span class="keyword">new</span> <span class="title class_">Sex</span>[]&#123;MALE, FEMALE&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sole constructor. Programmers cannot invoke this constructor.</span></span><br><span class="line"><span class="comment">     * It is for use by code emitted by the compiler in response to</span></span><br><span class="line"><span class="comment">     * enum type declarations.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name    - The name of this enum constant, which is the identifier</span></span><br><span class="line"><span class="comment">     *                used to declare it.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ordinal - The ordinal of this enumeration constant (its position</span></span><br><span class="line"><span class="comment">     *                in the enum declaration, where the initial constant is</span></span><br><span class="line"><span class="comment">     *                assigned</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Sex</span><span class="params">(String name, <span class="type">int</span> ordinal)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name, ordinal);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Sex[] values() &#123;</span><br><span class="line">        <span class="keyword">return</span> $VALUES.clone();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Sex <span class="title function_">valueOf</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Enum.valueOf(Sex.class, name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>Sex</code>è¢«å£°æ˜ä¸ºä¸€ä¸ª<code>final</code>ç±»ï¼Œå®ƒç»§æ‰¿äº†<code>Enum&lt;Sex&gt;</code>ç±»ï¼ŒEnumæ˜¯Javaä¸­å®šä¹‰æšä¸¾çš„æŠ½è±¡ç±»ã€‚MALEå’ŒFEMALEæ˜¯Sexç±»çš„ä¸¤ä¸ªæšä¸¾å€¼ï¼Œå®ƒä»¬è¢«å®šä¹‰ä¸ºé™æ€å¸¸é‡ã€‚</li><li>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªç§æœ‰çš„ã€<code>final</code>çš„<code>Sex</code>ç±»å‹æ•°ç»„<code>$VALUES</code>ï¼Œå®ƒç”¨äºå­˜å‚¨Sexç±»çš„æ‰€æœ‰æšä¸¾å€¼ã€‚åœ¨ç±»çš„é™æ€å—ä¸­ï¼Œ<code>$VALUES</code>æ•°ç»„è¢«åˆå§‹åŒ–ä¸ºä¸€ä¸ªåŒ…å«<code>MALE</code>å’Œ<code>FEMALE</code>çš„æ•°ç»„ã€‚</li><li>æ„é€ å‡½æ•°<code>Sex(String name, int ordinal)</code>æ˜¯ç§æœ‰çš„ï¼Œè¿™æ„å‘³ç€æ— æ³•åœ¨ç±»çš„å¤–éƒ¨ä½¿ç”¨è¿™ä¸ªæ„é€ å‡½æ•°æ¥åˆ›å»º<code>Sex</code>çš„å®ä¾‹ã€‚åªæœ‰Javaç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç æ‰èƒ½è°ƒç”¨è¿™ä¸ªæ„é€ å‡½æ•°æ¥åˆ›å»ºSexçš„å®ä¾‹ã€‚</li><li><code>values()</code>å’Œ<code>valueOf(String name)</code>æ˜¯ä»Enumç±»ç»§æ‰¿çš„ä¸¤ä¸ªé™æ€æ–¹æ³•ã€‚<code>values()</code>æ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…å«Sexç±»æ‰€æœ‰æšä¸¾å€¼çš„æ•°ç»„ï¼Œ<code>valueOf(String name)</code>æ–¹æ³•è¿”å›æŒ‡å®šåç§°çš„æšä¸¾å€¼ã€‚</li><li>å½“æˆ‘ä»¬ä½¿ç”¨MALEæˆ–è€…FEMALEæ—¶ï¼Œå…¶å®åº•å±‚è°ƒç”¨çš„æ˜¯<code>Enum.valueOf(Sex.class, &quot;MALE&quot;)</code>å’Œ<code>Enum.valueOf(Sex.class, &quot;FEMALE&quot;)</code></li></ul><h3 id="try-with-resources"><a href="#try-with-resources" class="headerlink" title="try-with-resources"></a>try-with-resources</h3><p>]DK 7 å¼€å§‹æ–°å¢äº†å¯¹éœ€è¦å…³é—­çš„èµ„æºå¤„ç†çš„ç‰¹æ®Šè¯­æ³• try-with-resourcesï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>(èµ„æºå˜é‡    = åˆ›å»ºèµ„æºå¯¹è±¡)&#123; </span><br><span class="line">    </span><br><span class="line">&#125; <span class="keyword">catch</span>( ) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­èµ„æºå¯¹è±¡éœ€è¦å®ç° Autocloseable æ¥å£ï¼Œä¾‹å¦‚ Inputstreamã€outputstreamã€Connectionã€statementã€Resultset ç­‰æ¥å£éƒ½å®ç°äº† Autocloseableï¼Œä½¿ç”¨ try-with-resources å¯ä»¥ä¸ç”¨å†™ finally è¯­å¥å—ï¼Œç¼–è¯‘å™¨ä¼šå¸®åŠ©ç”Ÿæˆå…³é—­èµ„æºä»£ç ï¼Œä¾‹å¦‚:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy9</span> &#123;</span><br><span class="line">Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">Â  Â  Â  Â <span class="keyword">try</span>(<span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;d:\\1.txt&quot;</span>)) &#123; </span><br><span class="line">Â  Â  Â  Â  Â  Â System.out.println(is);</span><br><span class="line">Â  Â  Â  &#125; <span class="keyword">catch</span> (IOException e) &#123; </span><br><span class="line">Â  Â  Â  Â  Â  Â e.printStackTrace(); </span><br><span class="line">Â Â Â  &#125;</span><br><span class="line">Â &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼šè¢«è½¬æ¢ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy09</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Candy09</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;d:\\tmp.txt&quot;</span>);</span><br><span class="line">            <span class="type">Throwable</span> <span class="variable">t</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(is);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable e1) &#123;</span><br><span class="line">                <span class="comment">// t æ˜¯æˆ‘ä»¬ä»£ç å‡ºç°çš„å¼‚å¸¸</span></span><br><span class="line">                t = e1;</span><br><span class="line">                <span class="keyword">throw</span> e1;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">// åˆ¤æ–­äº†èµ„æºä¸ä¸ºç©º</span></span><br><span class="line">                <span class="keyword">if</span> (is != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœæˆ‘ä»¬ä»£ç æœ‰å¼‚å¸¸</span></span><br><span class="line">                    <span class="keyword">if</span> (t != <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            is.close();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Throwable e2) &#123;</span><br><span class="line">                            <span class="comment">// å¦‚æœ close å‡ºç°å¼‚å¸¸ï¼Œä½œä¸ºè¢«å‹åˆ¶å¼‚å¸¸æ·»åŠ </span></span><br><span class="line">                            t.addSuppressed(e2);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// å¦‚æœæˆ‘ä»¬ä»£ç æ²¡æœ‰å¼‚å¸¸ï¼Œclose å‡ºç°çš„å¼‚å¸¸å°±æ˜¯æœ€å catch å—ä¸­çš„ e</span></span><br><span class="line">                        is.close();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆè¦è®¾è®¡ä¸€ä¸ª addsuppressed(Throwable e) (æ·»åŠ è¢«å‹åˆ¶å¼‚å¸¸) çš„æ–¹æ³•å‘¢? </p><p>æ˜¯ä¸ºäº†é˜²æ­¢å¼‚å¸¸ä¿¡æ¯çš„ä¸¢å¤±(æƒ³æƒ³ try-with-resources ç”Ÿæˆçš„ fianlly ä¸­å¦‚æœæŠ›å‡ºäº†å¼‚å¸¸) :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">MyResource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyResource</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyResource</span> <span class="keyword">implements</span> <span class="title class_">AutoCloseable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;close å¼‚å¸¸&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ï¼Œä¸¤ä¸ªå¼‚å¸¸ä¿¡æ¯éƒ½ä¸ä¼šä¸¢å¤±ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java.lang.ArithmeticException: / by zero</span><br><span class="line">    at com.demo.Test.main(Test.java:<span class="number">6</span>)</span><br><span class="line">    Suppressed: java.lang.Exception: close å¼‚å¸¸</span><br><span class="line">        at com.demo.MyResource.close(Test.java:<span class="number">14</span>)</span><br><span class="line">        at com.demo.Test.main(Test.java:<span class="number">7</span>)</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ³•é‡å†™æ—¶çš„æ¡¥æ¥æ–¹æ³•"><a href="#æ–¹æ³•é‡å†™æ—¶çš„æ¡¥æ¥æ–¹æ³•" class="headerlink" title="æ–¹æ³•é‡å†™æ—¶çš„æ¡¥æ¥æ–¹æ³•"></a>æ–¹æ³•é‡å†™æ—¶çš„æ¡¥æ¥æ–¹æ³•</h3><p>æ–¹æ³•é‡å†™æ—¶ï¼Œå¯¹è¿”å›å€¼åˆ†ä¸¤ç§æƒ…å†µ</p><ol><li>çˆ¶ç±»ä¸å­ç±»çš„è¿”å›å€¼å®Œå…¨ä¸€è‡´</li><li>å­ç±»è¿”å›å€¼å¯ä»¥æ˜¯çˆ¶ç±»è¿”å›å€¼çš„å­ç±»ï¼ˆæ¯”è¾ƒç»•å£ï¼Œç›´æ¥çœ‹ä¸‹é¢çš„ä¾‹å­æ¥ç†è§£ï¼‰</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Number <span class="title function_">m</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">// çˆ¶ç±»Aæ–¹æ³•çš„è¿”å›å€¼æ˜¯Numberç±»å‹ï¼Œå­ç±»Bæ–¹æ³•çš„è¿”å›å€¼æ˜¯Integerç±»å‹ï¼ŒIntegeræ˜¯Numberçš„å­ç±»</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">m</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå¯¹äºå­ç±»ï¼Œç¼–è¯‘å™¨ä¼šåšå¦‚ä¸‹å¤„ç†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">m</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ­¤æ–¹æ³•æ‰æ˜¯çœŸæ­£é‡å†™äº†çˆ¶ç±» public Number m() æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> synthetic bridge Number <span class="title function_">m</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ public Integer m()</span></span><br><span class="line">        <span class="keyword">return</span> m();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„æ¡¥æ¥æ–¹æ³•æ¯”è¾ƒç‰¹æ®Šï¼Œä»…å¯¹Javaè™šæ‹Ÿæœºå¯è§ï¼Œå¹¶ä¸”ä¸åŸæ¥çš„public Integer m()æ²¡æœ‰å‘½åå†²çª</p><h3 id="åŒ¿åå†…éƒ¨ç±»"><a href="#åŒ¿åå†…éƒ¨ç±»" class="headerlink" title="åŒ¿åå†…éƒ¨ç±»"></a>åŒ¿åå†…éƒ¨ç±»</h3><ul><li>åŸå§‹Javaä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy10</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">runnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è½¬æ¢åä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¢å¤–ç”Ÿæˆçš„ç±»</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Candy10$1</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    Candy10$<span class="number">1</span>() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy10</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">runnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Candy10$1</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯¹äºåŒ¿åå†…éƒ¨ç±»ï¼Œå®ƒçš„åº•å±‚å®ç°æ˜¯ç±»ä¼¼äºæ™®é€šå†…éƒ¨ç±»çš„ï¼Œåªä¸è¿‡æ²¡æœ‰å‘½åè€Œå·²ã€‚åœ¨ç”ŸæˆåŒ¿åå†…éƒ¨ç±»çš„classæ–‡ä»¶æ—¶ï¼ŒJavaç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºè¯¥ç±»ç”Ÿæˆä¸€ä¸ªç±»åï¼Œåœ¨åŸå§‹ç±»åä¸ŠåŠ åç¼€<code>$1</code>ï¼Œå¦‚æœæœ‰å¤šä¸ªåŒ¿åå†…éƒ¨ç±»ï¼Œåˆ™<code>$2</code>ã€<code>$3</code>ä»¥æ­¤ç±»æ¨</li><li>å¼•ç”¨å±€éƒ¨å˜é‡çš„åŒ¿åå†…éƒ¨ç±»ï¼ŒåŸå§‹Javaä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy11</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(<span class="keyword">final</span>  <span class="type">int</span> x)</span>&#123;</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">runnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;ok&quot;</span> + x);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è½¬æ¢åä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¢å¤–ç”Ÿæˆçš„ç±»</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Candy11$1</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="type">int</span> val$x;</span><br><span class="line">    Candy11$<span class="number">1</span>(<span class="type">int</span> x) &#123;</span><br><span class="line">        <span class="built_in">this</span>.val$x = x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ok:&quot;</span> + <span class="built_in">this</span>.val$x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Candy11</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(<span class="keyword">final</span> <span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">runnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Candy11$1</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ³¨æ„ï¼šè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆåŒ¿åå†…éƒ¨ç±»å¼•ç”¨å±€éƒ¨å˜é‡æ—¶ï¼Œå±€éƒ¨å˜é‡å¿…é¡»ä¸ºfinalçš„<ul><li>å› ä¸ºåœ¨åˆ›å»º<code>Candy$11</code>å¯¹è±¡æ—¶ï¼Œå°†xçš„å€¼èµ‹ç»™äº†<code>val$x</code>å±æ€§ï¼Œæ‰€ä»¥xä¸åº”è¯¥å†å‘ç”Ÿå˜åŒ–äº†</li><li>å¦‚æœå˜åŒ–ï¼Œé‚£ä¹ˆ<code>val$x</code>å±æ€§æ²¡æœ‰æœºä¼šå†è·Ÿç€ä¸€èµ·å˜åŒ–</li></ul></li></ul><h2 id="ç±»åŠ è½½é˜¶æ®µ"><a href="#ç±»åŠ è½½é˜¶æ®µ" class="headerlink" title="ç±»åŠ è½½é˜¶æ®µ"></a>ç±»åŠ è½½é˜¶æ®µ</h2><p>æ–‡ç« å‚è€ƒè‡ªï¼š<a href="https://javaguide.cn/java/jvm/class-loading-process.html">https://javaguide.cn/java/jvm/class-loading-process.html</a></p><p><img src="/../assets/JVM/image-20231014215015858.png" alt="ä¸€ä¸ªç±»çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ"></p><h3 id="åŠ è½½"><a href="#åŠ è½½" class="headerlink" title="åŠ è½½"></a>åŠ è½½</h3><p>å°†ç±»çš„å­—èŠ‚ç è½½å…¥æ–¹æ³•åŒºä¸­ï¼Œå†…éƒ¨é‡‡ç”¨C++çš„instanceKlassæè¿°Javaç±»ï¼Œå®ƒçš„é‡è¦fieldæœ‰</p><ol><li>_java_mirrorï¼šJavaçš„ç±»é•œåƒï¼Œä¾‹å¦‚å¯¹Stringæ¥è¯´ï¼Œå°±æ˜¯String.classï¼Œä½œç”¨æ˜¯æŠŠklassæš´éœ²ç»™Javaä½¿ç”¨</li><li>_superï¼šçˆ¶ç±»</li><li>_fieldsï¼šæˆå‘˜å˜é‡</li><li>_methodsï¼šæ–¹æ³•</li><li>_constantsï¼šå¸¸é‡æ± </li><li>_class_loaderï¼šç±»åŠ è½½å™¨</li><li>_vtableï¼šéœ€æ–¹å‘è¡¨</li><li>_itableï¼šæ¥å£æ–¹æ³•è¡¨</li></ol><ul><li>å¦‚æœè¿™ä¸ªç±»è¿˜æœ‰çˆ¶ç±»æ²¡æœ‰åŠ è½½ï¼Œå…ˆåŠ è½½çˆ¶ç±»</li><li>åŠ è½½å’Œé“¾æ¥å¯èƒ½æ˜¯äº¤æ›¿è¿è¡Œçš„</li></ul><blockquote><p>instanceKlassè¿™æ ·çš„<code>å…ƒæ•°æ®</code>æ˜¯å­˜å‚¨åœ¨æ–¹æ³•åŒºï¼ˆ1.8åæ˜¯åœ¨å…ƒç©ºé—´å†…ï¼‰ï¼Œä½†_java_mirroræ˜¯å­˜å‚¨åœ¨å †ä¸­</p></blockquote><p><img src="/../assets/JVM/image-20231018144014687.png" alt="image-20231018144014687"></p><h3 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h3><h4 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h4><ul><li>éªŒè¯ç±»æ˜¯å¦ç¬¦åˆJVMè§„èŒƒï¼Œå®‰å…¨æ€§æ£€æŸ¥</li></ul><h4 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h4><p>ä¸ºstaticå˜é‡åˆ†é…ç©ºé—´ï¼Œè®¾ç½®é»˜è®¤å€¼</p><ul><li>staticå˜é‡åˆ†é…ç©ºé—´å’Œèµ‹å€¼æ˜¯ä¸¤ä¸ªæ­¥éª¤ï¼Œåˆ†é…ç©ºé—´åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆï¼Œèµ‹å€¼åœ¨åˆå§‹åŒ–é˜¶æ®µå®Œæˆ</li><li>å¦‚æœstaticéå†æ˜¯finalçš„åŸºæœ¬ç±»å‹ä»¥åŠå­—ç¬¦ä¸²å¸¸é‡ï¼Œé‚£ä¹ˆç¼–è¯‘é˜¶æ®µå€¼å°±ç¡®å®šäº†ï¼Œèµ‹å€¼åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆ</li><li>å¦‚æœstaticéå†æ˜¯finalçš„ï¼Œä½†å±äºå¼•ç”¨ç±»å‹ï¼Œé‚£ä¹ˆèµ‹å€¼ä¹Ÿä¼šåœ¨åˆå§‹åŒ–é˜¶æ®µå®Œæˆ</li></ul><h4 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h4><p>å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨è§£æä¸ºç›´æ¥å¼•ç”¨</p><h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p>åˆå§‹åŒ–å³è°ƒç”¨<code>&lt;cinit&gt;()V</code> æ–¹æ³•ï¼Œè™šæ‹Ÿæœºuiä¿è¯è¿™ä¸ªç±»çš„<code>æ„é€ æ–¹æ³•</code>çš„çº¿ç¨‹å®‰å…¨</p><ul><li><p>å‘ç”Ÿçš„æ—¶æœºï¼šæ€»çš„æ¥è¯´ï¼Œç±»çš„åˆå§‹åŒ–æ˜¯æ‡’æƒ°çš„</p><ol><li><p>mainæ–¹æ³•æ‰€åœ¨çš„ç±»ï¼Œæ€»ä¼šè¢«é¦–å…ˆåˆå§‹åŒ–</p></li><li><p>é¦–æ¬¡è®¿é—®è¿™ä¸ªç±»çš„é™æ€å˜é‡æˆ–é™æ€æ–¹æ³•æ—¶ï¼Œä¼šè¿›è¡Œåˆå§‹åŒ–</p></li><li><p>å­ç±»åˆå§‹åŒ–ï¼Œå¦‚æœçˆ¶ç±»è¿˜æ²¡æœªåˆå§‹åŒ–ï¼Œåˆ™çˆ¶ç±»ä¹Ÿä¼šè¿›è¡Œåˆå§‹åŒ–</p></li><li><p>é»˜è®¤çš„Class.forNameä¼šå¯¼è‡´åˆå§‹åŒ–</p></li><li><p>newå¯¹è±¡ä¼šå¯¼è‡´åˆå§‹åŒ–</p></li></ol></li><li><p>ä¸ä¼šå¯¼è‡´ç±»åˆå§‹åŒ–çš„æƒ…å†µ</p><ol><li>è®¿é—®ç±»çš„ static final é™æ€å¸¸é‡ï¼ˆåŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸²ï¼‰ ä¸ä¼šè§¦å‘åˆå§‹åŒ–</li><li>è°ƒç”¨ç±»å¯¹è±¡.classä¸ä¼šè§¦å‘åˆå§‹åŒ–</li><li>ç±»åŠ è½½å™¨çš„loadClassæ–¹æ³•ä¸ä¼šè§¦å‘åˆå§‹åŒ–</li><li>Class.forNameçš„å‚æ•°2ä¸ºfalseæ—¶(initalize &#x3D; false)ï¼Œä¸ä¼šè§¦å‘åˆå§‹åŒ–</li></ol></li></ul><h2 id="ç±»åŠ è½½å™¨"><a href="#ç±»åŠ è½½å™¨" class="headerlink" title="ç±»åŠ è½½å™¨"></a>ç±»åŠ è½½å™¨</h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p><strong>èµ‹äºˆäº† Java ç±»å¯ä»¥è¢«åŠ¨æ€åŠ è½½åˆ° JVM ä¸­å¹¶æ‰§è¡Œçš„èƒ½åŠ›</strong></p><p>ç®€å•æ¥è¯´ï¼Œ<strong>ç±»åŠ è½½å™¨çš„ä¸»è¦ä½œç”¨å°±æ˜¯åŠ è½½ Java ç±»çš„å­—èŠ‚ç ï¼ˆ <code>.class</code> æ–‡ä»¶ï¼‰åˆ° JVM ä¸­ï¼ˆåœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ <code>Class</code> å¯¹è±¡ï¼‰ã€‚</strong></p><h3 id="ç±»åŠ è½½å™¨åŠ è½½è§„åˆ™"><a href="#ç±»åŠ è½½å™¨åŠ è½½è§„åˆ™" class="headerlink" title="ç±»åŠ è½½å™¨åŠ è½½è§„åˆ™"></a>ç±»åŠ è½½å™¨åŠ è½½è§„åˆ™</h3><p>JVM å¯åŠ¨çš„æ—¶å€™ï¼Œ<strong>å¹¶ä¸ä¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰çš„ç±»ï¼Œè€Œæ˜¯æ ¹æ®éœ€è¦å»åŠ¨æ€åŠ è½½</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¤§éƒ¨åˆ†ç±»åœ¨å…·ä½“ç”¨åˆ°çš„æ—¶å€™æ‰ä¼šå»åŠ è½½ï¼Œè¿™æ ·å¯¹å†…å­˜æ›´åŠ å‹å¥½ã€‚</p><p>å¯¹äºå·²ç»åŠ è½½çš„ç±»ä¼šè¢«æ”¾åœ¨ <code>ClassLoader</code> ä¸­ã€‚åœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šé¦–å…ˆåˆ¤æ–­å½“å‰ç±»æ˜¯å¦è¢«åŠ è½½è¿‡ã€‚å·²ç»è¢«åŠ è½½çš„ç±»ä¼šç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰ä¼šå°è¯•åŠ è½½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºä¸€ä¸ªç±»åŠ è½½å™¨æ¥è¯´ï¼Œç›¸åŒäºŒè¿›åˆ¶åç§°çš„ç±»åªä¼šè¢«åŠ è½½ä¸€æ¬¡ã€‚</p><h3 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h3><ul><li>ä»¥<code>JDK 8</code>ä¸ºä¾‹</li></ul><table><thead><tr><th align="center">åç§°</th><th align="center">ä¸­æ–‡å</th><th align="center">åŠ è½½å“ªçš„ç±»</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">Bootstrap ClassLoader</td><td align="center">å¯åŠ¨ç±»åŠ è½½å™¨</td><td align="center">JAVA_HOME&#x2F;jre&#x2F;lib</td><td align="center">æ— æ³•ç›´æ¥è®¿é—®</td></tr><tr><td align="center">Extension ClassLoader</td><td align="center">æ‰©å±•ç±»åŠ è½½å™¨</td><td align="center">JAVA_HOME&#x2F;jre&#x2F;lib&#x2F;ext</td><td align="center">ä¸Šçº§ä¸º Bootstrapï¼Œæ˜¾ç¤ºä¸º null</td></tr><tr><td align="center">Application ClassLoader</td><td align="center">åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨</td><td align="center">classpath</td><td align="center">ä¸Šçº§ä¸º Extension</td></tr><tr><td align="center">è‡ªå®šä¹‰ç±»åŠ è½½å™¨</td><td align="center"></td><td align="center">è‡ªå®šä¹‰ ä¸Šçº§ä¸º</td><td align="center">Application</td></tr></tbody></table><ul><li>å½“JVMéœ€è¦åŠ è½½ä¸€ä¸ªç±»æ—¶ï¼Œå®ƒä¼šé¦–å…ˆå§”æ‰˜çˆ¶ç±»åŠ è½½å™¨å»åŠ è½½è¿™ä¸ªç±»ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½è¿™ä¸ªç±»ï¼Œå°±ä¼šç”±å½“å‰ç±»åŠ è½½å™¨æ¥åŠ è½½ã€‚å¦‚æœæ‰€æœ‰çš„çˆ¶ç±»åŠ è½½å™¨éƒ½æ— æ³•åŠ è½½è¿™ä¸ªç±»ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸ã€‚</li></ul><h3 id="å¯åŠ¨ç±»åŠ è½½å™¨"><a href="#å¯åŠ¨ç±»åŠ è½½å™¨" class="headerlink" title="å¯åŠ¨ç±»åŠ è½½å™¨"></a><strong>å¯åŠ¨ç±»åŠ è½½å™¨</strong></h3><ul><li><p><code>Bootstrap ClassLoader</code>æ˜¯æ‰€æœ‰ç±»åŠ è½½å™¨ä¸­æœ€æ—©çš„ä¸€ä¸ªï¼Œè´Ÿè´£åŠ è½½JRE&#x2F;libä¸‹çš„æ ¸å¿ƒç±»åº“ï¼Œå¦‚java.lang.Objectã€java.lang.Stringç­‰ã€‚</p></li><li><p>è¾“å‡ºçš„ç»“æœæ˜¯nullï¼Œå› ä¸ºå¼•å¯¼ç±»åŠ è½½å™¨æ˜¯ç”±JVMçš„å®ç°è€…ç”¨C&#x2F;C++ç­‰è¯­è¨€ç¼–å†™çš„ï¼Œè€Œä¸æ˜¯ç”±Javaç¼–å†™çš„ã€‚åœ¨Javaè™šæ‹Ÿæœºçš„å®ç°ä¸­ï¼Œå¼•å¯¼ç±»åŠ è½½å™¨ä¸æ˜¯Javaå¯¹è±¡ï¼Œä¹Ÿæ²¡æœ‰å¯¹åº”çš„Javaç±»ï¼Œå› æ­¤å®ƒçš„ClassLoaderå±æ€§ä¸ºnullã€‚</p></li></ul><h3 id="åŒäº²å§”æ´¾æœºåˆ¶"><a href="#åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="åŒäº²å§”æ´¾æœºåˆ¶"></a>åŒäº²å§”æ´¾æœºåˆ¶</h3><h4 id="æ‰§è¡Œæµç¨‹-1"><a href="#æ‰§è¡Œæµç¨‹-1" class="headerlink" title="æ‰§è¡Œæµç¨‹"></a>æ‰§è¡Œæµç¨‹</h4><ul><li>æ‰€è°“åŒäº²å§”æ´¾æœºåˆ¶ï¼Œå°±æ˜¯æŒ‡è°ƒç”¨ç±»åŠ è½½å™¨çš„loadClassæ–¹æ³•æ—¶ï¼ŒæŸ¥æ‰¾ç±»çš„è§„åˆ™</li><li>ä»ä¸‹å¾€ä¸Šè¯¢é—®ï¼Œä»ä¸Šå¾€ä¸‹åŠ è½½</li><li><code>ClassLoader</code> ç±»ä½¿ç”¨å§”æ‰˜æ¨¡å‹æ¥æœç´¢ç±»å’Œèµ„æºã€‚</li><li>åŒäº²å§”æ´¾æ¨¡å‹è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ã€‚</li><li><code>ClassLoader</code> å®ä¾‹ä¼šåœ¨è¯•å›¾äº²è‡ªæŸ¥æ‰¾ç±»æˆ–èµ„æºä¹‹å‰ï¼Œå°†æœç´¢ç±»æˆ–èµ„æºçš„ä»»åŠ¡å§”æ‰˜ç»™å…¶çˆ¶ç±»åŠ è½½å™¨ã€‚</li></ul><p><img src="/../assets/JVM/image-20231018154518908.png" alt="image-20231018154518908"></p><p>åŒäº²å§”æ´¾æºç ç²¾ç®€åŒ–åçš„ä¸»è¦é€»è¾‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="type">boolean</span> resolve) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (getClassLoadingLock(name)) &#123;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½</span></span><br><span class="line">        Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœç±»æ²¡æœ‰è¢«åŠ è½½ï¼Œåˆ™å§”æ‰˜ç»™çˆ¶ClassLoaderåŠ è½½</span></span><br><span class="line">                <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">                    c = parent.loadClass(name, <span class="literal">false</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    c = findBootstrapClassOrNull(name);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœçˆ¶ClassLoaderåŠ è½½å¤±è´¥ï¼Œåˆ™åœ¨è‡ªèº«æŸ¥æ‰¾ç±»</span></span><br><span class="line">                c = findClass(name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">            resolveClass(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ğŸ”´ğŸŸ¡ğŸŸ¢ç®€å•æ€»ç»“ä¸€ä¸‹åŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹ï¼š</p><ul><li>åœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šé¦–å…ˆåˆ¤æ–­å½“å‰ç±»æ˜¯å¦è¢«åŠ è½½è¿‡ã€‚å·²ç»è¢«åŠ è½½çš„ç±»ä¼šç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰ä¼šå°è¯•åŠ è½½ï¼ˆæ¯ä¸ªçˆ¶ç±»åŠ è½½å™¨éƒ½ä¼šèµ°ä¸€éè¿™ä¸ªæµç¨‹ï¼‰ã€‚</li><li>ç±»åŠ è½½å™¨åœ¨è¿›è¡Œç±»åŠ è½½çš„æ—¶å€™ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼ˆè°ƒç”¨çˆ¶åŠ è½½å™¨ <code>loadClass()</code>æ–¹æ³•æ¥åŠ è½½ç±»ï¼‰ã€‚è¿™æ ·çš„è¯ï¼Œæ‰€æœ‰çš„è¯·æ±‚æœ€ç»ˆéƒ½ä¼šä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ <code>BootstrapClassLoader</code> ä¸­ã€‚</li><li>åªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½è¯·æ±‚ï¼ˆå®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼‰æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ï¼ˆè°ƒç”¨è‡ªå·±çš„ <code>findClass()</code> æ–¹æ³•æ¥åŠ è½½ç±»ï¼‰ã€‚</li><li>å¦‚æœå­ç±»åŠ è½½å™¨ä¹Ÿæ— æ³•åŠ è½½è¿™ä¸ªç±»ï¼Œé‚£ä¹ˆå®ƒä¼šæŠ›å‡ºä¸€ä¸ª <code>ClassNotFoundException</code> å¼‚å¸¸ã€‚</li></ul><h4 id="ğŸŒˆ-æ‹“å±•ä¸€ä¸‹ï¼š"><a href="#ğŸŒˆ-æ‹“å±•ä¸€ä¸‹ï¼š" class="headerlink" title="ğŸŒˆ æ‹“å±•ä¸€ä¸‹ï¼š"></a>ğŸŒˆ æ‹“å±•ä¸€ä¸‹ï¼š</h4><p><strong>JVM åˆ¤å®šä¸¤ä¸ª Java ç±»æ˜¯å¦ç›¸åŒçš„å…·ä½“è§„åˆ™</strong>ï¼šJVM ä¸ä»…è¦çœ‹ç±»çš„å…¨åæ˜¯å¦ç›¸åŒï¼Œè¿˜è¦çœ‹åŠ è½½æ­¤ç±»çš„ç±»åŠ è½½å™¨æ˜¯å¦ä¸€æ ·ã€‚åªæœ‰ä¸¤è€…éƒ½ç›¸åŒçš„æƒ…å†µï¼Œæ‰è®¤ä¸ºä¸¤ä¸ªç±»æ˜¯ç›¸åŒçš„ã€‚å³ä½¿ä¸¤ä¸ªç±»æ¥æºäºåŒä¸€ä¸ª <code>Class</code> æ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªè™šæ‹ŸæœºåŠ è½½ï¼Œåªè¦åŠ è½½å®ƒä»¬çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œé‚£è¿™ä¸¤ä¸ªç±»å°±å¿…å®šä¸ç›¸åŒã€‚</p><h4 id="åŒäº²å§”æ´¾æ¨¡å‹çš„å¥½å¤„"><a href="#åŒäº²å§”æ´¾æ¨¡å‹çš„å¥½å¤„" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å‹çš„å¥½å¤„"></a>åŒäº²å§”æ´¾æ¨¡å‹çš„å¥½å¤„</h4><p>åŒäº²å§”æ´¾æ¨¡å‹ä¿è¯äº† Java ç¨‹åºçš„ç¨³å®šè¿è¡Œï¼Œå¯ä»¥é¿å…ç±»çš„é‡å¤åŠ è½½ï¼ˆJVM åŒºåˆ†ä¸åŒç±»çš„æ–¹å¼ä¸ä»…ä»…æ ¹æ®ç±»åï¼Œç›¸åŒçš„ç±»æ–‡ä»¶è¢«ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½äº§ç”Ÿçš„æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»ï¼‰ï¼Œä¹Ÿä¿è¯äº† Java çš„æ ¸å¿ƒ API ä¸è¢«ç¯¡æ”¹ã€‚</p><p>å¦‚æœæ²¡æœ‰ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹ï¼Œè€Œæ˜¯æ¯ä¸ªç±»åŠ è½½å™¨åŠ è½½è‡ªå·±çš„è¯å°±ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç§°ä¸º <code>java.lang.Object</code> ç±»çš„è¯ï¼Œé‚£ä¹ˆç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œç³»ç»Ÿå°±ä¼šå‡ºç°ä¸¤ä¸ªä¸åŒçš„ <code>Object</code> ç±»ã€‚åŒäº²å§”æ´¾æ¨¡å‹å¯ä»¥ä¿è¯åŠ è½½çš„æ˜¯ JRE é‡Œçš„é‚£ä¸ª <code>Object</code> ç±»ï¼Œè€Œä¸æ˜¯ä½ å†™çš„ <code>Object</code> ç±»ã€‚è¿™æ˜¯å› ä¸º <code>AppClassLoader</code> åœ¨åŠ è½½ä½ çš„ <code>Object</code> ç±»æ—¶ï¼Œä¼šå§”æ‰˜ç»™ <code>ExtClassLoader</code> å»åŠ è½½ï¼Œè€Œ <code>ExtClassLoader</code> åˆä¼šå§”æ‰˜ç»™ <code>BootstrapClassLoader</code>ï¼Œ<code>BootstrapClassLoader</code> å‘ç°è‡ªå·±å·²ç»åŠ è½½è¿‡äº† <code>Object</code> ç±»ï¼Œä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå»åŠ è½½ä½ å†™çš„ <code>Object</code> ç±»ã€‚</p><h3 id="çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨"><a href="#çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨" class="headerlink" title="çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨"></a>çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨</h3><p>è¿‡ç¨‹å°±æ˜¯ï¼šå¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½DriverManagerï¼ŒDriverManagerä»£ç é‡Œè°ƒç”¨äº†çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œè¿™ä¸ªåŠ è½½å™¨é»˜è®¤å°±æ˜¯ä½¿ç”¨åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨åŠ è½½ç±»ï¼Œé€šè¿‡åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨åŠ è½½jdbcé©±åŠ¨</p><p>å…·ä½“å‚è€ƒ<a href="https://javaguide.cn/java/jvm/classloader.html">https://javaguide.cn/java/jvm/classloader.html</a></p><h3 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"><a href="#è‡ªå®šä¹‰ç±»åŠ è½½å™¨" class="headerlink" title="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"></a>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h3><p>æš‚æ—¶ä¸å­¦è¿™ä¸ªäº†â€¦â€¦.å¾…è¡¥å……</p><p>å…·ä½“å‚è€ƒ<a href="https://javaguide.cn/java/jvm/classloader.html">https://javaguide.cn/java/jvm/classloader.html</a></p><h2 id="è¿è¡ŒæœŸä¼˜åŒ–"><a href="#è¿è¡ŒæœŸä¼˜åŒ–" class="headerlink" title="è¿è¡ŒæœŸä¼˜åŒ–"></a>è¿è¡ŒæœŸä¼˜åŒ–</h2><p>æ²¡å¬æ‡‚â€¦â€¦â€¦â€¦.ï¼ˆåç»­å¾…è¡¥å……äº†ï¼‰</p><h1 id="å†…å­˜æ¨¡å‹"><a href="#å†…å­˜æ¨¡å‹" class="headerlink" title="å†…å­˜æ¨¡å‹"></a>å†…å­˜æ¨¡å‹</h1><p>ç®€å•çš„è¯´ï¼ŒJMM å®šä¹‰äº†ä¸€å¥—åœ¨å¤šçº¿ç¨‹è¯»å†™å…±äº«æ•°æ®æ—¶ï¼ˆæˆå‘˜å˜é‡ã€æ•°ç»„ï¼‰æ—¶ï¼Œå¯¹æ•°æ®çš„å¯è§æ€§ã€æœ‰åº<br>æ€§ã€å’ŒåŸå­æ€§çš„è§„åˆ™å’Œä¿éšœ</p>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisç›¸å…³çŸ¥è¯†</title>
      <link href="/2023/08/03/Study-Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/"/>
      <url>/2023/08/03/Study-Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æ–‡ç« å‚è€ƒè‡ªï¼š</p><p><a href="https://xiaolincoding.com/redis/">å°æ—coding</a></p><p><a href="https://www.bilibili.com/video/BV1Rv41177Af">å°šç¡…è°·Redis6æ•™ç¨‹</a></p><p><a href="https://www.bilibili.com/video/BV1cr4y1671t">é»‘é©¬ç¨‹åºå‘˜Rediså…¥é—¨åˆ°å®æˆ˜æ•™ç¨‹</a></p><p><a href="https://zhangc233.github.io/2021/05/02/Redis/">https://zhangc233.github.io/2021/05/02/Redis/</a></p><h1 id="RedisåŸºç¡€çŸ¥è¯†"><a href="#RedisåŸºç¡€çŸ¥è¯†" class="headerlink" title="RedisåŸºç¡€çŸ¥è¯†"></a>RedisåŸºç¡€çŸ¥è¯†</h1><h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨Redis"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨Redis" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨Redis"></a>ä¸ºä»€ä¹ˆä½¿ç”¨Redis</h2><p>å½“è¿‡å¤šç”¨æˆ·åŒæ—¶è®¿é—®æ•°æ®åº“æ—¶å‹åŠ›ä¼šå¾ˆå¤§ï¼Œè¿™æ ·ä¼šå¯¼è‡´åœ¨è®¿é—®æ•°æ®çš„æ—¶å€™é€Ÿåº¦å¾ˆæ…¢ï¼Œä½¿å¾—ç”¨æˆ·åœ¨ä½“éªŒçš„æ—¶å€™å“åº”å¾ˆæ…¢ä»è€Œé™ä½äº†ç”¨æˆ·ä½“éªŒï¼Œè€Œ<code>Redis</code>è¿™ç§æ— å…³ç³»å‹æ•°æ®åº“æ˜¯åŸºäºå†…å­˜çš„ï¼Œå¯ä»¥è¾ƒå¿«å»è¿›è¡Œè®¿é—®æ•°æ®ï¼Œä½†æ¯•ç«Ÿå†…å­˜æ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯å› ä¸ºå®ƒè®¿é—®å¿«è€Œå…¨éƒ¨ä½¿ç”¨è¿™ç§<code>NoSQL</code>æ•°æ®åº“ï¼Œå®ƒä¸<code>MySQL</code><mark>è¿™ç§å…³ç³»å‹æ•°æ®åº“ä¹‹é—´æ˜¯ç›¸äº’åˆä½œçš„</mark>ï¼Œå…±åŒå®Œæˆä»»åŠ¡çš„ã€‚</p><h2 id="Redis-å’Œ-Memcached-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#Redis-å’Œ-Memcached-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="Redis å’Œ Memcached æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>Redis å’Œ Memcached æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2><p>å¾ˆå¤šäººéƒ½è¯´ç”¨ Redis ä½œä¸ºç¼“å­˜ï¼Œä½†æ˜¯ Memcached ä¹Ÿæ˜¯åŸºäºå†…å­˜çš„æ•°æ®åº“ï¼Œä¸ºä»€ä¹ˆä¸é€‰æ‹©å®ƒä½œä¸ºç¼“å­˜å‘¢ï¼Ÿè¦è§£ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±è¦å¼„æ¸…æ¥š Redis å’Œ Memcached çš„åŒºåˆ«ã€‚ Redis ä¸ Memcached <strong>å…±åŒç‚¹</strong>ï¼š</p><ol><li>éƒ½æ˜¯åŸºäºå†…å­˜çš„æ•°æ®åº“ï¼Œä¸€èˆ¬éƒ½ç”¨æ¥å½“åšç¼“å­˜ä½¿ç”¨ã€‚</li><li>éƒ½æœ‰è¿‡æœŸç­–ç•¥ã€‚</li><li>ä¸¤è€…çš„æ€§èƒ½éƒ½éå¸¸é«˜ã€‚</li></ol><p>Redis ä¸ Memcached <strong>åŒºåˆ«</strong>ï¼š</p><ul><li>Redis æ”¯æŒçš„æ•°æ®ç±»å‹æ›´ä¸°å¯Œï¼ˆStringã€Hashã€Listã€Setã€ZSetï¼‰ï¼Œè€Œ Memcached åªæ”¯æŒæœ€ç®€å•çš„ key-value æ•°æ®ç±»å‹ï¼›</li><li>Redis æ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿æŒåœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨ï¼Œè€Œ Memcached æ²¡æœ‰æŒä¹…åŒ–åŠŸèƒ½ï¼Œæ•°æ®å…¨éƒ¨å­˜åœ¨å†…å­˜ä¹‹ä¸­ï¼ŒMemcached é‡å¯æˆ–è€…æŒ‚æ‰åï¼Œæ•°æ®å°±æ²¡äº†ï¼›</li><li>Redis åŸç”Ÿæ”¯æŒé›†ç¾¤æ¨¡å¼ï¼ŒMemcached æ²¡æœ‰åŸç”Ÿçš„é›†ç¾¤æ¨¡å¼ï¼Œéœ€è¦ä¾é å®¢æˆ·ç«¯æ¥å®ç°å¾€é›†ç¾¤ä¸­åˆ†ç‰‡å†™å…¥æ•°æ®ï¼›</li><li>Redis æ”¯æŒå‘å¸ƒè®¢é˜…æ¨¡å‹ã€Lua è„šæœ¬ã€äº‹åŠ¡ç­‰åŠŸèƒ½ï¼Œè€Œ Memcached ä¸æ”¯æŒï¼›</li></ul><hr><h2 id="ä¸ºä»€ä¹ˆç”¨RedisåšMySQLçš„ç¼“å­˜ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆç”¨RedisåšMySQLçš„ç¼“å­˜ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆç”¨RedisåšMySQLçš„ç¼“å­˜ï¼Ÿ"></a>ä¸ºä»€ä¹ˆç”¨RedisåšMySQLçš„ç¼“å­˜ï¼Ÿ</h2><p>Redis å…·å¤‡ã€Œ<strong>é«˜æ€§èƒ½</strong>ã€å’Œã€Œ<strong>é«˜å¹¶å‘</strong>ã€ä¸¤ç§ç‰¹æ€§</p><h1 id="Redisç½‘ç»œæ¨¡å‹"><a href="#Redisç½‘ç»œæ¨¡å‹" class="headerlink" title="Redisç½‘ç»œæ¨¡å‹"></a>Redisç½‘ç»œæ¨¡å‹</h1><h2 id="äº”ç§IOæ¨¡å‹"><a href="#äº”ç§IOæ¨¡å‹" class="headerlink" title="äº”ç§IOæ¨¡å‹"></a>äº”ç§IOæ¨¡å‹</h2><h3 id="é˜»å¡IO"><a href="#é˜»å¡IO" class="headerlink" title="é˜»å¡IO"></a>é˜»å¡IO</h3><p>åº”ç”¨ç¨‹åºæƒ³è¦å»è¯»å–æ•°æ®ï¼Œä»–æ˜¯æ— æ³•ç›´æ¥å»è¯»å–ç£ç›˜æ•°æ®çš„ï¼Œä»–éœ€è¦å…ˆåˆ°å†…æ ¸é‡Œè¾¹å»ç­‰å¾…å†…æ ¸æ“ä½œç¡¬ä»¶æ‹¿åˆ°æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯1ï¼Œæ˜¯éœ€è¦ç­‰å¾…çš„ï¼Œç­‰åˆ°å†…æ ¸ä»ç£ç›˜ä¸ŠæŠŠæ•°æ®åŠ è½½å‡ºæ¥ä¹‹åï¼Œå†æŠŠè¿™ä¸ªæ•°æ®å†™ç»™ç”¨æˆ·çš„ç¼“å­˜åŒºï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯2ï¼Œå¦‚æœæ˜¯é˜»å¡IOï¼Œé‚£ä¹ˆæ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·ä»å‘èµ·è¯»è¯·æ±‚å¼€å§‹ï¼Œä¸€ç›´åˆ°è¯»å–åˆ°æ•°æ®ï¼Œéƒ½æ˜¯ä¸€ä¸ªé˜»å¡çŠ¶æ€ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/1653897115346.png" alt="1653897115346"></p><p>å…·ä½“æµç¨‹å¦‚ä¸‹å›¾ï¼š</p><p>ç”¨æˆ·å»è¯»å–æ•°æ®æ—¶ï¼Œä¼šå»å…ˆå‘èµ·recvformä¸€ä¸ªå‘½ä»¤ï¼Œå»å°è¯•ä»å†…æ ¸ä¸ŠåŠ è½½æ•°æ®ï¼Œå¦‚æœå†…æ ¸æ²¡æœ‰æ•°æ®ï¼Œé‚£ä¹ˆç”¨æˆ·å°±ä¼šç­‰å¾…ï¼Œæ­¤æ—¶å†…æ ¸ä¼šå»ä»ç¡¬ä»¶ä¸Šè¯»å–æ•°æ®ï¼Œå†…æ ¸è¯»å–æ•°æ®ä¹‹åï¼Œä¼šæŠŠæ•°æ®æ‹·è´åˆ°ç”¨æˆ·æ€ï¼Œå¹¶ä¸”è¿”å›okï¼Œæ•´ä¸ªè¿‡ç¨‹ï¼Œéƒ½æ˜¯é˜»å¡ç­‰å¾…çš„ï¼Œè¿™å°±æ˜¯é˜»å¡IO</p><p>æ€»ç»“å¦‚ä¸‹ï¼š</p><p>é¡¾åæ€ä¹‰ï¼Œé˜»å¡IOå°±æ˜¯ä¸¤ä¸ªé˜¶æ®µéƒ½å¿…é¡»é˜»å¡ç­‰å¾…ï¼š</p><p><strong>é˜¶æ®µä¸€ï¼š</strong></p><ul><li>ç”¨æˆ·è¿›ç¨‹å°è¯•è¯»å–æ•°æ®ï¼ˆæ¯”å¦‚ç½‘å¡æ•°æ®ï¼‰</li><li>æ­¤æ—¶æ•°æ®å°šæœªåˆ°è¾¾ï¼Œå†…æ ¸éœ€è¦ç­‰å¾…æ•°æ®</li><li>æ­¤æ—¶ç”¨æˆ·è¿›ç¨‹ä¹Ÿå¤„äºé˜»å¡çŠ¶æ€</li></ul><p>é˜¶æ®µäºŒï¼š</p><ul><li>æ•°æ®åˆ°è¾¾å¹¶æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œä»£è¡¨å·²å°±ç»ª</li><li>å°†å†…æ ¸æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒº</li><li>æ‹·è´è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·è¿›ç¨‹ä¾ç„¶é˜»å¡ç­‰å¾…</li><li>æ‹·è´å®Œæˆï¼Œç”¨æˆ·è¿›ç¨‹è§£é™¤é˜»å¡ï¼Œå¤„ç†æ•°æ®</li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œé˜»å¡IOæ¨¡å‹ä¸­ï¼Œç”¨æˆ·è¿›ç¨‹åœ¨ä¸¤ä¸ªé˜¶æ®µéƒ½æ˜¯é˜»å¡çŠ¶æ€ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/1653897270074.png" alt="1653897270074"></p><h3 id="éé˜»å¡IO"><a href="#éé˜»å¡IO" class="headerlink" title="éé˜»å¡IO"></a>éé˜»å¡IO</h3><p>å¯ä»¥çœ‹åˆ°ï¼Œéé˜»å¡IOæ¨¡å‹ä¸­ï¼Œç”¨æˆ·è¿›ç¨‹åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µæ˜¯éé˜»å¡ï¼Œç¬¬äºŒä¸ªé˜¶æ®µæ˜¯é˜»å¡çŠ¶æ€ã€‚è™½ç„¶æ˜¯éé˜»å¡ï¼Œä½†æ€§èƒ½å¹¶æ²¡æœ‰å¾—åˆ°æé«˜ã€‚è€Œä¸”å¿™ç­‰æœºåˆ¶ä¼šå¯¼è‡´CPUç©ºè½¬ï¼ŒCPUä½¿ç”¨ç‡æš´å¢ã€‚</p><blockquote><p>è·Ÿé˜»å¡IOç›¸æ¯”ï¼Œå°±æ˜¯ç¬¬ä¸€é˜¶æ®µå°è¯•è¯»æ•°æ®æ—¶ï¼Œå‰è€…æ˜¯ç­‰å¾…ï¼Œåè€…æ˜¯<mark>ä¸€ç›´è¯¢é—®</mark></p></blockquote><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/1653897490116.png" alt="1653897490116"></p><h3 id="â­â­â­å¤šè·¯IOå¤ç”¨"><a href="#â­â­â­å¤šè·¯IOå¤ç”¨" class="headerlink" title="â­â­â­å¤šè·¯IOå¤ç”¨"></a>â­â­â­å¤šè·¯IOå¤ç”¨</h3><p>è§£å†³å¤šè·¯å¤ç”¨æ¨¡å‹æ˜¯<mark>å¦‚ä½•çŸ¥é“å†…æ ¸æ•°æ®æ˜¯å¦å°±ç»ª</mark>çš„é—®é¢˜äº†</p><p>è¿™ä¸ªé—®é¢˜çš„è§£å†³ä¾èµ–äºæå‡ºçš„ï¼š</p><p><strong>æ–‡ä»¶æè¿°ç¬¦ï¼ˆFile Descriptorï¼‰</strong>ï¼šç®€ç§°FDï¼Œæ˜¯ä¸€ä¸ªä»0 å¼€å§‹çš„æ— ç¬¦å·æ•´æ•°ï¼Œç”¨æ¥å…³è”Linuxä¸­çš„ä¸€ä¸ªæ–‡ä»¶ã€‚åœ¨Linuxä¸­ï¼Œä¸€åˆ‡çš†æ–‡ä»¶ï¼Œä¾‹å¦‚å¸¸è§„æ–‡ä»¶ã€è§†é¢‘ã€ç¡¬ä»¶è®¾å¤‡ç­‰ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬ç½‘ç»œå¥—æ¥å­—ï¼ˆSocketï¼‰ã€‚</p><p>é€šè¿‡FDï¼Œæˆ‘ä»¬çš„ç½‘ç»œæ¨¡å‹å¯ä»¥åˆ©ç”¨ä¸€ä¸ªçº¿ç¨‹ç›‘å¬å¤šä¸ªFDï¼Œå¹¶åœ¨æŸä¸ªFDå¯è¯»ã€å¯å†™æ—¶å¾—åˆ°é€šçŸ¥ï¼Œä»è€Œé¿å…æ— æ•ˆçš„ç­‰å¾…ï¼Œå……åˆ†åˆ©ç”¨CPUèµ„æºã€‚</p><p>é˜¶æ®µä¸€ï¼š</p><ul><li>ç”¨æˆ·è¿›ç¨‹è°ƒç”¨selectï¼ŒæŒ‡å®šè¦ç›‘å¬çš„FDé›†åˆ</li><li>æ ¸ç›‘å¬FDå¯¹åº”çš„å¤šä¸ªsocket</li><li>ä»»æ„ä¸€ä¸ªæˆ–å¤šä¸ªsocketæ•°æ®å°±ç»ªåˆ™è¿”å›readable</li><li>æ­¤è¿‡ç¨‹ä¸­ç”¨æˆ·è¿›ç¨‹é˜»å¡</li></ul><p>é˜¶æ®µäºŒï¼š</p><ul><li>ç”¨æˆ·è¿›ç¨‹æ‰¾åˆ°å°±ç»ªçš„socket</li><li>ä¾æ¬¡è°ƒç”¨recvfromè¯»å–æ•°æ®</li><li>å†…æ ¸å°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´</li><li>ç”¨æˆ·è¿›ç¨‹å¤„ç†æ•°æ®</li></ul><p>å½“ç”¨æˆ·å»è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œä¸å†å»ç›´æ¥è°ƒç”¨recvfromäº†ï¼Œè€Œæ˜¯è°ƒç”¨selectçš„å‡½æ•°ï¼Œselectå‡½æ•°ä¼šå°†éœ€è¦ç›‘å¬çš„æ•°æ®äº¤ç»™å†…æ ¸ï¼Œç”±å†…æ ¸å»æ£€æŸ¥è¿™äº›æ•°æ®æ˜¯å¦å°±ç»ªäº†ï¼Œå¦‚æœè¯´è¿™ä¸ªæ•°æ®å°±ç»ªäº†ï¼Œå°±ä¼šé€šçŸ¥åº”ç”¨ç¨‹åºæ•°æ®å°±ç»ªï¼Œç„¶åæ¥è¯»å–æ•°æ®ï¼Œå†ä»å†…æ ¸ä¸­æŠŠæ•°æ®æ‹·è´ç»™ç”¨æˆ·æ€ï¼Œå®Œæˆæ•°æ®å¤„ç†ï¼Œå¦‚æœNå¤šä¸ªFDä¸€ä¸ªéƒ½æ²¡å¤„ç†å®Œï¼Œæ­¤æ—¶å°±è¿›è¡Œç­‰å¾…ã€‚</p><p>ç”¨IOå¤ç”¨æ¨¡å¼ï¼Œå¯ä»¥ç¡®ä¿å»è¯»æ•°æ®çš„æ—¶å€™ï¼Œæ•°æ®æ˜¯ä¸€å®šå­˜åœ¨çš„ï¼Œä»–çš„æ•ˆç‡æ¯”åŸæ¥çš„é˜»å¡IOå’Œéé˜»å¡IOæ€§èƒ½éƒ½è¦é«˜</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/1653898691736.png" alt="1653898691736"></p><p>IOå¤šè·¯å¤ç”¨æ˜¯åˆ©ç”¨å•ä¸ªçº¿ç¨‹æ¥åŒæ—¶ç›‘å¬å¤šä¸ªFDï¼Œå¹¶åœ¨æŸä¸ªFDå¯è¯»ã€å¯å†™æ—¶å¾—åˆ°é€šçŸ¥ï¼Œä»è€Œé¿å…æ— æ•ˆçš„ç­‰å¾…ï¼Œå……åˆ†åˆ©ç”¨CPUèµ„æºã€‚ä¸è¿‡ç›‘å¬FDçš„æ–¹å¼ã€é€šçŸ¥çš„æ–¹å¼åˆæœ‰å¤šç§å®ç°ï¼Œå¸¸è§çš„æœ‰ï¼š</p><ul><li>select</li><li>poll</li><li>epoll</li></ul><p>å…¶ä¸­selectå’Œpollç›¸å½“äºæ˜¯å½“è¢«ç›‘å¬çš„æ•°æ®å‡†å¤‡å¥½ä¹‹åï¼Œä»–ä¼šæŠŠä½ ç›‘å¬çš„FDæ•´ä¸ªæ•°æ®éƒ½å‘ç»™ä½ ï¼Œä½ éœ€è¦åˆ°æ•´ä¸ªFDä¸­å»æ‰¾ï¼Œå“ªäº›æ˜¯å¤„ç†å¥½äº†çš„ï¼Œéœ€è¦é€šè¿‡éå†çš„æ–¹å¼ï¼Œæ‰€ä»¥æ€§èƒ½ä¹Ÿå¹¶ä¸æ˜¯é‚£ä¹ˆå¥½</p><p>è€Œepollï¼Œåˆ™ç›¸å½“äºå†…æ ¸å‡†å¤‡å¥½äº†ä¹‹åï¼Œä»–ä¼šæŠŠå‡†å¤‡å¥½çš„æ•°æ®ï¼Œç›´æ¥å‘ç»™ä½ ï¼Œå’±ä»¬å°±çœå»äº†éå†çš„åŠ¨ä½œã€‚</p><h4 id="select"><a href="#select" class="headerlink" title="select"></a>select</h4><p>å…·ä½“æµç¨‹ï¼š</p><p>ç®€å•è¯´ï¼Œå°±æ˜¯æˆ‘ä»¬æŠŠéœ€è¦å¤„ç†çš„<mark>æ•°æ®å°è£…æˆFD</mark>ï¼Œç„¶å<mark>åœ¨ç”¨æˆ·æ€æ—¶åˆ›å»ºä¸€ä¸ªfdçš„é›†åˆ</mark>ï¼ˆè¿™ä¸ªé›†åˆçš„å¤§å°æ˜¯è¦ç›‘å¬çš„é‚£ä¸ªFDçš„æœ€å¤§å€¼+1ï¼Œä½†æ˜¯å¤§å°æ•´ä½“æ˜¯æœ‰é™åˆ¶çš„ ï¼‰ï¼Œè¿™ä¸ªé›†åˆçš„é•¿åº¦å¤§å°æ˜¯æœ‰é™åˆ¶çš„ï¼ŒåŒæ—¶åœ¨è¿™ä¸ªé›†åˆä¸­ï¼Œæ ‡æ˜å‡ºæ¥æˆ‘ä»¬è¦æ§åˆ¶å“ªäº›æ•°æ®ï¼Œ</p><p>æ¯”å¦‚è¦ç›‘å¬çš„æ•°æ®ï¼Œæ˜¯1,2,5ä¸‰ä¸ªæ•°æ®ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œselectå‡½æ•°ï¼Œç„¶å<mark>å°†æ•´ä¸ªfdå‘ç»™å†…æ ¸æ€</mark>ï¼Œå†…æ ¸æ€ä¼šå»éå†ç”¨æˆ·æ€ä¼ é€’è¿‡æ¥çš„æ•°æ®ï¼Œå¦‚æœå‘ç°è¿™é‡Œè¾¹éƒ½æ•°æ®éƒ½æ²¡æœ‰å°±ç»ªï¼Œå°±ä¼‘çœ ï¼Œç›´åˆ°æœ‰æ•°æ®å‡†å¤‡å¥½æ—¶ï¼Œå°±ä¼šè¢«å”¤é†’ï¼Œå”¤é†’ä¹‹åï¼Œå†æ¬¡éå†ä¸€éï¼Œçœ‹çœ‹è°å‡†å¤‡å¥½äº†ï¼Œç„¶åå†å°†å¤„ç†æ‰æ²¡æœ‰å‡†å¤‡å¥½çš„æ•°æ®ï¼Œæœ€åå†<mark>å°†è¿™ä¸ªFDé›†åˆå†™å›åˆ°ç”¨æˆ·æ€</mark>ä¸­å»ï¼Œæ­¤æ—¶ç”¨æˆ·æ€å°±çŸ¥é“äº†ï¼Œå¥¥ï¼Œæœ‰äººå‡†å¤‡å¥½äº†ï¼Œä½†æ˜¯å¯¹äºç”¨æˆ·æ€è€Œè¨€ï¼Œå¹¶ä¸çŸ¥é“è°å¤„ç†å¥½äº†ï¼Œæ‰€ä»¥<mark>ç”¨æˆ·æ€ä¹Ÿéœ€è¦å»è¿›è¡Œéå†</mark>ï¼Œç„¶åæ‰¾åˆ°å¯¹åº”å‡†å¤‡å¥½æ•°æ®çš„èŠ‚ç‚¹ï¼Œå†å»å‘èµ·è¯»è¯·æ±‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231106173311672.png" alt="selectæ¨¡å¼"></p><p>selectæ¨¡å¼å­˜åœ¨ä¸‰ä¸ªé—®é¢˜ï¼š</p><ol><li><p>éœ€è¦å°†<mark>æ•´ä¸ª</mark>fd_setä»ç”¨æˆ·ç©ºé—´æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼Œselectç»“æŸè¿˜è¦å†æ¬¡æ‹·è´å›ç”¨æˆ·ç©ºé—´</p></li><li><p>selectæ— æ³•å¾—çŸ¥å…·ä½“æ˜¯å“ªä¸ªfdå°±ç»ªï¼Œéœ€è¦<mark>éå†æ•´ä¸ª</mark>fd_set</p></li><li><p>fd_setç›‘å¬çš„fd<mark>æ•°é‡ä¸èƒ½è¶…è¿‡</mark>1024</p></li></ol><h4 id="poll"><a href="#poll" class="headerlink" title="poll"></a>poll</h4><p><strong>ä¸selectå¯¹æ¯”ï¼š</strong></p><ul><li>selectæ¨¡å¼ä¸­çš„fd_setå¤§å°å›ºå®šä¸º1024ï¼Œè€Œpollfdåœ¨å†…æ ¸ä¸­<mark>é‡‡ç”¨é“¾è¡¨</mark>ï¼Œç†è®ºä¸Šæ— ä¸Šé™</li><li>ç›‘å¬FDè¶Šå¤šï¼Œæ¯æ¬¡éå†æ¶ˆè€—æ—¶é—´ä¹Ÿè¶Šä¹…ï¼Œæ€§èƒ½åè€Œä¼šä¸‹é™ï¼Œæ‰€ä»¥å…¶å®æ˜¯æœ‰ä¸Šé™çš„</li></ul><h4 id="epoll"><a href="#epoll" class="headerlink" title="epoll"></a>epoll</h4><p>epollæ¨¡å¼æ˜¯å¯¹selectå’Œpollçš„æ”¹è¿›ï¼Œå®ƒæä¾›äº†ä¸‰ä¸ªå‡½æ•°ï¼š</p><p>ç¬¬ä¸€ä¸ªæ˜¯ï¼š<code>eventpoll</code>çš„å‡½æ•°ï¼Œä»–å†…éƒ¨åŒ…å«ä¸¤ä¸ªç»“æ„ï¼š</p><ol><li><p>çº¢é»‘æ ‘ï¼ˆrb_rootï¼‰-&gt; è®°å½•çš„äº‹è¦ç›‘å¬çš„FD</p></li><li><p>é“¾è¡¨ï¼ˆlist_headï¼‰-&gt;ä¸€ä¸ªé“¾è¡¨ï¼Œè®°å½•çš„æ˜¯å°±ç»ªçš„FD</p></li></ol><p>ç¬¬äºŒä¸ªæ˜¯ï¼šç´§æ¥ç€è°ƒç”¨<code>epoll_ctl</code>æ“ä½œï¼Œå°†è¦ç›‘å¬çš„æ•°æ®æ·»åŠ åˆ°çº¢é»‘æ ‘ä¸Šå»ï¼Œå¹¶ä¸”ç»™æ¯ä¸ªfdè®¾ç½®ä¸€ä¸ªç›‘å¬å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨fdæ•°æ®å°±ç»ªæ—¶è§¦å‘ï¼Œå°±æ˜¯å‡†å¤‡å¥½äº†ï¼Œç°åœ¨å°±æŠŠfdæŠŠæ•°æ®æ·»åŠ åˆ°list_headä¸­å»</p><p>ç¬¬ä¸‰ä¸ªæ˜¯ï¼šè°ƒç”¨<code>epoll_wait</code>å‡½æ•°ï¼ˆç›‘å¬å‡½æ•°ï¼‰</p><p>å°±å»ç­‰å¾…ï¼Œåœ¨ç”¨æˆ·æ€åˆ›å»ºä¸€ä¸ªç©ºçš„eventsæ•°ç»„ï¼Œå½“å°±ç»ªä¹‹åï¼Œæˆ‘ä»¬çš„å›è°ƒå‡½æ•°ä¼šæŠŠæ•°æ®æ·»åŠ åˆ°list_headä¸­å»ï¼Œå½“è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œä¼šå»æ£€æŸ¥list_headï¼Œå½“ç„¶è¿™ä¸ªè¿‡ç¨‹éœ€è¦å‚è€ƒé…ç½®çš„ç­‰å¾…æ—¶é—´ï¼Œå¯ä»¥ç­‰ä¸€å®šæ—¶é—´ï¼Œä¹Ÿå¯ä»¥ä¸€ç›´ç­‰ï¼Œ å¦‚æœåœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œæ£€æŸ¥åˆ°äº†list_headä¸­æœ‰æ•°æ®ä¼šå°†æ•°æ®æ·»åŠ åˆ°é“¾è¡¨ä¸­ï¼Œæ­¤æ—¶å°†æ•°æ®æ”¾å…¥åˆ°eventsæ•°ç»„ä¸­ï¼Œå¹¶ä¸”è¿”å›å¯¹åº”çš„æ“ä½œçš„æ•°é‡ï¼Œç”¨æˆ·æ€çš„æ­¤æ—¶æ”¶åˆ°å“åº”åï¼Œä»eventsä¸­æ‹¿åˆ°å¯¹åº”å‡†å¤‡å¥½çš„æ•°æ®çš„èŠ‚ç‚¹ï¼Œå†å»è°ƒç”¨æ–¹æ³•å»æ‹¿æ•°æ®ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231106174435434.png" alt="epollæ¨¡å¼"></p><p>ä¼˜åŠ¿ï¼š<em>ï¼ˆå¯¹åº”çš„æ˜¯selectçš„ä¸‰ä¸ªç¼ºç‚¹ï¼‰</em></p><ol><li><p>å‡å°‘äº†FDçš„æ‹·è´ï¼Œselectå’Œpolléƒ½æ˜¯æ¯æ¬¡éƒ½è¦é‡æ–°æŠŠå…¨éƒ¨çš„FDå†æ‹·è´åˆ°å†…æ ¸æ€ï¼Œè€Œepollæ¯æ¬¡åªéœ€è¦æ‹·è´æ–°æ¥çš„FDåˆ°å†…æ ¸æ€ä¸­</p></li><li><p>ä»å†…æ ¸æ€æ‹·è´FDåˆ°ç”¨æˆ·æ€æ—¶ï¼Œä¸å†æ˜¯æŠŠå…¨éƒ¨çš„FDæ‹·è´åˆ°ç”¨æˆ·æ€ï¼Œè€Œæ˜¯åªæŠŠå°±ç»ªé“¾è¡¨ä¸Šçš„FDæ‹·è´å›å†…æ ¸æ€</p></li><li><p>å¯ä»¥å°½å¯èƒ½å¤šåœ°ç›‘å¬FDçš„æ•°é‡ï¼Œå› ä¸ºçº¢é»‘æ ‘å¢åŠ å†å¤šç»“ç‚¹ä¹Ÿä¸ä¼šå½±å“å…¶æ€§èƒ½</p></li></ol><h4 id="ä¸‰ç§æ¨¡å¼çš„å¯¹æ¯”ä¸æ€»ç»“"><a href="#ä¸‰ç§æ¨¡å¼çš„å¯¹æ¯”ä¸æ€»ç»“" class="headerlink" title="ä¸‰ç§æ¨¡å¼çš„å¯¹æ¯”ä¸æ€»ç»“"></a>ä¸‰ç§æ¨¡å¼çš„å¯¹æ¯”ä¸æ€»ç»“</h4><p>selectæ¨¡å¼å­˜åœ¨çš„ä¸‰ä¸ªé—®é¢˜ï¼š</p><ul><li><p>èƒ½ç›‘å¬çš„FDæœ€å¤§ä¸è¶…è¿‡1024</p></li><li><p>æ¯æ¬¡selectéƒ½éœ€è¦æŠŠæ‰€æœ‰è¦ç›‘å¬çš„FDéƒ½æ‹·è´åˆ°å†…æ ¸ç©ºé—´</p></li><li><p>æ¯æ¬¡éƒ½è¦éå†æ‰€æœ‰FDæ¥åˆ¤æ–­å°±ç»ªçŠ¶æ€</p></li></ul><p>pollæ¨¡å¼çš„é—®é¢˜ï¼š</p><ul><li>pollåˆ©ç”¨é“¾è¡¨è§£å†³äº†selectä¸­ç›‘å¬FDä¸Šé™çš„é—®é¢˜ï¼Œä½†ä¾ç„¶è¦éå†æ‰€æœ‰FDï¼Œå¦‚æœç›‘å¬è¾ƒå¤šï¼Œæ€§èƒ½ä¼šä¸‹é™</li></ul><p>epollæ¨¡å¼ä¸­å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜çš„ï¼Ÿ</p><ul><li><p>åŸºäºepollå®ä¾‹ä¸­çš„çº¢é»‘æ ‘ä¿å­˜è¦ç›‘å¬çš„FDï¼Œç†è®ºä¸Šæ— ä¸Šé™ï¼Œè€Œä¸”å¢åˆ æ”¹æŸ¥æ•ˆç‡éƒ½éå¸¸é«˜</p></li><li><p>æ¯ä¸ªFDåªéœ€è¦æ‰§è¡Œä¸€æ¬¡epoll_ctlæ·»åŠ åˆ°çº¢é»‘æ ‘ï¼Œä»¥åæ¯æ¬¡epol_waitæ— éœ€ä¼ é€’ä»»ä½•å‚æ•°ï¼Œæ— éœ€é‡å¤æ‹·è´FDåˆ°å†…æ ¸ç©ºé—´</p></li><li><p>åˆ©ç”¨ep_poll_callbackæœºåˆ¶æ¥ç›‘å¬FDçŠ¶æ€ï¼Œæ— éœ€éå†æ‰€æœ‰FDï¼Œå› æ­¤æ€§èƒ½ä¸ä¼šéšç›‘å¬çš„FDæ•°é‡å¢å¤šè€Œä¸‹é™</p></li></ul><h4 id="äº‹ä»¶é€šçŸ¥æœºåˆ¶"><a href="#äº‹ä»¶é€šçŸ¥æœºåˆ¶" class="headerlink" title="äº‹ä»¶é€šçŸ¥æœºåˆ¶"></a>äº‹ä»¶é€šçŸ¥æœºåˆ¶</h4><p>å½“FDæœ‰æ•°æ®å¯è¯»æ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨epoll_waitï¼ˆæˆ–è€…selectã€pollï¼‰å¯ä»¥å¾—åˆ°é€šçŸ¥ã€‚ä½†æ˜¯äº‹ä»¶é€šçŸ¥çš„æ¨¡å¼æœ‰ä¸¤ç§ï¼š</p><ul><li>LevelTriggeredï¼šç®€ç§°LTï¼Œä¹Ÿå«åšæ°´å¹³è§¦å‘ã€‚åªè¦æŸä¸ªFDä¸­æœ‰æ•°æ®å¯è¯»ï¼Œæ¯æ¬¡è°ƒç”¨epoll_waitéƒ½ä¼šå¾—åˆ°é€šçŸ¥ã€‚</li><li>EdgeTriggeredï¼šç®€ç§°ETï¼Œä¹Ÿå«åšè¾¹æ²¿è§¦å‘ã€‚åªæœ‰åœ¨æŸä¸ªFDæœ‰çŠ¶æ€å˜åŒ–æ—¶ï¼Œè°ƒç”¨epoll_waitæ‰ä¼šè¢«é€šçŸ¥ã€‚</li></ul><p>ğŸ”´ğŸŸ¢ğŸŸ¡ç»“è®ºï¼š</p><ul><li><p>LTï¼šäº‹ä»¶é€šçŸ¥é¢‘ç‡è¾ƒé«˜ï¼Œä¼šæœ‰<mark>é‡å¤é€šçŸ¥</mark>ï¼Œå½±å“æ€§èƒ½</p></li><li><p>ETï¼š<mark>ä»…é€šçŸ¥ä¸€æ¬¡</mark>ï¼Œæ•ˆç‡é«˜ã€‚å¯ä»¥åŸºäºéé˜»å¡IOå¾ªç¯è¯»å–è§£å†³æ•°æ®è¯»å–ä¸å®Œæ•´é—®é¢˜</p></li></ul><p>selectå’Œpollä»…æ”¯æŒLTæ¨¡å¼ï¼Œepollå¯ä»¥è‡ªç”±é€‰æ‹©LTå’ŒETä¸¤ç§æ¨¡å¼</p><h4 id="åŸºäºepollçš„æœåŠ¡å™¨ç«¯æµç¨‹"><a href="#åŸºäºepollçš„æœåŠ¡å™¨ç«¯æµç¨‹" class="headerlink" title="åŸºäºepollçš„æœåŠ¡å™¨ç«¯æµç¨‹"></a>åŸºäºepollçš„æœåŠ¡å™¨ç«¯æµç¨‹</h4><p>æˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹è¿™å¼ å›¾</p><p>æœåŠ¡å™¨å¯åŠ¨ä»¥åï¼ŒæœåŠ¡ç«¯ä¼šå»è°ƒç”¨epoll_createï¼Œåˆ›å»ºä¸€ä¸ªepollå®ä¾‹ï¼Œepollå®ä¾‹ä¸­åŒ…å«ä¸¤ä¸ªæ•°æ®</p><p>1ã€çº¢é»‘æ ‘ï¼ˆä¸ºç©ºï¼‰ï¼šrb_root ç”¨æ¥å»è®°å½•éœ€è¦è¢«ç›‘å¬çš„FD</p><p>2ã€é“¾è¡¨ï¼ˆä¸ºç©ºï¼‰ï¼šlist_headï¼Œç”¨æ¥å­˜æ”¾å·²ç»å°±ç»ªçš„FD</p><p>åˆ›å»ºå¥½äº†ä¹‹åï¼Œä¼šå»è°ƒç”¨epoll_ctlå‡½æ•°ï¼Œæ­¤å‡½æ•°ä¼šå°†éœ€è¦ç›‘å¬çš„æ•°æ®æ·»åŠ åˆ°rb_rootä¸­å»ï¼Œå¹¶ä¸”å¯¹å½“å‰è¿™äº›å­˜åœ¨äºçº¢é»‘æ ‘çš„èŠ‚ç‚¹è®¾ç½®å›è°ƒå‡½æ•°ï¼Œå½“è¿™äº›è¢«ç›‘å¬çš„æ•°æ®ä¸€æ—¦å‡†å¤‡å®Œæˆï¼Œå°±ä¼šè¢«è°ƒç”¨ï¼Œè€Œè°ƒç”¨çš„ç»“æœå°±æ˜¯å°†çº¢é»‘æ ‘çš„fdæ·»åŠ åˆ°list_headä¸­å»(ä½†æ˜¯æ­¤æ—¶å¹¶æ²¡æœ‰å®Œæˆ)</p><p>3ã€å½“ç¬¬äºŒæ­¥å®Œæˆåï¼Œå°±ä¼šè°ƒç”¨epoll_waitå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šå»æ ¡éªŒæ˜¯å¦æœ‰æ•°æ®å‡†å¤‡å®Œæ¯•ï¼ˆå› ä¸ºæ•°æ®ä¸€æ—¦å‡†å¤‡å°±ç»ªï¼Œå°±ä¼šè¢«å›è°ƒå‡½æ•°æ·»åŠ åˆ°list_headä¸­ï¼‰ï¼Œåœ¨ç­‰å¾…äº†ä¸€æ®µæ—¶é—´å(å¯ä»¥è¿›è¡Œé…ç½®)ï¼Œå¦‚æœç­‰å¤Ÿäº†è¶…æ—¶æ—¶é—´ï¼Œåˆ™è¿”å›æ²¡æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¿›ä¸€æ­¥åˆ¤æ–­å½“å‰æ˜¯ä»€ä¹ˆäº‹ä»¶ï¼Œå¦‚æœæ˜¯å»ºç«‹è¿æ¥æ—¶é—´ï¼Œåˆ™è°ƒç”¨accept() æ¥å—å®¢æˆ·ç«¯socketï¼Œæ‹¿åˆ°å»ºç«‹è¿æ¥çš„socketï¼Œç„¶åå»ºç«‹èµ·æ¥è¿æ¥ï¼Œå¦‚æœæ˜¯å…¶ä»–äº‹ä»¶ï¼Œåˆ™æŠŠæ•°æ®è¿›è¡Œå†™å‡º</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231106145531092.png" alt="image-20231106145531092"></p><p>â­â­â­æ­¤å¤„å›çœ‹ç¬¬171é›†ï¼š<a href="https://www.bilibili.com/video/BV1cr4y1671t?p=171&vd_source=fa7ba4ae353f08f1d08d1bb24528e96c">https://www.bilibili.com/video/BV1cr4y1671t?p=171&amp;vd_source=fa7ba4ae353f08f1d08d1bb24528e96c</a></p><h3 id="ä¿¡å·é©±åŠ¨IO"><a href="#ä¿¡å·é©±åŠ¨IO" class="headerlink" title="ä¿¡å·é©±åŠ¨IO"></a>ä¿¡å·é©±åŠ¨IO</h3><p>ä¿¡å·é©±åŠ¨IOæ˜¯ä¸å†…æ ¸å»ºç«‹SIGIOçš„ä¿¡å·å…³è”å¹¶è®¾ç½®å›è°ƒï¼Œ<mark>å½“å†…æ ¸æœ‰FDå°±ç»ªæ—¶ï¼Œä¼šå‘å‡ºSIGIOä¿¡å·é€šçŸ¥ç”¨æˆ·</mark>ï¼ŒæœŸé—´ç”¨æˆ·åº”ç”¨å¯ä»¥æ‰§è¡Œå…¶å®ƒä¸šåŠ¡ï¼Œæ— éœ€é˜»å¡ç­‰å¾…ã€‚</p><p>é˜¶æ®µä¸€ï¼š</p><ul><li>ç”¨æˆ·è¿›ç¨‹è°ƒç”¨sigactionï¼Œæ³¨å†Œä¿¡å·å¤„ç†å‡½æ•°</li><li>å†…æ ¸è¿”å›æˆåŠŸï¼Œå¼€å§‹ç›‘å¬FD</li><li>ç”¨æˆ·è¿›ç¨‹ä¸é˜»å¡ç­‰å¾…ï¼Œå¯ä»¥æ‰§è¡Œå…¶å®ƒä¸šåŠ¡</li><li>å½“å†…æ ¸æ•°æ®å°±ç»ªåï¼Œå›è°ƒç”¨æˆ·è¿›ç¨‹çš„SIGIOå¤„ç†å‡½æ•°</li></ul><p>é˜¶æ®µäºŒï¼š</p><ul><li>æ”¶åˆ°SIGIOå›è°ƒä¿¡å·</li><li>è°ƒç”¨recvfromï¼Œè¯»å–</li><li>å†…æ ¸å°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´</li><li>ç”¨æˆ·è¿›ç¨‹å¤„ç†æ•°æ®</li></ul><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/1653911776583.png" alt="1653911776583"></p><p>å½“æœ‰<mark>å¤§é‡IOæ“ä½œ</mark>æ—¶ï¼Œä¿¡å·è¾ƒå¤šï¼ŒSIGIOå¤„ç†å‡½æ•°<mark>ä¸èƒ½åŠæ—¶å¤„ç†</mark>å¯èƒ½å¯¼è‡´ä¿¡å·é˜Ÿåˆ—æº¢å‡ºï¼Œè€Œä¸”å†…æ ¸ç©ºé—´ä¸ç”¨æˆ·ç©ºé—´çš„é¢‘ç¹ä¿¡å·äº¤äº’æ€§èƒ½ä¹Ÿè¾ƒä½ã€‚</p><h3 id="å¼‚æ­¥IO"><a href="#å¼‚æ­¥IO" class="headerlink" title="å¼‚æ­¥IO"></a>å¼‚æ­¥IO</h3><p>è¿™ç§æ–¹å¼ï¼Œä¸ä»…ä»…æ˜¯ç”¨æˆ·æ€åœ¨è¯•å›¾è¯»å–æ•°æ®åï¼Œä¸é˜»å¡ï¼Œè€Œä¸”å½“å†…æ ¸çš„æ•°æ®å‡†å¤‡å®Œæˆåï¼Œä¹Ÿä¸ä¼šé˜»å¡</p><p>ä»–ä¼šç”±å†…æ ¸å°†æ‰€æœ‰æ•°æ®å¤„ç†å®Œæˆåï¼Œç”±å†…æ ¸å°†æ•°æ®å†™å…¥åˆ°ç”¨æˆ·æ€ä¸­ï¼Œç„¶åæ‰ç®—å®Œæˆï¼Œæ‰€ä»¥æ€§èƒ½æé«˜ï¼Œä¸ä¼šæœ‰ä»»ä½•é˜»å¡ï¼Œå…¨éƒ¨éƒ½ç”±å†…æ ¸å®Œæˆï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¼‚æ­¥IOæ¨¡å‹ä¸­ï¼Œç”¨æˆ·è¿›ç¨‹åœ¨ä¸¤ä¸ªé˜¶æ®µéƒ½æ˜¯éé˜»å¡çŠ¶æ€ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/1653911877542.png" alt="1653911877542"></p><h3 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h3><p>æœ€åç”¨ä¸€å¹…å›¾ï¼Œæ¥è¯´æ˜ä»–ä»¬ä¹‹é—´çš„åŒºåˆ«</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/1653912219712.png" alt="1653912219712"></p><h2 id="å°æ—codingé¢è¯•é¢˜"><a href="#å°æ—codingé¢è¯•é¢˜" class="headerlink" title="å°æ—codingé¢è¯•é¢˜"></a>å°æ—codingé¢è¯•é¢˜</h2><h3 id="Redis-æ˜¯å•çº¿ç¨‹å—ï¼Ÿ"><a href="#Redis-æ˜¯å•çº¿ç¨‹å—ï¼Ÿ" class="headerlink" title="Redis æ˜¯å•çº¿ç¨‹å—ï¼Ÿ"></a>Redis æ˜¯å•çº¿ç¨‹å—ï¼Ÿ</h3><p>å¦‚æœä»…ä»…èŠRedisçš„æ ¸å¿ƒä¸šåŠ¡éƒ¨åˆ†ï¼ˆå‘½ä»¤å¤„ç†ï¼‰ï¼Œç­”æ¡ˆæ˜¯å•çº¿ç¨‹</p><p>å¦‚æœæ˜¯èŠæ•´ä¸ªRedisï¼Œé‚£ä¹ˆç­”æ¡ˆå°±æ˜¯å¤šçº¿ç¨‹</p><p><strong>Redis å•çº¿ç¨‹æŒ‡çš„æ˜¯ã€Œæ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚-&gt;è§£æè¯·æ±‚ -&gt;è¿›è¡Œæ•°æ®è¯»å†™ç­‰æ“ä½œ-&gt;å‘é€æ•°æ®ç»™å®¢æˆ·ç«¯ã€è¿™ä¸ªè¿‡ç¨‹æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰æ¥å®Œæˆçš„</strong>ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è¯´ Redis æ˜¯å•çº¿ç¨‹çš„åŸå› ã€‚</p><p>ä½†æ˜¯ï¼Œ<strong>Redis ç¨‹åºå¹¶ä¸æ˜¯å•çº¿ç¨‹çš„</strong>ï¼ŒRedis åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œæ˜¯ä¼š<strong>å¯åŠ¨åå°çº¿ç¨‹</strong>ï¼ˆBIOï¼‰çš„ï¼š</p><ul><li><strong>Redis åœ¨ 2.6 ç‰ˆæœ¬</strong>ï¼Œä¼šå¯åŠ¨ 2 ä¸ªåå°çº¿ç¨‹ï¼Œåˆ†åˆ«å¤„ç†<mark>å…³é—­æ–‡ä»¶ã€AOF åˆ·ç›˜</mark>è¿™ä¸¤ä¸ªä»»åŠ¡ï¼›</li><li><strong>Redis åœ¨ 4.0 ç‰ˆæœ¬ä¹‹å</strong>ï¼Œæ–°å¢äº†ä¸€ä¸ªæ–°çš„åå°çº¿ç¨‹ï¼Œç”¨æ¥<mark>å¼‚æ­¥é‡Šæ”¾ Redis å†…å­˜</mark>ï¼Œä¹Ÿå°±æ˜¯ lazyfree çº¿ç¨‹ã€‚ä¾‹å¦‚æ‰§è¡Œ unlink key &#x2F; flushdb async &#x2F; flushall async ç­‰å‘½ä»¤ï¼Œä¼šæŠŠè¿™äº›åˆ é™¤æ“ä½œäº¤ç»™åå°çº¿ç¨‹æ¥æ‰§è¡Œï¼Œå¥½å¤„æ˜¯ä¸ä¼šå¯¼è‡´ Redis ä¸»çº¿ç¨‹å¡é¡¿ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬è¦åˆ é™¤ä¸€ä¸ªå¤§ key çš„æ—¶å€™ï¼Œä¸è¦ä½¿ç”¨ del å‘½ä»¤åˆ é™¤ï¼Œå› ä¸º del æ˜¯åœ¨ä¸»çº¿ç¨‹å¤„ç†çš„ï¼Œè¿™æ ·ä¼šå¯¼è‡´ Redis ä¸»çº¿ç¨‹å¡é¡¿ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ unlink å‘½ä»¤æ¥å¼‚æ­¥åˆ é™¤å¤§keyã€‚</li></ul><p>ä¹‹æ‰€ä»¥ Redis ä¸ºã€Œå…³é—­æ–‡ä»¶ã€AOF åˆ·ç›˜ã€é‡Šæ”¾å†…å­˜ã€è¿™äº›ä»»åŠ¡åˆ›å»ºå•ç‹¬çš„çº¿ç¨‹æ¥å¤„ç†ï¼Œæ˜¯å› ä¸ºè¿™äº›ä»»åŠ¡çš„æ“ä½œéƒ½æ˜¯å¾ˆ<mark>è€—æ—¶</mark>çš„ï¼Œå¦‚æœæŠŠè¿™äº›ä»»åŠ¡éƒ½æ”¾åœ¨ä¸»çº¿ç¨‹æ¥å¤„ç†ï¼Œé‚£ä¹ˆ Redis ä¸»çº¿ç¨‹å°±å¾ˆå®¹æ˜“å‘ç”Ÿé˜»å¡ï¼Œè¿™æ ·å°±æ— æ³•å¤„ç†åç»­çš„è¯·æ±‚äº†ã€‚</p><p>åå°çº¿ç¨‹ç›¸å½“äºä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œç”Ÿäº§è€…æŠŠè€—æ—¶ä»»åŠ¡ä¸¢åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹è€…ï¼ˆBIOï¼‰ä¸åœè½®è¯¢è¿™ä¸ªé˜Ÿåˆ—ï¼Œæ‹¿å‡ºä»»åŠ¡å°±å»æ‰§è¡Œå¯¹åº”çš„æ–¹æ³•å³å¯ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/%E5%90%8E%E5%8F%B0%E7%BA%BF%E7%A8%8B.jpg" alt="img"></p><h3 id="Redis-å•çº¿ç¨‹æ¨¡å¼æ˜¯æ€æ ·çš„ï¼Ÿ"><a href="#Redis-å•çº¿ç¨‹æ¨¡å¼æ˜¯æ€æ ·çš„ï¼Ÿ" class="headerlink" title="Redis å•çº¿ç¨‹æ¨¡å¼æ˜¯æ€æ ·çš„ï¼Ÿ"></a>Redis å•çº¿ç¨‹æ¨¡å¼æ˜¯æ€æ ·çš„ï¼Ÿ</h3><p>IOå¤šè·¯å¤ç”¨+äº‹ä»¶æ´¾å‘</p><p>Redis 6.0 ç‰ˆæœ¬ä¹‹å‰çš„å•çº¿æ¨¡å¼å¦‚ä¸‹å›¾ï¼š</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/redis%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B.drawio.png" alt="img"></p><p>å›¾ä¸­çš„è“è‰²éƒ¨åˆ†æ˜¯ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œæ˜¯ç”±ä¸»çº¿ç¨‹è´Ÿè´£çš„ï¼Œå¯ä»¥çœ‹åˆ°ç½‘ç»œ I&#x2F;O å’Œå‘½ä»¤å¤„ç†éƒ½æ˜¯å•çº¿ç¨‹ã€‚ Redis <mark>åˆå§‹åŒ–</mark>çš„æ—¶å€™ï¼Œä¼šåšä¸‹é¢è¿™å‡ ä»¶äº‹æƒ…ï¼š</p><ul><li>é¦–å…ˆï¼Œè°ƒç”¨ epoll_create() <mark>åˆ›å»ºä¸€ä¸ª epoll å¯¹è±¡</mark>å’Œè°ƒç”¨ socket() <mark>åˆ›å»ºä¸€ä¸ªæœåŠ¡ç«¯ socket</mark></li><li>ç„¶åï¼Œè°ƒç”¨ bind() <mark>ç»‘å®šç«¯å£</mark>å’Œè°ƒç”¨ listen() <mark>ç›‘å¬è¯¥ socket</mark>ï¼›</li><li>ç„¶åï¼Œå°†<mark>è°ƒç”¨ epoll_ctl()</mark> å°† listen socket åŠ å…¥åˆ° epollï¼Œ<mark>åŒæ—¶æ³¨å†Œã€Œè¿æ¥äº‹ä»¶ã€å¤„ç†å‡½æ•°</mark>ã€‚</li></ul><p>åˆå§‹åŒ–å®Œåï¼Œä¸»çº¿ç¨‹å°±è¿›å…¥åˆ°ä¸€ä¸ª<strong>äº‹ä»¶å¾ªç¯å‡½æ•°</strong>ï¼Œä¸»è¦ä¼šåšä»¥ä¸‹äº‹æƒ…ï¼š</p><ul><li>é¦–å…ˆï¼Œå…ˆè°ƒç”¨<strong>å¤„ç†å‘é€é˜Ÿåˆ—å‡½æ•°</strong>ï¼Œçœ‹æ˜¯å‘é€é˜Ÿåˆ—é‡Œæ˜¯å¦æœ‰ä»»åŠ¡ï¼Œå¦‚æœæœ‰å‘é€ä»»åŠ¡ï¼Œåˆ™é€šè¿‡ write å‡½æ•°å°†å®¢æˆ·ç«¯å‘é€ç¼“å­˜åŒºé‡Œçš„æ•°æ®å‘é€å‡ºå»ï¼Œå¦‚æœè¿™ä¸€è½®æ•°æ®æ²¡æœ‰å‘é€å®Œï¼Œå°±ä¼šæ³¨å†Œå†™äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç­‰å¾… epoll_wait å‘ç°å¯å†™åå†å¤„ç† ã€‚</li><li>æ¥ç€ï¼Œè°ƒç”¨ epoll_wait å‡½æ•°ç­‰å¾…äº‹ä»¶çš„åˆ°æ¥ï¼š<ul><li>å¦‚æœæ˜¯<strong>è¿æ¥äº‹ä»¶</strong>åˆ°æ¥ï¼Œåˆ™ä¼šè°ƒç”¨<strong>è¿æ¥äº‹ä»¶å¤„ç†å‡½æ•°</strong>ï¼Œè¯¥å‡½æ•°ä¼šåšè¿™äº›äº‹æƒ…ï¼šè°ƒç”¨ accpet è·å–å·²è¿æ¥çš„ socket -&gt; è°ƒç”¨ epoll_ctl å°†å·²è¿æ¥çš„ socket åŠ å…¥åˆ° epoll -&gt; æ³¨å†Œã€Œè¯»äº‹ä»¶ã€å¤„ç†å‡½æ•°ï¼›</li><li>å¦‚æœæ˜¯<strong>è¯»äº‹ä»¶</strong>åˆ°æ¥ï¼Œåˆ™ä¼šè°ƒç”¨<strong>è¯»äº‹ä»¶å¤„ç†å‡½æ•°</strong>ï¼Œè¯¥å‡½æ•°ä¼šåšè¿™äº›äº‹æƒ…ï¼šè°ƒç”¨ read è·å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ® -&gt; è§£æå‘½ä»¤ -&gt; å¤„ç†å‘½ä»¤ -&gt; å°†å®¢æˆ·ç«¯å¯¹è±¡æ·»åŠ åˆ°å‘é€é˜Ÿåˆ— -&gt; å°†æ‰§è¡Œç»“æœå†™åˆ°å‘é€ç¼“å­˜åŒºç­‰å¾…å‘é€ï¼›</li><li>å¦‚æœæ˜¯<strong>å†™äº‹ä»¶</strong>åˆ°æ¥ï¼Œåˆ™ä¼šè°ƒç”¨<strong>å†™äº‹ä»¶å¤„ç†å‡½æ•°</strong>ï¼Œè¯¥å‡½æ•°ä¼šåšè¿™äº›äº‹æƒ…ï¼šé€šè¿‡ write å‡½æ•°å°†å®¢æˆ·ç«¯å‘é€ç¼“å­˜åŒºé‡Œçš„æ•°æ®å‘é€å‡ºå»ï¼Œå¦‚æœè¿™ä¸€è½®æ•°æ®æ²¡æœ‰å‘é€å®Œï¼Œå°±ä¼šç»§ç»­æ³¨å†Œå†™äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç­‰å¾… epoll_wait å‘ç°å¯å†™åå†å¤„ç† ã€‚</li></ul></li></ul><h3 id="Redis-é‡‡ç”¨å•çº¿ç¨‹ä¸ºä»€ä¹ˆè¿˜è¿™ä¹ˆå¿«ï¼Ÿ"><a href="#Redis-é‡‡ç”¨å•çº¿ç¨‹ä¸ºä»€ä¹ˆè¿˜è¿™ä¹ˆå¿«ï¼Ÿ" class="headerlink" title="Redis é‡‡ç”¨å•çº¿ç¨‹ä¸ºä»€ä¹ˆè¿˜è¿™ä¹ˆå¿«ï¼Ÿ"></a>Redis é‡‡ç”¨å•çº¿ç¨‹ä¸ºä»€ä¹ˆè¿˜è¿™ä¹ˆå¿«ï¼Ÿ</h3><ul><li><p>å¤§éƒ¨åˆ†æ“ä½œ<strong>éƒ½åœ¨å†…å­˜ä¸­å®Œæˆ</strong>ï¼Œå¹¶ä¸”é‡‡ç”¨äº†é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼ˆä¾‹å¦‚epollä¸­çš„çº¢é»‘æ ‘ï¼‰</p></li><li><p><strong>é¿å…äº†å¤šçº¿ç¨‹ä¹‹é—´çš„ç«äº‰</strong>ï¼Œçœå»äº†å¤šçº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„æ—¶é—´å’Œæ€§èƒ½ä¸Šçš„å¼€é”€ï¼Œè€Œä¸”ä¹Ÿä¸ä¼šå¯¼è‡´æ­»é”é—®é¢˜ã€‚</p></li><li><p>é‡‡ç”¨äº† <strong>I&#x2F;O å¤šè·¯å¤ç”¨æœºåˆ¶</strong>å¤„ç†å¤§é‡çš„å®¢æˆ·ç«¯ Socket è¯·æ±‚ï¼šç®€å•æ¥è¯´ï¼Œåœ¨ Redis åªè¿è¡Œå•çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œè¯¥æœºåˆ¶å…è®¸å†…æ ¸ä¸­ï¼ŒåŒæ—¶å­˜åœ¨å¤šä¸ªç›‘å¬ Socket å’Œå·²è¿æ¥ Socketã€‚å†…æ ¸ä¼šä¸€ç›´ç›‘å¬è¿™äº› Socket ä¸Šçš„è¿æ¥è¯·æ±‚æˆ–æ•°æ®è¯·æ±‚ã€‚ä¸€æ—¦æœ‰è¯·æ±‚åˆ°è¾¾ï¼Œå°±ä¼šäº¤ç»™ Redis çº¿ç¨‹å¤„ç†</p></li></ul><h3 id="Redis-6-0-ä¹‹å‰ä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹ï¼Ÿ"><a href="#Redis-6-0-ä¹‹å‰ä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹ï¼Ÿ" class="headerlink" title="Redis 6.0 ä¹‹å‰ä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹ï¼Ÿ"></a>Redis 6.0 ä¹‹å‰ä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹ï¼Ÿ</h3><p><strong>CPU å¹¶ä¸æ˜¯åˆ¶çº¦ Redis æ€§èƒ½è¡¨ç°çš„ç“¶é¢ˆæ‰€åœ¨</strong>ï¼Œæ›´å¤šæƒ…å†µä¸‹æ˜¯å—åˆ°<mark>å†…å­˜å¤§å°å’Œç½‘ç»œI&#x2F;Oçš„é™åˆ¶</mark>ã€‚</p><p>ä½¿ç”¨å¤šçº¿ç¨‹å¯èƒ½å¸¦æ¥çš„åæœï¼š<strong>å¢åŠ äº†ç³»ç»Ÿå¤æ‚åº¦ã€åŒæ—¶å¯èƒ½å­˜åœ¨çº¿ç¨‹åˆ‡æ¢ã€ç”šè‡³åŠ é”è§£é”ã€æ­»é”é€ æˆçš„æ€§èƒ½æŸè€—</strong>ã€‚</p><h3 id="Redis-6-0-ä¹‹åä¸ºä»€ä¹ˆå¼•å…¥äº†å¤šçº¿ç¨‹ï¼Ÿ"><a href="#Redis-6-0-ä¹‹åä¸ºä»€ä¹ˆå¼•å…¥äº†å¤šçº¿ç¨‹ï¼Ÿ" class="headerlink" title="Redis 6.0 ä¹‹åä¸ºä»€ä¹ˆå¼•å…¥äº†å¤šçº¿ç¨‹ï¼Ÿ"></a>Redis 6.0 ä¹‹åä¸ºä»€ä¹ˆå¼•å…¥äº†å¤šçº¿ç¨‹ï¼Ÿ</h3><p>è™½ç„¶ Redis çš„ä¸»è¦å·¥ä½œï¼ˆç½‘ç»œ I&#x2F;O å’Œæ‰§è¡Œå‘½ä»¤ï¼‰ä¸€ç›´æ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œä½†æ˜¯<strong>åœ¨ Redis 6.0 ç‰ˆæœ¬ä¹‹åï¼Œä¹Ÿé‡‡ç”¨äº†å¤šä¸ª I&#x2F;O çº¿ç¨‹æ¥å¤„ç†ç½‘ç»œè¯·æ±‚</strong>ï¼Œ<strong>è¿™æ˜¯å› ä¸ºéšç€ç½‘ç»œç¡¬ä»¶çš„æ€§èƒ½æå‡ï¼ŒRedis çš„<mark>æ€§èƒ½ç“¶é¢ˆæœ‰æ—¶ä¼šå‡ºç°åœ¨ç½‘ç»œ I&#x2F;O çš„å¤„ç†ä¸Š</strong></mark>ã€‚</p><p>æ‰€ä»¥ä¸ºäº†æé«˜ç½‘ç»œ I&#x2F;O çš„å¹¶è¡Œåº¦ï¼ŒRedis 6.0 å¯¹äºç½‘ç»œ I&#x2F;O é‡‡ç”¨å¤šçº¿ç¨‹æ¥å¤„ç†ã€‚ä½†æ˜¯å¯¹äºå‘½ä»¤çš„æ‰§è¡Œï¼ŒRedis ä»ç„¶ä½¿ç”¨å•çº¿ç¨‹æ¥å¤„ç†ï¼Œæ‰€ä»¥<mark>ä¸è¦è¯¯è§£Redis æœ‰å¤šçº¿ç¨‹åŒæ—¶æ‰§è¡Œå‘½ä»¤</mark>ã€‚</p><hr><p>å› æ­¤ï¼Œ Redis 6.0 ç‰ˆæœ¬ä¹‹åï¼ŒRedis åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼š<strong>é¢å¤–åˆ›å»º 6 ä¸ªçº¿ç¨‹</strong>ï¼ˆ<em>è¿™é‡Œçš„çº¿ç¨‹æ•°ä¸åŒ…æ‹¬ä¸»çº¿ç¨‹</em>ï¼‰ï¼š</p><ul><li>Redis-server ï¼š Redisçš„<strong>ä¸»çº¿ç¨‹ï¼Œä¸»è¦è´Ÿè´£æ‰§è¡Œå‘½ä»¤</strong>ï¼›</li><li>bio_close_fileã€bio_aof_fsyncã€bio_lazy_freeï¼šä¸‰ä¸ªåå°çº¿ç¨‹ï¼Œåˆ†åˆ«<mark>å¼‚æ­¥å¤„ç†**</mark>å…³é—­æ–‡ä»¶ä»»åŠ¡ã€AOFåˆ·ç›˜ä»»åŠ¡ã€é‡Šæ”¾å†…å­˜ä»»åŠ¡**ï¼›</li><li>io_thd_1ã€io_thd_2ã€io_thd_3ï¼šä¸‰ä¸ª I&#x2F;O çº¿ç¨‹ï¼Œio-threads é»˜è®¤æ˜¯ 4 ï¼Œæ‰€ä»¥ä¼šå¯åŠ¨ 3ï¼ˆ4-1ï¼‰ä¸ª I&#x2F;O å¤šçº¿ç¨‹ï¼Œç”¨æ¥<strong>åˆ†æ‹… Redis ç½‘ç»œ I&#x2F;O çš„å‹åŠ›</strong>ã€‚</li></ul><h1 id="Redisæ•°æ®ç±»å‹"><a href="#Redisæ•°æ®ç±»å‹" class="headerlink" title="Redisæ•°æ®ç±»å‹"></a>Redisæ•°æ®ç±»å‹</h1><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/%E4%BA%94%E7%A7%8D%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%9B%BE.png" alt="äº”ç§æ•°æ®ç±»å‹å›¾"></p><h2 id="String"><a href="#String" class="headerlink" title="String"></a>String</h2><h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p>String çš„æ•°æ®ç»“æ„ä¸º<code>int</code>å’Œ<mark>ç®€å•åŠ¨æ€å­—ç¬¦ä¸² (Simple Dynamic String, ç¼©å†™ SDS)</mark>ï¼Œæ˜¯<strong>å¯ä»¥ä¿®æ”¹çš„å­—ç¬¦ä¸²</strong>ï¼Œå†…éƒ¨ç»“æ„å®ç°ä¸Š<strong>ç±»ä¼¼äº Java çš„ ArrayList</strong>ï¼Œé‡‡ç”¨é¢„åˆ†é…å†—ä½™ç©ºé—´çš„æ–¹å¼æ¥å‡å°‘å†…å­˜çš„é¢‘ç¹åˆ†é…ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231023212252966.png" alt="image-20231023212252966"></p><p>å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œå†…éƒ¨ä¸ºå½“å‰å­—ç¬¦ä¸²å®é™…åˆ†é…çš„ç©ºé—´ capacity ä¸€èˆ¬è¦é«˜äºå®é™…å­—ç¬¦ä¸²é•¿åº¦ lenã€‚å½“å­—ç¬¦ä¸²é•¿åº¦å°äº 1M æ—¶ï¼Œæ‰©å®¹éƒ½æ˜¯åŠ å€ç°æœ‰çš„ç©ºé—´ï¼Œå¦‚æœè¶…è¿‡ 1Mï¼Œæ‰©å®¹æ—¶ä¸€æ¬¡åªä¼šå¤šæ‰© 1M çš„ç©ºé—´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å­—ç¬¦ä¸²æœ€å¤§é•¿åº¦ä¸º 512Mã€‚</p><h3 id="ç¼–ç ç±»å‹"><a href="#ç¼–ç ç±»å‹" class="headerlink" title="ç¼–ç ç±»å‹"></a>ç¼–ç ç±»å‹</h3><ol><li><p>å…¶åŸºæœ¬ç¼–ç æ–¹å¼æ˜¯<mark>RAW</mark>ï¼ŒåŸºäºç®€å•åŠ¨æ€å­—ç¬¦ä¸²(SDS)å®ç°ï¼Œå­˜å‚¨ä¸Šé™ä¸º512mb.</p></li><li><p>å¦‚æœå­˜å‚¨çš„SDSé•¿åº¦å°äº44å­—èŠ‚ï¼Œåˆ™ä¼šé‡‡ç”¨<mark>EMBSTR</mark>ç¼–ç ï¼Œæ­¤æ—¶object headä¸SDSæ˜¯ä¸€æ®µ<strong>è¿ç»­ç©ºé—´</strong>ã€‚ç”³è¯·å†…å­˜æ—¶åªéœ€è¦è°ƒç”¨ä¸€æ¬¡å†…å­˜åˆ†é…å‡½æ•°ï¼Œæ•ˆç‡æ›´é«˜ã€‚</p></li></ol><blockquote><p>ä¸è¶…è¿‡44çš„åŸå› æ˜¯ï¼ŒåŠ ä¸ŠRedisobjectçš„å¤´ä¿¡æ¯åˆšå¥½ä¸ä¼šè¶…è¿‡64ï¼Œè€ŒRedisä¸­çš„ç”³è¯·å†…å­˜åˆæ˜¯ä»¥2çš„å‡ æ¬¡æ–¹æ¥ç”³è¯·çš„ï¼Œè¿™æ ·èƒ½åˆšå¥½é¿å…å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€‚</p></blockquote><ol start="3"><li>å¦‚æœå­˜å‚¨çš„å­—ç¬¦ä¸²æ˜¯æ•´æ•°å€¼ï¼Œå¹¶ä¸”å¤§å°åœ¨LONG MAXèŒƒå›´å†…ï¼Œåˆ™ä¼šé‡‡ç”¨<mark>INT</mark>ç¼–ç :ç›´æ¥å°†æ•°æ®ä¿å­˜åœ¨RedisObiectçš„ptræŒ‡é’ˆä½ç½®(åˆšå¥½8å­—èŠ‚)ï¼Œä¸å†éœ€è¦SDSäº†ã€‚</li></ol><p>ä¸‰ç§ç¼–ç ç±»å‹çš„<strong>å›¾ç¤º</strong>ï¼š</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231105115851754.png" alt="ä¸‰ç§ç¼–ç ç±»å‹çš„å›¾ç¤º"></p><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><ul><li>SET key value<br>è®¾ç½®æŒ‡å®škeyçš„å€¼</li><li>GET key<br>è·å–æŒ‡å®škeyçš„å€¼</li><li>SETEX key seconds value<br>è®¾ç½®æŒ‡å®škeyçš„å€¼ï¼Œå¹¶å°†keyçš„è¿‡æœŸæ—¶é—´è®¾ä¸ºsecondsç§’</li><li>SETNX key value<br>åªæœ‰åœ¨keyä¸å­˜åœ¨æ—¶è®¾ç½®keyçš„å€¼</li></ul><h3 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><ol><li>ç¼“å­˜å¯¹è±¡<ul><li>ç›´æ¥ç¼“å­˜æ•´ä¸ªå¯¹è±¡çš„ JSONï¼Œå‘½ä»¤ä¾‹å­ï¼š <code>SET user:1 &#39;&#123;&quot;name&quot;:&quot;xiaolin&quot;, &quot;age&quot;:18&#125;&#39;</code>ã€‚</li><li>é‡‡ç”¨å°† key è¿›è¡Œåˆ†ç¦»ä¸º user:ID:å±æ€§ï¼Œé‡‡ç”¨ MSET å­˜å‚¨ï¼Œç”¨ MGET è·å–å„å±æ€§å€¼ï¼Œå‘½ä»¤ä¾‹å­ï¼š <code>MSET user:1:name xiaolin user:1:age 18 user:2:name xiaomei user:2:age 20</code>ã€‚</li></ul></li><li>å¸¸è§„è®¡æ•°ï¼šè®¡ç®—è®¿é—®æ¬¡æ•°ã€ç‚¹èµã€è½¬å‘ã€åº“å­˜æ•°é‡ç­‰ç­‰</li><li>åˆ†å¸ƒå¼é”</li><li>å…±äº«sessionä¿¡æ¯ï¼šå°†sessionä¿å­˜åœ¨redisæ¥ä¿å­˜ç”¨æˆ·çš„ä¼šè¯(ç™»å½•)çŠ¶æ€</li></ol><h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><h3 id="æ•°æ®ç»“æ„-ç¼–ç ç±»å‹"><a href="#æ•°æ®ç»“æ„-ç¼–ç ç±»å‹" class="headerlink" title="æ•°æ®ç»“æ„&amp;&amp;ç¼–ç ç±»å‹"></a>æ•°æ®ç»“æ„&amp;&amp;ç¼–ç ç±»å‹</h3><p>List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±<strong>åŒå‘é“¾è¡¨<mark>æˆ–</mark>å‹ç¼©åˆ—è¡¨</strong>å®ç°çš„ï¼š</p><ul><li>å¦‚æœåˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°å°äº <code>512</code> ä¸ªï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± <code>list-max-ziplist-entries</code> é…ç½®ï¼‰ï¼Œåˆ—è¡¨æ¯ä¸ªå…ƒç´ çš„å€¼éƒ½å°äº <code>64</code> å­—èŠ‚ï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± <code>list-max-ziplist-value</code> é…ç½®ï¼‰ï¼ŒRedis ä¼šä½¿ç”¨<strong>å‹ç¼©åˆ—è¡¨</strong>ä½œä¸º List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li><li>å¦‚æœåˆ—è¡¨çš„å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢çš„æ¡ä»¶ï¼ŒRedis ä¼šä½¿ç”¨<strong>åŒå‘é“¾è¡¨</strong>ä½œä¸º List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li></ul><p><strong>åœ¨ Redis 3.2 ç‰ˆæœ¬ä¹‹åï¼ŒList æ•°æ®ç±»å‹åº•å±‚æ•°æ®ç»“æ„å°±åªç”± quicklist å®ç°äº†ï¼Œæ›¿ä»£äº†åŒå‘é“¾è¡¨å’Œå‹ç¼©åˆ—è¡¨</strong>ã€‚</p><h3 id="å¸¸ç”¨å‘½ä»¤-1"><a href="#å¸¸ç”¨å‘½ä»¤-1" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><p>Redisåˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºï¼Œå¸¸ç”¨å‘½ä»¤:</p><ul><li>LPUSH key value1 [value2]<br>å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨å¤´éƒ¨</li><li>LRANGE key start stop<br>è·å–åˆ—è¡¨æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ </li><li>RPOP key<br>ç§»é™¤å¹¶è·å–åˆ—è¡¨æœ€åä¸€ä¸ªå…ƒç´ </li><li>LLEN key<br>è·å–åˆ—è¡¨é•¿åº¦</li><li>BRPOP key1 [key2 ] timeout<br>ç§»å‡ºå¹¶è·å–åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨ç›´åˆ°ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢</li></ul><h3 id="åº”ç”¨åœºæ™¯-1"><a href="#åº”ç”¨åœºæ™¯-1" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><p>æ¶ˆæ¯é˜Ÿåˆ—</p><p>æ¶ˆæ¯é˜Ÿåˆ—åœ¨å­˜å–æ¶ˆæ¯æ—¶ï¼Œå¿…é¡»è¦æ»¡è¶³ä¸‰ä¸ªéœ€æ±‚ï¼Œåˆ†åˆ«æ˜¯<strong>æ¶ˆæ¯ä¿åºã€å¤„ç†é‡å¤çš„æ¶ˆæ¯å’Œä¿è¯æ¶ˆæ¯å¯é æ€§</strong>ã€‚</p><p>Redis çš„ List å’Œ Stream ä¸¤ç§æ•°æ®ç±»å‹ï¼Œå°±å¯ä»¥æ»¡è¶³æ¶ˆæ¯é˜Ÿåˆ—çš„è¿™ä¸‰ä¸ªéœ€æ±‚ã€‚æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹åŸºäº List çš„æ¶ˆæ¯é˜Ÿåˆ—å®ç°æ–¹æ³•ï¼Œåé¢åœ¨ä»‹ç» Stream æ•°æ®ç±»å‹æ—¶å€™ï¼Œåœ¨è¯¦ç»†è¯´è¯´ Streamã€‚</p><ol><li>å¦‚ä½•æ»¡è¶³æ¶ˆæ¯ä¿åºéœ€æ±‚ï¼Ÿ</li></ol><p>List æœ¬èº«å°±æ˜¯æŒ‰å…ˆè¿›å…ˆå‡ºçš„é¡ºåºå¯¹æ•°æ®è¿›è¡Œå­˜å–çš„ï¼Œæ‰€ä»¥ï¼Œå¦‚æœä½¿ç”¨ List ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ä¿å­˜æ¶ˆæ¯çš„è¯ï¼Œå°±å·²ç»èƒ½æ»¡è¶³æ¶ˆæ¯ä¿åºçš„éœ€æ±‚äº†ã€‚</p><p>List å¯ä»¥ä½¿ç”¨ LPUSH + RPOP ï¼ˆæˆ–è€…åè¿‡æ¥ï¼ŒRPUSH+LPOPï¼‰å‘½ä»¤å®ç°æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/list%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97.png" alt="img"></p><ul><li>ç”Ÿäº§è€…ä½¿ç”¨ <code>LPUSH key value[value...]</code> å°†æ¶ˆæ¯æ’å…¥åˆ°é˜Ÿåˆ—çš„å¤´éƒ¨ï¼Œå¦‚æœ key ä¸å­˜åœ¨åˆ™ä¼šåˆ›å»ºä¸€ä¸ªç©ºçš„é˜Ÿåˆ—å†æ’å…¥æ¶ˆæ¯ã€‚</li><li>æ¶ˆè´¹è€…ä½¿ç”¨ <code>RPOP key</code> ä¾æ¬¡è¯»å–é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œå…ˆè¿›å…ˆå‡ºã€‚</li></ul><p>ä¸è¿‡ï¼Œåœ¨æ¶ˆè´¹è€…è¯»å–æ•°æ®æ—¶ï¼Œæœ‰ä¸€ä¸ªæ½œåœ¨çš„æ€§èƒ½é£é™©ç‚¹ã€‚</p><p>åœ¨ç”Ÿäº§è€…å¾€ List ä¸­å†™å…¥æ•°æ®æ—¶ï¼ŒList å¹¶ä¸ä¼šä¸»åŠ¨åœ°é€šçŸ¥æ¶ˆè´¹è€…æœ‰æ–°æ¶ˆæ¯å†™å…¥ï¼Œå¦‚æœæ¶ˆè´¹è€…æƒ³è¦åŠæ—¶å¤„ç†æ¶ˆæ¯ï¼Œå°±éœ€è¦åœ¨ç¨‹åºä¸­ä¸åœåœ°è°ƒç”¨ <code>RPOP</code> å‘½ä»¤ï¼ˆæ¯”å¦‚ä½¿ç”¨ä¸€ä¸ªwhile(1)å¾ªç¯ï¼‰ã€‚å¦‚æœæœ‰æ–°æ¶ˆæ¯å†™å…¥ï¼ŒRPOPå‘½ä»¤å°±ä¼šè¿”å›ç»“æœï¼Œå¦åˆ™ï¼ŒRPOPå‘½ä»¤è¿”å›ç©ºå€¼ï¼Œå†ç»§ç»­å¾ªç¯ã€‚</p><p>æ‰€ä»¥ï¼Œå³ä½¿æ²¡æœ‰æ–°æ¶ˆæ¯å†™å…¥Listï¼Œæ¶ˆè´¹è€…ä¹Ÿè¦ä¸åœåœ°è°ƒç”¨ RPOP å‘½ä»¤ï¼Œè¿™å°±ä¼šå¯¼è‡´æ¶ˆè´¹è€…ç¨‹åºçš„ CPU ä¸€ç›´æ¶ˆè€—åœ¨æ‰§è¡Œ RPOP å‘½ä»¤ä¸Šï¼Œå¸¦æ¥ä¸å¿…è¦çš„æ€§èƒ½æŸå¤±ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRedisæä¾›äº† BRPOP å‘½ä»¤ã€‚<strong>BRPOPå‘½ä»¤ä¹Ÿç§°ä¸ºé˜»å¡å¼è¯»å–ï¼Œå®¢æˆ·ç«¯åœ¨æ²¡æœ‰è¯»åˆ°é˜Ÿåˆ—æ•°æ®æ—¶ï¼Œè‡ªåŠ¨é˜»å¡ï¼Œç›´åˆ°æœ‰æ–°çš„æ•°æ®å†™å…¥é˜Ÿåˆ—ï¼Œå†å¼€å§‹è¯»å–æ–°æ•°æ®</strong>ã€‚å’Œæ¶ˆè´¹è€…ç¨‹åºè‡ªå·±ä¸åœåœ°è°ƒç”¨RPOPå‘½ä»¤ç›¸æ¯”ï¼Œè¿™ç§æ–¹å¼èƒ½èŠ‚çœCPUå¼€é”€ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97.png" alt="img"></p><ol start="2"><li>å¦‚ä½•å¤„ç†é‡å¤çš„æ¶ˆæ¯ï¼Ÿ</li></ol><p>æ¶ˆè´¹è€…è¦å®ç°é‡å¤æ¶ˆæ¯çš„åˆ¤æ–­ï¼Œéœ€è¦ 2 ä¸ªæ–¹é¢çš„è¦æ±‚ï¼š</p><ul><li>æ¯ä¸ªæ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªå…¨å±€çš„ IDã€‚</li><li>æ¶ˆè´¹è€…è¦è®°å½•å·²ç»å¤„ç†è¿‡çš„æ¶ˆæ¯çš„ IDã€‚å½“æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯åï¼Œæ¶ˆè´¹è€…ç¨‹åºå°±å¯ä»¥å¯¹æ¯”æ”¶åˆ°çš„æ¶ˆæ¯ ID å’Œè®°å½•çš„å·²å¤„ç†è¿‡çš„æ¶ˆæ¯ IDï¼Œæ¥åˆ¤æ–­å½“å‰æ”¶åˆ°çš„æ¶ˆæ¯æœ‰æ²¡æœ‰ç»è¿‡å¤„ç†ã€‚å¦‚æœå·²ç»å¤„ç†è¿‡ï¼Œé‚£ä¹ˆï¼Œæ¶ˆè´¹è€…ç¨‹åºå°±ä¸å†è¿›è¡Œå¤„ç†äº†ã€‚</li></ul><p>ä½†æ˜¯ <strong>List å¹¶ä¸ä¼šä¸ºæ¯ä¸ªæ¶ˆæ¯ç”Ÿæˆ ID å·ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªè¡Œä¸ºæ¯ä¸ªæ¶ˆæ¯ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€ID</strong>ï¼Œç”Ÿæˆä¹‹åï¼Œæˆ‘ä»¬åœ¨ç”¨ LPUSH å‘½ä»¤æŠŠæ¶ˆæ¯æ’å…¥ List æ—¶ï¼Œéœ€è¦åœ¨æ¶ˆæ¯ä¸­åŒ…å«è¿™ä¸ªå…¨å±€å”¯ä¸€ IDã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°±æŠŠä¸€æ¡å…¨å±€ ID ä¸º 111000102ã€åº“å­˜é‡ä¸º 99 çš„æ¶ˆæ¯æ’å…¥äº†æ¶ˆæ¯é˜Ÿåˆ—ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">LPUSH mq <span class="string">&quot;111000102:stock:99&quot;</span></span></span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure><ol start="3"><li>å¦‚ä½•ä¿è¯æ¶ˆæ¯å¯é æ€§ï¼Ÿ</li></ol><p>å½“æ¶ˆè´¹è€…ç¨‹åºä» List ä¸­è¯»å–ä¸€æ¡æ¶ˆæ¯åï¼ŒList å°±ä¸ä¼šå†ç•™å­˜è¿™æ¡æ¶ˆæ¯äº†ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ¶ˆè´¹è€…ç¨‹åºåœ¨å¤„ç†æ¶ˆæ¯çš„è¿‡ç¨‹å‡ºç°äº†æ•…éšœæˆ–å®•æœºï¼Œå°±ä¼šå¯¼è‡´æ¶ˆæ¯æ²¡æœ‰å¤„ç†å®Œæˆï¼Œé‚£ä¹ˆï¼Œæ¶ˆè´¹è€…ç¨‹åºå†æ¬¡å¯åŠ¨åï¼Œå°±æ²¡æ³•å†æ¬¡ä» List ä¸­è¯»å–æ¶ˆæ¯äº†ã€‚</p><p>ä¸ºäº†ç•™å­˜æ¶ˆæ¯ï¼ŒList ç±»å‹æä¾›äº† <code>BRPOPLPUSH</code> å‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤çš„<strong>ä½œç”¨æ˜¯è®©æ¶ˆè´¹è€…ç¨‹åºä»ä¸€ä¸ª List ä¸­è¯»å–æ¶ˆæ¯ï¼ŒåŒæ—¶ï¼ŒRedis ä¼šæŠŠè¿™ä¸ªæ¶ˆæ¯å†æ’å…¥åˆ°å¦ä¸€ä¸ª Listï¼ˆå¯ä»¥å«ä½œå¤‡ä»½ Listï¼‰ç•™å­˜</strong>ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœæ¶ˆè´¹è€…ç¨‹åºè¯»äº†æ¶ˆæ¯ä½†æ²¡èƒ½æ­£å¸¸å¤„ç†ï¼Œç­‰å®ƒé‡å¯åï¼Œå°±å¯ä»¥ä»å¤‡ä»½ List ä¸­é‡æ–°è¯»å–æ¶ˆæ¯å¹¶è¿›è¡Œå¤„ç†äº†ã€‚</p><p>å¥½äº†ï¼Œåˆ°è¿™é‡Œå¯ä»¥çŸ¥é“åŸºäº List ç±»å‹çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ»¡è¶³æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸‰å¤§éœ€æ±‚ï¼ˆæ¶ˆæ¯ä¿åºã€å¤„ç†é‡å¤çš„æ¶ˆæ¯å’Œä¿è¯æ¶ˆæ¯å¯é æ€§ï¼‰ã€‚</p><ul><li>æ¶ˆæ¯ä¿åºï¼šä½¿ç”¨ LPUSH + RPOPï¼›</li><li>é˜»å¡è¯»å–ï¼šä½¿ç”¨ BRPOPï¼›</li><li>é‡å¤æ¶ˆæ¯å¤„ç†ï¼šç”Ÿäº§è€…è‡ªè¡Œå®ç°å…¨å±€å”¯ä¸€ IDï¼›</li><li>æ¶ˆæ¯çš„å¯é æ€§ï¼šä½¿ç”¨ BRPOPLPUSH</li></ul><blockquote><p>List ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆç¼ºé™·ï¼Ÿ</p></blockquote><p><strong>List ä¸æ”¯æŒå¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹åŒä¸€æ¡æ¶ˆæ¯</strong>ï¼Œå› ä¸ºä¸€æ—¦æ¶ˆè´¹è€…æ‹‰å–ä¸€æ¡æ¶ˆæ¯åï¼Œè¿™æ¡æ¶ˆæ¯å°±ä» List ä¸­åˆ é™¤äº†ï¼Œæ— æ³•è¢«å…¶å®ƒæ¶ˆè´¹è€…å†æ¬¡æ¶ˆè´¹ã€‚</p><p>è¦å®ç°ä¸€æ¡æ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œé‚£ä¹ˆå°±è¦å°†å¤šä¸ªæ¶ˆè´¹è€…ç»„æˆä¸€ä¸ªæ¶ˆè´¹ç»„ï¼Œä½¿å¾—å¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹åŒä¸€æ¡æ¶ˆæ¯ï¼Œä½†æ˜¯ <strong>List ç±»å‹å¹¶ä¸æ”¯æŒæ¶ˆè´¹ç»„çš„å®ç°</strong>ã€‚</p><p>è¿™å°±è¦è¯´èµ· Redis ä» 5.0 ç‰ˆæœ¬å¼€å§‹æä¾›çš„ Stream æ•°æ®ç±»å‹äº†ï¼ŒStream åŒæ ·èƒ½å¤Ÿæ»¡è¶³æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸‰å¤§éœ€æ±‚ï¼Œè€Œä¸”å®ƒè¿˜æ”¯æŒã€Œæ¶ˆè´¹ç»„ã€å½¢å¼çš„æ¶ˆæ¯è¯»å–ã€‚</p><h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><h3 id="æ•°æ®ç»“æ„-ç¼–ç ç±»å‹-1"><a href="#æ•°æ®ç»“æ„-ç¼–ç ç±»å‹-1" class="headerlink" title="æ•°æ®ç»“æ„&amp;&amp;ç¼–ç ç±»å‹"></a>æ•°æ®ç»“æ„&amp;&amp;ç¼–ç ç±»å‹</h3><p>Set ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±<strong>å“ˆå¸Œè¡¨æˆ–æ•´æ•°é›†åˆ</strong>å®ç°çš„ï¼š</p><ul><li>å¦‚æœé›†åˆä¸­çš„å…ƒç´ éƒ½æ˜¯æ•´æ•°ä¸”å…ƒç´ ä¸ªæ•°å°äº <code>512</code> ï¼ˆé»˜è®¤å€¼ï¼Œ<code>set-maxintset-entries</code>é…ç½®ï¼‰ä¸ªï¼ŒRedis ä¼šä½¿ç”¨<strong>æ•´æ•°é›†åˆ</strong>ä½œä¸º Set ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li><li>å¦‚æœé›†åˆä¸­çš„å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢æ¡ä»¶ï¼Œåˆ™ Redis ä½¿ç”¨<strong>å“ˆå¸Œè¡¨</strong>ä½œä¸º Set ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ã€‚</li></ul><blockquote><p>Java ä¸­ HashSet çš„å†…éƒ¨å®ç°ä½¿ç”¨çš„æ˜¯ HashMapï¼Œåªä¸è¿‡æ‰€æœ‰çš„ value éƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚Redis çš„ set ç»“æ„ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå®ƒçš„å†…éƒ¨ä¹Ÿä½¿ç”¨ hash ç»“æ„ï¼Œæ‰€æœ‰çš„ value éƒ½æŒ‡å‘åŒä¸€ä¸ªå†…éƒ¨å€¼ã€‚</p></blockquote><h3 id="å¸¸ç”¨å‘½ä»¤-2"><a href="#å¸¸ç”¨å‘½ä»¤-2" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><p>Redis setæ˜¯stringç±»å‹çš„æ— åºé›†åˆã€‚é›†åˆæˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œè¿™å°±æ„å‘³ç€é›†åˆä¸­ä¸èƒ½å‡ºç°é‡å¤çš„æ•°æ®ï¼Œå¸¸ç”¨å‘½ä»¤:</p><ul><li><p>SADD key member1 [member2]</p><p>å‘é›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</p></li><li><p>SMEMBERS key<br>è¿”å›é›†åˆä¸­çš„æ‰€æœ‰æˆå‘˜</p></li><li><p>SCARD key<br>è·å–é›†åˆçš„æˆå‘˜æ•°</p></li><li><p>SINTER key1 [key2]<br>è¿”å›ç»™å®šæ‰€æœ‰é›†åˆçš„äº¤é›†</p></li><li><p>SUNION key1 [key2]<br>è¿”å›æ‰€æœ‰ç»™å®šé›†åˆçš„å¹¶é›†</p></li><li><p>SDIFF key1 [key2]<br>è¿”å›ç»™å®šæ‰€æœ‰é›†åˆçš„å·®é›†</p></li><li><p>SREM key member1 [member2]</p><p>ç§»é™¤é›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</p></li></ul><h3 id="åº”ç”¨åœºæ™¯-2"><a href="#åº”ç”¨åœºæ™¯-2" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><ol><li>ç‚¹èµï¼šSet ç±»å‹å¯ä»¥ä¿è¯ä¸€ä¸ªç”¨æˆ·åªèƒ½ç‚¹ä¸€ä¸ªèµ</li><li>å…±åŒå…³æ³¨ï¼šSet ç±»å‹æ”¯æŒäº¤é›†è¿ç®—ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ¥è®¡ç®—å…±åŒå…³æ³¨çš„å¥½å‹ã€å…¬ä¼—å·ç­‰</li><li>æŠ½å¥–ï¼šå­˜å‚¨æŸæ´»åŠ¨ä¸­ä¸­å¥–çš„ç”¨æˆ·å ï¼ŒSet ç±»å‹å› ä¸ºæœ‰å»é‡åŠŸèƒ½ï¼Œå¯ä»¥ä¿è¯åŒä¸€ä¸ªç”¨æˆ·ä¸ä¼šä¸­å¥–ä¸¤æ¬¡</li></ol><h2 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h2><h3 id="æ•°æ®ç»“æ„-ç¼–ç ç±»å‹-2"><a href="#æ•°æ®ç»“æ„-ç¼–ç ç±»å‹-2" class="headerlink" title="æ•°æ®ç»“æ„&amp;&amp;ç¼–ç ç±»å‹"></a>æ•°æ®ç»“æ„&amp;&amp;ç¼–ç ç±»å‹</h3><p>Hash ç±»å‹å¯¹åº”çš„æ•°æ®ç»“æ„æ˜¯ä¸¤ç§ï¼š<mark>ziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰ï¼Œhashtableï¼ˆå“ˆå¸Œè¡¨ï¼‰</mark>ã€‚å½“ field-value é•¿åº¦è¾ƒçŸ­ä¸”ä¸ªæ•°è¾ƒå°‘æ—¶ï¼Œä½¿ç”¨ ziplistï¼Œå¦åˆ™ä½¿ç”¨ hashtableã€‚</p><blockquote><p>ä¸zsetå¾ˆç±»ä¼¼ï¼Œå°±æ˜¯å°‘äº†ä¸€ä¸ªè·³è¡¨åšæ’åºåŠŸèƒ½ï¼Œå› ä¸ºHashä¹Ÿç”¨ä¸åˆ°æ’åºã€‚</p><p>å…·ä½“<mark>ä¸ºä»€ä¹ˆziplistæœ¬èº«ä¸æ»¡è¶³é”®å€¼å”¯ä¸€æ€§åˆ¤å®šç­‰æ¡ä»¶è¿˜èƒ½æ‹¿æ¥åšHashçš„åº•å±‚æ•°æ®ç»“æ„çš„åŸå› </mark>åœ¨ä¸‹é¢zsetå¤„å·²ç»è¯´æ˜ï¼Œå¾€ä¸‹é¢çœ‹å°±çœ‹åˆ°äº†ã€‚</p></blockquote><h3 id="å¸¸ç”¨å‘½ä»¤-3"><a href="#å¸¸ç”¨å‘½ä»¤-3" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><p>Redis hashæ˜¯ä¸€ä¸ªstringç±»å‹çš„fieldå’Œvalueçš„æ˜ å°„è¡¨,hashç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ï¼Œå¸¸ç”¨å‘½ä»¤:</p><ul><li>HSET key field value<br>å°†å“ˆå¸Œè¡¨keyä¸­çš„å­—æ®µfieldçš„å€¼è®¾ä¸ºvalue</li><li>HGET key field<br>è·å–å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®šå­—æ®µçš„å€¼</li><li>HDEL key field<br>åˆ é™¤å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­çš„æŒ‡å®šå­—æ®µ</li><li>HKEYS key<br>è·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰å­—æ®µ</li><li>HVALS key<br>è·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰å€¼</li><li>HGETALL key<br>è·å–åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®škeyçš„æ‰€æœ‰å­—æ®µå’Œå€¼</li></ul><h3 id="åº”ç”¨åœºæ™¯-3"><a href="#åº”ç”¨åœºæ™¯-3" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><ol><li>ç¼“å­˜å¯¹è±¡</li><li>è´­ç‰©è½¦ï¼šä»¥ç”¨æˆ· id ä¸º keyï¼Œå•†å“ id ä¸º fieldï¼Œå•†å“æ•°é‡ä¸º valueï¼Œæ°å¥½æ„æˆäº†è´­ç‰©è½¦çš„3ä¸ªè¦ç´ </li></ol><h2 id="ZSet"><a href="#ZSet" class="headerlink" title="ZSet"></a>ZSet</h2><h3 id="æ•°æ®ç»“æ„-ç¼–ç ç±»å‹-3"><a href="#æ•°æ®ç»“æ„-ç¼–ç ç±»å‹-3" class="headerlink" title="æ•°æ®ç»“æ„&amp;&amp;ç¼–ç ç±»å‹"></a>æ•°æ®ç»“æ„&amp;&amp;ç¼–ç ç±»å‹</h3><p>Zset ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±<strong>å‹ç¼©åˆ—è¡¨<mark>æˆ–</mark>è·³è¡¨ï¼ˆè¿˜æœ‰hashï¼‰</strong>å®ç°çš„ï¼š</p><ul><li>å¦‚æœæœ‰åºé›†åˆçš„å…ƒç´ ä¸ªæ•°å°äº <code>128</code> ä¸ªï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ çš„å€¼å°äº <code>64</code> å­—èŠ‚æ—¶ï¼ŒRedis ä¼šä½¿ç”¨<strong>å‹ç¼©åˆ—è¡¨</strong>ä½œä¸º Zset ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li><li>å¦‚æœæœ‰åºé›†åˆçš„å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢çš„æ¡ä»¶ï¼ŒRedis ä¼šä½¿ç”¨<strong>è·³è¡¨</strong>ä½œä¸º Zset ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li></ul><p><strong>åœ¨ Redis 7.0 ä¸­ï¼Œå‹ç¼©åˆ—è¡¨æ•°æ®ç»“æ„å·²ç»åºŸå¼ƒäº†ï¼Œäº¤ç”± listpack æ•°æ®ç»“æ„æ¥å®ç°äº†</strong></p><p>ğŸŒˆè¡¥å……1ï¼š</p><blockquote><p>è¿™é‡Œè¯´çš„è·³è¡¨å…¶å®ä¸å‡†ç¡®ï¼Œå…¶å®è·³è¡¨è¿˜ç»“åˆäº†hashæ¥ä¸€èµ·è¿›è¡Œæ“ä½œã€‚</p><p>å› ä¸ºè·³è¡¨å¯ä»¥æ ¹æ®scoreè¿›è¡Œæ’åºåœ°æŸ¥æ‰¾scoreï¼ˆå¯èŒƒå›´æŸ¥è¯¢ï¼‰ï¼Œä½†æ˜¯è¿˜è¦ç»“åˆhashæ¥è¿›è¡Œå¿«é€Ÿåœ°é”®å€¼çš„å”¯ä¸€æ€§åˆ¤æ–­å’Œæ ¹æ®keyï¼ˆmemberï¼‰æ¥æ‰¾valueï¼ˆscoreï¼‰ã€‚ä½†æ˜¯hashä¹‹å äº†å…¶ä¸­çš„ä¸€å°éƒ¨åˆ†ï¼Œä¸”åœ¨RedisObjectæ•°æ®ç»“æ„ä¸­çš„typeç±»å‹ä¸Šä¹Ÿåªèƒ½å¡«ä¸€ä¸ªï¼Œæ•…é€‰æ‹©äº†è·³è¡¨ã€‚ä½†æ˜¯å…¶å®<mark>hashä¹Ÿæ˜¯ç¼ºä¸€ä¸å¯</mark>çš„ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// zsetç»“æ„</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zset</span> &#123;</span></span><br><span class="line">    <span class="comment">// DictæŒ‡é’ˆ</span></span><br><span class="line">    dict *dict;</span><br><span class="line">    <span class="comment">// SkipListæŒ‡é’ˆ</span></span><br><span class="line">    zskiplist *zsl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231105163630045.png" alt="dict+skiplist"></p><p>ğŸŒˆè¡¥å……2ï¼šziplistæ²¡æœ‰ä¸Šé¢é‚£äº›ç‰¹æ€§ï¼Œ<strong>ä¸ºä»€ä¹ˆè¿˜èƒ½æ‹¿æ¥å­˜zsetæ•°æ®ï¼Ÿ</strong></p><p>ziplistæœ¬èº«æ²¡æœ‰æ’åºåŠŸèƒ½ï¼Œè€Œä¸”æ²¡æœ‰é”®å€¼å¯¹çš„æ¦‚å¿µï¼Œå› æ­¤éœ€è¦æœ‰zseté€šè¿‡ç¼–ç å®ç°</p><ul><li>ZipListæ˜¯è¿ç»­å†…å­˜ï¼Œå› æ­¤scoreå’Œelementæ˜¯ç´§æŒ¨åœ¨ä¸€èµ·çš„ä¸¤ä¸ªentryï¼Œelementåœ¨å‰ï¼Œscoreåœ¨å</li><li>scoreè¶Šå°è¶Šæ¥è¿‘é˜Ÿé¦–ï¼Œscoreè¶Šå¤§è¶Šæ¥è¿‘é˜Ÿå°¾ï¼ŒæŒ‰ç…§scoreå€¼å‡åºæ’åˆ—</li></ul><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231105165009210.png" alt="ziplist"></p><h3 id="å¸¸ç”¨å‘½ä»¤-4"><a href="#å¸¸ç”¨å‘½ä»¤-4" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><p>Redis sorted setæœ‰åºé›†åˆæ˜¯stringç±»å‹å…ƒç´ çš„é›†åˆï¼Œä¸”ä¸å…è®¸é‡å¤çš„æˆå‘˜ã€‚æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ªdoubleç±»å‹çš„åˆ†æ•°(score)ã€‚redisæ­£æ˜¯é€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»å°åˆ°å¤§æ’åºã€‚æœ‰åºé›†åˆçš„æˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œä½†åˆ†æ•°å´å¯ä»¥é‡å¤ã€‚å¸¸ç”¨å‘½ä»¤:</p><ul><li>ZADD key score1 member1 [score2 member2]<br>å‘æœ‰åºé›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ï¼Œæˆ–è€…æ›´æ–°å·²å­˜åœ¨æˆå‘˜çš„åˆ†æ•°</li><li>ZRANGE key start stop [WITHSCORES]<br>é€šè¿‡ç´¢å¼•åŒºé—´è¿”å›æœ‰åºé›†åˆä¸­æŒ‡å®šåŒºé—´å†…çš„æˆå‘˜</li><li>ZINCRBY key increment member<br>æœ‰åºé›†åˆä¸­å¯¹æŒ‡å®šæˆå‘˜çš„åˆ†æ•°åŠ ä¸Šå¢é‡increment</li><li>ZREM key member [member â€¦]<br>ç§»é™¤æœ‰åºé›†åˆä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</li></ul><h3 id="åº”ç”¨åœºæ™¯-4"><a href="#åº”ç”¨åœºæ™¯-4" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><ol><li>æ’è¡Œæ¦œï¼šæœ‰åºé›†åˆæ¯”è¾ƒå…¸å‹çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯æ’è¡Œæ¦œ</li></ol><blockquote><p>ğŸŒˆé»‘é©¬ç‚¹è¯„ä¸­çš„ç‚¹èµæ’è¡Œæ¦œï¼š</p></blockquote><p>é‡‡ç”¨zsetç±»å‹çš„æ•°æ®ç»“æ„åŸå› ï¼š</p><ol><li>å¯æ’åº</li><li>å”¯ä¸€</li><li>åˆ—è¡¨</li></ol><p>ä½†æ˜¯SQLè¯­å¥æŸ¥è¯¢å‡ºæ¥çš„ç»“æœå¹¶ä¸æ˜¯æŒ‰ç…§æˆ‘ä»¬æœŸæœ›çš„æ–¹å¼è¿›è¡Œæ’ï¼Œå³ä¸æŒ‰æ—¶é—´æ’åºï¼Œå› ä¸ºä½¿ç”¨äº†inæ¥è¿›è¡ŒæŸ¥è¯¢ï¼Œæœ€åæ ¹æ®idå‡åºæ’ï¼Œä½†å…¶å®åº”è¯¥æŒ‰æ—¶é—´å‡åºæ’åºï¼Œæ‰€ä»¥å¯ä»¥é‡‡ç”¨<code>order by field(id, ids[0], ids[1] ...)</code>çš„æ–¹å¼è¿›è¡Œæ’åº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">queryBlogLikes</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;blog:like:&quot;</span> + id;</span><br><span class="line">        <span class="comment">//zrange key 0 4  æŸ¥è¯¢zsetä¸­å‰5ä¸ªå…ƒç´ </span></span><br><span class="line">        Set&lt;String&gt; top5 = stringRedisTemplate.opsForZSet().range(key, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">        <span class="comment">//å¦‚æœæ˜¯ç©ºçš„(å¯èƒ½æ²¡äººç‚¹èµ)ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªç©ºé›†åˆ</span></span><br><span class="line">        <span class="keyword">if</span> (top5 == <span class="literal">null</span> || top5.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Long&gt; ids = top5.stream().map(Long::valueOf).collect(Collectors.toList());</span><br><span class="line">        <span class="comment">//å°†idsä½¿ç”¨`,`æ‹¼æ¥ï¼ŒSQLè¯­å¥æŸ¥è¯¢å‡ºæ¥çš„ç»“æœå¹¶ä¸æ˜¯æŒ‰ç…§æˆ‘ä»¬æœŸæœ›çš„æ–¹å¼è¿›è¡Œæ’</span></span><br><span class="line">        <span class="comment">//æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨order by fieldæ¥æŒ‡å®šæ’åºæ–¹å¼ï¼ŒæœŸæœ›çš„æ’åºæ–¹å¼å°±æ˜¯æŒ‰ç…§æŸ¥è¯¢å‡ºæ¥çš„idè¿›è¡Œæ’åº</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">idsStr</span> <span class="operator">=</span> StrUtil.join(<span class="string">&quot;,&quot;</span>, ids);</span><br><span class="line">        <span class="comment">//select * from tb_user where id in (ids[0], ids[1] ...) order by field(id, ids[0], ids[1] ...)</span></span><br><span class="line">        List&lt;UserDTO&gt; userDTOS = userService.query().in(<span class="string">&quot;id&quot;</span>, ids)</span><br><span class="line">                .last(<span class="string">&quot;order by field(id,&quot;</span> + idsStr + <span class="string">&quot;)&quot;</span>)</span><br><span class="line">                .list().stream()</span><br><span class="line">                .map(user -&gt; BeanUtil.copyProperties(user, UserDTO.class))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> Result.ok(userDTOS);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> id <span class="keyword">in</span> (ids[<span class="number">0</span>], ids[<span class="number">1</span>] ...) <span class="keyword">order</span> <span class="keyword">by</span> field(id, ids[<span class="number">0</span>], ids[<span class="number">1</span>] ...)</span><br></pre></td></tr></table></figure><h2 id="BitMap"><a href="#BitMap" class="headerlink" title="BitMap"></a>BitMap</h2><h3 id="æ•°æ®ç»“æ„-1"><a href="#æ•°æ®ç»“æ„-1" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p>Bitmap æœ¬èº«æ˜¯ç”¨ String ç±»å‹ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„å®ç°çš„ä¸€ç§ç»Ÿè®¡äºŒå€¼çŠ¶æ€çš„æ•°æ®ç±»å‹ã€‚</p><p>String ç±»å‹æ˜¯ä¼šä¿å­˜ä¸ºäºŒè¿›åˆ¶çš„å­—èŠ‚æ•°ç»„ï¼Œæ‰€ä»¥ï¼ŒRedis å°±æŠŠå­—èŠ‚æ•°ç»„çš„æ¯ä¸ª bit ä½åˆ©ç”¨èµ·æ¥ï¼Œç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå…ƒç´ çš„äºŒå€¼çŠ¶æ€ï¼Œä½ å¯ä»¥æŠŠ Bitmap çœ‹ä½œæ˜¯ä¸€ä¸ª bit æ•°ç»„ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231024110252548.png" alt="image-20231024110252548"></p><h3 id="åº”ç”¨åœºæ™¯-5"><a href="#åº”ç”¨åœºæ™¯-5" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><ol><li>ç­¾åˆ°ç»Ÿè®¡</li><li>åˆ¤æ–­ç”¨æˆ·ç™»å½•æ€</li><li>è¿ç»­ç­¾åˆ°ç”¨æˆ·æ€»æ•°</li></ol><h2 id="HyperLogLog"><a href="#HyperLogLog" class="headerlink" title="HyperLogLog"></a>HyperLogLog</h2><h3 id="åº”ç”¨åœºæ™¯-6"><a href="#åº”ç”¨åœºæ™¯-6" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><p>UVç»Ÿè®¡</p><h2 id="GEO"><a href="#GEO" class="headerlink" title="GEO"></a>GEO</h2><h3 id="æ•°æ®ç»“æ„-2"><a href="#æ•°æ®ç»“æ„-2" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p>GEO æœ¬èº«å¹¶æ²¡æœ‰è®¾è®¡æ–°çš„åº•å±‚æ•°æ®ç»“æ„ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨äº† Sorted Set é›†åˆç±»å‹ã€‚</p><p>GEO ç±»å‹ä½¿ç”¨ GeoHash ç¼–ç æ–¹æ³•å®ç°äº†ç»çº¬åº¦åˆ° Sorted Set ä¸­å…ƒç´ æƒé‡åˆ†æ•°çš„è½¬æ¢ï¼Œè¿™å…¶ä¸­çš„ä¸¤ä¸ªå…³é”®æœºåˆ¶å°±æ˜¯ã€Œå¯¹äºŒç»´åœ°å›¾åšåŒºé—´åˆ’åˆ†ã€å’Œã€Œå¯¹åŒºé—´è¿›è¡Œç¼–ç ã€ã€‚ä¸€ç»„ç»çº¬åº¦è½åœ¨æŸä¸ªåŒºé—´åï¼Œå°±ç”¨åŒºé—´çš„ç¼–ç å€¼æ¥è¡¨ç¤ºï¼Œå¹¶æŠŠç¼–ç å€¼ä½œä¸º Sorted Set å…ƒç´ çš„æƒé‡åˆ†æ•°ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠç»çº¬åº¦ä¿å­˜åˆ° Sorted Set ä¸­ï¼Œåˆ©ç”¨ Sorted Set æä¾›çš„â€œæŒ‰æƒé‡è¿›è¡Œæœ‰åºèŒƒå›´æŸ¥æ‰¾â€çš„ç‰¹æ€§ï¼Œå®ç° LBS æœåŠ¡ä¸­é¢‘ç¹ä½¿ç”¨çš„â€œæœç´¢é™„è¿‘â€çš„éœ€æ±‚ã€‚</p><h3 id="åº”ç”¨åœºæ™¯-7"><a href="#åº”ç”¨åœºæ™¯-7" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><p>é™„è¿‘çš„äºº</p><h2 id="stream"><a href="#stream" class="headerlink" title="stream"></a>stream</h2><p>Redis Stream æ˜¯ Redis 5.0 ç‰ˆæœ¬æ–°å¢åŠ çš„æ•°æ®ç±»å‹ï¼ŒRedis ä¸“é—¨ä¸ºæ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡çš„æ•°æ®ç±»å‹ã€‚</p><p>åœ¨ Redis 5.0 Stream æ²¡å‡ºæ¥ä¹‹å‰ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„å®ç°æ–¹å¼éƒ½æœ‰ç€å„è‡ªçš„ç¼ºé™·ï¼Œä¾‹å¦‚ï¼š</p><ul><li>å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œä¸èƒ½æŒä¹…åŒ–ä¹Ÿå°±æ— æ³•å¯é çš„ä¿å­˜æ¶ˆæ¯ï¼Œå¹¶ä¸”å¯¹äºç¦»çº¿é‡è¿çš„å®¢æˆ·ç«¯ä¸èƒ½è¯»å–å†å²æ¶ˆæ¯çš„ç¼ºé™·ï¼›</li><li>List å®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼ä¸èƒ½é‡å¤æ¶ˆè´¹ï¼Œä¸€ä¸ªæ¶ˆæ¯æ¶ˆè´¹å®Œå°±ä¼šè¢«åˆ é™¤ï¼Œè€Œä¸”ç”Ÿäº§è€…éœ€è¦è‡ªè¡Œå®ç°å…¨å±€å”¯ä¸€ IDã€‚</li></ul><h2 id="é€šç”¨å‘½ä»¤"><a href="#é€šç”¨å‘½ä»¤" class="headerlink" title="é€šç”¨å‘½ä»¤"></a>é€šç”¨å‘½ä»¤</h2><ul><li>KEYS pattern<br>æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼( pattern)çš„ key</li><li>EXISTS key<br>æ£€æŸ¥ç»™å®škeyæ˜¯å¦å­˜åœ¨</li><li>TYPE key<br>è¿”å›keyæ‰€å‚¨å­˜çš„å€¼çš„ç±»å‹</li><li>TTL key<br>è¿”å›ç»™å®š keyçš„å‰©ä½™ç”Ÿå­˜æ—¶é—´(TTL, time to live)ï¼Œä»¥ç§’ä¸ºå•ä½</li><li>DEL key<br>è¯¥å‘½ä»¤ç”¨äºåœ¨keyå­˜åœ¨æ˜¯åˆ é™¤key</li></ul><h1 id="Redisåº•å±‚æ•°æ®ç»“æ„"><a href="#Redisåº•å±‚æ•°æ®ç»“æ„" class="headerlink" title="Redisåº•å±‚æ•°æ®ç»“æ„"></a>Redisåº•å±‚æ•°æ®ç»“æ„</h1><p> Redis æ•°æ®ç±»å‹ï¼ˆä¹Ÿå« Redis å¯¹è±¡ï¼‰å’Œåº•å±‚æ•°æ®ç»“æ„çš„å¯¹åº”å…³ç³»å›¾</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231105171016673.png" alt="å¯¹åº”å…³ç³»å›¾"></p><h2 id="SDS"><a href="#SDS" class="headerlink" title="SDS"></a>SDS</h2><h3 id="Cå­—ç¬¦ä¸²çš„ç¼ºç‚¹"><a href="#Cå­—ç¬¦ä¸²çš„ç¼ºç‚¹" class="headerlink" title="Cå­—ç¬¦ä¸²çš„ç¼ºç‚¹"></a>Cå­—ç¬¦ä¸²çš„ç¼ºç‚¹</h3><p>Redisæ˜¯ç”¨Cè¯­è¨€ç¼–å†™çš„ï¼Œä½†æ˜¯ä¸ç›´æ¥ä½¿ç”¨Cè¯­è¨€çš„å­—ç¬¦ä¸²ï¼Œæ˜¯å› ä¸ºå…¶æœ¬èº«æœ‰å‡ å¤„ç¼ºç‚¹</p><p>C è¯­è¨€çš„å­—ç¬¦ä¸²ä¸è¶³ä¹‹å¤„ä»¥åŠå¯ä»¥æ”¹è¿›çš„åœ°æ–¹ï¼š</p><ul><li>è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦ä¸º Oï¼ˆNï¼‰ï¼›</li><li>å­—ç¬¦ä¸²çš„ç»“å°¾æ˜¯ä»¥ â€œ\0â€ å­—ç¬¦æ ‡è¯†ï¼Œå­—ç¬¦ä¸²é‡Œé¢ä¸èƒ½åŒ…å«æœ‰ â€œ\0â€ å­—ç¬¦ï¼Œå› æ­¤ä¸èƒ½ä¿å­˜äºŒè¿›åˆ¶æ•°æ®ï¼›</li><li>å­—ç¬¦ä¸²æ“ä½œå‡½æ•°ä¸é«˜æ•ˆä¸”ä¸å®‰å…¨ï¼Œæ¯”å¦‚æœ‰ç¼“å†²åŒºæº¢å‡ºçš„é£é™©ï¼Œæœ‰å¯èƒ½ä¼šé€ æˆç¨‹åºè¿è¡Œç»ˆæ­¢ï¼›</li></ul><h3 id="SDSæ•°æ®ç»“æ„"><a href="#SDSæ•°æ®ç»“æ„" class="headerlink" title="SDSæ•°æ®ç»“æ„"></a>SDSæ•°æ®ç»“æ„</h3><p>SDSæ•°æ®ç»“æ„å›¾ï¼š</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231031113454318.png" alt="SDSæ•°æ®ç»“æ„"></p><p>ç»“æ„ä¸­çš„æ¯ä¸ªæˆå‘˜å˜é‡åˆ†åˆ«ä»‹ç»ä¸‹ï¼š</p><ul><li><strong>lenï¼Œè®°å½•äº†å­—ç¬¦ä¸²é•¿åº¦</strong>ã€‚è¿™æ ·è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶å€™ï¼Œåªéœ€è¦è¿”å›è¿™ä¸ªæˆå‘˜å˜é‡å€¼å°±è¡Œï¼Œæ—¶é—´å¤æ‚åº¦åªéœ€è¦ Oï¼ˆ1ï¼‰ã€‚</li><li><strong>allocï¼Œåˆ†é…ç»™å­—ç¬¦æ•°ç»„çš„ç©ºé—´é•¿åº¦</strong>ã€‚è¿™æ ·åœ¨ä¿®æ”¹å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ <code>alloc - len</code> è®¡ç®—å‡ºå‰©ä½™çš„ç©ºé—´å¤§å°ï¼Œå¯ä»¥ç”¨æ¥åˆ¤æ–­ç©ºé—´æ˜¯å¦æ»¡è¶³ä¿®æ”¹éœ€æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³çš„è¯ï¼Œå°±ä¼šè‡ªåŠ¨å°† SDS çš„<mark>ç©ºé—´æ‰©å±•</mark>è‡³æ‰§è¡Œä¿®æ”¹æ‰€éœ€çš„å¤§å°ï¼Œç„¶åæ‰æ‰§è¡Œå®é™…çš„ä¿®æ”¹æ“ä½œï¼Œæ‰€ä»¥ä½¿ç”¨ SDS æ—¢ä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ SDS çš„ç©ºé—´å¤§å°ï¼Œä¹Ÿä¸ä¼šå‡ºç°å‰é¢æ‰€è¯´çš„ç¼“å†²åŒºæº¢å‡ºçš„é—®é¢˜ã€‚</li><li><strong>flagsï¼Œç”¨æ¥è¡¨ç¤ºä¸åŒç±»å‹çš„ SDS</strong>ã€‚ä¸€å…±è®¾è®¡äº† 5 ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ sdshdr5ã€sdshdr8ã€sdshdr16ã€sdshdr32 å’Œ sdshdr64ï¼Œåé¢åœ¨è¯´æ˜åŒºåˆ«ä¹‹å¤„ã€‚</li><li><strong>buf[]ï¼Œå­—ç¬¦æ•°ç»„ï¼Œç”¨æ¥ä¿å­˜å®é™…æ•°æ®</strong>ã€‚ä¸ä»…å¯ä»¥ä¿å­˜å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä¿å­˜äºŒè¿›åˆ¶æ•°æ®ã€‚</li></ul><h3 id="è‡ªåŠ¨æ‰©å®¹"><a href="#è‡ªåŠ¨æ‰©å®¹" class="headerlink" title="è‡ªåŠ¨æ‰©å®¹"></a>è‡ªåŠ¨æ‰©å®¹</h3><p>å½“åˆ¤æ–­å‡ºç¼“å†²åŒºå¤§å°ä¸å¤Ÿç”¨æ—¶ï¼ŒRedis ä¼šè‡ªåŠ¨å°†æ‰©å¤§ SDS çš„ç©ºé—´å¤§å°</p><ul><li>å¦‚æœæ‰€éœ€çš„ sds é•¿åº¦<strong>å°äº 1 MB</strong>ï¼Œé‚£ä¹ˆæœ€åçš„æ‰©å®¹æ˜¯æŒ‰ç…§<strong>ç¿»å€æ‰©å®¹</strong>æ¥æ‰§è¡Œçš„ï¼Œå³ 2 å€çš„newlen</li><li>å¦‚æœæ‰€éœ€çš„ sds é•¿åº¦<strong>è¶…è¿‡ 1 MB</strong>ï¼Œé‚£ä¹ˆæœ€åçš„æ‰©å®¹é•¿åº¦åº”è¯¥æ˜¯ newlen <strong>+ 1MB</strong>ã€‚</li></ul><p>åœ¨æ‰©å®¹ SDS ç©ºé—´ä¹‹å‰ï¼ŒSDS API ä¼šä¼˜å…ˆæ£€æŸ¥æœªä½¿ç”¨ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œå¦‚æœä¸å¤Ÿçš„è¯ï¼ŒAPI ä¸ä»…ä¼šä¸º SDS åˆ†é…ä¿®æ”¹æ‰€å¿…é¡»è¦çš„ç©ºé—´ï¼Œè¿˜ä¼šç»™ SDS åˆ†é…é¢å¤–çš„ã€Œæœªä½¿ç”¨ç©ºé—´ã€ã€‚</p><p>è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œä¸‹æ¬¡åœ¨æ“ä½œ SDS æ—¶ï¼Œå¦‚æœ SDS ç©ºé—´å¤Ÿçš„è¯ï¼ŒAPI å°±ä¼šç›´æ¥ä½¿ç”¨ã€Œæœªä½¿ç”¨ç©ºé—´ã€ï¼Œè€Œæ— é¡»æ‰§è¡Œå†…å­˜åˆ†é…ï¼Œ<mark><strong>æœ‰æ•ˆçš„å‡å°‘å†…å­˜åˆ†é…æ¬¡æ•°</strong></mark>ã€‚</p><h3 id="èŠ‚çœå†…å­˜ç©ºé—´"><a href="#èŠ‚çœå†…å­˜ç©ºé—´" class="headerlink" title="èŠ‚çœå†…å­˜ç©ºé—´"></a>èŠ‚çœå†…å­˜ç©ºé—´</h3><p>SDS ç»“æ„ä¸­æœ‰ä¸ª flags æˆå‘˜å˜é‡ï¼Œè¡¨ç¤ºçš„æ˜¯ SDS ç±»å‹ã€‚</p><p>Redis ä¸€å…±è®¾è®¡äº† 5 ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ sdshdr5ã€sdshdr8ã€sdshdr16ã€sdshdr32 å’Œ sdshdr64ã€‚</p><p>è¿™ 5 ç§ç±»å‹çš„ä¸»è¦<strong>åŒºåˆ«å°±åœ¨äºï¼Œå®ƒä»¬æ•°æ®ç»“æ„ä¸­çš„ len å’Œ alloc æˆå‘˜å˜é‡çš„æ•°æ®ç±»å‹ä¸åŒ</strong>ã€‚</p><p>æ¯”å¦‚ sdshdr16 å’Œ sdshdr32 è¿™ä¸¤ä¸ªç±»å‹ï¼Œå®ƒä»¬çš„å®šä¹‰åˆ†åˆ«å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">attribute__</span> ((__<span class="title">packed__</span>)) <span class="title">sdshdr16</span> &#123;</span></span><br><span class="line">    <span class="type">uint16_t</span> len;</span><br><span class="line">    <span class="type">uint16_t</span> alloc; </span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> flags; </span><br><span class="line">    <span class="type">char</span> buf[];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">attribute__</span> ((__<span class="title">packed__</span>)) <span class="title">sdshdr32</span> &#123;</span></span><br><span class="line">    <span class="type">uint32_t</span> len;</span><br><span class="line">    <span class="type">uint32_t</span> alloc; </span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> flags;</span><br><span class="line">    <span class="type">char</span> buf[];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼š</p><ul><li>sdshdr16 ç±»å‹çš„ len å’Œ alloc çš„æ•°æ®ç±»å‹éƒ½æ˜¯ uint16_tï¼Œè¡¨ç¤ºå­—ç¬¦æ•°ç»„é•¿åº¦å’Œåˆ†é…ç©ºé—´å¤§å°ä¸èƒ½è¶…è¿‡ 2 çš„ 16 æ¬¡æ–¹ã€‚</li><li>sdshdr32 åˆ™éƒ½æ˜¯ uint32_tï¼Œè¡¨ç¤ºè¡¨ç¤ºå­—ç¬¦æ•°ç»„é•¿åº¦å’Œåˆ†é…ç©ºé—´å¤§å°ä¸èƒ½è¶…è¿‡ 2 çš„ 32 æ¬¡æ–¹ã€‚</li></ul><p><mark><strong>ä¹‹æ‰€ä»¥ SDS è®¾è®¡ä¸åŒç±»å‹çš„ç»“æ„ä½“ï¼Œæ˜¯ä¸ºäº†èƒ½çµæ´»ä¿å­˜ä¸åŒå¤§å°çš„å­—ç¬¦ä¸²ï¼Œä»è€Œæœ‰æ•ˆèŠ‚çœå†…å­˜ç©ºé—´</strong></mark>ã€‚æ¯”å¦‚ï¼Œåœ¨ä¿å­˜å°å­—ç¬¦ä¸²æ—¶ï¼Œç»“æ„å¤´å ç”¨ç©ºé—´ä¹Ÿæ¯”è¾ƒå°‘ã€‚</p><p>é™¤äº†è®¾è®¡ä¸åŒç±»å‹çš„ç»“æ„ä½“ï¼ŒRedis åœ¨ç¼–ç¨‹ä¸Šè¿˜<strong>ä½¿ç”¨äº†ä¸“é—¨çš„ç¼–è¯‘ä¼˜åŒ–æ¥èŠ‚çœå†…å­˜ç©ºé—´</strong>ï¼Œå³åœ¨ struct å£°æ˜äº† <code>__attribute__ ((packed))</code> ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼š<mark><strong>å‘Šè¯‰ç¼–è¯‘å™¨å–æ¶ˆç»“æ„ä½“åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­çš„ä¼˜åŒ–å¯¹é½ï¼ŒæŒ‰ç…§å®é™…å ç”¨å­—èŠ‚æ•°è¿›è¡Œå¯¹é½</strong></mark>ã€‚</p><p>æ¯”å¦‚ï¼Œsdshdr16 ç±»å‹çš„ SDSï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¼šæŒ‰ç…§ 2 å­—èŠ‚å¯¹é½çš„æ–¹å¼ç»™å˜é‡åˆ†é…å†…å­˜ï¼Œè¿™æ„å‘³ç€ï¼Œå³ä½¿ä¸€ä¸ªå˜é‡çš„å¤§å°ä¸åˆ° 2 ä¸ªå­—èŠ‚ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šç»™å®ƒåˆ†é… 2 ä¸ªå­—èŠ‚ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä¸‹é¢è¿™ä¸ªç»“æ„ä½“ï¼Œå®ƒæœ‰ä¸¤ä¸ªæˆå‘˜å˜é‡ï¼Œç±»å‹åˆ†åˆ«æ˜¯ char å’Œ intï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">test1</span> &#123;</span></span><br><span class="line">    <span class="type">char</span> a;</span><br><span class="line">    <span class="type">int</span> b;</span><br><span class="line"> &#125; test1;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">&quot;%lu\n&quot;</span>, <span class="keyword">sizeof</span>(test1));</span><br><span class="line">     <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤§å®¶çŒœçŒœè¿™ä¸ªç»“æ„ä½“å¤§å°æ˜¯å¤šå°‘ï¼Ÿæˆ‘å…ˆç›´æ¥è¯´ç­”æ¡ˆï¼Œè¿™ä¸ªç»“æ„ä½“å¤§å°è®¡ç®—å‡ºæ¥æ˜¯ 8ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/35820959e8cf4376391c427ed7f81495.png" alt="img"></p><p>è¿™æ˜¯å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨æ˜¯ä½¿ç”¨ã€Œå­—èŠ‚å¯¹é½ã€çš„æ–¹å¼åˆ†é…å†…å­˜ï¼Œè™½ç„¶ char ç±»å‹åªå ä¸€ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯ç”±äºæˆå‘˜å˜é‡é‡Œæœ‰ int ç±»å‹ï¼Œå®ƒå ç”¨äº† 4 ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥åœ¨æˆå‘˜å˜é‡ä¸º char ç±»å‹åˆ†é…å†…å­˜æ—¶ï¼Œä¼šåˆ†é… 4 ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­è¿™å¤šä½™çš„ 3 ä¸ªå­—èŠ‚æ˜¯ä¸ºäº†å­—èŠ‚å¯¹é½è€Œåˆ†é…çš„ï¼Œç›¸å½“äºæœ‰ 3 ä¸ªå­—èŠ‚è¢«æµªè´¹æ‰äº†ã€‚</p><p>å¦‚æœä¸æƒ³ç¼–è¯‘å™¨ä½¿ç”¨å­—èŠ‚å¯¹é½çš„æ–¹å¼è¿›è¡Œåˆ†é…å†…å­˜ï¼Œå¯ä»¥é‡‡ç”¨äº† <code>__attribute__ ((packed))</code> å±æ€§å®šä¹‰ç»“æ„ä½“ï¼Œè¿™æ ·ä¸€æ¥ï¼Œç»“æ„ä½“å®é™…å ç”¨å¤šå°‘å†…å­˜ç©ºé—´ï¼Œç¼–è¯‘å™¨å°±åˆ†é…å¤šå°‘ç©ºé—´ã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘ç”¨ <code>__attribute__ ((packed))</code> å±æ€§å®šä¹‰ä¸‹é¢çš„ç»“æ„ä½“ ï¼ŒåŒæ ·åŒ…å« char å’Œ int ä¸¤ä¸ªç±»å‹çš„æˆå‘˜å˜é‡ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">attribute__</span>((<span class="title">packed</span>)) <span class="title">test2</span>  &#123;</span></span><br><span class="line">    <span class="type">char</span> a;</span><br><span class="line">    <span class="type">int</span> b;</span><br><span class="line"> &#125; test2;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">&quot;%lu\n&quot;</span>, <span class="keyword">sizeof</span>(test2));</span><br><span class="line">     <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶æ‰“å°çš„ç»“æœæ˜¯ 5ï¼ˆ1 ä¸ªå­—èŠ‚ char + 4 å­—èŠ‚ intï¼‰ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/47e6c8fbc17fd6c89bdfcb5eedaaacff.png" alt="img"></p><p>å¯ä»¥çœ‹å¾—å‡ºï¼Œè¿™æ˜¯<mark>æŒ‰ç…§å®é™…å ç”¨å­—èŠ‚æ•°è¿›è¡Œåˆ†é…å†…å­˜</mark>çš„ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´ã€‚</p><h2 id="åŒå‘é“¾è¡¨"><a href="#åŒå‘é“¾è¡¨" class="headerlink" title="åŒå‘é“¾è¡¨"></a>åŒå‘é“¾è¡¨</h2><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231031131040258.png" alt="åŒå‘é“¾è¡¨"></p><h3 id="é“¾è¡¨çš„ä¼˜åŠ¿ä¸ç¼ºé™·"><a href="#é“¾è¡¨çš„ä¼˜åŠ¿ä¸ç¼ºé™·" class="headerlink" title="é“¾è¡¨çš„ä¼˜åŠ¿ä¸ç¼ºé™·"></a>é“¾è¡¨çš„ä¼˜åŠ¿ä¸ç¼ºé™·</h3><p>Redis çš„é“¾è¡¨å®ç°ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li>listNode é“¾è¡¨èŠ‚ç‚¹çš„ç»“æ„é‡Œå¸¦æœ‰ prev å’Œ next æŒ‡é’ˆï¼Œ<strong>è·å–æŸä¸ªèŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹æˆ–åç½®èŠ‚ç‚¹çš„æ—¶é—´å¤æ‚åº¦åªéœ€O(1)ï¼Œè€Œä¸”è¿™ä¸¤ä¸ªæŒ‡é’ˆéƒ½å¯ä»¥æŒ‡å‘ NULLï¼Œæ‰€ä»¥é“¾è¡¨æ˜¯æ— ç¯é“¾è¡¨</strong>ï¼›</li><li>list ç»“æ„å› ä¸ºæä¾›äº†è¡¨å¤´æŒ‡é’ˆ head å’Œè¡¨å°¾èŠ‚ç‚¹ tailï¼Œæ‰€ä»¥**è·å–é“¾è¡¨çš„è¡¨å¤´èŠ‚ç‚¹å’Œè¡¨å°¾èŠ‚ç‚¹çš„æ—¶é—´å¤æ‚åº¦åªéœ€O(1)**ï¼›</li><li>list ç»“æ„å› ä¸ºæä¾›äº†é“¾è¡¨èŠ‚ç‚¹æ•°é‡ lenï¼Œæ‰€ä»¥**è·å–é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ•°é‡çš„æ—¶é—´å¤æ‚åº¦åªéœ€O(1)**ï¼›</li><li>listNode é“¾è¡¨èŠ‚ä½¿ç”¨ void* æŒ‡é’ˆä¿å­˜èŠ‚ç‚¹å€¼ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ list ç»“æ„çš„ dupã€freeã€match å‡½æ•°æŒ‡é’ˆä¸ºèŠ‚ç‚¹è®¾ç½®è¯¥èŠ‚ç‚¹ç±»å‹ç‰¹å®šçš„å‡½æ•°ï¼Œå› æ­¤<strong>é“¾è¡¨èŠ‚ç‚¹å¯ä»¥ä¿å­˜å„ç§ä¸åŒç±»å‹çš„å€¼</strong>ï¼›</li></ul><p>é“¾è¡¨çš„ç¼ºé™·ä¹Ÿæ˜¯æœ‰çš„ï¼š</p><ul><li>é“¾è¡¨æ¯ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„å†…å­˜éƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œæ„å‘³ç€<strong>æ— æ³•å¾ˆå¥½åˆ©ç”¨ CPU ç¼“å­˜</strong>ã€‚èƒ½å¾ˆå¥½åˆ©ç”¨ CPU ç¼“å­˜çš„æ•°æ®ç»“æ„å°±æ˜¯æ•°ç»„ï¼Œå› ä¸ºæ•°ç»„çš„å†…å­˜æ˜¯è¿ç»­çš„ï¼Œè¿™æ ·å°±å¯ä»¥å……åˆ†åˆ©ç”¨ CPU ç¼“å­˜æ¥åŠ é€Ÿè®¿é—®ã€‚</li><li>è¿˜æœ‰ä¸€ç‚¹ï¼Œä¿å­˜ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹çš„å€¼éƒ½éœ€è¦ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹ç»“æ„å¤´çš„åˆ†é…ï¼Œ<strong>å†…å­˜å¼€é”€è¾ƒå¤§</strong>ã€‚</li></ul><h3 id="å¯¹æ¯”æ•°ç»„å’Œé“¾è¡¨"><a href="#å¯¹æ¯”æ•°ç»„å’Œé“¾è¡¨" class="headerlink" title="å¯¹æ¯”æ•°ç»„å’Œé“¾è¡¨"></a>å¯¹æ¯”æ•°ç»„å’Œé“¾è¡¨</h3><p>å¯¹äºæ•°ç»„å’Œé“¾è¡¨æ¥è¯´ï¼Œå…¶å†…å­˜è®¿é—®æ¨¡å¼å¯¹CPUç¼“å­˜çš„åˆ©ç”¨æœ‰å¾ˆå¤§å½±å“ï¼š</p><ol><li>æ•°ç»„åœ¨å†…å­˜ä¸­æ˜¯ä¸€æ®µè¿ç»­çš„å­˜å‚¨ç©ºé—´ï¼Œè¿™ä½¿å¾—å®ƒå…·æœ‰å¾ˆå¥½çš„å±€éƒ¨æ€§åŸåˆ™ã€‚å½“CPUè®¿é—®æ•°ç»„ä¸­çš„å…ƒç´ æ—¶ï¼Œå¾€å¾€ä¼šé¢„å…ˆåŠ è½½ç›¸é‚»çš„æ•°æ®åˆ°ç¼“å­˜ä¸­ï¼Œä»¥æ»¡è¶³å¯èƒ½çš„åç»­è®¿é—®éœ€æ±‚ã€‚è¿™ç§è¿ç»­çš„å­˜å‚¨æ¨¡å¼æœ‰åˆ©äºCPUç¼“å­˜çš„é¢„å–å’Œç¼“å­˜è¡Œå¡«å……ï¼Œä»è€Œæé«˜è®¿é—®é€Ÿåº¦ã€‚å› ä¸ºæ•°ç»„å…ƒç´ åœ¨å†…å­˜ä¸­æ˜¯è¿ç»­æ’åˆ—çš„ï¼Œä¸€æ—¦åŠ è½½äº†æ•°ç»„çš„ä¸€ä¸ªå…ƒç´ ï¼Œæ¥ä¸‹æ¥çš„å…ƒç´ ä¹Ÿå¾ˆå¯èƒ½å·²ç»åœ¨ç¼“å­˜ä¸­ã€‚</li><li>ç›¸æ¯”ä¹‹ä¸‹ï¼Œé“¾è¡¨çš„èŠ‚ç‚¹åœ¨å†…å­˜ä¸­æ˜¯åˆ†æ•£å­˜å‚¨çš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹é€šå¸¸å­˜å‚¨åœ¨ä¸åŒçš„å†…å­˜ä½ç½®ã€‚è¿™ä¼šå¯¼è‡´è®¿é—®éå¸¸é—´æ–­ï¼Œä½¿å¾—ç¼“å­˜é¢„å–å’Œå¡«å……æ•ˆç‡é™ä½ã€‚å³ä½¿è®¿é—®é“¾è¡¨çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå…¶åç»­èŠ‚ç‚¹å¹¶ä¸ä¸€å®šå­˜å‚¨åœ¨ç›¸é‚»çš„å†…å­˜ä½ç½®ï¼Œè¿™å°±å¢åŠ äº†ç¼“å­˜æœªå‘½ä¸­çš„æ¦‚ç‡ï¼Œé™ä½äº†CPUç¼“å­˜çš„åˆ©ç”¨æ•ˆç‡ã€‚</li></ol><h2 id="å‹ç¼©åˆ—è¡¨"><a href="#å‹ç¼©åˆ—è¡¨" class="headerlink" title="å‹ç¼©åˆ—è¡¨"></a>å‹ç¼©åˆ—è¡¨</h2><p>å‹ç¼©åˆ—è¡¨çš„æœ€å¤§ç‰¹ç‚¹ï¼Œå°±æ˜¯å®ƒè¢«è®¾è®¡æˆä¸€ç§<strong>å†…å­˜ç´§å‡‘å‹</strong>çš„æ•°æ®ç»“æ„ï¼Œå ç”¨ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œä¸ä»…å¯ä»¥åˆ©ç”¨ CPU ç¼“å­˜ï¼Œè€Œä¸”ä¼šé’ˆå¯¹ä¸åŒé•¿åº¦çš„æ•°æ®ï¼Œè¿›è¡Œç›¸åº”ç¼–ç ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥æœ‰æ•ˆåœ°<mark>èŠ‚çœå†…å­˜å¼€é”€</mark>ã€‚</p><h3 id="ç»“æ„è®¾è®¡"><a href="#ç»“æ„è®¾è®¡" class="headerlink" title="ç»“æ„è®¾è®¡"></a>ç»“æ„è®¾è®¡</h3><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231103200343073.png" alt="å‹ç¼©åˆ—è¡¨ç»“æ„å›¾"></p><p>å„ä¸ªå­—æ®µçš„å«ä¹‰ï¼š</p><ul><li><p><em><strong>zlbytes</strong></em>ï¼Œè®°å½•æ•´ä¸ªå‹ç¼©åˆ—è¡¨å ç”¨å¯¹å†…å­˜å­—èŠ‚æ•°ï¼›</p></li><li><p><em><strong>zltail</strong></em>ï¼Œè®°å½•å‹ç¼©åˆ—è¡¨ã€Œå°¾éƒ¨ã€èŠ‚ç‚¹è·ç¦»èµ·å§‹åœ°å€ç”±å¤šå°‘å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯åˆ—è¡¨å°¾çš„åç§»é‡ï¼›</p></li><li><p><em><strong>zllen</strong></em>ï¼Œè®°å½•å‹ç¼©åˆ—è¡¨åŒ…å«çš„èŠ‚ç‚¹æ•°é‡ï¼›</p></li><li><p><em><strong>zlend</strong></em>ï¼Œæ ‡è®°å‹ç¼©åˆ—è¡¨çš„ç»“æŸç‚¹ï¼Œå›ºå®šå€¼ 0xFFï¼ˆåè¿›åˆ¶255ï¼‰ã€‚</p></li><li><p><em><strong>prevlen</strong></em>ï¼Œè®°å½•äº†ã€Œå‰ä¸€ä¸ªèŠ‚ç‚¹ã€çš„é•¿åº¦ï¼Œç›®çš„æ˜¯ä¸ºäº†å®ç°ä»åå‘å‰éå†ï¼›</p></li><li><p><em><strong>encoding</strong></em>ï¼Œè®°å½•äº†å½“å‰èŠ‚ç‚¹å®é™…æ•°æ®çš„ã€Œç±»å‹å’Œé•¿åº¦ã€ï¼Œç±»å‹ä¸»è¦æœ‰ä¸¤ç§ï¼šå­—ç¬¦ä¸²å’Œæ•´æ•°ã€‚</p></li><li><p><em><strong>data</strong></em>ï¼Œè®°å½•äº†å½“å‰èŠ‚ç‚¹çš„å®é™…æ•°æ®ï¼Œç±»å‹å’Œé•¿åº¦éƒ½ç”± <code>encoding</code> å†³å®šï¼›</p></li></ul><p>ğŸ”´ğŸŸ¡ğŸŸ¢æ€»ç»“ï¼š</p><p>è¿™é‡Œæ—¢ä¸åƒæ•°ç»„é‚£æ ·æœ‰è¿ç»­çš„ç›¸åŒçš„å†…å­˜å¤§å°è¿›è¡Œå¯»å€ï¼Œä¹Ÿä¸åƒé“¾è¡¨é‚£æ ·æœ‰æŒ‡é’ˆè¿›è¡Œå¯»å€ï¼Œ</p><p>ä½†æ˜¯å‹ç¼©åˆ—è¡¨åœ¨<mark><strong>æ­£åºæ—¶</strong></mark>ä¸‹ä¸€ä¸ªå…ƒç´ å°±æ˜¯è¯¥å…ƒç´ çš„é¦–åœ°å€åŠ ä¸Šè‡ªèº«é•¿åº¦ï¼Œè‡ªèº«é•¿åº¦åŒ…æ‹¬ã€1. prelenä»£è¡¨å‰ä¸€ä¸ªç»“ç‚¹çš„é•¿åº¦ï¼Œ2. encodingè®°å½•ç±»å‹ï¼Œ3. dataçœŸå®æ•°æ®ã€‘ï¼Œç”±è¿™ä¸‰éƒ¨åˆ†ç»„æˆï¼Œè¿™ä¸‰ä¸ªéƒ¨åˆ†çš„é•¿åº¦éƒ½æ˜¯å¯ä»¥ç»è¿‡è®¡ç®—å¾—å‡ºçš„ï¼Œæ•…å¯ä»¥é€šè¿‡å°†åœ°å€åŠ ä¸Šè‡ªèº«é•¿åº¦å¾—åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚</p><p><mark>é€†åºæ—¶</mark>ï¼šå¯ä»¥é€šè¿‡æœ¬èº«åœ°å€å‡å»prelenï¼Œå¾—åˆ°å‰ä¸€ä¸ªå…ƒç´ çš„åœ°å€</p><p>æ‰€ä»¥ä¹Ÿå¯ä»¥è¯´è¿™ä¸ªå‹ç¼©åˆ—è¡¨æ˜¯<strong>åŒå‘çš„</strong>ã€‚</p><h3 id="è¿é”æ›´æ–°"><a href="#è¿é”æ›´æ–°" class="headerlink" title="è¿é”æ›´æ–°"></a>è¿é”æ›´æ–°</h3><blockquote><p>æ¦‚ç‡æä½çš„äº‹æƒ…</p></blockquote><p>ZipListçš„æ¯ä¸ªEntryéƒ½åŒ…å«previous entry lengthæ¥è®°å½•ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°ï¼Œé•¿åº¦æ˜¯1ä¸ªæˆ–5ä¸ªå­—èŠ‚:</p><ul><li>å¦‚æœå‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦å°äº254å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨1ä¸ªå­—èŠ‚æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼</li><li>å¦‚æœå‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦å¤§äºç­‰äº254å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨5ä¸ªå­—èŠ‚æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º0xfeï¼Œåå››ä¸ªå­—èŠ‚æ‰æ˜¯çœŸå®é•¿åº¦æ•°æ®</li></ul><p>ç°åœ¨ï¼Œå‡è®¾æˆ‘ä»¬æœ‰<mark>Nä¸ªè¿ç»­çš„ã€é•¿åº¦ä¸º250~253å­—èŠ‚ä¹‹é—´çš„entry</mark>ï¼ˆæ¡ä»¶ï¼‰ï¼Œå› æ­¤entryçš„previous entry lengthå±æ€§ç”¨1ä¸ªå­—èŠ‚å³å¯è¡¨ç¤ºï¼Œå¦‚å›¾æ‰€ç¤º:</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231103201052893.png" alt="è¿é”æ›´æ–°"></p><p>ZipListè¿™ç§ç‰¹æ®Šæƒ…å†µä¸‹äº§ç”Ÿçš„è¿ç»­å¤šæ¬¡ç©ºé—´æ‰©å±•æ“ä½œç§°ä¹‹ä¸º<mark>è¿é”æ›´æ–°</mark>(Cascade Update)ã€‚æ–°å¢ã€åˆ é™¤éƒ½å¯èƒ½å¯¼è‡´è¿é”æ›´æ–°çš„å‘ç”Ÿã€‚</p><h3 id="ç¼ºé™·"><a href="#ç¼ºé™·" class="headerlink" title="ç¼ºé™·"></a>ç¼ºé™·</h3><ol><li><p>è¿é”æ›´æ–°ä¸€æ—¦å‘ç”Ÿï¼Œå°±ä¼šå¯¼è‡´å‹ç¼©åˆ—è¡¨å ç”¨çš„å†…å­˜ç©ºé—´è¦<mark>å¤šæ¬¡é‡æ–°åˆ†é…</mark>ï¼Œè¿™å°±ä¼šç›´æ¥å½±å“åˆ°å‹ç¼©åˆ—è¡¨çš„è®¿é—®æ€§èƒ½ã€‚</p></li><li><p>ä¸èƒ½ä¿å­˜è¿‡å¤šçš„å…ƒç´ ï¼Œå¦åˆ™æŸ¥è¯¢æ•ˆç‡å°±ä¼šé™ä½ã€‚</p></li></ol><h2 id="å“ˆå¸Œè¡¨"><a href="#å“ˆå¸Œè¡¨" class="headerlink" title="å“ˆå¸Œè¡¨"></a>å“ˆå¸Œè¡¨</h2><h3 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h3><p>ä¸‰ä¸ªç»“æ„ï¼š</p><p>å“ˆå¸Œè¡¨ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">dictht</span> &#123;</span></span><br><span class="line">    <span class="comment">//å“ˆå¸Œè¡¨æ•°ç»„</span></span><br><span class="line">    dictEntry **table;</span><br><span class="line">    <span class="comment">//å“ˆå¸Œè¡¨å¤§å°</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> size;  </span><br><span class="line">    <span class="comment">//å“ˆå¸Œè¡¨å¤§å°æ©ç ï¼Œç”¨äºè®¡ç®—ç´¢å¼•å€¼</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> sizemask;</span><br><span class="line">    <span class="comment">//è¯¥å“ˆå¸Œè¡¨å·²æœ‰çš„èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> used;</span><br><span class="line">&#125; dictht;</span><br></pre></td></tr></table></figure><p>å“ˆå¸Œè¡¨èŠ‚ç‚¹çš„ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">dictEntry</span> &#123;</span></span><br><span class="line">    <span class="comment">//é”®å€¼å¯¹ä¸­çš„é”®</span></span><br><span class="line">    <span class="type">void</span> *key;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//é”®å€¼å¯¹ä¸­çš„å€¼</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">        <span class="type">void</span> *val;</span><br><span class="line">        <span class="type">uint64_t</span> u64;</span><br><span class="line">        <span class="type">int64_t</span> s64;</span><br><span class="line">        <span class="type">double</span> d;</span><br><span class="line">    &#125; v;</span><br><span class="line">    <span class="comment">//æŒ‡å‘ä¸‹ä¸€ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼Œå½¢æˆé“¾è¡¨</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dictEntry</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125; dictEntry;</span><br></pre></td></tr></table></figure><p>å­—å…¸çš„ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">dict</span>&#123;</span></span><br><span class="line">    dictType *type;  <span class="comment">// dictç±»å‹ï¼Œå†…ç½®ä¸åŒçš„hashå‡½æ•°</span></span><br><span class="line">    <span class="type">void</span> *privdata;  <span class="comment">// ç§æœ‰æ•°æ®ï¼Œåœ¨åšç‰¹æ®Šhashè¿ç®—æ—¶ç”¨</span></span><br><span class="line">    dicht ht[<span class="number">2</span>];  <span class="comment">// ä¸€ä¸ªDictåŒ…å«ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œå…¶ä¸­ä¸€ä¸ªæ—¶å½“å‰æ•°æ®ï¼Œå¦ä¸€ä¸ªä¸€èˆ¬æ˜¯ç©ºï¼Œrehashæ—¶ä½¿ç”¨</span></span><br><span class="line">    <span class="type">long</span> rehashidx;  <span class="comment">// rehashçš„è¿›åº¦ï¼Œ-1è¡¨ç¤ºæœªè¿›è¡Œ</span></span><br><span class="line">    <span class="type">int16_t</span> pauserehash;  <span class="comment">// rehashæ˜¯å¦æš‚åœï¼Œ1åˆ™æš‚åœï¼Œ0åˆ™ç»§ç»­</span></span><br><span class="line">&#125; dict;</span><br></pre></td></tr></table></figure><p>ä¸‰ç§ç»“æ„ç»„æˆå…³ç³»å›¾ï¼š</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231102203414049.png" alt="ä¸‰ç§ç»“æ„ç»„æˆå…³ç³»å›¾"></p><p>Dictçš„ç»“æ„</p><ul><li>ç±»ä¼¼javaçš„HashTableï¼Œåº•å±‚æ˜¯æ•°ç»„åŠ <mark>å•å‘</mark>é“¾è¡¨æ¥è§£å†³å“ˆå¸Œå†²çª</li><li>DictåŒ…å«ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œht[0]å¹³å¸¸ç”¨ï¼Œht[1]ç”¨æ¥rehash</li></ul><blockquote><p>è·ŸJavaä¸­çš„HashMapåŸç†å¾ˆåƒï¼Œä½†åˆæœ‰ä¸€ç‚¹ç‚¹å·®åˆ«</p></blockquote><h3 id="å“ˆå¸Œå†²çª"><a href="#å“ˆå¸Œå†²çª" class="headerlink" title="å“ˆå¸Œå†²çª"></a>å“ˆå¸Œå†²çª</h3><p>å½“å‡ºç°å“ˆå¸Œå†²çªçš„æ—¶å€™é‡‡ç”¨çš„æ˜¯<strong>å¤´æ’æ³•</strong>ï¼ŒåŸå› æ˜¯æ–¹ä¾¿ï¼Œä¸ç”¨éå†åˆ°é“¾è¡¨çš„æœ«å°¾è¿›è¡Œæ’å…¥ã€‚</p><p>Redisæ˜¯å•çº¿ç¨‹ï¼Œæ‰€ä»¥<strong>ä¸ä¼šå‡ºç°</strong>é‡‡ç”¨å¤´æ’æ³•æ—¶é€ æˆ<strong>å¾ªç¯é“¾è¡¨</strong>çš„å¯èƒ½ã€‚</p><blockquote><p>è¡¥å……ï¼šå½“é«˜å¹¶å‘æ—¶ï¼Œ<strong>å¤šä¸ªçº¿ç¨‹å¹¶å‘</strong>åœ°å°è¯•åœ¨é“¾è¡¨å¤´éƒ¨æ’å…¥å…ƒç´ ï¼Œåœ¨<strong>å‘ç”Ÿæ‰©å®¹</strong>ä¸”æ˜¯<strong>å¤´æ’æ³•</strong>çš„æƒ…å†µä¸‹ä¼šå¯¼è‡´å¾ªç¯é“¾è¡¨ï¼Œå…·ä½“å¯¼è‡´å¾ªç¯åŸå› å¯å‚è€ƒæœ¬ç«™ï¼š<a href="https://planbbbbb.github.io/2023/09/05/Java%E9%9B%86%E5%90%88/">https://planbbbbb.github.io/2023/09/05/Java%E9%9B%86%E5%90%88/</a></p></blockquote><h3 id="rehash"><a href="#rehash" class="headerlink" title="rehash"></a>rehash</h3><p>Dictçš„rehashå¹¶ä¸æ˜¯ä¸€æ¬¡æ€§å®Œæˆçš„ã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœDictä¸­åŒ…å«æ•°ç™¾ä¸‡çš„entryï¼Œè¦åœ¨ä¸€æ¬¡rehashå®Œæˆï¼Œææœ‰å¯èƒ½å¯¼è‡´ä¸»çº¿ç¨‹é˜³å¯’ã€‚å› æ­¤Dictçš„rehashæ˜¯åˆ†å¤šæ¬¡ã€æ¸è¿›å¼çš„å®Œæˆï¼Œå› æ­¤ç§°ä¸ºæ¸è¿›å¼rehashã€‚</p><p><strong>æµç¨‹å¦‚ä¸‹ï¼š</strong></p><ol><li><p>è®¡ç®—æ–°hashè¡¨çš„sizeï¼Œå€¼å–å†³äºå½“å‰è¦åšçš„æ˜¯æ‰©å®¹è¿˜æ˜¯æ”¶ç¼©:</p><ul><li>å¦‚æœæ˜¯æ‰©å®¹ï¼Œåˆ™æ–°sizeä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äºdict.ht[0].used +1çš„2çš„næ¬¡æ–¹ï¼Œ<mark>å³å½“å‰å…ƒç´ ä¸ªæ•°+1åçš„ç¬¬ä¸€ä¸ª2^nçš„æ•°</mark></li><li>å¦‚æœæ˜¯æ”¶ç¼©ï¼Œåˆ™æ–°sizeä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äºdict.htlol.usedçš„2^n (ä¸å¾—å°äº4)ï¼Œä¸ä¸Šé¢åŒç†ï¼Œ<mark>æ‰¾åˆ°æ¯”å®ƒå¤§çš„ç¬¬ä¸€ä¸ª2çš„næ¬¡æ–¹çš„æ•°</mark></li></ul></li><li><p>æŒ‰ç…§æ–°çš„sizeç”³è¯·å†…å­˜ç©ºé—´ï¼Œåˆ›å»ºdicthtï¼Œå¹¶èµ‹å€¼ç»™dict.ht[1]</p></li><li><p>è®¾ç½®dict.rehashidx&#x3D;0ï¼Œæ ‡ç¤ºå¼€å§‹rehashï¼ˆ<strong>æœªè¿›è¡Œrehashæ—¶å€¼ä¸º-1</strong>ï¼‰</p></li><li><p><del>å°†dict.ht[0]ä¸­çš„æ¯ä¸€ä¸ªdictEntryéƒ½rehashåˆ°dict.ht[1]</del>ï¼ˆä¸èƒ½ä¸€æ¬¡æ€§å…¨éƒ¨è½¬ç§»ï¼Œè¿™æ ·åœ¨æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™å¯èƒ½ä¼šå¯¼è‡´ä¸»è¿›ç¨‹çš„é˜»å¡ï¼‰</p></li><li><p>æ¯æ¬¡æ‰§è¡Œæ–°å¢ã€æŸ¥è¯¢ã€ä¿®æ”¹ã€åˆ é™¤æ“ä½œæ—¶ï¼Œéƒ½æ£€æŸ¥ä¸€ä¸‹dict.rehashidxæ˜¯å¦å¤§äº-1ï¼Œå¦‚æœæ˜¯åˆ™å°†dict.ht[0].table[rehashidx]çš„entryé“¾è¡¨rehashåˆ°dict.ht[1]ï¼Œå¹¶ä¸”å°†rehashidx++ã€‚ç›´è‡³dict.ht[0]çš„æ‰€æœ‰æ•°æ®éƒ½rehashåˆ°dict.ht[1]</p></li><li><p>å°†dict.ht[1]èµ‹å€¼ç»™dict.ht[0]ï¼Œç»™dict.ht[1]åˆå§‹åŒ–ä¸ºç©ºå“ˆå¸Œè¡¨ï¼Œé‡Šæ”¾åŸæ¥çš„dict.ht[0]çš„å†…å­˜</p></li><li><p>å°†rehashidxèµ‹å€¼ä¸º-1ï¼Œä»£è¡¨rehashç»“æŸ</p></li><li><p>åœ¨rehashè¿‡ç¨‹ä¸­ï¼Œ<strong>æ–°å¢æ“ä½œ</strong>ï¼Œåˆ™ç›´æ¥å†™å…¥ht[1]ï¼Œ<strong>æŸ¥è¯¢ã€ä¿®æ”¹å’Œåˆ é™¤</strong>åˆ™ä¼šåœ¨dict.ht[0]å’Œdict.ht[1]ä¾æ¬¡æŸ¥æ‰¾å¹¶æ‰§è¡Œã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ht[0]çš„æ•°æ®åªå‡ä¸å¢ï¼Œéšç€rehashæœ€ç»ˆä¸ºç©º</p></li></ol><blockquote><p>ğŸŒˆè´Ÿè½½å› å­ &#x3D; å“ˆå¸Œè¡¨å·²ä¿å­˜èŠ‚ç‚¹æ•°é‡ &#x2F;å“ˆå¸Œè¡¨å¤§å°</p></blockquote><p>è§¦å‘ rehash æ“ä½œçš„æ¡ä»¶ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªï¼š</p><ul><li>å½“è´Ÿè½½å› å­å¤§äºç­‰äº 1 ï¼Œå¹¶ä¸” Redis æ²¡æœ‰åœ¨æ‰§è¡Œ bgsave å‘½ä»¤æˆ–è€… bgrewiteaof å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æ‰§è¡Œ RDB å¿«ç…§æˆ–æ²¡æœ‰è¿›è¡Œ AOF é‡å†™çš„æ—¶å€™ï¼Œå°±ä¼šè¿›è¡Œ rehash æ“ä½œã€‚</li><li>å½“è´Ÿè½½å› å­å¤§äºç­‰äº 5 æ—¶ï¼Œæ­¤æ—¶è¯´æ˜å“ˆå¸Œå†²çªéå¸¸ä¸¥é‡äº†ï¼Œä¸ç®¡æœ‰æ²¡æœ‰æœ‰åœ¨æ‰§è¡Œ RDB å¿«ç…§æˆ– AOF é‡å†™ï¼Œéƒ½ä¼šå¼ºåˆ¶è¿›è¡Œ rehash æ“ä½œã€‚</li></ul><h2 id="è·³è¡¨"><a href="#è·³è¡¨" class="headerlink" title="è·³è¡¨"></a>è·³è¡¨</h2><h3 id="ç»“æ„-1"><a href="#ç»“æ„-1" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h3><ol><li>å®ç°åŸç†</li></ol><p>è·³è·ƒè¡¨å®è´¨ä¸Šæ˜¯å¯¹ä¸€ä¸ªæœ‰åºçš„é“¾è¡¨è¿›è¡Œ<strong>ç±»ä¼¼äºäºŒåˆ†æŸ¥æ‰¾</strong>çš„æ•°æ®ç»“æ„ï¼Œå…¶æ€§èƒ½ä¸çº¢é»‘æ ‘ï¼ŒAVLæ ‘ä¸ç›¸ä¸Šä¸‹ã€‚</p><p>åŸæœ¬è¦ä¾æ¬¡éå†ä»1å¼€å§‹æ‰¾17ï¼Œç°åœ¨ä»ä¸‰çº§ç´¢å¼•æ‰¾åˆ°10ï¼Œå†ä»äºŒçº§ç´¢å¼•æ‰¾åˆ°15ï¼Œåœ¨ä¸€çº§ç´¢å¼•å°±èƒ½æ‰¾åˆ°17äº†ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231023222430354.png" alt="è·³è·ƒè¡¨"></p><ol start="2"><li>å…·ä½“ç»“æ„</li></ol><p>è·³è¡¨èŠ‚ç‚¹ç»“æ„ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> &#123;</span></span><br><span class="line">    <span class="comment">//Zset å¯¹è±¡çš„å…ƒç´ å€¼</span></span><br><span class="line">    sds ele;</span><br><span class="line">    <span class="comment">//å…ƒç´ æƒé‡å€¼</span></span><br><span class="line">    <span class="type">double</span> score;</span><br><span class="line">    <span class="comment">//åå‘æŒ‡é’ˆ</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> *<span class="title">backward</span>;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹çš„levelæ•°ç»„ï¼Œä¿å­˜æ¯å±‚ä¸Šçš„å‰å‘æŒ‡é’ˆå’Œè·¨åº¦</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistLevel</span> &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> *<span class="title">forward</span>;</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> span;</span><br><span class="line">    &#125; level[];</span><br><span class="line">&#125; zskiplistNode;</span><br></pre></td></tr></table></figure><p>è·³è¡¨ç»“æ„ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zskiplist</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> *<span class="title">header</span>, *<span class="title">tail</span>;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> length;</span><br><span class="line">    <span class="type">int</span> level;</span><br><span class="line">&#125; zskiplist;</span><br></pre></td></tr></table></figure><hr><p>é…åˆä¸Šç»“æ„ä½“çš„è·³è¡¨ç»“æ„å›¾ï¼š</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231105102654240.png" alt="é…åˆä¸Šç»“æ„ä½“çš„è·³è¡¨ç»“æ„å›¾"></p><h3 id="ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸æ˜¯å¹³è¡¡æ ‘"><a href="#ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸æ˜¯å¹³è¡¡æ ‘" class="headerlink" title="ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸æ˜¯å¹³è¡¡æ ‘"></a>ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸æ˜¯å¹³è¡¡æ ‘</h3><ul><li><strong>ä»å†…å­˜å ç”¨ä¸Šæ¥æ¯”è¾ƒï¼Œè·³è¡¨æ¯”å¹³è¡¡æ ‘æ›´çµæ´»ä¸€äº›</strong>ã€‚å¹³è¡¡æ ‘æ¯ä¸ªèŠ‚ç‚¹åŒ…å« 2 ä¸ªæŒ‡é’ˆï¼ˆåˆ†åˆ«æŒ‡å‘å·¦å³å­æ ‘ï¼‰ï¼Œè€Œè·³è¡¨æ¯ä¸ªèŠ‚ç‚¹åŒ…å«çš„æŒ‡é’ˆæ•°ç›®å¹³å‡ä¸º 1&#x2F;(1-p)ï¼Œå…·ä½“å–å†³äºå‚æ•° p çš„å¤§å°ã€‚å¦‚æœåƒ Redisé‡Œçš„å®ç°ä¸€æ ·ï¼Œå– p&#x3D;1&#x2F;4ï¼Œé‚£ä¹ˆå¹³å‡æ¯ä¸ªèŠ‚ç‚¹åŒ…å« 1.33 ä¸ªæŒ‡é’ˆï¼Œæ¯”å¹³è¡¡æ ‘æ›´æœ‰ä¼˜åŠ¿ã€‚</li><li><strong>åœ¨åšèŒƒå›´æŸ¥æ‰¾çš„æ—¶å€™ï¼Œè·³è¡¨æ¯”å¹³è¡¡æ ‘æ“ä½œè¦ç®€å•</strong>ã€‚åœ¨å¹³è¡¡æ ‘ä¸Šï¼Œæˆ‘ä»¬æ‰¾åˆ°æŒ‡å®šèŒƒå›´çš„å°å€¼ä¹‹åï¼Œè¿˜éœ€è¦ä»¥ä¸­åºéå†çš„é¡ºåºç»§ç»­å¯»æ‰¾å…¶å®ƒä¸è¶…è¿‡å¤§å€¼çš„èŠ‚ç‚¹ã€‚å¦‚æœä¸å¯¹å¹³è¡¡æ ‘è¿›è¡Œä¸€å®šçš„æ”¹é€ ï¼Œè¿™é‡Œçš„ä¸­åºéå†å¹¶ä¸å®¹æ˜“å®ç°ã€‚è€Œåœ¨è·³è¡¨ä¸Šè¿›è¡ŒèŒƒå›´æŸ¥æ‰¾å°±éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨æ‰¾åˆ°å°å€¼ä¹‹åï¼Œå¯¹ç¬¬ 1 å±‚é“¾è¡¨è¿›è¡Œè‹¥å¹²æ­¥çš„éå†å°±å¯ä»¥å®ç°ã€‚</li><li><strong>ä»ç®—æ³•å®ç°éš¾åº¦ä¸Šæ¥æ¯”è¾ƒï¼Œè·³è¡¨æ¯”å¹³è¡¡æ ‘è¦ç®€å•å¾—å¤š</strong>ã€‚å¹³è¡¡æ ‘çš„æ’å…¥å’Œåˆ é™¤æ“ä½œå¯èƒ½å¼•å‘å­æ ‘çš„è°ƒæ•´ï¼Œé€»è¾‘å¤æ‚ï¼Œè€Œè·³è¡¨çš„æ’å…¥å’Œåˆ é™¤åªéœ€è¦ä¿®æ”¹ç›¸é‚»èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œæ“ä½œç®€å•åˆå¿«é€Ÿã€‚</li></ul><h2 id="æ•´æ•°é›†åˆ"><a href="#æ•´æ•°é›†åˆ" class="headerlink" title="æ•´æ•°é›†åˆ"></a>æ•´æ•°é›†åˆ</h2><p>æ•´æ•°é›†åˆæ˜¯ Set å¯¹è±¡çš„åº•å±‚å®ç°ä¹‹ä¸€ã€‚å½“ä¸€ä¸ª Set å¯¹è±¡åªåŒ…å«æ•´æ•°å€¼å…ƒç´ ï¼Œå¹¶ä¸”å…ƒç´ æ•°é‡ä¸å¤§æ—¶ï¼Œå°±ä¼šä½¿ç”¨æ•´æ•°é›†è¿™ä¸ªæ•°æ®ç»“æ„ä½œä¸ºåº•å±‚å®ç°ã€‚</p><h3 id="æ•´æ•°é›†åˆç»“æ„è®¾è®¡"><a href="#æ•´æ•°é›†åˆç»“æ„è®¾è®¡" class="headerlink" title="æ•´æ•°é›†åˆç»“æ„è®¾è®¡"></a>æ•´æ•°é›†åˆç»“æ„è®¾è®¡</h3><p>æ•´æ•°é›†åˆæœ¬è´¨ä¸Šæ˜¯ä¸€å—è¿ç»­å†…å­˜ç©ºé—´ï¼Œå®ƒçš„ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">intset</span> &#123;</span></span><br><span class="line">    <span class="comment">//ç¼–ç æ–¹å¼</span></span><br><span class="line">    <span class="type">uint32_t</span> encoding;</span><br><span class="line">    <span class="comment">//é›†åˆåŒ…å«çš„å…ƒç´ æ•°é‡</span></span><br><span class="line">    <span class="type">uint32_t</span> length;</span><br><span class="line">    <span class="comment">//ä¿å­˜å…ƒç´ çš„æ•°ç»„</span></span><br><span class="line">    <span class="type">int8_t</span> contents[];</span><br><span class="line">&#125; intset;</span><br></pre></td></tr></table></figure><p>contents æ•°ç»„çš„çœŸæ­£ç±»å‹å–å†³äº intset ç»“æ„ä½“é‡Œçš„ encoding å±æ€§çš„å€¼ï¼Œå¯¹åº”çš„æœ‰16ï¼Œ32ï¼Œ64ã€‚</p><blockquote><p>å…¶å®å°±æ˜¯å¯¹åº”ç€Javaé‡Œçš„shortï¼Œintï¼Œlongç±»å‹ã€‚</p></blockquote><h3 id="å‡çº§æœºåˆ¶"><a href="#å‡çº§æœºåˆ¶" class="headerlink" title="å‡çº§æœºåˆ¶"></a>å‡çº§æœºåˆ¶</h3><p><em>ç›®çš„æ˜¯<mark>èŠ‚çœå†…å­˜ç©ºé—´</mark></em></p><p>å½“æˆ‘ä»¬å°†ä¸€ä¸ªæ–°å…ƒç´ åŠ å…¥åˆ°æ•´æ•°é›†åˆé‡Œé¢ï¼Œå¦‚æœæ–°å…ƒç´ çš„ç±»å‹ï¼ˆint32_tï¼‰æ¯”æ•´æ•°é›†åˆç°æœ‰æ‰€æœ‰å…ƒç´ çš„ç±»å‹ï¼ˆint16_tï¼‰éƒ½è¦é•¿æ—¶ï¼Œæ•´æ•°é›†åˆéœ€è¦å…ˆè¿›è¡Œ<mark>å‡çº§</mark>ï¼Œå‡çº§è¦<strong>å…ˆå°†åŸæœ‰çš„å†…å­˜ç©ºé—´<mark>æ‰©å®¹åˆ°åˆšå¥½èƒ½æ”¾çš„ä¸‹</mark>åŠ ä¸Šæ–°å…ƒç´ åï¼Œä¸”æ‰€æœ‰å…ƒç´ éƒ½æ˜¯æ–°çš„æ•°æ®ç±»å‹çš„å†…å­˜å¤§å°</strong>ï¼Œå†å°†åŸæœ‰çš„å…ƒç´ <mark>å€’å™æ’å…¥</mark>å¯¹åº”çš„ä½ç½®ï¼Œæœ€ååœ¨å°†æ–°çš„å…ƒç´ æ”¾åœ¨<mark>å¤´æˆ–è€…å°¾</mark>ã€‚</p><p>ğŸŒˆè§£é‡Šï¼š</p><blockquote><p>å…¶å®å°±æ˜¯åŸæœ¬çš„å…ƒç´ ç±»å‹ä¸å¤Ÿå¤§ï¼Œå­˜ä¸ä¸‹æ–°çš„æ•°ï¼Œå°±æ¯”å¦‚shortç±»å‹çš„æ•°æ®ç±»å‹å­˜ä¸ä¸‹æ–°è¿›æ¥çš„50000ï¼Œæ‰€ä»¥è¦è¿›è¡Œå…ƒç´ ç±»å‹ä¸Šçš„å‡çº§ã€‚</p></blockquote><blockquote><p>è¿™é‡Œå€’å™çš„åŸå› æ˜¯é˜²æ­¢è¦†ç›–åŸæœ‰çš„å…ƒç´ ï¼Œå€’å™ä¸ä¼šè¦†ç›–åˆ°åŸæœ‰çš„å…ƒç´ ã€‚</p></blockquote><blockquote><p>æ–°å…ƒç´ æ”¾åœ¨å¤´æˆ–è€…å°¾çš„åŸå› æ˜¯åªæœ‰å½“è¿™ä¸ªå…ƒç´ æ¯”æ‰€æœ‰å…ƒç´ éƒ½å¤§æˆ–è€…æ¯”æ‰€æœ‰å…ƒç´ éƒ½å°æ‰æœ‰å¯èƒ½å¼•å‘å‡çº§ï¼Œæ‰ä¼šä½¿å¾—åŸæœ‰çš„æ•°æ®ç±»å‹æ”¾ä¸äº†è¯¥å…ƒç´ ã€‚</p></blockquote><p>æ‰©å®¹å›¾ï¼š</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231102150034860.png" alt="æ‰©å®¹"></p><p>å€’å™æ’å…¥æµç¨‹å›¾ï¼š</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231102150003744.png" alt="å€’å™æ’å…¥æµç¨‹"></p><p>æ•´æ•°é›†åˆ<mark><strong>ä¸æ”¯æŒé™çº§æ“ä½œ</strong></mark>ï¼Œä¸€æ—¦å¯¹æ•°ç»„è¿›è¡Œäº†å‡çº§ï¼Œå°±ä¼šä¸€ç›´ä¿æŒå‡çº§åçš„çŠ¶æ€ã€‚æ¯”å¦‚å‰é¢çš„å‡çº§æ“ä½œçš„ä¾‹å­ï¼Œå¦‚æœåˆ é™¤äº† 65535 å…ƒç´ ï¼Œæ•´æ•°é›†åˆçš„æ•°ç»„è¿˜æ˜¯ int32_t ç±»å‹çš„ï¼Œå¹¶ä¸ä¼šå› æ­¤é™çº§ä¸º int16_t ç±»å‹ã€‚</p><p>ğŸ•æ•´æ•°é›†åˆå‡çº§çš„<strong>å¥½å¤„</strong>ï¼š</p><p>å½“å…ƒç´ å…¨éƒ½æ˜¯int32_tæ—¶ï¼Œé‚£ä¹ˆæ•°ç»„å°±ä¼šé‡‡ç”¨int32_tçš„å…ƒç´ ç±»å‹ï¼Œä¸ä¼šæµªè´¹ç©ºé—´ï¼Œåªæœ‰å½“æœ‰å…ƒç´ è¶…è¿‡int32_tæ—¶æ‰ä¼šå»å‡çº§ä¸ºint64_tï¼Œç›®çš„å°±æ˜¯èŠ‚çœå†…å­˜ã€‚</p><blockquote><p>ä¸ªäººæ€è€ƒï¼šè¯´åˆ°èŠ‚çœç©ºé—´ï¼Œè¿™ä¸€ç‚¹æ•´æ•°é›†åˆå…¶å®åšçš„æ²¡æœ‰<strong>SDSæˆ–è€…å‹ç¼©åˆ—è¡¨</strong>åšçš„å¥½ï¼ŒSDSåºŸé™¤äº†å­—èŠ‚å¯¹é½ï¼Œè®©ä¸åŒç±»å‹é•¿åº¦çš„å…ƒç´ éƒ½èƒ½æ”¾åœ¨ä¸€èµ·ï¼Œä½†æ˜¯æ•´æ•°é›†åˆå…¶å®ä¸èƒ½è¿™ä¹ˆåšï¼Œå› ä¸ºä»–åº•å±‚æ˜¯ä¸ªæ•°ç»„ï¼Œä»–æ˜¯è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œè¦é ç¬¬ä¸€ä¸ªå€¼çš„åœ°å€ï¼Œé€šè¿‡å›ºå®šçš„è¿ç®—å»å¿«é€Ÿå¾—åˆ°åé¢çš„å€¼ã€‚</p></blockquote><h3 id="æŸ¥è¯¢æ–¹å¼"><a href="#æŸ¥è¯¢æ–¹å¼" class="headerlink" title="æŸ¥è¯¢æ–¹å¼"></a>æŸ¥è¯¢æ–¹å¼</h3><p>åº•å±‚é‡‡ç”¨<mark>äºŒåˆ†æŸ¥æ‰¾</mark>è¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰€ä»¥å½“æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™å…¶å®ä¹Ÿä¸å»ºè®®ä½¿ç”¨æ•´æ•°é›†åˆæ¥è¿›è¡Œå­˜å‚¨äº†ã€‚</p><h2 id="quicklist"><a href="#quicklist" class="headerlink" title="quicklist"></a>quicklist</h2><p>åœ¨ Redis 3.0 ä¹‹å‰ï¼ŒList å¯¹è±¡çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯åŒå‘é“¾è¡¨æˆ–è€…å‹ç¼©åˆ—è¡¨ã€‚ç„¶ååœ¨ Redis 3.2 çš„æ—¶å€™ï¼ŒList å¯¹è±¡çš„åº•å±‚æ”¹ç”± quicklist æ•°æ®ç»“æ„å®ç°ã€‚</p><p>å…¶å® quicklist å°±æ˜¯<mark>ã€ŒåŒå‘é“¾è¡¨ + å‹ç¼©åˆ—è¡¨ã€ç»„åˆ</mark>ï¼Œå› ä¸ºä¸€ä¸ª quicklist å°±æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œè€Œé“¾è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ åˆæ˜¯ä¸€ä¸ªå‹ç¼©åˆ—è¡¨ã€‚</p><p>quicklist è§£å†³åŠæ³•ï¼Œ<strong>é€šè¿‡æ§åˆ¶æ¯ä¸ªé“¾è¡¨èŠ‚ç‚¹ä¸­çš„å‹ç¼©åˆ—è¡¨çš„å¤§å°æˆ–è€…å…ƒç´ ä¸ªæ•°ï¼Œæ¥è§„é¿è¿é”æ›´æ–°çš„é—®é¢˜ã€‚å› ä¸ºå‹ç¼©åˆ—è¡¨å…ƒç´ è¶Šå°‘æˆ–è¶Šå°ï¼Œè¿é”æ›´æ–°å¸¦æ¥çš„å½±å“å°±è¶Šå°ï¼Œä»è€Œæä¾›äº†æ›´å¥½çš„è®¿é—®æ€§èƒ½ã€‚</strong></p><h3 id="ç»“æ„-2"><a href="#ç»“æ„-2" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h3><p>é¦–å…ˆåœ¨åˆ—è¡¨å…ƒç´ è¾ƒå°‘çš„æƒ…å†µä¸‹ä¼šä½¿ç”¨ä¸€å—è¿ç»­çš„å†…å­˜å­˜å‚¨ï¼Œè¿™ä¸ªç»“æ„æ˜¯ ziplistï¼Œä¹Ÿå³æ˜¯å‹ç¼©åˆ—è¡¨ã€‚å®ƒå°†æ‰€æœ‰çš„å…ƒç´ ç´§æŒ¨ç€ä¸€èµ·å­˜å‚¨ï¼Œåˆ†é…çš„æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜ã€‚<br>å½“æ•°æ®é‡æ¯”è¾ƒå¤šçš„æ—¶å€™æ‰ä¼šæ”¹æˆ quicklistã€‚å› ä¸ºæ™®é€šçš„é“¾è¡¨éœ€è¦çš„é™„åŠ æŒ‡é’ˆç©ºé—´å¤ªå¤§ï¼Œä¼šæ¯”è¾ƒæµªè´¹ç©ºé—´ã€‚æ¯”å¦‚è¿™ä¸ªåˆ—è¡¨é‡Œå­˜çš„åªæ˜¯ int ç±»å‹çš„æ•°æ®ï¼Œç»“æ„ä¸Šè¿˜éœ€è¦ä¸¤ä¸ªé¢å¤–çš„æŒ‡é’ˆ prev å’Œ nextã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231104102445783.png" alt="ç»“æ„å›¾"></p><p>Redis å°†é“¾è¡¨å’Œ ziplist ç»“åˆèµ·æ¥ç»„æˆäº† quicklistã€‚ä¹Ÿå°±æ˜¯å°†å¤šä¸ª ziplist ä½¿ç”¨åŒå‘æŒ‡é’ˆä¸²èµ·æ¥ä½¿ç”¨ã€‚è¿™æ ·æ—¢æ»¡è¶³äº†å¿«é€Ÿçš„æ’å…¥åˆ é™¤æ€§èƒ½ï¼Œåˆä¸ä¼šå‡ºç°å¤ªå¤§çš„ç©ºé—´å†—ä½™ã€‚</p><p>åœ¨å‘ quicklist æ·»åŠ ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œä¸ä¼šåƒæ™®é€šçš„é“¾è¡¨é‚£æ ·ï¼Œç›´æ¥æ–°å»ºä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹ã€‚è€Œæ˜¯ä¼šæ£€æŸ¥æ’å…¥ä½ç½®çš„å‹ç¼©åˆ—è¡¨æ˜¯å¦èƒ½å®¹çº³è¯¥å…ƒç´ ï¼Œå¦‚æœèƒ½å®¹çº³å°±ç›´æ¥ä¿å­˜åˆ° quicklistNode ç»“æ„é‡Œçš„å‹ç¼©åˆ—è¡¨ï¼Œå¦‚æœä¸èƒ½å®¹çº³ï¼Œæ‰ä¼šæ–°å»ºä¸€ä¸ªæ–°çš„ quicklistNode ç»“æ„ã€‚</p><p>quicklist ä¼šæ§åˆ¶ quicklistNode ç»“æ„é‡Œçš„å‹ç¼©åˆ—è¡¨çš„å¤§å°æˆ–è€…å…ƒç´ ä¸ªæ•°ï¼Œæ¥è§„é¿æ½œåœ¨çš„è¿é”æ›´æ–°çš„é£é™©ï¼Œä½†æ˜¯è¿™å¹¶<mark>æ²¡æœ‰å®Œå…¨è§£å†³è¿é”æ›´æ–°</mark>çš„é—®é¢˜ã€‚</p><h2 id="listpack"><a href="#listpack" class="headerlink" title="listpack"></a>listpack</h2><blockquote><p>æœ¬è´¨ä¸Šè¿˜æ˜¯å‹ç¼©åˆ—è¡¨ï¼Œåªæ˜¯åœ¨ç‰ˆæœ¬æ›´è¿­çš„æ—¶å€™è¿›è¡Œäº†ä¼˜åŒ–</p></blockquote><p><mark>æœ€å¤§ç‰¹ç‚¹</mark>æ˜¯ listpack ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸å†åŒ…å«å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦äº†ï¼Œå‹ç¼©åˆ—è¡¨æ¯ä¸ªèŠ‚ç‚¹æ­£å› ä¸ºéœ€è¦ä¿å­˜å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦å­—æ®µï¼Œå°±ä¼šæœ‰è¿é”æ›´æ–°çš„éšæ‚£ã€‚</p><h3 id="listpack-ç»“æ„è®¾è®¡"><a href="#listpack-ç»“æ„è®¾è®¡" class="headerlink" title="listpack ç»“æ„è®¾è®¡"></a>listpack ç»“æ„è®¾è®¡</h3><p>listpack é‡‡ç”¨äº†å‹ç¼©åˆ—è¡¨çš„å¾ˆå¤šä¼˜ç§€çš„è®¾è®¡ï¼Œæ¯”å¦‚è¿˜æ˜¯ç”¨ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´æ¥ç´§å‡‘åœ°ä¿å­˜æ•°æ®ï¼Œå¹¶ä¸”ä¸ºäº†èŠ‚çœå†…å­˜çš„å¼€é”€ï¼Œlistpack èŠ‚ç‚¹ä¼šé‡‡ç”¨ä¸åŒçš„ç¼–ç æ–¹å¼ä¿å­˜ä¸åŒå¤§å°çš„æ•°æ®ã€‚</p><p>æˆ‘ä»¬å…ˆçœ‹çœ‹ listpack ç»“æ„ï¼š</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/4d2dc376b5fd68dae70d9284ae82b73a.png" alt="img"></p><p>listpack å¤´åŒ…å«ä¸¤ä¸ªå±æ€§ï¼Œåˆ†åˆ«è®°å½•äº† listpack æ€»å­—èŠ‚æ•°å’Œå…ƒç´ æ•°é‡ï¼Œç„¶å listpack æœ«å°¾ä¹Ÿæœ‰ä¸ªç»“å°¾æ ‡è¯†ã€‚å›¾ä¸­çš„ listpack entry å°±æ˜¯ listpack çš„èŠ‚ç‚¹äº†ã€‚</p><p>æ¯ä¸ª listpack èŠ‚ç‚¹ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/c5fb0a602d4caaca37ff0357f05b0abf.png" alt="img"></p><p>ä¸»è¦åŒ…å«ä¸‰ä¸ªæ–¹é¢å†…å®¹ï¼š</p><ul><li>encodingï¼Œå®šä¹‰è¯¥å…ƒç´ çš„ç¼–ç ç±»å‹ï¼Œä¼šå¯¹ä¸åŒé•¿åº¦çš„æ•´æ•°å’Œå­—ç¬¦ä¸²è¿›è¡Œç¼–ç ï¼›</li><li>dataï¼Œå®é™…å­˜æ”¾çš„æ•°æ®ï¼›</li><li>lenï¼Œencoding+dataçš„æ€»é•¿åº¦ï¼›</li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œ<strong>listpack æ²¡æœ‰å‹ç¼©åˆ—è¡¨ä¸­è®°å½•å‰ä¸€ä¸ªèŠ‚ç‚¹é•¿åº¦çš„å­—æ®µäº†ï¼Œlistpack åªè®°å½•å½“å‰èŠ‚ç‚¹çš„é•¿åº¦ï¼Œå½“æˆ‘ä»¬å‘ listpack åŠ å…¥ä¸€ä¸ªæ–°å…ƒç´ çš„æ—¶å€™ï¼Œä¸ä¼šå½±å“å…¶ä»–èŠ‚ç‚¹çš„é•¿åº¦å­—æ®µçš„å˜åŒ–ï¼Œä»è€Œé¿å…äº†å‹ç¼©åˆ—è¡¨çš„è¿é”æ›´æ–°é—®é¢˜</strong>ã€‚</p><h3 id="ä¿®æ”¹åä¸ä¼šå½±å“éå†å—"><a href="#ä¿®æ”¹åä¸ä¼šå½±å“éå†å—" class="headerlink" title="ä¿®æ”¹åä¸ä¼šå½±å“éå†å—"></a>ä¿®æ”¹åä¸ä¼šå½±å“éå†å—</h3><p>åœ¨listpackä¸­å°†åŸæ¥çš„prelenæ›¿æ¢ä¸ºäº†lenï¼ŒåŸæœ‰çš„prelenæ˜¯ä¸ºäº†èƒ½ä»åå‘å‰å»éå†å…ƒç´ çš„ï¼Œç°åœ¨æ”¹ä¸ºäº†lenï¼Œè®°å½•çš„æ˜¯å½“å‰ç»“ç‚¹çš„é•¿åº¦ã€‚</p><p>è§£å†³åŠæ³•æ˜¯ï¼š</p><p><strong>lpDecodeBacklen å‡½æ•°å°±å¯ä»¥ä»å½“å‰åˆ—è¡¨é¡¹èµ·å§‹ä½ç½®çš„æŒ‡é’ˆå¼€å§‹ï¼Œå‘å·¦é€ä¸ªå­—èŠ‚è§£æï¼Œå¾—åˆ°å‰ä¸€é¡¹çš„ entry-len å€¼ã€‚</strong></p><p>è¿™æ ·ä¾ç„¶èƒ½è¿›è¡Œä»åå¾€å‰éå†ã€‚</p><h2 id="RedisObject"><a href="#RedisObject" class="headerlink" title="RedisObject"></a>RedisObject</h2><ol><li>æ¯ä¸€ä¸ªRediså¯¹è±¡æœ€ç»ˆéƒ½ä¼šå°è£…ä¸ºä¸€ä¸ªRedisObjectå¯¹è±¡ï¼Œç»“æ„å›¾å¦‚ä¸‹ï¼š</li></ol><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231105105905430.png" alt="image-20231105105905430"></p><p>å­—æ®µè§£é‡Šï¼š</p><ul><li>typeï¼Œæ ‡è¯†è¯¥å¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹çš„å¯¹è±¡ï¼ˆString å¯¹è±¡ã€ List å¯¹è±¡ã€Hash å¯¹è±¡ã€Set å¯¹è±¡å’Œ Zset å¯¹è±¡ï¼‰ï¼›</li><li>encodingï¼Œæ ‡è¯†è¯¥å¯¹è±¡ä½¿ç”¨äº†å“ªç§åº•å±‚çš„æ•°æ®ç»“æ„ï¼›</li><li>lruï¼Œç”¨äºåˆ¤æ–­ç©ºé—²æ—¶é—´å¤ªä¹…çš„keyï¼Œåšå†…å­˜æ·˜æ±°å¤„ç†</li><li>refcountï¼Œç±»ä¼¼äºjvmä¸­çš„å¼•ç”¨è®¡æ•°æ³•ï¼Œæ— äººå¼•ç”¨æ—¶å¯è¢«å›æ”¶</li><li>ptrï¼ŒæŒ‡å‘<mark>åº•å±‚æ•°æ®ç»“æ„</mark>çš„æŒ‡é’ˆã€‚</li></ul><ol start="2"><li>encodingçš„11ç§ç±»å‹ï¼š</li></ol><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231105105930395.png" alt="image-20231105105930395"></p><ol start="3"><li>äº”ç§åŸºæœ¬æ•°æ®ç±»å‹çš„åº•å±‚ç¼–ç æ–¹å¼ï¼š</li></ol><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231105105954746.png" alt="image-20231105105954746"></p><blockquote><p>è¡¥å……ï¼šç±»ä¼¼äºbitmapï¼Œhyperloglogåº•å±‚å…¶å®éƒ½æ˜¯Stringç±»å‹ï¼ŒGEOåº•å±‚å…¶å®å°±æ˜¯ZSetç±»å‹</p></blockquote><h1 id="Redisåº”ç”¨"><a href="#Redisåº”ç”¨" class="headerlink" title="Redisåº”ç”¨"></a>Redisåº”ç”¨</h1><h2 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p><strong>ç¼“å­˜ç©¿é€æ˜¯æŒ‡å®¢æˆ·ç«¯è¯·æ±‚çš„æ•°æ®åœ¨ç¼“å­˜ä¸­å’Œæ•°æ®åº“ä¸­éƒ½ä¸å­˜åœ¨ï¼Œè¿™æ ·ç¼“å­˜æ°¸è¿œä¸ä¼šç”Ÿæ•ˆï¼Œè¿™äº›è¯·æ±‚éƒ½ä¼šæ‰“åˆ°æ•°æ®åº“ã€‚</strong></p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20230803213519682.png" alt="image-20230803213519682"></p><h3 id="å¸¸è§è§£å†³æ–¹æ¡ˆ"><a href="#å¸¸è§è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å¸¸è§è§£å†³æ–¹æ¡ˆ"></a>å¸¸è§è§£å†³æ–¹æ¡ˆ</h3><ol><li>ç¼“å­˜ç©ºå¯¹è±¡</li></ol><ul><li><p>ä¼˜ç‚¹ï¼šæ–¹ä¾¿ç®€å•</p></li><li><p>ç¼ºç‚¹ï¼šå¯èƒ½é€ æˆé¢å¤–çš„å†…å­˜æ¶ˆè€—ï¼Œå¯èƒ½é€ æˆçŸ­æœŸçš„ä¸ä¸€è‡´</p></li></ul><blockquote><p>è‹¥æœ‰ç”¨æˆ·æ¶æ„ä½¿ç”¨å¤šä¸ªä¸åŒidè¿›è¡ŒæŸ¥è¯¢ï¼Œåˆ™redisä¼šä¸æ–­ç¼“å­˜å¾ˆå¤šæ²¡æœ‰ç”¨çš„nullå€¼é€ æˆæµªè´¹ï¼Œä½†å¯ä»¥é€šè¿‡ä¸ºkeyæ·»åŠ è¿‡æœŸæ—¶é—´è§£å†³ã€‚</p><p>çŸ­æœŸä¸ä¸€è‡´æ˜¯å› ä¸ºæ•°æ®åº“å·²ç»æ›´æ–°æ•°æ®è€Œredisä¸­ä»ä¸ºnullå€¼ï¼Œå…¶å®å¯ä»¥é€šè¿‡æ’å…¥æ•°æ®çš„åŒæ—¶æ‰‹åŠ¨æ›´æ”¹redisçš„å€¼æ¥è§£å†³ã€‚</p></blockquote><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20230803213834986.png" alt="image-20230803213834986"></p><ol start="2"><li>å¸ƒéš†è¿‡æ»¤å™¨è¿‡æ»¤</li></ol><p>åœ¨æŸ¥è¯¢rediså‰å…ˆç»è¿‡å¸ƒéš†è¿‡æ»¤å™¨ï¼Œè‹¥redisä¸­å­˜åœ¨æ‰æ”¾è¡Œã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨ç”±äºæ˜¯åŸºäºå“ˆå¸Œå‡½æ•°å®ç°æŸ¥æ‰¾çš„ï¼Œé«˜æ•ˆæŸ¥æ‰¾çš„åŒæ—¶<mark><strong>å­˜åœ¨å“ˆå¸Œå†²çªçš„å¯èƒ½æ€§</strong></mark>ã€‚</p><ul><li>ä¼˜ç‚¹ï¼šå†…å­˜å ç”¨å°‘ï¼Œæ²¡æœ‰å¤šä½™çš„key</li><li>ç¼ºç‚¹ï¼šå¯èƒ½è¯¯åˆ¤ï¼ŒæŸ¥è¯¢å¸ƒéš†è¿‡æ»¤å™¨è¯´æ•°æ®å­˜åœ¨ï¼Œå¹¶ä¸ä¸€å®šè¯æ˜æ•°æ®åº“ä¸­å­˜åœ¨è¿™ä¸ªæ•°æ®ï¼Œä½†æ˜¯æŸ¥è¯¢åˆ°æ•°æ®ä¸å­˜åœ¨ï¼Œæ•°æ®åº“ä¸­ä¸€å®šå°±ä¸å­˜åœ¨è¿™ä¸ªæ•°æ®ã€‚</li></ul><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20230803214619650.png" alt="image-20230803214619650"></p><h2 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h2><h3 id="å®šä¹‰-1"><a href="#å®šä¹‰-1" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p><strong>ç¼“å­˜é›ªå´©æ˜¯æŒ‡åœ¨åŒä¸€æ—¶æ®µå¤§é‡çš„ç¼“å­˜keyåŒæ—¶å¤±æ•ˆæˆ–è€…RedisæœåŠ¡å®•æœºï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚åˆ°è¾¾æ•°æ®åº“ï¼Œå¸¦æ¥å·¨å¤§å‹åŠ›ã€‚</strong></p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20230804102636911.png" alt="image-20230804102636911"></p><h3 id="å¸¸è§è§£å†³æ–¹æ¡ˆ-1"><a href="#å¸¸è§è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="å¸¸è§è§£å†³æ–¹æ¡ˆ"></a>å¸¸è§è§£å†³æ–¹æ¡ˆ</h3><ol><li><p>ç»™ä¸åŒçš„Keyçš„TTLæ·»åŠ éšæœºå€¼</p></li><li><p>åå°æ›´æ–°ç¼“å­˜</p></li></ol><blockquote><p>å°†æ›´æ–°ç¼“å­˜çš„å·¥ä½œäº¤ç”±åå°çº¿ç¨‹å®šæ—¶æ›´æ–°</p></blockquote><p>è§£å†³æ–¹å¼æœ‰ä¸¤ç§ï¼š</p><p>ç¬¬ä¸€ç§æ–¹å¼ï¼Œåå°çº¿ç¨‹ä¸ä»…è´Ÿè´£å®šæ—¶æ›´æ–°ç¼“å­˜ï¼Œè€Œä¸”ä¹Ÿè´Ÿè´£<mark><strong>é¢‘ç¹åœ°æ£€æµ‹ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ</strong></mark>ï¼Œæ£€æµ‹åˆ°ç¼“å­˜å¤±æ•ˆäº†ï¼ŒåŸå› å¯èƒ½æ˜¯ç³»ç»Ÿç´§å¼ è€Œè¢«æ·˜æ±°çš„ï¼Œäºæ˜¯å°±è¦é©¬ä¸Šä»æ•°æ®åº“è¯»å–æ•°æ®ï¼Œå¹¶æ›´æ–°åˆ°ç¼“å­˜ã€‚</p><p>è¿™ç§æ–¹å¼çš„æ£€æµ‹æ—¶é—´é—´éš”ä¸èƒ½å¤ªé•¿ï¼Œå¤ªé•¿ä¹Ÿå¯¼è‡´ç”¨æˆ·è·å–çš„æ•°æ®æ˜¯ä¸€ä¸ªç©ºå€¼è€Œä¸æ˜¯çœŸæ­£çš„æ•°æ®ï¼Œæ‰€ä»¥æ£€æµ‹çš„é—´éš”æœ€å¥½æ˜¯æ¯«ç§’çº§çš„ï¼Œä½†æ˜¯æ€»å½’æ˜¯æœ‰ä¸ªé—´éš”æ—¶é—´ï¼Œç”¨æˆ·ä½“éªŒä¸€èˆ¬ã€‚</p><p>ç¬¬äºŒç§æ–¹å¼ï¼Œåœ¨ä¸šåŠ¡çº¿ç¨‹å‘ç°ç¼“å­˜æ•°æ®å¤±æ•ˆåï¼ˆç¼“å­˜æ•°æ®è¢«æ·˜æ±°ï¼‰ï¼Œ<mark><strong>é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å‘é€ä¸€æ¡æ¶ˆæ¯é€šçŸ¥åå°çº¿ç¨‹æ›´æ–°ç¼“å­˜</strong></mark>ï¼Œåå°çº¿ç¨‹æ”¶åˆ°æ¶ˆæ¯åï¼Œåœ¨æ›´æ–°ç¼“å­˜å‰å¯ä»¥åˆ¤æ–­ç¼“å­˜æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨å°±ä¸æ‰§è¡Œæ›´æ–°ç¼“å­˜æ“ä½œï¼›ä¸å­˜åœ¨å°±è¯»å–æ•°æ®åº“æ•°æ®ï¼Œå¹¶å°†æ•°æ®åŠ è½½åˆ°ç¼“å­˜ã€‚è¿™ç§æ–¹å¼ç›¸æ¯”ç¬¬ä¸€ç§æ–¹å¼ç¼“å­˜çš„æ›´æ–°ä¼šæ›´åŠæ—¶ï¼Œç”¨æˆ·ä½“éªŒä¹Ÿæ¯”è¾ƒå¥½ã€‚</p><p>åœ¨ä¸šåŠ¡åˆšä¸Šçº¿çš„æ—¶å€™ï¼Œæˆ‘ä»¬æœ€å¥½æå‰æŠŠæ•°æ®ç¼“èµ·æ¥ï¼Œè€Œä¸æ˜¯ç­‰å¾…ç”¨æˆ·è®¿é—®æ‰æ¥è§¦å‘ç¼“å­˜æ„å»ºï¼Œè¿™å°±æ˜¯æ‰€è°“çš„<mark><strong>ç¼“å­˜é¢„çƒ­</strong></mark>ï¼Œåå°æ›´æ–°ç¼“å­˜çš„æœºåˆ¶åˆšå¥½ä¹Ÿé€‚åˆå¹²è¿™ä¸ªäº‹æƒ…ã€‚</p><ol start="3"><li>åˆ©ç”¨Redisé›†ç¾¤æé«˜æœåŠ¡çš„å¯ç”¨æ€§</li></ol><p>é€šè¿‡<strong>ä¸»ä»èŠ‚ç‚¹çš„æ–¹å¼æ„å»º Redis ç¼“å­˜é«˜å¯é é›†ç¾¤</strong>ã€‚</p><p>å¦‚æœ Redis ç¼“å­˜çš„ä¸»èŠ‚ç‚¹æ•…éšœå®•æœºï¼Œ<mark>ä»èŠ‚ç‚¹å¯ä»¥åˆ‡æ¢æˆä¸ºä¸»èŠ‚ç‚¹</mark>ï¼Œç»§ç»­æä¾›ç¼“å­˜æœåŠ¡ï¼Œé¿å…äº†ç”±äº Redis æ•…éšœå®•æœºè€Œå¯¼è‡´çš„ç¼“å­˜é›ªå´©é—®é¢˜ã€‚</p><ol start="4"><li>æœåŠ¡ç†”æ–­æˆ–è¯·æ±‚é™æµæœºåˆ¶</li></ol><p>å› ä¸º Redis æ•…éšœå®•æœºè€Œå¯¼è‡´ç¼“å­˜é›ªå´©é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¯åŠ¨<mark><strong>æœåŠ¡ç†”æ–­</strong></mark>æœºåˆ¶ï¼Œ<strong>æš‚åœä¸šåŠ¡åº”ç”¨å¯¹ç¼“å­˜æœåŠ¡çš„è®¿é—®ï¼Œç›´æ¥è¿”å›é”™è¯¯</strong>ï¼Œä¸ç”¨å†ç»§ç»­è®¿é—®æ•°æ®åº“ï¼Œä»è€Œé™ä½å¯¹æ•°æ®åº“çš„è®¿é—®å‹åŠ›ï¼Œä¿è¯æ•°æ®åº“ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œï¼Œç„¶åç­‰åˆ° Redis æ¢å¤æ­£å¸¸åï¼Œå†å…è®¸ä¸šåŠ¡åº”ç”¨è®¿é—®ç¼“å­˜æœåŠ¡ã€‚</p><p>æœåŠ¡ç†”æ–­æœºåˆ¶æ˜¯ä¿æŠ¤æ•°æ®åº“çš„æ­£å¸¸å…è®¸ï¼Œä½†æ˜¯æš‚åœäº†ä¸šåŠ¡åº”ç”¨è®¿é—®ç¼“å­˜æœç³»ç»Ÿï¼Œå…¨éƒ¨ä¸šåŠ¡éƒ½æ— æ³•æ­£å¸¸å·¥ä½œ</p><p>ä¸ºäº†å‡å°‘å¯¹ä¸šåŠ¡çš„å½±å“ï¼Œæˆ‘ä»¬å¯ä»¥å¯ç”¨<mark><strong>è¯·æ±‚é™æµ</strong></mark>æœºåˆ¶ï¼Œ<strong>åªå°†å°‘éƒ¨åˆ†è¯·æ±‚å‘é€åˆ°æ•°æ®åº“è¿›è¡Œå¤„ç†ï¼Œå†å¤šçš„è¯·æ±‚å°±åœ¨å…¥å£ç›´æ¥æ‹’ç»æœåŠ¡</strong>ï¼Œç­‰åˆ° Redis æ¢å¤æ­£å¸¸å¹¶æŠŠç¼“å­˜é¢„çƒ­å®Œåï¼Œå†è§£é™¤è¯·æ±‚é™æµçš„æœºåˆ¶ã€‚</p><ol start="5"><li>ç»™ä¸šåŠ¡æ·»åŠ å¤šçº§ç¼“å­˜</li></ol><blockquote><p>åŒä¸€æ—¶æ®µå¤§é‡çš„ç¼“å­˜keyåŒæ—¶å¤±æ•ˆé‡‡ç”¨æ–¹æ¡ˆ1å’Œ2å’Œäº’æ–¥é”æ–¹æ¡ˆã€‚</p><p>rediså®•æœºé‡‡ç”¨æ–¹æ¡ˆ3ï¼Œ4ï¼Œ5ï¼Œredisé›†ç¾¤ä¸­ä¸»åº“æŒ‚äº†è¿˜è¦ä»åº“æ•°æ®ï¼Œç”¨sentinelå¯ä»¥é™çº§é™æµï¼Œå¤šçº§ç¼“å­˜å¯ç”¨nginxï¼Œjvmç­‰è¿›è¡Œç¼“å­˜ã€‚</p></blockquote><h2 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h2><h3 id="å®šä¹‰-2"><a href="#å®šä¹‰-2" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p><strong>ç¼“å­˜å‡»ç©¿é—®é¢˜ä¹Ÿå«<code>çƒ­ç‚¹Keyé—®é¢˜</code>ï¼Œå°±æ˜¯ä¸€ä¸ªè¢«é«˜å¹¶å‘è®¿é—®å¹¶ä¸”ç¼“å­˜é‡å»ºä¸šåŠ¡è¾ƒå¤æ‚çš„keyçªç„¶å¤±æ•ˆäº†ï¼Œæ— æ•°çš„è¯·æ±‚è®¿é—®ä¼šåœ¨ç¬é—´ç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§çš„å†²å‡»ã€‚</strong></p><h3 id="å¸¸è§è§£å†³æ–¹æ¡ˆ-2"><a href="#å¸¸è§è§£å†³æ–¹æ¡ˆ-2" class="headerlink" title="å¸¸è§è§£å†³æ–¹æ¡ˆ"></a>å¸¸è§è§£å†³æ–¹æ¡ˆ</h3><ol><li>äº’æ–¥é”</li></ol><blockquote><p>1000ä¸ªè¿›ç¨‹æ¥åŒæ—¶è®¿é—®ï¼Œä¸€ä¸ªè¿›ç¨‹æ‹¿åˆ°é”ï¼Œå…¶ä½™999ä¸ªè¿›ç¨‹éƒ½è¦ç­‰åˆ°çº¿ç¨‹1æŸ¥è¯¢æ•°æ®åº“é‡æ–°å†™å…¥ç¼“å­˜ï¼Œé‡Šæ”¾é”ä¹‹åæ‰èƒ½è®¿é—®ï¼Œæ€§èƒ½å·®ï¼Œä½†æ˜¯æœ‰å¼ºä¸€è‡´æ€§</p></blockquote><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20230804105357783.png" alt="image-20230804105357783"></p><ol start="2"><li>é€»è¾‘è¿‡æœŸ</li></ol><blockquote><p>å°±æ˜¯åœ¨redisä¿å­˜æ•°æ®çš„æ—¶å€™å¤šä¿å­˜ä¸€ä¸ªè¿‡æœŸæ—¶é—´å­—æ®µï¼Œé€šå¸¸æ˜¯åœ¨æ´»åŠ¨å¼€å§‹åˆ°ç»“æŸé‚£ä¸€ä¸ªæ—¶é—´æ®µå†…éƒ½ä¸ä¼šè¿‡æœŸï¼Œä¹Ÿå°±ä¸ä¼šçªç„¶å¤±æ•ˆäº†ã€‚è‹¥<strong>å¤±æ•ˆï¼ˆè¿™é‡Œè¯´çš„å¤±æ•ˆæŒ‡çš„æ˜¯é€»è¾‘æ—¶é—´è¿‡æœŸäº†ï¼‰</strong>äº†ä¹Ÿæ˜¯è¦é€šè¿‡é”çš„å½¢å¼å»é‡æ–°æŸ¥æ•°æ®åº“ï¼Œå­˜ç¼“å­˜ï¼Œé‡Šæ”¾é”ã€‚</p><p>ä¸è¿‡ç›¸å¯¹äºäº’æ–¥é”è€Œè¨€ï¼Œè¿™é‡Œçš„é”ä¸ä¸€æ ·äº†ã€‚è¿™é‡Œçº¿ç¨‹1è·å¾—é”ä¹‹åäº¤ç»™å¦å¤–çš„çº¿ç¨‹å»æ‰§è¡ŒæŸ¥æ•°æ®åº“ç­‰æ“ä½œï¼Œè€Œçº¿ç¨‹1è‡ªèº«åˆ™è¿”å›æ—§çš„æ•°æ®ã€‚å…¶ä»–è¿›ç¨‹åœ¨é‡Šæ”¾é”ä¹‹å‰æ¥è®¿é—®éƒ½æ˜¯è¿”å›çš„æ—§æ•°æ®ï¼Œåªæœ‰å½“é‡Šæ”¾é”ï¼Œå³å®Œæˆäº†æŸ¥æ•°æ®åº“ï¼Œå­˜å…¥ç¼“å­˜ï¼Œæ›´æ–°é€»è¾‘è¿‡æœŸæ—¶é—´åæ‰èƒ½è¿”å›æ–°æ•°æ®ã€‚</p></blockquote><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20230804110145305.png" alt="image-20230804110145305"></p><h3 id="ä¸¤ç§æ–¹æ¡ˆå¯¹æ¯”"><a href="#ä¸¤ç§æ–¹æ¡ˆå¯¹æ¯”" class="headerlink" title="ä¸¤ç§æ–¹æ¡ˆå¯¹æ¯”"></a>ä¸¤ç§æ–¹æ¡ˆå¯¹æ¯”</h3><table><thead><tr><th>è§£å†³æ–¹æ¡ˆ</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>äº’æ–¥é”</td><td>æ²¡æœ‰é¢å¤–çš„å†…å­˜æ¶ˆè€—ï¼Œä¿è¯ä¸€è‡´æ€§ï¼Œå®ç°ç®€å•</td><td>çº¿ç¨‹éœ€è¦ç­‰å¾…ï¼Œæ€§èƒ½å—å½±å“ï¼Œå¯èƒ½æœ‰æ­»é”</td></tr><tr><td>é€»è¾‘è¿‡æœŸ</td><td>çº¿ç¨‹æ— éœ€ç­‰å¾…ï¼Œæ€§èƒ½è¾ƒå¥½</td><td>ä¸ä¿è¯ä¸€è‡´æ€§ï¼Œæœ‰é¢å¤–å†…å­˜æ¶ˆè€—ï¼Œå®ç°å¤æ‚</td></tr></tbody></table><h2 id="ç¼“å­˜ä¸æ•°æ®åº“ä¿æŒä¸€è‡´é—®é¢˜"><a href="#ç¼“å­˜ä¸æ•°æ®åº“ä¿æŒä¸€è‡´é—®é¢˜" class="headerlink" title="ç¼“å­˜ä¸æ•°æ®åº“ä¿æŒä¸€è‡´é—®é¢˜"></a>ç¼“å­˜ä¸æ•°æ®åº“ä¿æŒä¸€è‡´é—®é¢˜</h2><h3 id="å…ˆæ›´æ–°æ•°æ®åº“ï¼Œè¿˜æ˜¯å…ˆæ›´æ–°ç¼“å­˜ï¼Ÿ"><a href="#å…ˆæ›´æ–°æ•°æ®åº“ï¼Œè¿˜æ˜¯å…ˆæ›´æ–°ç¼“å­˜ï¼Ÿ" class="headerlink" title="å…ˆæ›´æ–°æ•°æ®åº“ï¼Œè¿˜æ˜¯å…ˆæ›´æ–°ç¼“å­˜ï¼Ÿ"></a>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œè¿˜æ˜¯å…ˆæ›´æ–°ç¼“å­˜ï¼Ÿ</h3><ol><li>å…ˆæ›´æ–°æ•°æ®åº“å†æ›´æ–°ç¼“å­˜</li></ol><p><mark>ä¼šå‡ºç°å¹¶å‘é—®é¢˜</mark></p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231031150644998.png" alt="å…ˆæ›´æ–°æ•°æ®åº“å†æ›´æ–°ç¼“å­˜"></p><ol start="2"><li>å…ˆæ›´æ–°ç¼“å­˜å†æ›´æ–°æ•°æ®åº“</li></ol><p><mark>ä¹Ÿä¼šå‡ºç°å¹¶å‘é—®é¢˜</mark></p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231031150609307.png" alt="å…ˆæ›´æ–°ç¼“å­˜å†æ›´æ–°æ•°æ®åº“"></p><p>æ‰€ä»¥ï¼Œ<strong>æ— è®ºæ˜¯ã€Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ã€ï¼Œè¿˜æ˜¯ã€Œå…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ã€ï¼Œè¿™ä¸¤ä¸ªæ–¹æ¡ˆ<mark>éƒ½å­˜åœ¨å¹¶å‘é—®é¢˜</mark>ï¼Œå½“ä¸¤ä¸ªè¯·æ±‚å¹¶å‘æ›´æ–°åŒä¸€æ¡æ•°æ®çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°ç¼“å­˜å’Œæ•°æ®åº“ä¸­çš„æ•°æ®ä¸ä¸€è‡´çš„ç°è±¡</strong>ã€‚</p><p>å¢åŠ ä¸€äº›æ‰‹æ®µæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿™é‡Œæä¾›ä¸¤ç§åšæ³•ï¼š</p><ul><li>åœ¨æ›´æ–°ç¼“å­˜å‰å…ˆåŠ ä¸ª<strong>åˆ†å¸ƒå¼é”</strong>ï¼Œä¿è¯åŒä¸€æ—¶é—´åªè¿è¡Œä¸€ä¸ªè¯·æ±‚æ›´æ–°ç¼“å­˜ï¼Œå°±ä¼šä¸ä¼šäº§ç”Ÿå¹¶å‘é—®é¢˜äº†ï¼Œå½“ç„¶å¼•å…¥äº†é”åï¼Œå¯¹äºå†™å…¥çš„æ€§èƒ½å°±ä¼šå¸¦æ¥å½±å“ã€‚</li><li>åœ¨æ›´æ–°å®Œç¼“å­˜æ—¶ï¼Œç»™ç¼“å­˜åŠ ä¸Šè¾ƒçŸ­çš„<strong>è¿‡æœŸæ—¶é—´</strong>ï¼Œè¿™æ ·å³æ—¶å‡ºç°ç¼“å­˜ä¸ä¸€è‡´çš„æƒ…å†µï¼Œç¼“å­˜çš„æ•°æ®ä¹Ÿä¼šå¾ˆå¿«è¿‡æœŸï¼Œå¯¹ä¸šåŠ¡è¿˜æ˜¯èƒ½æ¥å—çš„ã€‚</li></ul><h3 id="å…ˆæ›´æ–°æ•°æ®åº“ï¼Œè¿˜æ˜¯å…ˆåˆ é™¤ç¼“å­˜ï¼Ÿ"><a href="#å…ˆæ›´æ–°æ•°æ®åº“ï¼Œè¿˜æ˜¯å…ˆåˆ é™¤ç¼“å­˜ï¼Ÿ" class="headerlink" title="å…ˆæ›´æ–°æ•°æ®åº“ï¼Œè¿˜æ˜¯å…ˆåˆ é™¤ç¼“å­˜ï¼Ÿ"></a>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œè¿˜æ˜¯å…ˆåˆ é™¤ç¼“å­˜ï¼Ÿ</h3><p><strong>Cache Aside ç­–ç•¥</strong>ï¼šåœ¨æ›´æ–°æ•°æ®æ—¶ï¼Œä¸æ›´æ–°ç¼“å­˜ï¼Œè€Œæ˜¯åˆ é™¤ç¼“å­˜ä¸­çš„æ•°æ®ã€‚ç„¶åï¼Œåˆ°è¯»å–æ•°æ®æ—¶ï¼Œå‘ç°ç¼“å­˜ä¸­æ²¡äº†æ•°æ®ä¹‹åï¼Œå†ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼Œæ›´æ–°åˆ°ç¼“å­˜ä¸­ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231031151154103.png" alt="Cache Aside ç­–ç•¥"></p><p><strong>å†™ç­–ç•¥çš„æ­¥éª¤ï¼š</strong></p><ul><li>æ›´æ–°æ•°æ®åº“ä¸­çš„æ•°æ®ï¼›</li><li>åˆ é™¤ç¼“å­˜ä¸­çš„æ•°æ®ã€‚</li></ul><p><strong>è¯»ç­–ç•¥çš„æ­¥éª¤ï¼š</strong></p><ul><li>å¦‚æœè¯»å–çš„æ•°æ®å‘½ä¸­äº†ç¼“å­˜ï¼Œåˆ™ç›´æ¥è¿”å›æ•°æ®ï¼›</li><li>å¦‚æœè¯»å–çš„æ•°æ®æ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œåˆ™ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼Œç„¶åå°†æ•°æ®å†™å…¥åˆ°ç¼“å­˜ï¼Œå¹¶ä¸”è¿”å›ç»™ç”¨æˆ·ã€‚</li></ul><ol><li>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</li></ol><p>å‡è®¾æŸä¸ªç”¨æˆ·çš„å¹´é¾„æ˜¯ 20ï¼Œè¯·æ±‚ A è¦æ›´æ–°ç”¨æˆ·å¹´é¾„ä¸º 21ï¼Œæ‰€ä»¥å®ƒä¼šåˆ é™¤ç¼“å­˜ä¸­çš„å†…å®¹ã€‚è¿™æ—¶ï¼Œå¦ä¸€ä¸ªè¯·æ±‚ B è¦è¯»å–è¿™ä¸ªç”¨æˆ·çš„å¹´é¾„ï¼Œå®ƒæŸ¥è¯¢ç¼“å­˜å‘ç°æœªå‘½ä¸­åï¼Œä¼šä»æ•°æ®åº“ä¸­è¯»å–åˆ°å¹´é¾„ä¸º 20ï¼Œå¹¶ä¸”å†™å…¥åˆ°ç¼“å­˜ä¸­ï¼Œç„¶åè¯·æ±‚ A ç»§ç»­æ›´æ”¹æ•°æ®åº“ï¼Œå°†ç”¨æˆ·çš„å¹´é¾„æ›´æ–°ä¸º 21ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/cc208c2931b4e889d1a58cb655537767.png" alt="å…ˆåˆ é™¤ç¼“å­˜å†æ›´æ–°æ•°æ®åº“"></p><p>æœ€ç»ˆï¼Œè¯¥ç”¨æˆ·å¹´é¾„åœ¨ç¼“å­˜ä¸­æ˜¯ 20ï¼ˆæ—§å€¼ï¼‰ï¼Œåœ¨æ•°æ®åº“ä¸­æ˜¯ 21ï¼ˆæ–°å€¼ï¼‰ï¼Œç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œ<strong>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼Œåœ¨ã€Œè¯» + å†™ã€å¹¶å‘çš„æ—¶å€™ï¼Œè¿˜æ˜¯ä¼šå‡ºç°ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜</strong>ã€‚</p><p>é’ˆå¯¹<strong>ã€Œå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ã€</strong>æ–¹æ¡ˆåœ¨ã€Œè¯» + å†™ã€å¹¶å‘è¯·æ±‚è€Œé€ æˆç¼“å­˜ä¸ä¸€è‡´çš„è§£å†³åŠæ³•æ˜¯ã€Œ<strong>å»¶è¿ŸåŒåˆ </strong>ã€ã€‚ï¼ˆå¯¹äºä¸Šé¢é‚£å¼ å›¾è€Œè¨€ï¼Œå»¶è¿Ÿåˆ é™¤çš„æ—¶æœºå°±åœ¨<mark>è¯·æ±‚Bç»“æŸä¸ºæ­¢å³å¯è¿›è¡Œå»¶è¿Ÿåˆ é™¤</mark>ï¼‰</p><p>å»¶è¿ŸåŒåˆ å®ç°çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#åˆ é™¤ç¼“å­˜</span><br><span class="line">redis.delKey(X)</span><br><span class="line">#æ›´æ–°æ•°æ®åº“</span><br><span class="line">db.update(X)</span><br><span class="line">#ç¡çœ </span><br><span class="line">Thread.sleep(N)</span><br><span class="line">#å†åˆ é™¤ç¼“å­˜</span><br><span class="line">redis.delKey(X)</span><br></pre></td></tr></table></figure><p>åŠ äº†ä¸ªç¡çœ æ—¶é—´ï¼Œä¸»è¦æ˜¯ä¸ºäº†ç¡®ä¿è¯·æ±‚ A åœ¨ç¡çœ çš„æ—¶å€™ï¼Œè¯·æ±‚ B èƒ½å¤Ÿåœ¨è¿™è¿™ä¸€æ®µæ—¶é—´å®Œæˆã€Œä»æ•°æ®åº“è¯»å–æ•°æ®ï¼Œå†æŠŠç¼ºå¤±çš„ç¼“å­˜å†™å…¥ç¼“å­˜ã€çš„æ“ä½œï¼Œç„¶åè¯·æ±‚ A ç¡çœ å®Œï¼Œå†åˆ é™¤ç¼“å­˜ã€‚</p><p>æ‰€ä»¥ï¼Œè¯·æ±‚ A çš„ç¡çœ æ—¶é—´å°±éœ€è¦å¤§äºè¯·æ±‚ B ã€Œä»æ•°æ®åº“è¯»å–æ•°æ® + å†™å…¥ç¼“å­˜ã€çš„æ—¶é—´ã€‚</p><p>ä½†æ˜¯å…·ä½“ç¡çœ å¤šä¹…å…¶å®æ˜¯ä¸ª<strong>ç„å­¦</strong>ï¼Œå¾ˆéš¾è¯„ä¼°å‡ºæ¥ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ¡ˆä¹Ÿåªæ˜¯<strong>å°½å¯èƒ½</strong>ä¿è¯ä¸€è‡´æ€§è€Œå·²ï¼Œæç«¯æƒ…å†µä¸‹ï¼Œä¾ç„¶ä¹Ÿä¼šå‡ºç°ç¼“å­˜ä¸ä¸€è‡´çš„ç°è±¡ã€‚</p><p>å› æ­¤ï¼Œè¿˜æ˜¯æ¯”è¾ƒå»ºè®®ç”¨<strong>ã€Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€</strong>çš„æ–¹æ¡ˆã€‚</p><ol start="2"><li>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</li></ol><p>å‡å¦‚æŸä¸ªç”¨æˆ·æ•°æ®åœ¨ç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œè¯·æ±‚ A è¯»å–æ•°æ®æ—¶ä»æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°å¹´é¾„ä¸º 20ï¼Œåœ¨æœªå†™å…¥ç¼“å­˜ä¸­æ—¶å¦ä¸€ä¸ªè¯·æ±‚ B æ›´æ–°æ•°æ®ã€‚å®ƒæ›´æ–°æ•°æ®åº“ä¸­çš„å¹´é¾„ä¸º 21ï¼Œå¹¶ä¸”æ¸…ç©ºç¼“å­˜ã€‚è¿™æ—¶è¯·æ±‚ A æŠŠä»æ•°æ®åº“ä¸­è¯»åˆ°çš„å¹´é¾„ä¸º 20 çš„æ•°æ®å†™å…¥åˆ°ç¼“å­˜ä¸­ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231031152630816.png" alt="å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜"></p><p>ç†è®ºä¸Šæ¥è®²è¿™æ ·å…ˆæ›´æ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜ä¹Ÿæ˜¯ä¼šå¯¼è‡´æ•°æ®åº“ç¼“å­˜çš„ä¸ä¸€è‡´çš„ï¼Œä½†æ˜¯<mark>å®é™…ä¸Šå‘ç”Ÿè¿™æ ·çš„æƒ…å†µçš„å‡ ç‡å¾ˆå°</mark>ï¼Œå› ä¸ºå°†å†™ç¼“å­˜çš„æ“ä½œæ˜¯è¦è¿œè¿œå¿«äºæ›´æ–°æ•°æ®åº“çš„ã€‚</p><p>è¿™ä¸ªæ–¹æ¡ˆçš„åŸºç¡€ä¸Šå†åŠ ä¸Šå¯¹keyåšè¿‡æœŸå¤„ç†ï¼Œå°±æ˜¯ä¸€ä¸ªå¯è¡Œçš„æ–¹æ¡ˆäº†ï¼Œå³ä½¿æœ‰ä¸€æ®µæ—¶é—´çš„æ•°æ®ä¸ä¸€è‡´ï¼Œä¹Ÿä¼šæœ‰è¿‡æœŸç­–ç•¥æ¥ä¿åº•ã€‚</p><hr><p>ä½†æ˜¯ä¸Šé¢çš„æƒ…å†µçš„å‰ææ˜¯<strong>æ›´æ–°æ•°æ®åº“</strong>å’Œ<strong>åˆ é™¤ç¼“å­˜</strong>è¿™ä¸¤ä»¶äº‹æ˜¯åŒæ—¶å‘ç”Ÿä¸”éƒ½æˆåŠŸçš„æƒ…å†µä¸‹çš„ï¼Œè¦åšåˆ°åŒæ—¶å‘ç”Ÿï¼Œå¯ä»¥ä½¿ç”¨<code>lua</code>è„šæœ¬è¿›è¡ŒåŸå­æ€§çš„æ“ä½œï¼Œè¦åšåˆ°éƒ½æˆåŠŸæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š</p><ul><li>é‡è¯•æœºåˆ¶ã€‚</li><li>è®¢é˜… MySQL binlogï¼Œå†æ“ä½œç¼“å­˜ã€‚</li></ul><ol><li>é‡è¯•æœºåˆ¶</li></ol><p>æˆ‘ä»¬å¯ä»¥å¼•å…¥<strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼Œå°†ç¬¬äºŒä¸ªæ“ä½œï¼ˆåˆ é™¤ç¼“å­˜ï¼‰è¦æ“ä½œçš„æ•°æ®åŠ å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”±æ¶ˆè´¹è€…æ¥æ“ä½œæ•°æ®ã€‚</p><ul><li>å¦‚æœåº”ç”¨<strong>åˆ é™¤ç¼“å­˜å¤±è´¥</strong>ï¼Œå¯ä»¥ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­é‡æ–°è¯»å–æ•°æ®ï¼Œç„¶åå†æ¬¡åˆ é™¤ç¼“å­˜ï¼Œè¿™ä¸ªå°±æ˜¯<strong>é‡è¯•æœºåˆ¶</strong>ã€‚å½“ç„¶ï¼Œå¦‚æœé‡è¯•è¶…è¿‡çš„ä¸€å®šæ¬¡æ•°ï¼Œè¿˜æ˜¯æ²¡æœ‰æˆåŠŸï¼Œæˆ‘ä»¬å°±éœ€è¦å‘ä¸šåŠ¡å±‚å‘é€æŠ¥é”™ä¿¡æ¯äº†ã€‚</li><li>å¦‚æœ<strong>åˆ é™¤ç¼“å­˜æˆåŠŸ</strong>ï¼Œå°±è¦æŠŠæ•°æ®ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œé¿å…é‡å¤æ“ä½œï¼Œå¦åˆ™å°±ç»§ç»­é‡è¯•ã€‚</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¥è¯´æ˜é‡è¯•æœºåˆ¶çš„è¿‡ç¨‹ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231031162859822.png" alt="æ¶ˆæ¯é˜Ÿåˆ—é‡è¯•æœºåˆ¶"></p><ol start="2"><li>è®¢é˜… MySQL binlogï¼Œå†æ“ä½œç¼“å­˜</li></ol><p>ã€Œ<strong>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ ç¼“å­˜</strong>ã€çš„ç­–ç•¥çš„ç¬¬ä¸€æ­¥æ˜¯æ›´æ–°æ•°æ®åº“ï¼Œé‚£ä¹ˆæ›´æ–°æ•°æ®åº“æˆåŠŸï¼Œå°±ä¼šäº§ç”Ÿä¸€æ¡å˜æ›´æ—¥å¿—ï¼Œè®°å½•åœ¨ binlog é‡Œã€‚</p><p>äºæ˜¯æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è®¢é˜… binlog æ—¥å¿—ï¼Œæ‹¿åˆ°å…·ä½“è¦æ“ä½œçš„æ•°æ®ï¼Œç„¶åå†æ‰§è¡Œç¼“å­˜åˆ é™¤ï¼Œé˜¿é‡Œå·´å·´å¼€æºçš„ Canal ä¸­é—´ä»¶å°±æ˜¯åŸºäºè¿™ä¸ªå®ç°çš„ã€‚</p><p>Canal æ¨¡æ‹Ÿ MySQL ä¸»ä»å¤åˆ¶çš„äº¤äº’åè®®ï¼ŒæŠŠè‡ªå·±ä¼ªè£…æˆä¸€ä¸ª MySQL çš„ä»èŠ‚ç‚¹ï¼Œå‘ MySQL ä¸»èŠ‚ç‚¹å‘é€ dump è¯·æ±‚ï¼ŒMySQL æ”¶åˆ°è¯·æ±‚åï¼Œå°±ä¼šå¼€å§‹æ¨é€ Binlog ç»™ Canalï¼ŒCanal è§£æ Binlog å­—èŠ‚æµä¹‹åï¼Œè½¬æ¢ä¸ºä¾¿äºè¯»å–çš„ç»“æ„åŒ–æ•°æ®ï¼Œä¾›ä¸‹æ¸¸ç¨‹åºè®¢é˜…ä½¿ç”¨ã€‚</p><p>ä¸‹å›¾æ˜¯ Canal çš„å·¥ä½œåŸç†ï¼š</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/2ee2280e9f59b6b4879ebdec6eb0cf52.png" alt="å›¾ç‰‡"></p><p>æ‰€ä»¥ï¼Œ<strong>å¦‚æœè¦æƒ³ä¿è¯ã€Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ ç¼“å­˜ã€ç­–ç•¥ç¬¬äºŒä¸ªæ“ä½œèƒ½æ‰§è¡ŒæˆåŠŸï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ã€Œæ¶ˆæ¯é˜Ÿåˆ—æ¥é‡è¯•ç¼“å­˜çš„åˆ é™¤ã€ï¼Œæˆ–è€…ã€Œè®¢é˜… MySQL binlog å†æ“ä½œç¼“å­˜ã€ï¼Œè¿™ä¸¤ç§æ–¹æ³•æœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼Œ<mark>éƒ½æ˜¯é‡‡ç”¨å¼‚æ­¥æ“ä½œç¼“å­˜</mark>ã€‚</strong></p><blockquote><p>ä¸ºä»€ä¹ˆæ˜¯åˆ é™¤ç¼“å­˜ï¼Œè€Œä¸æ˜¯æ›´æ–°ç¼“å­˜å‘¢ï¼Ÿ</p></blockquote><p>åˆ é™¤ä¸€ä¸ªæ•°æ®ï¼Œç›¸æ¯”æ›´æ–°ä¸€ä¸ªæ•°æ®æ›´åŠ è½»é‡çº§ï¼Œå‡ºé—®é¢˜çš„æ¦‚ç‡æ›´å°ã€‚</p><p>æ¯”å¦‚å•†å“è¯¦æƒ…ä¿¡æ¯ï¼Œåœ¨åº•å±‚å¯èƒ½ä¼šå…³è”å•†å“è¡¨ã€ä»·æ ¼è¡¨ã€åº“å­˜è¡¨ç­‰ï¼Œå¦‚æœæ›´æ–°äº†ä¸€ä¸ªä»·æ ¼å­—æ®µï¼Œé‚£ä¹ˆå°±è¦æ›´æ–°æ•´ä¸ªæ•°æ®åº“ï¼Œè¿˜è¦å…³è”çš„å»æŸ¥è¯¢å’Œæ±‡æ€»å„ä¸ªå‘¨è¾¹ä¸šåŠ¡ç³»ç»Ÿçš„æ•°æ®ï¼Œè¿™ä¸ªæ“ä½œä¼šéå¸¸è€—æ—¶ã€‚ ä»å¦å¤–ä¸€ä¸ªè§’åº¦ï¼Œä¸æ˜¯æ‰€æœ‰çš„ç¼“å­˜æ•°æ®éƒ½æ˜¯é¢‘ç¹è®¿é—®çš„ï¼Œæ›´æ–°åçš„ç¼“å­˜å¯èƒ½ä¼šé•¿æ—¶é—´ä¸è¢«è®¿é—®ï¼Œæ‰€ä»¥è¯´ï¼Œä»è®¡ç®—èµ„æºå’Œæ•´ä½“æ€§èƒ½çš„è€ƒè™‘ï¼Œæ›´æ–°çš„æ—¶å€™åˆ é™¤ç¼“å­˜ï¼Œç­‰åˆ°ä¸‹æ¬¡æŸ¥è¯¢å‘½ä¸­å†å¡«å……ç¼“å­˜ï¼Œæ˜¯ä¸€ä¸ªæ›´å¥½çš„æ–¹æ¡ˆã€‚</p><h3 id="ğŸ”´ğŸŸ¡ğŸŸ¢æ€»ç»“"><a href="#ğŸ”´ğŸŸ¡ğŸŸ¢æ€»ç»“" class="headerlink" title="ğŸ”´ğŸŸ¡ğŸŸ¢æ€»ç»“"></a>ğŸ”´ğŸŸ¡ğŸŸ¢æ€»ç»“</h3><p>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼Œæ­é…ä¸Šæ¶ˆæ¯é˜Ÿåˆ—å’Œè¿‡æœŸç­–ç•¥å°±æ˜¯æœ€å¥½çš„æ–¹æ¡ˆã€‚</p><blockquote><p>æ•°æ®è¦æ±‚ä¸€è‡´æ€§ä¸å¼ºçš„æ—¶å€™å°±å»¶è¿ŸåŒåˆ ï¼Œè¦æ±‚å¼ºä¸€è‡´å°±è¯»å†™é”ï¼Œæ€§èƒ½å·®ã€‚</p></blockquote><h2 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h2><h3 id="æ ¸å¿ƒæ€æƒ³"><a href="#æ ¸å¿ƒæ€æƒ³" class="headerlink" title="æ ¸å¿ƒæ€æƒ³"></a>æ ¸å¿ƒæ€æƒ³</h3><p>åˆ†å¸ƒå¼é”çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯è®©å¤§å®¶å…±ç”¨åŒä¸€æŠŠé”ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½é”ä½çº¿ç¨‹ï¼Œä¸è®©çº¿ç¨‹è¿›è¡Œï¼Œè®©ç¨‹åºä¸²è¡Œæ‰§è¡Œï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼é”çš„æ ¸å¿ƒæ€è·¯ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20230819135201384.png" alt="image-20230819135201384"></p><h3 id="å®ç°ä»£ç "><a href="#å®ç°ä»£ç " class="headerlink" title="å®ç°ä»£ç "></a>å®ç°ä»£ç </h3><ol><li>åˆ†å¸ƒå¼é”</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleRedisLock</span> <span class="keyword">implements</span> <span class="title class_">ILock</span> &#123;</span><br><span class="line">    <span class="comment">//é”çš„å‰ç¼€</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;lock:&quot;</span>;</span><br><span class="line">    <span class="comment">//åˆ©ç”¨UUIDå¢åŠ å¤æ‚åº¦</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ID_PREFIX</span> <span class="operator">=</span> UUID.randomUUID().toString(<span class="literal">true</span>) + <span class="string">&quot;-&quot;</span>;</span><br><span class="line">    <span class="comment">//å…·ä½“ä¸šåŠ¡åç§°ï¼Œå°†å‰ç¼€å’Œä¸šåŠ¡åæ‹¼æ¥ä¹‹åå½“åšKey</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">//è¿™é‡Œä¸éœ€è¦@Autowiredï¼Œå› ä¸ºè¯¥å¯¹è±¡æ˜¯æˆ‘ä»¬ä½¿ç”¨æ„é€ å‡½æ•°æ‰‹åŠ¨newå‡ºæ¥çš„</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DefaultRedisScript&lt;Long&gt; UNLOCK_SCRIPT;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        UNLOCK_SCRIPT = <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>();</span><br><span class="line">        UNLOCK_SCRIPT.setLocation(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;unlock.lua&quot;</span>));</span><br><span class="line">        UNLOCK_SCRIPT.setResultType(Long.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SimpleRedisLock</span><span class="params">(String name, StringRedisTemplate stringRedisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> timeoutSec)</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–çº¿ç¨‹æ ‡è¯†</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">threadId</span> <span class="operator">=</span> ID_PREFIX + Thread.currentThread().getId();</span><br><span class="line">        <span class="comment">//è·å–é”ï¼Œä½¿ç”¨SETNXæ–¹æ³•è¿›è¡ŒåŠ é”ï¼ŒåŒæ—¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ­»é”</span></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">success</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(KEY_PREFIX + name, threadId, timeoutSec, TimeUnit.SECONDS);</span><br><span class="line">        <span class="comment">//è‡ªåŠ¨æ‹†ç®±å¯èƒ½ä¼šå‡ºç°nullï¼Œè¿™æ ·å†™æ›´ç¨³å¦¥</span></span><br><span class="line">        <span class="keyword">return</span> Boolean.TRUE.equals(success);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span> &#123;</span><br><span class="line">        stringRedisTemplate.execute(UNLOCK_SCRIPT,</span><br><span class="line">                Collections.singletonList(KEY_PREFIX + name),</span><br><span class="line">                ID_PREFIX + Thread.currentThread().getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>luaè„šæœ¬</li></ol><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è¿™é‡Œçš„KEYS[1]å°±æ˜¯ä¼ å…¥é”çš„key</span></span><br><span class="line"><span class="comment">-- è¿™é‡Œçš„ARGV[1]å°±æ˜¯çº¿ç¨‹æ ‡è¯†</span></span><br><span class="line"><span class="comment">-- æ¯”è¾ƒé”ä¸­çš„çº¿ç¨‹æ ‡è¯†ä¸çº¿ç¨‹æ ‡è¯†æ˜¯å¦ä¸€è‡´</span></span><br><span class="line"><span class="keyword">if</span> (redis.call(<span class="string">&#x27;get&#x27;</span>, KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>]) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- ä¸€è‡´åˆ™é‡Šæ”¾é”</span></span><br><span class="line">    <span class="keyword">return</span> redis.call(<span class="string">&#x27;del&#x27;</span>, KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><ol start="3"><li>ä½¿ç”¨é”</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SimpleRedisLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleRedisLock</span>(<span class="string">&quot;order:&quot;</span> + userId, stringRedisTemplate);</span><br><span class="line">        <span class="comment">//è·å–é”å¯¹è±¡</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> lock.tryLock(<span class="number">1200</span>);</span><br><span class="line">        <span class="comment">//åŠ é”å¤±è´¥</span></span><br><span class="line">        <span class="keyword">if</span> (!isLock) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//è·å–ä»£ç†å¯¹è±¡(äº‹åŠ¡)</span></span><br><span class="line">            <span class="type">IVoucherOrderService</span> <span class="variable">proxy</span> <span class="operator">=</span> (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">            <span class="keyword">return</span> proxy.createVoucherOrder(voucherId);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h3 id="Redisson"><a href="#Redisson" class="headerlink" title="Redisson"></a>Redisson</h3><blockquote><p>ä¸Šé¢å®ç°çš„åˆ†å¸ƒå¼é”å­˜åœ¨ä¸å¯é‡å…¥ï¼Œä¸å¯é‡è¯•çš„é—®é¢˜ï¼Œå°†ä½¿ç”¨redissonæä¾›çš„æ¡†æ¶æ¥å®ç°</p></blockquote><p>è§£é‡Šï¼š</p><p>ä¸Šé¢å®ç°çš„åˆ†å¸ƒå¼é”æ˜¯é‡‡ç”¨key-valueå½¢å¼çš„é”ï¼Œåœ¨åˆ¤æ–­keyç›¸åŒä¹‹ååˆ™ä¼šç›´æ¥è®¤ä¸ºè¿™æŠŠé”å·²ç»è¢«å ç”¨äº†ï¼Œæ‰€ä»¥è·å–é”å¤±è´¥ï¼Œä½†æ˜¯redissonä½¿ç”¨çš„æ˜¯hashç±»å‹çš„æ•°æ®ç»“æ„ï¼Œåœ¨çœ‹åˆ°é”å·²ç»å­˜åœ¨åï¼Œä¸æ˜¯ç›´æ¥è®¤å®šè·å–é”å¤±è´¥ï¼Œè€Œæ˜¯åˆ¤æ–­é”çš„æ ‡è¯†æ˜¯å¦æ˜¯è‡ªå·±ï¼Œå¦‚æœæ˜¯åˆ™valueåŠ ä¸€ï¼Œä»£è¡¨é‡å…¥æ¬¡æ•°åŠ ä¸€ï¼Œæœ€åè¦åˆ é™¤é”ä¹Ÿæ˜¯è¦ç­‰åˆ°valueä¸º0ï¼Œå³ç¨‹åºè¿è¡Œåˆ°æœ€å¤–å±‚çš„æ—¶å€™æ‰èƒ½é‡Šæ”¾ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20230819144801293.png" alt="Redissonå¯é‡å…¥é”åŸç†"></p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20230819160739146.png" alt="image-20230819160739146"></p><p><strong>é‡ç‚¹ï¼š</strong></p><blockquote><p>ä½¿ç”¨luaè„šæœ¬ï¼Œç­‰å¾…é‡è¯•ï¼Œçœ‹é—¨ç‹—æœºåˆ¶ï¼ˆç”¨æ¥ç»­æœŸé”ï¼‰</p></blockquote><h2 id="å…³æ³¨æ¨é€"><a href="#å…³æ³¨æ¨é€" class="headerlink" title="å…³æ³¨æ¨é€"></a>å…³æ³¨æ¨é€</h2><p>ä½¿ç”¨æ¨æ¨¡å¼</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20230821152151166.png" alt="image-20230821152151166"></p><p>æ»šåŠ¨åˆ†é¡µæŸ¥è¯¢</p><p>zset</p><h1 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h1><h2 id="å®šä¹‰-3"><a href="#å®šä¹‰-3" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>Redisäº‹åŠ¡æ˜¯ä¸€ä¸ªå•ç‹¬çš„éš”ç¦»æ“ä½œï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚</p><p>Redisäº‹åŠ¡çš„ä¸»è¦ä½œç”¨å°±æ˜¯<strong>ä¸²è”å¤šä¸ªå‘½ä»¤</strong>é˜²æ­¢åˆ«çš„å‘½ä»¤æ’é˜Ÿã€‚</p><h2 id="Multiã€Execã€discard"><a href="#Multiã€Execã€discard" class="headerlink" title="Multiã€Execã€discard"></a>Multiã€Execã€discard</h2><p>ä»è¾“å…¥Multiå‘½ä»¤å¼€å§‹ï¼Œè¾“å…¥çš„å‘½ä»¤éƒ½ä¼šä¾æ¬¡è¿›å…¥å‘½ä»¤é˜Ÿåˆ—ä¸­ï¼Œä½†ä¸ä¼šæ‰§è¡Œï¼Œç›´åˆ°è¾“å…¥Execåï¼ŒRedisä¼šå°†ä¹‹å‰çš„å‘½ä»¤é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¾æ¬¡æ‰§è¡Œã€‚</p><p>ç»„é˜Ÿçš„è¿‡ç¨‹ä¸­å¯ä»¥é€šè¿‡discardæ¥æ”¾å¼ƒç»„é˜Ÿã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231024153825141.png" alt="image-20231024153825141"></p><h2 id="äº‹åŠ¡çš„é”™è¯¯å¤„ç†"><a href="#äº‹åŠ¡çš„é”™è¯¯å¤„ç†" class="headerlink" title="äº‹åŠ¡çš„é”™è¯¯å¤„ç†"></a>äº‹åŠ¡çš„é”™è¯¯å¤„ç†</h2><ol><li>ç»„é˜Ÿä¸­æŸä¸ªå‘½ä»¤å‡ºç°äº†æŠ¥å‘Šé”™è¯¯ï¼Œæ‰§è¡Œæ—¶æ•´ä¸ªçš„æ‰€æœ‰é˜Ÿåˆ—éƒ½ä¼šè¢«å–æ¶ˆã€‚</li></ol><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231024154026128.png" alt="image-20231024154026128"></p><ol start="2"><li>å¦‚æœæ‰§è¡Œé˜¶æ®µæŸä¸ªå‘½ä»¤æŠ¥å‡ºäº†é”™è¯¯ï¼Œåˆ™åªæœ‰æŠ¥é”™çš„å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œï¼Œè€Œå…¶ä»–çš„å‘½ä»¤éƒ½ä¼šæ‰§è¡Œï¼Œä¸ä¼šå›æ»šã€‚</li></ol><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231024154101032.png" alt="image-20231024154101032"></p><h2 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h2><p>ä½¿ç”¨<code>WATCH</code>å‘½ä»¤æ˜¯ä¸€ç§<strong>æ‰‹åŠ¨å®ç°ä¹è§‚é”</strong>çš„æ–¹å¼ï¼Œå¯ä»¥åœ¨å¤šä¸ªäº‹åŠ¡ä¹‹é—´é˜²æ­¢ç«æ€æ¡ä»¶å’Œæ•°æ®ä¸ä¸€è‡´ã€‚å¦‚æœä¸å»ä½¿ç”¨<code>WATCH</code>ï¼ŒRedis<strong>é»˜è®¤ä¸ä¼šè‡ªåŠ¨</strong>é˜»æ­¢å¤šä¸ªäº‹åŠ¡ä¹‹é—´çš„å†²çªã€‚</p><h2 id="Redisäº‹åŠ¡ä¸‰ç‰¹æ€§"><a href="#Redisäº‹åŠ¡ä¸‰ç‰¹æ€§" class="headerlink" title="Redisäº‹åŠ¡ä¸‰ç‰¹æ€§"></a>Redisäº‹åŠ¡ä¸‰ç‰¹æ€§</h2><ol><li><p>å•ç‹¬çš„éš”ç¦»æ“ä½œ </p><ul><li>äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚</li></ul></li><li><p>æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ </p><ul><li>é˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ²¡æœ‰æäº¤ä¹‹å‰éƒ½ä¸ä¼šå®é™…è¢«æ‰§è¡Œï¼Œå› ä¸ºäº‹åŠ¡æäº¤å‰ä»»ä½•æŒ‡ä»¤éƒ½ä¸ä¼šè¢«å®é™…æ‰§è¡Œï¼Œå› ä¸ºRedisçš„äº‹åŠ¡æ˜¯å•æœºçš„ï¼Œæ²¡æœ‰å¹¶å‘è¯»å†™çš„é—®é¢˜</li></ul></li><li><p>ä¸ä¿è¯åŸå­æ€§ </p><ul><li>äº‹åŠ¡ä¸­å¦‚æœæœ‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶åçš„å‘½ä»¤ä»ç„¶ä¼šè¢«æ‰§è¡Œï¼Œæ²¡æœ‰å›æ»š</li></ul></li></ol><h1 id="æŒä¹…åŒ–ç¯‡"><a href="#æŒä¹…åŒ–ç¯‡" class="headerlink" title="æŒä¹…åŒ–ç¯‡"></a>æŒä¹…åŒ–ç¯‡</h1><h2 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h2><h3 id="AOFæ—¥å¿—"><a href="#AOFæ—¥å¿—" class="headerlink" title="AOFæ—¥å¿—"></a>AOFæ—¥å¿—</h3><p>Redis æ¯æ‰§è¡Œä¸€æ¡å†™æ“ä½œå‘½ä»¤ï¼Œå°±<strong>æŠŠè¯¥å‘½ä»¤ä»¥è¿½åŠ çš„æ–¹å¼å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œ</strong>ï¼Œç„¶åé‡å¯ Redis çš„æ—¶å€™ï¼Œå…ˆå»è¯»å–è¿™ä¸ªæ–‡ä»¶é‡Œçš„å‘½ä»¤ï¼Œå¹¶ä¸”æ‰§è¡Œå®ƒï¼Œè¿™å°±ç›¸å½“äºæ¢å¤äº†ç¼“å­˜æ•°æ®ã€‚</p><blockquote><p>æ³¨æ„åªä¼šè®°å½•å†™æ“ä½œå‘½ä»¤ï¼Œè¯»æ“ä½œå‘½ä»¤æ˜¯ä¸ä¼šè¢«è®°å½•çš„ï¼Œå› ä¸ºæ²¡æ„ä¹‰</p></blockquote><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231030203646649.png" alt="image-20231030203646649"></p><p>Redis æ˜¯<mark>å…ˆæ‰§è¡Œå†™æ“ä½œå‘½ä»¤åï¼Œæ‰å°†è¯¥å‘½ä»¤è®°å½•åˆ° AOF æ—¥å¿—</mark>é‡Œçš„ï¼Œè¿™ä¹ˆåšå…¶å®æœ‰ä¸¤ä¸ªå¥½å¤„ã€‚</p><ol><li>é¿å…é¢å¤–çš„æ£€æŸ¥å¼€é”€</li></ol><p>å› ä¸ºå¦‚æœå…ˆå°†å†™æ“ä½œå‘½ä»¤è®°å½•åˆ° AOF æ—¥å¿—é‡Œï¼Œå†æ‰§è¡Œè¯¥å‘½ä»¤çš„è¯ï¼Œå¦‚æœå½“å‰çš„å‘½ä»¤è¯­æ³•æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆå¦‚æœä¸è¿›è¡Œå‘½ä»¤è¯­æ³•æ£€æŸ¥ï¼Œè¯¥é”™è¯¯çš„å‘½ä»¤è®°å½•åˆ° AOF æ—¥å¿—é‡Œåï¼ŒRedis åœ¨ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®æ—¶ï¼Œå°±å¯èƒ½ä¼šå‡ºé”™ã€‚</p><p>è€Œå¦‚æœå…ˆæ‰§è¡Œå†™æ“ä½œå‘½ä»¤å†è®°å½•æ—¥å¿—çš„è¯ï¼Œåªæœ‰åœ¨è¯¥å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œæ‰å°†å‘½ä»¤è®°å½•åˆ° AOF æ—¥å¿—é‡Œï¼Œè¿™æ ·å°±ä¸ç”¨é¢å¤–çš„æ£€æŸ¥å¼€é”€ï¼Œä¿è¯è®°å½•åœ¨ AOF æ—¥å¿—é‡Œçš„å‘½ä»¤éƒ½æ˜¯å¯æ‰§è¡Œå¹¶ä¸”æ­£ç¡®çš„ã€‚</p><ol start="2"><li>ä¸ä¼šé˜»å¡å½“å‰å†™æ“ä½œå‘½ä»¤çš„æ‰§è¡Œ</li></ol><p>å› ä¸ºå½“å†™æ“ä½œå‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œæ‰ä¼šå°†å‘½ä»¤è®°å½•åˆ° AOF æ—¥å¿—ã€‚</p><p>AOFçš„ä¸¤ç§æ½œåœ¨é£é™©</p><ol><li><p>æ‰§è¡Œå†™æ“ä½œå‘½ä»¤å’Œè®°å½•æ—¥å¿—æ˜¯ä¸¤ä¸ªè¿‡ç¨‹ï¼Œé‚£å½“ Redis åœ¨è¿˜æ²¡æ¥å¾—åŠå°†å‘½ä»¤å†™å…¥åˆ°ç¡¬ç›˜æ—¶ï¼ŒæœåŠ¡å™¨å‘ç”Ÿå®•æœºäº†ï¼Œè¿™ä¸ªæ•°æ®å°±ä¼šæœ‰<mark>ä¸¢å¤±çš„é£é™©</mark>ã€‚</p></li><li><p>ç”±äºå†™æ“ä½œå‘½ä»¤æ‰§è¡ŒæˆåŠŸåæ‰è®°å½•åˆ° AOF æ—¥å¿—ï¼Œæ‰€ä»¥ä¸ä¼šé˜»å¡å½“å‰å†™æ“ä½œå‘½ä»¤çš„æ‰§è¡Œï¼Œä½†æ˜¯<mark>å¯èƒ½ä¼šç»™ã€Œä¸‹ä¸€ä¸ªã€å‘½ä»¤å¸¦æ¥é˜»å¡é£é™©</mark>ã€‚</p></li></ol><p>å› ä¸ºå°†å‘½ä»¤å†™å…¥åˆ°æ—¥å¿—çš„è¿™ä¸ªæ“ä½œä¹Ÿæ˜¯åœ¨ä¸»è¿›ç¨‹å®Œæˆçš„ï¼ˆæ‰§è¡Œå‘½ä»¤ä¹Ÿæ˜¯åœ¨ä¸»è¿›ç¨‹ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸¤ä¸ªæ“ä½œæ˜¯åŒæ­¥çš„ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231030205624444.png" alt="image-20231030205624444"></p><p>è®¤çœŸåˆ†æä¸€ä¸‹ï¼Œå…¶å®è¿™ä¸¤ä¸ªé£é™©éƒ½æœ‰ä¸€ä¸ªå…±æ€§ï¼Œéƒ½è·Ÿã€Œ AOF æ—¥å¿—å†™å›ç¡¬ç›˜çš„æ—¶æœºã€æœ‰å…³ã€‚</p><h3 id="ä¸‰ç§å†™å›ç­–ç•¥"><a href="#ä¸‰ç§å†™å›ç­–ç•¥" class="headerlink" title="ä¸‰ç§å†™å›ç­–ç•¥"></a>ä¸‰ç§å†™å›ç­–ç•¥</h3><p>Redis å†™å…¥ AOF æ—¥å¿—çš„è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231030211449584.png" alt="image-20231030211449584"></p><p>å…·ä½“æµç¨‹ï¼š</p><ol><li>Redis æ‰§è¡Œå®Œå†™æ“ä½œå‘½ä»¤åï¼Œä¼šå°†å‘½ä»¤è¿½åŠ åˆ° <code>server.aof_buf</code> ç¼“å†²åŒºï¼›</li><li>ç„¶åé€šè¿‡ write() ç³»ç»Ÿè°ƒç”¨ï¼Œå°† aof_buf ç¼“å†²åŒºçš„æ•°æ®å†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œæ­¤æ—¶æ•°æ®å¹¶æ²¡æœ‰å†™å…¥åˆ°ç¡¬ç›˜ï¼Œè€Œæ˜¯æ‹·è´åˆ°äº†å†…æ ¸ç¼“å†²åŒº page cacheï¼Œç­‰å¾…å†…æ ¸å°†æ•°æ®å†™å…¥ç¡¬ç›˜ï¼›</li><li>å…·ä½“å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®ä»€ä¹ˆæ—¶å€™å†™å…¥åˆ°ç¡¬ç›˜ï¼Œç”±å†…æ ¸å†³å®šã€‚</li></ol><p>Redis æä¾›äº† 3 ç§å†™å›ç¡¬ç›˜çš„ç­–ç•¥ï¼Œæ§åˆ¶çš„å°±æ˜¯ä¸Šé¢è¯´çš„ç¬¬ä¸‰æ­¥çš„è¿‡ç¨‹ã€‚</p><ul><li><strong>Always</strong>ï¼Œè¿™ä¸ªå•è¯çš„æ„æ€æ˜¯ã€Œæ€»æ˜¯ã€ï¼Œæ‰€ä»¥å®ƒçš„æ„æ€æ˜¯æ¯æ¬¡å†™æ“ä½œå‘½ä»¤æ‰§è¡Œå®Œåï¼Œ<mark>åŒæ­¥</mark>å°† AOF æ—¥å¿—æ•°æ®å†™å›ç¡¬ç›˜ï¼›</li><li><strong>Everysec</strong>ï¼Œè¿™ä¸ªå•è¯çš„æ„æ€æ˜¯ã€Œæ¯ç§’ã€ï¼Œæ‰€ä»¥å®ƒçš„æ„æ€æ˜¯æ¯æ¬¡å†™æ“ä½œå‘½ä»¤æ‰§è¡Œå®Œåï¼Œå…ˆå°†å‘½ä»¤å†™å…¥åˆ° AOF æ–‡ä»¶çš„å†…æ ¸ç¼“å†²åŒºï¼Œç„¶å<mark>æ¯éš”ä¸€ç§’å°†ç¼“å†²åŒºé‡Œçš„å†…å®¹å†™å›åˆ°ç¡¬ç›˜</mark>ï¼›</li><li><strong>No</strong>ï¼Œæ„å‘³ç€ä¸ç”± Redis æ§åˆ¶å†™å›ç¡¬ç›˜çš„æ—¶æœºï¼Œè½¬äº¤ç»™æ“ä½œç³»ç»Ÿæ§åˆ¶å†™å›çš„æ—¶æœºï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡å†™æ“ä½œå‘½ä»¤æ‰§è¡Œå®Œåï¼Œå…ˆå°†å‘½ä»¤å†™å…¥åˆ° AOF æ–‡ä»¶çš„å†…æ ¸ç¼“å†²åŒºï¼Œå†ç”±<mark>æ“ä½œç³»ç»Ÿå†³å®š</mark>ä½•æ—¶å°†ç¼“å†²åŒºå†…å®¹å†™å›ç¡¬ç›˜ã€‚</li></ul><p>è¿™ 3 ç§å†™å›ç­–ç•¥éƒ½æ— æ³•èƒ½å®Œç¾è§£å†³ã€Œä¸»è¿›ç¨‹é˜»å¡ã€å’Œã€Œå‡å°‘æ•°æ®ä¸¢å¤±ã€çš„é—®é¢˜ï¼Œå› ä¸ºä¸¤ä¸ªé—®é¢˜æ˜¯<mark>å¯¹ç«‹</mark>çš„ï¼Œåå‘äºä¸€è¾¹çš„è¯ï¼Œå°±ä¼šè¦ç‰ºç‰²å¦å¤–ä¸€è¾¹ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p><ul><li>Always ç­–ç•¥çš„è¯ï¼Œå¯ä»¥æœ€å¤§ç¨‹åº¦ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œä½†æ˜¯ç”±äºå®ƒæ¯æ‰§è¡Œä¸€æ¡å†™æ“ä½œå‘½ä»¤å°±åŒæ­¥å°† AOF å†…å®¹å†™å›ç¡¬ç›˜ï¼Œæ‰€ä»¥æ˜¯ä¸å¯é¿å…ä¼šå½±å“ä¸»è¿›ç¨‹çš„æ€§èƒ½ï¼›</li><li>No ç­–ç•¥çš„è¯ï¼Œæ˜¯äº¤ç”±æ“ä½œç³»ç»Ÿæ¥å†³å®šä½•æ—¶å°† AOF æ—¥å¿—å†…å®¹å†™å›ç¡¬ç›˜ï¼Œç›¸æ¯”äº Always ç­–ç•¥æ€§èƒ½è¾ƒå¥½ï¼Œä½†æ˜¯æ“ä½œç³»ç»Ÿå†™å›ç¡¬ç›˜çš„æ—¶æœºæ˜¯ä¸å¯é¢„çŸ¥çš„ï¼Œå¦‚æœ AOF æ—¥å¿—å†…å®¹æ²¡æœ‰å†™å›ç¡¬ç›˜ï¼Œä¸€æ—¦æœåŠ¡å™¨å®•æœºï¼Œå°±ä¼šä¸¢å¤±ä¸å®šæ•°é‡çš„æ•°æ®ã€‚</li><li>Everysec ç­–ç•¥çš„è¯ï¼Œæ˜¯æŠ˜ä¸­çš„ä¸€ç§æ–¹å¼ï¼Œé¿å…äº† Always ç­–ç•¥çš„æ€§èƒ½å¼€é”€ï¼Œä¹Ÿæ¯” No ç­–ç•¥æ›´èƒ½é¿å…æ•°æ®ä¸¢å¤±ï¼Œå½“ç„¶å¦‚æœä¸Šä¸€ç§’çš„å†™æ“ä½œå‘½ä»¤æ—¥å¿—æ²¡æœ‰å†™å›åˆ°ç¡¬ç›˜ï¼Œå‘ç”Ÿäº†å®•æœºï¼Œè¿™ä¸€ç§’å†…çš„æ•°æ®è‡ªç„¶ä¹Ÿä¼šä¸¢å¤±ã€‚</li></ul><p>å¤§å®¶æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡åœºæ™¯è¿›è¡Œé€‰æ‹©ï¼š</p><ul><li>å¦‚æœè¦é«˜æ€§èƒ½ï¼Œå°±é€‰æ‹© No ç­–ç•¥ï¼›</li><li>å¦‚æœè¦é«˜å¯é ï¼Œå°±é€‰æ‹© Always ç­–ç•¥ï¼›</li><li>å¦‚æœå…è®¸æ•°æ®ä¸¢å¤±ä¸€ç‚¹ï¼Œä½†åˆæƒ³æ€§èƒ½é«˜ï¼Œå°±é€‰æ‹© Everysec ç­–ç•¥ã€‚</li></ul><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231030211756839.png" alt="image-20231030211756839"></p><p>æ·±å…¥åˆ°æºç åï¼Œå°±ä¼šå‘ç°è¿™ä¸‰ç§ç­–ç•¥åªæ˜¯åœ¨æ§åˆ¶ <code>fsync()</code> å‡½æ•°çš„è°ƒç”¨æ—¶æœºã€‚</p><p>å½“åº”ç”¨ç¨‹åºå‘æ–‡ä»¶å†™å…¥æ•°æ®æ—¶ï¼Œå†…æ ¸é€šå¸¸å…ˆå°†æ•°æ®å¤åˆ¶åˆ°å†…æ ¸ç¼“å†²åŒºä¸­ï¼Œç„¶åæ’å…¥é˜Ÿåˆ—ï¼Œç„¶åç”±å†…æ ¸å†³å®šä½•æ—¶å†™å…¥ç¡¬ç›˜ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231030211900137.png" alt="image-20231030211900137"></p><p>å¦‚æœæƒ³è¦åº”ç”¨ç¨‹åºå‘æ–‡ä»¶å†™å…¥æ•°æ®åï¼Œèƒ½ç«‹é©¬å°†æ•°æ®åŒæ­¥åˆ°ç¡¬ç›˜ï¼Œå°±å¯ä»¥è°ƒç”¨ <code>fsync()</code> å‡½æ•°ï¼Œè¿™æ ·å†…æ ¸å°±ä¼šå°†å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®ç›´æ¥å†™å…¥åˆ°ç¡¬ç›˜ï¼Œç­‰åˆ°ç¡¬ç›˜å†™æ“ä½œå®Œæˆåï¼Œè¯¥å‡½æ•°æ‰ä¼šè¿”å›ã€‚</p><ul><li>Always ç­–ç•¥å°±æ˜¯æ¯æ¬¡å†™å…¥ AOF æ–‡ä»¶æ•°æ®åï¼Œå°±æ‰§è¡Œ fsync() å‡½æ•°ï¼›</li><li>Everysec ç­–ç•¥å°±ä¼šåˆ›å»ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡æ¥æ‰§è¡Œ fsync() å‡½æ•°ï¼›</li><li>No ç­–ç•¥å°±æ˜¯æ°¸ä¸æ‰§è¡Œ fsync() å‡½æ•°ï¼›</li></ul><h3 id="AOFé‡å†™æœºåˆ¶"><a href="#AOFé‡å†™æœºåˆ¶" class="headerlink" title="AOFé‡å†™æœºåˆ¶"></a>AOFé‡å†™æœºåˆ¶</h3><p>å½“ AOF æ–‡ä»¶çš„å¤§å°è¶…è¿‡æ‰€è®¾å®šçš„é˜ˆå€¼åï¼ŒRedis å°±ä¼šå¯ç”¨ AOF é‡å†™æœºåˆ¶ï¼Œæ¥å‹ç¼© AOF æ–‡ä»¶ã€‚</p><p>AOF é‡å†™æœºåˆ¶æ˜¯åœ¨é‡å†™æ—¶ï¼Œè¯»å–å½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹ï¼Œç„¶åå°†æ¯ä¸€ä¸ªé”®å€¼å¯¹ç”¨ä¸€æ¡å‘½ä»¤è®°å½•åˆ°ã€Œæ–°çš„ AOF æ–‡ä»¶ã€ï¼Œç­‰åˆ°å…¨éƒ¨è®°å½•å®Œåï¼Œå°±å°†æ–°çš„ AOF æ–‡ä»¶æ›¿æ¢æ‰ç°æœ‰çš„ AOF æ–‡ä»¶ã€‚</p><p>é‡å†™æœºåˆ¶çš„<mark>å¦™å¤„</mark>åœ¨äºï¼Œå°½ç®¡æŸä¸ªé”®å€¼å¯¹è¢«å¤šæ¡å†™å‘½ä»¤åå¤ä¿®æ”¹ï¼Œ<strong>æœ€ç»ˆä¹Ÿåªéœ€è¦æ ¹æ®è¿™ä¸ªã€Œé”®å€¼å¯¹ã€å½“å‰çš„æœ€æ–°çŠ¶æ€ï¼Œç„¶åç”¨ä¸€æ¡å‘½ä»¤å»è®°å½•é”®å€¼å¯¹</strong>ï¼Œä»£æ›¿ä¹‹å‰è®°å½•è¿™ä¸ªé”®å€¼å¯¹çš„å¤šæ¡å‘½ä»¤ï¼Œè¿™æ ·å°±å‡å°‘äº† AOF æ–‡ä»¶ä¸­çš„å‘½ä»¤æ•°é‡ã€‚æœ€ååœ¨é‡å†™å·¥ä½œå®Œæˆåï¼Œå°†æ–°çš„ AOF æ–‡ä»¶è¦†ç›–ç°æœ‰çš„ AOF æ–‡ä»¶ã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆé‡å†™ AOF çš„æ—¶å€™ï¼Œä¸ç›´æ¥å¤ç”¨ç°æœ‰çš„ AOF æ–‡ä»¶ï¼Ÿ</p></blockquote><p>å› ä¸º<strong>å¦‚æœ AOF é‡å†™è¿‡ç¨‹ä¸­å¤±è´¥äº†ï¼Œç°æœ‰çš„ AOF æ–‡ä»¶å°±ä¼šé€ æˆæ±¡æŸ“</strong>ï¼Œå¯èƒ½æ— æ³•ç”¨äºæ¢å¤ä½¿ç”¨ã€‚</p><p>æ‰€ä»¥ AOF é‡å†™è¿‡ç¨‹ï¼Œå…ˆé‡å†™åˆ°æ–°çš„ AOF æ–‡ä»¶ï¼Œé‡å†™å¤±è´¥çš„è¯ï¼Œå°±ç›´æ¥åˆ é™¤è¿™ä¸ªæ–‡ä»¶å°±å¥½ï¼Œä¸ä¼šå¯¹ç°æœ‰çš„ AOF æ–‡ä»¶é€ æˆå½±å“ã€‚</p><h3 id="â­â­â­AOFåå°é‡å†™"><a href="#â­â­â­AOFåå°é‡å†™" class="headerlink" title="â­â­â­AOFåå°é‡å†™"></a>â­â­â­AOFåå°é‡å†™</h3><p>AOFé‡å†™è¿‡ç¨‹å…¶å®æ˜¯å¾ˆè€—æ—¶çš„ï¼Œæ‰€ä»¥é‡å†™çš„æ“ä½œä¸èƒ½æ”¾åœ¨ä¸»è¿›ç¨‹é‡Œã€‚</p><p>æ‰€ä»¥ï¼ŒRedis çš„<strong>é‡å†™ AOF è¿‡ç¨‹æ˜¯ç”±åå°å­è¿›ç¨‹ bgrewriteaofæ¥å®Œæˆçš„</strong>ï¼Œè¿™ä¹ˆåšå¯ä»¥è¾¾åˆ°ä¸¤ä¸ªå¥½å¤„ï¼š</p><ul><li>å­è¿›ç¨‹è¿›è¡Œ AOF é‡å†™æœŸé—´ï¼Œä¸»è¿›ç¨‹å¯ä»¥ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ï¼Œä»è€Œé¿å…é˜»å¡ä¸»è¿›ç¨‹ï¼›</li><li>å­è¿›ç¨‹å¸¦æœ‰ä¸»è¿›ç¨‹çš„æ•°æ®å‰¯æœ¬ï¼Œè¿™é‡Œä½¿ç”¨å­è¿›ç¨‹è€Œä¸æ˜¯çº¿ç¨‹ï¼Œå› ä¸ºå¦‚æœæ˜¯ä½¿ç”¨çº¿ç¨‹ï¼Œå¤šçº¿ç¨‹ä¹‹é—´ä¼šå…±äº«å†…å­˜ï¼Œé‚£ä¹ˆåœ¨ä¿®æ”¹å…±äº«å†…å­˜æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡åŠ é”æ¥ä¿è¯æ•°æ®çš„å®‰å…¨ï¼Œè€Œè¿™æ ·å°±ä¼šé™ä½æ€§èƒ½ã€‚è€Œä½¿ç”¨å­è¿›ç¨‹ï¼Œåˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œçˆ¶å­è¿›ç¨‹æ˜¯å…±äº«å†…å­˜æ•°æ®çš„ï¼Œä¸è¿‡è¿™ä¸ªå…±äº«çš„å†…å­˜åªèƒ½ä»¥åªè¯»çš„æ–¹å¼ï¼Œè€Œå½“çˆ¶å­è¿›ç¨‹ä»»æ„ä¸€æ–¹ä¿®æ”¹äº†è¯¥å…±äº«å†…å­˜ï¼Œå°±ä¼šå‘ç”Ÿã€Œå†™æ—¶å¤åˆ¶ã€ï¼Œäºæ˜¯çˆ¶å­è¿›ç¨‹å°±æœ‰äº†ç‹¬ç«‹çš„æ•°æ®å‰¯æœ¬ï¼Œå°±ä¸ç”¨åŠ é”æ¥ä¿è¯æ•°æ®å®‰å…¨ã€‚</li></ul><p>å­è¿›ç¨‹æ˜¯æ€ä¹ˆæ‹¥æœ‰ä¸»è¿›ç¨‹ä¸€æ ·çš„æ•°æ®å‰¯æœ¬çš„å‘¢ï¼Ÿ</p><p>Redisä¸»è¿›ç¨‹åœ¨é€šè¿‡ <code>fork</code> ç³»ç»Ÿè°ƒç”¨ç”Ÿæˆ bgrewriteaof å­è¿›ç¨‹æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠä¸»è¿›ç¨‹çš„ã€Œ<strong>é¡µè¡¨</strong>ã€å¤åˆ¶ä¸€ä»½ç»™å­è¿›ç¨‹ï¼Œè¿™ä¸ª<strong>é¡µè¡¨è®°å½•ç€<mark>è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€æ˜ å°„å…³ç³»</mark>ï¼Œè€Œä¸ä¼šå¤åˆ¶ç‰©ç†å†…å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸¤è€…çš„è™šæ‹Ÿç©ºé—´ä¸åŒï¼Œä½†å…¶å¯¹åº”çš„ç‰©ç†ç©ºé—´æ˜¯åŒä¸€ä¸ª</strong>ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/5a1f2a90b5f3821c19bea3b7a5f27fa1.png" alt="img"></p><p>è¿™æ ·ä¸€æ¥ï¼Œå­è¿›ç¨‹å°±å…±äº«äº†çˆ¶è¿›ç¨‹çš„ç‰©ç†å†…å­˜æ•°æ®äº†ï¼Œè¿™æ ·èƒ½å¤Ÿ<strong>èŠ‚çº¦ç‰©ç†å†…å­˜èµ„æº</strong>ï¼Œé¡µè¡¨å¯¹åº”çš„é¡µè¡¨é¡¹çš„å±æ€§ä¼šæ ‡è®°è¯¥ç‰©ç†å†…å­˜çš„æƒé™ä¸º<strong>åªè¯»</strong>ã€‚</p><p>ä¸è¿‡ï¼Œå½“çˆ¶è¿›ç¨‹æˆ–è€…å­è¿›ç¨‹åœ¨å‘è¿™ä¸ªå†…å­˜å‘èµ·å†™æ“ä½œæ—¶ï¼ŒCPU å°±ä¼šè§¦å‘<strong>å†™ä¿æŠ¤ä¸­æ–­</strong>ï¼Œè¿™ä¸ªå†™ä¿æŠ¤ä¸­æ–­æ˜¯ç”±äºè¿åæƒé™å¯¼è‡´çš„ï¼Œç„¶åæ“ä½œç³»ç»Ÿä¼šåœ¨ã€Œå†™ä¿æŠ¤ä¸­æ–­å¤„ç†å‡½æ•°ã€é‡Œè¿›è¡Œ<strong>ç‰©ç†å†…å­˜çš„å¤åˆ¶</strong>ï¼Œå¹¶é‡æ–°è®¾ç½®å…¶å†…å­˜æ˜ å°„å…³ç³»ï¼Œå°†çˆ¶å­è¿›ç¨‹çš„å†…å­˜è¯»å†™æƒé™è®¾ç½®ä¸º<strong>å¯è¯»å†™</strong>ï¼Œæœ€åæ‰ä¼šå¯¹å†…å­˜è¿›è¡Œå†™æ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºã€Œ**å†™æ—¶å¤åˆ¶(Copy On Write)**ã€ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/d4cfac545377b54dd035c775603b4936.png" alt="img"></p><p>å†™æ—¶å¤åˆ¶é¡¾åæ€ä¹‰ï¼Œ<strong>åœ¨å‘ç”Ÿå†™æ“ä½œçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿæ‰ä¼šå»å¤åˆ¶ç‰©ç†å†…å­˜</strong>ï¼Œè¿™æ ·æ˜¯ä¸ºäº†é˜²æ­¢ fork åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œç”±äºç‰©ç†å†…å­˜æ•°æ®çš„å¤åˆ¶æ—¶é—´è¿‡é•¿è€Œå¯¼è‡´çˆ¶è¿›ç¨‹é•¿æ—¶é—´é˜»å¡çš„é—®é¢˜ã€‚</p><p>AOFåå°é‡å†™é˜»å¡æƒ…å†µï¼š</p><ol><li>å†™æ—¶å¤åˆ¶</li><li>ä¿¡å·å¤„ç†å‡½æ•°</li><li>å¤åˆ¶çˆ¶è¿›ç¨‹çš„é¡µè¡¨ï¼šåˆ›å»ºå­è¿›ç¨‹çš„é€”ä¸­ï¼Œç”±äºè¦å¤åˆ¶çˆ¶è¿›ç¨‹çš„é¡µè¡¨ç­‰æ•°æ®ç»“æ„ï¼Œé˜»å¡çš„æ—¶é—´è·Ÿé¡µè¡¨çš„å¤§å°æœ‰å…³ï¼Œé¡µè¡¨è¶Šå¤§ï¼Œé˜»å¡çš„æ—¶é—´ä¹Ÿè¶Šé•¿ï¼Œ<strong>ä¸è¿‡é¡µè¡¨çš„å¤§å°ç›¸æ¯”å®é™…çš„ç‰©ç†å†…å­˜å°å¾ˆå¤šï¼Œæ‰€ä»¥é€šå¸¸å¤åˆ¶é¡µè¡¨çš„è¿‡ç¨‹æ˜¯æ¯”è¾ƒå¿«çš„ã€‚</strong></li></ol><p>ğŸ”´ğŸŸ¡ğŸŸ¢<strong>é‡å†™æœŸé—´ï¼Œå¦‚æœä¸»è¿›ç¨‹ä¿®æ”¹äº†æ•°æ®</strong>ï¼š</p><p>å½“åœ¨ Redis ä¸­å¯ç”¨äº†å†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼Œç‰¹åˆ«æ˜¯åœ¨ AOFï¼ˆAppend Only Fileï¼‰é‡å†™æœŸé—´ï¼Œå¦‚æœä¸»è¿›ç¨‹ä¿®æ”¹äº†æ•°æ®ï¼Œæ•´ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p><strong>ä¸»è¿›ç¨‹æ‰§è¡Œå†™æ“ä½œ</strong>ï¼š</p><ul><li>ä¸»è¿›ç¨‹æ”¶åˆ°å®¢æˆ·ç«¯çš„å†™å‘½ä»¤è¯·æ±‚ã€‚</li><li>ä¸»è¿›ç¨‹æ‰§è¡Œå‘½ä»¤å¹¶å°†å‘½ä»¤è¿½åŠ åˆ° AOF ç¼“å†²åŒºå’Œ AOF é‡å†™ç¼“å†²åŒºã€‚</li></ul></li><li><p><strong>æ‰§è¡Œ AOF åå°é‡å†™</strong>ï¼š</p><ul><li>åœ¨é‡å†™ AOF æœŸé—´ï¼Œåå°å­è¿›ç¨‹ï¼ˆbgrewriteaofï¼‰è´Ÿè´£æ‰«ææ•°æ®åº“å¹¶å°†æ•°æ®åº“ä¸­çš„é”®å€¼å¯¹è½¬æ¢ä¸ºä¸€æ¡å‘½ä»¤ï¼Œç„¶åå°†å‘½ä»¤è®°å½•åˆ°æ–°çš„ AOF æ–‡ä»¶ä¸­ã€‚</li></ul></li><li><p><strong>ä¸»è¿›ç¨‹ä¿®æ”¹å·²å­˜åœ¨çš„æ•°æ®</strong>ï¼š</p><ul><li>å¦‚æœä¸»è¿›ç¨‹åœ¨ AOF é‡å†™æœŸé—´ä¿®æ”¹äº†å·²å­˜åœ¨çš„æ•°æ®ï¼Œæ ¹æ®å†™æ—¶å¤åˆ¶æœºåˆ¶ï¼Œ<mark>åªä¼šå¤åˆ¶å‘ç”Ÿäº†ä¿®æ”¹çš„ç‰©ç†å†…å­˜æ•°æ®ï¼Œæœªä¿®æ”¹çš„éƒ¨åˆ†ä»ç„¶ä¸å­è¿›ç¨‹å…±äº«</mark>ã€‚</li><li>ä¿®æ”¹çš„æ•°æ®åœ¨ä¸»è¿›ç¨‹çš„ç‰©ç†å†…å­˜ä¸­ï¼Œä½†åœ¨å­è¿›ç¨‹çš„å†…å­˜æ•°æ®ä¸­æ˜¯ä¸ä¸€è‡´çš„ã€‚</li></ul></li><li><p><strong>AOF é‡å†™å­è¿›ç¨‹ä¸ä¸»è¿›ç¨‹æ•°æ®ä¸ä¸€è‡´é—®é¢˜</strong>ï¼š</p><ul><li>ä¸ºäº†è§£å†³æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼ŒRedis <mark>è®¾ç½®äº† AOF é‡å†™ç¼“å†²åŒº</mark>ï¼Œåœ¨åˆ›å»º bgrewriteaof å­è¿›ç¨‹ä¹‹åå¼€å§‹ä½¿ç”¨ã€‚</li><li>ä¸»è¿›ç¨‹æ‰§è¡Œçš„å†™å‘½ä»¤ä¼šè¢«åŒæ—¶è¿½åŠ åˆ° AOF ç¼“å†²åŒºå’Œ AOF é‡å†™ç¼“å†²åŒºã€‚</li></ul></li><li><p><strong>å­è¿›ç¨‹å®Œæˆ AOF é‡å†™</strong>ï¼š</p><ul><li>å­è¿›ç¨‹å®Œæˆ AOF é‡å†™åï¼Œå‘ä¸»è¿›ç¨‹å‘é€ä¿¡å·ã€‚</li><li>ä¸»è¿›ç¨‹æ¥æ”¶ä¿¡å·åï¼Œè°ƒç”¨ä¿¡å·å¤„ç†å‡½æ•°ï¼Œ<mark>å°† AOF é‡å†™ç¼“å†²åŒºçš„å†…å®¹è¿½åŠ åˆ°æ–° AOF æ–‡ä»¶ä¸­</mark>ï¼Œä½¿å¾—æ–°æ—§ AOF æ–‡ä»¶ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€ä¸€è‡´ã€‚</li></ul></li></ol><p>åœ¨è¿™æ•´ä¸ªæµç¨‹ä¸­ï¼Œå†™æ—¶å¤åˆ¶æŠ€æœ¯ç¡®ä¿äº†åªæœ‰åœ¨ä¸»è¿›ç¨‹å‘ç”Ÿä¿®æ”¹æ—¶æ‰ä¼šå¯¹ç‰©ç†å†…å­˜æ•°æ®è¿›è¡Œå¤åˆ¶ï¼Œå‡å°‘ä¸å¿…è¦çš„å¤åˆ¶ï¼ŒåŒæ—¶ AOF é‡å†™ç¼“å†²åŒºå¸®åŠ©è§£å†³äº†ä¸»è¿›ç¨‹ä¸å­è¿›ç¨‹æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œä¿éšœäº† AOF æ–‡ä»¶çš„ä¸€è‡´æ€§ã€‚</p><h2 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h2><p>RDB å¿«ç…§å°±æ˜¯è®°å½•æŸä¸€ä¸ªç¬é—´çš„å†…å­˜æ•°æ®ï¼Œè®°å½•çš„æ˜¯å®é™…æ•°æ®ï¼Œè€Œ AOF æ–‡ä»¶è®°å½•çš„æ˜¯å‘½ä»¤æ“ä½œçš„æ—¥å¿—ï¼Œè€Œä¸æ˜¯å®é™…çš„æ•°æ®ã€‚</p><p>å› æ­¤åœ¨ Redis æ¢å¤æ•°æ®æ—¶ï¼Œ RDB æ¢å¤æ•°æ®çš„æ•ˆç‡ä¼šæ¯” AOF é«˜äº›ï¼Œå› ä¸ºç›´æ¥å°† RDB æ–‡ä»¶è¯»å…¥å†…å­˜å°±å¯ä»¥ï¼Œä¸éœ€è¦åƒ AOF é‚£æ ·è¿˜éœ€è¦é¢å¤–æ‰§è¡Œæ“ä½œå‘½ä»¤çš„æ­¥éª¤æ‰èƒ½æ¢å¤æ•°æ®ã€‚</p><h3 id="å¿«ç…§æ€ä¹ˆç”¨ï¼Ÿ"><a href="#å¿«ç…§æ€ä¹ˆç”¨ï¼Ÿ" class="headerlink" title="å¿«ç…§æ€ä¹ˆç”¨ï¼Ÿ"></a>å¿«ç…§æ€ä¹ˆç”¨ï¼Ÿ</h3><p>Redis æä¾›äº†ä¸¤ä¸ªå‘½ä»¤æ¥ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ <code>save</code> å’Œ <code>bgsave</code>ï¼Œä»–ä»¬çš„åŒºåˆ«å°±åœ¨äºæ˜¯å¦åœ¨ã€Œä¸»çº¿ç¨‹ã€é‡Œæ‰§è¡Œï¼š</p><ul><li>æ‰§è¡Œäº† save å‘½ä»¤ï¼Œå°±ä¼šåœ¨ä¸»çº¿ç¨‹ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œç”±äºå’Œæ‰§è¡Œæ“ä½œå‘½ä»¤åœ¨åŒä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥å¦‚æœå†™å…¥ RDB æ–‡ä»¶çš„æ—¶é—´å¤ªé•¿ï¼Œ<strong>ä¼šé˜»å¡ä¸»çº¿ç¨‹</strong>ï¼›</li><li>æ‰§è¡Œäº† bgsave å‘½ä»¤ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹æ¥ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œè¿™æ ·å¯ä»¥<strong>é¿å…ä¸»çº¿ç¨‹çš„é˜»å¡</strong>ï¼›</li></ul><p>Redis çš„å¿«ç…§æ˜¯<strong>å…¨é‡å¿«ç…§</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡æ‰§è¡Œå¿«ç…§ï¼Œéƒ½æ˜¯æŠŠå†…å­˜ä¸­çš„ã€Œæ‰€æœ‰æ•°æ®ã€éƒ½è®°å½•åˆ°ç£ç›˜ä¸­ã€‚</p><p>æ‰€ä»¥å¯ä»¥è®¤ä¸ºï¼Œæ‰§è¡Œå¿«ç…§æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡çš„æ“ä½œï¼Œå¦‚æœé¢‘ç‡å¤ªé¢‘ç¹ï¼Œå¯èƒ½ä¼šå¯¹ Redis æ€§èƒ½äº§ç”Ÿå½±å“ã€‚å¦‚æœé¢‘ç‡å¤ªä½ï¼ŒæœåŠ¡å™¨æ•…éšœæ—¶ï¼Œä¸¢å¤±çš„æ•°æ®ä¼šæ›´å¤šã€‚</p><p>é€šå¸¸å¯èƒ½è®¾ç½®è‡³å°‘ 5 åˆ†é’Ÿæ‰ä¿å­˜ä¸€æ¬¡å¿«ç…§ï¼Œè¿™æ—¶å¦‚æœ Redis å‡ºç°å®•æœºç­‰æƒ…å†µï¼Œåˆ™æ„å‘³ç€æœ€å¤šå¯èƒ½ä¸¢å¤± 5 åˆ†é’Ÿæ•°æ®ã€‚</p><p>è¿™å°±æ˜¯ RDB å¿«ç…§çš„ç¼ºç‚¹ï¼Œåœ¨æœåŠ¡å™¨å‘ç”Ÿæ•…éšœæ—¶ï¼Œä¸¢å¤±çš„æ•°æ®ä¼šæ¯” AOF æŒä¹…åŒ–çš„æ–¹å¼æ›´å¤šï¼Œå› ä¸º RDB å¿«ç…§æ˜¯å…¨é‡å¿«ç…§çš„æ–¹å¼ï¼Œå› æ­¤æ‰§è¡Œçš„é¢‘ç‡ä¸èƒ½å¤ªé¢‘ç¹ï¼Œå¦åˆ™ä¼šå½±å“ Redis æ€§èƒ½ï¼Œè€Œ AOF æ—¥å¿—å¯ä»¥ä»¥ç§’çº§çš„æ–¹å¼è®°å½•æ“ä½œå‘½ä»¤ï¼Œæ‰€ä»¥ä¸¢å¤±çš„æ•°æ®å°±ç›¸å¯¹æ›´å°‘ã€‚</p><h3 id="â­â­â­æ‰§è¡Œå¿«ç…§æ—¶ï¼Œæ•°æ®èƒ½è¢«ä¿®æ”¹å—ï¼Ÿ"><a href="#â­â­â­æ‰§è¡Œå¿«ç…§æ—¶ï¼Œæ•°æ®èƒ½è¢«ä¿®æ”¹å—ï¼Ÿ" class="headerlink" title="â­â­â­æ‰§è¡Œå¿«ç…§æ—¶ï¼Œæ•°æ®èƒ½è¢«ä¿®æ”¹å—ï¼Ÿ"></a>â­â­â­æ‰§è¡Œå¿«ç…§æ—¶ï¼Œæ•°æ®èƒ½è¢«ä¿®æ”¹å—ï¼Ÿ</h3><p>æ‰§è¡Œ bgsave è¿‡ç¨‹ä¸­ï¼ŒRedis ä¾ç„¶<strong>å¯ä»¥ç»§ç»­å¤„ç†æ“ä½œå‘½ä»¤</strong>çš„ï¼Œä¹Ÿå°±æ˜¯æ•°æ®æ˜¯èƒ½è¢«ä¿®æ”¹çš„ã€‚</p><p>æŠ€æœ¯ä¾ç„¶æ˜¯ä½¿ç”¨çš„å†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼Œä½†æ˜¯å¹¶ä¸ä¼šåƒAOFé‚£æ ·è¿˜å»ºç«‹ä¸€ä¸ªé‡å†™ç¼“å†²åŒºï¼Œæœ€åå†é€šè¿‡ä¿¡å·å‡½æ•°é‡æ–°è¿½åŠ å‘½ä»¤åˆ°æ–°çš„AOFæ–‡ä»¶ä¸­ã€‚</p><p>å› ä¸ºé€šè¿‡å†™æ—¶å¤åˆ¶æŠ€æœ¯åï¼Œä¸»è¿›ç¨‹å’Œå­è¿›ç¨‹æ‰€å¯¹åº”çš„é‚£ä¸€å—æ•°æ®çš„å†…å­˜åŒºåŸŸå°±ä¸ä¸€æ ·äº†ï¼Œæ‰€ä»¥å­è¿›ç¨‹æ‰€è®°å½•çš„RDBæ–‡ä»¶ä¸­æ˜¯<mark>ä¸åŒ…å«è®°å½•è¿‡ç¨‹ä¸­æ–°åŠ å…¥æˆ–ä¿®æ”¹çš„æ–°æ•°æ®çš„</mark>ã€‚</p><h3 id="RDB-å’Œ-AOF-åˆä½“"><a href="#RDB-å’Œ-AOF-åˆä½“" class="headerlink" title="RDB å’Œ AOF åˆä½“"></a>RDB å’Œ AOF åˆä½“</h3><p>å°½ç®¡ RDB æ¯” AOF çš„æ•°æ®æ¢å¤é€Ÿåº¦å¿«ï¼Œä½†æ˜¯å¿«ç…§çš„é¢‘ç‡ä¸å¥½æŠŠæ¡ï¼š</p><ul><li>å¦‚æœé¢‘ç‡å¤ªä½ï¼Œä¸¤æ¬¡å¿«ç…§é—´ä¸€æ—¦æœåŠ¡å™¨å‘ç”Ÿå®•æœºï¼Œå°±å¯èƒ½ä¼šæ¯”è¾ƒå¤šçš„æ•°æ®ä¸¢å¤±ï¼›</li><li>å¦‚æœé¢‘ç‡å¤ªé«˜ï¼Œé¢‘ç¹å†™å…¥ç£ç›˜å’Œåˆ›å»ºå­è¿›ç¨‹ä¼šå¸¦æ¥é¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚</li></ul><p>é‚£æœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•ä¸ä»…æœ‰ RDB æ¢å¤é€Ÿåº¦å¿«çš„ä¼˜ç‚¹å’Œï¼Œåˆæœ‰ AOF ä¸¢å¤±æ•°æ®å°‘çš„ä¼˜ç‚¹å‘¢ï¼Ÿ</p><p>å½“ç„¶æœ‰ï¼Œé‚£å°±æ˜¯å°† RDB å’Œ AOF åˆä½“ä½¿ç”¨ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯åœ¨ Redis 4.0 æå‡ºçš„ï¼Œè¯¥æ–¹æ³•å«<strong>æ··åˆä½¿ç”¨ AOF æ—¥å¿—å’Œå†…å­˜å¿«ç…§</strong>ï¼Œä¹Ÿå«æ··åˆæŒä¹…åŒ–ã€‚</p><p>å½“å¼€å¯äº†æ··åˆæŒä¹…åŒ–æ—¶ï¼Œåœ¨ <mark>AOF é‡å†™æ—¥å¿—æ—¶</mark>ï¼Œ<code>fork</code> å‡ºæ¥çš„é‡å†™å­è¿›ç¨‹ä¼šå…ˆå°†ä¸ä¸»çº¿ç¨‹å…±äº«çš„å†…å­˜æ•°æ®ä»¥ RDB æ–¹å¼å†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œç„¶åä¸»çº¿ç¨‹å¤„ç†çš„æ“ä½œå‘½ä»¤ä¼šè¢«è®°å½•åœ¨<mark>é‡å†™ç¼“å†²åŒº</mark>é‡Œï¼Œé‡å†™ç¼“å†²åŒºé‡Œçš„å¢é‡å‘½ä»¤ä¼šä»¥ AOF æ–¹å¼å†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œå†™å…¥å®Œæˆåé€šçŸ¥ä¸»è¿›ç¨‹å°†æ–°çš„å«æœ‰ RDB æ ¼å¼å’Œ AOF æ ¼å¼çš„ AOF æ–‡ä»¶æ›¿æ¢æ—§çš„çš„ AOF æ–‡ä»¶ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨äº†æ··åˆæŒä¹…åŒ–ï¼ŒAOF æ–‡ä»¶çš„<strong>å‰åŠéƒ¨åˆ†æ˜¯ RDB æ ¼å¼çš„å…¨é‡æ•°æ®ï¼ŒååŠéƒ¨åˆ†æ˜¯ AOF æ ¼å¼çš„å¢é‡æ•°æ®</strong>ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231030213846575.png" alt="image-20231030213846575"></p><p>è¿™æ ·çš„å¥½å¤„åœ¨äºï¼Œé‡å¯ Redis åŠ è½½æ•°æ®çš„æ—¶å€™ï¼Œç”±äºå‰åŠéƒ¨åˆ†æ˜¯ RDB å†…å®¹ï¼Œè¿™æ ·<strong>åŠ è½½çš„æ—¶å€™é€Ÿåº¦ä¼šå¾ˆå¿«</strong>ã€‚</p><p>åŠ è½½å®Œ RDB çš„å†…å®¹åï¼Œæ‰ä¼šåŠ è½½ååŠéƒ¨åˆ†çš„ AOF å†…å®¹ï¼Œè¿™é‡Œçš„å†…å®¹æ˜¯ Redis åå°å­è¿›ç¨‹é‡å†™ AOF æœŸé—´ï¼Œä¸»çº¿ç¨‹å¤„ç†çš„æ“ä½œå‘½ä»¤ï¼Œå¯ä»¥ä½¿å¾—<strong>æ•°æ®æ›´å°‘çš„ä¸¢å¤±</strong>ã€‚</p><h2 id="Redis-å¤§-Key-å¯¹æŒä¹…åŒ–æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ"><a href="#Redis-å¤§-Key-å¯¹æŒä¹…åŒ–æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ" class="headerlink" title="Redis å¤§ Key å¯¹æŒä¹…åŒ–æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ"></a>Redis å¤§ Key å¯¹æŒä¹…åŒ–æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ</h2><h3 id="å¤§-Key-å¯¹-AOF-æ—¥å¿—çš„å½±å“"><a href="#å¤§-Key-å¯¹-AOF-æ—¥å¿—çš„å½±å“" class="headerlink" title="å¤§ Key å¯¹ AOF æ—¥å¿—çš„å½±å“"></a>å¤§ Key å¯¹ AOF æ—¥å¿—çš„å½±å“</h3><p>å½“ä½¿ç”¨ <strong>Always</strong> ç­–ç•¥çš„æ—¶å€™ï¼Œå¦‚æœå†™å…¥æ˜¯ä¸€ä¸ªå¤§ Keyï¼Œä¸»çº¿ç¨‹åœ¨æ‰§è¡Œ fsync() å‡½æ•°çš„æ—¶å€™ï¼Œ<mark>é˜»å¡çš„æ—¶é—´ä¼šæ¯”è¾ƒä¹…</mark>ï¼Œå› ä¸ºå½“å†™å…¥çš„æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™ï¼Œæ•°æ®åŒæ­¥åˆ°ç¡¬ç›˜è¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ˆè€—æ—¶çš„ã€‚</p><p>å½“ä½¿ç”¨ <strong>Everysec</strong> ç­–ç•¥çš„æ—¶å€™ï¼Œç”±äºæ˜¯å¼‚æ­¥æ‰§è¡Œ fsync() å‡½æ•°ï¼Œæ‰€ä»¥å¤§ Key æŒä¹…åŒ–çš„è¿‡ç¨‹ï¼ˆæ•°æ®åŒæ­¥ç£ç›˜ï¼‰<mark>ä¸ä¼šå½±å“ä¸»çº¿ç¨‹</mark>ã€‚</p><p>å½“ä½¿ç”¨ <strong>No</strong> ç­–ç•¥çš„æ—¶å€™ï¼Œç”±äºæ°¸ä¸æ‰§è¡Œ fsync() å‡½æ•°ï¼Œæ‰€ä»¥å¤§ Key æŒä¹…åŒ–çš„è¿‡ç¨‹ä¸ä¼šå½±å“ä¸»çº¿ç¨‹ã€‚</p><h3 id="å¤§-Key-å¯¹-AOF-é‡å†™å’Œ-RDB-çš„å½±å“"><a href="#å¤§-Key-å¯¹-AOF-é‡å†™å’Œ-RDB-çš„å½±å“" class="headerlink" title="å¤§ Key å¯¹ AOF é‡å†™å’Œ RDB çš„å½±å“"></a>å¤§ Key å¯¹ AOF é‡å†™å’Œ RDB çš„å½±å“</h3><ol><li>å¤åˆ¶é¡µè¡¨æœŸé—´ï¼š</li></ol><p>éšç€ Redis å­˜åœ¨è¶Šæ¥è¶Šå¤šçš„å¤§ Keyï¼Œé‚£ä¹ˆ Redis å°±ä¼šå ç”¨å¾ˆå¤šå†…å­˜ï¼Œå¯¹åº”çš„é¡µè¡¨å°±ä¼šè¶Šå¤§ã€‚</p><p>Redisä¸»è¿›ç¨‹åœ¨é€šè¿‡ <code>fork()</code> å‡½æ•°åˆ›å»ºå­è¿›ç¨‹çš„æ—¶å€™ï¼Œè™½ç„¶ä¸ä¼šå¤åˆ¶çˆ¶è¿›ç¨‹çš„ç‰©ç†å†…å­˜ï¼Œä½†æ˜¯<strong>å†…æ ¸ä¼šæŠŠçˆ¶è¿›ç¨‹çš„é¡µè¡¨å¤åˆ¶ä¸€ä»½ç»™å­è¿›ç¨‹ï¼Œå¦‚æœé¡µè¡¨å¾ˆå¤§ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤åˆ¶è¿‡ç¨‹æ˜¯ä¼šå¾ˆè€—æ—¶çš„ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œ fork å‡½æ•°çš„æ—¶å€™å°±ä¼šå‘ç”Ÿé˜»å¡ç°è±¡</strong>ã€‚</p><ol start="2"><li>å†™æ—¶å¤åˆ¶æœŸé—´ï¼š</li></ol><p>å¦‚æœåˆ›å»ºå®Œå­è¿›ç¨‹åï¼Œ<strong>çˆ¶è¿›ç¨‹å¯¹å…±äº«å†…å­˜ä¸­çš„å¤§ Key è¿›è¡Œäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆå†…æ ¸å°±ä¼šå‘ç”Ÿå†™æ—¶å¤åˆ¶ï¼Œä¼šæŠŠç‰©ç†å†…å­˜å¤åˆ¶ä¸€ä»½ï¼Œç”±äºå¤§ Key å ç”¨çš„ç‰©ç†å†…å­˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œé‚£ä¹ˆåœ¨å¤åˆ¶ç‰©ç†å†…å­˜è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œäºæ˜¯çˆ¶è¿›ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰å°±ä¼šå‘ç”Ÿé˜»å¡</strong>ã€‚</p><h1 id="é«˜å¯ç”¨ç¯‡âœï¸"><a href="#é«˜å¯ç”¨ç¯‡âœï¸" class="headerlink" title="é«˜å¯ç”¨ç¯‡âœï¸"></a>é«˜å¯ç”¨ç¯‡âœï¸</h1><h2 id="ä¸»ä»å¤åˆ¶"><a href="#ä¸»ä»å¤åˆ¶" class="headerlink" title="ä¸»ä»å¤åˆ¶"></a>ä¸»ä»å¤åˆ¶</h2><p>ä¸»æœåŠ¡å™¨å†™ï¼Œä»æœåŠ¡å™¨è¯»ï¼Œåœ¨ä»æœºä¸Šå†™æ•°æ®ä¼šæŠ¥é”™</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231031212316265.png" alt="ä¸»ä»å¤åˆ¶å›¾"></p><h3 id="å¤åˆ¶åŸç†"><a href="#å¤åˆ¶åŸç†" class="headerlink" title="å¤åˆ¶åŸç†"></a>å¤åˆ¶åŸç†</h3><ol><li>å½“ä»æœåŠ¡å™¨è¿æ¥ä¸Šä¸»æœåŠ¡å™¨ä¹‹åï¼Œä»æœåŠ¡å™¨å‘ä¸»æœåŠ¡å‘é€è¿›è¡Œæ•°æ®åŒæ­¥æ¶ˆæ¯</li><li>ä¸»æœåŠ¡å™¨æ¥åˆ°ä»æœåŠ¡å™¨å‘é€è¿‡æ¥åŒæ­¥æ¶ˆæ¯ï¼ŒæŠŠä¸»æœåŠ¡å™¨æ•°æ®è¿›è¡ŒæŒä¹…åŒ–<code>rdb</code>æ–‡ä»¶ï¼ŒæŠŠ<code>rdb</code>æ–‡ä»¶å‘é€ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨æ‹¿åˆ°<code>rdb</code>æ–‡ä»¶è¿›è¡Œè¯»å–</li></ol><blockquote><p>ğŸŒˆè¡¥å……ï¼š</p><p><strong>ä¸»æœåŠ¡å™¨åœ¨ä¸‹é¢è¿™ä¸‰ä¸ªæ—¶é—´é—´éš™ä¸­å°†æ”¶åˆ°çš„å†™æ“ä½œå‘½ä»¤ï¼Œå†™å…¥åˆ° replication buffer ç¼“å†²åŒºé‡Œ</strong>ï¼š</p><ul><li>ä¸»æœåŠ¡å™¨ç”Ÿæˆ RDB æ–‡ä»¶æœŸé—´ï¼›</li><li>ä¸»æœåŠ¡å™¨å‘é€ RDB æ–‡ä»¶ç»™ä»æœåŠ¡å™¨æœŸé—´ï¼›</li><li>ã€Œä»æœåŠ¡å™¨ã€åŠ è½½ RDB æ–‡ä»¶æœŸé—´ï¼›</li></ul><p>å½“å®Œæˆ RDB çš„è½½å…¥åï¼Œä¸»æœåŠ¡å™¨å°† replication buffer ç¼“å†²åŒºé‡Œæ‰€è®°å½•çš„å†™æ“ä½œå‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨æ‰§è¡Œæ¥è‡ªä¸»æœåŠ¡å™¨ replication buffer ç¼“å†²åŒºé‡Œå‘æ¥çš„å‘½ä»¤ï¼Œè¿™æ—¶ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®å°±ä¸€è‡´äº†ã€‚</p><p>è‡³æ­¤ï¼Œä¸»ä»æœåŠ¡å™¨çš„<mark>ç¬¬ä¸€æ¬¡åŒæ­¥</mark>çš„å·¥ä½œå°±å®Œæˆäº†ã€‚</p></blockquote><ol start="3"><li>æ¯æ¬¡ä¸»æœåŠ¡å™¨è¿›è¡Œå†™æ“ä½œä¹‹åï¼Œå’Œä»æœåŠ¡å™¨è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œ<mark><strong>åŸºäºé•¿è¿æ¥çš„å‘½ä»¤ä¼ æ’­</strong></mark></li></ol><blockquote><p>ğŸŒˆè¡¥å……ï¼š</p><p>ä¸»ä»æœåŠ¡å™¨å®Œæˆç¬¬ä¸€æ¬¡æ•°æ®åŒæ­¥åï¼ŒTCPç½‘ç»œè¿æ¥ä¼šä¸€ç›´ç»´æŒç€ï¼Œåç»­ä¸»æœåŠ¡å™¨å¯ä»¥é€šè¿‡è¿™ä¸ªè¿æ¥ç»§ç»­å°†å†™æ“ä½œå‘½ä»¤ä¼ æ’­ç»™ä»æœåŠ¡å™¨ï¼Œç„¶åä»æœåŠ¡å™¨æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œä½¿å¾—ä¸ä¸»æœåŠ¡å™¨çš„æ•°æ®åº“çŠ¶æ€ç›¸åŒã€‚</p></blockquote><ol start="4"><li>å½“å‘ç”Ÿç½‘ç»œæ³¢åŠ¨é—®é¢˜å¯¼è‡´åŸºäºé•¿è¿æ¥çš„å‘½ä»¤ä¼ æ’­æ–­å¼€æ—¶ï¼š</li></ol><p>åœ¨ Redis 2.8 ä¹‹å‰ï¼Œå¦‚æœä¸»ä»æœåŠ¡å™¨åœ¨å‘½ä»¤åŒæ­¥æ—¶å‡ºç°äº†ç½‘ç»œæ–­å¼€åˆæ¢å¤çš„æƒ…å†µï¼Œä»æœåŠ¡å™¨å°±ä¼šå’Œä¸»æœåŠ¡å™¨é‡æ–°è¿›è¡Œä¸€æ¬¡å…¨é‡å¤åˆ¶ï¼Œå¾ˆæ˜æ˜¾è¿™æ ·çš„å¼€é”€å¤ªå¤§äº†ï¼Œå¿…é¡»è¦æ”¹è¿›ä¸€æ³¢ã€‚</p><p>æ‰€ä»¥ï¼Œä» Redis 2.8 å¼€å§‹ï¼Œç½‘ç»œæ–­å¼€åˆæ¢å¤åï¼Œä»ä¸»ä»æœåŠ¡å™¨ä¼šé‡‡ç”¨<mark><strong>å¢é‡å¤åˆ¶</strong></mark>çš„æ–¹å¼ç»§ç»­åŒæ­¥ï¼Œä¹Ÿå°±æ˜¯åªä¼šæŠŠç½‘ç»œæ–­å¼€æœŸé—´ä¸»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„å†™æ“ä½œå‘½ä»¤ï¼ŒåŒæ­¥ç»™ä»æœåŠ¡å™¨ã€‚</p><p><strong>ä¸»æœåŠ¡å™¨æ€ä¹ˆçŸ¥é“è¦å°†å“ªäº›å¢é‡æ•°æ®å‘é€ç»™ä»æœåŠ¡å™¨å‘¢ï¼Ÿ</strong></p><p>ç­”æ¡ˆè—åœ¨è¿™ä¸¤ä¸ªä¸œè¥¿é‡Œï¼š</p><ul><li><strong>repl_backlog_buffer</strong>ï¼Œæ˜¯ä¸€ä¸ªã€Œ<strong>ç¯å½¢</strong>ã€ç¼“å†²åŒºï¼Œç”¨äºä¸»ä»æœåŠ¡å™¨æ–­è¿åï¼Œä»ä¸­æ‰¾åˆ°å·®å¼‚çš„æ•°æ®ï¼›</li><li><strong>replication offset</strong>ï¼Œæ ‡è®°ä¸Šé¢é‚£ä¸ªç¼“å†²åŒºçš„åŒæ­¥è¿›åº¦ï¼Œä¸»ä»æœåŠ¡å™¨éƒ½æœ‰å„è‡ªçš„<mark>åç§»é‡</mark>ï¼Œä¸»æœåŠ¡å™¨ä½¿ç”¨ master_repl_offset æ¥è®°å½•è‡ªå·±ã€Œ<em>å†™</em>ã€åˆ°çš„ä½ç½®ï¼Œä»æœåŠ¡å™¨ä½¿ç”¨ slave_repl_offset æ¥è®°å½•è‡ªå·±ã€Œ<em>è¯»</em>ã€åˆ°çš„ä½ç½®ã€‚</li></ul><p>é‚£ repl_backlog_buffer ç¼“å†²åŒºæ˜¯ä»€ä¹ˆæ—¶å€™å†™å…¥çš„å‘¢ï¼Ÿ</p><p>åœ¨ä¸»æœåŠ¡å™¨è¿›è¡Œå‘½ä»¤ä¼ æ’­æ—¶ï¼Œä¸ä»…ä¼šå°†å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œè¿˜ä¼šå°†å†™å‘½ä»¤å†™å…¥åˆ° repl_backlog_buffer ç¼“å†²åŒºé‡Œï¼Œå› æ­¤ è¿™ä¸ªç¼“å†²åŒºé‡Œä¼šä¿å­˜ç€æœ€è¿‘ä¼ æ’­çš„å†™å‘½ä»¤ã€‚</p><p>ç½‘ç»œæ–­å¼€åï¼Œå½“ä»æœåŠ¡å™¨é‡æ–°è¿ä¸Šä¸»æœåŠ¡å™¨æ—¶ï¼Œä»æœåŠ¡å™¨ä¼šé€šè¿‡ psync å‘½ä»¤å°†è‡ªå·±çš„å¤åˆ¶åç§»é‡ slave_repl_offset å‘é€ç»™ä¸»æœåŠ¡å™¨ï¼Œä¸»æœåŠ¡å™¨æ ¹æ®è‡ªå·±çš„ master_repl_offset å’Œ slave_repl_offset ä¹‹é—´çš„å·®è·ï¼Œç„¶åæ¥å†³å®šå¯¹ä»æœåŠ¡å™¨æ‰§è¡Œå“ªç§åŒæ­¥æ“ä½œï¼š</p><ul><li>å¦‚æœåˆ¤æ–­å‡ºä»æœåŠ¡å™¨è¦è¯»å–çš„æ•°æ®è¿˜åœ¨ repl_backlog_buffer ç¼“å†²åŒºé‡Œï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨å°†é‡‡ç”¨<strong>å¢é‡åŒæ­¥</strong>çš„æ–¹å¼ï¼›</li><li>ç›¸åï¼Œå¦‚æœåˆ¤æ–­å‡ºä»æœåŠ¡å™¨è¦è¯»å–çš„æ•°æ®å·²ç»ä¸å­˜åœ¨ repl_backlog_buffer ç¼“å†²åŒºé‡Œï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨å°†é‡‡ç”¨<strong>å…¨é‡åŒæ­¥</strong>çš„æ–¹å¼ã€‚</li></ul><p>å½“ä¸»æœåŠ¡å™¨åœ¨ repl_backlog_buffer ä¸­æ‰¾åˆ°ä¸»ä»æœåŠ¡å™¨å·®å¼‚ï¼ˆå¢é‡ï¼‰çš„æ•°æ®åï¼Œå°±ä¼šå°†å¢é‡çš„æ•°æ®å†™å…¥åˆ° replication buffer ç¼“å†²åŒºï¼Œè¿™ä¸ªç¼“å†²åŒºæˆ‘ä»¬å‰é¢ä¹Ÿæåˆ°è¿‡ï¼Œå®ƒæ˜¯ç¼“å­˜å°†è¦ä¼ æ’­ç»™ä»æœåŠ¡å™¨çš„å‘½ä»¤ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/2db4831516b9a8b79f833cf0593c1f12.png" alt="å›¾ç‰‡"></p><p>repl_backlog_buffer ç¼“è¡Œç¼“å†²åŒºçš„é»˜è®¤å¤§å°æ˜¯ 1Mï¼Œå¹¶ä¸”ç”±äºå®ƒæ˜¯ä¸€ä¸ª<mark>ç¯å½¢ç¼“å†²åŒº</mark>ï¼Œæ‰€ä»¥å½“ç¼“å†²åŒºå†™æ»¡åï¼Œä¸»æœåŠ¡å™¨ç»§ç»­å†™å…¥çš„è¯ï¼Œå°±ä¼šè¦†ç›–ä¹‹å‰çš„æ•°æ®ã€‚å› æ­¤ï¼Œ<strong>å½“ä¸»æœåŠ¡å™¨çš„å†™å…¥é€Ÿåº¦è¿œè¶…äºä»æœåŠ¡å™¨çš„è¯»å–é€Ÿåº¦ï¼Œç¼“å†²åŒºçš„æ•°æ®ä¸€ä¸‹å°±ä¼šè¢«è¦†ç›–ã€‚</strong></p><p>é‚£ä¹ˆåœ¨ç½‘ç»œæ¢å¤æ—¶ï¼Œå¦‚æœä»æœåŠ¡å™¨æƒ³è¯»çš„æ•°æ®å·²ç»è¢«è¦†ç›–äº†ï¼Œä¸»æœåŠ¡å™¨å°±ä¼šé‡‡ç”¨å…¨é‡åŒæ­¥ï¼Œè¿™ä¸ªæ–¹å¼æ¯”å¢é‡åŒæ­¥çš„æ€§èƒ½æŸè€—è¦å¤§å¾ˆå¤šã€‚</p><p>å› æ­¤ï¼Œ<strong>ä¸ºäº†é¿å…åœ¨ç½‘ç»œæ¢å¤æ—¶ï¼Œä¸»æœåŠ¡å™¨é¢‘ç¹åœ°ä½¿ç”¨å…¨é‡åŒæ­¥çš„æ–¹å¼ï¼Œæˆ‘ä»¬åº”è¯¥è°ƒæ•´ä¸‹ repl_backlog_buffer ç¼“å†²åŒºå¤§å°ï¼Œ<mark>å°½å¯èƒ½çš„å¤§ä¸€äº›</strong></mark>ã€‚</p><h3 id="å¤åˆ¶å»¶è¿Ÿ"><a href="#å¤åˆ¶å»¶è¿Ÿ" class="headerlink" title="å¤åˆ¶å»¶è¿Ÿ"></a>å¤åˆ¶å»¶è¿Ÿ</h3><p>ç”±äºæ‰€æœ‰çš„å†™æ“ä½œéƒ½æ˜¯å…ˆåœ¨Masterä¸Šæ“ä½œï¼Œç„¶ååŒæ­¥æ›´æ–°åˆ°Slaveä¸Šï¼Œæ‰€ä»¥ä»MasteråŒæ­¥åˆ°Slaveæœºå™¨æœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œå½“ç³»ç»Ÿå¾ˆç¹å¿™çš„æ—¶å€™ï¼Œå»¶è¿Ÿé—®é¢˜ä¼šæ›´åŠ ä¸¥é‡ï¼ŒSlaveæœºå™¨æ•°é‡çš„å¢åŠ ä¹Ÿä¼šä½¿è¿™ä¸ªé—®é¢˜æ›´åŠ ä¸¥é‡ã€‚</p><h3 id="ä¸€ä¸»äºŒä»†"><a href="#ä¸€ä¸»äºŒä»†" class="headerlink" title="ä¸€ä¸»äºŒä»†"></a>ä¸€ä¸»äºŒä»†</h3><p>å½“ä¸€å°ä»æœåŠ¡å™¨æŒ‚äº†ä¹‹åï¼Œæ­¤æ—¶åœ¨è¿™ä¸ªæœŸé—´ä¸»æœåŠ¡å™¨å†™å…¥æ•°æ®ï¼Œæ­¤æ—¶å†å°†è¯¥æŒ‚æ‰äº†çš„ä»æœåŠ¡å™¨é‡æ–°å¯åŠ¨ï¼Œæ­¤æ—¶è¿™å°æœåŠ¡å™¨å·²ç»ä¸å†æ˜¯ä»æœåŠ¡å™¨äº†ï¼Œå³ä¸åŸæ¥çš„ä¸»æœåŠ¡å™¨å¤±å»äº†ä¸»ä»å…³ç³»ï¼Œå®ƒç°åœ¨å˜æˆäº†ä¸€ä¸ªç‹¬ç«‹çš„ä¸»æœåŠ¡å™¨ï¼Œå†è®©è¯¥æœåŠ¡å™¨å»ä¸åŸæ¥çš„ä¸»æœåŠ¡å™¨å»å»ºç«‹è”ç³»ï¼Œé‚£ä¹ˆå°±ä¼šå°†ä¸»æœåŠ¡å™¨çš„å½“å‰çš„æ‰€æœ‰å†…å®¹ï¼ˆ<mark>å³åŒ…æ‹¬åœ¨å…¶æŒ‚æ‰çš„é‚£æœŸé—´çš„æ•°æ®</mark>ï¼‰å…¨éƒ¨å¤åˆ¶åˆ°ä»æœåŠ¡å™¨ä¸Šã€‚</p><p>å½“ä¸»æœåŠ¡å™¨æŒ‚æ‰ä¹‹åï¼Œå‰©ä¸‹çš„ä»æœåŠ¡å™¨ä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼Œä¾ç„¶è®¤ä¸ºåŸæ¥çš„ä¸»æœåŠ¡å™¨æ˜¯ä¸»æœåŠ¡å™¨ï¼Œå¹¶ä¸ä¼šè‡ªå·±æˆä¸ºæ–°çš„ä¸»æœåŠ¡å™¨ï¼Œç­‰åˆ°åŸæ¥çš„ä¸»æœåŠ¡å™¨é‡å¯åï¼Œä¸€åˆ‡æ¢å¤æ­£å¸¸ã€‚</p><h3 id="çº§è”å¤åˆ¶"><a href="#çº§è”å¤åˆ¶" class="headerlink" title="çº§è”å¤åˆ¶"></a>çº§è”å¤åˆ¶</h3><p>å…¶å®å°±æ˜¯åƒä¸ªé“¾è¡¨ä¸€æ ·ï¼Œå°†æ•°æ®åŒæ­¥çš„æ–¹å¼ç”±ä¸€å°ä¸»æœåŠ¡å™¨ç»™å¤šå°æœåŠ¡å™¨ä¼ è¾¾ï¼Œè½¬å˜ä¸ºA-&gt;B-&gt;Cè¿™æ ·çš„æ¨¡å¼ã€‚</p><ul><li><p>ä¼˜ç‚¹ï¼šé€šè¿‡è¿™ç§æ–¹å¼ï¼Œ<strong>ä¸»æœåŠ¡å™¨ç”Ÿæˆ RDB å’Œä¼ è¾“ RDB çš„<mark>å‹åŠ›</mark>å¯ä»¥<mark>åˆ†æ‘Š</mark>åˆ°å……å½“ç»ç†è§’è‰²çš„ä»æœåŠ¡å™¨</strong>ã€‚</p></li><li><p><del>ç¼ºç‚¹ï¼šBä½œä¸ºCçš„ä¸»æœåŠ¡å™¨ï¼Œé‚£ä¹ˆBæœåŠ¡å™¨å°±å¯ä»¥è¿›è¡Œå†™æ“ä½œäº†ï¼Œä½†BæœåŠ¡å™¨å´æ˜¯AæœåŠ¡å™¨çš„ä»æœåŠ¡å™¨ï¼ŒBæœåŠ¡å™¨å¦‚æœå†™äº†æ•°æ®é‚£ä¹ˆAæœåŠ¡å™¨æ˜¯æ— æ³•è¿›è¡ŒåŒæ­¥çš„ï¼Œè¿™å°±å‡ºç°äº†æ•°æ®çš„ä¸åŒæ­¥é—®é¢˜ã€‚</del></p></li><li><p>ä¸€èˆ¬ä¸ä¼šå‡ºç°BæœåŠ¡å™¨ä¸»åŠ¨å†™çš„æ“ä½œï¼ŒBæœåŠ¡å™¨çš„å†™æ“ä½œåªæ˜¯ç»§æ‰¿è‡ªAæœåŠ¡å™¨çš„æ•°æ®è€Œå»å†™åˆ°CæœåŠ¡å™¨ã€‚</p></li></ul><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231031222351693.png" alt="è–ªç«ç›¸ä¼ "></p><h3 id="å°æ—codingé¢è¯•é¢˜-1"><a href="#å°æ—codingé¢è¯•é¢˜-1" class="headerlink" title="å°æ—codingé¢è¯•é¢˜"></a>å°æ—codingé¢è¯•é¢˜</h3><ol><li>Redisä¸»ä»èŠ‚ç‚¹æ—¶é•¿è¿æ¥è¿˜æ˜¯çŸ­è¿æ¥ï¼Ÿ</li></ol><blockquote><p>é•¿è¿æ¥</p></blockquote><ol start="2"><li>æ€ä¹ˆåˆ¤æ–­ Redis æŸä¸ªèŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Ÿ</li></ol><blockquote><p>Redis åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡äº’ç›¸çš„ ping-pong <mark>å¿ƒæ€æ£€æµ‹æœºåˆ¶</mark>ï¼Œå¦‚æœ<mark>æœ‰ä¸€åŠä»¥ä¸Šçš„èŠ‚ç‚¹å» ping ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™æ²¡æœ‰ pong å›åº”</mark>ï¼Œé›†ç¾¤å°±ä¼šè®¤ä¸ºè¿™ä¸ªèŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œä¼šæ–­å¼€ä¸è¿™ä¸ªèŠ‚ç‚¹çš„è¿æ¥ã€‚</p></blockquote><ol start="3"><li>ä¸»ä»å¤åˆ¶æ¶æ„ä¸­ï¼Œè¿‡æœŸkeyå¦‚ä½•å¤„ç†ï¼Ÿ</li></ol><blockquote><p>ä¸»èŠ‚ç‚¹å¤„ç†äº†ä¸€ä¸ªkeyæˆ–è€…é€šè¿‡æ·˜æ±°ç®—æ³•æ·˜æ±°äº†ä¸€ä¸ªkeyï¼Œè¿™ä¸ªæ—¶é—´<mark>ä¸»èŠ‚ç‚¹æ¨¡æ‹Ÿä¸€æ¡delå‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹</mark>ï¼Œä»èŠ‚ç‚¹æ”¶åˆ°è¯¥å‘½ä»¤åï¼Œå°±è¿›è¡Œåˆ é™¤keyçš„æ“ä½œã€‚</p></blockquote><ol start="4"><li>Redis æ˜¯åŒæ­¥å¤åˆ¶è¿˜æ˜¯å¼‚æ­¥å¤åˆ¶ï¼Ÿ</li></ol><blockquote><p>Redis ä¸»èŠ‚ç‚¹æ¯æ¬¡æ”¶åˆ°å†™å‘½ä»¤ä¹‹åï¼Œå…ˆå†™åˆ°å†…éƒ¨çš„ç¼“å†²åŒºï¼Œç„¶åå¼‚æ­¥å‘é€ç»™ä»èŠ‚ç‚¹ã€‚</p></blockquote><ol start="5"><li>ä¸»ä»å¤åˆ¶ä¸­ä¸¤ä¸ª Buffer(replication buffer ã€repl backlog buffer)æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li></ol><blockquote><p>replication buffer ã€repl backlog buffer åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li>å‡ºç°çš„é˜¶æ®µä¸ä¸€æ ·ï¼š</li><li>repl backlog buffer æ˜¯åœ¨å¢é‡å¤åˆ¶é˜¶æ®µå‡ºç°ï¼Œ<strong>ä¸€ä¸ªä¸»èŠ‚ç‚¹åªåˆ†é…ä¸€ä¸ª repl backlog buffer</strong>ï¼›</li><li>replication buffer æ˜¯åœ¨å…¨é‡å¤åˆ¶é˜¶æ®µå’Œå¢é‡å¤åˆ¶é˜¶æ®µéƒ½ä¼šå‡ºç°ï¼Œ<strong>ä¸»èŠ‚ç‚¹ä¼šç»™æ¯ä¸ªæ–°è¿æ¥çš„ä»èŠ‚ç‚¹ï¼Œåˆ†é…ä¸€ä¸ª replication buffer</strong>ï¼›</li><li>è¿™ä¸¤ä¸ª Buffer éƒ½æœ‰å¤§å°é™åˆ¶çš„ï¼Œå½“ç¼“å†²åŒºæ»¡äº†ä¹‹åï¼Œå‘ç”Ÿçš„äº‹æƒ…ä¸ä¸€æ ·ï¼š</li><li>å½“ repl backlog buffer æ»¡äº†ï¼Œå› ä¸ºæ˜¯ç¯å½¢ç»“æ„ï¼Œä¼šç›´æ¥<strong>è¦†ç›–èµ·å§‹ä½ç½®æ•°æ®</strong>;</li><li>å½“ replication buffer æ»¡äº†ï¼Œä¼šå¯¼è‡´è¿æ¥æ–­å¼€ï¼Œåˆ é™¤ç¼“å­˜ï¼Œä»èŠ‚ç‚¹é‡æ–°è¿æ¥ï¼Œ<strong>é‡æ–°å¼€å§‹å…¨é‡å¤åˆ¶</strong>ã€‚</li></ul></blockquote><ol start="6"><li>å¦‚ä½•åº”å¯¹ä¸»ä»æ•°æ®ä¸ä¸€è‡´ï¼Ÿ</li></ol><blockquote><p><strong>ä¸»ä»èŠ‚ç‚¹é—´çš„å‘½ä»¤å¤åˆ¶æ˜¯å¼‚æ­¥è¿›è¡Œçš„</strong>ï¼Œæ‰€ä»¥æ— æ³•å®ç°å¼ºä¸€è‡´æ€§ä¿è¯ï¼ˆä¸»ä»æ•°æ®æ—¶æ—¶åˆ»åˆ»ä¿æŒä¸€è‡´ï¼‰ã€‚</p><p>ç¬¬ä¸€ç§æ–¹æ³•ï¼Œå°½é‡ä¿è¯ä¸»ä»èŠ‚ç‚¹é—´çš„ç½‘ç»œè¿æ¥çŠ¶å†µè‰¯å¥½ï¼Œé¿å…ä¸»ä»èŠ‚ç‚¹åœ¨ä¸åŒçš„æœºæˆ¿ã€‚</p><p>ç¬¬äºŒç§æ–¹æ³•ï¼Œå¯ä»¥å¼€å‘ä¸€ä¸ªå¤–éƒ¨ç¨‹åºæ¥ç›‘æ§ä¸»ä»èŠ‚ç‚¹é—´çš„å¤åˆ¶è¿›åº¦ã€‚å¦‚æœç›‘æ§åˆ°æŸä¸ªä»èŠ‚ç‚¹æ€»æ˜¯å¾ˆå¤§ç¨‹åº¦ä¸Šçš„ï¼Œå¾ˆé•¿æ—¶é—´æ®µçš„ä¸ä¸€è‡´ï¼Œå¯ä»¥è®©å®¢æˆ·ç«¯ä¸å†å’Œè¿™ä¸ªä»èŠ‚ç‚¹è¿æ¥è¿›è¡Œæ•°æ®è¯»å–ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘è¯»åˆ°ä¸ä¸€è‡´æ•°æ®çš„æƒ…å†µã€‚</p></blockquote><ol start="7"><li>ä¸»ä»åˆ‡æ¢å¦‚ä½•å‡å°‘æ•°æ®ä¸¢å¤±ï¼Ÿ</li></ol><blockquote><p>ä¸»ä»åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼Œäº§ç”Ÿæ•°æ®ä¸¢å¤±çš„æƒ…å†µæœ‰ä¸¤ç§ï¼š</p><ul><li>å¼‚æ­¥å¤åˆ¶åŒæ­¥ä¸¢å¤±</li><li>é›†ç¾¤äº§ç”Ÿè„‘è£‚æ•°æ®ä¸¢å¤±</li></ul><p>æˆ‘ä»¬ä¸å¯èƒ½ä¿è¯æ•°æ®å®Œå…¨ä¸ä¸¢å¤±ï¼Œåªèƒ½åšåˆ°ä½¿å¾—å°½é‡å°‘çš„æ•°æ®ä¸¢å¤±ã€‚</p><p>å¾…è¡¥å……ã€‚ã€‚ã€‚ã€‚ã€‚</p></blockquote><ol start="8"><li>ä¸»ä»å¦‚ä½•åšåˆ°æ•…éšœè‡ªåŠ¨åˆ‡æ¢ï¼Ÿ</li></ol><blockquote><p>Redis å“¨å…µæœºåˆ¶å¯ä»¥å®ç°ï¼šå“¨å…µåœ¨å‘ç°ä¸»èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶ï¼Œç”±å“¨å…µè‡ªåŠ¨å®Œæˆæ•…éšœå‘ç°å’Œæ•…éšœè½¬ç§»ï¼Œå¹¶é€šçŸ¥ç»™åº”ç”¨æ–¹ï¼Œä»è€Œå®ç°é«˜å¯ç”¨æ€§ã€‚</p></blockquote><h2 id="å“¨å…µæ¨¡å¼"><a href="#å“¨å…µæ¨¡å¼" class="headerlink" title="å“¨å…µæ¨¡å¼"></a>å“¨å…µæ¨¡å¼</h2><p>ğŸ”´ğŸŸ¡ğŸŸ¢ä¸€å¥è¯æ€»ç»“ï¼š</p><blockquote><p>èƒ½å¤Ÿè‡ªåŠ¨åå°ç›‘æ§ä¸»æœºæ˜¯å¦æ•…éšœï¼Œå¦‚æœæ•…éšœäº†æ ¹æ®æŠ•ç¥¨æ•°è‡ªåŠ¨å°†ä»åº“è½¬æ¢ä¸ºä¸»åº“ã€‚å½“ä»æœåŠ¡å™¨åˆ‡æ¢ä¸ºæ–°çš„ä¸»æœåŠ¡å™¨åï¼ŒåŸæ¥çš„ä¸»æœåŠ¡å™¨å°±å˜æˆäº†å…¶çš„ä»æœåŠ¡å™¨ã€‚</p></blockquote><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231101101453322.png" alt="å“¨å…µæ¨¡å¼"></p><p>å“¨å…µèŠ‚ç‚¹ä¸»è¦è´Ÿè´£ä¸‰ä»¶äº‹æƒ…ï¼š<strong>ç›‘æ§ã€é€‰ä¸»ã€é€šçŸ¥</strong>ã€‚</p><h3 id="å¦‚ä½•åˆ¤æ–­ä¸»èŠ‚ç‚¹çœŸçš„æ•…éšœäº†ï¼Ÿ"><a href="#å¦‚ä½•åˆ¤æ–­ä¸»èŠ‚ç‚¹çœŸçš„æ•…éšœäº†ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ¤æ–­ä¸»èŠ‚ç‚¹çœŸçš„æ•…éšœäº†ï¼Ÿ"></a>å¦‚ä½•åˆ¤æ–­ä¸»èŠ‚ç‚¹çœŸçš„æ•…éšœäº†ï¼Ÿ</h3><p>å“¨å…µä¼šæ¯éš” 1 ç§’ç»™æ‰€æœ‰ä¸»ä»èŠ‚ç‚¹å‘é€ PING å‘½ä»¤ï¼Œå½“ä¸»ä»èŠ‚ç‚¹æ”¶åˆ° PING å‘½ä»¤åï¼Œä¼šå‘é€ä¸€ä¸ªå“åº”å‘½ä»¤ç»™å“¨å…µï¼Œè¿™æ ·å°±å¯ä»¥åˆ¤æ–­å®ƒä»¬æ˜¯å¦åœ¨æ­£å¸¸è¿è¡Œã€‚</p><p>å¦‚æœä¸»èŠ‚ç‚¹æˆ–è€…ä»èŠ‚ç‚¹æ²¡æœ‰åœ¨è§„å®šçš„æ—¶é—´å†…å“åº”å“¨å…µçš„ PING å‘½ä»¤ï¼Œå“¨å…µå°±ä¼šå°†å®ƒä»¬æ ‡è®°ä¸ºã€Œ<strong>ä¸»è§‚ä¸‹çº¿</strong>ã€ã€‚</p><p><mark>å®¢è§‚ä¸‹çº¿åªé€‚ç”¨äºä¸»èŠ‚ç‚¹ã€‚</mark></p><p>ä¹‹æ‰€ä»¥é’ˆå¯¹ã€Œä¸»èŠ‚ç‚¹ã€è®¾è®¡ã€Œä¸»è§‚ä¸‹çº¿ã€å’Œã€Œå®¢è§‚ä¸‹çº¿ã€ä¸¤ä¸ªçŠ¶æ€ï¼Œæ˜¯å› ä¸ºæœ‰å¯èƒ½ã€Œä¸»èŠ‚ç‚¹ã€å…¶å®å¹¶æ²¡æœ‰æ•…éšœï¼Œå¯èƒ½åªæ˜¯å› ä¸ºä¸»èŠ‚ç‚¹çš„ç³»ç»Ÿå‹åŠ›æ¯”è¾ƒå¤§æˆ–è€…ç½‘ç»œå‘é€äº†æ‹¥å¡ï¼Œå¯¼è‡´ä¸»èŠ‚ç‚¹æ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…å“åº”å“¨å…µçš„ PING å‘½ä»¤ã€‚</p><p>æ‰€ä»¥ï¼Œä¸ºäº†å‡å°‘è¯¯åˆ¤çš„æƒ…å†µï¼Œå“¨å…µåœ¨éƒ¨ç½²çš„æ—¶å€™ä¸ä¼šåªéƒ¨ç½²ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œæ˜¯ç”¨å¤šä¸ªèŠ‚ç‚¹éƒ¨ç½²æˆ<strong>å“¨å…µé›†ç¾¤</strong>ï¼ˆ<em>æœ€å°‘éœ€è¦ä¸‰å°æœºå™¨æ¥éƒ¨ç½²å“¨å…µé›†ç¾¤</em>ï¼‰ï¼Œ<strong>é€šè¿‡å¤šä¸ªå“¨å…µèŠ‚ç‚¹ä¸€èµ·åˆ¤æ–­ï¼Œå°±å¯ä»¥å°±å¯ä»¥<mark>é¿å…å•ä¸ªå“¨å…µå› ä¸ºè‡ªèº«ç½‘ç»œçŠ¶å†µä¸å¥½ï¼Œè€Œè¯¯åˆ¤</mark>ä¸»èŠ‚ç‚¹ä¸‹çº¿çš„æƒ…å†µ</strong>ã€‚åŒæ—¶ï¼Œå¤šä¸ªå“¨å…µçš„ç½‘ç»œåŒæ—¶ä¸ç¨³å®šçš„æ¦‚ç‡è¾ƒå°ï¼Œç”±å®ƒä»¬ä¸€èµ·åšå†³ç­–ï¼Œè¯¯åˆ¤ç‡ä¹Ÿèƒ½é™ä½ã€‚</p><p>å…·ä½“æ˜¯æ€ä¹ˆåˆ¤å®šä¸»èŠ‚ç‚¹ä¸ºã€Œå®¢è§‚ä¸‹çº¿ã€çš„å‘¢ï¼Ÿ</p><p>å½“ä¸€ä¸ªå“¨å…µåˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸ºã€Œä¸»è§‚ä¸‹çº¿ã€åï¼Œå°±ä¼šå‘å…¶ä»–å“¨å…µå‘èµ·å‘½ä»¤ï¼Œå…¶ä»–å“¨å…µæ”¶åˆ°è¿™ä¸ªå‘½ä»¤åï¼Œå°±ä¼šæ ¹æ®è‡ªèº«å’Œä¸»èŠ‚ç‚¹çš„ç½‘ç»œçŠ¶å†µï¼Œåšå‡ºèµæˆæŠ•ç¥¨æˆ–è€…æ‹’ç»æŠ•ç¥¨çš„å“åº”ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/13e4361407ba46979e802eaa654dcf67.png" alt="img"></p><p>å½“è¿™ä¸ªå“¨å…µçš„èµåŒç¥¨æ•°è¾¾åˆ°å“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum é…ç½®é¡¹è®¾å®šçš„å€¼åï¼Œè¿™æ—¶ä¸»èŠ‚ç‚¹å°±ä¼šè¢«è¯¥å“¨å…µæ ‡è®°ä¸ºã€Œå®¢è§‚ä¸‹çº¿ã€ã€‚</p><p>ä¾‹å¦‚ï¼Œç°åœ¨æœ‰ 3 ä¸ªå“¨å…µï¼Œquorum é…ç½®çš„æ˜¯ 2ï¼Œé‚£ä¹ˆä¸€ä¸ªå“¨å…µéœ€è¦ 2 å¼ èµæˆç¥¨ï¼Œå°±å¯ä»¥æ ‡è®°ä¸»èŠ‚ç‚¹ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€äº†ã€‚è¿™ 2 å¼ èµæˆç¥¨åŒ…æ‹¬å“¨å…µè‡ªå·±çš„ä¸€å¼ èµæˆç¥¨å’Œå¦å¤–ä¸¤ä¸ªå“¨å…µçš„èµæˆç¥¨ã€‚</p><p>PSï¼šquorum çš„å€¼ä¸€èˆ¬è®¾ç½®ä¸ºå“¨å…µä¸ªæ•°çš„äºŒåˆ†ä¹‹ä¸€åŠ  1ï¼Œä¾‹å¦‚ 3 ä¸ªå“¨å…µå°±è®¾ç½® 2ã€‚</p><p>å“¨å…µåˆ¤æ–­å®Œä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿åï¼Œå“¨å…µå°±è¦å¼€å§‹åœ¨å¤šä¸ªã€Œä»èŠ‚ç‚¹ã€ä¸­ï¼Œé€‰å‡ºä¸€ä¸ªä»èŠ‚ç‚¹æ¥åšæ–°ä¸»èŠ‚ç‚¹ã€‚</p><p>ğŸ”´ğŸŸ¡ğŸŸ¢<strong>æ€»ç»“</strong>ï¼š</p><blockquote><p>å…¶å®å°±æ˜¯é€šè¿‡å“¨å…µé›†ç¾¤ï¼Œè¶…è¿‡åŠæ•°çš„å“¨å…µèŠ‚ç‚¹è®¤ä¸ºä¸»æœåŠ¡å™¨æ•…éšœï¼Œé‚£ä¹ˆå°±è®¤ä¸ºå…¶çœŸçš„æ•…éšœäº†ã€‚</p></blockquote><h3 id="ç”±å“ªä¸ªå“¨å…µè¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»ï¼Ÿ"><a href="#ç”±å“ªä¸ªå“¨å…µè¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»ï¼Ÿ" class="headerlink" title="ç”±å“ªä¸ªå“¨å…µè¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»ï¼Ÿ"></a>ç”±å“ªä¸ªå“¨å…µè¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»ï¼Ÿ</h3><p>å“¨å…µæ˜¯ä»¥å“¨å…µé›†ç¾¤çš„æ–¹å¼å­˜åœ¨çš„ï¼Œéœ€è¦åœ¨å“¨å…µé›†ç¾¤ä¸­é€‰å‡ºä¸€ä¸ª leaderï¼Œè®© leader æ¥æ‰§è¡Œä¸»ä»åˆ‡æ¢ã€‚</p><p>å“ªä¸ªå“¨å…µèŠ‚ç‚¹åˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸ºã€Œå®¢è§‚ä¸‹çº¿ã€ï¼Œè¿™ä¸ªå“¨å…µèŠ‚ç‚¹å°±æ˜¯å€™é€‰è€…ï¼Œæ‰€è°“çš„å€™é€‰è€…å°±æ˜¯æƒ³å½“ Leader çš„å“¨å…µã€‚</p><p>é‚£ä¹ˆåœ¨æŠ•ç¥¨è¿‡ç¨‹ä¸­ï¼Œä»»ä½•ä¸€ä¸ªã€Œå€™é€‰è€…ã€ï¼Œè¦<mark>æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶</mark>ï¼š</p><ul><li>ç¬¬ä¸€ï¼Œæ‹¿åˆ°åŠæ•°ä»¥ä¸Šçš„èµæˆç¥¨ï¼›</li><li>ç¬¬äºŒï¼Œæ‹¿åˆ°çš„ç¥¨æ•°åŒæ—¶è¿˜éœ€è¦å¤§äºç­‰äºå“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum å€¼ã€‚</li></ul><p>å“¨å…µèŠ‚ç‚¹è‡³å°‘è¦æœ‰ 3 ä¸ªï¼Œè€Œä¸”æ˜¯å¥‡æ•°ï¼Œä¸”quorum çš„å€¼å»ºè®®è®¾ç½®ä¸ºå“¨å…µä¸ªæ•°çš„äºŒåˆ†ä¹‹ä¸€åŠ  1ã€‚</p><h3 id="ä¸»ä»æ•…éšœè½¬ç§»çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ"><a href="#ä¸»ä»æ•…éšœè½¬ç§»çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ" class="headerlink" title="ä¸»ä»æ•…éšœè½¬ç§»çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ"></a>ä¸»ä»æ•…éšœè½¬ç§»çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</h3><ol><li>é€‰å‡ºæ–°ä¸»èŠ‚ç‚¹</li></ol><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231101101607619.png" alt="æ‰§è¡Œæµç¨‹å›¾"></p><ul><li>ä¼˜å…ˆçº§åœ¨redis.confä¸­é»˜è®¤ï¼šslave-priority 100ï¼Œå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</li><li>åç§»é‡æ˜¯æŒ‡è·å¾—åŸä¸»æœºæ•°æ®æœ€å…¨çš„</li><li>æ¯ä¸ªrediså®ä¾‹å¯åŠ¨åéƒ½ä¼šéšæœºç”Ÿæˆä¸€ä¸ª40ä½çš„runid</li></ul><ol start="2"><li>ä»èŠ‚ç‚¹æŒ‡å‘æ–°ä¸»èŠ‚ç‚¹</li></ol><p>å½“æ–°ä¸»èŠ‚ç‚¹å‡ºç°ä¹‹åï¼Œå“¨å…µ leader ä¸‹ä¸€æ­¥è¦åšçš„å°±æ˜¯ï¼Œè®©å·²ä¸‹çº¿ä¸»èŠ‚ç‚¹å±ä¸‹çš„æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€æŒ‡å‘ã€Œæ–°ä¸»èŠ‚ç‚¹ã€</p><ol start="3"><li>é€šçŸ¥å®¢æˆ·çš„ä¸»èŠ‚ç‚¹å·²æ›´æ¢</li></ol><p>é€šè¿‡ Redis çš„å‘å¸ƒè€…&#x2F;è®¢é˜…è€…æœºåˆ¶æ¥å®ç°</p><ol start="4"><li>å°†æ—§ä¸»èŠ‚ç‚¹å˜ä¸ºä»èŠ‚ç‚¹</li></ol><p>æ•…éšœè½¬ç§»æ“ä½œæœ€åè¦åšçš„æ˜¯ï¼Œç»§ç»­ç›‘è§†æ—§ä¸»èŠ‚ç‚¹ï¼Œå½“æ—§ä¸»èŠ‚ç‚¹é‡æ–°ä¸Šçº¿æ—¶ï¼Œå“¨å…µé›†ç¾¤å°±ä¼šå‘å®ƒå‘é€ <code>SLAVEOF</code> å‘½ä»¤ï¼Œè®©å®ƒæˆä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ã€‚</p><h3 id="å“¨å…µé›†ç¾¤æ˜¯å¦‚ä½•ç»„æˆçš„ï¼Ÿ"><a href="#å“¨å…µé›†ç¾¤æ˜¯å¦‚ä½•ç»„æˆçš„ï¼Ÿ" class="headerlink" title="å“¨å…µé›†ç¾¤æ˜¯å¦‚ä½•ç»„æˆçš„ï¼Ÿ"></a>å“¨å…µé›†ç¾¤æ˜¯å¦‚ä½•ç»„æˆçš„ï¼Ÿ</h3><p>åœ¨ä¸»ä»é›†ç¾¤ä¸­ï¼Œä¸»èŠ‚ç‚¹ä¸Šæœ‰ä¸€ä¸ªåä¸º<code>__sentinel__:hello</code>çš„é¢‘é“ï¼Œä¸åŒå“¨å…µå°±æ˜¯é€šè¿‡å®ƒæ¥ç›¸äº’å‘ç°ï¼Œå®ç°äº’ç›¸é€šä¿¡çš„ã€‚</p><p>åœ¨ä¸‹å›¾ä¸­ï¼Œå“¨å…µ A æŠŠè‡ªå·±çš„ IP åœ°å€å’Œç«¯å£çš„ä¿¡æ¯å‘å¸ƒåˆ°<code>__sentinel__:hello</code> é¢‘é“ä¸Šï¼Œå“¨å…µ B å’Œ C è®¢é˜…äº†è¯¥é¢‘é“ã€‚é‚£ä¹ˆæ­¤æ—¶ï¼Œå“¨å…µ B å’Œ C å°±å¯ä»¥ä»è¿™ä¸ªé¢‘é“ç›´æ¥è·å–å“¨å…µ A çš„ IP åœ°å€å’Œç«¯å£å·ã€‚ç„¶åï¼Œå“¨å…µ Bã€C å¯ä»¥å’Œå“¨å…µ A å»ºç«‹ç½‘ç»œè¿æ¥ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/a6286053c6884cf58bf397d01674fe80.png" alt="img"></p><p>é€šè¿‡è¿™ä¸ªæ–¹å¼ï¼Œå“¨å…µ B å’Œ C ä¹Ÿå¯ä»¥å»ºç«‹ç½‘ç»œè¿æ¥ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå“¨å…µé›†ç¾¤å°±å½¢æˆäº†ã€‚</p><blockquote><p>å“¨å…µé›†ç¾¤ä¼šå¯¹ã€Œä»èŠ‚ç‚¹ã€çš„è¿è¡ŒçŠ¶æ€è¿›è¡Œç›‘æ§ï¼Œé‚£å“¨å…µé›†ç¾¤å¦‚ä½•çŸ¥é“ã€Œä»èŠ‚ç‚¹ã€çš„ä¿¡æ¯ï¼Ÿ</p></blockquote><p>ä¸»èŠ‚ç‚¹çŸ¥é“æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€çš„ä¿¡æ¯ï¼Œ<strong>æ‰€ä»¥å“¨å…µä¼šæ¯ 10 ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘ä¸»èŠ‚ç‚¹å‘é€ INFO å‘½ä»¤æ¥è·å–æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€çš„ä¿¡æ¯ã€‚</strong></p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå“¨å…µ B ç»™ä¸»èŠ‚ç‚¹å‘é€ INFO å‘½ä»¤ï¼Œä¸»èŠ‚ç‚¹æ¥å—åˆ°è¿™ä¸ªå‘½ä»¤åï¼Œå°±ä¼šæŠŠä»èŠ‚ç‚¹åˆ—è¡¨è¿”å›ç»™å“¨å…µã€‚æ¥ç€ï¼Œå“¨å…µå°±å¯ä»¥æ ¹æ®ä»èŠ‚ç‚¹åˆ—è¡¨ä¸­çš„è¿æ¥ä¿¡æ¯ï¼Œå’Œæ¯ä¸ªä»èŠ‚ç‚¹å»ºç«‹è¿æ¥ï¼Œå¹¶åœ¨è¿™ä¸ªè¿æ¥ä¸ŠæŒç»­åœ°å¯¹ä»èŠ‚ç‚¹è¿›è¡Œç›‘æ§ã€‚å“¨å…µ A å’Œ C å¯ä»¥é€šè¿‡ç›¸åŒçš„æ–¹æ³•å’Œä»èŠ‚ç‚¹å»ºç«‹è¿æ¥ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/fdd5f695bb3643258662886f9fba0aab.png" alt="img"></p><p>æ­£æ˜¯é€šè¿‡ <mark>Redis çš„å‘å¸ƒè€…&#x2F;è®¢é˜…è€…æœºåˆ¶</mark>ï¼Œå“¨å…µä¹‹é—´å¯ä»¥ç›¸äº’æ„ŸçŸ¥ï¼Œç„¶åç»„æˆé›†ç¾¤ï¼ŒåŒæ—¶ï¼Œå“¨å…µåˆé€šè¿‡ INFO å‘½ä»¤ï¼Œåœ¨ä¸»èŠ‚ç‚¹é‡Œè·å¾—äº†æ‰€æœ‰ä»èŠ‚ç‚¹è¿æ¥ä¿¡æ¯ï¼Œäºæ˜¯å°±èƒ½å’Œä»èŠ‚ç‚¹å»ºç«‹è¿æ¥ï¼Œå¹¶è¿›è¡Œç›‘æ§äº†ã€‚</p><h2 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="headerlink" title="é›†ç¾¤"></a>é›†ç¾¤</h2><p>å¾…è¡¥å……ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p><h3 id="é›†ç¾¤è„‘è£‚å¯¼è‡´æ•°æ®ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ"><a href="#é›†ç¾¤è„‘è£‚å¯¼è‡´æ•°æ®ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="é›†ç¾¤è„‘è£‚å¯¼è‡´æ•°æ®ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ"></a>é›†ç¾¤è„‘è£‚å¯¼è‡´æ•°æ®ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ</h3><blockquote><p>ä»€ä¹ˆæ˜¯è„‘è£‚ï¼Ÿ</p></blockquote><p>å…ˆæ¥ç†è§£é›†ç¾¤çš„è„‘è£‚ç°è±¡ï¼Œè¿™å°±å¥½æ¯”ä¸€ä¸ªäººæœ‰ä¸¤ä¸ªå¤§è„‘ï¼Œé‚£ä¹ˆåˆ°åº•å—è°æ§åˆ¶å‘¢ï¼Ÿ</p><p>é‚£ä¹ˆåœ¨ Redis ä¸­ï¼Œé›†ç¾¤è„‘è£‚äº§ç”Ÿæ•°æ®ä¸¢å¤±çš„ç°è±¡æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p><p>åœ¨ Redis ä¸»ä»æ¶æ„ä¸­ï¼Œéƒ¨ç½²æ–¹å¼ä¸€èˆ¬æ˜¯ã€Œä¸€ä¸»å¤šä»ã€ï¼Œä¸»èŠ‚ç‚¹æä¾›å†™æ“ä½œï¼Œä»èŠ‚ç‚¹æä¾›è¯»æ“ä½œã€‚ å¦‚æœä¸»èŠ‚ç‚¹çš„ç½‘ç»œçªç„¶å‘ç”Ÿäº†é—®é¢˜ï¼Œå®ƒä¸æ‰€æœ‰çš„ä»èŠ‚ç‚¹éƒ½å¤±è”äº†ï¼Œä½†æ˜¯æ­¤æ—¶çš„ä¸»èŠ‚ç‚¹å’Œå®¢æˆ·ç«¯çš„ç½‘ç»œæ˜¯æ­£å¸¸çš„ï¼Œè¿™ä¸ªå®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“ Redis å†…éƒ¨å·²ç»å‡ºç°äº†é—®é¢˜ï¼Œè¿˜åœ¨ç…§æ ·çš„å‘è¿™ä¸ªå¤±è”çš„ä¸»èŠ‚ç‚¹å†™æ•°æ®ï¼ˆè¿‡ç¨‹Aï¼‰ï¼Œæ­¤æ—¶è¿™äº›æ•°æ®è¢«æ—§ä¸»èŠ‚ç‚¹ç¼“å­˜åˆ°äº†ç¼“å†²åŒºé‡Œï¼Œå› ä¸ºä¸»ä»èŠ‚ç‚¹ä¹‹é—´çš„ç½‘ç»œé—®é¢˜ï¼Œè¿™äº›æ•°æ®éƒ½æ˜¯æ— æ³•åŒæ­¥ç»™ä»èŠ‚ç‚¹çš„ã€‚</p><p>è¿™æ—¶ï¼Œå“¨å…µä¹Ÿå‘ç°ä¸»èŠ‚ç‚¹å¤±è”äº†ï¼Œå®ƒå°±è®¤ä¸ºä¸»èŠ‚ç‚¹æŒ‚äº†ï¼ˆä½†å®é™…ä¸Šä¸»èŠ‚ç‚¹æ­£å¸¸è¿è¡Œï¼Œåªæ˜¯ç½‘ç»œå‡ºé—®é¢˜äº†ï¼‰ï¼Œäºæ˜¯å“¨å…µå°±ä¼šåœ¨ã€Œä»èŠ‚ç‚¹ã€ä¸­é€‰ä¸¾å‡ºä¸€ä¸ª leader ä½œä¸ºä¸»èŠ‚ç‚¹ï¼Œè¿™æ—¶é›†ç¾¤å°±æœ‰ä¸¤ä¸ªä¸»èŠ‚ç‚¹äº† â€”â€” <strong>è„‘è£‚å‡ºç°äº†</strong>ã€‚</p><p>ç„¶åï¼Œç½‘ç»œçªç„¶å¥½äº†ï¼Œå“¨å…µå› ä¸ºä¹‹å‰å·²ç»é€‰ä¸¾å‡ºä¸€ä¸ªæ–°ä¸»èŠ‚ç‚¹äº†ï¼Œå®ƒå°±ä¼šæŠŠæ—§ä¸»èŠ‚ç‚¹é™çº§ä¸ºä»èŠ‚ç‚¹ï¼ˆAï¼‰ï¼Œç„¶åä»èŠ‚ç‚¹ï¼ˆAï¼‰ä¼šå‘æ–°ä¸»èŠ‚ç‚¹è¯·æ±‚æ•°æ®åŒæ­¥ï¼Œ<strong>å› ä¸ºç¬¬ä¸€æ¬¡åŒæ­¥æ˜¯å…¨é‡åŒæ­¥çš„æ–¹å¼ï¼Œæ­¤æ—¶çš„ä»èŠ‚ç‚¹ï¼ˆAï¼‰ä¼šæ¸…ç©ºæ‰è‡ªå·±æœ¬åœ°çš„æ•°æ®ï¼Œç„¶åå†åšå…¨é‡åŒæ­¥ã€‚æ‰€ä»¥ï¼Œä¹‹å‰å®¢æˆ·ç«¯åœ¨è¿‡ç¨‹ A å†™å…¥çš„æ•°æ®å°±ä¼šä¸¢å¤±äº†ï¼Œä¹Ÿå°±æ˜¯é›†ç¾¤äº§ç”Ÿè„‘è£‚æ•°æ®ä¸¢å¤±çš„é—®é¢˜</strong>ã€‚</p><blockquote><p>ğŸ”´ğŸŸ¢ğŸŸ¡æ€»ç»“ä¸€å¥è¯å°±æ˜¯ï¼šç”±äºç½‘ç»œé—®é¢˜ï¼Œé›†ç¾¤èŠ‚ç‚¹ä¹‹é—´å¤±å»è”ç³»ã€‚ä¸»ä»æ•°æ®ä¸åŒæ­¥ï¼›é‡æ–°å¹³è¡¡é€‰ä¸¾ï¼Œäº§ç”Ÿä¸¤ä¸ªä¸»æœåŠ¡ã€‚ç­‰ç½‘ç»œæ¢å¤ï¼Œæ—§ä¸»èŠ‚ç‚¹ä¼šé™çº§ä¸ºä»èŠ‚ç‚¹ï¼Œå†ä¸æ–°ä¸»èŠ‚ç‚¹è¿›è¡ŒåŒæ­¥å¤åˆ¶çš„æ—¶å€™ï¼Œç”±äºä¼šä»èŠ‚ç‚¹ä¼šæ¸…ç©ºè‡ªå·±çš„ç¼“å†²åŒºï¼Œæ‰€ä»¥å¯¼è‡´ä¹‹å‰å®¢æˆ·ç«¯å†™å…¥çš„æ•°æ®ä¸¢å¤±äº†ã€‚</p></blockquote><p>**è§£å†³æ–¹æ¡ˆ:**å…¶å®éƒ½æ˜¯<mark>é™åˆ¶</mark>ä¸»åº“ä¸å†æ¥æ”¶å®¢æˆ·ç«¯çš„å†™è¯·æ±‚</p><h1 id="åŠŸèƒ½ç¯‡"><a href="#åŠŸèƒ½ç¯‡" class="headerlink" title="åŠŸèƒ½ç¯‡"></a>åŠŸèƒ½ç¯‡</h1><h2 id="è¿‡æœŸåˆ é™¤ç­–ç•¥"><a href="#è¿‡æœŸåˆ é™¤ç­–ç•¥" class="headerlink" title="è¿‡æœŸåˆ é™¤ç­–ç•¥"></a>è¿‡æœŸåˆ é™¤ç­–ç•¥</h2><h3 id="å¦‚ä½•åˆ¤å®š-key-å·²è¿‡æœŸäº†ï¼Ÿ"><a href="#å¦‚ä½•åˆ¤å®š-key-å·²è¿‡æœŸäº†ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ¤å®š key å·²è¿‡æœŸäº†ï¼Ÿ"></a>å¦‚ä½•åˆ¤å®š key å·²è¿‡æœŸäº†ï¼Ÿ</h3><blockquote><p>ğŸ”´ğŸŸ¢ğŸŸ¡ä¸€å¥è¯æ€»ç»“ï¼šè®¾ç½®è¿‡æœŸæ—¶é—´ä¼šå°†è¯¥keyå¸¦ä¸Šè¿‡æœŸæ—¶é—´å­˜å…¥è¿‡æœŸå­—å…¸ï¼ˆå“ˆå¸Œè¡¨ï¼‰ï¼Œåœ¨é‡Œé¢æ ¹æ®keyæ‰¾ä¸åˆ°å°±æ˜¯æ²¡è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ‰¾åˆ°äº†å°±ä¸ç³»ç»Ÿå½“å‰æ—¶é—´è¿›è¡Œæ¯”è¾ƒã€‚</p></blockquote><p>æ¯å½“æˆ‘ä»¬å¯¹ä¸€ä¸ª key è®¾ç½®äº†è¿‡æœŸæ—¶é—´æ—¶ï¼ŒRedis ä¼šæŠŠè¯¥ key å¸¦ä¸Šè¿‡æœŸæ—¶é—´å­˜å‚¨åˆ°ä¸€ä¸ª<mark><strong>è¿‡æœŸå­—å…¸</strong></mark>ï¼ˆexpires dictï¼‰ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ã€Œè¿‡æœŸå­—å…¸ã€ä¿å­˜äº†æ•°æ®åº“ä¸­æ‰€æœ‰ key çš„è¿‡æœŸæ—¶é—´ã€‚</p><p>è¿‡æœŸå­—å…¸å­˜å‚¨åœ¨ redisDb ç»“æ„ä¸­ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">redisDb</span> &#123;</span></span><br><span class="line">    dict *dict;    <span class="comment">/* æ•°æ®åº“é”®ç©ºé—´ï¼Œå­˜æ”¾ç€æ‰€æœ‰çš„é”®å€¼å¯¹ */</span></span><br><span class="line">    dict *expires; <span class="comment">/* é”®çš„è¿‡æœŸæ—¶é—´ */</span></span><br><span class="line">    ....</span><br><span class="line">&#125; redisDb;</span><br></pre></td></tr></table></figure><p>è¿‡æœŸå­—å…¸æ•°æ®ç»“æ„ç»“æ„å¦‚ä¸‹ï¼š</p><ul><li>è¿‡æœŸå­—å…¸çš„ <strong>key</strong> æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æŸä¸ªé”®å¯¹è±¡ï¼›</li><li>è¿‡æœŸå­—å…¸çš„ <strong>value</strong> æ˜¯ä¸€ä¸ª long long ç±»å‹çš„æ•´æ•°ï¼Œè¿™ä¸ªæ•´æ•°ä¿å­˜äº† key çš„è¿‡æœŸæ—¶é—´ï¼›</li></ul><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231107084229499.png" alt="image-20231107084229499"></p><hr><p>å­—å…¸å®é™…ä¸Šæ˜¯<mark>å“ˆå¸Œè¡¨</mark>ï¼Œå“ˆå¸Œè¡¨çš„æœ€å¤§å¥½å¤„å°±æ˜¯è®©æˆ‘ä»¬å¯ä»¥ç”¨ O(1) çš„æ—¶é—´å¤æ‚åº¦æ¥å¿«é€ŸæŸ¥æ‰¾ã€‚å½“æˆ‘ä»¬æŸ¥è¯¢ä¸€ä¸ª key æ—¶ï¼ŒRedis é¦–å…ˆæ£€æŸ¥è¯¥ key æ˜¯å¦å­˜åœ¨äºè¿‡æœŸå­—å…¸ä¸­ï¼š</p><ul><li>å¦‚æœä¸åœ¨ï¼Œåˆ™æ­£å¸¸è¯»å–é”®å€¼ï¼›</li><li>å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šè·å–è¯¥ key çš„è¿‡æœŸæ—¶é—´ï¼Œç„¶åä¸å½“å‰ç³»ç»Ÿæ—¶é—´è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœæ¯”ç³»ç»Ÿæ—¶é—´å¤§ï¼Œé‚£å°±æ²¡æœ‰è¿‡æœŸï¼Œå¦åˆ™åˆ¤å®šè¯¥ key å·²è¿‡æœŸã€‚</li></ul><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231106220549674.png" alt="æµç¨‹å›¾"></p><h3 id="è¿‡æœŸåˆ é™¤ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ"><a href="#è¿‡æœŸåˆ é™¤ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="è¿‡æœŸåˆ é™¤ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ"></a>è¿‡æœŸåˆ é™¤ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</h3><ol><li>å®šæ—¶åˆ é™¤</li></ol><p>å®šæ—¶åˆ é™¤ç­–ç•¥çš„åšæ³•æ˜¯ï¼Œ<strong>åœ¨è®¾ç½® key çš„è¿‡æœŸæ—¶é—´æ—¶ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªå®šæ—¶äº‹ä»¶ï¼Œå½“æ—¶é—´åˆ°è¾¾æ—¶ï¼Œç”±äº‹ä»¶å¤„ç†å™¨è‡ªåŠ¨æ‰§è¡Œ key çš„åˆ é™¤æ“ä½œã€‚</strong></p><p>å®šæ—¶åˆ é™¤ç­–ç•¥çš„<strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>å¯ä»¥ä¿è¯è¿‡æœŸ key ä¼šè¢«å°½å¿«åˆ é™¤ï¼Œä¹Ÿå°±æ˜¯å†…å­˜å¯ä»¥è¢«å°½å¿«åœ°é‡Šæ”¾ã€‚å› æ­¤ï¼Œå®šæ—¶åˆ é™¤å¯¹å†…å­˜æ˜¯æœ€å‹å¥½çš„ã€‚</li></ul><p>å®šæ—¶åˆ é™¤ç­–ç•¥çš„<strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>åœ¨è¿‡æœŸ key æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œåˆ é™¤è¿‡æœŸ key å¯èƒ½ä¼šå ç”¨ç›¸å½“ä¸€éƒ¨åˆ† CPU æ—¶é—´ï¼Œåœ¨å†…å­˜ä¸ç´§å¼ ä½† CPU æ—¶é—´ç´§å¼ çš„æƒ…å†µä¸‹ï¼Œå°† CPU æ—¶é—´ç”¨äºåˆ é™¤å’Œå½“å‰ä»»åŠ¡æ— å…³çš„è¿‡æœŸé”®ä¸Šï¼Œæ— ç–‘ä¼šå¯¹æœåŠ¡å™¨çš„å“åº”æ—¶é—´å’Œååé‡é€ æˆå½±å“ã€‚æ‰€ä»¥ï¼Œå®šæ—¶åˆ é™¤ç­–ç•¥å¯¹ CPU ä¸å‹å¥½ã€‚</li></ul><ol start="2"><li>æƒ°æ€§åˆ é™¤</li></ol><p>æƒ°æ€§åˆ é™¤ç­–ç•¥çš„åšæ³•æ˜¯ï¼Œ<strong>ä¸ä¸»åŠ¨åˆ é™¤è¿‡æœŸé”®ï¼Œæ¯æ¬¡ä»æ•°æ®åº“è®¿é—® key æ—¶ï¼Œéƒ½æ£€æµ‹ key æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™åˆ é™¤è¯¥ keyã€‚</strong></p><ul><li>æƒ°æ€§åˆ é™¤ç­–ç•¥çš„<strong>ä¼˜ç‚¹</strong>ï¼š</li></ul><p>å› ä¸ºæ¯æ¬¡è®¿é—®æ—¶ï¼Œæ‰ä¼šæ£€æŸ¥ key æ˜¯å¦è¿‡æœŸï¼Œæ‰€ä»¥æ­¤ç­–ç•¥åªä¼šä½¿ç”¨å¾ˆå°‘çš„ç³»ç»Ÿèµ„æºï¼Œå› æ­¤ï¼Œæƒ°æ€§åˆ é™¤ç­–ç•¥å¯¹ CPU æ—¶é—´æœ€å‹å¥½ã€‚</p><ul><li>æƒ°æ€§åˆ é™¤ç­–ç•¥çš„<strong>ç¼ºç‚¹</strong>ï¼š</li></ul><p>å¦‚æœä¸€ä¸ª key å·²ç»è¿‡æœŸï¼Œè€Œè¿™ä¸ª key åˆä»ç„¶ä¿ç•™åœ¨æ•°æ®åº“ä¸­ï¼Œé‚£ä¹ˆåªè¦è¿™ä¸ªè¿‡æœŸ key ä¸€ç›´æ²¡æœ‰è¢«è®¿é—®ï¼Œå®ƒæ‰€å ç”¨çš„å†…å­˜å°±ä¸ä¼šé‡Šæ”¾ï¼Œé€ æˆäº†ä¸€å®šçš„å†…å­˜ç©ºé—´æµªè´¹ã€‚æ‰€ä»¥ï¼Œæƒ°æ€§åˆ é™¤ç­–ç•¥å¯¹å†…å­˜ä¸å‹å¥½ã€‚</p><ol start="3"><li>å®šæœŸåˆ é™¤</li></ol><p>å®šæœŸåˆ é™¤ç­–ç•¥çš„åšæ³•æ˜¯ï¼Œ<strong>æ¯éš”ä¸€æ®µæ—¶é—´ã€Œéšæœºã€ä»æ•°æ®åº“ä¸­å–å‡ºä¸€å®šæ•°é‡çš„ key è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶åˆ é™¤å…¶ä¸­çš„è¿‡æœŸkeyã€‚</strong></p><blockquote><p>ç‰¹åˆ«å¼ºè°ƒä¸‹ï¼Œæ¯æ¬¡æ£€æŸ¥æ•°æ®åº“å¹¶<mark>ä¸æ˜¯éå†è¿‡æœŸå­—å…¸</mark>ä¸­çš„æ‰€æœ‰ keyï¼Œè€Œæ˜¯ä»<mark>æ•°æ®åº“ä¸­éšæœºæŠ½å–</mark>ä¸€å®šæ•°é‡çš„ key è¿›è¡Œè¿‡æœŸæ£€æŸ¥ã€‚</p></blockquote><p>å®šæœŸåˆ é™¤ç­–ç•¥çš„<strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>é€šè¿‡é™åˆ¶åˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡ï¼Œæ¥å‡å°‘åˆ é™¤æ“ä½œå¯¹ CPU çš„å½±å“ï¼ŒåŒæ—¶ä¹Ÿèƒ½åˆ é™¤ä¸€éƒ¨åˆ†è¿‡æœŸçš„æ•°æ®å‡å°‘äº†è¿‡æœŸé”®å¯¹ç©ºé—´çš„æ— æ•ˆå ç”¨ã€‚</li></ul><p>å®šæœŸåˆ é™¤ç­–ç•¥çš„<strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>å†…å­˜æ¸…ç†æ–¹é¢æ²¡æœ‰å®šæ—¶åˆ é™¤æ•ˆæœå¥½ï¼ŒåŒæ—¶æ²¡æœ‰æƒ°æ€§åˆ é™¤ä½¿ç”¨çš„ç³»ç»Ÿèµ„æºå°‘ã€‚</li><li>éš¾ä»¥ç¡®å®šåˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡ã€‚å¦‚æœæ‰§è¡Œçš„å¤ªé¢‘ç¹ï¼Œå®šæœŸåˆ é™¤ç­–ç•¥å˜å¾—å’Œå®šæ—¶åˆ é™¤ç­–ç•¥ä¸€æ ·ï¼Œå¯¹CPUä¸å‹å¥½ï¼›å¦‚æœæ‰§è¡Œçš„å¤ªå°‘ï¼Œé‚£åˆå’Œæƒ°æ€§åˆ é™¤ä¸€æ ·äº†ï¼Œè¿‡æœŸ key å ç”¨çš„å†…å­˜ä¸ä¼šåŠæ—¶å¾—åˆ°é‡Šæ”¾ã€‚</li></ul><p>ğŸŒˆè¡¥å……ï¼š</p><p>Redisä¼šè®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡serverCron()ï¼ŒæŒ‰ç…§server.hzçš„é¢‘ç‡æ¥æ‰§è¡Œè¿‡æœŸkeyæ¸…ç†ï¼Œæ¨¡å¼ä¸ºSLOW</p><p>Redisçš„æ¯ä¸ªäº‹ä»¶å¾ªç¯å‰ä¼šè°ƒç”¨beforesleep()å‡½æ•°ï¼Œæ‰§è¡Œè¿‡æœŸkeyæ¸…ç†ï¼Œæ¨¡å¼ä¸ºFAST</p><p>SLowæ¨¡å¼è§„åˆ™:</p><ol><li>æ‰§è¡Œé¢‘ç‡å—server.hzå½±å“ï¼Œé»˜è®¤ä¸º10ï¼Œå³æ¯ç§’æ‰§è¡Œ10æ¬¡ï¼Œæ¯ä¸ªæ‰§è¡Œå‘¨æœŸ100msã€‚</li><li>æ‰§è¡Œæ¸…ç†è€—æ—¶ä¸è¶…è¿‡ä¸€æ¬¡æ‰§è¡Œå‘¨æœŸçš„25%</li><li>é€ä¸ªéå†dbï¼Œé€ä¸ªéå†dbä¸­çš„bucketï¼ŒæŠ½å–20ä¸ªkeyåˆ¤æ–­æ˜¯å¦è¿‡æœŸ</li><li>å¦‚æœæ²¡è¾¾åˆ°æ—¶é—´ä¸Šé™ (25ms)å¹¶ä¸”è¿‡æœŸkeyæ¯”ä¾‹å¤§äº10%ï¼Œå†è¿›è¡Œä¸€æ¬¡æŠ½æ ·ï¼Œå¦åˆ™ç»“æŸ</li></ol><p>FASTæ¨¡å¼è§„åˆ™(è¿‡æœŸkeyæ¯”ä¾‹å°äº10%ä¸æ‰§è¡Œ):</p><ol><li>æ‰§è¡Œé¢‘ç‡å—beforesleep()è°ƒç”¨é¢‘ç‡å½±å“ï¼Œä½†ä¸¤æ¬¡FASTæ¨¡å¼é—´éš”ä¸ä½äº2ms</li><li>æ‰§è¡Œæ¸…ç†è€—æ—¶ä¸è¶…è¿‡1ms</li><li>é€ä¸ªéå†dbï¼Œé€ä¸ªéå†dbä¸­çš„bucketï¼ŒæŠ½å–20ä¸ªkeyåˆ¤æ–­æ˜¯å¦è¿‡æœŸ</li><li>å¦‚æœæ²¡è¾¾åˆ°æ—¶é—´ä¸Šé™(1ms)å¹¶ä¸”è¿‡æœŸkeyæ¯”ä¾‹å¤§äº10%ï¼Œå†è¿›è¡Œä¸€æ¬¡æŠ½æ ·ï¼Œå¦åˆ™ç»“æŸ</li></ol><h3 id="Redis-è¿‡æœŸåˆ é™¤ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Redis-è¿‡æœŸåˆ é™¤ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Redis è¿‡æœŸåˆ é™¤ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Redis è¿‡æœŸåˆ é™¤ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p><strong>Redis é€‰æ‹©<mark>ã€Œæƒ°æ€§åˆ é™¤+å®šæœŸåˆ é™¤ã€</mark>è¿™ä¸¤ç§ç­–ç•¥é…å’Œä½¿ç”¨</strong>ï¼Œä»¥æ±‚åœ¨åˆç†ä½¿ç”¨ CPU æ—¶é—´å’Œé¿å…å†…å­˜æµªè´¹ä¹‹é—´å–å¾—å¹³è¡¡ã€‚</p><h2 id="å†…å­˜æ·˜æ±°ç­–ç•¥"><a href="#å†…å­˜æ·˜æ±°ç­–ç•¥" class="headerlink" title="å†…å­˜æ·˜æ±°ç­–ç•¥"></a>å†…å­˜æ·˜æ±°ç­–ç•¥</h2><p>å½“ Redis çš„è¿è¡Œå†…å­˜å·²ç»è¶…è¿‡ Redis è®¾ç½®çš„æœ€å¤§å†…å­˜ä¹‹åï¼Œåˆ™ä¼šä½¿ç”¨å†…å­˜æ·˜æ±°ç­–ç•¥åˆ é™¤ç¬¦åˆæ¡ä»¶çš„ key</p><h3 id="Redis-å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ"><a href="#Redis-å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="Redis å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ"></a>Redis å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</h3><p>Redisæ”¯æŒ8ç§ä¸åŒç­–ç•¥æ¥é€‰æ‹©è¦åˆ é™¤çš„keyï¼š</p><ol><li><p>noevictionï¼š ä¸æ·˜æ±°ä»»ä½•keyï¼Œä½†æ˜¯å†…å­˜æ»¡æ—¶ä¸å…è®¸å†™å…¥æ–°æ•°æ®ï¼Œé»˜è®¤å°±æ˜¯è¿™ç§ç­–ç•¥ã€‚</p></li><li><p>volatile-ttlï¼š å¯¹è®¾ç½®äº†TTLçš„keyï¼Œæ¯”è¾ƒkeyçš„å‰©ä½™TTLå€¼ï¼ŒTTLè¶Šå°è¶Šå…ˆè¢«æ·˜æ±°</p></li></ol><blockquote><p>ç¬¬2ç‚¹è¡¥å……ï¼šå½“è¿è¡Œå†…å­˜è¶…è¿‡æœ€å¤§è®¾ç½®å†…å­˜æ—¶ï¼Œä¸æ·˜æ±°ä»»ä½•æ•°æ®ï¼Œä½†æ–°å¢æ“ä½œä¼šæŠ¥é”™ã€‚</p></blockquote><ol start="3"><li><p>allkeys-randomï¼šå¯¹å…¨ä½“key ï¼Œéšæœºè¿›è¡Œæ·˜æ±°ã€‚ä¹Ÿå°±æ˜¯ç›´æ¥ä»db-&gt;dictä¸­éšæœºæŒ‘é€‰</p></li><li><p>volatile-randomï¼šå¯¹è®¾ç½®äº†TTLçš„key ï¼Œéšæœºè¿›è¡Œæ·˜æ±°ã€‚ä¹Ÿå°±æ˜¯ä»db-&gt;expiresä¸­éšæœºæŒ‘é€‰ã€‚</p></li><li><p>allkeys-lruï¼š å¯¹å…¨ä½“keyï¼ŒåŸºäºLRUç®—æ³•è¿›è¡Œæ·˜æ±°</p></li><li><p>volatile-lruï¼š å¯¹è®¾ç½®äº†TTLçš„keyï¼ŒåŸºäºLRUç®—æ³•è¿›è¡Œæ·˜æ±°</p></li><li><p>allkeys-lfuï¼š å¯¹å…¨ä½“keyï¼ŒåŸºäºLFUç®—æ³•è¿›è¡Œæ·˜æ±°</p></li><li><p>volatile-lfuï¼š å¯¹è®¾ç½®äº†TTLçš„keyï¼ŒåŸºäºLFUç®—æ³•è¿›è¡Œæ·˜æ±°</p></li></ol><p>æ·˜æ±°ç­–ç•¥æµç¨‹ï¼š</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20231107112532443.png" alt="æ·˜æ±°ç­–ç•¥æµç¨‹"></p><h3 id="LRU-ç®—æ³•å’Œ-LFU-ç®—æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#LRU-ç®—æ³•å’Œ-LFU-ç®—æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="LRU ç®—æ³•å’Œ LFU ç®—æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>LRU ç®—æ³•å’Œ LFU ç®—æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>ğŸ”´ğŸŸ¢ğŸŸ¡ä¸€å¥è¯æ€»ç»“ï¼š</p><p>LRUï¼šæœ€åä¸€æ¬¡è®¿é—®æ—¶é—´éš”å¾—è¶Šä¹…ï¼Œè¿™ä¸ªæ·˜æ±°ä¼˜å…ˆçº§è¶Šé«˜</p><p>LFUï¼šæœ€å°‘é¢‘ç‡ä½¿ç”¨ï¼Œé¢‘ç‡è¶Šä½ï¼Œæ·˜æ±°ä¼˜å…ˆçº§è¶Šé«˜</p><hr><p>Redis å¯¹è±¡å¤´ä¸­çš„ lru å­—æ®µï¼Œåœ¨ LRU ç®—æ³•ä¸‹å’Œ LFU ç®—æ³•ä¸‹ä½¿ç”¨æ–¹å¼å¹¶ä¸ç›¸åŒã€‚</p><p><strong>åœ¨ LRU ç®—æ³•ä¸­</strong>ï¼ŒRedis å¯¹è±¡å¤´çš„ 24 bits çš„ lru å­—æ®µæ˜¯ç”¨æ¥è®°å½• key çš„è®¿é—®æ—¶é—´æˆ³ï¼Œå› æ­¤åœ¨ LRU æ¨¡å¼ä¸‹ï¼ŒRediså¯ä»¥æ ¹æ®å¯¹è±¡å¤´ä¸­çš„ lru å­—æ®µè®°å½•çš„å€¼ï¼Œæ¥æ¯”è¾ƒæœ€åä¸€æ¬¡ key çš„è®¿é—®æ—¶é—´é•¿ï¼Œä»è€Œæ·˜æ±°æœ€ä¹…æœªè¢«ä½¿ç”¨çš„ keyã€‚</p><p><strong>åœ¨ LFU ç®—æ³•ä¸­</strong>ï¼ŒRediså¯¹è±¡å¤´çš„ 24 bits çš„ lru å­—æ®µè¢«åˆ†æˆä¸¤æ®µæ¥å­˜å‚¨ï¼Œé«˜ 16bit å­˜å‚¨ ldt(Last Decrement Time)ï¼Œä½ 8bit å­˜å‚¨ logc(Logistic Counter)ã€‚</p><p><img src="/../assets/Redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/lru%E5%AD%97%E6%AE%B5.png" alt="img"></p><ul><li>ldt æ˜¯ç”¨æ¥è®°å½• key çš„è®¿é—®æ—¶é—´æˆ³ï¼›</li><li>logc æ˜¯ç”¨æ¥è®°å½• key çš„è®¿é—®é¢‘æ¬¡ï¼Œå®ƒçš„å€¼è¶Šå°è¡¨ç¤ºä½¿ç”¨é¢‘ç‡è¶Šä½ï¼Œè¶Šå®¹æ˜“æ·˜æ±°ï¼Œæ¯ä¸ªæ–°åŠ å…¥çš„ key çš„logc åˆå§‹å€¼ä¸º 5ã€‚</li></ul><p>æ³¨æ„ï¼Œlogc å¹¶ä¸æ˜¯å•çº¯çš„è®¿é—®æ¬¡æ•°ï¼Œè€Œæ˜¯è®¿é—®é¢‘æ¬¡ï¼ˆè®¿é—®é¢‘ç‡ï¼‰ï¼Œå› ä¸º <strong>logc ä¼šéšæ—¶é—´æ¨ç§»è€Œè¡°å‡çš„</strong>ã€‚</p><p>åœ¨æ¯æ¬¡ key è¢«è®¿é—®æ—¶ï¼Œä¼šå…ˆå¯¹ logc åšä¸€ä¸ªè¡°å‡æ“ä½œï¼Œè¡°å‡çš„å€¼è·Ÿå‰åè®¿é—®æ—¶é—´çš„å·®è·æœ‰å…³ç³»ï¼Œå¦‚æœä¸Šä¸€æ¬¡è®¿é—®çš„æ—¶é—´ä¸è¿™ä¸€æ¬¡è®¿é—®çš„æ—¶é—´å·®è·å¾ˆå¤§ï¼Œé‚£ä¹ˆè¡°å‡çš„å€¼å°±è¶Šå¤§ï¼Œè¿™æ ·å®ç°çš„ LFU ç®—æ³•æ˜¯æ ¹æ®<strong>è®¿é—®é¢‘ç‡</strong>æ¥æ·˜æ±°æ•°æ®çš„ï¼Œè€Œä¸åªæ˜¯è®¿é—®æ¬¡æ•°ã€‚è®¿é—®é¢‘ç‡éœ€è¦è€ƒè™‘ key çš„è®¿é—®æ˜¯å¤šé•¿æ—¶é—´æ®µå†…å‘ç”Ÿçš„ã€‚key çš„å…ˆå‰è®¿é—®è·ç¦»å½“å‰æ—¶é—´è¶Šé•¿ï¼Œé‚£ä¹ˆè¿™ä¸ª key çš„è®¿é—®é¢‘ç‡ç›¸åº”åœ°ä¹Ÿå°±ä¼šé™ä½ï¼Œè¿™æ ·è¢«æ·˜æ±°çš„æ¦‚ç‡ä¹Ÿä¼šæ›´å¤§ã€‚</p><p>å¯¹ logc åšå®Œè¡°å‡æ“ä½œåï¼Œå°±å¼€å§‹å¯¹ logc è¿›è¡Œå¢åŠ æ“ä½œï¼Œå¢åŠ æ“ä½œå¹¶ä¸æ˜¯å•çº¯çš„ + 1ï¼Œè€Œæ˜¯æ ¹æ®æ¦‚ç‡å¢åŠ ï¼Œå¦‚æœ logc è¶Šå¤§çš„ keyï¼Œå®ƒçš„ logc å°±è¶Šéš¾å†å¢åŠ ã€‚</p><p>æ‰€ä»¥ï¼ŒRedis åœ¨è®¿é—® key æ—¶ï¼Œå¯¹äº logc æ˜¯è¿™æ ·å˜åŒ–çš„ï¼š</p><ol><li>å…ˆæŒ‰ç…§ä¸Šæ¬¡è®¿é—®è·ç¦»å½“å‰çš„æ—¶é•¿ï¼Œæ¥å¯¹ logc è¿›è¡Œè¡°å‡ï¼›</li><li>ç„¶åï¼Œå†æŒ‰ç…§ä¸€å®šæ¦‚ç‡å¢åŠ  logc çš„å€¼</li></ol><h1 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h1><h2 id="redisè¯»å–äº‹ä»¶é‡‡ç”¨çš„æ–¹å¼ï¼Ÿ-ä»€ä¹ˆæ˜¯é˜»å¡è¯»ï¼Œéé˜»å¡è¯»ï¼Œå¼‚æ­¥è¯»ï¼Ÿ"><a href="#redisè¯»å–äº‹ä»¶é‡‡ç”¨çš„æ–¹å¼ï¼Ÿ-ä»€ä¹ˆæ˜¯é˜»å¡è¯»ï¼Œéé˜»å¡è¯»ï¼Œå¼‚æ­¥è¯»ï¼Ÿ" class="headerlink" title="redisè¯»å–äº‹ä»¶é‡‡ç”¨çš„æ–¹å¼ï¼Ÿ ä»€ä¹ˆæ˜¯é˜»å¡è¯»ï¼Œéé˜»å¡è¯»ï¼Œå¼‚æ­¥è¯»ï¼Ÿ"></a>redisè¯»å–äº‹ä»¶é‡‡ç”¨çš„æ–¹å¼ï¼Ÿ ä»€ä¹ˆæ˜¯é˜»å¡è¯»ï¼Œéé˜»å¡è¯»ï¼Œå¼‚æ­¥è¯»ï¼Ÿ</h2><p>åœ¨ Redis ä¸­ï¼Œè¯»å–äº‹ä»¶é‡‡ç”¨çš„æ–¹å¼ä¸»è¦æ˜¯<strong>é˜»å¡è¯»</strong>ã€‚ä¸‹é¢ç®€è¦è§£é‡Šé˜»å¡è¯»ã€éé˜»å¡è¯»å’Œå¼‚æ­¥è¯»ï¼š</p><h3 id="é˜»å¡è¯»ï¼ˆBlocking-Readï¼‰"><a href="#é˜»å¡è¯»ï¼ˆBlocking-Readï¼‰" class="headerlink" title="é˜»å¡è¯»ï¼ˆBlocking Readï¼‰"></a>é˜»å¡è¯»ï¼ˆBlocking Readï¼‰</h3><p>é˜»å¡è¯»æ˜¯æŒ‡å½“æ²¡æœ‰æ•°æ®å¯è¯»æ—¶ï¼Œè¯»å–æ“ä½œä¼šé˜»å¡å½“å‰çº¿ç¨‹æˆ–è¿›ç¨‹ï¼Œç›´åˆ°æœ‰æ•°æ®å¯è¯»æˆ–è€…è¶…æ—¶ä¸ºæ­¢ã€‚åœ¨ Redis ä¸­ï¼Œå½“å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªè¯»å–æ“ä½œï¼ˆæ¯”å¦‚ <code>GET</code>ï¼‰ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®å¯è¯»ï¼ŒRedis ä¼šé˜»å¡è¯¥å®¢æˆ·ç«¯è¿æ¥ï¼Œç›´åˆ°æœ‰æ•°æ®å¯è¯»æˆ–è€…è¶…æ—¶ã€‚é˜»å¡è¯»ä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥è½»æ¾åœ°ç­‰å¾…æ•°æ®çš„åˆ°è¾¾ï¼Œä¸éœ€è¦é¢‘ç¹åœ°è¿›è¡Œè½®è¯¢ã€‚</p><h3 id="éé˜»å¡è¯»ï¼ˆNon-blocking-Readï¼‰"><a href="#éé˜»å¡è¯»ï¼ˆNon-blocking-Readï¼‰" class="headerlink" title="éé˜»å¡è¯»ï¼ˆNon-blocking Readï¼‰"></a>éé˜»å¡è¯»ï¼ˆNon-blocking Readï¼‰</h3><p>éé˜»å¡è¯»æ˜¯æŒ‡è¯»å–æ“ä½œä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹æˆ–è¿›ç¨‹ï¼Œå³ä½¿æ²¡æœ‰æ•°æ®å¯è¯»ã€‚åœ¨ Redis ä¸­ï¼Œä½¿ç”¨éé˜»å¡è¯»çš„æ–¹å¼ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è®¾ç½®éé˜»å¡é€‰é¡¹ï¼Œåœ¨æ²¡æœ‰æ•°æ®å¯è¯»æ—¶ç«‹å³è¿”å›ï¼Œä¸ä¼šç­‰å¾…æ•°æ®çš„åˆ°è¾¾ã€‚å®¢æˆ·ç«¯å¯ä»¥<strong>å‘¨æœŸæ€§åœ°è½®è¯¢æ•°æ®æ˜¯å¦å¯è¯»</strong>ã€‚</p><h3 id="å¼‚æ­¥è¯»ï¼ˆAsynchronous-Readï¼‰"><a href="#å¼‚æ­¥è¯»ï¼ˆAsynchronous-Readï¼‰" class="headerlink" title="å¼‚æ­¥è¯»ï¼ˆAsynchronous Readï¼‰"></a>å¼‚æ­¥è¯»ï¼ˆAsynchronous Readï¼‰</h3><p>å¼‚æ­¥è¯»æ˜¯æŒ‡è¯»å–æ“ä½œä¼šç«‹å³è¿”å›ï¼Œè€Œä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹æˆ–è¿›ç¨‹ï¼Œä½†æ˜¯éœ€è¦æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°æˆ–è€…é‡‡ç”¨äº‹ä»¶é©±åŠ¨çš„æ–¹å¼ï¼Œåœ¨æ•°æ®å‡†å¤‡å¥½åè¿›è¡Œé€šçŸ¥æˆ–è€…å¤„ç†ã€‚åœ¨ Redis ä¸­ï¼Œå¼‚æ­¥è¯»å¯ä»¥é€šè¿‡äº‹ä»¶é©±åŠ¨æœºåˆ¶æ¥å®ç°ï¼Œå½“æ•°æ®å‡†å¤‡å¥½æ—¶ï¼ŒRedis ä¼šé€šçŸ¥å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯åœ¨æ¥æ”¶åˆ°é€šçŸ¥åè¿›è¡Œæ•°æ®è¯»å–æˆ–å¤„ç†ã€‚</p><p><strong>æ€»ç»“æ¥è¯´ï¼Œé˜»å¡è¯»é€‚ç”¨äºéœ€è¦<mark>å®æ—¶è·å–æ•°æ®</mark>å¹¶ä¸”æ²¡æœ‰å…¶ä»–ä»»åŠ¡çš„åœºæ™¯ï¼Œéé˜»å¡è¯»é€‚ç”¨äºéœ€è¦<mark>åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡</mark>æˆ–è€…éœ€è¦å®šæ—¶è½®è¯¢çš„åœºæ™¯ï¼Œè€Œå¼‚æ­¥è¯»é€‚ç”¨äºéœ€è¦<mark>æ›´é«˜å¹¶å‘æ€§</mark>å’Œæ›´çµæ´»çš„äº‹ä»¶å¤„ç†çš„åœºæ™¯ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ ¹æ®ä¸åŒçš„éœ€æ±‚å’Œåœºæ™¯é€‰æ‹©åˆé€‚çš„è¯»å–æ–¹å¼å¯ä»¥æé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œæ•ˆç‡ã€‚</strong></p><p>åœ¨ Redis ä¸­ï¼Œ<mark><strong>è¯»å–äº‹ä»¶</strong></mark>æŒ‡çš„æ˜¯å®¢æˆ·ç«¯å‘ Redis æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œå¹¶ä¸”æœåŠ¡å™¨éœ€è¦è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ã€‚è¿™äº›è¯·æ±‚å¯ä»¥<mark><strong>åŒ…æ‹¬è¯»å–æ“ä½œï¼ˆå¦‚ GETï¼‰ã€è®¢é˜…&#x2F;å‘å¸ƒæ“ä½œï¼ˆå¦‚ SUBSCRIBEã€PUBLISHï¼‰ç­‰ã€‚</strong></mark>è¯»å–äº‹ä»¶æ˜¯ Redis æœåŠ¡å™¨æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚çš„ä¸€ç§äº‹ä»¶ç±»å‹ã€‚</p><p>Redis ä½¿ç”¨äº‹ä»¶é©±åŠ¨çš„æ–¹å¼æ¥å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ã€‚å½“æœ‰å®¢æˆ·ç«¯è¿æ¥åˆ° Redis æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šä¸ºæ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ï¼Œå¹¶ä¸”é€šè¿‡ç›‘å¬è¿™äº›å¥—æ¥å­—æ¥æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚å½“å®¢æˆ·ç«¯å‘é€è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæ£€æµ‹åˆ°å¥—æ¥å­—ä¸Šæœ‰å¯è¯»äº‹ä»¶å‘ç”Ÿï¼Œå¹¶è¿›è¡Œè¯»å–æ“ä½œï¼Œè¯»å–å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚æ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯è¯»å–äº‹ä»¶ã€‚</p><p>è¯»å–äº‹ä»¶çš„å¤„ç†è¿‡ç¨‹ä¸€èˆ¬åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li>æœåŠ¡å™¨é€šè¿‡ç›‘å¬å¥—æ¥å­—æ¥æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ï¼Œå¹¶ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆFile Descriptorï¼‰ã€‚</li><li>å½“æœ‰å®¢æˆ·ç«¯è¿æ¥å‘é€è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæ£€æµ‹åˆ°å¯¹åº”æ–‡ä»¶æè¿°ç¬¦ä¸Šæœ‰å¯è¯»äº‹ä»¶å‘ç”Ÿã€‚</li><li>æœåŠ¡å™¨é€šè¿‡è¯»å–æ–‡ä»¶æè¿°ç¬¦ä¸­çš„æ•°æ®ï¼Œè·å–å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ã€‚</li><li>æœåŠ¡å™¨æ ¹æ®å®¢æˆ·ç«¯è¯·æ±‚çš„ç±»å‹å’Œå†…å®¹è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œæ¯”å¦‚æ‰§è¡Œè¯»å–æ“ä½œã€æ‰§è¡Œå†™å…¥æ“ä½œã€è®¢é˜…&#x2F;å‘å¸ƒæ¶ˆæ¯ç­‰ã€‚</li><li>å¤„ç†å®Œå®¢æˆ·ç«¯è¯·æ±‚åï¼ŒæœåŠ¡å™¨å¯ä»¥å‘å®¢æˆ·ç«¯å‘é€å“åº”æ•°æ®ï¼Œç„¶åç­‰å¾…ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚</li></ol><p>æ€»çš„æ¥è¯´ï¼Œè¯»å–äº‹ä»¶æ˜¯æŒ‡ Redis æœåŠ¡å™¨æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚å¹¶è¯»å–è¯·æ±‚æ•°æ®çš„è¿‡ç¨‹ï¼Œè¿™æ˜¯ Redis æœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„åŸºç¡€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå­¦ä¹ å¹¶éƒ¨ç½²é¡¹ç›®</title>
      <link href="/2023/07/28/Study-Linux%E5%AD%A6%E4%B9%A0%E5%B9%B6%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/"/>
      <url>/2023/07/28/Study-Linux%E5%AD%A6%E4%B9%A0%E5%B9%B6%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="Linuxå¸¸ç”¨å‘½ä»¤"><a href="#Linuxå¸¸ç”¨å‘½ä»¤" class="headerlink" title="Linuxå¸¸ç”¨å‘½ä»¤"></a>Linuxå¸¸ç”¨å‘½ä»¤</h1><h2 id="æ–‡ä»¶ç›®å½•æ“ä½œå‘½ä»¤"><a href="#æ–‡ä»¶ç›®å½•æ“ä½œå‘½ä»¤" class="headerlink" title="æ–‡ä»¶ç›®å½•æ“ä½œå‘½ä»¤"></a>æ–‡ä»¶ç›®å½•æ“ä½œå‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>å‚æ•°</th></tr></thead><tbody><tr><td>pwd</td><td>æŸ¥çœ‹å½“å‰æ‰€åœ¨ç›®å½•</td><td></td></tr><tr><td>touch</td><td>å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™æ–°å»ºä¸€ä¸ªæ–‡ä»¶</td><td></td></tr><tr><td>ls</td><td>æ˜¾ç¤ºæŒ‡å®šç›®å½•ä¸‹çš„å†…å®¹</td><td><code>-a</code>ï¼šæ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶åŠç›®å½•ï¼ˆä»¥<code>.</code>å¼€å¤´çš„éšè—æ–‡ä»¶ä¹Ÿä¼šåˆ—å‡ºï¼‰ <code>-l</code>ï¼šé™¤æ–‡ä»¶åå¤–ï¼Œè¿˜ä¼šè®²æ–‡ä»¶çš„å½¢æ€ã€æƒé™ã€æ‹¥æœ‰è€…ã€æ–‡ä»¶å¤§å°ç­‰è¯¦ç»†ä¿¡æ¯åˆ—å‡ºï¼Œå¯ç®€åŒ–ä¸ºllï¼ˆå¸¸ç”¨ï¼‰</td></tr><tr><td>cat</td><td>ç”¨äºæ˜¾ç¤ºæ–‡ä»¶å†…å®¹</td><td><code>-n</code>ï¼šç”±1å¼€å§‹å¯¹æ‰€æœ‰è¾“å‡ºçš„è¡Œæ•°ç¼–å·</td></tr><tr><td>more</td><td>ä»¥åˆ†é¡µçš„å½¢å¼æ˜¾ç¤ºæ–‡ä»¶å†…å®¹</td><td></td></tr><tr><td>tail</td><td>æŸ¥çœ‹æ–‡ä»¶æœ«å°¾çš„å†…å®¹</td><td><code>-f</code>ï¼šåŠ¨æ€è¯»å–æ–‡ä»¶æœ«å°¾å†…å®¹å¹¶æ˜¾ç¤ºï¼Œé€šå¸¸ç”¨äºæ—¥å¿—æ–‡ä»¶çš„å†…å®¹è¾“å‡º</td></tr><tr><td>mkdir</td><td>åˆ›å»ºç›®å½•</td><td><code>-p</code>ï¼šç¡®ä¿ç›®å½•åç§°å­˜åœ¨ï¼Œä¸å­˜åœ¨çš„å°±åˆ›å»ºä¸€ä¸ªã€‚é€šè¿‡æ­¤é€‰é¡¹ï¼Œå¯ä»¥å®ç°å¤šå±‚ç›®å½•åŒæ—¶åˆ›å»º</td></tr><tr><td>rmdir</td><td>åˆ é™¤ç©ºç›®å½•</td><td><code>-p</code>ï¼šå½“å­ç›®å½•è¢«åˆ é™¤åä½¿çˆ¶ç›®å½•ä¸ºç©ºç›®å½•çš„è¯ï¼Œåˆ™ä¸€å¹¶åˆ é™¤</td></tr><tr><td>rm</td><td>åˆ é™¤æ–‡ä»¶æˆ–è€…ç›®å½•</td><td><code>-r</code>ï¼šå°†ç›®å½•åŠç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶ï¼ˆç›®å½•ï¼‰é€ä¸€åˆ é™¤ï¼Œå³é€’å½’åˆ é™¤ <code>-f</code>ï¼šæ— éœ€ç¡®è®¤ï¼Œç›´æ¥åˆ é™¤</td></tr></tbody></table><h2 id="æ‹·è´ç§»åŠ¨å‘½ä»¤"><a href="#æ‹·è´ç§»åŠ¨å‘½ä»¤" class="headerlink" title="æ‹·è´ç§»åŠ¨å‘½ä»¤"></a>æ‹·è´ç§»åŠ¨å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>å‚æ•°</th></tr></thead><tbody><tr><td>cp</td><td>ç”¨äºå¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•</td><td><code>-r</code>ï¼šå¦‚æœå¤åˆ¶çš„æ˜¯ç›®å½•éœ€è¦ä½¿ç”¨æ­¤é€‰é¡¹ï¼Œæ­¤æ—¶å°†å¤åˆ¶è¯¥ç›®å½•ä¸‹æ‰€æœ‰çš„å­ç›®å½•å’Œæ–‡ä»¶</td></tr><tr><td>mv</td><td>ä¸ºæ–‡ä»¶æˆ–ç›®å½•æ”¹åã€æˆ–å°†æ–‡ä»¶æˆ–ç›®å½•ç§»åŠ¨åˆ°å…¶å®ƒä½ç½®</td><td></td></tr></tbody></table><h2 id="æ‰“åŒ…å‹ç¼©å‘½ä»¤"><a href="#æ‰“åŒ…å‹ç¼©å‘½ä»¤" class="headerlink" title="æ‰“åŒ…å‹ç¼©å‘½ä»¤"></a>æ‰“åŒ…å‹ç¼©å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>å‚æ•°</th></tr></thead><tbody><tr><td>tar</td><td>å¯¹æ–‡ä»¶è¿›è¡Œæ‰“åŒ…ã€è§£åŒ…ã€å‹ç¼©ã€è§£å‹</td><td><code>-z</code>ï¼š ä»£è¡¨çš„æ˜¯gzipï¼Œé€šè¿‡gzipå‘½ä»¤å¤„ç†æ–‡ä»¶ï¼Œgzipå¯ä»¥å¯¹æ–‡ä»¶å‹ç¼©æˆ–è€…è§£å‹ <code>-c</code>ï¼š ä»£è¡¨çš„æ˜¯createï¼Œå³åˆ›å»ºæ–°çš„åŒ…æ–‡ä»¶ <code>-x</code>ï¼š ä»£è¡¨çš„æ˜¯extractï¼Œå®ç°ä»åŒ…æ–‡ä»¶ä¸­è¿˜åŸæ–‡ä»¶ <code>-v</code>ï¼š ä»£è¡¨çš„æ˜¯verboseï¼Œæ˜¾ç¤ºå‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹ <code>-f</code>ï¼š ä»£è¡¨çš„æ˜¯fileï¼Œç”¨äºæŒ‡å®šåŒ…æ–‡ä»¶çš„åç§°     <code>c</code>å’Œ<code>x</code>æ˜¯äº’æ–¥çš„ï¼Œè§£å‹å’Œå‹ç¼©ä¸èƒ½åŒæ—¶è¿›è¡Œ</td></tr></tbody></table><h2 id="æ–‡æœ¬ç¼–è¾‘å‘½ä»¤"><a href="#æ–‡æœ¬ç¼–è¾‘å‘½ä»¤" class="headerlink" title="æ–‡æœ¬ç¼–è¾‘å‘½ä»¤"></a>æ–‡æœ¬ç¼–è¾‘å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>å‚æ•°</th></tr></thead><tbody><tr><td>viã€vim</td><td>å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œç¼–è¾‘</td><td></td></tr></tbody></table><ul><li>è¯´æ˜ï¼š</li></ul><ol><li>åœ¨ä½¿ç”¨vimå‘½ä»¤ç¼–è¾‘æ–‡ä»¶æ—¶ï¼Œå¦‚æœæŒ‡å®šçš„æ–‡ä»¶å­˜åœ¨åˆ™ç›´æ¥æ‰“å¼€æ­¤æ–‡ä»¶ã€‚å¦‚æœæŒ‡å®šçš„æ–‡ä»¶ä¸å­˜åœ¨åˆ™æ–°å»ºæ–‡ä»¶ã€‚</li><li>vimåœ¨è¿›è¡Œæ–‡æœ¬ç¼–è¾‘æ—¶å…±åˆ†ä¸ºä¸‰ç§æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯<code>å‘½ä»¤æ¨¡å¼</code>ï¼ˆCommand modeï¼‰ï¼Œ<code>æ’å…¥æ¨¡å¼</code>ï¼ˆInsert modeï¼‰å’Œ<code>åº•è¡Œæ¨¡å¼</code>ï¼ˆLast line modeï¼‰ã€‚è¿™ä¸‰ç§æ¨¡å¼ä¹‹é—´å¯ä»¥ç›¸äº’åˆ‡æ¢ã€‚æˆ‘ä»¬åœ¨ä½¿ç”¨vimæ—¶ä¸€å®šè¦æ³¨æ„æˆ‘ä»¬å½“å‰æ‰€å¤„çš„æ˜¯å“ªç§æ¨¡å¼ã€‚</li></ol><ul><li>é’ˆå¯¹vimä¸­çš„ä¸‰ç§æ¨¡å¼è¯´æ˜å¦‚ä¸‹ï¼š</li></ul><ol><li>å‘½ä»¤æ¨¡å¼<br>å‘½ä»¤æ¨¡å¼ä¸‹å¯ä»¥æŸ¥çœ‹æ–‡ä»¶å†…å®¹ã€ç§»åŠ¨å…‰æ ‡ï¼ˆä¸Šä¸‹å·¦å³ç®­å¤´ã€<code>gg</code>(å¼€å¤´)ã€<code>G</code>ï¼ˆæœ«å°¾ï¼‰ï¼‰<br>é€šè¿‡vimå‘½ä»¤æ‰“å¼€æ–‡ä»¶åï¼Œé»˜è®¤è¿›å…¥å‘½ä»¤æ¨¡å¼<br>å¦å¤–ä¸¤ç§æ¨¡å¼éœ€è¦é¦–å…ˆè¿›å…¥å‘½ä»¤æ¨¡å¼ï¼Œæ‰èƒ½è¿›å…¥å½¼æ­¤</li><li>æ’å…¥æ¨¡å¼<br>æ’å…¥æ¨¡å¼ä¸‹å¯ä»¥å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œç¼–è¾‘<br>åœ¨å‘½ä»¤æ¨¡å¼ä¸‹æŒ‰ä¸‹[i,a,o]ä»»æ„ä¸€ä¸ªï¼Œå¯ä»¥è¿›å…¥æ’å…¥æ¨¡å¼ã€‚è¿›å…¥æ’å…¥æ¨¡å¼åï¼Œä¸‹æ–¹ä¼šå‡ºç°<code>INSERT</code>å­—æ ·<br>åœ¨æ’å…¥æ¨¡å¼ä¸‹æŒ‰ä¸‹ESCé”®ï¼Œå›åˆ°å‘½ä»¤æ¨¡å¼</li><li>åº•è¡Œæ¨¡å¼<br>åº•è¡Œæ¨¡å¼ä¸‹å¯ä»¥é€šè¿‡å‘½ä»¤å¯¹æ–‡ä»¶å†…å®¹è¿›è¡ŒæŸ¥æ‰¾ã€æ˜¾ç¤ºè¡Œå·ã€é€€å‡ºç­‰æ“ä½œ<br>åœ¨å‘½ä»¤æ¨¡å¼ä¸‹æŒ‰ä¸‹[:,&#x2F;]ä»»æ„ä¸€ä¸ªï¼Œå¯ä»¥è¿›å…¥åº•è¡Œæ¨¡å¼<br>é€šè¿‡ <code>/</code> æ–¹å¼è¿›å…¥åº•è¡Œæ¨¡å¼åï¼Œå¯ä»¥å¯¹æ–‡ä»¶å†…å®¹è¿›è¡ŒæŸ¥æ‰¾<br>é€šè¿‡ <code>:</code> æ–¹å¼è¿›å…¥åº•è¡Œæ¨¡å¼åï¼Œå¯ä»¥è¾“å…¥<code>wq</code>ï¼ˆä¿å­˜å¹¶é€€å‡ºï¼‰ã€<code>qï¼</code>ï¼ˆä¸ä¿å­˜é€€å‡ºï¼‰ã€<code>set nu</code>ï¼ˆæ˜¾ç¤ºè¡Œå·ï¼‰</li></ol><h2 id="æŸ¥æ‰¾å‘½ä»¤"><a href="#æŸ¥æ‰¾å‘½ä»¤" class="headerlink" title="æŸ¥æ‰¾å‘½ä»¤"></a>æŸ¥æ‰¾å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>å‚æ•°</th></tr></thead><tbody><tr><td>find</td><td>åœ¨æŒ‡å®šç›®å½•ä¸‹æŸ¥æ‰¾æ–‡ä»¶</td><td><code>find dirName -option fileName</code></td></tr><tr><td>grep</td><td>ä»æŒ‡å®šæ–‡ä»¶ä¸­æŸ¥æ‰¾æŒ‡å®šçš„æ–‡æœ¬å†…å®¹</td><td><code>grep word fileName</code></td></tr></tbody></table><p><code>grep</code>é€šå¸¸æ­é…ç®¡é“ç¬¦ä½¿ç”¨ä¾‹å¦‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep java</span><br></pre></td></tr></table></figure><h2 id="æƒé™å‘½ä»¤"><a href="#æƒé™å‘½ä»¤" class="headerlink" title="æƒé™å‘½ä»¤"></a>æƒé™å‘½ä»¤</h2><p><img src="/../assets/Linux%E5%AD%A6%E4%B9%A0%E5%B9%B6%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/image-20230728135026495.png" alt="image-20230728135026495"></p><hr><p><img src="/../assets/Linux%E5%AD%A6%E4%B9%A0%E5%B9%B6%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/image-20230728135100975.png" alt="image-20230728135100975"></p><h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><p>echoå‘½ä»¤åœ¨å‘½ä»¤è¡Œå†…è¾“å‡ºæŒ‡å®šå†…å®¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="built_in">pwd</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡å°†å‘½ä»¤ç”¨åå¼•å·ï¼ˆé€šå¸¸ä¹Ÿç§°ä¹‹ä¸ºé£˜å·ï¼‰&#96;å°†å…¶åŒ…å›´ï¼Œè¢«åŒ…å›´çš„å†…å®¹ï¼Œä¼šè¢«ä½œä¸ºå‘½ä»¤æ‰§è¡Œï¼Œè€Œéæ™®é€šå­—ç¬¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> `<span class="built_in">pwd</span>`</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªç‰¹æ®Šç¬¦å·ï¼Œé‡å®šå‘ç¬¦ï¼š&gt;å’Œ&gt;&gt;</p><p><code>&gt;</code>å°†å·¦ä¾§å‘½ä»¤çš„ç»“æœï¼Œè¦†ç›–å†™å…¥åˆ°ç¬¦å·å³ä¾§æŒ‡å®šçš„æ–‡ä»¶ä¸­</p><p><code>&gt;&gt;</code>å°†å·¦ä¾§å‘½ä»¤çš„ç»“æœï¼Œè¿½åŠ å†™å…¥åˆ°ç¬¦å·å³ä¾§æŒ‡å®šçš„æ–‡ä»¶ä¸­</p><h1 id="éƒ¨ç½²é¡¹ç›®"><a href="#éƒ¨ç½²é¡¹ç›®" class="headerlink" title="éƒ¨ç½²é¡¹ç›®"></a>éƒ¨ç½²é¡¹ç›®</h1><h2 id="æ‰‹å·¥éƒ¨ç½²"><a href="#æ‰‹å·¥éƒ¨ç½²" class="headerlink" title="æ‰‹å·¥éƒ¨ç½²"></a>æ‰‹å·¥éƒ¨ç½²</h2><ol><li>ideaä¸Šè¿›è¡Œcleanå’Œpackageæ“ä½œï¼Œæ‰“åŒ…å¥½çš„åŒ…å­˜æ”¾åœ¨targetç›®å½•ä¸‹</li><li>å°†è¯¥jaråŒ…é€šè¿‡finalshellä¸Šä¼ åˆ°linuxä¸Š</li><li>æ‰§è¡Œå‘½ä»¤</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> java -jar xxx.jar &amp;&gt;xxx.log &amp;</span><br></pre></td></tr></table></figure><blockquote><p><code>nohup</code>å‘½ä»¤ç”¨äºä¸æŒ‚æ–­çš„è¿è¡Œç¨‹åºï¼Œ&amp;&gt;åé¢æ˜¯å°†æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ï¼Œæœ€åä¸€ä¸ª&amp;çš„ä½œç”¨æ˜¯è®©ç¨‹åºåœ¨åå°è¿è¡Œ</p></blockquote><ol start="4"><li>ç»“æŸç¨‹åºè¿è¡Œå°±ç»“æŸè¿›ç¨‹å³å¯</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep java <span class="comment">#æ‰¾åˆ°ç›¸å…³è¿›ç¨‹</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -9 è¿›ç¨‹å·  <span class="comment">#ç»“æŸå¯¹åº”è¿›ç¨‹</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linuxå‘½ä»¤ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring SecurityçŸ¥è¯†å­¦ä¹ </title>
      <link href="/2023/07/23/%E9%9D%A2%E8%AF%95-SpringSecurity%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/"/>
      <url>/2023/07/23/%E9%9D%A2%E8%AF%95-SpringSecurity%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="Spring-SecurityåŸç†ç›¸å…³çŸ¥è¯†"><a href="#Spring-SecurityåŸç†ç›¸å…³çŸ¥è¯†" class="headerlink" title="Spring SecurityåŸç†ç›¸å…³çŸ¥è¯†"></a>Spring SecurityåŸç†ç›¸å…³çŸ¥è¯†</h1><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>Spring Securityæ˜¯ä¸€ä¸ªåŸºäºSpringæ¡†æ¶çš„å®‰å…¨æ¡†æ¶ï¼Œä¸»è¦ç”¨äºå¯¹ç”¨æˆ·çš„è®¤è¯æˆæƒç­‰åŠŸèƒ½ã€‚</p><p><strong>è®¤è¯ï¼šéªŒè¯å½“å‰è®¿é—®ç³»ç»Ÿçš„æ˜¯ä¸æ˜¯æœ¬ç³»ç»Ÿçš„ç”¨æˆ·ï¼Œå¹¶ä¸”è¦ç¡®è®¤å…·ä½“æ˜¯å“ªä¸ªç”¨æˆ·</strong></p><p><strong>æˆæƒï¼šç»è¿‡è®¤è¯ååˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è¿›è¡ŒæŸä¸ªæ“ä½œ</strong></p><h2 id="å…·ä½“æµç¨‹"><a href="#å…·ä½“æµç¨‹" class="headerlink" title="å…·ä½“æµç¨‹"></a>å…·ä½“æµç¨‹</h2><ul><li>æµç¨‹å›¾ï¼š</li></ul><p><img src="/../assets/SpringSecurity%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20230723214953358.png" alt="image-20230723214953358"></p><p><strong>Spring Securityçš„åŸç†å…¶å®å°±æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼Œå†…éƒ¨åŒ…å«äº†æä¾›å„ç§åŠŸèƒ½çš„è¿‡æ»¤å™¨ã€‚</strong></p><p><strong>UsernamePasswordAuthenticationFilter</strong>:è´Ÿè´£å¤„ç†æˆ‘ä»¬åœ¨ç™»é™†é¡µé¢å¡«å†™äº†ç”¨æˆ·åå¯†ç åçš„ç™»é™†è¯·æ±‚ã€‚å…¥é—¨æ¡ˆä¾‹çš„è®¤è¯å·¥ä½œä¸»è¦æœ‰å®ƒè´Ÿè´£ã€‚</p><p><strong>ExceptionTranslationFilterï¼š</strong>å¤„ç†è¿‡æ»¤å™¨é“¾ä¸­æŠ›å‡ºçš„ä»»ä½•AccessDeniedExceptionå’ŒAuthenticationException ã€‚</p><p><strong>FilterSecurityInterceptorï¼š</strong>è´Ÿè´£æƒé™æ ¡éªŒçš„æ‹¦æˆªå™¨ã€‚</p><ul><li>è¯¦ç»†æµç¨‹å›¾</li></ul><p><img src="/../assets/SpringSecurity%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/image-20230723215418090.png" alt="image-20230723215418090"></p><p> â­â­</p><p>æ‰€è°“è®¤è¯æˆæƒçš„è¯¦ç»†æµç¨‹ï¼Œå°±æ˜¯ç”¨æˆ·åœ¨ç™»å½•æ—¶æäº¤ç”¨æˆ·åå’Œå¯†ç ï¼ŒUsernamePasswordAuthenticationFilterè¿‡æ»¤å™¨æŠŠç”¨æˆ·åå’Œå¯†ç å°è£…ä¸ºAuthenticationå¯¹è±¡è¿›è¡Œè®¤è¯ï¼Œé€šè¿‡ä¸€ç³»åˆ—è¿‡æ»¤å™¨ï¼Œåœ¨loadUserByUsernameæ–¹æ³•ä¸­ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶å°†ç”¨æˆ·ä¿¡æ¯å’Œè¯¥ç”¨æˆ·çš„æƒé™ä¿¡æ¯ï¼ˆæˆæƒï¼‰ä¸€å¹¶é€šè¿‡å®ç°äº†UserDetailsæ¥å£çš„å®ç°ç±»è¿”å›ï¼Œå¹¶åœ¨è¿”å›ä¸­çš„è¿‡æ»¤å™¨ä¸­è®¾ç½®SecurityContextHolderå­˜æ”¾ç”¨æˆ·çš„æƒé™ä¿¡æ¯ã€‚</p><h2 id="å¸¸è§é¢è¯•é¢˜"><a href="#å¸¸è§é¢è¯•é¢˜" class="headerlink" title="å¸¸è§é¢è¯•é¢˜"></a>å¸¸è§é¢è¯•é¢˜</h2><ol><li>å¦‚ä½•å¯¹å¯†ç è¿›è¡ŒåŠ å¯†</li></ol><blockquote><p>åœ¨ Spring Security ä¸­å¯¹å¯†ç è¿›è¡ŒåŠ å¯†é€šå¸¸ä½¿ç”¨çš„æ˜¯å¯†ç ç¼–ç å™¨ï¼ˆPasswordEncoderï¼‰ã€‚PasswordEncoder çš„ä½œç”¨æ˜¯å°†æ˜æ–‡å¯†ç åŠ å¯†æˆå¯†æ–‡å¯†ç ï¼Œä»¥ä¾¿äºå­˜å‚¨å’Œæ ¡éªŒã€‚Spring Security æä¾›äº†å¤šç§å¸¸è§çš„å¯†ç ç¼–ç å™¨ï¼Œä¾‹å¦‚ BCryptPasswordEncoderã€‚</p></blockquote><ol start="2"><li>SecurityContextHolderä½œç”¨</li></ol><blockquote><p>SecurityContextHolderç”¨äºå­˜å‚¨å®‰å…¨ä¸Šä¸‹æ–‡ï¼ˆsecurity contextï¼‰çš„ä¿¡æ¯ã€‚å½“å‰æ“ä½œçš„ç”¨æˆ·æ˜¯è°ï¼Œè¯¥ç”¨æˆ·æ˜¯å¦å·²ç»è¢«è®¤è¯ï¼Œä»–æ‹¥æœ‰å“ªäº›è§’è‰²æƒé™â€¦è¿™äº›éƒ½è¢«ä¿å­˜åœ¨SecurityContextHolderä¸­ã€‚</p><p>SecurityContextHolderé»˜è®¤ä½¿ç”¨ThreadLocalç­–ç•¥æ¥å­˜å‚¨è®¤è¯ä¿¡æ¯ã€‚çœ‹åˆ°ThreadLocal ä¹Ÿå°±æ„å‘³ç€ï¼Œè¿™æ˜¯ä¸€ç§ä¸çº¿ç¨‹ç»‘å®šçš„ç­–ç•¥ã€‚Spring Securityåœ¨ç”¨æˆ·ç™»å½•æ—¶è‡ªåŠ¨ç»‘å®šè®¤è¯ä¿¡æ¯åˆ°å½“å‰çº¿ç¨‹ï¼Œåœ¨ç”¨æˆ·é€€å‡ºæ—¶ï¼Œè‡ªåŠ¨æ¸…é™¤å½“å‰çº¿ç¨‹çš„è®¤è¯ä¿¡æ¯ã€‚</p></blockquote><ol start="3"><li>Spring Securityæ˜¯å¦‚ä½•å®Œæˆèº«ä»½è®¤è¯çš„ï¼Ÿ</li></ol><blockquote><ol><li><p>ç”¨æˆ·åå’Œå¯†ç è¢«è¿‡æ»¤å™¨è·å–åˆ°ï¼Œå°è£…æˆAuthentication,é€šå¸¸æƒ…å†µä¸‹æ˜¯UsernamePasswordAuthenticationTokenè¿™ä¸ªå®ç°ç±»ã€‚</p></li><li><p>AuthenticationManager èº«ä»½ç®¡ç†å™¨è´Ÿè´£éªŒè¯è¿™ä¸ªAuthentication</p></li><li><p>è®¤è¯æˆåŠŸåï¼ŒAuthenticationManagerèº«ä»½ç®¡ç†å™¨è¿”å›ä¸€ä¸ªè¢«å¡«å……æ»¡äº†ä¿¡æ¯çš„ï¼ˆåŒ…æ‹¬ä¸Šé¢æåˆ°çš„æƒé™ä¿¡æ¯ï¼Œèº«ä»½ä¿¡æ¯ï¼Œç»†èŠ‚ä¿¡æ¯ï¼Œä½†å¯†ç é€šå¸¸ä¼šè¢«ç§»é™¤ï¼‰Authenticationå®ä¾‹ã€‚</p></li><li><p>SecurityContextHolderå®‰å…¨ä¸Šä¸‹æ–‡å®¹å™¨å°†ç¬¬3æ­¥å¡«å……äº†ä¿¡æ¯çš„Authenticationï¼Œé€šè¿‡SecurityContextHolder.getContext().setAuthentication(â€¦)æ–¹æ³•ï¼Œè®¾ç½®åˆ°å…¶ä¸­ã€‚</p></li></ol></blockquote>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç§’æ€å•†åŸï¼ˆspikemallï¼‰</title>
      <link href="/2023/05/27/Project-%E7%A7%92%E6%9D%80%E5%95%86%E5%9F%8E%EF%BC%88spikemall%EF%BC%89/"/>
      <url>/2023/05/27/Project-%E7%A7%92%E6%9D%80%E5%95%86%E5%9F%8E%EF%BC%88spikemall%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="ç§’æ€å•†åŸï¼ˆspikemallï¼‰"><a href="#ç§’æ€å•†åŸï¼ˆspikemallï¼‰" class="headerlink" title="ç§’æ€å•†åŸï¼ˆspikemallï¼‰"></a>ç§’æ€å•†åŸï¼ˆspikemallï¼‰</h1><h2 id="é¡¹ç›®æè¿°"><a href="#é¡¹ç›®æè¿°" class="headerlink" title="é¡¹ç›®æè¿°"></a>é¡¹ç›®æè¿°</h2><p>æœ¬é¡¹ç›®åä¸ºä¸‹å•ç§’æ€é¡¹ç›®ï¼Œä¸»è¦å®ç°äº†ç”¨æˆ·è¿›è¡Œä¸‹å•ç§’æ€çš„æœåŠ¡ï¼Œç”¨æˆ·å¯¹å•†å“è¿›è¡Œä¸‹å•ï¼Œä¼šæœ‰ä¸€ç³»åˆ—çš„å…³äºè®¢å•ï¼Œåº“å­˜ï¼Œè´¦æˆ·ç­‰çš„æ“ä½œï¼Œç”¨æˆ·è¿›è¡Œæ”¯ä»˜ä¹Ÿä¼šæœ‰å¯¹åº”è®¢å•ï¼Œåº“å­˜ï¼Œè´¦æˆ·ç­‰çš„æ“ä½œï¼Œå…¶æ¬¡ä½œä¸ºä¸€ä¸ªå®Œå–„çš„å•†åŸï¼Œè¯¥é¡¹ç›®åŒæ ·ä¹ŸåŒ…å«äº†ç”¨æˆ·çš„æ³¨å†Œï¼Œç™»å½•ï¼Œç™»å‡ºï¼Œä»¥åŠå¯¹å•†å“è¿›è¡ŒæŸ¥çœ‹ç­‰çš„åŠŸèƒ½ã€‚</p><p><img src="/../assets/%E7%A7%92%E6%9D%80%E5%95%86%E5%9F%8E%EF%BC%88spikemall%EF%BC%89/image-20230527103920081.png" alt="image-20230527103920081"></p><h2 id="é¡¹ç›®åœ°å€"><a href="#é¡¹ç›®åœ°å€" class="headerlink" title="é¡¹ç›®åœ°å€"></a>é¡¹ç›®åœ°å€</h2><p><a href="https://github.com/PlanBBBBB/spikemall">PlanBBBBB&#x2F;spikemall: åˆ†å¸ƒå¼ç§’æ€å•†åŸ (github.com)</a></p><h2 id="æ¼”ç¤ºè§†é¢‘"><a href="#æ¼”ç¤ºè§†é¢‘" class="headerlink" title="æ¼”ç¤ºè§†é¢‘"></a>æ¼”ç¤ºè§†é¢‘</h2><p><video src="../assets/ç§’æ€å•†åŸï¼ˆspikemallï¼‰/é¡¹ç›®å±•ç¤º.mp4" width="850" height="500" controls>   Your browser does not support the video tag. </video></p><h2 id="ç›¸å…³æŠ€æœ¯æ ˆ"><a href="#ç›¸å…³æŠ€æœ¯æ ˆ" class="headerlink" title="ç›¸å…³æŠ€æœ¯æ ˆ"></a>ç›¸å…³æŠ€æœ¯æ ˆ</h2><p>è¯¥é¡¹ç›®ä¸»è¦ä½¿ç”¨äº†<code>springboot</code>ï¼Œ<code>mybatis-plus</code>ï¼Œ<code>springcloud</code>ï¼Œ<code>nacos</code>ï¼Œ<code>feign</code>ï¼Œ<code>rocketmq</code>ï¼Œ<code>redis</code>ï¼Œ<code>gateway</code>ï¼Œ<code>springsecurity</code>ï¼Œ<code>Sentinel</code>ï¼Œ<code>Seata</code>ç­‰æŠ€æœ¯ã€‚</p><h2 id="é¡¹ç›®å¯åŠ¨"><a href="#é¡¹ç›®å¯åŠ¨" class="headerlink" title="é¡¹ç›®å¯åŠ¨"></a>é¡¹ç›®å¯åŠ¨</h2><ol><li>å¯åŠ¨nacos</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startup.cmd -m standalone</span><br></pre></td></tr></table></figure><p>éšåæµè§ˆå™¨è®¿é—®<a href="http://localhost:8848/nacos">http://localhost:8848/nacos</a> å³å¯</p><ol start="2"><li>å¯åŠ¨redis</li></ol><p>å…ˆå¯åŠ¨redis-server.exeï¼Œå†å¯åŠ¨redis-cli.exe</p><ol start="3"><li>å¯åŠ¨rocketmq</li></ol><p>å…ˆå¯åŠ¨mqnamesrv.cmdï¼Œå†å¯åŠ¨mqbroker.cmd</p><ol start="4"><li>å¯åŠ¨sentinel</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Dserver.port=8090 -jar sentinel-dashboard-1.8.1.jar</span><br></pre></td></tr></table></figure><p>éšåæµè§ˆå™¨è®¿é—®<a href="http://localhost:8090/">http://localhost:8090</a> å³å¯</p><ol start="5"><li>å¯åŠ¨seata</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seata-server.bat</span><br></pre></td></tr></table></figure><ol start="6"><li>å¯åŠ¨æ‰€æœ‰æœåŠ¡</li></ol><h2 id="åº“è¡¨è®¾è®¡"><a href="#åº“è¡¨è®¾è®¡" class="headerlink" title="åº“è¡¨è®¾è®¡"></a>åº“è¡¨è®¾è®¡</h2><h3 id="spikemall-usersï¼ˆç”¨æˆ·æ•°æ®åº“ï¼‰"><a href="#spikemall-usersï¼ˆç”¨æˆ·æ•°æ®åº“ï¼‰" class="headerlink" title="spikemall_usersï¼ˆç”¨æˆ·æ•°æ®åº“ï¼‰"></a>spikemall_usersï¼ˆç”¨æˆ·æ•°æ®åº“ï¼‰</h3><h4 id="usersï¼ˆç”¨æˆ·è¡¨ï¼‰"><a href="#usersï¼ˆç”¨æˆ·è¡¨ï¼‰" class="headerlink" title="usersï¼ˆç”¨æˆ·è¡¨ï¼‰"></a>usersï¼ˆç”¨æˆ·è¡¨ï¼‰</h4><table><thead><tr><th>åç§°</th><th>æ³¨é‡Š</th></tr></thead><tbody><tr><td>id</td><td>ä¸»é”®</td></tr><tr><td>name</td><td>æ˜µç§°</td></tr><tr><td>phone</td><td>æ‰‹æœºå·</td></tr><tr><td>avatar</td><td>å¤´åƒ</td></tr><tr><td>password</td><td>å¯†ç </td></tr><tr><td>money</td><td>ä½™é¢</td></tr><tr><td>power</td><td>æƒé™</td></tr></tbody></table><hr><h4 id="oauth-client-detailsï¼ˆspring-securityç”¨æˆ·å®¢æˆ·ç«¯è¡¨ï¼‰"><a href="#oauth-client-detailsï¼ˆspring-securityç”¨æˆ·å®¢æˆ·ç«¯è¡¨ï¼‰" class="headerlink" title="oauth_client_detailsï¼ˆspring securityç”¨æˆ·å®¢æˆ·ç«¯è¡¨ï¼‰"></a>oauth_client_detailsï¼ˆspring securityç”¨æˆ·å®¢æˆ·ç«¯è¡¨ï¼‰</h4><table><thead><tr><th>åç§°</th></tr></thead><tbody><tr><td>client_id</td></tr><tr><td>resource_ids</td></tr><tr><td>client_secret</td></tr><tr><td>scope</td></tr><tr><td>authorized_grant_types</td></tr><tr><td>web_server_redirect_uri</td></tr><tr><td>authorities</td></tr><tr><td>access_token_validity</td></tr><tr><td>refresh_token_validity</td></tr><tr><td>additional_information</td></tr><tr><td>autoapprove</td></tr></tbody></table><p>è¯¥<code>oauth_client_details</code>è¡¨ä¸»è¦ç”¨äºspring securityæ•´åˆoauth2.0æ—¶ï¼Œä½œä¸ºè®¤è¯æˆæƒæœåŠ¡å™¨æ—¶çš„ä¿å­˜åœ¨æ•°æ®åº“çš„å®¢æˆ·ç«¯ä½¿ç”¨ã€‚</p><h3 id="spikemall-goodsï¼ˆå•†å“æ•°æ®åº“ï¼‰"><a href="#spikemall-goodsï¼ˆå•†å“æ•°æ®åº“ï¼‰" class="headerlink" title="spikemall_goodsï¼ˆå•†å“æ•°æ®åº“ï¼‰"></a>spikemall_goodsï¼ˆå•†å“æ•°æ®åº“ï¼‰</h3><h4 id="goodsï¼ˆå•†å“è¡¨ï¼‰"><a href="#goodsï¼ˆå•†å“è¡¨ï¼‰" class="headerlink" title="goodsï¼ˆå•†å“è¡¨ï¼‰"></a>goodsï¼ˆå•†å“è¡¨ï¼‰</h4><table><thead><tr><th>åç§°</th><th>ç±»å‹</th></tr></thead><tbody><tr><td>id</td><td>ä¸»é”®</td></tr><tr><td>name</td><td>å•†å“å</td></tr><tr><td>price</td><td>å•†å“ä»·æ ¼</td></tr><tr><td>image</td><td>å•†å“å›¾ç‰‡</td></tr><tr><td>description</td><td>å•†å“æè¿°</td></tr></tbody></table><h3 id="spike-mall-ordersï¼ˆè®¢å•æ•°æ®åº“ï¼‰"><a href="#spike-mall-ordersï¼ˆè®¢å•æ•°æ®åº“ï¼‰" class="headerlink" title="spike mall_ordersï¼ˆè®¢å•æ•°æ®åº“ï¼‰"></a>spike mall_ordersï¼ˆè®¢å•æ•°æ®åº“ï¼‰</h3><h4 id="ordersï¼ˆè®¢å•è¡¨ï¼‰"><a href="#ordersï¼ˆè®¢å•è¡¨ï¼‰" class="headerlink" title="ordersï¼ˆè®¢å•è¡¨ï¼‰"></a>ordersï¼ˆè®¢å•è¡¨ï¼‰</h4><table><thead><tr><th>åç§°</th><th>æ³¨é‡Š</th></tr></thead><tbody><tr><td>id</td><td>ä¸»é”®</td></tr><tr><td>user_id</td><td>ä¸‹å•ç”¨æˆ·id</td></tr><tr><td>good_id</td><td>å•†å“id</td></tr><tr><td>status</td><td>è®¢å•çŠ¶æ€ï¼ˆ0æœªæ”¯ä»˜ï¼Œ1å·²æ”¯ä»˜ï¼‰</td></tr><tr><td>order_time</td><td>ä¸‹å•æ—¶é—´</td></tr><tr><td>check_time</td><td>ç»“è´¦æ—¶é—´</td></tr><tr><td>amount</td><td>å®æ”¶é‡‘é¢</td></tr></tbody></table><h3 id="spikemall-repertoryï¼ˆåº“å­˜æ•°æ®åº“ï¼‰"><a href="#spikemall-repertoryï¼ˆåº“å­˜æ•°æ®åº“ï¼‰" class="headerlink" title="spikemall_repertoryï¼ˆåº“å­˜æ•°æ®åº“ï¼‰"></a>spikemall_repertoryï¼ˆåº“å­˜æ•°æ®åº“ï¼‰</h3><h4 id="repertoryï¼ˆåº“å­˜è¡¨ï¼‰"><a href="#repertoryï¼ˆåº“å­˜è¡¨ï¼‰" class="headerlink" title="repertoryï¼ˆåº“å­˜è¡¨ï¼‰"></a>repertoryï¼ˆåº“å­˜è¡¨ï¼‰</h4><table><thead><tr><th>åç§°</th><th>æ³¨é‡Š</th></tr></thead><tbody><tr><td>goods_id</td><td>å•†å“id</td></tr><tr><td>stock</td><td>åº“å­˜</td></tr><tr><td>begin_time</td><td>å¼€å§‹æ—¶é—´</td></tr><tr><td>end_time</td><td>ç»“æŸæ—¶é—´</td></tr></tbody></table><h2 id="è´¦æˆ·æœåŠ¡"><a href="#è´¦æˆ·æœåŠ¡" class="headerlink" title="è´¦æˆ·æœåŠ¡"></a>è´¦æˆ·æœåŠ¡</h2><h3 id="æ³¨å†ŒåŠŸèƒ½"><a href="#æ³¨å†ŒåŠŸèƒ½" class="headerlink" title="æ³¨å†ŒåŠŸèƒ½"></a>æ³¨å†ŒåŠŸèƒ½</h3><ul><li>ä½¿ç”¨åœºæ™¯</li></ul><p>æœ¬é¡¹ç›®ä½¿ç”¨äº†springsecurityæ•´åˆçš„oauth2.0ï¼Œæ•…æ‰€æœ‰è°ƒç”¨çš„èµ„æºéƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦jwtä»¤ç‰Œï¼Œç™»å½•åŠŸèƒ½å®ç°çš„æ˜¯è·å–ä»¤ç‰Œï¼Œè€Œæ³¨å†ŒåŠŸèƒ½æ˜¯æœ¬ç³»ç»Ÿå”¯ä¸€ä¸€ä¸ªä¸éœ€è¦æºå¸¦ä»¤ç‰Œå°±èƒ½è®¿é—®çš„èµ„æºã€‚</p><ul><li>ä»£ç å®ç°</li></ul><ol><li>controller</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨å†Œ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/register&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">register</span><span class="params">(<span class="meta">@RequestBody</span> Users user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> usersService.register(user);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>service</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Result <span class="title function_">register</span><span class="params">(Users user)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> user.getPhone();</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> user.getPassword();</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> user.getName();</span><br><span class="line">        <span class="type">String</span> <span class="variable">avatar</span> <span class="operator">=</span> user.getAvatar();</span><br><span class="line">        <span class="keyword">if</span> (RegexUtils.isPhoneInvalid(phone)) &#123;</span><br><span class="line">            <span class="comment">//æ‰‹æœºå·æ ¼å¼é”™è¯¯</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        LambdaQueryWrapper&lt;Users&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(Users::getPhone, phone);</span><br><span class="line">        List&lt;Users&gt; list = list(queryWrapper);</span><br><span class="line">        <span class="keyword">if</span> (!list.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç”¨æˆ·å·²å­˜åœ¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (RegexUtils.isPasswordInvalid(password)) &#123;</span><br><span class="line">            <span class="comment">//å¯†ç æ ¼å¼é”™è¯¯</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;å¯†ç æ ¼å¼ä¸æ­£ç¡®&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Users</span> <span class="variable">newUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Users</span>();</span><br><span class="line">        newUser.setPhone(user.getPhone());</span><br><span class="line">        <span class="comment">//å¯†ç è®¾ç½®ä¸ºåŠ å¯†å½¢å¼</span></span><br><span class="line">        <span class="type">BCryptPasswordEncoder</span> <span class="variable">passwordEncoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">encode</span> <span class="operator">=</span> passwordEncoder.encode(password);</span><br><span class="line">        newUser.setPassword(encode);</span><br><span class="line">        newUser.setMoney(<span class="number">200L</span>);<span class="comment">//æ–°ç”¨æˆ·é€200</span></span><br><span class="line">        newUser.setPower(<span class="string">&quot;consumer&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (user.getName() == <span class="literal">null</span>) &#123;</span><br><span class="line">            newUser.setName(<span class="string">&quot;user_&quot;</span> + UUID.randomUUID(<span class="literal">true</span>).toString());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            newUser.setName(name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (avatar != <span class="literal">null</span>) &#123;</span><br><span class="line">            newUser.setAvatar(avatar);</span><br><span class="line">        &#125;</span><br><span class="line">        save(newUser);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="springsecurityç™»å½•åŠŸèƒ½â­â­â­"><a href="#springsecurityç™»å½•åŠŸèƒ½â­â­â­" class="headerlink" title="springsecurityç™»å½•åŠŸèƒ½â­â­â­"></a>springsecurityç™»å½•åŠŸèƒ½â­â­â­</h3><h4 id="åŠŸèƒ½æ¦‚è¿°"><a href="#åŠŸèƒ½æ¦‚è¿°" class="headerlink" title="åŠŸèƒ½æ¦‚è¿°"></a>åŠŸèƒ½æ¦‚è¿°</h4><p>æœ¬é¡¹ç›®ä½¿ç”¨çš„æ˜¯æˆæƒç æ¨¡å¼ï¼Œæ•…æ˜¯å°†è´¦æˆ·æœåŠ¡ä½œä¸ºä¸€ä¸ªè®¤è¯æˆæƒçš„æœåŠ¡å™¨ï¼Œè€Œå…¶ä»–çš„æœåŠ¡éƒ½æ˜¯èµ„æºæœåŠ¡å™¨ï¼Œç”¨æˆ·éœ€è¦åœ¨è®¤è¯æˆæƒæœåŠ¡å™¨ä¸­è·å–åˆ°jwtä»¤ç‰Œï¼Œå¹¶åœ¨è®¿é—®å…¶ä»–æœåŠ¡æ—¶ï¼Œåœ¨è¯·æ±‚å¤´æºå¸¦jwtä»¤ç‰Œæ‰èƒ½è®¿é—®å…¶ä»–æœåŠ¡çš„èµ„æºã€‚</p><h4 id="è·å–æˆæƒç æ­¥éª¤"><a href="#è·å–æˆæƒç æ­¥éª¤" class="headerlink" title="è·å–æˆæƒç æ­¥éª¤"></a>è·å–æˆæƒç æ­¥éª¤</h4><ol><li>åœ¨æµè§ˆå™¨è¾“å…¥<a href="http://localhost:8085/">http://localhost:8085</a>ä¼šè‡ªåŠ¨è·³è½¬åˆ°<a href="http://localhost:8085/login">http://localhost:8085/login</a>ï¼Œåœ¨è¡¨å•ä¸­å¡«å†™æ‰‹æœºå·å’Œå¯†ç è¿›è¡Œç™»å½•ã€‚</li></ol><p><img src="/../assets/%E7%A7%92%E6%9D%80%E5%95%86%E5%9F%8E%EF%BC%88spikemall%EF%BC%89/image-20230527101204919.png" alt="image-20230527101204919"></p><p>è¿›å…¥å¦‚ä¸‹ç•Œé¢ä»£è¡¨ç™»å½•æˆåŠŸ</p><p><img src="/../assets/%E7%A7%92%E6%9D%80%E5%95%86%E5%9F%8E%EF%BC%88spikemall%EF%BC%89/image-20230527101318752.png" alt="image-20230527101318752"></p><ol start="2"><li>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥è¯¥ç½‘å€<a href="http://localhost:8085/oauth/authorize?client_id=client&response_type=code&redirect_uri=http://www.baidu.com">http://localhost:8085/oauth/authorize?client_id&#x3D;client&amp;response_type&#x3D;code&amp;redirect_uri&#x3D;http://www.baidu.com</a>ï¼Œè·³è½¬åˆ°ç™¾åº¦é¦–é¡µä¹‹åï¼Œåœ¨ä¸Šé¢urlå¤„æ‰¾åˆ°æˆæƒç </li></ol><p><img src="/../assets/%E7%A7%92%E6%9D%80%E5%95%86%E5%9F%8E%EF%BC%88spikemall%EF%BC%89/image-20230527101354324.png" alt="image-20230527101354324"></p><p>ç‚¹å‡»Authorizeè¿›è¡Œæˆæƒ</p><p><img src="/../assets/%E7%A7%92%E6%9D%80%E5%95%86%E5%9F%8E%EF%BC%88spikemall%EF%BC%89/image-20230527101451035.png" alt="image-20230527101451035"></p><p>å¾—åˆ°æˆæƒç </p><ol start="3"><li>å°†å¾—åˆ°çš„æˆæƒç ä»£å…¥åˆ°ä»¥ä¸‹urlåœ°å€ä¸­ï¼Œæ­¤å¤„ç”¨postmanè¿›è¡Œæ“ä½œï¼š<a href="http://client:secret@localhost:8085/oauth/token?grant_type=authorization_code&code=prgYij&redirect_uri=http://www.baidu.com">http://client:secret@localhost:8085&#x2F;oauth&#x2F;token?grant_type&#x3D;authorization_code&amp;code&#x3D;prgYij&amp;redirect_uri&#x3D;http://www.baidu.com</a></li></ol><p><img src="/../assets/%E7%A7%92%E6%9D%80%E5%95%86%E5%9F%8E%EF%BC%88spikemall%EF%BC%89/image-20230527101535264.png" alt="image-20230527101535264"></p><p>æºå¸¦æˆæƒç ï¼Œå¾—åˆ°<code>access_token</code>ï¼Œè¯¥<code>access_token</code>åœ¨å‰é¢æ‹¼æ¥ä¸Š<code>Bearer </code>å³ä¸ºjwtä»¤ç‰Œã€‚</p><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>å› ä¸ºæœ¬èº«ä½¿ç”¨çš„å°±æ˜¯springsecurityæ•´åˆå¥½çš„å®‰å…¨æ¡†æ¶ï¼Œæ•…åªæ˜¯å¯¹è®¤è¯æˆæƒæœåŠ¡å™¨å’Œèµ„æºæœåŠ¡å™¨åšäº†ä¸€ç³»åˆ—çš„é…ç½®è€Œå·²ã€‚</p><h3 id="è·å–ç”¨æˆ·ä½™é¢åŠŸèƒ½"><a href="#è·å–ç”¨æˆ·ä½™é¢åŠŸèƒ½" class="headerlink" title="è·å–ç”¨æˆ·ä½™é¢åŠŸèƒ½"></a>è·å–ç”¨æˆ·ä½™é¢åŠŸèƒ½</h3><ul><li>ä½¿ç”¨åœºæ™¯</li></ul><p>åœ¨æ”¯ä»˜åŠŸèƒ½è¿›è¡Œä¸­ï¼Œä¼šé€šè¿‡è¿œç¨‹è°ƒç”¨è¯¥æ–¹æ³•ï¼Œåˆ¤æ–­ç”¨æˆ·çš„ä½™é¢æ˜¯å¦å……è¶³ï¼Œä»¥è¿›è¡Œåç»­çš„æ”¯ä»˜åŠŸèƒ½ã€‚</p><ul><li>ä»£ç å®ç°</li></ul><ol><li>controller</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç”¨æˆ·ä½™é¢ï¼ˆå¯¹å¤–ä¸å¼€æ”¾ï¼‰</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/money&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getMoney</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            userId = UserToken.getUserIdFromToken(jwt);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> usersService.getMoney(userId);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>service</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Long <span class="title function_">getMoney</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="type">Users</span> <span class="variable">user</span> <span class="operator">=</span> getById(userId);</span><br><span class="line">        <span class="keyword">return</span> user.getMoney();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="æ‰£å‡ç”¨æˆ·ä½™é¢åŠŸèƒ½"><a href="#æ‰£å‡ç”¨æˆ·ä½™é¢åŠŸèƒ½" class="headerlink" title="æ‰£å‡ç”¨æˆ·ä½™é¢åŠŸèƒ½"></a>æ‰£å‡ç”¨æˆ·ä½™é¢åŠŸèƒ½</h3><ul><li>ä½¿ç”¨åœºæ™¯</li></ul><p>ç”¨æˆ·åœ¨è¿›è¡Œæ”¯ä»˜åŠŸèƒ½æ—¶ï¼Œæ»¡è¶³ä¸€åˆ‡æ”¯ä»˜æ¡ä»¶åä¼šå¯¹ç”¨æˆ·ä½™é¢è¿›è¡Œæ‰£å‡ã€‚</p><ul><li>ä»£ç å®ç°</li></ul><ol><li>controller</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰£å‡ç”¨æˆ·ä½™é¢ï¼ˆå¯¹å¤–ä¸å¼€æ”¾ï¼‰</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> lastMoney</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/reduce/&#123;lastMoney&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reduceMoney</span><span class="params">(<span class="meta">@PathVariable(&quot;lastMoney&quot;)</span> Long lastMoney, HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            userId = UserToken.getUserIdFromToken(jwt);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        usersService.reduceMoney(userId, lastMoney);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>service</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reduceMoney</span><span class="params">(Long userId, Long lastMoney)</span> &#123;</span><br><span class="line">        LambdaUpdateWrapper&lt;Users&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">        updateWrapper.eq(Users::getId, userId)</span><br><span class="line">                .set(Users::getMoney, lastMoney);</span><br><span class="line">        update(updateWrapper);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="å•†å“æœåŠ¡"><a href="#å•†å“æœåŠ¡" class="headerlink" title="å•†å“æœåŠ¡"></a>å•†å“æœåŠ¡</h2><h3 id="é€šè¿‡å•†å“idæŸ¥è¯¢ä»·æ ¼åŠŸèƒ½"><a href="#é€šè¿‡å•†å“idæŸ¥è¯¢ä»·æ ¼åŠŸèƒ½" class="headerlink" title="é€šè¿‡å•†å“idæŸ¥è¯¢ä»·æ ¼åŠŸèƒ½"></a>é€šè¿‡å•†å“idæŸ¥è¯¢ä»·æ ¼åŠŸèƒ½</h3><ul><li>ä½¿ç”¨åœºæ™¯</li></ul><p>åœ¨åˆ›å»ºè®¢å•æ—¶ï¼Œéœ€è¦çŸ¥é“å•†å“çš„ä»·æ ¼ï¼Œæ•…è¿™æ˜¯ä¸€ä¸ªè¿œç¨‹è°ƒç”¨çš„æ–¹æ³•ã€‚</p><ul><li>ä»£ç å®ç°</li></ul><ol><li>controller</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡å•†å“idæŸ¥è¯¢ä»·æ ¼(å¯¹å¤–ä¸å¼€æ”¾)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> goodsId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getPrice</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long goodsId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> goodsService.getById(goodsId).getPrice();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹å•†å“åˆ—è¡¨åŠŸèƒ½"><a href="#æŸ¥çœ‹å•†å“åˆ—è¡¨åŠŸèƒ½" class="headerlink" title="æŸ¥çœ‹å•†å“åˆ—è¡¨åŠŸèƒ½"></a>æŸ¥çœ‹å•†å“åˆ—è¡¨åŠŸèƒ½</h3><ul><li>ä½¿ç”¨åœºæ™¯</li></ul><p>ç”¨æˆ·å¯ä»¥æŸ¥çœ‹å•†å“ï¼Œå±äºå®Œå–„ç³»ç»Ÿçš„ä¸€ä¸ªåŠŸèƒ½ã€‚</p><ul><li>ä»£ç å®ç°</li></ul><ol><li>controller</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥çœ‹å•†å“åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> goodsService.listByRedis();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>service</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Result <span class="title function_">listByRedis</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//å…ˆä»ç¼“å­˜ä¸­æŸ¥</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">goodsKey</span> <span class="operator">=</span> <span class="string">&quot;cache:goods&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">goodsKeyJson</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(goodsKey);</span><br><span class="line">        <span class="comment">//æŸ¥åˆ°äº†å°±è¿”å›æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (goodsKeyJson != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.ok(JSONUtil.toList(goodsKeyJson, Goods.class));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æŸ¥ä¸åˆ°å†ä»æ•°æ®åº“æŸ¥</span></span><br><span class="line">        List&lt;Goods&gt; goodsList = query().orderByAsc(<span class="string">&quot;id&quot;</span>).list();</span><br><span class="line">        <span class="keyword">if</span> (goodsList == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;å•†é“ºç±»å‹å‘ç”Ÿé”™è¯¯&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å°†ä»æ•°æ®åº“æŸ¥è¯¢ç»“æœå­˜å…¥ç¼“å­˜</span></span><br><span class="line">        stringRedisTemplate.opsForValue().setIfAbsent(goodsKey, JSONUtil.toJsonStr(goodsList), <span class="number">30</span>, TimeUnit.MINUTES);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(goodsList);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸‹å•æœåŠ¡"><a href="#ä¸‹å•æœåŠ¡" class="headerlink" title="ä¸‹å•æœåŠ¡"></a>ä¸‹å•æœåŠ¡</h2><h3 id="ä¸‹å•åŠŸèƒ½"><a href="#ä¸‹å•åŠŸèƒ½" class="headerlink" title="ä¸‹å•åŠŸèƒ½"></a>ä¸‹å•åŠŸèƒ½</h3><ul><li>ä½¿ç”¨åœºæ™¯</li></ul><p>ç”¨æˆ·æŸ¥çœ‹å•†å“ï¼Œé€‰æ‹©å¥½å•†å“ä¹‹åå³å¯ä¸‹å•ï¼Œä¸‹å•åŠŸèƒ½ä¼šå±€é™äºå•†å“æ˜¯å¦åœ¨ç§’æ€æ—¶é—´æ®µå†…ä»¥åŠåº“å­˜æ˜¯å¦å……è¶³ç­‰æ¡ä»¶ï¼Œæ­¤å¤„åˆ©ç”¨åˆ†å¸ƒå¼é”æ¥å®ç°ä¸€äººä¸€å•ã€‚</p><ul><li>å®ç°ä»£ç </li></ul><ol><li>controller</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§’æ€å•†å“åŠŸèƒ½ï¼Œè¯·æ±‚å¤´å¿…é¡»æºå¸¦jwt</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> goodsId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/spike/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">spikeGoods</span><span class="params">(HttpServletRequest request, <span class="meta">@PathVariable(&quot;id&quot;)</span> Long goodsId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> repertoryService.spikeGoods(jwt, goodsId);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>service</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Result <span class="title function_">spikeGoods</span><span class="params">(String jwt, Long goodsId)</span> &#123;</span><br><span class="line">        Long userId;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            userId = UserToken.getUserIdFromToken(jwt);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;è§£æjwtå¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ˜¯å¦æ»¡è¶³æ—¶é—´ã€åº“å­˜æ¡ä»¶</span></span><br><span class="line">        <span class="type">Repertory</span> <span class="variable">spikeGood</span> <span class="operator">=</span> getById(goodsId);</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">beginTime</span> <span class="operator">=</span> spikeGood.getBeginTime();</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">endTime</span> <span class="operator">=</span> spikeGood.getEndTime();</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">        <span class="keyword">if</span> (now.isBefore(beginTime)) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€æœªå¼€å§‹&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (now.isAfter(endTime)) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å·²ç»“æŸ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­å•†å“æ˜¯å¦è¿˜æœ‰åº“å­˜</span></span><br><span class="line">        <span class="keyword">if</span> (spikeGood.getStock() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ ¹æ®userId åˆ›å»ºé”å¯¹è±¡</span></span><br><span class="line">        <span class="type">SimpleRedisLock</span> <span class="variable">redisLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleRedisLock</span>(<span class="string">&quot;order:&quot;</span> + userId, stringRedisTemplate);</span><br><span class="line">        <span class="comment">// è·å–é”å¯¹è±¡</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> redisLock.tryLock(<span class="number">120</span>);</span><br><span class="line">        <span class="comment">// åŠ é”å¤±è´¥ï¼Œè¯´æ˜å½“å‰ç”¨æˆ·å¼€äº†å¤šä¸ªçº¿ç¨‹æŠ¢å•†å“ï¼Œä½†æ˜¯ç”±äºkeyæ˜¯SETNXçš„ï¼Œæ‰€ä»¥ä¸èƒ½åˆ›å»ºkeyï¼Œå¾—ç­‰keyçš„TTLåˆ°æœŸæˆ–é‡Šæ”¾é”ï¼ˆåˆ é™¤keyï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (!isLock) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ä¸å…è®¸æŠ¢å¤šæ¬¡å•†å“&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è·å–ä»£ç†å¯¹è±¡</span></span><br><span class="line">            <span class="type">RepertoryService</span> <span class="variable">proxy</span> <span class="operator">=</span> (RepertoryService) AopContext.currentProxy();</span><br><span class="line">            <span class="keyword">return</span> proxy.createVoucherOrder(jwt, goodsId);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">            redisLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">createVoucherOrder</span><span class="params">(String jwt, Long goodsId)</span> &#123;</span><br><span class="line">        <span class="comment">//ä¸€äººä¸€å•è¦æ±‚</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> orderClient.findCount(goodsId, jwt);</span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;è¯¥ç”¨æˆ·ä»¥æŠ¢è´­æ­¤å•†å“&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> stockClient.reduceStock(goodsId, jwt);</span><br><span class="line">        <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;è¯¥å•†å“å·²æŠ¢è´­å®Œ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç”ŸæˆorderIdï¼ˆä½¿ç”¨redisIdWorkerï¼‰</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å‘é€æ™®é€šæ¶ˆæ¯ç»™MQ</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">topic</span> <span class="operator">=</span> <span class="string">&quot;Order&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> jwt + <span class="string">&quot;_&quot;</span> + goodsId + <span class="string">&quot;_&quot;</span> + orderId;</span><br><span class="line">        rocketMQTemplate.convertAndSend(topic, message);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿”å›è®¢å•id</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="è®¢å•æœåŠ¡"><a href="#è®¢å•æœåŠ¡" class="headerlink" title="è®¢å•æœåŠ¡"></a>è®¢å•æœåŠ¡</h2><h3 id="åˆ›å»ºè®¢å•åŠŸèƒ½"><a href="#åˆ›å»ºè®¢å•åŠŸèƒ½" class="headerlink" title="åˆ›å»ºè®¢å•åŠŸèƒ½"></a>åˆ›å»ºè®¢å•åŠŸèƒ½</h3><ul><li>ä½¿ç”¨åœºæ™¯</li></ul><p>åœ¨ç”¨æˆ·è¿›è¡Œä¸‹å•æ“ä½œæ—¶è¿›è¡Œè¿œç¨‹è°ƒç”¨çš„æ–¹æ³•ã€‚</p><ul><li>ä»£ç å®ç°</li></ul><ol><li>controller</li></ol><p>ç”±äºæ˜¯åœ¨ä¸‹å•æ—¶è¿›è¡Œçš„è°ƒç”¨æ–¹æ³•ï¼Œæ•…æ²¡æœ‰ç‹¬ç«‹çš„æ¥å£ã€‚</p><ol start="2"><li>service</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveOrder</span><span class="params">(String jwt, Long goodsId, Long orderId)</span> &#123;</span><br><span class="line">        Long userId;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            userId = UserToken.getUserIdFromToken(jwt);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">price</span> <span class="operator">=</span> goodClient.getPrice(goodsId, jwt);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºè®¢å•</span></span><br><span class="line">        <span class="type">Orders</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Orders</span>();</span><br><span class="line">        order.setId(orderId);</span><br><span class="line">        order.setGoodId(goodsId);</span><br><span class="line">        order.setOrderTime(LocalDateTime.now());</span><br><span class="line">        order.setStatus(<span class="number">0</span>);<span class="comment">//  0è¡¨ç¤ºæœªæ”¯ä»˜</span></span><br><span class="line">        order.setUserId(userId);</span><br><span class="line">        order.setAmount(price);</span><br><span class="line">        save(order);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å‘é€å»¶è¿Ÿæ¶ˆæ¯</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">orderJson</span> <span class="operator">=</span> JSONUtil.toJsonStr(order);</span><br><span class="line">        <span class="type">String</span> <span class="variable">topic</span> <span class="operator">=</span> <span class="string">&quot;Pay&quot;</span>;</span><br><span class="line">        Message&lt;String&gt; message = MessageBuilder.withPayload(orderJson)</span><br><span class="line">                .setHeader(MessageConst.PROPERTY_DELAY_TIME_LEVEL, <span class="string">&quot;3&quot;</span>) <span class="comment">// è®¾ç½®å»¶è¿Ÿç­‰çº§ä¸º3ï¼Œå³10ç§’</span></span><br><span class="line">                .build();</span><br><span class="line">        rocketMQTemplate.send(topic, message);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹è¯¥ç”¨æˆ·æ˜¯å¦è´­ä¹°è¿‡è¯¥å•†å“åŠŸèƒ½ï¼ˆä¸€äººä¸€å•ï¼‰"><a href="#æŸ¥çœ‹è¯¥ç”¨æˆ·æ˜¯å¦è´­ä¹°è¿‡è¯¥å•†å“åŠŸèƒ½ï¼ˆä¸€äººä¸€å•ï¼‰" class="headerlink" title="æŸ¥çœ‹è¯¥ç”¨æˆ·æ˜¯å¦è´­ä¹°è¿‡è¯¥å•†å“åŠŸèƒ½ï¼ˆä¸€äººä¸€å•ï¼‰"></a>æŸ¥çœ‹è¯¥ç”¨æˆ·æ˜¯å¦è´­ä¹°è¿‡è¯¥å•†å“åŠŸèƒ½ï¼ˆä¸€äººä¸€å•ï¼‰</h3><ul><li>ä½¿ç”¨åœºæ™¯</li></ul><p>ç”¨æˆ·åœ¨è¿›è¡Œä¸‹å•æ—¶ï¼ŒæŸ¥çœ‹è¯¥ç”¨æˆ·æ˜¯å¦å·²ç»è´­ä¹°è¿‡è¯¥å•†å“ï¼Œè‹¥å·²ç»è´­ä¹°è¿‡è¯¥å•†å“ï¼Œåˆ™ä¸å…è®¸ç”¨æˆ·é‡å¤è´­ä¹°ã€‚</p><ul><li>å®ç°ä»£ç </li></ul><ol><li>controller</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡æŸ¥è¯¢è®¢å•æŸ¥çœ‹è¯¥ç”¨æˆ·æ˜¯å¦è´­ä¹°è¿‡è¯¥å•†å“ï¼Œå®ç°ä¸€äººä¸€å•ï¼ˆå¯¹å¤–ä¸å¼€æ”¾ï¼‰</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> goodsId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/find/&#123;goodsId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findCount</span><span class="params">(HttpServletRequest request, <span class="meta">@PathVariable(&quot;goodsId&quot;)</span> Long goodsId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            userId = UserToken.getUserIdFromToken(jwt);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ordersService.findCount(userId, goodsId);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>service</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findCount</span><span class="params">(Long userId, Long goodsId)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Orders&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(Orders::getGoodId, goodsId).eq(Orders::getUserId, userId);</span><br><span class="line">        <span class="keyword">return</span> count(queryWrapper);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„æ‰€æœ‰è®¢å•åŠŸèƒ½"><a href="#æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„æ‰€æœ‰è®¢å•åŠŸèƒ½" class="headerlink" title="æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„æ‰€æœ‰è®¢å•åŠŸèƒ½"></a>æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„æ‰€æœ‰è®¢å•åŠŸèƒ½</h3><ul><li>ä½¿ç”¨åœºæ™¯</li></ul><p>ç”¨æˆ·å¯æŸ¥çœ‹è‡ªå·±çš„æ‰€æœ‰è®¢å•ï¼Œç®—æ˜¯å®Œå–„ç³»ç»Ÿçš„ä¸€ä¸ªåŠŸèƒ½ã€‚</p><ul><li>ä»£ç å®ç°</li></ul><ol><li>controller</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„æ‰€æœ‰è®¢å•,è¯·æ±‚å¤´å¿…é¡»æºå¸¦jwt</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">listByUser</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            userId = UserToken.getUserIdFromToken(jwt);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ordersService.listByUser(userId);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>service</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Result <span class="title function_">listByUser</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Orders&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(Orders::getUserId, userId);</span><br><span class="line">        List&lt;Orders&gt; ordersList = list(queryWrapper);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(ordersList);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="æ”¯ä»˜æœåŠ¡"><a href="#æ”¯ä»˜æœåŠ¡" class="headerlink" title="æ”¯ä»˜æœåŠ¡"></a>æ”¯ä»˜æœåŠ¡</h2><h3 id="æ”¯ä»˜åŠŸèƒ½"><a href="#æ”¯ä»˜åŠŸèƒ½" class="headerlink" title="æ”¯ä»˜åŠŸèƒ½"></a>æ”¯ä»˜åŠŸèƒ½</h3><ul><li>ä½¿ç”¨åœºæ™¯</li></ul><p>ç”¨æˆ·åœ¨ä¸‹å•åŠŸèƒ½æˆåŠŸä¹‹åï¼Œå†è¿›è¡Œæ”¯ä»˜åŠŸèƒ½ï¼Œåœ¨æ”¯ä»˜è¿‡ç¨‹ç§ä¼šå‡ºç°æœªåœ¨è§„å®šæ—¶é—´æ®µå†…æ”¯ä»˜ä»¥åŠä½™é¢ä¸è¶³æ— æ³•æ”¯ä»˜çš„æƒ…å†µï¼Œè¯¥æƒ…å†µä¸‹ä¼šå¯¹åº“å­˜è¿›è¡Œå›æ»šï¼ŒåŒæ—¶å¯¹åˆ›å»ºå¥½çš„è®¢å•è¿›è¡Œåˆ é™¤ï¼Œè‹¥æ»¡è¶³æ”¯ä»˜æ¡ä»¶ï¼Œå°†å¯¹è®¢å•è¿›è¡Œä¿®æ”¹ï¼ŒåŒæ—¶å¯¹ç”¨æˆ·ä½™é¢è¿›è¡Œæ‰£å‡ã€‚</p><ul><li>å®ç°ä»£ç </li></ul><ol><li>controller</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ”¯ä»˜åŠŸèƒ½,æ²¡ç™»å½•ä¸èƒ½æ”¯ä»˜ï¼Œå³è¯·æ±‚å¤´å¿…é¡»æºå¸¦token</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/&#123;orderId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">pay</span><span class="params">(HttpServletRequest request, <span class="meta">@PathVariable(&quot;orderId&quot;)</span> Long orderId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ordersService.pay(jwt, orderId);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>service</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Result <span class="title function_">pay</span><span class="params">(String jwt, Long orderId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;order:&quot;</span> + orderId;</span><br><span class="line">        <span class="type">String</span> <span class="variable">orderJson</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(orderJson)) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;è®¢å•å·æœ‰è¯¯&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è·å¾—orderå¯¹è±¡</span></span><br><span class="line">        <span class="type">Orders</span> <span class="variable">order</span> <span class="operator">=</span> JSONUtil.toBean(orderJson, Orders.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¸‹å•æ—¶é—´è¶…æ—¶</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">deadlineTime</span> <span class="operator">=</span> order.getOrderTime().plusMinutes(<span class="number">30</span>);</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">nowTime</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">        <span class="keyword">if</span> (nowTime.isAfter(deadlineTime)) &#123;</span><br><span class="line">            <span class="comment">//å›æ»šåº“å­˜</span></span><br><span class="line">            repertoryClient.rollbackStock(order.getGoodId(), jwt);</span><br><span class="line">            <span class="comment">//åˆ é™¤è®¢å•</span></span><br><span class="line">            removeById(order.getId());</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ä¸‹å•æ—¶é—´è¶…æ—¶&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä½™é¢ä¸è¶³</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">money</span> <span class="operator">=</span> userClient.getMoney(jwt);</span><br><span class="line"></span><br><span class="line">        <span class="type">Long</span> <span class="variable">price</span> <span class="operator">=</span> order.getAmount();</span><br><span class="line">        <span class="keyword">if</span> (money &lt; price) &#123;</span><br><span class="line">            <span class="comment">//å›æ»šåº“å­˜</span></span><br><span class="line">            repertoryClient.rollbackStock(order.getGoodId(), jwt);</span><br><span class="line">            <span class="comment">//åˆ é™¤è®¢å•</span></span><br><span class="line">            removeById(order.getId());</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ä½™é¢ä¸è¶³ï¼Œæ— æ³•è´­ä¹°&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¡ä»¶æˆåŠŸï¼Œè¿›è¡Œæ”¯ä»˜</span></span><br><span class="line">        <span class="comment">//1.æ›´æ”¹è®¢å•çŠ¶æ€</span></span><br><span class="line">        LambdaUpdateWrapper&lt;Orders&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(Orders::getId, order.getId())</span><br><span class="line">                .set(Orders::getCheckTime, nowTime)</span><br><span class="line">                .set(Orders::getStatus, <span class="number">1</span>);</span><br><span class="line">        update(wrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.æ‰£å‡ç”¨æˆ·ä½™é¢</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">lastMoney</span> <span class="operator">=</span> money - price;</span><br><span class="line">        userClient.reduceMoney(lastMoney, jwt);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿”å›è®¢å•id</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(order.getId());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="åº“å­˜æœåŠ¡"><a href="#åº“å­˜æœåŠ¡" class="headerlink" title="åº“å­˜æœåŠ¡"></a>åº“å­˜æœåŠ¡</h2><h3 id="æ‰£å‡åº“å­˜åŠŸèƒ½"><a href="#æ‰£å‡åº“å­˜åŠŸèƒ½" class="headerlink" title="æ‰£å‡åº“å­˜åŠŸèƒ½"></a>æ‰£å‡åº“å­˜åŠŸèƒ½</h3><ul><li>ä½¿ç”¨åœºæ™¯</li></ul><p>ç”¨æˆ·åœ¨è¿›è¡Œä¸‹å•çš„æ—¶å€™ï¼Œå°±ç›´æ¥å¯¹åº“å­˜è¿›è¡Œæ‰£å‡ã€‚</p><ul><li>å®ç°ä»£ç </li></ul><ol><li>controller</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰£å‡åº“å­˜åŠŸèƒ½ï¼ˆå¯¹å¤–ä¸å¼€æ”¾ï¼‰</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> goodsId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">reduceStock</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long goodsId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> repertoryService.reduceStock(goodsId);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>service</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">reduceStock</span><span class="params">(Long goodsId)</span> &#123;</span><br><span class="line">        LambdaUpdateWrapper&lt;Repertory&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">        updateWrapper.eq(Repertory::getGoodsId, goodsId)</span><br><span class="line">                .gt(Repertory::getStock, <span class="number">0</span>)</span><br><span class="line">                .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> update(updateWrapper);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å›æ»šåº“å­˜åŠŸèƒ½"><a href="#å›æ»šåº“å­˜åŠŸèƒ½" class="headerlink" title="å›æ»šåº“å­˜åŠŸèƒ½"></a>å›æ»šåº“å­˜åŠŸèƒ½</h3><ul><li>ä½¿ç”¨åœºæ™¯</li></ul><p>ç”¨æˆ·åœ¨è¿›è¡Œæ”¯ä»˜çš„æ—¶å€™ï¼Œè‹¥æœªåœ¨å•†å“çš„ç§’æ€æ—¶é—´æ®µå†…ï¼Œæˆ–è‡ªèº«ä½™é¢ä¸è¶³çš„æƒ…å†µä¸‹ä¼šè¿›è¡Œåº“å­˜çš„å›æ»šã€‚</p><ul><li>å®ç°ä»£ç </li></ul><ol><li>controller</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å›æ»šåº“å­˜åŠŸèƒ½ï¼ˆå¯¹å¤–ä¸å¼€æ”¾ï¼‰</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> goodsId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rollbackStock</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long goodsId)</span> &#123;</span><br><span class="line">        repertoryService.rollbackStock(goodsId);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>service</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rollbackStock</span><span class="params">(Long goodsId)</span> &#123;</span><br><span class="line">        LambdaUpdateWrapper&lt;Repertory&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">        updateWrapper.eq(Repertory::getGoodsId, goodsId)</span><br><span class="line">                .setSql(<span class="string">&quot;stock = stock + 1&quot;</span>);</span><br><span class="line">        update(updateWrapper);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="ç½‘å…³æœåŠ¡"><a href="#ç½‘å…³æœåŠ¡" class="headerlink" title="ç½‘å…³æœåŠ¡"></a>ç½‘å…³æœåŠ¡</h2><p>ç”±äºé¡¹ç›®æ˜¯å¾®æœåŠ¡é¡¹ç›®ï¼Œæ•…ä½¿ç”¨gatewayç½‘å…³è¿›è¡Œç«¯å£ç­‰ç»Ÿä¸€é…ç½®å¤„ç†å¾ˆæœ‰å¿…è¦ï¼Œæœ¬é¡¹ç›®é™¤ç”¨æˆ·ç™»å½•è¿›è¡Œè·å–æˆæƒç åŠè·å–jwtä»¤ç‰Œçš„æ‰€æœ‰è¯·æ±‚èµ„æºçš„ç«¯å£å·å‡ä¸º10010ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MySQLé«˜çº§éƒ¨åˆ†å­¦ä¹ </title>
      <link href="/2023/01/05/Study-MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/01/05/Study-MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="é›¶ç¢çŸ¥è¯†"><a href="#é›¶ç¢çŸ¥è¯†" class="headerlink" title="é›¶ç¢çŸ¥è¯†"></a>é›¶ç¢çŸ¥è¯†</h1><h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><h3 id="æ·»åŠ æ•°æ®"><a href="#æ·»åŠ æ•°æ®" class="headerlink" title="æ·»åŠ æ•°æ®"></a>æ·»åŠ æ•°æ®</h3><p>æŒ‡å®šå­—æ®µï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> è¡¨å (å­—æ®µå<span class="number">1</span>, å­—æ®µå<span class="number">2</span>, ...) <span class="keyword">VALUES</span> (å€¼<span class="number">1</span>, å€¼<span class="number">2</span>, ...);</span><br></pre></td></tr></table></figure><p>å…¨éƒ¨å­—æ®µï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> è¡¨å <span class="keyword">VALUES</span> (å€¼<span class="number">1</span>, å€¼<span class="number">2</span>, ...);</span><br></pre></td></tr></table></figure><p>æ‰¹é‡æ·»åŠ æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> è¡¨å (å­—æ®µå<span class="number">1</span>, å­—æ®µå<span class="number">2</span>, ...) <span class="keyword">VALUES</span> (å€¼<span class="number">1</span>, å€¼<span class="number">2</span>, ...), (å€¼<span class="number">1</span>, å€¼<span class="number">2</span>, ...), (å€¼<span class="number">1</span>, å€¼<span class="number">2</span>, ...);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> è¡¨å <span class="keyword">VALUES</span> (å€¼<span class="number">1</span>, å€¼<span class="number">2</span>, ...), (å€¼<span class="number">1</span>, å€¼<span class="number">2</span>, ...), (å€¼<span class="number">1</span>, å€¼<span class="number">2</span>, ...);</span><br></pre></td></tr></table></figure><hr><h3 id="æ›´æ–°å’Œåˆ é™¤æ•°æ®"><a href="#æ›´æ–°å’Œåˆ é™¤æ•°æ®" class="headerlink" title="æ›´æ–°å’Œåˆ é™¤æ•°æ®"></a>æ›´æ–°å’Œåˆ é™¤æ•°æ®</h3><p>ä¿®æ”¹æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> è¡¨å <span class="keyword">SET</span> å­—æ®µå<span class="number">1</span> <span class="operator">=</span> å€¼<span class="number">1</span>, å­—æ®µå<span class="number">2</span> <span class="operator">=</span> å€¼<span class="number">2</span>, ... [ <span class="keyword">WHERE</span> æ¡ä»¶ ];</span><br></pre></td></tr></table></figure><p>åˆ é™¤æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> è¡¨å [ <span class="keyword">WHERE</span> æ¡ä»¶ ];</span><br></pre></td></tr></table></figure><hr><h3 id="æŸ¥è¯¢æ•°æ®"><a href="#æŸ¥è¯¢æ•°æ®" class="headerlink" title="æŸ¥è¯¢æ•°æ®"></a>æŸ¥è¯¢æ•°æ®</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">å­—æ®µåˆ—è¡¨</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">è¡¨åå­—æ®µ</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">æ¡ä»¶åˆ—è¡¨</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">åˆ†ç»„å­—æ®µåˆ—è¡¨</span><br><span class="line"><span class="keyword">HAVING</span></span><br><span class="line">åˆ†ç»„åçš„æ¡ä»¶åˆ—è¡¨</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">æ’åºå­—æ®µåˆ—è¡¨</span><br><span class="line">LIMIT</span><br><span class="line">åˆ†é¡µå‚æ•°</span><br></pre></td></tr></table></figure><blockquote><p>åˆ†é¡µæŸ¥è¯¢ï¼šèµ·å§‹ç´¢å¼•ä»0å¼€å§‹ï¼Œèµ·å§‹ç´¢å¼• &#x3D; ï¼ˆæŸ¥è¯¢é¡µç  - 1ï¼‰ * æ¯é¡µæ˜¾ç¤ºè®°å½•æ•°</p></blockquote><blockquote><p>UNION ALL ä¼šæœ‰é‡å¤ç»“æœï¼ŒUNION ä¸ä¼š</p><p>è”åˆæŸ¥è¯¢æ¯”ä½¿ç”¨oræ•ˆç‡é«˜ï¼Œä¸ä¼šä½¿ç´¢å¼•å¤±æ•ˆ</p></blockquote><h2 id="SQLè¯­å¥çš„æ‰§è¡Œé¡ºåº"><a href="#SQLè¯­å¥çš„æ‰§è¡Œé¡ºåº" class="headerlink" title="SQLè¯­å¥çš„æ‰§è¡Œé¡ºåº"></a>SQLè¯­å¥çš„æ‰§è¡Œé¡ºåº</h2><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230720221305377.png" alt="image-20230720221305377"></p><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><h3 id="å­—ç¬¦ä¸²å‡½æ•°"><a href="#å­—ç¬¦ä¸²å‡½æ•°" class="headerlink" title="å­—ç¬¦ä¸²å‡½æ•°"></a>å­—ç¬¦ä¸²å‡½æ•°</h3><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230721105303089.png" alt="image-20230721105303089"></p><h3 id="æ•°å€¼å‡½æ•°"><a href="#æ•°å€¼å‡½æ•°" class="headerlink" title="æ•°å€¼å‡½æ•°"></a>æ•°å€¼å‡½æ•°</h3><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230721110407627.png" alt="image-20230721110407627"></p><h3 id="æ—¥æœŸå‡½æ•°"><a href="#æ—¥æœŸå‡½æ•°" class="headerlink" title="æ—¥æœŸå‡½æ•°"></a>æ—¥æœŸå‡½æ•°</h3><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230721110713301.png" alt="image-20230721110713301"></p><h3 id="æµç¨‹æ§åˆ¶å‡½æ•°"><a href="#æµç¨‹æ§åˆ¶å‡½æ•°" class="headerlink" title="æµç¨‹æ§åˆ¶å‡½æ•°"></a>æµç¨‹æ§åˆ¶å‡½æ•°</h3><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230721113246951.png" alt="image-20230721113246951"></p><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230721113220684.png" alt="image-20230721113220684"></p><h2 id="å­æŸ¥è¯¢"><a href="#å­æŸ¥è¯¢" class="headerlink" title="å­æŸ¥è¯¢"></a>å­æŸ¥è¯¢</h2><h3 id="åˆ—å­æŸ¥è¯¢"><a href="#åˆ—å­æŸ¥è¯¢" class="headerlink" title="åˆ—å­æŸ¥è¯¢"></a>åˆ—å­æŸ¥è¯¢</h3><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230721165346891.png" alt="image-20230721165346891"></p><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230721165901787.png" alt="image-20230721165901787"></p><h3 id="è¡Œå­æŸ¥è¯¢"><a href="#è¡Œå­æŸ¥è¯¢" class="headerlink" title="è¡Œå­æŸ¥è¯¢"></a>è¡Œå­æŸ¥è¯¢</h3><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230721165718405.png" alt="image-20230721165718405"></p><h3 id="è¡¨å­æŸ¥è¯¢"><a href="#è¡¨å­æŸ¥è¯¢" class="headerlink" title="è¡¨å­æŸ¥è¯¢"></a>è¡¨å­æŸ¥è¯¢</h3><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230721172914954.png" alt="image-20230721172914954"></p><h1 id="äº‹åŠ¡ç›¸å…³çŸ¥è¯†"><a href="#äº‹åŠ¡ç›¸å…³çŸ¥è¯†" class="headerlink" title="äº‹åŠ¡ç›¸å…³çŸ¥è¯†"></a>äº‹åŠ¡ç›¸å…³çŸ¥è¯†</h1><h2 id="äº‹åŠ¡å››å¤§ç‰¹æ€§ACID"><a href="#äº‹åŠ¡å››å¤§ç‰¹æ€§ACID" class="headerlink" title="äº‹åŠ¡å››å¤§ç‰¹æ€§ACID"></a>äº‹åŠ¡å››å¤§ç‰¹æ€§ACID</h2><ol><li>A åŸå­æ€§ï¼ˆAtomicityï¼‰ ä¸€ä¸ªäº‹åŠ¡çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆéƒ½æ²¡å®Œæˆï¼Œä¸èƒ½ç»“æŸåœ¨ä¸­é—´ç¯èŠ‚ã€‚å¦‚æœäº‹åŠ¡åœ¨æ‰§â¾è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«å›æ»šåˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ </li><li>C ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ åœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰ä»¥åŠäº‹åŠ¡ç»“æŸä¹‹åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§ä¸èƒ½è¢«ç ´å </li><li>I éš”ç¦»æ€§ï¼ˆIsolationï¼‰ å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹æ•°æ®è¿›â¾ä¿®æ”¹å’Œè¯»å†™çš„èƒ½â¼’ï¼Œå®ƒå¯ä»¥é˜²æ­¢ç”±äºå¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§â¾æ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´ </li><li>D æŒä¹…æ€§ï¼ˆDurabilityï¼‰ äº‹åŠ¡å¤„ç†ç»“æŸäº†ä»¥åï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹æ˜¯æ°¸ä¹…çš„ï¼Œå³ä½¿æ˜¯å‘ç”Ÿäº†ç³»ç»Ÿæ•…éšœï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±</li></ol><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>Aå‘Bè½¬è´¦500ï¼Œè½¬è´¦æˆåŠŸï¼ŒAæ‰£é™¤500å…ƒï¼ŒBå¢åŠ 500å…ƒï¼ŒåŸå­æ“ä½œä½“ç°åœ¨è¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥</p><p>åœ¨è½¬è´¦çš„è¿‡ç¨‹ä¸­ï¼Œæ•°æ®è¦ä¸€è‡´ï¼ŒAæ‰£é™¤äº†500ï¼ŒBå¿…é¡»å¢åŠ 500</p><p>åœ¨è½¬è´¦çš„è¿‡ç¨‹ä¸­ï¼Œéš”ç¦»æ€§ä½“ç°åœ¨AåƒBè½¬è´¦ï¼Œä¸èƒ½å—å…¶ä»–äº‹åŠ¡å¹²æ‰°</p><p>åœ¨è½¬è´¦çš„è¿‡ç¨‹ä¸­ï¼ŒæŒä¹…æ€§ä½“ç°åœ¨äº‹åŠ¡æäº¤åï¼Œè¦æŠŠæ•°æ®æŒä¹…åŒ–ï¼ˆå¯ä»¥è¯´æ˜¯è½ç›˜æ“ä½œï¼‰</p><hr><h2 id="å››å¤§éš”ç¦»çº§åˆ«"><a href="#å››å¤§éš”ç¦»çº§åˆ«" class="headerlink" title="å››å¤§éš”ç¦»çº§åˆ«"></a>å››å¤§éš”ç¦»çº§åˆ«</h2><ol start="0"><li><p>æœ¯è¯­è¯´æ˜ï¼š ï¼ˆè¿™ä¸‰ä¸ªå¯ä»¥ç§°ä½œå¹¶å‘äº‹åŠ¡æ‰€å¸¦æ¥çš„é—®é¢˜ï¼‰</p><ul><li>è„è¯»ï¼š ä¸€ä¸ªäº‹åŠ¡è¯»å–å¦ä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰æäº¤çš„æ•°æ® </li><li>ä¸å¯é‡å¤è¯»ï¼š åŒä¸€ä¸ªäº‹åŠ¡å†…ï¼Œä¸¤ä¸ªç›¸åŒçš„æŸ¥è¯¢è¿”å›äº†ä¸åŒçš„ç»“æœ </li><li>å¹»è¯»ï¼šä¸€ä¸ªäº‹åŠ¡æŒ‰ç…§æ¡ä»¶æŸ¥è¯¢æ•°æ®æ—¶ï¼Œæ²¡æœ‰å¯¹åº”çš„æ•°æ®è¡Œï¼Œä½†æ˜¯åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œåˆå‘ç°è¿™è¡Œæ•°æ®å·²ç»å­˜åœ¨ï¼Œå¥½åƒå‡ºç°äº† â€œå¹»å½±â€ã€‚</li></ul></li><li><p>RU è¯»ä¸æäº¤ï¼ˆRead Uncommitedï¼‰ åœ¨è¯¥éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡ä¹‹é—´å®Œå…¨ä¸éš”ç¦»ï¼Œä¼šäº§ç”Ÿè„è¯»ï¼Œä¸€èˆ¬æƒ…å†µä¸ä¼šä½¿ç”¨ </p></li><li><p>RC è¯»æäº¤ï¼ˆRead Commitedï¼‰ æœ¬äº‹åŠ¡è¯»å–åˆ°çš„æ˜¯å…¶å®ƒäº‹åŠ¡æäº¤çš„æœ€æ–°æ•°æ®ï¼Œä½†æœ‰ä¸€ä¸ªé—®é¢˜åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå‰åä¸¤ç›¸åŒçš„selectå¯èƒ½ä¼šè¯»åˆ°ä¸åŒçš„ç»“æœ </p></li><li><p>RR å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰ åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œselectçš„ç»“æœæ˜¯äº‹åŠ¡å¼€å§‹æ—¶æ—¶é—´ç‚¹çš„çŠ¶æ€ï¼Œå› æ­¤ï¼ŒåŒä¸€ä¸ªäº‹åŠ¡åŒæ ·çš„selectæ“ä½œå¯ä»¥è¯»åˆ°ä¸€è‡´çš„ç»“æœ </p></li><li><p>serializableä¸²è¡ŒåŒ–è¯»æ“ä½œä¼šéšå¼è·å–å…±äº«é”ï¼Œä¿è¯ä¸åŒäº‹åŠ¡ä¹‹é—´çš„äº’æ–¥ </p></li><li><p>â­â­é—®é¢˜ï¼šRR å¯é‡å¤è¯»ä¸ºä»€ä¹ˆå¯ä»¥è§£å†³ä¸å¯é‡å¤è¯»ï¼Œå´ä¸èƒ½è§£å†³å¹»è¯»â­â­</p><blockquote><p>ç­”ï¼šå¯¹äºâ€å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰â€éš”ç¦»çº§åˆ«ï¼Œå®ƒç¡®å®å¯ä»¥è§£å†³â€ä¸å¯é‡å¤è¯»ï¼ˆNon-repeatable Readï¼‰â€é—®é¢˜ï¼Œå› ä¸ºåœ¨è¿™ä¸ªéš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡åœ¨æ‰§è¡ŒæœŸé—´çœ‹åˆ°çš„æ•°æ®ä¿æŒä¸€è‡´ï¼Œå³ä½¿å…¶ä»–äº‹åŠ¡åœ¨è¿™æ®µæ—¶é—´å†…è¿›è¡Œäº†æ›´æ”¹ï¼Œä¹Ÿä¸ä¼šå½±å“å½“å‰äº‹åŠ¡ã€‚</p><p>è§£å†³â€ä¸å¯é‡å¤è¯»â€é—®é¢˜çš„å…³é”®æ˜¯<strong>è¡Œçº§é”å®š</strong>ã€‚åœ¨â€å¯é‡å¤è¯»â€éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¯»å–çš„æ•°æ®è¡Œä¼šè¢«é”å®šï¼Œç¡®ä¿å…¶ä»–äº‹åŠ¡ä¸èƒ½ä¿®æ”¹æˆ–åˆ é™¤è¿™äº›æ•°æ®ï¼Œä»è€Œä¿æŒäº†æ•°æ®çš„ä¸€è‡´æ€§ï¼Œé˜²æ­¢äº†å…¶ä»–äº‹åŠ¡çš„å¹²æ‰°ã€‚</p><p>ç„¶è€Œï¼Œâ€å¯é‡å¤è¯»â€éš”ç¦»çº§åˆ«å¹¶ä¸èƒ½å®Œå…¨è§£å†³â€å¹»è¯»â€é—®é¢˜ã€‚â€å¹»è¯»â€é—®é¢˜æ˜¯ç”±äºå…¶ä»–äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡æ‰§è¡ŒæœŸé—´æ’å…¥æˆ–åˆ é™¤äº†ç¬¦åˆå½“å‰äº‹åŠ¡æŸ¥è¯¢æ¡ä»¶çš„æ–°æ•°æ®ï¼Œå¯¼è‡´æŸ¥è¯¢ç»“æœå‘ç”Ÿå˜åŒ–ã€‚<strong>åœ¨â€å¯é‡å¤è¯»â€éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¡Œçº§é”åªèƒ½ä¿æŠ¤å·²æœ‰æ•°æ®çš„è¯»å–ï¼Œä½†å¯¹äºæ–°æ•°æ®çš„æ’å…¥å’Œåˆ é™¤å¹¶ä¸ä¼šè¿›è¡Œé”å®šã€‚</strong>å› æ­¤ï¼Œå…¶ä»–äº‹åŠ¡ä»ç„¶å¯ä»¥æ’å…¥æˆ–åˆ é™¤æ–°æ•°æ®ï¼Œä»è€Œå¯¼è‡´å½“å‰äº‹åŠ¡çš„æŸ¥è¯¢ç»“æœå‘ç”Ÿå˜åŒ–ï¼Œäº§ç”Ÿäº†â€å¹»è¯»â€é—®é¢˜ã€‚</p><p>è¦è§£å†³â€å¹»è¯»â€é—®é¢˜ï¼Œéœ€è¦è¿›ä¸€æ­¥å‡çº§åˆ°æ›´é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå¦‚â€ä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰â€ã€‚åœ¨â€ä¸²è¡ŒåŒ–â€éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡ä¼šé”å®šæ•´ä¸ªèŒƒå›´ï¼ŒåŒ…æ‹¬å·²æœ‰æ•°æ®å’Œç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„æ–°æ•°æ®ï¼Œç¡®ä¿å…¶ä»–äº‹åŠ¡ä¸èƒ½æ’å…¥æˆ–åˆ é™¤è¿™äº›æ•°æ®ï¼Œä»è€Œå®Œå…¨æ¶ˆé™¤äº†â€å¹»è¯»â€é—®é¢˜ã€‚ä½†æ˜¯ï¼Œâ€ä¸²è¡ŒåŒ–â€éš”ç¦»çº§åˆ«çš„æ€§èƒ½è¾ƒä½ï¼Œå› ä¸ºå®ƒé™åˆ¶äº†å¹¶å‘æ€§ï¼Œæ‰€ä»¥åœ¨å®é™…åº”ç”¨ä¸­éœ€è¦æƒè¡¡éš”ç¦»çº§åˆ«å’Œæ€§èƒ½çš„éœ€æ±‚ã€‚</p></blockquote></li></ol><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230722210501764.png" alt="image-20230722210501764"></p><h1 id="å­˜å‚¨å¼•æ“"><a href="#å­˜å‚¨å¼•æ“" class="headerlink" title="å­˜å‚¨å¼•æ“"></a>å­˜å‚¨å¼•æ“</h1><h2 id="MySQLä½“ç³»ç»“æ„"><a href="#MySQLä½“ç³»ç»“æ„" class="headerlink" title="MySQLä½“ç³»ç»“æ„"></a>MySQLä½“ç³»ç»“æ„</h2><p>MySQLçš„åŸºæœ¬æ¶æ„å›¾ï¼š</p><p><img src="/../assets/Study-MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/3C9FE07201CDB72A1EC1005177958F75.jpeg" alt="MySQLçš„åŸºæœ¬æ¶æ„"></p><blockquote><p>åˆ†æå™¨ç”¨äºåˆ¤æ–­ä½ çš„SQLè¯­å¥æ˜¯å¦æœ‰é”™ï¼Œä¼˜åŒ–å™¨å¯ä»¥å¤„ç†åˆ°åº•ä½¿ç”¨å“ªäº›ç´¢å¼•ï¼Œå’Œå…ˆè¿æ¥å“ªäº›è¡¨</p></blockquote><p>ç¤ºä¾‹å›¾ï¼š</p><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230724164107248.png" alt="MySQLä½“ç³»ç»“æ„å›¾"></p><p>åŒ…æ‹¬å››ä¸ªå±‚ï¼š</p><ol><li><strong>è¿æ¥å±‚</strong> æœ€ä¸Šå±‚æ˜¯ä¸€äº›å®¢æˆ·ç«¯å’Œé“¾æ¥æœåŠ¡ï¼ŒåŒ…å«æœ¬åœ°sock é€šä¿¡å’Œå¤§å¤šæ•°åŸºäºå®¢æˆ·ç«¯&#x2F;æœåŠ¡ç«¯å·¥å…·å®ç°çš„ç±»ä¼¼äº TCP&#x2F;IPçš„é€šä¿¡ã€‚ä¸»è¦å®Œæˆä¸€äº›ç±»ä¼¼äºè¿æ¥å¤„ç†ã€æˆæƒè®¤è¯ã€åŠç›¸å…³çš„å®‰å…¨æ–¹æ¡ˆã€‚åœ¨è¯¥å±‚ä¸Šå¼•å…¥äº†çº¿ç¨‹ æ± çš„æ¦‚å¿µï¼Œä¸ºé€šè¿‡è®¤è¯å®‰å…¨æ¥å…¥çš„å®¢æˆ·ç«¯æä¾›çº¿ç¨‹ã€‚åŒæ ·åœ¨è¯¥å±‚ä¸Šå¯ä»¥å®ç°åŸºäºSSLçš„å®‰å…¨é“¾æ¥ã€‚æœåŠ¡ å™¨ä¹Ÿä¼šä¸ºå®‰å…¨æ¥å…¥çš„æ¯ä¸ªå®¢æˆ·ç«¯éªŒè¯å®ƒæ‰€å…·æœ‰çš„æ“ä½œæƒé™ã€‚ </li><li><strong>æœåŠ¡å±‚</strong> ç¬¬äºŒå±‚æ¶æ„ä¸»è¦å®Œæˆå¤§å¤šæ•°çš„æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œå¦‚SQLæ¥å£ï¼Œå¹¶å®Œæˆç¼“å­˜çš„æŸ¥è¯¢ï¼ŒSQLçš„åˆ†æå’Œä¼˜åŒ–ï¼Œéƒ¨ åˆ†å†…ç½®å‡½æ•°çš„æ‰§è¡Œã€‚æ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½ä¹Ÿåœ¨è¿™ä¸€å±‚å®ç°ï¼Œå¦‚ è¿‡ç¨‹ã€å‡½æ•°ç­‰ã€‚åœ¨è¯¥å±‚ï¼ŒæœåŠ¡å™¨ä¼šè§£ ææŸ¥è¯¢å¹¶åˆ›å»ºç›¸åº”çš„å†…éƒ¨è§£ææ ‘ï¼Œå¹¶å¯¹å…¶å®Œæˆç›¸åº”çš„ä¼˜åŒ–å¦‚ç¡®å®šè¡¨çš„æŸ¥è¯¢çš„é¡ºåºï¼Œæ˜¯å¦åˆ©ç”¨ç´¢å¼•ç­‰ï¼Œ æœ€åç”Ÿæˆç›¸åº”çš„æ‰§è¡Œæ“ä½œã€‚å¦‚æœæ˜¯selectè¯­å¥ï¼ŒæœåŠ¡å™¨è¿˜ä¼šæŸ¥è¯¢å†…éƒ¨çš„ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ç©ºé—´è¶³å¤Ÿå¤§ï¼Œ è¿™æ ·åœ¨è§£å†³å¤§é‡è¯»æ“ä½œçš„ç¯å¢ƒä¸­èƒ½å¤Ÿå¾ˆå¥½çš„æå‡ç³»ç»Ÿçš„æ€§èƒ½ã€‚ </li><li><strong>å¼•æ“å±‚</strong> å­˜å‚¨å¼•æ“å±‚ï¼Œ å­˜å‚¨å¼•æ“çœŸæ­£çš„è´Ÿè´£äº†MySQLä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ï¼ŒæœåŠ¡å™¨é€šè¿‡APIå’Œå­˜å‚¨å¼•æ“è¿›è¡Œé€š ä¿¡ã€‚ä¸åŒçš„å­˜å‚¨å¼•æ“å…·æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œæ¥é€‰å–åˆé€‚çš„å­˜å‚¨å¼•æ“ã€‚æ•°æ®åº“ ä¸­çš„ç´¢å¼•æ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚å®ç°çš„ã€‚ </li><li><strong>å­˜å‚¨å±‚</strong> æ•°æ®å­˜å‚¨å±‚ï¼Œ ä¸»è¦æ˜¯å°†æ•°æ®(å¦‚: redologã€undologã€æ•°æ®ã€ç´¢å¼•ã€äºŒè¿›åˆ¶æ—¥å¿—ã€é”™è¯¯æ—¥å¿—ã€æŸ¥è¯¢ æ—¥å¿—ã€æ…¢æŸ¥è¯¢æ—¥å¿—ç­‰)å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Šï¼Œå¹¶å®Œæˆä¸å­˜å‚¨å¼•æ“çš„äº¤äº’ã€‚</li></ol><p><strong>å­˜å‚¨å¼•æ“å°±æ˜¯å­˜å‚¨æ•°æ®ã€å»ºç«‹ç´¢å¼•ã€æ›´æ–°&#x2F;æŸ¥è¯¢æ•°æ®ç­‰æŠ€æœ¯çš„å®ç°æ–¹å¼ ã€‚å­˜å‚¨å¼•æ“æ˜¯åŸºäºè¡¨çš„ï¼Œè€Œä¸æ˜¯ åŸºäºåº“çš„ï¼Œæ‰€ä»¥å­˜å‚¨å¼•æ“ä¹Ÿå¯è¢«ç§°ä¸ºè¡¨ç±»å‹ã€‚</strong></p><h2 id="å­˜å‚¨å¼•æ“ç±»å‹"><a href="#å­˜å‚¨å¼•æ“ç±»å‹" class="headerlink" title="å­˜å‚¨å¼•æ“ç±»å‹"></a>å­˜å‚¨å¼•æ“ç±»å‹</h2><h3 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h3><ol><li>ç‰¹ç‚¹</li></ol><ul><li><p>DMLæ“ä½œéµå¾ªACIDæ¨¡å‹ï¼Œæ”¯æŒäº‹åŠ¡ï¼›</p></li><li><p>è¡Œçº§é”ï¼Œæé«˜å¹¶å‘è®¿é—®æ€§èƒ½ï¼› </p></li><li><p>æ”¯æŒå¤–é”®FOREIGN KEYçº¦æŸï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ï¼›</p></li></ul><ol start="2"><li>æ–‡ä»¶</li></ol><p>xxx.ibdï¼šxxxä»£è¡¨çš„æ˜¯è¡¨åï¼ŒinnoDBå¼•æ“çš„æ¯å¼ è¡¨éƒ½ä¼šå¯¹åº”è¿™æ ·ä¸€ä¸ªè¡¨ç©ºé—´æ–‡ä»¶ï¼Œå­˜å‚¨è¯¥è¡¨çš„è¡¨ç»“ æ„ï¼ˆfrm-æ—©æœŸçš„ ã€sdi-æ–°ç‰ˆçš„ï¼‰ã€æ•°æ®å’Œç´¢å¼•ã€‚</p><ol start="3"><li>é€»è¾‘å­˜å‚¨ç»“æ„</li></ol><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230724164013431.png" alt="é€»è¾‘å­˜å‚¨ç»“æ„å›¾"></p><ul><li>è¡¨ç©ºé—´ : InnoDBå­˜å‚¨å¼•æ“é€»è¾‘ç»“æ„çš„æœ€é«˜å±‚ï¼Œibdæ–‡ä»¶å…¶å®å°±æ˜¯è¡¨ç©ºé—´æ–‡ä»¶ï¼Œåœ¨è¡¨ç©ºé—´ä¸­å¯ä»¥ åŒ…å«å¤šä¸ªSegmentæ®µã€‚ </li><li>æ®µ : è¡¨ç©ºé—´æ˜¯ç”±å„ä¸ªæ®µç»„æˆçš„ï¼Œ å¸¸è§çš„æ®µæœ‰æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µç­‰ã€‚InnoDBä¸­å¯¹äºæ®µçš„ç®¡ ç†ï¼Œéƒ½æ˜¯å¼•æ“è‡ªèº«å®Œæˆï¼Œä¸éœ€è¦äººä¸ºå¯¹å…¶æ§åˆ¶ï¼Œä¸€ä¸ªæ®µä¸­åŒ…å«å¤šä¸ªåŒºã€‚ </li><li>åŒº : åŒºæ˜¯è¡¨ç©ºé—´çš„å•å…ƒç»“æ„ï¼Œæ¯ä¸ªåŒºçš„å¤§å°ä¸º1Mã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ InnoDBå­˜å‚¨å¼•æ“é¡µå¤§å°ä¸º 16Kï¼Œ å³ä¸€ä¸ªåŒºä¸­ä¸€å…±æœ‰64ä¸ªè¿ç»­çš„é¡µã€‚ </li><li>é¡µ : é¡µæ˜¯ç»„æˆåŒºçš„æœ€å°å•å…ƒï¼Œé¡µä¹Ÿæ˜¯InnoDB å­˜å‚¨å¼•æ“ç£ç›˜ç®¡ç†çš„æœ€å°å•å…ƒï¼Œæ¯ä¸ªé¡µçš„å¤§å°é»˜ è®¤ä¸º 16KBã€‚ä¸ºäº†ä¿è¯é¡µçš„è¿ç»­æ€§ï¼ŒInnoDB å­˜å‚¨å¼•æ“æ¯æ¬¡ä»ç£ç›˜ç”³è¯· 4-5 ä¸ªåŒºã€‚ </li><li>è¡Œ : InnoDB å­˜å‚¨å¼•æ“æ˜¯é¢å‘è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®æ˜¯æŒ‰è¡Œè¿›è¡Œå­˜æ”¾çš„ï¼Œåœ¨æ¯ä¸€è¡Œä¸­é™¤äº†å®šä¹‰è¡¨æ—¶ æ‰€æŒ‡å®šçš„å­—æ®µä»¥å¤–ï¼Œè¿˜åŒ…å«ä¸¤ä¸ªéšè—å­—æ®µ(åé¢ä¼šè¯¦ç»†ä»‹ç»)ã€‚</li></ul><hr><h3 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h3><ol><li>ç‰¹ç‚¹</li></ol><ul><li><p>ä¸æ”¯æŒäº‹åŠ¡ï¼Œä¸æ”¯æŒå¤–é”®</p></li><li><p>æ”¯æŒè¡¨é”ï¼Œä¸æ”¯æŒè¡Œé”</p></li><li><p>è®¿é—®é€Ÿåº¦å¿«</p></li></ul><ol start="2"><li>æ–‡ä»¶</li></ol><ul><li><p>xxx.sdiï¼šå­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯ </p></li><li><p>xxx.MYD: å­˜å‚¨æ•°æ® </p></li><li><p>xxx.MYI: å­˜å‚¨ç´¢å¼•</p></li></ul><hr><h3 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h3><p>Memoryå¼•æ“çš„è¡¨æ•°æ®æ—¶å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œç”±äºå—åˆ°ç¡¬ä»¶é—®é¢˜ã€æˆ–æ–­ç”µé—®é¢˜çš„å½±å“ï¼Œåªèƒ½å°†è¿™äº›è¡¨ä½œä¸º ä¸´æ—¶è¡¨æˆ–ç¼“å­˜ä½¿ç”¨ã€‚</p><ol><li>ç‰¹ç‚¹</li></ol><ul><li><p>å†…å­˜å­˜æ”¾</p></li><li><p>hashç´¢å¼•ï¼ˆé»˜è®¤ï¼‰</p></li></ul><ol start="2"><li>æ–‡ä»¶</li></ol><ul><li>xxx.sdiï¼šå­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯</li></ul><h3 id="ä¸‰ç§å¸¸è§å­˜å‚¨å¼•æ“åŒºåˆ«ä¸å¯¹æ¯”"><a href="#ä¸‰ç§å¸¸è§å­˜å‚¨å¼•æ“åŒºåˆ«ä¸å¯¹æ¯”" class="headerlink" title="ä¸‰ç§å¸¸è§å­˜å‚¨å¼•æ“åŒºåˆ«ä¸å¯¹æ¯”"></a>ä¸‰ç§å¸¸è§å­˜å‚¨å¼•æ“åŒºåˆ«ä¸å¯¹æ¯”</h3><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230724202707479.png" alt="ä¸‰ç§å¸¸è§å­˜å‚¨å¼•æ“åŒºåˆ«ä¸å¯¹æ¯”"></p><p>é‡ç‚¹å¯¹æ¯”InnoDBå’ŒMyISAMï¼Œåˆ†åˆ«æ˜¯<strong>äº‹åŠ¡ï¼Œå¤–é”®å’Œé”æœºåˆ¶çš„åŒºåˆ«</strong>ã€‚</p><h1 id="ç´¢å¼•â­â­"><a href="#ç´¢å¼•â­â­" class="headerlink" title="ç´¢å¼•â­â­"></a>ç´¢å¼•â­â­</h1><h2 id="ç´¢å¼•æ¦‚è¿°"><a href="#ç´¢å¼•æ¦‚è¿°" class="headerlink" title="ç´¢å¼•æ¦‚è¿°"></a>ç´¢å¼•æ¦‚è¿°</h2><p>ç´¢å¼•ï¼ˆindexï¼‰æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„(æœ‰åº)ã€‚åœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤ç€æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œ è¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„ ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³•ï¼Œè¿™ç§æ•°æ®ç»“æ„å°±æ˜¯ç´¢å¼•ã€‚</p><table><thead><tr><th>ä¼˜åŠ¿</th><th>åŠ£åŠ¿</th></tr></thead><tbody><tr><td>æé«˜æ•°æ®æ£€ç´¢çš„æ•ˆç‡ï¼Œé™ä½æ•°æ®åº“ çš„IOæˆæœ¬</td><td>ç´¢å¼•åˆ—ä¹Ÿæ˜¯è¦å ç”¨ç©ºé—´çš„ã€‚</td></tr><tr><td>é€šè¿‡ç´¢å¼•åˆ—å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œé™ä½ æ•°æ®æ’åºçš„æˆæœ¬ï¼Œé™ä½CPUçš„æ¶ˆ è€—ã€‚</td><td>ç´¢å¼•å¤§å¤§æé«˜äº†æŸ¥è¯¢æ•ˆç‡ï¼ŒåŒæ—¶å´ä¹Ÿé™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦ï¼Œ å¦‚å¯¹è¡¨è¿›è¡ŒINSERTã€UPDATEã€DELETEæ—¶ï¼Œæ•ˆç‡é™ä½ã€‚</td></tr></tbody></table><h2 id="ç´¢å¼•ç»“æ„"><a href="#ç´¢å¼•ç»“æ„" class="headerlink" title="ç´¢å¼•ç»“æ„"></a>ç´¢å¼•ç»“æ„</h2><blockquote><p>MySQLé»˜è®¤æ˜¯B+Treeç»“æ„</p></blockquote><h3 id="B-Tree-B-Tree"><a href="#B-Tree-B-Tree" class="headerlink" title="B-Tree&amp;B+Tree"></a>B-Tree&amp;B+Tree</h3><p>B-Treeå›¾ï¼š</p><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230730174758649.png" alt="B-Treeå›¾"></p><hr><p>B+Treeå›¾ï¼š</p><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230730174633933.png" alt="B+Treeå›¾"></p><p>B+Tree ä¸ B-Treeç›¸æ¯”ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç‚¹åŒºåˆ«ï¼š </p><ul><li>æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šå‡ºç°åœ¨å¶å­èŠ‚ç‚¹ã€‚ </li><li>å¶å­èŠ‚ç‚¹å½¢æˆä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚ </li><li>éå¶å­èŠ‚ç‚¹ä»…ä»…èµ·åˆ°ç´¢å¼•æ•°æ®ä½œç”¨ï¼Œå…·ä½“çš„æ•°æ®éƒ½æ˜¯åœ¨å¶å­èŠ‚ç‚¹å­˜æ”¾çš„ã€‚</li></ul><p><strong>MySQLç´¢å¼•æ•°æ®ç»“æ„å¯¹ç»å…¸çš„B+Treeè¿›è¡Œäº†ä¼˜åŒ–ã€‚åœ¨åŸB+Treeçš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ªæŒ‡å‘ç›¸é‚»å¶å­èŠ‚ç‚¹ çš„é“¾è¡¨æŒ‡é’ˆï¼Œå°±å½¢æˆäº†å¸¦æœ‰é¡ºåºæŒ‡é’ˆçš„B+Treeï¼Œæé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ï¼Œåˆ©äºæ’åºã€‚</strong></p><h3 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h3><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230730175227025.png" alt="hashç´¢å¼•å›¾"></p><p>ç‰¹ç‚¹ï¼š</p><ol><li><p>Hashç´¢å¼•åªèƒ½ç”¨äºå¯¹ç­‰æ¯”è¾ƒ(&#x3D;ï¼Œin)ï¼Œä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ˆbetweenï¼Œ&gt;ï¼Œ&lt; ï¼Œâ€¦ï¼‰ </p></li><li><p>æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆæ’åºæ“ä½œ </p></li><li><p>æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œé€šå¸¸(ä¸å­˜åœ¨hashå†²çªçš„æƒ…å†µ)åªéœ€è¦ä¸€æ¬¡æ£€ç´¢å°±å¯ä»¥äº†ï¼Œæ•ˆç‡é€šå¸¸è¦é«˜äºB+treeç´¢ å¼•</p></li></ol><h3 id="æ€è€ƒé¢˜"><a href="#æ€è€ƒé¢˜" class="headerlink" title="æ€è€ƒé¢˜"></a>æ€è€ƒé¢˜</h3><blockquote><p>ä¸ºä»€ä¹ˆInnoDBå­˜å‚¨å¼•æ“é€‰æ‹©ä½¿ç”¨B+treeç´¢å¼•ç»“æ„?</p></blockquote><ol><li>ç›¸å¯¹äºäºŒå‰æ ‘ï¼Œå±‚çº§æ›´å°‘ï¼Œæœç´¢æ•ˆç‡é«˜ï¼› ï¼ˆB+æ ‘ä¸‰å±‚å°±èƒ½å­˜æ”¾2200wçš„æ•°æ®ï¼‰</li><li>å¯¹äºB-treeï¼Œæ— è®ºæ˜¯å¶å­èŠ‚ç‚¹è¿˜æ˜¯éå¶å­èŠ‚ç‚¹ï¼Œéƒ½ä¼šä¿å­˜æ•°æ®ï¼Œè¿™æ ·å¯¼è‡´ä¸€é¡µä¸­å­˜å‚¨çš„é”®å€¼å‡å°‘ï¼ŒæŒ‡é’ˆè·Ÿç€å‡å°‘ï¼Œè¦åŒæ ·ä¿å­˜å¤§é‡æ•°æ®ï¼Œåªèƒ½å¢åŠ æ ‘çš„é«˜åº¦ï¼Œå¯¼è‡´æ€§èƒ½é™ä½ï¼› </li><li>ç›¸å¯¹Hashç´¢å¼•ï¼ŒB+treeæ”¯æŒèŒƒå›´åŒ¹é…åŠæ’åºæ“ä½œï¼›</li></ol><h2 id="ç´¢å¼•åˆ†ç±»"><a href="#ç´¢å¼•åˆ†ç±»" class="headerlink" title="ç´¢å¼•åˆ†ç±»"></a>ç´¢å¼•åˆ†ç±»</h2><table><thead><tr><th>åˆ†ç±»</th><th>å«ä¹‰</th><th>ç‰¹ç‚¹</th><th>å…³é”®å­—</th></tr></thead><tbody><tr><td>ä¸»é”®ç´¢å¼•</td><td>é’ˆå¯¹äºè¡¨ä¸­ä¸»é”®åˆ›å»ºçš„ç´¢å¼•</td><td>é»˜è®¤è‡ªåŠ¨åˆ›å»º, åªèƒ½æœ‰ä¸€ä¸ª</td><td><code>PRIMARY</code></td></tr><tr><td>å”¯ä¸€ç´¢å¼•</td><td>é¿å…åŒä¸€ä¸ªè¡¨ä¸­æŸæ•°æ®åˆ—ä¸­çš„å€¼é‡å¤</td><td>å¯ä»¥æœ‰å¤šä¸ª</td><td><code>UNIQUE</code></td></tr><tr><td>å¸¸è§„ç´¢å¼•</td><td>å¿«é€Ÿå®šä½ç‰¹å®šæ•°æ®</td><td>å¯ä»¥æœ‰å¤šä¸ª</td><td></td></tr><tr><td>å…¨æ–‡ç´¢å¼•</td><td>å…¨æ–‡ç´¢å¼•æŸ¥æ‰¾çš„æ˜¯æ–‡æœ¬ä¸­çš„å…³é”®è¯ï¼Œè€Œä¸æ˜¯æ¯”è¾ƒç´¢å¼•ä¸­çš„å€¼</td><td>å¯ä»¥æœ‰å¤šä¸ª</td><td><code>FULLTEXT</code></td></tr></tbody></table><hr><table><thead><tr><th>åˆ†ç±»</th><th>å«ä¹‰</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>èšé›†ç´¢å¼•</td><td>å°†æ•°æ®å­˜å‚¨ä¸ç´¢å¼•æ”¾åˆ°äº†ä¸€å—ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹ä¿å­˜äº†è¡Œæ•°æ®</td><td>å¿…é¡»æœ‰,è€Œä¸”åªæœ‰ä¸€ä¸ª</td></tr><tr><td>äºŒçº§ç´¢å¼•</td><td>å°†æ•°æ®ä¸ç´¢å¼•åˆ†å¼€å­˜å‚¨ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹å…³è”çš„æ˜¯å¯¹åº”çš„ä¸»é”®</td><td>å¯ä»¥å­˜åœ¨å¤šä¸ª</td></tr></tbody></table><p><strong>èšé›†ç´¢å¼•é€‰å–è§„åˆ™:</strong> </p><ul><li>å¦‚æœå­˜åœ¨ä¸»é”®ï¼Œä¸»é”®ç´¢å¼•å°±æ˜¯èšé›†ç´¢å¼•ã€‚ </li><li>å¦‚æœä¸å­˜åœ¨ä¸»é”®ï¼Œå°†ä½¿ç”¨ç¬¬ä¸€ä¸ªå”¯ä¸€ï¼ˆUNIQUEï¼‰ç´¢å¼•ä½œä¸ºèšé›†ç´¢å¼•ã€‚ </li><li>å¦‚æœè¡¨æ²¡æœ‰ä¸»é”®ï¼Œæˆ–æ²¡æœ‰åˆé€‚çš„å”¯ä¸€ç´¢å¼•ï¼Œåˆ™InnoDBä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªrowidä½œä¸ºéšè—çš„èšé›†ç´¢ å¼•ã€‚</li></ul><h3 id="æ‰§è¡Œæµç¨‹"><a href="#æ‰§è¡Œæµç¨‹" class="headerlink" title="æ‰§è¡Œæµç¨‹"></a>æ‰§è¡Œæµç¨‹</h3><p>æ‰§è¡ŒSQLè¯­å¥çš„å…·ä½“æµç¨‹å¦‚å›¾ï¼š</p><ol><li>å…ˆåœ¨äºŒçº§ç´¢å¼•å¤„æŸ¥åˆ°name&#x3D;Arm</li><li>å†æŠŠåœ¨äºŒçº§ç´¢å¼•å¤„æŸ¥åˆ°çš„å¯¹åº”çš„idé€šè¿‡å›æ ‡æŸ¥è¯¢æ¥åˆ°èšé›†ç´¢å¼•å¤„</li><li>å¾—åˆ°idåœ¨é€šè¿‡èšé›†ç´¢å¼•æŸ¥åˆ°è¡Œæ•°æ®</li></ol><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230730195655768.png" alt="å›è¡¨æŸ¥è¯¢å›¾"></p><blockquote><p>å›è¡¨æŸ¥è¯¢ï¼š è¿™ç§å…ˆåˆ°äºŒçº§ç´¢å¼•ä¸­æŸ¥æ‰¾æ•°æ®ï¼Œæ‰¾åˆ°ä¸»é”®å€¼ï¼Œç„¶åå†åˆ°èšé›†ç´¢å¼•ä¸­æ ¹æ®ä¸»é”®å€¼ï¼Œè·å–æ•°æ®çš„æ–¹å¼ï¼Œå°±ç§°ä¹‹ä¸ºå›è¡¨æŸ¥è¯¢ã€‚</p></blockquote><h3 id="æ€è€ƒé¢˜-1"><a href="#æ€è€ƒé¢˜-1" class="headerlink" title="æ€è€ƒé¢˜"></a>æ€è€ƒé¢˜</h3><p>ä»¥ä¸‹ä¸¤æ¡SQLè¯­å¥ï¼Œé‚£ä¸ªæ‰§è¡Œæ•ˆç‡é«˜? ä¸ºä»€ä¹ˆ? </p><p>A. select * from user where id &#x3D; 10 ; </p><p>B. select * from user where name &#x3D; â€˜Armâ€™ ; </p><p>å¤‡æ³¨: idä¸ºä¸»é”®ï¼Œnameå­—æ®µåˆ›å»ºçš„æœ‰ç´¢å¼•ï¼›</p><blockquote><p>è§£ç­”ï¼š A è¯­å¥çš„æ‰§è¡Œæ€§èƒ½è¦é«˜äºB è¯­å¥ã€‚ å› ä¸ºAè¯­å¥ç›´æ¥èµ°èšé›†ç´¢å¼•ï¼Œç›´æ¥è¿”å›æ•°æ®ã€‚ è€ŒBè¯­å¥éœ€è¦å…ˆæŸ¥è¯¢nameå­—æ®µçš„äºŒçº§ç´¢å¼•ï¼Œç„¶ åå†æŸ¥è¯¢èšé›†ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯éœ€è¦è¿›è¡Œå›è¡¨æŸ¥è¯¢ã€‚</p></blockquote><h2 id="ç´¢å¼•è¯­æ³•"><a href="#ç´¢å¼•è¯­æ³•" class="headerlink" title="ç´¢å¼•è¯­æ³•"></a>ç´¢å¼•è¯­æ³•</h2><ol><li>åˆ›å»ºç´¢å¼•</li></ol><p>åˆ›å»ºçš„ç´¢å¼•åä¸€èˆ¬å‘½åä¸º<code>idx_è¡¨å_å­—æ®µå</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [ <span class="keyword">UNIQUE</span> <span class="operator">|</span> FULLTEXT ] INDEX index_name <span class="keyword">ON</span> table_name (index_col_name,... ) ;</span><br></pre></td></tr></table></figure><ol start="2"><li>æŸ¥çœ‹ç´¢å¼•</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> table_name ;</span><br></pre></td></tr></table></figure><ol start="3"><li>åˆ é™¤ç´¢å¼•</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX index_name <span class="keyword">ON</span> table_name ;</span><br></pre></td></tr></table></figure><h2 id="SQLæ€§èƒ½åˆ†æ"><a href="#SQLæ€§èƒ½åˆ†æ" class="headerlink" title="SQLæ€§èƒ½åˆ†æ"></a>SQLæ€§èƒ½åˆ†æ</h2><p>å¯é€šè¿‡æŸ¥çœ‹SQLæ‰§è¡Œé¢‘ç‡ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œprofileè¯¦æƒ…å’Œexplainæ–¹æ³•æ¥åˆ†æå“ªä¸ªSQLè¯­å¥çš„æ‰§è¡Œé€Ÿåº¦æ…¢ã€‚</p><h3 id="explainï¼ˆé‡ç‚¹æŒæ¡ï¼‰"><a href="#explainï¼ˆé‡ç‚¹æŒæ¡ï¼‰" class="headerlink" title="explainï¼ˆé‡ç‚¹æŒæ¡ï¼‰"></a>explainï¼ˆé‡ç‚¹æŒæ¡ï¼‰</h3><p>Explain æ‰§è¡Œè®¡åˆ’ä¸­å„ä¸ªå­—æ®µçš„å«ä¹‰:</p><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>id</td><td>selectæŸ¥è¯¢çš„åºåˆ—å·ï¼Œè¡¨ç¤ºæŸ¥è¯¢ä¸­æ‰§è¡Œselectå­å¥æˆ–è€…æ˜¯æ“ä½œè¡¨çš„é¡ºåº (idç›¸åŒï¼Œæ‰§è¡Œé¡ºåºä»ä¸Šåˆ°ä¸‹ï¼›idä¸åŒï¼Œ<strong>å€¼è¶Šå¤§ï¼Œè¶Šå…ˆæ‰§è¡Œ</strong>)ã€‚</td></tr><tr><td>select_type</td><td>è¡¨ç¤º SELECT çš„ç±»å‹ï¼Œå¸¸è§çš„å–å€¼æœ‰ SIMPLEï¼ˆç®€å•è¡¨ï¼Œå³ä¸ä½¿ç”¨è¡¨è¿æ¥ æˆ–è€…å­æŸ¥è¯¢ï¼‰ã€PRIMARYï¼ˆä¸»æŸ¥è¯¢ï¼Œå³å¤–å±‚çš„æŸ¥è¯¢ï¼‰ã€ UNIONï¼ˆUNION ä¸­çš„ç¬¬äºŒä¸ªæˆ–è€…åé¢çš„æŸ¥è¯¢è¯­å¥ï¼‰ã€ SUBQUERYï¼ˆSELECT&#x2F;WHEREä¹‹ååŒ…å«äº†å­æŸ¥è¯¢ï¼‰ç­‰</td></tr><tr><td>type</td><td>è¡¨ç¤ºè¿æ¥ç±»å‹ï¼Œæ€§èƒ½ç”±å¥½åˆ°å·®çš„è¿æ¥ç±»å‹ä¸ºNULLã€systemã€constã€ eq_refã€refã€rangeã€ indexã€all ã€‚</td></tr><tr><td>possible_key</td><td>æ˜¾ç¤ºå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸Šçš„ç´¢å¼•ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªã€‚</td></tr><tr><td>key</td><td>å®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œå¦‚æœä¸ºNULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚</td></tr><tr><td>key_len</td><td>è¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œ è¯¥å€¼ä¸ºç´¢å¼•å­—æ®µæœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿ åº¦ï¼Œåœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„å‰æä¸‹ï¼Œ é•¿åº¦è¶ŠçŸ­è¶Šå¥½ ã€‚</td></tr><tr><td>rows</td><td>MySQLè®¤ä¸ºå¿…é¡»è¦æ‰§è¡ŒæŸ¥è¯¢çš„è¡Œæ•°ï¼Œåœ¨innodbå¼•æ“çš„è¡¨ä¸­ï¼Œæ˜¯ä¸€ä¸ªä¼°è®¡å€¼ï¼Œ å¯èƒ½å¹¶ä¸æ€»æ˜¯å‡†ç¡®çš„ã€‚</td></tr><tr><td>filtered</td><td>è¡¨ç¤ºè¿”å›ç»“æœçš„è¡Œæ•°å éœ€è¯»å–è¡Œæ•°çš„ç™¾åˆ†æ¯”ï¼Œ filtered çš„å€¼è¶Šå¤§è¶Šå¥½ã€‚</td></tr><tr><td>extra</td><td>é¢å¤–ä¿¡æ¯ï¼Œä¾‹å¦‚Using indexç­‰</td></tr></tbody></table><p>ğŸŸ¡ğŸŸ¢ğŸ”´è¡¥å……ï¼š</p><p>åœ¨ä½¿ç”¨ <code>EXPLAIN</code> å…³é”®å­—åˆ†æ MySQL æŸ¥è¯¢è®¡åˆ’æ—¶ï¼Œä»¥ä¸‹å­—æ®µæ˜¯é‡ç‚¹å…³æ³¨çš„ï¼Œå®ƒä»¬èƒ½å¤Ÿæä¾›å…³äºæŸ¥è¯¢æ‰§è¡Œçš„é‡è¦ä¿¡æ¯ï¼š</p><ol><li><p><strong>type</strong>: è¿æ¥ç±»å‹ã€‚å®ƒæŒ‡ç¤ºäº†è¡¨è¿æ¥çš„æ–¹æ³•ï¼Œæ˜¯æœ€é‡è¦çš„å­—æ®µä¹‹ä¸€ã€‚å…³æ³¨å®ƒå¯ä»¥äº†è§£æŸ¥è¯¢æ˜¯å¦é«˜æ•ˆã€‚å¸¸è§ç±»å‹æŒ‰æ•ˆç‡ä»é«˜åˆ°ä½æ’åºï¼š</p><ul><li><code>const</code>&#x2F;<code>system</code></li><li><code>eq_ref</code></li><li><code>ref</code></li><li><code>range</code></li><li><code>index</code></li><li><code>ALL</code></li></ul><p>å…¶ä¸­ï¼Œ<code>ALL</code> è¡¨ç¤ºå…¨è¡¨æ‰«æï¼Œé€šå¸¸éœ€è¦ä¼˜åŒ–ã€‚</p></li><li><p><strong>key</strong>: å®é™…ä½¿ç”¨çš„ç´¢å¼•ã€‚è¿™ä¸ªå­—æ®µå‘Šè¯‰ä½ æŸ¥è¯¢å®é™…ä½¿ç”¨äº†å“ªä¸ªç´¢å¼•ï¼Œå¦‚æœä¸º <code>NULL</code>ï¼Œè¯´æ˜æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œå¯èƒ½éœ€è¦æ·»åŠ æˆ–ä¿®æ”¹ç´¢å¼•ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚</p></li><li><p><strong>rows</strong>: ä¼°è®¡éœ€è¦è¯»å–çš„è¡Œæ•°ã€‚è¿™ä¸ªå­—æ®µè¡¨ç¤ºä¼˜åŒ–å™¨ä¼°ç®—éœ€è¦æ‰«æçš„è¡Œæ•°ã€‚è¡Œæ•°è¶Šå°‘ï¼ŒæŸ¥è¯¢é€šå¸¸è¶Šé«˜æ•ˆã€‚å¦‚æœè¡Œæ•°å¾ˆå¤§ï¼Œå¯èƒ½éœ€è¦é‡æ–°è€ƒè™‘æŸ¥è¯¢æ–¹å¼æˆ–ç´¢å¼•ã€‚</p></li><li><p><strong>Extra</strong>: é™„åŠ ä¿¡æ¯ã€‚è¿™ä¸ªå­—æ®µæä¾›äº†å…³äºæŸ¥è¯¢æ‰§è¡Œçš„é¢å¤–ä¿¡æ¯ï¼Œå¸¸è§çš„å€¼æœ‰ï¼š</p><ul><li><code>Using where</code>: è¡¨ç¤ºä½¿ç”¨äº† WHERE æ¡ä»¶è¿›è¡Œè¿‡æ»¤ã€‚</li><li><code>Using index</code>: è¡¨ç¤ºä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼ŒæŸ¥è¯¢åªè®¿é—®äº†ç´¢å¼•æ ‘è€Œæ²¡æœ‰è®¿é—®æ•°æ®è¡Œã€‚</li><li><code>Using temporary</code>: è¡¨ç¤ºæŸ¥è¯¢ä½¿ç”¨äº†ä¸´æ—¶è¡¨ï¼Œé€šå¸¸æ„å‘³ç€éœ€è¦ä¼˜åŒ–ã€‚</li><li><code>Using filesort</code>: è¡¨ç¤º MySQL éœ€è¦é¢å¤–çš„æ’åºæ“ä½œï¼Œé€šå¸¸éœ€è¦ä¼˜åŒ–ã€‚</li></ul></li></ol><p>è¿™å››ä¸ªå­—æ®µèƒ½å¤Ÿå¸®åŠ©ä½ è¿…é€Ÿè¯†åˆ«æŸ¥è¯¢çš„ä¸»è¦é—®é¢˜å’Œæ½œåœ¨çš„ä¼˜åŒ–æœºä¼šã€‚å…¶ä»–å­—æ®µï¼ˆå¦‚ <code>id</code>ã€<code>select_type</code>ã€<code>possible_keys</code>ã€<code>key_len</code> å’Œ <code>ref</code>ï¼‰ä¹Ÿæä¾›æœ‰ä»·å€¼çš„ä¿¡æ¯ï¼Œä½†åœ¨åˆæ­¥åˆ†ææ—¶ï¼Œä¸Šè¿°å››ä¸ªå­—æ®µé€šå¸¸æ˜¯æœ€å…ˆå…³æ³¨çš„é‡ç‚¹ã€‚</p><h2 id="ä½¿ç”¨è§„åˆ™"><a href="#ä½¿ç”¨è§„åˆ™" class="headerlink" title="ä½¿ç”¨è§„åˆ™"></a>ä½¿ç”¨è§„åˆ™</h2><h3 id="æœ€å·¦å‰ç¼€æ³•åˆ™"><a href="#æœ€å·¦å‰ç¼€æ³•åˆ™" class="headerlink" title="æœ€å·¦å‰ç¼€æ³•åˆ™"></a>æœ€å·¦å‰ç¼€æ³•åˆ™</h3><blockquote><p><strong>é’ˆå¯¹è”åˆç´¢å¼•</strong>è€Œè¨€ï¼Œè”åˆç´¢å¼•å­—æ®µä¸­çš„ç¬¬ä¸€ä¸ªå­—æ®µå¿…é¡»å­˜åœ¨ï¼ˆä¸éœ€è¦æŒ‡å®šä½ç½®ï¼‰ï¼Œè‹¥ä¸å­˜åœ¨ç¬¬ä¸€ä¸ªå­—æ®µåˆ™æ•´ä¸ªç´¢å¼•å¤±æ•ˆï¼Œè‹¥åç»­å…¶ä»–å­—æ®µä¸­è·³è¿‡äº†æŸä¸ªå­—æ®µï¼Œåˆ™åç»­çš„éƒ¨åˆ†ç´¢å¼•å¤±æ•ˆ</p></blockquote><p>ä¸¾ä¾‹ï¼š</p><p>åˆ›å»ºä¸‹åˆ—ä¸‰ä¸ªå­—æ®µçš„è”åˆç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_sku_price_num_weight <span class="keyword">ON</span> tb_sku(price,num,weight);</span><br></pre></td></tr></table></figure><p>æ­£å¸¸æŸ¥è¯¢ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_sku <span class="keyword">WHERE</span> price<span class="operator">=</span><span class="number">40625</span> <span class="keyword">AND</span> num<span class="operator">=</span><span class="number">10000</span> <span class="keyword">AND</span> weight <span class="operator">=</span><span class="number">10</span></span><br></pre></td></tr></table></figure><p>è·³è¿‡ä¸­é—´çš„å­—æ®µåï¼Œåç»­å­—æ®µç´¢å¼•ä¼šå¤±æ•ˆ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_sku <span class="keyword">WHERE</span> price<span class="operator">=</span><span class="number">40625</span>  <span class="keyword">AND</span> weight <span class="operator">=</span><span class="number">10</span></span><br></pre></td></tr></table></figure><blockquote><p>å…·ä½“å¯é€šè¿‡<code>EXPLAIN</code>æ¥æŸ¥çœ‹æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•ï¼Œçœ‹ç´¢å¼•çš„é•¿åº¦æ¥åˆ¤æ–­å“ªä¸ªå­—æ®µç´¢å¼•è¢«ä½¿ç”¨äº†</p></blockquote><h4 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h4><p>ä¸Šè¿°çš„æœ€å·¦å‰ç¼€æ³•åˆ™é’ˆå¯¹çš„æ˜¯<code>where</code>åçš„æ¡ä»¶ï¼Œåœ¨<code>where</code>åçš„æ¡ä»¶ä¸­ï¼Œåªè¦å‡ºç°äº†æœ€å·¦è¾¹çš„å­—æ®µå³å¯è®¤ä¸ºæ»¡è¶³äº†æœ€å·¦å‰ç¼€æ³•åˆ™ã€‚è€Œå½“åœ¨<code>order by</code>ä¹‹åçš„æ¡ä»¶ä¸­ï¼Œè‹¥æ˜¯æœ€å·¦è¾¹çš„å­—æ®µæ²¡æœ‰æ”¾åœ¨æ’åºçš„ç¬¬ä¸€ä½ï¼Œå³ä¸æŒ‰ç…§é¡ºåºï¼Œè¿™æ˜¯ä¸æ»¡è¶³æœ€å·¦å‰ç¼€æ³•åˆ™çš„ã€‚ç»¼ä¸Šï¼Œ<code>where</code>åæ¡ä»¶ä¸éœ€è¦æŒ‰é¡ºåºï¼Œ<code>order by</code>ä¹‹åçš„æ¡ä»¶éœ€è¦æŒ‰é¡ºåºã€‚</p><blockquote><p>å…·ä½“ç¤ºä¾‹çœ‹ä¸‹æ–‡çš„order byä¼˜åŒ–çš„ç‰¹æ®Šæƒ…å†µ</p></blockquote><h3 id="ç´¢å¼•å¤±æ•ˆæƒ…å†µ"><a href="#ç´¢å¼•å¤±æ•ˆæƒ…å†µ" class="headerlink" title="ç´¢å¼•å¤±æ•ˆæƒ…å†µ"></a>ç´¢å¼•å¤±æ•ˆæƒ…å†µ</h3><blockquote><p>æ­¤å¤„ä¸¾ä¾‹å¤§å¤šéƒ½æ˜¯ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆçš„ä¾‹å­</p></blockquote><h4 id="èŒƒå›´æŸ¥è¯¢ç‰¹æ®Šæƒ…å†µ"><a href="#èŒƒå›´æŸ¥è¯¢ç‰¹æ®Šæƒ…å†µ" class="headerlink" title="èŒƒå›´æŸ¥è¯¢ç‰¹æ®Šæƒ…å†µ"></a>èŒƒå›´æŸ¥è¯¢ç‰¹æ®Šæƒ…å†µ</h4><p>å¦‚æœå‡ºç°èŒƒå›´æŸ¥è¯¢ï¼Œåˆ™&gt;æˆ–&lt;ä¹‹åçš„ç´¢å¼•ä¼šå¤±æ•ˆ</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_sku <span class="keyword">WHERE</span> price<span class="operator">=</span><span class="number">40625</span> <span class="keyword">AND</span> num<span class="operator">&gt;</span><span class="number">10000</span> <span class="keyword">AND</span> weight <span class="operator">=</span><span class="number">10</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°SQLä¸­num&gt;10000ï¼Œå¯¼è‡´åé¢çš„weightçš„ç´¢å¼•å¤±æ•ˆï¼Œåªæœ‰priceå’Œnumçš„ç´¢å¼•ç”Ÿæ•ˆ</p><p>å¯ä»¥æŠŠ&gt;,&lt;ä¿®æ”¹ä¸º&gt;&#x3D;,&lt;&#x3D;ï¼Œä¿®æ”¹ä¹‹åå°±èƒ½é¿å…è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb_sku <span class="keyword">WHERE</span> price<span class="operator">=</span><span class="number">40625</span> <span class="keyword">AND</span> num<span class="operator">&gt;=</span><span class="number">10000</span> <span class="keyword">AND</span> weight <span class="operator">=</span><span class="number">10</span></span><br></pre></td></tr></table></figure><h4 id="ç´¢å¼•åˆ—è¿ç®—"><a href="#ç´¢å¼•åˆ—è¿ç®—" class="headerlink" title="ç´¢å¼•åˆ—è¿ç®—"></a>ç´¢å¼•åˆ—è¿ç®—</h4><p>ä¸è¦åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè¿ç®—æ“ä½œï¼Œ ç´¢å¼•å°†å¤±æ•ˆã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> <span class="built_in">substring</span>(phone,<span class="number">10</span>,<span class="number">2</span>) <span class="operator">=</span> <span class="string">&#x27;15&#x27;</span>;</span><br></pre></td></tr></table></figure><h4 id="å­—ç¬¦ä¸²ä¸åŠ å¼•å·"><a href="#å­—ç¬¦ä¸²ä¸åŠ å¼•å·" class="headerlink" title="å­—ç¬¦ä¸²ä¸åŠ å¼•å·"></a>å­—ç¬¦ä¸²ä¸åŠ å¼•å·</h4><p>å­—ç¬¦ä¸²ç±»å‹å­—æ®µä½¿ç”¨æ—¶ï¼Œä¸åŠ å¼•å·ï¼Œç´¢å¼•å°†å¤±æ•ˆã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> phone <span class="operator">=</span> <span class="number">17799990015</span>;</span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼šå…¶å®å¯ä»¥ç†è§£ä¸ºphoneæœ¬èº«æ˜¯varcharç±»å‹ï¼Œè¿™é‡Œåšäº†éšå¼ç±»å‹è½¬æ¢ï¼Œä¹Ÿç®—çš„ä¸Šæ˜¯è®¡ç®—</p></blockquote><h4 id="æ¨¡ç³ŠæŸ¥è¯¢"><a href="#æ¨¡ç³ŠæŸ¥è¯¢" class="headerlink" title="æ¨¡ç³ŠæŸ¥è¯¢"></a>æ¨¡ç³ŠæŸ¥è¯¢</h4><p>å¦‚æœä»…ä»…æ˜¯å°¾éƒ¨æ¨¡ç³ŠåŒ¹é…ï¼Œç´¢å¼•ä¸ä¼šå¤±æ•ˆã€‚å¦‚æœæ˜¯å¤´éƒ¨æ¨¡ç³ŠåŒ¹é…ï¼Œç´¢å¼•å¤±æ•ˆã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> profession <span class="keyword">like</span> <span class="string">&#x27;%å·¥ç¨‹&#x27;</span>;</span><br></pre></td></tr></table></figure><h4 id="orè¿æ¥æ¡ä»¶"><a href="#orè¿æ¥æ¡ä»¶" class="headerlink" title="orè¿æ¥æ¡ä»¶"></a>orè¿æ¥æ¡ä»¶</h4><p>ç”¨oråˆ†å‰²å¼€çš„æ¡ä»¶ï¼Œ å¦‚æœorå‰çš„æ¡ä»¶ä¸­çš„åˆ—æœ‰ç´¢å¼•ï¼Œè€Œåé¢çš„åˆ—ä¸­æ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆæ¶‰åŠçš„ç´¢å¼•éƒ½ä¸ä¼šè¢«ç”¨åˆ°ã€‚åªæœ‰å½“orå‰åéƒ½æœ‰ç´¢å¼•æ‰èƒ½ç”Ÿæ•ˆã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">10</span> <span class="keyword">or</span> age <span class="operator">=</span> <span class="number">23</span>; #å…¶ä¸­ageå­—æ®µæ— ç´¢å¼•</span><br></pre></td></tr></table></figure><h4 id="æ•°æ®åˆ†å¸ƒå½±å“â­"><a href="#æ•°æ®åˆ†å¸ƒå½±å“â­" class="headerlink" title="æ•°æ®åˆ†å¸ƒå½±å“â­"></a>æ•°æ®åˆ†å¸ƒå½±å“â­</h4><p>å¦‚æœMySQLè¯„ä¼°ä½¿ç”¨ç´¢å¼•æ¯”å…¨è¡¨æ›´æ…¢ï¼Œåˆ™ä¸ä½¿ç”¨ç´¢å¼•ã€‚MySQLè‡ªå·±è¯„åˆ¤ã€‚</p><blockquote><p>èµ°ä¸èµ°ç´¢å¼•å–å†³äºæŸ¥è¯¢çš„æ•°æ®å å…¨è¡¨çš„å¤šå°‘ï¼Œè‹¥æŸ¥è¯¢çš„æ•°æ®å äº†å…¨è¡¨çš„å¤§éƒ¨åˆ†ï¼Œåˆ™å…¨è¡¨æœç´¢æ›´å¿«ï¼Œæ•…é€‰æ‹©å…¨è¡¨æœç´¢ï¼Œåä¹‹åˆ™ç›¸åã€‚</p></blockquote><h3 id="SQLæç¤º"><a href="#SQLæç¤º" class="headerlink" title="SQLæç¤º"></a>SQLæç¤º</h3><blockquote><p>æ­¤å¤„çš„SQLæç¤ºï¼ŒæŒ‡çš„æ˜¯æˆ‘ä»¬å»æç¤ºSQLï¼Œè€Œä¸æ˜¯SQLæç¤ºæˆ‘ä»¬ã€‚</p></blockquote><ul><li>ä½¿ç”¨æ¡ä»¶ï¼š</li></ul><p>å½“ä¸€ä¸ªå­—æ®µæ—¢æœ‰å•åˆ—ç´¢å¼•åˆæœ‰è”åˆç´¢å¼•æ—¶ï¼ŒMySQLé»˜è®¤ä½¿ç”¨è”åˆç´¢å¼•ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‰ç§æ–¹å¼å»æç¤ºSQLä½¿ç”¨ä½•ç§ç´¢å¼•ã€‚</p><ol><li>å»ºè®®ï¼ˆå»ºè®®ä»…ä»…åªæ˜¯å»ºè®®ï¼Œå…·ä½“ç”¨ä¸ç”¨è¿˜è¦MySQLè‡ªå·±æ¥è¯„ä¼°ï¼‰</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user use index(idx_user_pro) <span class="keyword">where</span> profession <span class="operator">=</span> <span class="string">&#x27;è½¯ä»¶å·¥ç¨‹&#x27;</span>;</span><br></pre></td></tr></table></figure><ol start="2"><li>å¿½ç•¥ï¼ˆ<strong>å»ºè®®</strong>MySQLå¿½ç•¥æŸä¸ªç´¢å¼•ï¼Œä½†æ˜¯è¦ä¸è¦å¿½ç•¥ä¹Ÿæ˜¯MySQLè‡ªå·±æ¥è¯„ä¼°ï¼‰</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user ignore index(idx_user_pro) <span class="keyword">where</span> profession <span class="operator">=</span> <span class="string">&#x27;è½¯ä»¶å·¥ç¨‹&#x27;</span>;</span><br></pre></td></tr></table></figure><ol start="3"><li>å¼ºè¿«ï¼ˆMySQLå¿…é¡»é‡‡ç”¨æ‰€é€‰çš„ç´¢å¼•ï¼‰</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user force index(idx_user_pro) <span class="keyword">where</span> profession <span class="operator">=</span> <span class="string">&#x27;è½¯ä»¶å·¥ç¨‹&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="è¦†ç›–ç´¢å¼•"><a href="#è¦†ç›–ç´¢å¼•" class="headerlink" title="è¦†ç›–ç´¢å¼•"></a>è¦†ç›–ç´¢å¼•</h3><p>è¦†ç›–ç´¢å¼•æŒ‡çš„æ˜¯æŸ¥è¯¢çš„å­—æ®µå…¨éƒ¨éƒ½èƒ½ä¸€æ¬¡æŸ¥å‡ºï¼Œæ— éœ€å›è¡¨æŸ¥è¯¢ã€‚</p><p>ä¸¾ä¾‹è¯´æ˜ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> id, profession ,age, status, name <span class="keyword">from</span> tb_user <span class="keyword">where</span> profession <span class="operator">=</span> <span class="string">&#x27;è½¯ä»¶å·¥ç¨‹&#x27;</span> <span class="keyword">and</span> age <span class="operator">=</span> <span class="number">31</span> <span class="keyword">and</span> status <span class="operator">=</span> <span class="string">&#x27;0&#x27;</span> ; #éœ€è¦å›è¡¨æŸ¥è¯¢</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªSQLè¯­å¥ä¸­ï¼Œ<code>profession</code> ,<code>age</code> ,<code> status</code>è¿™ä¸‰ä¸ªå­—æ®µç»„æˆè”åˆç´¢å¼•ï¼Œè€Œ<code>name</code>å­—æ®µæ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥åœ¨<strong>äºŒçº§ç´¢å¼•</strong>ä¸­<code>profession</code> ,<code>age</code> ,<code> status</code>ä»¥åŠä»–ä»¬çš„å¶å­èŠ‚ç‚¹ä¸­å­˜æ”¾çš„<code>id</code>å­—æ®µéƒ½æ˜¯å¯ä»¥ç›´æ¥æ‰¾åˆ°çš„ï¼Œè‹¥è¿™æ¡è¯­å¥ä¸éœ€è¦é¢å¤–æŸ¥è¯¢<code>name</code>å­—æ®µçš„è¯ï¼ˆå¦‚ä¸‹SQLï¼‰ï¼Œé‚£ä¹ˆè¿™æ¡è¯­å¥å°±æ˜¯è¦†ç›–ç´¢å¼•ï¼Œå› ä¸ºä»–ä¸éœ€è¦å›è¡¨æŸ¥è¯¢ï¼Œä½†å› ä¸ºæœ‰äº†<code>name</code>å­—æ®µï¼Œæ‰€ä»¥ä¸å…‰è¦åœ¨äºŒçº§ç´¢å¼•ä¸­æŸ¥ï¼Œè¿˜è¦å¸¦ç€<code>id</code>å»èšé›†ç´¢å¼•ä¸­æŸ¥ï¼Œè¿™å°±æ˜¯å›è¡¨æŸ¥è¯¢ã€‚å›è¡¨æŸ¥è¯¢è‡ªç„¶å°±ä¼šæ…¢äº†ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> id, profession ,age, status <span class="keyword">from</span> tb_user <span class="keyword">where</span> profession <span class="operator">=</span> <span class="string">&#x27;è½¯ä»¶å·¥ç¨‹&#x27;</span> <span class="keyword">and</span> age <span class="operator">=</span> <span class="number">31</span> <span class="keyword">and</span> status <span class="operator">=</span> <span class="string">&#x27;0&#x27;</span> ; #è¦†ç›–ç´¢å¼•ï¼Œä¸éœ€è¦å›è¡¨æŸ¥è¯¢</span><br></pre></td></tr></table></figure><blockquote><p>å°½é‡ä¸è¦ä½¿ç”¨<code>select *</code> çš„åŸå› å°±æ˜¯æŸ¥è¯¢å…¨éƒ¨å­—æ®µå¾ˆå¤§å¯èƒ½ä¼šå› ä¸ºæœ‰äº›å­—æ®µæ²¡æœ‰ç´¢å¼•ï¼Œè€Œå¯¼è‡´éœ€è¦å›è¡¨æŸ¥è¯¢ã€‚</p></blockquote><h4 id="æ€è€ƒé¢˜-2"><a href="#æ€è€ƒé¢˜-2" class="headerlink" title="æ€è€ƒé¢˜"></a>æ€è€ƒé¢˜</h4><p>ä¸€å¼ è¡¨, æœ‰å››ä¸ªå­—æ®µ(id, username, password, status), ç”±äºæ•°æ®é‡å¤§, éœ€è¦å¯¹ä»¥ä¸‹SQLè¯­å¥è¿›è¡Œä¼˜åŒ–, è¯¥å¦‚ä½•è¿›è¡Œæ‰æ˜¯æœ€ä¼˜æ–¹æ¡ˆ: </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,username,password <span class="keyword">from</span> tb_user <span class="keyword">where</span> username <span class="operator">=</span> <span class="string">&#x27;itcast&#x27;</span>; </span><br></pre></td></tr></table></figure><blockquote><p>ç­”æ¡ˆ: é’ˆå¯¹äº username, passwordå»ºç«‹è”åˆç´¢å¼•, sqlä¸º: </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_user_name_pass <span class="keyword">on</span> tb_user(username,password); </span><br></pre></td></tr></table></figure><p>è¿™æ ·å¯ä»¥é¿å…ä¸Šè¿°çš„SQLè¯­å¥ï¼Œåœ¨æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ï¼Œå‡ºç°å›è¡¨æŸ¥è¯¢ã€‚</p></blockquote><h3 id="å‰ç¼€ç´¢å¼•"><a href="#å‰ç¼€ç´¢å¼•" class="headerlink" title="å‰ç¼€ç´¢å¼•"></a>å‰ç¼€ç´¢å¼•</h3><p>å½“å­—æ®µç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼ˆvarcharï¼Œtextï¼Œlongtextç­‰ï¼‰æ—¶ï¼Œæœ‰æ—¶å€™éœ€è¦ç´¢å¼•å¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¼šè®© ç´¢å¼•å˜å¾—å¾ˆå¤§ï¼ŒæŸ¥è¯¢æ—¶ï¼Œæµªè´¹å¤§é‡çš„ç£ç›˜IOï¼Œ å½±å“æŸ¥è¯¢æ•ˆç‡ã€‚æ­¤æ—¶å¯ä»¥åªå°†å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†å‰ç¼€ï¼Œå»ºç«‹ç´¢å¼•ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§èŠ‚çº¦ç´¢å¼•ç©ºé—´ï¼Œä»è€Œæé«˜ç´¢å¼•æ•ˆç‡ã€‚<strong>é™ä½ç´¢å¼•ä½“ç§¯ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡</strong></p><p>è¯­æ³•ï¼šå…¶ä¸­çš„<code>n</code>æ˜¯ä»å¤´å¼€å§‹æˆªå–çš„ä½æ•°</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_xxxx <span class="keyword">on</span> table_name(<span class="keyword">column</span>(n)) ;</span><br></pre></td></tr></table></figure><p>å…·ä½“<code>n</code>å–å¤šå°‘ï¼Œä¸‹åˆ—sqlä¸­é€‰æ‹©æ€§è¶Šæ¥è¿‘1ä¸”æˆªå–é•¿åº¦è¶Šå°‘çš„è¶Šå¥½</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="built_in">substring</span>(email,<span class="number">1</span>,n)) <span class="operator">/</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> tb_user ;</span><br></pre></td></tr></table></figure><blockquote><p>ä¾‹å¦‚nå–10æ—¶é€‰æ‹©æ€§ä¸º1ï¼Œå–9ï¼Œ8ï¼Œ7ï¼Œ6ï¼Œ5æ—¶é€‰æ‹©æ€§éƒ½ä¸º0.985ï¼Œnå–4æ—¶é€‰æ‹©æ€§ä¸º0.913ï¼Œæ­¤æ—¶çš„nå°±åº”è¯¥n&#x3D;5</p></blockquote><ul><li>æ‰§è¡Œæµç¨‹ï¼š</li></ul><p>å¦‚ index1 (å³emailæ•´ä¸ªå­—ç¬¦ä¸²çš„ç´¢å¼•ç»“æ„)ï¼Œæ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„:</p><ol><li>ä»index1ç´¢å¼•æ ‘æ‰¾åˆ°æ»¡è¶³ç´¢å¼•å€¼æ˜¯<code>zhangssxyz@xxx.com</code>çš„è¿™æ¡è®°å½•ï¼Œå–å¾—ID2çš„å€¼</li><li>åˆ°ä¸»é”®ä¸ŠæŸ¥åˆ°ä¸»é”®å€¼æ˜¯ID2çš„è¡Œï¼Œåˆ¤æ–­emailçš„å€¼æ˜¯æ­£ç¡®çš„ï¼Œå°†è¿™è¡Œè®°å½•åŠ å…¥ç»“æœé›†!</li><li>å–index1ç´¢å¼•æ ‘ä¸ŠåˆšåˆšæŸ¥åˆ°çš„ä½ç½®çš„ä¸‹ä¸€æ¡è®°å½•ï¼Œå‘ç°å·²ç»ä¸æ»¡è¶³email&#x3D;<code>hangssxyz@xxx.com</code>çš„æ¡ä»¶äº†ï¼Œå¾ªç¯ç»“æŸ, è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œåªéœ€è¦å›ä¸»é”®ç´¢å¼•å–ä¸€æ¬¡æ•°æ®ï¼Œæ‰€ä»¥ç³»ç»Ÿè®¤ä¸ºåªæ‰«æäº†ä¸€è¡Œã€‚</li></ol><p>å¦‚ index2 (å³email(6)ç´¢ç»“æ„) ï¼Œæ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„:</p><ol><li>ä»index2ç´¢å¼•æ ‘æ‰¾åˆ°æ»¡è¶³ç´¢å¼•å€¼æ˜¯â€™zhangsçš„è®°å½•ï¼Œæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæ˜¯ID1;</li><li>åˆ°ä¸»é”®ä¸ŠæŸ¥åˆ°ä¸»é”®å€¼æ˜¯ID1çš„è¡Œï¼Œåˆ¤æ–­å‡ºemailçš„å€¼ä¸æ˜¯<code>zhangssxyz@xxx.com</code>ï¼Œè¿™è¡Œè®°å½•ä¸¢å¼ƒ</li><li>å–index2ä¸ŠåˆšåˆšæŸ¥åˆ°çš„ä½ç½®çš„ä¸‹ä¸€æ¡è®°å½•ï¼Œå‘ç°ä»ç„¶æ˜¯hangsï¼Œå–å‡ºID2ï¼Œå†åˆ°IDç´¢å¼•ä¸Šå–æ•´è¡Œç„¶ååˆ¤æ–­ï¼Œè¿™æ¬¡å€¼å¯¹äº†ï¼Œå°†è¿™è¡Œè®°å½•åŠ å…¥ç»“æœé›†;</li><li>é‡å¤ä¸Šä¸€æ­¥ï¼Œç›´åˆ°åœ¨idxe2ä¸Šå–åˆ°çš„å€¼ä¸æ˜¯zhangsæ—¶ï¼Œå¾ªç¯ç»“æŸ<br>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¦å›ä¸»é”®ç´¢å¼•å–4æ¬¡æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ‰«æäº†4è¡Œã€‚<br>é€šè¿‡è¿™ä¸ªå¯¹æ¯”ï¼Œä½ å¾ˆå®¹æ˜“å°±å¯ä»¥å‘ç°ï¼Œ<strong>ä½¿ç”¨å‰ç¼€ç´¢å¼•åï¼Œå¯èƒ½ä¼šå¯¼è‡´æŸ¥è¯¢è¯­å¥è¯»æ•°æ®çš„æ¬¡æ•°å˜å¤š</strong></li></ol><p>å–è‡ª<a href="https://blog.csdn.net/m0_37583655/article/details/127945182?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169119750916800211587211%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=169119750916800211587211&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-2-127945182-null-null.142%5Ev92%5EchatgptT0_1&utm_term=%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95%E7%9A%84%E6%B5%81%E7%A8%8B%E4%BB%80%E4%B9%88&spm=1018.2226.3001.4187">CSDNåšä¸»ï¼ˆé–èŠ‚å…ˆç”Ÿï¼‰-å‰ç¼€ç´¢å¼•è¯¦è§£</a></p><h3 id="å•åˆ—ç´¢å¼•-è”åˆç´¢å¼•"><a href="#å•åˆ—ç´¢å¼•-è”åˆç´¢å¼•" class="headerlink" title="å•åˆ—ç´¢å¼•&amp;&amp;è”åˆç´¢å¼•"></a>å•åˆ—ç´¢å¼•&amp;&amp;è”åˆç´¢å¼•</h3><ul><li><p>å•åˆ—ç´¢å¼•ï¼šå³ä¸€ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªåˆ—ã€‚ </p></li><li><p>è”åˆç´¢å¼•ï¼šå³ä¸€ä¸ªç´¢å¼•åŒ…å«äº†å¤šä¸ªåˆ—ã€‚</p></li></ul><blockquote><p>åœ¨ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œè€ƒè™‘é’ˆå¯¹äºæŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•æ—¶ï¼Œå»ºè®®å»ºç«‹è”åˆç´¢å¼•ï¼Œ è€Œéå•åˆ—ç´¢å¼•ã€‚</p></blockquote><p>è”åˆç´¢å¼•çš„B+Treeå›¾ï¼š</p><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230805093203021.png" alt="è”åˆç´¢å¼•çš„B+Treeå›¾"></p><h2 id="ç´¢å¼•è®¾è®¡åŸåˆ™â­"><a href="#ç´¢å¼•è®¾è®¡åŸåˆ™â­" class="headerlink" title="ç´¢å¼•è®¾è®¡åŸåˆ™â­"></a>ç´¢å¼•è®¾è®¡åŸåˆ™â­</h2><ol><li>é’ˆå¯¹äºæ•°æ®é‡è¾ƒå¤§ï¼Œä¸”æŸ¥è¯¢æ¯”è¾ƒé¢‘ç¹çš„è¡¨å»ºç«‹ç´¢å¼•ã€‚</li></ol><blockquote><p>æ•°æ®é‡å¤§æŒ‡çš„æ˜¯è¶…è¿‡ä¸€ç™¾å¤šä¸‡â€¦â€¦</p></blockquote><ol start="2"><li><p>é’ˆå¯¹äºå¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ (where)ã€æ’åº(order by)ã€åˆ†ç»„ (group by) æ“ä½œçš„å­—æ®µå»ºç«‹ç´¢å¼•ã€‚</p></li><li><p>å°½é‡é€‰æ‹©åŒºåˆ†åº¦é«˜çš„åˆ—ä½œä¸ºç´¢å¼•ï¼Œå°½é‡å»ºç«‹å”¯ä¸€ç´¢å¼•ï¼ŒåŒºåˆ†åº¦è¶Šé«˜ï¼Œä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡è¶Šé«˜ã€‚</p></li></ol><blockquote><p>åŒºåˆ†åº¦é«˜çš„å­—æ®µä¾‹å¦‚ç”¨æˆ·çš„æ‰‹æœºå·ï¼Œèº«ä»½è¯å·ï¼ŒåŒºåˆ†åº¦ä½çš„ä¾‹å¦‚æ€§åˆ«ï¼Œç”¨æˆ·çš„çŠ¶æ€ç­‰</p></blockquote><ol start="4"><li><p>å¦‚æœæ˜¯å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µï¼Œå­—æ®µçš„é•¿åº¦è¾ƒé•¿ï¼Œå¯ä»¥é’ˆå¯¹äºå­—æ®µçš„ç‰¹ç‚¹ï¼Œå»ºç«‹å‰ç¼€ç´¢å¼•ã€‚</p></li><li><p>å°½é‡ä½¿ç”¨è”åˆç´¢å¼•ï¼Œå‡å°‘å•åˆ—ç´¢å¼•ï¼ŒæŸ¥è¯¢æ—¶ï¼Œè”åˆç´¢å¼•å¾ˆå¤šæ—¶å€™å¯ä»¥è¦†ç›–ç´¢å¼•ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œé¿å…å›è¡¨ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p></li><li><p>è¦æ§åˆ¶ç´¢å¼•çš„æ•°é‡ï¼Œç´¢å¼•å¹¶ä¸æ˜¯å¤šå¤šç›Šå–„ï¼Œç´¢å¼•è¶Šå¤šï¼Œç»´æŠ¤ç´¢å¼•ç»“æ„çš„ä»£ä»·ä¹Ÿå°±è¶Šå¤§ï¼Œä¼šå½±å“å¢åˆ æ”¹çš„æ•ˆç‡ã€‚</p></li><li><p>å¦‚æœç´¢å¼•åˆ—ä¸èƒ½å­˜å‚¨NULLå€¼ï¼Œè¯·åœ¨åˆ›å»ºè¡¨æ—¶ä½¿ç”¨NOT NULLçº¦æŸå®ƒã€‚å½“ä¼˜åŒ–å™¨çŸ¥é“æ¯åˆ—æ˜¯å¦åŒ…å«NULLå€¼æ—¶ï¼Œå®ƒå¯ä»¥æ›´å¥½åœ°ç¡®å®šå“ªä¸ªç´¢å¼•æœ€æœ‰æ•ˆåœ°ç”¨äºæŸ¥è¯¢ã€‚</p></li></ol><h1 id="SQLä¼˜åŒ–â­"><a href="#SQLä¼˜åŒ–â­" class="headerlink" title="SQLä¼˜åŒ–â­"></a>SQLä¼˜åŒ–â­</h1><h2 id="æ’å…¥æ•°æ®"><a href="#æ’å…¥æ•°æ®" class="headerlink" title="æ’å…¥æ•°æ®"></a>æ’å…¥æ•°æ®</h2><h3 id="æ‰¹é‡æ’å…¥æ•°æ®"><a href="#æ‰¹é‡æ’å…¥æ•°æ®" class="headerlink" title="æ‰¹é‡æ’å…¥æ•°æ®"></a>æ‰¹é‡æ’å…¥æ•°æ®</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;Tom&#x27;</span>),(<span class="number">2</span>,<span class="string">&#x27;Cat&#x27;</span>),(<span class="number">3</span>,<span class="string">&#x27;Jerry&#x27;</span>);</span><br></pre></td></tr></table></figure><blockquote><p>æ¯æ¬¡insertéƒ½è¦å»ºç«‹sqlè¿æ¥ï¼Œä¼šæµªè´¹æ—¶é—´å’Œæ€§èƒ½</p></blockquote><h3 id="æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡"><a href="#æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡" class="headerlink" title="æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡"></a>æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">start</span> transaction;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;Tom&#x27;</span>),(<span class="number">2</span>,<span class="string">&#x27;Cat&#x27;</span>),(<span class="number">3</span>,<span class="string">&#x27;Jerry&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">&#x27;Tom&#x27;</span>),(<span class="number">5</span>,<span class="string">&#x27;Cat&#x27;</span>),(<span class="number">6</span>,<span class="string">&#x27;Jerry&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">7</span>,<span class="string">&#x27;Tom&#x27;</span>),(<span class="number">8</span>,<span class="string">&#x27;Cat&#x27;</span>),(<span class="number">9</span>,<span class="string">&#x27;Jerry&#x27;</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure><blockquote><p>MySQLé»˜è®¤æ˜¯è‡ªåŠ¨æäº¤äº‹åŠ¡ï¼Œæ‰€ä»¥æ¯æ¬¡insertéƒ½ä¼šé‡å¤çš„å¼€å¯äº‹åŠ¡ï¼Œå…³é—­äº‹åŠ¡ï¼Œæµªè´¹æ—¶é—´</p></blockquote><h3 id="ä¸»é”®é¡ºåºæ’å…¥ï¼Œæ€§èƒ½è¦é«˜äºä¹±åºæ’å…¥"><a href="#ä¸»é”®é¡ºåºæ’å…¥ï¼Œæ€§èƒ½è¦é«˜äºä¹±åºæ’å…¥" class="headerlink" title="ä¸»é”®é¡ºåºæ’å…¥ï¼Œæ€§èƒ½è¦é«˜äºä¹±åºæ’å…¥"></a>ä¸»é”®é¡ºåºæ’å…¥ï¼Œæ€§èƒ½è¦é«˜äºä¹±åºæ’å…¥</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä¸»é”®ä¹±åºæ’å…¥ : <span class="number">8</span> <span class="number">1</span> <span class="number">9</span> <span class="number">21</span> <span class="number">88</span> <span class="number">2</span> <span class="number">4</span> <span class="number">15</span> <span class="number">89</span> <span class="number">5</span> <span class="number">7</span> <span class="number">3</span></span><br><span class="line">ä¸»é”®é¡ºåºæ’å…¥ : <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">15</span> <span class="number">21</span> <span class="number">88</span> <span class="number">89</span></span><br></pre></td></tr></table></figure><h3 id="å¤§æ‰¹é‡æ’å…¥æ•°æ®"><a href="#å¤§æ‰¹é‡æ’å…¥æ•°æ®" class="headerlink" title="å¤§æ‰¹é‡æ’å…¥æ•°æ®"></a>å¤§æ‰¹é‡æ’å…¥æ•°æ®</h3><blockquote><p>å½“æ’å…¥çš„æ•°æ®å¤§äºå‡ ç™¾ä¸‡æ¡çš„æ—¶å€™å†ä½¿ç”¨insertæ•ˆæœå°±ä¸å¥½äº†</p></blockquote><ul><li><p>å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶ï¼ŒåŠ ä¸Šå‚æ•° â€“local-infile </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql â€“-local-infile -u root -p </span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®å…¨å±€å‚æ•°local_infileä¸º1ï¼Œå¼€å¯ä»æœ¬åœ°åŠ è½½æ–‡ä»¶å¯¼å…¥æ•°æ®çš„å¼€å…³ </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> local_infile <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure></li></ul><p>ä¸‹é¢è¿™æ¡sqlä»è¯¥<code>tb_sku1.sql</code>æ–‡ä»¶ä¸­åŠ è½½æ•°æ®åˆ°è¡¨<code>tb_sku</code>ï¼Œä»¥<code>,</code>åˆ†éš”å­—æ®µï¼Œä»¥æ¢è¡Œä¸ºä¸€è¡Œæ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data <span class="keyword">local</span> infile <span class="string">&#x27;/root/sql/tb_sku1.sql&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> `tb_sku` fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> lines terminated <span class="keyword">by</span> <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure><p>SQLæ–‡ä»¶å‰å‡ è¡Œä»£ç å¦‚ä¸‹ï¼š</p><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230805155150579.png" alt="image-20230805155150579"></p><h2 id="ä¸»é”®ä¼˜åŒ–"><a href="#ä¸»é”®ä¼˜åŒ–" class="headerlink" title="ä¸»é”®ä¼˜åŒ–"></a>ä¸»é”®ä¼˜åŒ–</h2><blockquote><p><strong>ä¸»é”®é¡ºåºæ’å…¥ï¼Œæ€§èƒ½è¦é«˜äºä¹±åºæ’å…¥</strong></p></blockquote><h3 id="é¡µåˆ†è£‚ï¼š"><a href="#é¡µåˆ†è£‚ï¼š" class="headerlink" title="é¡µåˆ†è£‚ï¼š"></a>é¡µåˆ†è£‚ï¼š</h3><p>é¡µåˆ†è£‚æ˜¯æŒ‡å½“ä¸€ä¸ªé¡µé¢ï¼ˆPageï¼‰å·²ç»æ»¡äº†ï¼Œä½†éœ€è¦æ’å…¥æ–°çš„æ•°æ®æˆ–æ›´æ–°å·²æœ‰æ•°æ®ï¼ŒMySQL å°±ä¼šå°†é¡µé¢æ‹†åˆ†æˆä¸¤ä¸ªé¡µé¢ï¼Œä»¥å®¹çº³æ–°çš„æ•°æ®ã€‚è¿™æ ·åšå¯ä»¥ä¿è¯æ•°æ®çš„æœ‰åºæ€§å’Œå”¯ä¸€æ€§ï¼Œä½†é¡µåˆ†è£‚å¯èƒ½ä¼šäº§ç”Ÿä¸€äº›<strong>å½±å“</strong>ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p><ol><li><strong>æ€§èƒ½å½±å“ï¼š</strong> é¡µåˆ†è£‚ä¼šæ¶‰åŠæ•°æ®çš„é‡æ–°ç»„ç»‡å’Œç§»åŠ¨ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ•°æ®åº“æ€§èƒ½çš„ä¸‹é™ï¼Œç‰¹åˆ«æ˜¯åœ¨é¢‘ç¹å‘ç”Ÿé¡µåˆ†è£‚çš„è¡¨ä¸Šã€‚é¡µåˆ†è£‚æ¶‰åŠç£ç›˜ I&#x2F;O æ“ä½œï¼Œè€Œè¿™äº›æ“ä½œé€šå¸¸æ¯”å†…å­˜æ“ä½œæ…¢å¾—å¤šã€‚</li><li><strong>ç£ç›˜ç©ºé—´çš„æµªè´¹ï¼š</strong> é¡µåˆ†è£‚åï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®é¡µåªæœ‰ä¸€éƒ¨åˆ†è¢«å ç”¨ï¼Œè€Œå…¶ä»–éƒ¨åˆ†ä¸ºç©ºé—²ï¼Œä»è€Œæµªè´¹äº†ä¸€äº›ç£ç›˜ç©ºé—´ã€‚</li><li><strong>ç´¢å¼•ç¢ç‰‡åŒ–ï¼š</strong> ä¸»é”®é€šå¸¸æ˜¯ç´¢å¼•é”®ï¼Œé¡µåˆ†è£‚ä¼šå¯¼è‡´ç´¢å¼•çš„ç¢ç‰‡åŒ–ã€‚è¿™å¯èƒ½ä¼šä½¿ç´¢å¼•æ ‘æ›´åŠ æ·±åº¦ï¼Œå½±å“æŸ¥è¯¢æ€§èƒ½ã€‚</li><li><strong>é”ç«äº‰å¢åŠ ï¼š</strong> é¡µåˆ†è£‚æ¶‰åŠæ•°æ®çš„é‡æ–°ç»„ç»‡ï¼Œè¿™å¯èƒ½ä¼šå¢åŠ é”çš„ç«äº‰ã€‚åœ¨é«˜å¹¶å‘çš„ç¯å¢ƒä¸‹ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´é”ç­‰å¾…æ—¶é—´å¢åŠ ï¼Œè¿›è€Œå½±å“æ•°æ®åº“çš„å“åº”æ€§èƒ½ã€‚</li></ol><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230805164745995.png" alt="image-20230805164745995"></p><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230805164833266.png" alt="image-20230805164833266"></p><h3 id="é¡µåˆå¹¶"><a href="#é¡µåˆå¹¶" class="headerlink" title="é¡µåˆå¹¶"></a>é¡µåˆå¹¶</h3><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230805165237518.png" alt="image-20230805165237518"></p><h3 id="ç´¢å¼•è®¾è®¡åŸåˆ™"><a href="#ç´¢å¼•è®¾è®¡åŸåˆ™" class="headerlink" title="ç´¢å¼•è®¾è®¡åŸåˆ™"></a>ç´¢å¼•è®¾è®¡åŸåˆ™</h3><ol><li>æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œå°½é‡é™ä½ä¸»é”®çš„é•¿åº¦ã€‚ </li><li>æ’å…¥æ•°æ®æ—¶ï¼Œå°½é‡é€‰æ‹©é¡ºåºæ’å…¥ï¼Œé€‰æ‹©ä½¿ç”¨AUTO_INCREMENTè‡ªå¢ä¸»é”®ã€‚ </li><li>å°½é‡ä¸è¦ä½¿ç”¨UUIDåšä¸»é”®æˆ–è€…æ˜¯å…¶ä»–è‡ªç„¶ä¸»é”®ï¼Œå¦‚èº«ä»½è¯å·ã€‚ </li><li>ä¸šåŠ¡æ“ä½œæ—¶ï¼Œé¿å…å¯¹ä¸»é”®çš„ä¿®æ”¹</li></ol><h2 id="order-byä¼˜åŒ–"><a href="#order-byä¼˜åŒ–" class="headerlink" title="order byä¼˜åŒ–"></a>order byä¼˜åŒ–</h2><ol><li>Using filesortï¼šé€šè¿‡è¡¨çš„ç´¢å¼•æˆ–å…¨è¡¨æ‰«æï¼Œè¯»å–æ»¡è¶³æ¡ä»¶çš„æ•°æ®è¡Œï¼Œç„¶ååœ¨æ’åºç¼“å†²åŒº sort buffer ä¸­å®Œæˆæ’åºæ“ä½œï¼Œæ‰€æœ‰ä¸æ˜¯é€šè¿‡ç´¢å¼•ç›´æ¥è¿”å›æ’åºç»“æœçš„æ’åºéƒ½å« FileSort æ’åº</li><li>Using indexï¼šé€šè¿‡æœ‰åºç´¢å¼•é¡ºåºæ‰«æç›´æ¥è¿”å›æœ‰åºæ•°æ®ï¼Œè¿™ç§æƒ…å†µå³ä¸º using indexï¼Œä¸éœ€è¦é¢å¤–æ’åºï¼Œæ“ä½œæ•ˆç‡é«˜</li></ol><blockquote><p>åœ¨explainæ‰§è¡Œè®¡åˆ’çš„extraä¸­å°½é‡ä¸è¦æ˜¾ç¤º<code>Using filesort</code>ï¼Œè¿™ä»£è¡¨æ€§èƒ½ç›¸å¯¹ä¸å¥½</p></blockquote><p>ä¸¾ä¾‹è¯´æ˜ï¼š</p><p>æœ‰å¦‚ä¸‹è¿™æ ·ä¸€ä¸ªç´¢å¼•ï¼Œé»˜è®¤çš„éƒ½æ˜¯ascå‡åºæ’åº</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_user_age_phone <span class="keyword">on</span> tb_user(age, phone);</span><br></pre></td></tr></table></figure><p>åœ¨å­˜åœ¨è¿™ä¸ªç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œèµ°å¦‚ä¸‹sqlè¯­å¥ä¸ä¼šå‡ºç°Using filesortï¼Œåªä¼šå‡ºç°Using index</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id, age, phone <span class="keyword">from</span> tb_user <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">asc</span>, phone <span class="keyword">asc</span>;</span><br></pre></td></tr></table></figure><p>å› ä¸ºåˆ›å»ºç´¢å¼•çš„æ—¶å€™é»˜è®¤å°±æ˜¯å‡åºæ’çš„ç´¢å¼•ï¼Œæ‰€ä»¥è¿™æ ·èƒ½ä¸å‡ºç°Using filesortï¼Œä½†è¦æ˜¯<strong>å…¶ä¸­ä¸€ä¸ª</strong>æ˜¯å€’åºæŸ¥è¯¢ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°Using filesortï¼›ä½†æ˜¯å¦‚æœä¸¤ä¸ªéƒ½æ˜¯å€’åºæŸ¥è¯¢ï¼Œé‚£ä¹ˆåè€Œä¸ä¼šå‡ºç°Using filesortï¼Œå› ä¸ºåœ¨æŸ¥è¯¢B+Treeçš„æ—¶å€™åå‘æ£€ç´¢äº†ã€‚</p><blockquote><p><strong>ç‰¹æ®Šæƒ…å†µ</strong>ï¼šå¦‚æœæ’åºçš„æ—¶å€™å°†ageå’Œphoneçš„é¡ºåºå†™åäº†ï¼Œé‚£ä¹ˆå°±ä¸éµå¾ªæœ€å·¦å‰ç¼€æ³•åˆ™äº†ï¼Œå³ä½¿ä¸¤ä¸ªéƒ½æ˜¯ascæŸ¥è¯¢ï¼Œé‚£ä¹ˆä¹Ÿä¸ä¼šå…¨éƒ¨èµ°ç´¢å¼•ï¼Œè‡ªç„¶å°±ä¼šå‡ºç°Using filesortã€‚</p></blockquote><p>ğŸ”´ğŸŸ¡ğŸŸ¢æ€»ç»“ï¼š</p><ul><li>æ ¹æ®æ’åºå­—æ®µå»ºç«‹åˆé€‚çš„ç´¢å¼•ï¼Œå¤šå­—æ®µæ’åºæ—¶ï¼Œä¹Ÿéµå¾ªæœ€å·¦å‰ç¼€æ³•åˆ™</li><li>å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•</li><li>å¤šå­—æ®µæ’åºï¼Œä¸€ä¸ªå‡åºä¸€ä¸ªé™åºï¼Œæ­¤æ—¶éœ€è¦æ³¨æ„è”åˆç´¢å¼•åœ¨åˆ›å»ºæ—¶çš„è§„åˆ™ï¼ˆASC&#x2F;DESCï¼‰â­</li><li>å¦‚æœä¸å¯é¿å…å‡ºç°filesortï¼Œå¤§æ•°æ®é‡æ’åºæ—¶ï¼Œå¯ä»¥é€‚å½“å¢å¤§æ’åºç¼“å†²åŒºå¤§å° sort_buffer_sizeï¼ˆé»˜è®¤256kï¼‰</li></ul><h2 id="group-byä¼˜åŒ–"><a href="#group-byä¼˜åŒ–" class="headerlink" title="group byä¼˜åŒ–"></a>group byä¼˜åŒ–</h2><blockquote><p>å°½é‡ä¸è¦å‡ºç° Using temporary</p></blockquote><ul><li>åœ¨åˆ†ç»„æ“ä½œæ—¶ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•æ¥æé«˜æ•ˆç‡</li><li>åˆ†ç»„æ“ä½œæ—¶ï¼Œç´¢å¼•çš„ä½¿ç”¨ä¹Ÿæ˜¯éœ€è¦æ»¡è¶³æœ€å·¦å‰ç¼€æ³•åˆ™çš„</li></ul><p>â­ä¸‹é¢è¿™æ¡sqlä¹Ÿæ˜¯ç¬¦åˆæœ€å·¦å‰ç¼€æ³•åˆ™çš„ï¼Œprofessionå’Œageæ˜¯è”åˆç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> age , <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> tb_user <span class="keyword">where</span> profession <span class="operator">=</span> <span class="string">&#x27;è½¯ä»¶å·¥ç¨‹&#x27;</span> <span class="keyword">group</span> <span class="keyword">by</span> age ;</span><br></pre></td></tr></table></figure><h2 id="limitä¼˜åŒ–"><a href="#limitä¼˜åŒ–" class="headerlink" title="limitä¼˜åŒ–"></a>limitä¼˜åŒ–</h2><p>å¯¹äºå¤§æ•°æ®é‡çš„åˆ†é¡µæŸ¥è¯¢ï¼Œå¦‚ä¸‹ï¼ŒæŸ¥è¯¢æ•ˆç‡å¾ˆä½ï¼Œè¶Šå¾€åçš„æ•°æ®æŸ¥è¯¢æ—¶é—´è¶Šé•¿</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_sku limit <span class="number">2000000</span> , <span class="number">10</span></span><br></pre></td></tr></table></figure><p>ä¼˜åŒ–æ€è·¯: </p><p>ä¸€èˆ¬åˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œé€šè¿‡åˆ›å»ºè¦†ç›–ç´¢å¼•èƒ½å¤Ÿæ¯”è¾ƒå¥½åœ°æé«˜æ€§èƒ½ï¼Œå¯ä»¥é€šè¿‡è¦†ç›–ç´¢å¼•åŠ å­æŸ¥è¯¢å½¢å¼è¿›è¡Œä¼˜åŒ–ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> t.<span class="operator">*</span> <span class="keyword">from</span> tb_sku t , (<span class="keyword">select</span> id <span class="keyword">from</span> tb_sku <span class="keyword">order</span> <span class="keyword">by</span> id limit <span class="number">2000000</span>,<span class="number">10</span>) a <span class="keyword">where</span> t.id <span class="operator">=</span> a.id;</span><br></pre></td></tr></table></figure><h2 id="countä¼˜åŒ–"><a href="#countä¼˜åŒ–" class="headerlink" title="countä¼˜åŒ–"></a>countä¼˜åŒ–</h2><p>MyISAM å¼•æ“æŠŠä¸€ä¸ªè¡¨çš„æ€»è¡Œæ•°å­˜åœ¨äº†ç£ç›˜ä¸Šï¼Œå› æ­¤æ‰§è¡Œ count(*) çš„æ—¶å€™ä¼šç›´æ¥è¿”å›è¿™ä¸ªæ•°ï¼Œæ•ˆç‡å¾ˆé«˜ï¼ˆå‰ææ˜¯ä¸é€‚ç”¨whereï¼‰ï¼›</p><p>InnoDB åœ¨æ‰§è¡Œ count(*) æ—¶ï¼Œéœ€è¦æŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œåœ°ä»å¼•æ“é‡Œé¢è¯»å‡ºæ¥ï¼Œç„¶åç´¯è®¡è®¡æ•°ã€‚</p><blockquote><p>ä¼˜åŒ–æ–¹æ¡ˆï¼šè‡ªå·±è®¡æ•°ï¼Œå¦‚åˆ›å»ºkey-valueè¡¨å­˜å‚¨åœ¨å†…å­˜æˆ–ç¡¬ç›˜ï¼Œæˆ–è€…æ˜¯ç”¨redisï¼Œæ€»çš„æ¥è¯´æ²¡æœ‰ç‰¹åˆ«å¥½çš„ä¼˜åŒ–æ–¹å¼</p></blockquote><p>countå„ç§ç”¨æ³•çš„æ€§èƒ½ï¼š</p><ul><li>count(ä¸»é”®)ï¼šInnoDBå¼•æ“ä¼šéå†æ•´å¼ è¡¨ï¼ŒæŠŠæ¯è¡Œçš„ä¸»é”®idå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ï¼ŒæœåŠ¡å±‚æ‹¿åˆ°ä¸»é”®åï¼Œç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ ï¼ˆä¸»é”®ä¸å¯èƒ½ä¸ºç©ºï¼‰</li><li>count(å­—æ®µ)ï¼šæ²¡æœ‰not nullçº¦æŸçš„è¯ï¼ŒInnoDBå¼•æ“ä¼šéå†æ•´å¼ è¡¨æŠŠæ¯ä¸€è¡Œçš„å­—æ®µå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ï¼ŒæœåŠ¡å±‚åˆ¤æ–­æ˜¯å¦ä¸ºnullï¼Œä¸ä¸ºnullï¼Œè®¡æ•°ç´¯åŠ ï¼›æœ‰not nullçº¦æŸçš„è¯ï¼ŒInnoDBå¼•æ“ä¼šéå†æ•´å¼ è¡¨æŠŠæ¯ä¸€è¡Œçš„å­—æ®µå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ï¼Œç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ </li><li>count(1)ï¼šInnoDB å¼•æ“éå†æ•´å¼ è¡¨ï¼Œä½†ä¸å–å€¼ã€‚æœåŠ¡å±‚å¯¹äºè¿”å›çš„æ¯ä¸€å±‚ï¼Œæ”¾ä¸€ä¸ªæ•°å­— 1 è¿›å»ï¼Œç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ </li><li>count(*)ï¼šInnoDB å¼•æ“å¹¶ä¸ä¼šæŠŠå…¨éƒ¨å­—æ®µå–å‡ºæ¥ï¼Œè€Œæ˜¯ä¸“é—¨åšäº†ä¼˜åŒ–ï¼Œä¸å–å€¼ï¼ŒæœåŠ¡å±‚ç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ </li></ul><p>æŒ‰æ•ˆç‡æ’åºï¼šcount(å­—æ®µ) &lt; count(ä¸»é”®) &lt; count(1) &lt; count(*)ï¼Œæ‰€ä»¥<strong>å°½é‡ä½¿ç”¨ count(*)</strong></p><h2 id="updateä¼˜åŒ–"><a href="#updateä¼˜åŒ–" class="headerlink" title="updateä¼˜åŒ–"></a>updateä¼˜åŒ–</h2><blockquote><p>é¿å…è¡Œé”å‡çº§ä¸ºè¡¨é”</p></blockquote><p>åœ¨InnoDBä¸­çš„è¡Œé”æ˜¯é’ˆå¯¹ç´¢å¼•åŠ çš„é”ã€‚</p><p>ä¸¾ä¾‹è¯´æ˜ï¼š</p><p>å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶å¼€å¯æ—¶ï¼Œå¦‚æœæ“ä½œçš„æ˜¯ä¸åŒçš„è¡Œï¼ˆæŒ‰ç…§idæ¥åŒºåˆ†ä¸åŒçš„è¡Œï¼Œå¦‚ä¸‹SQLï¼‰ï¼Œé‚£ä¹ˆæ˜¯äº’ä¸å½±å“çš„ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> course <span class="keyword">set</span> name <span class="operator">=</span> <span class="string">&#x27;javaEE&#x27;</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span> ; #äº‹åŠ¡ä¸€<span class="keyword">SQL</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> course <span class="keyword">set</span> name <span class="operator">=</span> <span class="string">&#x27;javaEE&#x27;</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">4</span> ; #äº‹åŠ¡äºŒ<span class="keyword">SQL</span></span><br></pre></td></tr></table></figure><p>ä½†å¦‚æœæ“ä½œçš„è™½ç„¶æ˜¯ä¸åŒçš„è¡Œï¼Œä½†æ˜¯ä¸æ˜¯æŒ‰æœ‰ç´¢å¼•çš„å­—æ®µæ¥åŒºåˆ†ä¸åŒçš„è¡Œï¼Œä¾‹å¦‚æŒ‰ç…§<code>name</code>è¿™ä¸ªæ²¡æœ‰ç´¢å¼•çš„å­—æ®µæ¥åŒºåˆ†ä¸åŒçš„è¡Œï¼Œé‚£ä¹ˆæ­¤æ—¶çš„è¡Œé”å°±ä¼šå‡çº§ä¸ºè¡¨é”ï¼Œå¤§å¤§é™ä½äº†æ€§èƒ½ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> course <span class="keyword">set</span> name <span class="operator">=</span> <span class="string">&#x27;javaEE&#x27;</span> <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;PHP&#x27;</span> ; #äº‹åŠ¡ä¸€<span class="keyword">SQL</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> course <span class="keyword">set</span> name <span class="operator">=</span> <span class="string">&#x27;javaEE&#x27;</span> <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> ; #äº‹åŠ¡äºŒ<span class="keyword">SQL</span></span><br></pre></td></tr></table></figure><h1 id="é”â­â­"><a href="#é”â­â­" class="headerlink" title="é”â­â­"></a>é”â­â­</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>é”æ˜¯è®¡ç®—æœºåè°ƒå¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹å¹¶å‘è®¿é—®æŸä¸€èµ„æºçš„æœºåˆ¶ã€‚åœ¨æ•°æ®åº“ä¸­ï¼Œé™¤ä¼ ç»Ÿçš„è®¡ç®—èµ„æºï¼ˆCPUã€ RAMã€I&#x2F;Oï¼‰çš„äº‰ç”¨ä»¥å¤–ï¼Œæ•°æ®ä¹Ÿæ˜¯ä¸€ç§ä¾›è®¸å¤šç”¨æˆ·å…±äº«çš„èµ„æºã€‚å¦‚ä½•ä¿è¯æ•°æ®å¹¶å‘è®¿é—®çš„ä¸€è‡´æ€§ã€æœ‰æ•ˆæ€§æ˜¯æ‰€æœ‰æ•°æ®åº“å¿…é¡»è§£å†³çš„ä¸€ä¸ªé—®é¢˜ï¼Œé”å†²çªä¹Ÿæ˜¯å½±å“æ•°æ®åº“å¹¶å‘è®¿é—®æ€§èƒ½çš„ä¸€ä¸ªé‡è¦å› ç´ ã€‚ä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼Œé”å¯¹æ•°æ®åº“è€Œè¨€æ˜¾å¾—å°¤å…¶é‡è¦ï¼Œä¹Ÿæ›´åŠ å¤æ‚ã€‚</p><h2 id="å…¨å±€é”"><a href="#å…¨å±€é”" class="headerlink" title="å…¨å±€é”"></a>å…¨å±€é”</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>å…¨å±€é”å°±æ˜¯å¯¹æ•´ä¸ªæ•°æ®åº“å®ä¾‹åŠ é”ï¼ŒåŠ é”åæ•´ä¸ªå®ä¾‹å°±å¤„äºåªè¯»çŠ¶æ€ï¼Œåç»­çš„DMLçš„å†™è¯­å¥ï¼ŒDDLè¯­å¥ï¼Œå·²ç»æ›´æ–°æ“ä½œçš„äº‹åŠ¡æäº¤è¯­å¥éƒ½å°†è¢«é˜»å¡ã€‚ </p><blockquote><p>åœ¨MySQLä¸­ï¼Œå…¨å±€é”æ˜¯é’ˆå¯¹æ•´ä¸ªMySQLå®ä¾‹çš„é”ï¼Œè€Œä¸æ˜¯ä»…é™äºå½“å‰æ­£åœ¨ä½¿ç”¨çš„æ•°æ®åº“ã€‚</p></blockquote><h3 id="ç”¨é€”"><a href="#ç”¨é€”" class="headerlink" title="ç”¨é€”"></a>ç”¨é€”</h3><p>å…¶å…¸å‹çš„ä½¿ç”¨åœºæ™¯æ˜¯<strong>åšå…¨åº“çš„é€»è¾‘å¤‡ä»½</strong>ï¼Œå¯¹æ‰€æœ‰çš„è¡¨è¿›è¡Œé”å®šï¼Œä»è€Œè·å–ä¸€è‡´æ€§è§†å›¾ï¼Œä¿è¯æ•°æ®çš„å®Œæ•´ æ€§ã€‚</p><ol><li>ä¸åŠ é”çš„æƒ…å†µ</li></ol><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230808094927666.png" alt="ä¸åŠ é”çš„æƒ…å†µ"></p><ol start="2"><li>åŠ é”çš„æƒ…å†µï¼ˆåŒ…å«ä½¿ç”¨é”ï¼Œå¤‡ä»½ï¼Œé‡Šæ”¾é”çš„è¯­å¥ï¼‰</li></ol><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230808095133717.png" alt="åŠ é”çš„æƒ…å†µ"></p><blockquote><p>åœ¨InnoDBå¼•æ“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¤‡ä»½æ—¶åŠ ä¸Šå‚æ•° â€“single-transaction å‚æ•°æ¥å®Œæˆä¸åŠ é”çš„ä¸€è‡´æ€§æ•°æ®å¤‡ä»½ã€‚åœ¨InnoDBå¼•æ“ä¸­ï¼Œä¸åŠ é”è¿˜èƒ½ä¿è¯ä¸€è‡´æ€§å…¶å®æ˜¯é€šè¿‡å¿«ç…§è¯»æ¥å®ç°çš„ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump --single-transaction -uroot â€“p123456 itcast &gt; itcast.sql</span><br></pre></td></tr></table></figure><h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><p>æ•°æ®åº“ä¸­åŠ å…¨å±€é”ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒ<strong>é‡</strong>çš„æ“ä½œï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š </p><ul><li>å¦‚æœåœ¨ä¸»åº“ä¸Šå¤‡ä»½ï¼Œé‚£ä¹ˆåœ¨å¤‡ä»½æœŸé—´éƒ½ä¸èƒ½æ‰§è¡Œæ›´æ–°ï¼Œä¸šåŠ¡åŸºæœ¬ä¸Šå°±å¾—<strong>åœæ‘†</strong>ã€‚ </li><li>å¦‚æœåœ¨ä»åº“ä¸Šå¤‡ä»½ï¼Œé‚£ä¹ˆåœ¨å¤‡ä»½æœŸé—´ä»åº“ä¸èƒ½æ‰§è¡Œä¸»åº“åŒæ­¥è¿‡æ¥çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinlogï¼‰ï¼Œä¼šå¯¼ è‡´ä¸»ä»å»¶è¿Ÿã€‚</li></ul><h2 id="è¡¨çº§é”"><a href="#è¡¨çº§é”" class="headerlink" title="è¡¨çº§é”"></a>è¡¨çº§é”</h2><h3 id="è¡¨é”"><a href="#è¡¨é”" class="headerlink" title="è¡¨é”"></a>è¡¨é”</h3><p>è¯­æ³•ï¼š </p><ul><li>åŠ é”ï¼šlock tables è¡¨åâ€¦ read&#x2F;writeã€‚ </li><li>é‡Šæ”¾é”ï¼šunlock tables &#x2F; å®¢æˆ·ç«¯æ–­å¼€è¿æ¥ ã€‚</li></ul><hr><p>å¯¹äºè¡¨é”ï¼Œåˆ†ä¸ºä¸¤ç±»ï¼š </p><ul><li>è¡¨å…±äº«è¯»é”ï¼ˆread lockï¼‰ <code>ç®€ç§°è¯»é”</code></li></ul><blockquote><p>åŠ é”åï¼Œæ‰€æœ‰å®¢æˆ·ç«¯éƒ½èƒ½æŸ¥è¯¢ï¼Œä½†éƒ½ä¸èƒ½å¢åˆ æ”¹</p></blockquote><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230808152427342.png" alt="image-20230808152427342"></p><ul><li>è¡¨ç‹¬å å†™é”ï¼ˆwrite lockï¼‰<code>ç®€ç§°å†™é”</code></li></ul><blockquote><p>åŠ é”åï¼Œå½“å‰å®¢æˆ·ç«¯å¯ä»¥å¢åˆ æ”¹æŸ¥ï¼Œå…¶ä»–å®¢æˆ·ç«¯ä»€ä¹ˆéƒ½ä¸èƒ½åš</p></blockquote><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230808152449872.png" alt="image-20230808152449872"></p><h3 id="å…ƒæ•°æ®é”ï¼ˆmeta-data-lockï¼ŒMDLï¼‰"><a href="#å…ƒæ•°æ®é”ï¼ˆmeta-data-lockï¼ŒMDLï¼‰" class="headerlink" title="å…ƒæ•°æ®é”ï¼ˆmeta data lockï¼ŒMDLï¼‰"></a>å…ƒæ•°æ®é”ï¼ˆmeta data lockï¼ŒMDLï¼‰</h3><p>MDLåŠ é”è¿‡ç¨‹æ˜¯<strong>ç³»ç»Ÿè‡ªåŠ¨æ§åˆ¶ï¼Œæ— éœ€æ˜¾å¼ä½¿ç”¨</strong>ï¼Œåœ¨è®¿é—®ä¸€å¼ è¡¨çš„æ—¶å€™ä¼šè‡ªåŠ¨åŠ ä¸Šã€‚</p><blockquote><p>MDLé”ä¸»è¦ä½œç”¨æ˜¯ç»´æŠ¤è¡¨å…ƒæ•°æ®çš„æ•°æ®ä¸€è‡´æ€§ï¼Œåœ¨è¡¨ä¸Šæœ‰æ´»åŠ¨äº‹åŠ¡çš„æ—¶å€™ï¼Œä¸å¯ä»¥å¯¹å…ƒæ•°æ®è¿›è¡Œå†™å…¥æ“ä½œã€‚ä¸ºäº†é¿å…DMLä¸ DDLå†²çªï¼Œä¿è¯è¯»å†™çš„æ­£ç¡®æ€§ã€‚</p></blockquote><p>è¿™é‡Œçš„å…ƒæ•°æ®ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºå°±æ˜¯ä¸€å¼ è¡¨çš„è¡¨ç»“æ„ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŸä¸€å¼ è¡¨æ¶‰åŠåˆ°æœªæäº¤çš„äº‹åŠ¡ æ—¶ï¼Œæ˜¯ä¸èƒ½å¤Ÿä¿®æ”¹è¿™å¼ è¡¨çš„è¡¨ç»“æ„çš„ã€‚</p><p>ç›¸å…³åŸç†ï¼š</p><table><thead><tr><th>å¯¹åº”SQL</th><th>é”ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>lock tables xxx read &#x2F; write</td><td>SHARED_READ_ONLY &#x2F; SHARED_NO_READ_WRITE</td><td></td></tr><tr><td>select ã€select â€¦ lock in share mode</td><td>SHARED_READ</td><td>ä¸SHARED_READã€ SHARED_WRITEå…¼å®¹ï¼Œä¸ EXCLUSIVEäº’æ–¥</td></tr><tr><td>insert ã€updateã€ deleteã€select â€¦ for update</td><td>SHARED_WRITE</td><td>ä¸SHARED_READã€ SHARED_WRITEå…¼å®¹ï¼Œä¸ EXCLUSIVEäº’æ–¥</td></tr><tr><td>alter table â€¦</td><td>EXCLUSIVE</td><td>ä¸å…¶ä»–çš„MDLéƒ½äº’æ–¥</td></tr></tbody></table><p>å½“æ‰§è¡ŒSELECTã€INSERTã€UPDATEã€DELETEç­‰è¯­å¥æ—¶ï¼Œæ·»åŠ çš„æ˜¯å…ƒæ•°æ®å…±äº«é”ï¼ˆSHARED_READ &#x2F; SHARED_WRITEï¼‰ï¼Œä¹‹é—´æ˜¯å…¼å®¹çš„ã€‚</p><p>å½“æ‰§è¡ŒSELECTè¯­å¥æ—¶ï¼Œæ·»åŠ çš„æ˜¯å…ƒæ•°æ®å…±äº«é”ï¼ˆSHARED_READï¼‰ï¼Œä¼šé˜»å¡å…ƒæ•°æ®æ’ä»–é” ï¼ˆEXCLUSIVEï¼‰ï¼Œä¹‹é—´æ˜¯äº’æ–¥çš„ã€‚</p><h3 id="æ„å‘é”"><a href="#æ„å‘é”" class="headerlink" title="æ„å‘é”"></a>æ„å‘é”</h3><blockquote><p>åœ¨InnoDBå¼•æ“ä¸­ï¼Œæ„å‘é”ä¸»è¦è§£å†³çš„é—®é¢˜æ˜¯è¡Œé”å’Œè¡¨é”ä¹‹é—´å†²çªçš„é—®é¢˜</p></blockquote><p>å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230808213525299.png" alt="image-20230808213525299"></p><p>å½“å®¢æˆ·ç«¯äºŒï¼Œæƒ³å¯¹è¿™å¼ è¡¨åŠ è¡¨é”æ—¶ï¼Œä¼šæ£€æŸ¥å½“å‰è¡¨æ˜¯å¦æœ‰å¯¹åº”çš„è¡Œé”ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ·»åŠ è¡¨é”ï¼Œæ­¤æ—¶å°±ä¼šä»ç¬¬ä¸€è¡Œæ•°æ®ï¼Œæ£€æŸ¥åˆ°æœ€åä¸€è¡Œæ•°æ®ï¼Œæ•ˆç‡è¾ƒä½ã€‚</p><blockquote><p>è¡¥å……ï¼šåœ¨è¯¥åœºæ™¯ä¸­ï¼Œäº‹åŠ¡ä¸€å¼€å¯äº†ä¸€ä¸ªäº‹åŠ¡å¹¶å¯¹IDä¸º3çš„æ•°æ®è¡ŒåŠ ä¸Šäº†è¡Œé”ï¼Œè¿™æ„å‘³ç€å…¶ä»–äº‹åŠ¡ä¸èƒ½ä¿®æ”¹è¿™ä¸€è¡Œæ•°æ®ï¼Œä¿è¯äº†äº‹åŠ¡ä¸€å¯¹è¯¥è¡Œæ•°æ®çš„ç‹¬å æ€§ã€‚è€Œå¦ä¸€ä¸ªå®¢æˆ·ç«¯æƒ³è¦åœ¨æ•´å¼ è¡¨ä¸ŠåŠ ä¸€ä¸ªè¡¨é”ï¼Œè¿™æ—¶å°±ä¼šä¸äº‹åŠ¡ä¸€çš„è¡Œé”äº§ç”Ÿå†²çªï¼Œ<strong>å› ä¸ºäº‹åŠ¡ä¸€çš„è¡Œé”ä¼šé˜»æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™ä¸€è¡Œä¸ŠåŠ è¡Œé”ï¼Œä¹Ÿä¼šé˜»æ­¢å…¶ä»–äº‹åŠ¡åœ¨æ•´å¼ è¡¨ä¸ŠåŠ è¡¨é”ã€‚</strong></p></blockquote><p>æœ‰äº†æ„å‘é”ä¹‹åï¼š</p><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230808213815392.png" alt="image-20230808213815392"></p><p>æœ‰äº†æ„å‘é”ä¹‹åï¼Œçº¿ç¨‹Bä¼šé€šè¿‡æ„å‘é”æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥åŠ è¡¨é”ï¼Œå¤§å¤§æå‡æ•ˆç‡</p><p>åˆ†ç±» ï¼š</p><ul><li><code>æ„å‘å…±äº«é”(IS)</code>: ç”±è¯­å¥select â€¦ lock in share modeæ·»åŠ  ã€‚ ä¸è¡¨é”å…±äº«é” (read)å…¼å®¹ï¼Œä¸è¡¨é”æ’ä»–é”(write)äº’æ–¥ã€‚ </li><li><code>æ„å‘æ’ä»–é”(IX)</code>: ç”±insertã€updateã€deleteã€selectâ€¦for updateè‡ªåŠ¨æ·»åŠ  ã€‚ä¸è¡¨é”å…±äº«é”(read)åŠæ’ä»–é”(write)éƒ½äº’æ–¥ï¼Œæ„å‘é”ä¹‹é—´ä¸ä¼šäº’æ–¥ã€‚</li></ul><blockquote><p>ä¸€æ—¦äº‹åŠ¡æäº¤äº†ï¼Œæ„å‘å…±äº«é”ã€æ„å‘æ’ä»–é”ï¼Œéƒ½ä¼šè‡ªåŠ¨é‡Šæ”¾ã€‚</p></blockquote><h2 id="è¡Œçº§é”"><a href="#è¡Œçº§é”" class="headerlink" title="è¡Œçº§é”"></a>è¡Œçº§é”</h2><h3 id="æ¦‚å¿µ-1"><a href="#æ¦‚å¿µ-1" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>è¡Œçº§é”ï¼Œæ¯æ¬¡æ“ä½œé”ä½å¯¹åº”çš„è¡Œæ•°æ®ã€‚é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€ä½ï¼Œå¹¶å‘åº¦æœ€é«˜ã€‚åº”ç”¨åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ã€‚ </p><p>InnoDBçš„æ•°æ®æ˜¯åŸºäºç´¢å¼•ç»„ç»‡çš„ï¼Œè¡Œé”æ˜¯é€šè¿‡å¯¹ç´¢å¼•ä¸Šçš„ç´¢å¼•é¡¹åŠ é”æ¥å®ç°çš„ï¼Œè€Œä¸æ˜¯å¯¹è®°å½•åŠ çš„é”ã€‚</p><blockquote><p>è§£é‡Šï¼šå½“äº‹åŠ¡å¯¹æŸè¡Œæ•°æ®æ‰§è¡Œæ“ä½œï¼ˆä¾‹å¦‚UPDATEã€DELETEï¼‰æ—¶ï¼ŒInnoDBä¼šé€šè¿‡å¯¹æ¶‰åŠçš„ç´¢å¼•é¡¹åŠ é”æ¥å®ç°è¡Œé”ã€‚è¿™æ˜¯å› ä¸ºç´¢å¼•é¡¹å­˜å‚¨äº†æ•°æ®è¡Œçš„ä½ç½®ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦ç›´æ¥è®¿é—®å®é™…æ•°æ®ã€‚å…¶ä»–äº‹åŠ¡æƒ³è¦ä¿®æ”¹ç›¸åŒæ•°æ®è¡Œæ—¶ï¼Œä¼šå°è¯•åœ¨ç›¸åŒçš„ç´¢å¼•é¡¹ä¸ŠåŠ é”ï¼Œä»è€Œäº§ç”Ÿé”ç«äº‰ã€‚</p></blockquote><h3 id="è¡Œé”"><a href="#è¡Œé”" class="headerlink" title="è¡Œé”"></a>è¡Œé”</h3><p>è¡Œé”ï¼ˆRecord Lockï¼‰ï¼šé”å®šå•ä¸ªè¡Œè®°å½•çš„é”ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡å¯¹æ­¤è¡Œè¿›è¡Œupdateå’Œdeleteã€‚åœ¨ RCã€RRéš”ç¦»çº§åˆ«ä¸‹éƒ½æ”¯æŒã€‚</p><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230808221002435.png" alt="image-20230808221002435"></p><hr><p>InnoDBå®ç°äº†ä»¥ä¸‹ä¸¤ç§ç±»å‹çš„è¡Œé”ï¼š </p><ul><li>å…±äº«é”ï¼ˆSï¼‰ï¼šå…è®¸ä¸€ä¸ªäº‹åŠ¡å»è¯»ä¸€è¡Œï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡è·å¾—ç›¸åŒæ•°æ®é›†çš„æ’å®ƒé”ã€‚ </li><li>æ’ä»–é”ï¼ˆXï¼‰ï¼šå…è®¸è·å–æ’ä»–é”çš„äº‹åŠ¡æ›´æ–°æ•°æ®ï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡è·å¾—ç›¸åŒæ•°æ®é›†çš„å…±äº«é”å’Œæ’ä»–é”ã€‚</li></ul><p>ä¸¤ç§è¡Œé”çš„å…¼å®¹æ€§å¦‚ä¸‹å›¾ï¼š</p><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230809111747648.png" alt="image-20230809111747648"></p><p>å¸¸è§çš„SQLè¯­å¥ï¼Œåœ¨æ‰§è¡Œæ—¶ï¼Œæ‰€åŠ çš„è¡Œé”å¦‚ä¸‹ï¼š</p><table><thead><tr><th>SQL</th><th>è¡Œé”ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>INSERT â€¦</td><td>æ’ä»–é”</td><td>è‡ªåŠ¨åŠ é”</td></tr><tr><td>UPDATE â€¦</td><td>æ’ä»–é”</td><td>è‡ªåŠ¨åŠ é”</td></tr><tr><td>DELETE â€¦</td><td>æ’ä»–é”</td><td>è‡ªåŠ¨åŠ é”</td></tr><tr><td>SELECTï¼ˆæ­£å¸¸ï¼‰</td><td>ä¸åŠ ä»»ä½•é”</td><td></td></tr><tr><td>SELECT â€¦ LOCK IN SHARE MODE</td><td>å…±äº«é”</td><td>éœ€è¦æ‰‹åŠ¨åœ¨SELECTä¹‹ååŠ LOCK IN SHARE MODE</td></tr><tr><td>SELECT â€¦ FOR UPDATE</td><td>æ’ä»–é”</td><td>éœ€è¦æ‰‹åŠ¨åœ¨SELECTä¹‹ååŠ FOR UPDATE</td></tr></tbody></table><p>â­â­</p><ul><li>é’ˆå¯¹å”¯ä¸€ç´¢å¼•è¿›è¡Œæ£€ç´¢æ—¶ï¼Œå¯¹å·²å­˜åœ¨çš„è®°å½•è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶ï¼Œå°†ä¼šè‡ªåŠ¨ä¼˜åŒ–ä¸ºè¡Œé”ã€‚ </li><li>InnoDBçš„è¡Œé”æ˜¯é’ˆå¯¹äºç´¢å¼•åŠ çš„é”ï¼Œä¸é€šè¿‡ç´¢å¼•æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œé‚£ä¹ˆInnoDBå°†å¯¹è¡¨ä¸­çš„æ‰€æœ‰è®°å½•åŠ é”ï¼Œæ­¤æ—¶å°±ä¼šå‡çº§ä¸ºè¡¨é”ã€‚</li></ul><h3 id="é—´éš™é”"><a href="#é—´éš™é”" class="headerlink" title="é—´éš™é”"></a>é—´éš™é”</h3><p>é—´éš™é”ï¼ˆGap Lockï¼‰ï¼šé”å®šç´¢å¼•è®°å½•é—´éš™ï¼ˆ<strong>ä¸å«è¯¥è®°å½•</strong>ï¼‰ï¼Œç¡®ä¿ç´¢å¼•è®°å½•é—´éš™ä¸å˜ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™ä¸ªé—´éš™è¿›è¡Œinsertï¼Œäº§ç”Ÿå¹»è¯»ã€‚åœ¨RRéš”ç¦»çº§åˆ«ä¸‹éƒ½æ”¯æŒã€‚</p><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230808221125796.png" alt="image-20230808221125796"></p><h3 id="ä¸´é”®é”"><a href="#ä¸´é”®é”" class="headerlink" title="ä¸´é”®é”"></a>ä¸´é”®é”</h3><p>ä¸´é”®é”ï¼ˆNext-Key Lockï¼‰ï¼šè¡Œé”å’Œé—´éš™é”ç»„åˆï¼ŒåŒæ—¶é”ä½æ•°æ®ï¼Œå¹¶é”ä½æ•°æ®å‰é¢çš„é—´éš™Gapã€‚ åœ¨RRéš”ç¦»çº§åˆ«ä¸‹æ”¯æŒã€‚</p><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230809212205666.png" alt="image-20230809212205666"></p><h1 id="InnoDBå¼•æ“âœï¸"><a href="#InnoDBå¼•æ“âœï¸" class="headerlink" title="InnoDBå¼•æ“âœï¸"></a>InnoDBå¼•æ“âœï¸</h1><p>é€»è¾‘å­˜å‚¨ç»“æ„</p><p>æ¶æ„</p><h2 id="äº‹åŠ¡åŸç†"><a href="#äº‹åŠ¡åŸç†" class="headerlink" title="äº‹åŠ¡åŸç†"></a>äº‹åŠ¡åŸç†</h2><p>è®¨è®ºäº‹åŠ¡çš„å››ä¸ªç‰¹æ€§æ˜¯å¦‚ä½•å®ç°ä¿è¯çš„ï¼š</p><ol><li>åŸå­æ€§ï¼šä¸€è‡´æ€§ï¼ŒæŒä¹…æ€§ï¼šredo log ï¼Œundo log</li><li>éš”ç¦»æ€§ï¼šé”ï¼ŒMVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰</li></ol><p><img src="/../assets/MySQL%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86%E5%AD%A6%E4%B9%A0/image-20230824163930519.png" alt="image-20230824163930519"></p><h3 id="redo-log"><a href="#redo-log" class="headerlink" title="redo log"></a>redo log</h3><p>é‡åšæ—¥å¿—ï¼šredo logæ—¥å¿—è®°å½•çš„æ˜¯æ•°æ®é¡µçš„ç‰©ç†å˜åŒ–ï¼ŒæœåŠ¡å®•æœºå¯ç”¨æ¥åŒæ­¥æ•°æ®</p><p>redo logä¿è¯äº†äº‹åŠ¡çš„<mark>æŒä¹…æ€§</mark></p><h3 id="undo-log"><a href="#undo-log" class="headerlink" title="undo log"></a>undo log</h3><p>å›æ»šæ—¥å¿—ï¼šundo log ä¸åŒï¼Œå®ƒä¸»è¦è®°å½•çš„æ˜¯é€»è¾‘æ—¥å¿—ï¼Œå½“äº‹åŠ¡å›æ»šæ—¶ï¼Œé€šè¿‡é€†æ“ä½œæ¢å¤åŸæ¥çš„æ•°æ®ï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ é™¤ä¸€æ¡æ•°æ®çš„æ—¶å€™ï¼Œå°±ä¼šåœ¨undo logæ—¥å¿—æ–‡ä»¶ä¸­æ–°å¢ä¸€æ¡deleteè¯­å¥ï¼Œå¦‚æœå‘ç”Ÿå›æ»šå°±æ‰§è¡Œé€†æ“ä½œ</p><p>undo logä¿è¯äº†äº‹åŠ¡çš„<mark>åŸå­æ€§å’Œä¸€è‡´æ€§</mark></p><h2 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h2><p>äº‹åŠ¡çš„<mark>éš”ç¦»æ€§</mark>æ˜¯ç”±é”å’Œmvccå®ç°çš„ã€‚</p><p>å…¶ä¸­mvccçš„æ„æ€æ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚æŒ‡ç»´æŠ¤ä¸€ä¸ªæ•°æ®çš„å¤šä¸ªç‰ˆæœ¬ï¼Œä½¿å¾—è¯»å†™æ“ä½œæ²¡æœ‰å†²çªï¼Œå®ƒçš„åº•å±‚å®ç°ä¸»è¦æ˜¯åˆ†ä¸ºäº†ä¸‰ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€ä¸ªæ˜¯éšè—å­—æ®µï¼Œç¬¬äºŒä¸ªæ˜¯undo logæ—¥å¿—ï¼Œç¬¬ä¸‰ä¸ªæ˜¯readViewè¯»è§†å›¾</p><p><strong>éšè—å­—æ®µ</strong>æ˜¯æŒ‡ï¼šåœ¨mysqlä¸­ç»™æ¯ä¸ªè¡¨éƒ½è®¾ç½®äº†éšè—å­—æ®µï¼Œæœ‰ä¸€ä¸ªæ˜¯trx_id(<mark>äº‹åŠ¡id</mark>)ï¼Œè®°å½•æ¯ä¸€æ¬¡æ“ä½œçš„äº‹åŠ¡idï¼Œæ˜¯è‡ªå¢çš„ï¼›å¦ä¸€ä¸ªå­—æ®µæ˜¯roll_pointer(<mark>å›æ»šæŒ‡é’ˆ</mark>)ï¼ŒæŒ‡å‘ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„äº‹åŠ¡ç‰ˆæœ¬è®°å½•åœ°å€</p><p><strong>undo log</strong>ä¸»è¦çš„ä½œç”¨æ˜¯<mark>è®°å½•å›æ»šæ—¥å¿—</mark>ï¼Œå­˜å‚¨è€ç‰ˆæœ¬æ•°æ®ï¼Œåœ¨å†…éƒ¨ä¼šå½¢æˆä¸€ä¸ªç‰ˆæœ¬é“¾ï¼Œåœ¨å¤šä¸ªäº‹åŠ¡å¹¶è¡Œæ“ä½œæŸä¸€è¡Œè®°å½•ï¼Œè®°å½•ä¸åŒäº‹åŠ¡ä¿®æ”¹æ•°æ®çš„ç‰ˆæœ¬ï¼Œé€šè¿‡roll_pointeræŒ‡é’ˆå½¢æˆä¸€ä¸ªé“¾è¡¨</p><p><strong>readView</strong>è§£å†³çš„æ˜¯<mark>ä¸€ä¸ªäº‹åŠ¡æŸ¥è¯¢é€‰æ‹©ç‰ˆæœ¬çš„é—®é¢˜</mark>ï¼Œåœ¨å†…éƒ¨å®šä¹‰äº†ä¸€äº›åŒ¹é…è§„åˆ™å’Œå½“å‰çš„ä¸€äº›äº‹åŠ¡idåˆ¤æ–­è¯¥è®¿é—®é‚£ä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œä¸åŒçš„éš”ç¦»çº§åˆ«å¿«ç…§è¯»æ˜¯ä¸ä¸€æ ·çš„ï¼Œæœ€ç»ˆçš„è®¿é—®çš„ç»“æœä¸ä¸€æ ·ã€‚å¦‚æœæ˜¯rcéš”ç¦»çº§åˆ«ï¼Œæ¯ä¸€æ¬¡æ‰§è¡Œå¿«ç…§è¯»æ—¶ç”ŸæˆReadViewï¼Œå¦‚æœæ˜¯rréš”ç¦»çº§åˆ«ä»…åœ¨äº‹åŠ¡ä¸­ç¬¬ä¸€æ¬¡æ‰§è¡Œå¿«ç…§è¯»æ—¶ç”ŸæˆReadViewï¼Œåç»­å¤ç”¨</p><h1 id="ä¸»ä»å¤åˆ¶"><a href="#ä¸»ä»å¤åˆ¶" class="headerlink" title="ä¸»ä»å¤åˆ¶"></a>ä¸»ä»å¤åˆ¶</h1><p>å®ƒçš„æ­¥éª¤æ˜¯è¿™æ ·çš„ï¼š</p><p>ç¬¬ä¸€ï¼šä¸»åº“åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œä¼šæŠŠæ•°æ®å˜æ›´è®°å½•åœ¨äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ <mark>Binlog</mark> ä¸­ã€‚</p><p>ç¬¬äºŒï¼šä»åº“è¯»å–ä¸»åº“çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ Binlog ï¼Œå†™å…¥åˆ°ä»åº“çš„ä¸­ç»§æ—¥å¿— Relay Log ã€‚</p><p>ç¬¬ä¸‰ï¼šä»åº“é‡åšä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†æ”¹å˜åæ˜ å®ƒè‡ªå·±çš„æ•°æ®</p><h1 id="åˆ†åº“åˆ†è¡¨"><a href="#åˆ†åº“åˆ†è¡¨" class="headerlink" title="åˆ†åº“åˆ†è¡¨"></a>åˆ†åº“åˆ†è¡¨</h1><h1 id="è¯»å†™åˆ†ç¦»"><a href="#è¯»å†™åˆ†ç¦»" class="headerlink" title="è¯»å†™åˆ†ç¦»"></a>è¯»å†™åˆ†ç¦»</h1>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç‘å‰å¤–å–åç»­ä¼˜åŒ–</title>
      <link href="/2023/01/05/Project-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E5%90%8E%E7%BB%AD%E4%BC%98%E5%8C%96/"/>
      <url>/2023/01/05/Project-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E5%90%8E%E7%BB%AD%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="ç¼“å­˜ä¼˜åŒ–"><a href="#ç¼“å­˜ä¼˜åŒ–" class="headerlink" title="ç¼“å­˜ä¼˜åŒ–"></a>ç¼“å­˜ä¼˜åŒ–</h1><h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>ä¹‹å‰å®Œæˆäº†ç‘å‰å¤–å–é¡¹ç›®çš„å…¨éƒ¨åŠŸèƒ½ï¼Œä½†æœªå¯¹æ€§èƒ½è¿›è¡Œä¼˜åŒ–ï¼Œæœ¬æ¬¡å°†ä½¿ç”¨redisç­‰æŠ€æœ¯å®ç°ä¼˜åŒ–ã€‚</p><h2 id="ç¼“å­˜çŸ­ä¿¡éªŒè¯ç "><a href="#ç¼“å­˜çŸ­ä¿¡éªŒè¯ç " class="headerlink" title="ç¼“å­˜çŸ­ä¿¡éªŒè¯ç "></a>ç¼“å­˜çŸ­ä¿¡éªŒè¯ç </h2><h3 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>ä¹‹å‰çš„çŸ­ä¿¡éªŒè¯ç æ˜¯å­˜åœ¨sessionä¸­çš„ï¼Œç›¸è¾ƒäºå­˜åœ¨redisè€Œè¨€ï¼Œå®ƒä¸é‚£ä¹ˆå®‰å…¨ï¼Œä¸”ä¸èƒ½è®¾ç½®çŸ­ä¿¡éªŒè¯ç ç”Ÿæ•ˆæ—¶é—´ï¼Œæ•…ä½¿ç”¨redisè¿›è¡Œä¼˜åŒ–ã€‚</p><ul><li><p>åœ¨UserControllerç±»ä¸­æ³¨å…¥redisTemplateå¯¹è±¡</p></li><li><p>å°†éªŒè¯ç å­˜å…¥redisä¸­ï¼Œå¹¶è®¾ç½®éªŒè¯ç è¿‡æœŸæ—¶é—´</p></li><li><p>ä»redisä¸­è·å–éªŒè¯ç ï¼Œå¹¶åœ¨ç™»å½•æˆåŠŸåç«‹å³åˆ é™¤éªŒè¯ç </p></li></ul><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å°†éªŒè¯ç å­˜å…¥Session</span></span><br><span class="line"><span class="comment">//session.setAttribute(phone, code);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†éªŒè¯ç å­˜å…¥redisä¸­ï¼Œå¹¶è®¾ç½®éªŒè¯ç è¿‡æœŸæ—¶é—´</span></span><br><span class="line">redisTemplate.opsForValue().setIfAbsent(phone,code,<span class="number">5</span>, TimeUnit.MINUTES);</span><br></pre></td></tr></table></figure><hr><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä»sessionä¸­å–å‡ºç”Ÿæˆçš„éªŒè¯ç </span></span><br><span class="line"><span class="comment">//Object codeInSession = session.getAttribute(phone);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»redisä¸­å–å‡ºç”Ÿæˆçš„éªŒè¯ç </span></span><br><span class="line"><span class="type">Object</span> <span class="variable">codeInSession</span> <span class="operator">=</span> redisTemplate.opsForValue().get(phone);</span><br></pre></td></tr></table></figure><hr><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç™»å½•æˆåŠŸåï¼Œåˆ é™¤redisä¸­çš„æ•°æ®</span></span><br><span class="line">redisTemplate.delete(phone);</span><br></pre></td></tr></table></figure><hr><h2 id="ç¼“å­˜èœå“æ•°æ®"><a href="#ç¼“å­˜èœå“æ•°æ®" class="headerlink" title="ç¼“å­˜èœå“æ•°æ®"></a>ç¼“å­˜èœå“æ•°æ®</h2><h3 id="éœ€æ±‚åˆ†æ-1"><a href="#éœ€æ±‚åˆ†æ-1" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>ç§»åŠ¨ç«¯åœ¨ç™»å½•è¿‡åï¼Œä¼šç»å¸¸è®¿é—®å±•ç¤ºèœå“å’Œå¥—é¤çš„ç•Œé¢ï¼Œè¯¥ç•Œé¢çš„å±•ç¤ºæ–¹æ³•å¯¹åº”çš„æ˜¯DishControllerå’ŒSetmealControllerä¸­çš„ä¸¤ä¸ªlistæ–¹æ³•ï¼Œæ•…éœ€è¦å¯¹è¯¥æ–¹æ³•è¿›è¡Œç¼“å­˜ä¼˜åŒ–ï¼Œä½¿å¾—å­˜åœ¨ç¼“å­˜æ—¶å°†ç¼“å­˜æ•°æ®ç›´æ¥ä¼ ç»™å‰ç«¯ï¼Œè€Œæ— éœ€å†è®¿é—®æ•°æ®åº“ã€‚</p><p>å…¶æ¬¡æ˜¯è¦é˜²æ­¢äº§ç”Ÿè„æ•°æ®ï¼Œå¦‚éœ€è¦åœ¨saveï¼Œupdateï¼Œstatusæ–¹æ³•æ‰§è¡Œåå°†ç¼“å­˜æ¸…é™¤ï¼Œä»¥å…æ•°æ®åº“çš„æ•°æ®å·²ç»æ›´æ”¹ï¼Œè€Œç§»åŠ¨ç«¯é¡µé¢å› ä¸ºå­˜åœ¨ç¼“å­˜è€Œä¸æŸ¥è¯¢æ•°æ®åº“å¯¼è‡´æ•°æ®çš„é”™ä¹±ã€‚</p><p>æ­¤å¤„éœ€æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸å¯¹deleteæ–¹æ³•åšæ¸…é™¤ç¼“å­˜çš„åŸå› æ˜¯ï¼šæˆ‘ä»¬è®¾è®¡æ•°æ®åº“è¡¨çš„æ—¶å€™å¯¹äºèœå“æˆ–è€…å¥—é¤çš„åˆ é™¤æ˜¯é€»è¾‘åˆ é™¤ï¼ŒåŒæ—¶listå±•ç¤ºæ–¹æ³•ä¹Ÿä¼šæœ‰èµ·å”®çŠ¶æ€çš„é™åˆ¶ï¼Œæ•…æ— éœ€å†åœ¨deleteæ–¹æ³•ä¸Šå¯¹ç¼“å­˜è¿›è¡Œæ¸…é™¤ã€‚</p><h3 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><p>æ­¤å¤„å¯¹äºkeyçš„å¤„ç†æ˜¯ç»Ÿä¸€ä½¿ç”¨åˆ†ç±»æ¥è¿›è¡ŒåŒºåˆ†ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»æŸä¸€ä¸ªåˆ†ç±»æ—¶ï¼Œåªéœ€å±•ç¤ºå½“å‰åˆ†ç±»ä¸‹çš„èœå“ï¼Œè€Œå…¶ä»–åˆ†ç±»çš„èœå“æ•°æ®å¹¶ä¸éœ€è¦å±•ç¤ºã€‚</p><h4 id="listæ–¹æ³•"><a href="#listæ–¹æ³•" class="headerlink" title="listæ–¹æ³•"></a>listæ–¹æ³•</h4><ul><li>åŠ¨æ€è·å–key</li><li>åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç¼“å­˜</li><li>ç¼“å­˜å­˜åœ¨åˆ™æ— éœ€æŸ¥è¯¢æ•°æ®åº“ï¼Œç›´æ¥è¿”å›ç¼“å­˜</li><li>ç¼“å­˜ä¸å­˜åœ¨åˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œå¹¶å°†æŸ¥è¯¢ç»“æœä¿å­˜åœ¨ç¼“å­˜ä¸­</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§»åŠ¨ç«¯å±•ç¤ºèœå“æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dish</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;List&lt;DishDto&gt;&gt; <span class="title function_">list</span><span class="params">(Dish dish)</span> &#123;</span><br><span class="line">        <span class="comment">//åŠ¨æ€è·å–ä¸€ä¸ªkey</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;dish_&quot;</span> + dish.getCategoryId() + <span class="string">&quot;_1&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­ç¼“å­˜æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        List&lt;DishDto&gt; dishDtoList;</span><br><span class="line">        dishDtoList = (List&lt;DishDto&gt;) redisTemplate.opsForValue().get(key);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¦‚æœç¼“å­˜å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (dishDtoList != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.success(dishDtoList);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¦‚æœç¼“å­˜ä¸å­˜åœ¨ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œå¹¶å°†æŸ¥è¯¢åˆ°çš„é›†åˆå­˜å…¥ç¼“å­˜ä¸­</span></span><br><span class="line">        dishDtoList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ„é€ æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line">        LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(dish.getCategoryId() != <span class="literal">null</span>, Dish::getCategoryId, dish.getCategoryId());</span><br><span class="line">        <span class="comment">//æ·»åŠ æ¡ä»¶ï¼ŒæŸ¥è¯¢çŠ¶æ€ä¸º1ï¼ˆèµ·å”®çŠ¶æ€ï¼‰çš„èœå“</span></span><br><span class="line">        queryWrapper.eq(Dish::getStatus, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ·»åŠ æ’åºæ¡ä»¶</span></span><br><span class="line">        queryWrapper.orderByAsc(Dish::getSort).orderByDesc(Dish::getUpdateTime);</span><br><span class="line"></span><br><span class="line">        List&lt;Dish&gt; list = dishService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Dish dish1 : list) &#123;</span><br><span class="line">            <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line">            BeanUtils.copyProperties(dish1, dishDto);</span><br><span class="line">            <span class="comment">//è·å¾—èœå“åˆ†ç±»çš„id</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">categoryId</span> <span class="operator">=</span> dish1.getCategoryId();</span><br><span class="line">            <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(categoryId);</span><br><span class="line">            <span class="comment">//æ ¹æ®idæŸ¥è¯¢åˆ†ç±»å¯¹è±¡</span></span><br><span class="line">            <span class="keyword">if</span> (category != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">categoryName</span> <span class="operator">=</span> category.getName();</span><br><span class="line">                dishDto.setCategoryName(categoryName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//è·å–å½“å‰èœå“çš„id</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> dish1.getId();</span><br><span class="line">            LambdaQueryWrapper&lt;DishFlavor&gt; queryWrapper1 = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            queryWrapper1.eq(DishFlavor::getDishId, dishId);</span><br><span class="line">            List&lt;DishFlavor&gt; list1 = dishFlavorService.list(queryWrapper1);</span><br><span class="line">            dishDto.setFlavors(list1);</span><br><span class="line"></span><br><span class="line">            dishDtoList.add(dishDto);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å°†æŸ¥è¯¢åˆ°çš„é›†åˆå­˜å…¥ç¼“å­˜ä¸­</span></span><br><span class="line">        redisTemplate.opsForValue().setIfAbsent(key, dishDtoList, <span class="number">60</span>, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(dishDtoList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="saveæ–¹æ³•"><a href="#saveæ–¹æ³•" class="headerlink" title="saveæ–¹æ³•"></a>saveæ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–°å¢èœå“åŠŸèƒ½</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> DishDto dishDto)</span> &#123;</span><br><span class="line">    dishService.saveWithFlavor(dishDto);</span><br><span class="line">    <span class="comment">//ç²¾ç¡®æ¸…ç†å½“å‰åˆ†ç±»çš„ç¼“å­˜</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;dish_&quot;</span> + dishDto.getCategoryId() + <span class="string">&quot;_1&quot;</span>;</span><br><span class="line">    redisTemplate.delete(key);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;æ–°å¢èœå“æˆåŠŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="updateæ–¹æ³•"><a href="#updateæ–¹æ³•" class="headerlink" title="updateæ–¹æ³•"></a>updateæ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¿®æ”¹èœå“åŠŸèƒ½</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dishDto</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> DishDto dishDto)</span> &#123;</span><br><span class="line">    dishService.updateWithFlavor(dishDto);</span><br><span class="line">    <span class="comment">//ç²¾ç¡®æ¸…ç†å½“å‰åˆ†ç±»çš„ç¼“å­˜</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;dish_&quot;</span> + dishDto.getCategoryId() + <span class="string">&quot;_1&quot;</span>;</span><br><span class="line">    redisTemplate.delete(key);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;èœå“ä¿¡æ¯ä¿®æ”¹æˆåŠŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="statusæ–¹æ³•"><a href="#statusæ–¹æ³•" class="headerlink" title="statusæ–¹æ³•"></a>statusæ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰¹é‡èµ·å”®ã€åœå”®èœå“</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">changeStatus</span><span class="params">(<span class="meta">@PathVariable(&quot;status&quot;)</span> Integer status, Long[] ids)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">        <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> dishService.getById(id);</span><br><span class="line">        <span class="keyword">if</span> (dish != <span class="literal">null</span>) &#123;</span><br><span class="line">            dish.setStatus(status);</span><br><span class="line">            dishService.updateById(dish);</span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;dish_&quot;</span> + dish.getCategoryId() + <span class="string">&quot;_1&quot;</span>;</span><br><span class="line">            redisTemplate.delete(key);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;èœå“å”®å–çŠ¶æ€ä¿®æ”¹æˆåŠŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="SpringCacheæŠ€æœ¯"><a href="#SpringCacheæŠ€æœ¯" class="headerlink" title="SpringCacheæŠ€æœ¯"></a>SpringCacheæŠ€æœ¯</h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>SpringCacheæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå®ç°äº†åŸºæœ¬æ³¨è§£çš„ç¼“å­˜åŠŸèƒ½ï¼Œåªéœ€è¦ç®€å•çš„æ·»åŠ ä¸€ä¸ªæ³¨è§£ï¼Œå°±èƒ½å®ç°ç¼“å­˜åŠŸèƒ½</p><h3 id="å¸¸ç”¨æ³¨è§£"><a href="#å¸¸ç”¨æ³¨è§£" class="headerlink" title="å¸¸ç”¨æ³¨è§£"></a>å¸¸ç”¨æ³¨è§£</h3><table><thead><tr><th align="center">æ³¨è§£</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">@EnableCaching</td><td align="center">å¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½</td></tr><tr><td align="center">@Cacheable</td><td align="center">åœ¨æ–¹æ³•æ‰§è¡Œå‰springå…ˆæŸ¥çœ‹ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ã€‚å¦‚æœæœ‰æ•°æ®ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼›è‹¥æ²¡æœ‰æ•°æ®ï¼Œè°ƒç”¨æ–¹æ³•å¹¶å°†æ–¹æ³•è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­</td></tr><tr><td align="center">@CachePut</td><td align="center">å°†æ–¹æ³•çš„è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­</td></tr><tr><td align="center">@CacheEvict</td><td align="center">å°†ä¸€æ¡æˆ–è€…å¤šæ¡æ•°æ®ä»ç¼“å­˜ä¸­åˆ é™¤</td></tr></tbody></table><hr><h2 id="ç¼“å­˜å¥—é¤æ•°æ®"><a href="#ç¼“å­˜å¥—é¤æ•°æ®" class="headerlink" title="ç¼“å­˜å¥—é¤æ•°æ®"></a>ç¼“å­˜å¥—é¤æ•°æ®</h2><h3 id="éœ€æ±‚åˆ†æ-2"><a href="#éœ€æ±‚åˆ†æ-2" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>ä¸èœå“çš„åˆ†æåŸºæœ¬ä¸€è‡´ï¼Œæ­¤å¤„ä¸è¿‡æ˜¯ç”¨å¦ä¸€ç§è¾ƒä¸ºç®€å•çš„æ–¹å¼è¿›è¡Œæ“ä½œç¼“å­˜è€Œå·²</p><h3 id="ä»£ç å®ç°-2"><a href="#ä»£ç å®ç°-2" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><ol><li>å¯¼å…¥mavenåæ ‡</li><li>åœ¨application.ymlæ–‡ä»¶é…ç½®cache</li><li>åœ¨å¯åŠ¨ç±»ä¸ŠåŠ ä¸Š<code>@EnableCaching</code>æ³¨è§£</li><li>listæ–¹æ³•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="meta">@Cacheable(value = &quot;setmealCache&quot;, key = &quot;#setmeal.categoryId+&#x27;_&#x27;+#setmeal.status&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;List&lt;Setmeal&gt;&gt; <span class="title function_">list</span><span class="params">(Setmeal setmeal)</span> &#123;</span><br></pre></td></tr></table></figure><ol start="5"><li>saveæ–¹æ³•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="meta">@CacheEvict(value = &quot;setmealCache&quot;, allEntries = true)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> SetmealDto setmealDto)</span> &#123;</span><br></pre></td></tr></table></figure><ol start="6"><li>updateæ–¹æ³•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="meta">@CacheEvict(value = &quot;setmealCache&quot;, allEntries = true)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> SetmealDto setmealDto)</span> &#123;</span><br></pre></td></tr></table></figure><ol start="7"><li>statusæ–¹æ³•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line"><span class="meta">@CacheEvict(value = &quot;setmealCache&quot;, allEntries = true)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">changeStatus</span><span class="params">(<span class="meta">@PathVariable(&quot;status&quot;)</span> Integer status, Long[] ids)</span> &#123;</span><br></pre></td></tr></table></figure><hr><h1 id="è¯»å†™åˆ†ç¦»ä¼˜åŒ–"><a href="#è¯»å†™åˆ†ç¦»ä¼˜åŒ–" class="headerlink" title="è¯»å†™åˆ†ç¦»ä¼˜åŒ–"></a>è¯»å†™åˆ†ç¦»ä¼˜åŒ–</h1><h2 id="ä¸ºä»€ä¹ˆè¦è¯»å†™åˆ†ç¦»"><a href="#ä¸ºä»€ä¹ˆè¦è¯»å†™åˆ†ç¦»" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è¯»å†™åˆ†ç¦»"></a>ä¸ºä»€ä¹ˆè¦è¯»å†™åˆ†ç¦»</h2><p>å› ä¸ºä¹‹å‰å¯¹äºæ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥éƒ½æ˜¯å¯¹åŒä¸€å°æœåŠ¡å™¨è¿›è¡Œæ“ä½œï¼Œä¸ä»…è¿™æ ·å¯¹å•ä¸ªæœåŠ¡å™¨çš„å‹åŠ›å¾ˆå¤§ï¼Œè€Œä¸”å¦‚æœè¯¥æœåŠ¡å™¨çš„ç¡¬ç›˜æŸæ¯ï¼Œåˆ™æ•°æ®ä¹Ÿä¼šä¸¢å¤±ï¼Œä¼šä¸å®‰å…¨ã€‚è€Œä½¿ç”¨è¯»å†™åˆ†ç¦»æ˜¯åŸºäºMySQLæä¾›çš„ä¸»ä»å¤åˆ¶åŠŸèƒ½å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä¸»åº“è¿›è¡Œå¢åˆ æ”¹çš„æ“ä½œï¼Œå¯¹ä»åº“è¿›è¡ŒæŸ¥æ‰¾çš„æ“ä½œï¼Œè€Œå¯¹ä¸»åº“çš„ä¿®æ”¹ä¼šé€šè¿‡æ—¥å¿—çš„å½¢å¼åŒæ­¥ä¿®æ”¹åˆ°ä»åº“ä¸­ï¼Œä»è€Œä¿è¯æ•°æ®æ˜¯æ­£ç¡®çš„ã€‚</p><p><img src="/../assets/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E5%90%8E%E7%BB%AD%E4%BC%98%E5%8C%96/%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.png" alt="è¯»å†™åˆ†ç¦»å›¾"></p><hr><h2 id="MySQLä¸»ä»å¤åˆ¶"><a href="#MySQLä¸»ä»å¤åˆ¶" class="headerlink" title="MySQLä¸»ä»å¤åˆ¶"></a>MySQLä¸»ä»å¤åˆ¶</h2><p>MySQLå¤åˆ¶è¿‡ç¨‹åˆ†æˆä¸‰æ­¥:</p><ul><li><p>masterå°†æ”¹å˜è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinary log)</p></li><li><p>slaveå°†masterçš„binary logæ‹·è´åˆ°å®ƒçš„ä¸­ç»§æ—¥å¿—ï¼ˆrelay log)</p></li><li><p>slaveé‡åšä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†æ”¹å˜åº”ç”¨åˆ°è‡ªå·±çš„æ•°æ®åº“ä¸­</p></li></ul><h2 id="è¯»å†™åˆ†ç¦»"><a href="#è¯»å†™åˆ†ç¦»" class="headerlink" title="è¯»å†™åˆ†ç¦»"></a>è¯»å†™åˆ†ç¦»</h2><p><img src="/../assets/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E5%90%8E%E7%BB%AD%E4%BC%98%E5%8C%96/image-20230728162538415.png" alt="image-20230728162538415"></p><h1 id="å†™åœ¨åé¢"><a href="#å†™åœ¨åé¢" class="headerlink" title="å†™åœ¨åé¢"></a>å†™åœ¨åé¢</h1><p>åç»­çš„MySQLçš„è¯»å†™åˆ†ç¦»ä¼˜åŒ–ï¼Œnginxï¼Œswaggerç­‰ä¼˜åŒ–å¾…ç»­â€¦â€¦</p>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç‘å‰å¤–å– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8æ–°ç‰¹æ€§</title>
      <link href="/2023/01/04/Study-Java8%E6%96%B0%E7%89%B9%E6%80%A7/"/>
      <url>/2023/01/04/Study-Java8%E6%96%B0%E7%89%B9%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="Java8æ–°ç‰¹æ€§"><a href="#Java8æ–°ç‰¹æ€§" class="headerlink" title="Java8æ–°ç‰¹æ€§"></a>Java8æ–°ç‰¹æ€§</h1><h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>åœ¨å­¦ä¹ ç‘å‰å¤–å–é¡¹ç›®æ—¶ä½¿ç”¨åˆ°çš„streamæµæ“ä½œï¼Œç°åœ¨å›æ¥è¡¥ä¸€ä¸‹ï¼Œçœ‹çš„è§†é¢‘æ•™ç¨‹ä¾ç„¶æ˜¯<a href="https://www.bilibili.com/video/BV18J411W7cE/?spm_id_from=333.1007.top_right_bar_window_custom_collection.content.click&vd_source=fa7ba4ae353f08f1d08d1bb24528e96c">é»‘é©¬ç¨‹åºå‘˜</a></p><h2 id="lambdaè¡¨è¾¾å¼â­â­â­"><a href="#lambdaè¡¨è¾¾å¼â­â­â­" class="headerlink" title="lambdaè¡¨è¾¾å¼â­â­â­"></a>lambdaè¡¨è¾¾å¼â­â­â­</h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><blockquote><p>å¯ä»¥ç†è§£ä¸ºæ˜¯åŒ¿åå†…éƒ¨ç±»çš„å¦ä¸€ç§å†™æ³•ï¼Œæœ¬è´¨æ˜¯æ³¨é‡åšäº†ä»€ä¹ˆã€‚</p></blockquote><h3 id="ä½¿ç”¨æ¡ä»¶"><a href="#ä½¿ç”¨æ¡ä»¶" class="headerlink" title="ä½¿ç”¨æ¡ä»¶"></a>ä½¿ç”¨æ¡ä»¶</h3><blockquote><ul><li><p>éœ€è¦æœ‰ä¸€ä¸ªæ¥å£ï¼Œè¯¥æ¥å£ä¸­æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå…¶å®ä¹Ÿå¯ä»¥è¯´æ˜¯å‡½æ•°å¼æ¥å£ã€‚</p></li><li><p>å¿…é¡»è¦æœ‰ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå³å¯ä»¥æ¨å¯¼</p></li></ul></blockquote><h3 id="å…·ä½“æ ¼å¼ï¼ˆå½¢å¼ï¼‰"><a href="#å…·ä½“æ ¼å¼ï¼ˆå½¢å¼ï¼‰" class="headerlink" title="å…·ä½“æ ¼å¼ï¼ˆå½¢å¼ï¼‰"></a>å…·ä½“æ ¼å¼ï¼ˆå½¢å¼ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆè°ƒç”¨çš„å‚æ•°ï¼‰-&gt;&#123;</span><br><span class="line">    æ‰§è¡Œçš„è¯­å¥</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">s -&gt; System.out.println(<span class="string">&quot;Hello World&quot;</span>)</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¸å¦‚<code>int</code>ï¼Œ<code>String</code>è¿™æ ·çš„å˜é‡ç±»å‹å¯ä»¥çœç•¥ï¼Œä¸è¿‡è¦çœå°±å…¨éƒ¨ä¸€èµ·çœï¼Œåªç”¨ä¸€ä¸ªè°ƒç”¨å‚æ•°çš„è¯å°æ‹¬å·ä¹Ÿå¯ä»¥çœï¼Œåªæœ‰ä¸€æ¡æ‰§è¡Œè¯­å¥å¤§æ‹¬å·ä¹Ÿå¯ä»¥çœç•¥ï¼Œä¸”æ­¤æ—¶<code>return</code>å…³é”®å­—ä¹Ÿå¯ä»¥çœç•¥ã€‚</p><hr><h2 id="æ–¹æ³•å¼•ç”¨â­â­"><a href="#æ–¹æ³•å¼•ç”¨â­â­" class="headerlink" title="æ–¹æ³•å¼•ç”¨â­â­"></a>æ–¹æ³•å¼•ç”¨â­â­</h2><h3 id="ä»‹ç»-1"><a href="#ä»‹ç»-1" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><blockquote><p>å¯ä»¥ç”¨lambdaè¡¨è¾¾å¼çš„åœ°æ–¹å°±å¯ä»¥ä½¿ç”¨æ–¹æ³•å¼•ç”¨ï¼Œå¯ä»¥è¯´ä»–ä»¬æ˜¯å­ªç”Ÿå…„å¼Ÿã€‚</p></blockquote><h3 id="å…·ä½“å½¢å¼"><a href="#å…·ä½“å½¢å¼" class="headerlink" title="å…·ä½“å½¢å¼"></a>å…·ä½“å½¢å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out::println</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç†è§£ä¸ºSystem.outè¿™ä¸ªå¯¹è±¡è°ƒç”¨äº†printlnè¿™ä¸ªæ–¹æ³•ï¼Œå› ä¸ºè·Ÿlambdaç±»ä¼¼ï¼Œæ˜¯å¯ä»¥æ¨å¯¼å‡ºæ¥çš„ï¼Œï¼ˆ<strong>èƒ½æ¨å¯¼çš„å°±æ˜¯å¯ä»¥çœç•¥çš„</strong>ï¼‰</p><h3 id="å‡ ç§å½¢å¼"><a href="#å‡ ç§å½¢å¼" class="headerlink" title="å‡ ç§å½¢å¼"></a>å‡ ç§å½¢å¼</h3><ol><li>å¼•ç”¨ç±»æ–¹æ³•ï¼š</li></ol><p>â€‹ç±»å::é™æ€æ–¹æ³•ï¼ˆInterger::parseIntï¼‰</p><ol start="2"><li>å¼•ç”¨å¯¹è±¡çš„å®ä¾‹æ–¹æ³•</li></ol><p>â€‹å¯¹è±¡::æ–¹æ³•</p><ol start="3"><li>å¼•ç”¨ç±»çš„å®ä¾‹æ–¹æ³•</li></ol><p>â€‹ç±»å::æ–¹æ³•</p><ol start="4"><li>å¼•ç”¨æ„é€ å™¨</li></ol><p>â€‹ç±»å::new</p><blockquote><p>å…·ä½“å¯ä»¥å‚è€ƒ<a href="https://www.bilibili.com/video/BV12R4y157Be/?spm_id_from=333.1007.top_right_bar_window_custom_collection.content.click&vd_source=fa7ba4ae353f08f1d08d1bb24528e96c">mybatispluså­¦ä¹ </a>ä¸­çš„æ¡ä»¶æ„é€ å™¨</p></blockquote><hr><h2 id="æ¥å£æ–°ç‰¹æ€§"><a href="#æ¥å£æ–°ç‰¹æ€§" class="headerlink" title="æ¥å£æ–°ç‰¹æ€§"></a>æ¥å£æ–°ç‰¹æ€§</h2><h3 id="é»˜è®¤æ–¹æ³•"><a href="#é»˜è®¤æ–¹æ³•" class="headerlink" title="é»˜è®¤æ–¹æ³•"></a>é»˜è®¤æ–¹æ³•</h3><p>åœ¨æ–¹æ³•å‰å¯ä»¥åŠ ä¸€ä¸ªdefaultä»£è¡¨é»˜è®¤æ–¹æ³•ï¼Œå®ç°è¯¥æ¥å£çš„å®ç°ç±»ä¸ç”¨å¿…é¡»é‡å†™è¯¥æ–¹æ³•ï¼Œä½†æœ‰éœ€è¦ä¹Ÿæ˜¯å¯ä»¥é‡å†™çš„ã€‚</p><h3 id="é™æ€æ–¹æ³•"><a href="#é™æ€æ–¹æ³•" class="headerlink" title="é™æ€æ–¹æ³•"></a>é™æ€æ–¹æ³•</h3><p>åœ¨æ–¹æ³•å‰åŠ ä¸€ä¸ªstaticå°±ä»£è¡¨æ˜¯é™æ€æ–¹æ³•ï¼ŒåŒæ ·æ— é¡»é‡å†™ï¼Œç”šè‡³è¿˜å¯ä»¥æœ‰æ–¹æ³•ä½“ã€‚</p><h3 id="ç§æœ‰æ–¹æ³•"><a href="#ç§æœ‰æ–¹æ³•" class="headerlink" title="ç§æœ‰æ–¹æ³•"></a>ç§æœ‰æ–¹æ³•</h3><p>åŠ å…¥privateå…³é”®å­—å°±æ˜¯ç§æœ‰æ–¹æ³•äº†</p><hr><h2 id="å‡½æ•°å¼æ¥å£"><a href="#å‡½æ•°å¼æ¥å£" class="headerlink" title="å‡½æ•°å¼æ¥å£"></a>å‡½æ•°å¼æ¥å£</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>ä¸€ä¸ªæ¥å£æœ‰ä¸”åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•å°±æ˜¯å‡½æ•°å¼æ¥å£ï¼Œå¯ä»¥åŠ <code>@FunctionalInterface</code>æ³¨è§£è¡¨æ˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MyInter</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°å¼æ¥å£ä½œä¸ºæ–¹æ³•çš„å‚æ•°"><a href="#å‡½æ•°å¼æ¥å£ä½œä¸ºæ–¹æ³•çš„å‚æ•°" class="headerlink" title="å‡½æ•°å¼æ¥å£ä½œä¸ºæ–¹æ³•çš„å‚æ•°"></a>å‡½æ•°å¼æ¥å£ä½œä¸ºæ–¹æ³•çš„å‚æ•°</h3><p><strong>æ„ä¹‰åœ¨äºï¼šå‡½æ•°å¼æ¥å£ä½œä¸ºæ–¹æ³•çš„å‚æ•°æ—¶ï¼Œå¯ä»¥æŠŠlambdaè¡¨è¾¾å¼ä½œä¸ºå‚æ•°ä¼ é€’ã€‚</strong></p><p>ä¸‹é¢ä¾‹å­ä¸­<code>Runnable</code>å°±æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªrunæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        useThread(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;çº¿ç¨‹å¯åŠ¨äº†&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        useThread(()-&gt; System.out.println(<span class="string">&quot;çº¿ç¨‹å¯åŠ¨äº†&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">useThread</span><span class="params">(Runnable r)</span>&#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(r).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°å¼æ¥å£ä½œä¸ºæ–¹æ³•çš„è¿”å›å€¼"><a href="#å‡½æ•°å¼æ¥å£ä½œä¸ºæ–¹æ³•çš„è¿”å›å€¼" class="headerlink" title="å‡½æ•°å¼æ¥å£ä½œä¸ºæ–¹æ³•çš„è¿”å›å€¼"></a>å‡½æ•°å¼æ¥å£ä½œä¸ºæ–¹æ³•çš„è¿”å›å€¼</h3><p>æ„ä¹‰åœ¨äºï¼šå‡½æ•°å¼æ¥å£ä½œä¸ºæ–¹æ³•çš„è¿”å›å€¼æ—¶ï¼Œå¯ä»¥æŠŠlambdaè¡¨è¾¾å¼å†™åˆ°æ–¹æ³•è¿”å›å€¼å¤„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ArrayList&lt;String&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        arrayList.add(<span class="string">&quot;aa&quot;</span>);</span><br><span class="line">        arrayList.add(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">        arrayList.add(<span class="string">&quot;dddd&quot;</span>);</span><br><span class="line">        arrayList.add(<span class="string">&quot;ccc&quot;</span>);</span><br><span class="line">        arrayList.sort(getByLong());</span><br><span class="line">        System.out.println(arrayList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Comparator&lt;String&gt; <span class="title function_">getByLong</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»</span></span><br><span class="line"><span class="comment">//        return new Comparator&lt;String&gt;() &#123;</span></span><br><span class="line"><span class="comment">//            @Override</span></span><br><span class="line"><span class="comment">//            public int compare(String s1, String s2) &#123;</span></span><br><span class="line"><span class="comment">//                return s1.length() - s2.length();</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125;;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä½¿ç”¨lambda</span></span><br><span class="line">        <span class="keyword">return</span> (s1, s2) -&gt; s1.length() - s2.length();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥ä»£ç ä¼˜é›…å¤šäº†~~</p><h3 id="å¸¸ç”¨çš„å‡½æ•°å¼æ¥å£"><a href="#å¸¸ç”¨çš„å‡½æ•°å¼æ¥å£" class="headerlink" title="å¸¸ç”¨çš„å‡½æ•°å¼æ¥å£"></a>å¸¸ç”¨çš„å‡½æ•°å¼æ¥å£</h3><ol><li><p>Supplier</p></li><li><p>Consumer</p></li><li><p>Predicate</p></li><li><p>Function</p><p><img src="/../assets/java8%E6%96%B0%E7%89%B9%E6%80%A7/%E5%9B%9B%E5%A4%A7%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3.png" alt="å››å¤§å†…ç½®å‡½æ•°å¼æ¥å£"></p></li></ol><blockquote><p>å…¶å®æˆ‘è§‰å¾—æ²¡å•¥ç”¨ï¼Œæ„Ÿè§‰å¤šæ­¤ä¸€ä¸¾äº†ï¼Œä¸‹é¢ä¸¾ä¸ªä¾‹å­å§ï¼Œæœ‰éœ€è¦å†å»çœ‹<a href="https://www.bilibili.com/video/BV18J411W7cE/?p=386&spm_id_from=pageDriver&vd_source=fa7ba4ae353f08f1d08d1bb24528e96c">é»‘é©¬ç¨‹åºå‘˜</a>äº†ï¼Œæ„Ÿè§‰ä¹Ÿæ˜¯ç”¨ä¸ä¸Šçš„ï¼Œå…¶å®å°±æ˜¯åœ¨è¿™äº›å¸¸ç”¨APIä¸­ä½¿ç”¨lambdaè¡¨è¾¾å¼è€Œå·²ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        String[] strArray = &#123;<span class="string">&quot;æ—é’éœ,30&quot;</span>, <span class="string">&quot;å¼ æ›¼ç‰,35&quot;</span>, <span class="string">&quot;ç‹ç¥–è´¤,33&quot;</span>&#125;;</span><br><span class="line">        operateString(strArray, s -&gt; System.out.print(<span class="string">&quot;å§“åï¼š&quot;</span> + s.split(<span class="string">&quot;,&quot;</span>)[<span class="number">0</span>]), s -&gt; System.out.println(<span class="string">&quot;ï¼Œå¹´é¾„ï¼š&quot;</span> + s.split(<span class="string">&quot;,&quot;</span>)[<span class="number">1</span>]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">operateString</span><span class="params">(String[] strArray, Consumer&lt;String&gt; con1, Consumer&lt;String&gt; con2)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (String str : strArray) &#123;</span><br><span class="line">            con1.andThen(con2).accept(str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="streamæµâ­â­â­â­â­"><a href="#streamæµâ­â­â­â­â­" class="headerlink" title="streamæµâ­â­â­â­â­"></a>streamæµâ­â­â­â­â­</h2><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="string">&quot;å°å¼ &quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;å°é»„&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;å°ä¹Œé¾Ÿ&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;è€ç‹&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;æå¼º&quot;</span>);</span><br><span class="line">        <span class="comment">//è¦æ±‚ï¼šå¯¹é›†åˆè¿›è¡Œè¿‡æ»¤ï¼Œè¦â€œå°â€å¼€å¤´ä¸”é•¿åº¦ä¸º2çš„å­—ç¬¦ä¸²ï¼Œæœ€åæ‰“å°</span></span><br><span class="line">        list.stream().filter(s -&gt; s.startsWith(<span class="string">&quot;å°&quot;</span>)).filter(s -&gt; s.length() == <span class="number">2</span>).forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="æµçš„ç”Ÿæˆæ“ä½œ"><a href="#æµçš„ç”Ÿæˆæ“ä½œ" class="headerlink" title="æµçš„ç”Ÿæˆæ“ä½œ"></a>æµçš„ç”Ÿæˆæ“ä½œ</h3><ol><li><p>Collectionä½“ç³»çš„è¯¸å¦‚listå’Œsetå¯ç›´æ¥è°ƒç”¨streamæµç”Ÿæˆ</p></li><li><p>mapé›†åˆå¯ä»¥å…ˆç”Ÿæˆ<code>keySet</code>ï¼Œ<code>value</code>ï¼Œ<code>entrySet</code>ï¼Œå†é€šè¿‡streamæµç”Ÿæˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HashMap&lt;Integer, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">Stream&lt;Map.Entry&lt;Integer, String&gt;&gt; stream = map.entrySet().stream();</span><br></pre></td></tr></table></figure></li><li><p>æ•°ç»„å¯ä»¥é€šè¿‡Streamçš„é™æ€æ–¹æ³•ç”Ÿæˆæµ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Integer&gt; stream = Stream.of(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>);</span><br></pre></td></tr></table></figure></li></ol><h3 id="æµçš„ä¸­é—´æ“ä½œ"><a href="#æµçš„ä¸­é—´æ“ä½œ" class="headerlink" title="æµçš„ä¸­é—´æ“ä½œ"></a>æµçš„ä¸­é—´æ“ä½œ</h3><ol><li><p>filter</p><p>ç”¨äºè¿‡æ»¤ï¼Œæ–¹æ³•ä¸­è°ƒç”¨çš„å‚æ•°æ˜¯Predicateï¼Œè¯¥ç±»ä¸­æœ‰ä¸€ä¸ªtestæ–¹æ³•ç”¨äºåˆ¤æ–­å¾—åˆ°booleanå€¼</p><p>ä¾‹å­å¯è§å®ä¾‹å¤„</p></li><li><p>limit</p><p>å–å‰nä¸ªå…ƒç´ </p></li><li><p>skip</p><p>å–nä¸ªå…ƒç´ ä¹‹åçš„å…ƒç´ </p></li></ol><hr><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·³è¿‡å‰2ä¸ªå…ƒç´ ä¹‹åå»å‰©ä½™å…ƒç´ çš„å‰2ä¸ªå…ƒç´ å¹¶è¾“å‡º</span></span><br><span class="line">list.stream().skip(<span class="number">2</span>).limit(<span class="number">2</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure><ol start="4"><li><p>é™æ€æ–¹æ³•concat</p><p>åˆå¹¶ä¸¤ä¸ªæµ</p></li><li><p>distinct</p><p>å»é™¤æµä¸­é‡å¤å…ƒç´ </p></li></ol><hr><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºç¬¬ä¸€ä¸ªæµ</span></span><br><span class="line">Stream&lt;String&gt; stream1 = list.stream().limit(<span class="number">4</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºç¬¬äºŒä¸ªæµ</span></span><br><span class="line">Stream&lt;String&gt; stream2 = list.stream().skip(<span class="number">4</span>);</span><br><span class="line"><span class="comment">//åˆå¹¶ä¸¤ä¸ªæµï¼Œå¹¶è¦æ±‚å­—ç¬¦ä¸²ä¸èƒ½æœ‰é‡å¤</span></span><br><span class="line">Stream&lt;String&gt; concat = Stream.concat(stream1, stream2);</span><br><span class="line">concat.distinct().forEach(System.out::println);</span><br></pre></td></tr></table></figure><ol start="6"><li><p>sorted</p><p>æ’åºï¼Œä¸åŠ å‚æ•°æŒ‰è‡ªç„¶æ’åºï¼ŒåŠ æ¯”è¾ƒå™¨å‚æ•°ï¼ˆä½¿ç”¨lambdaè¡¨è¾¾å¼ï¼‰åæŒ‰æŒ‡å®šå½¢å¼æ’åº</p></li><li><p>mapå’ŒmapToInt</p><p>å°†æµä¸­çš„å…ƒç´ ç”±ä¸€ç§ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ï¼Œè€ŒmapToIntæ˜¯ç›´æ¥è½¬æ¢ä¸ºIntå‹ï¼Œæ‹¥æœ‰ç‹¬æœ‰çš„sumç”¨äºç»Ÿè®¡æ€»å’Œ</p></li><li><p>match</p></li></ol><p>åˆ¤æ–­æ•°æ®æ˜¯å¦åŒ¹é…æŒ‡å®šçš„æ¡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMatch</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> Stream.of(<span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">1</span>)</span><br><span class="line"><span class="comment">// .allMatch(e -&gt; e &gt; 0); // allMatch: å…ƒç´ æ˜¯å¦å…¨éƒ¨æ»¡è¶³æ¡ä»¶</span></span><br><span class="line"><span class="comment">// .anyMatch(e -&gt; e &gt; 5); // anyMatch: å…ƒç´ æ˜¯å¦ä»»æ„æœ‰ä¸€ä¸ªæ»¡è¶³æ¡ä»¶</span></span><br><span class="line">.noneMatch(e -&gt; e &lt; <span class="number">0</span>); <span class="comment">// noneMatch: å…ƒç´ æ˜¯å¦å…¨éƒ¨ä¸æ»¡è¶³æ¡ä»¶</span></span><br><span class="line">System.out.println(<span class="string">&quot;b = &quot;</span> + b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="9"><li>maxå’Œmin</li></ol><p>è·å–æœ€å¤§å’Œæœ€å°å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMax_Min</span><span class="params">()</span> &#123;</span><br><span class="line">Optional&lt;Integer&gt; max = Stream.of(<span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">1</span>).max((o1, o2) -&gt; o1 - o2);</span><br><span class="line">System.out.println(<span class="string">&quot;first = &quot;</span> + max.get());</span><br><span class="line">Optional&lt;Integer&gt; min = Stream.of(<span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">1</span>).min((o1, o2) -&gt; o1 - o2);</span><br><span class="line">System.out.println(<span class="string">&quot;any = &quot;</span> + min.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="10"><li>reduce</li></ol><p>å°†æ‰€æœ‰æ•°æ®å½’çº³å¾—åˆ°ä¸€ä¸ªæ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testReduce</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">reduce</span> <span class="operator">=</span> Stream.of(<span class="number">4</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">9</span>)</span><br><span class="line">.reduce(<span class="number">0</span>, (a, b) -&gt; &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;a = &quot;</span> + a + <span class="string">&quot;, b = &quot;</span> + b);</span><br><span class="line"><span class="keyword">return</span> a + b;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// reduce:</span></span><br><span class="line"><span class="comment">// ç¬¬ä¸€æ¬¡å°†é»˜è®¤åšèµ‹å€¼ç»™x, å–å‡ºç¬¬ä¸€ä¸ªå…ƒç´ èµ‹å€¼ç»™y,è¿›è¡Œæ“ä½œ</span></span><br><span class="line"><span class="comment">// ç¬¬äºŒæ¬¡,å°†ç¬¬ä¸€æ¬¡çš„ç»“æœèµ‹å€¼ç»™x, å–å‡ºäºŒä¸ªå…ƒç´ èµ‹å€¼ç»™y,è¿›è¡Œæ“ä½œ</span></span><br><span class="line"><span class="comment">// ç¬¬ä¸‰æ¬¡,å°†ç¬¬äºŒæ¬¡çš„ç»“æœèµ‹å€¼ç»™x, å–å‡ºä¸‰ä¸ªå…ƒç´ èµ‹å€¼ç»™y,è¿›è¡Œæ“ä½œ</span></span><br><span class="line"><span class="comment">// ç¬¬å››æ¬¡,å°†ç¬¬ä¸‰æ¬¡çš„ç»“æœèµ‹å€¼ç»™x, å–å‡ºå››ä¸ªå…ƒç´ èµ‹å€¼ç»™y,è¿›è¡Œæ“ä½œ</span></span><br><span class="line">System.out.println(<span class="string">&quot;reduce = &quot;</span> + reduce);</span><br><span class="line"><span class="type">int</span> <span class="variable">reduce2</span> <span class="operator">=</span> Stream.of(<span class="number">4</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">9</span>)</span><br><span class="line">.reduce(<span class="number">0</span>, (x, y) -&gt; &#123;</span><br><span class="line"><span class="keyword">return</span> Integer.sum(x, y);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="type">int</span> <span class="variable">reduce3</span> <span class="operator">=</span> Stream.of(<span class="number">4</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">9</span>).reduce(<span class="number">0</span>, Integer::sum);</span><br><span class="line">    <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> Stream.of(<span class="number">4</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">9</span>)</span><br><span class="line">.reduce(<span class="number">0</span>, (x, y) -&gt; &#123;</span><br><span class="line"><span class="keyword">return</span> x &gt; y ? x : y;</span><br><span class="line">&#125;);</span><br><span class="line">System.out.println(<span class="string">&quot;max = &quot;</span> + max);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="11"><li>find</li></ol><p>æŸ¥æ‰¾æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªæ•°æ®</p><blockquote><p>ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«ï¼š</p><ol><li><code>findFirst</code> æ–¹æ³•ï¼š <code>findFirst</code> æ–¹æ³•ä¼šåœ¨æµä¸­æŒ‰é¡ºåºæŸ¥æ‰¾å…ƒç´ ï¼Œå¹¶è¿”å›ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å…ƒç´ ã€‚è¿™é€šå¸¸åœ¨éœ€è¦è·å–æµä¸­çš„ç¬¬ä¸€ä¸ªåŒ¹é…å…ƒç´ æ—¶ä½¿ç”¨ã€‚ç”±äºæµå¯èƒ½æ˜¯æœ‰åºæˆ–æ— åºçš„ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨æœ‰åºæµä¸­ä¼šè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…çš„å…ƒç´ ï¼Œè€Œåœ¨æ— åºæµä¸­ä¼šè¿”å›å…¶ä¸­çš„ä»»æ„ä¸€ä¸ªåŒ¹é…å…ƒç´ ã€‚</li><li><code>findAny</code> æ–¹æ³•ï¼š <code>findAny</code> æ–¹æ³•åˆ™ä¼šåœ¨æµä¸­æŸ¥æ‰¾ä»»æ„æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ï¼Œå¹¶è¿”å›æ‰¾åˆ°çš„ä»»æ„ä¸€ä¸ªåŒ¹é…å…ƒç´ ã€‚è¿™ä¸ªæ–¹æ³•åœ¨éœ€è¦å¿«é€Ÿæ‰¾åˆ°ä»»æ„ä¸€ä¸ªåŒ¹é…å…ƒç´ æ—¶æ¯”è¾ƒæœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨å¹¶è¡Œæµæ“ä½œæ—¶ï¼Œå› ä¸ºå®ƒä¸éœ€è¦ä¿è¯é¡ºåºï¼Œå› æ­¤å¯èƒ½ä¼šæ›´å¿«åœ°æ‰¾åˆ°åŒ¹é…å…ƒç´ ã€‚</li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;Integer&gt; first = Stream.of(<span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">1</span>).filter(s -&gt; s &gt; <span class="number">3</span>).findFirst();</span><br><span class="line">System.out.println(first.get());</span><br></pre></td></tr></table></figure><hr><h3 id="æµçš„ç»ˆæ­¢æ“ä½œ"><a href="#æµçš„ç»ˆæ­¢æ“ä½œ" class="headerlink" title="æµçš„ç»ˆæ­¢æ“ä½œ"></a>æµçš„ç»ˆæ­¢æ“ä½œ</h3><ol><li><p>forEach</p><p>ä½¿ç”¨å‚æ•°è¿›è¡Œæ“ä½œï¼Œä¾‹å¦‚æ‰“å°è¾“å‡º</p></li><li><p>count</p><p>ç»Ÿè®¡æµä¸­ä¸ªæ•°</p></li></ol><h3 id="æµçš„æ”¶é›†æ“ä½œ"><a href="#æµçš„æ”¶é›†æ“ä½œ" class="headerlink" title="æµçš„æ”¶é›†æ“ä½œ"></a>æµçš„æ”¶é›†æ“ä½œ</h3><p>æ”¶é›†Streamæµä¸­çš„ç»“æœ </p><ol><li>åˆ°é›†åˆä¸­: Collectors.toList()&#x2F;Collectors.toSet()&#x2F;Collectors.toCollection()</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testStreamToCollection</span><span class="params">()</span> &#123;</span><br><span class="line">Stream&lt;String&gt; stream = Stream.of(<span class="string">&quot;aa&quot;</span>, <span class="string">&quot;bb&quot;</span>, <span class="string">&quot;cc&quot;</span>);</span><br><span class="line">List&lt;String&gt; list = stream.collect(Collectors.toList());</span><br><span class="line">Set&lt;String&gt; set = stream.collect(Collectors.toSet());</span><br><span class="line">ArrayList&lt;String&gt; arrayList =              stream.collect(Collectors.toCollection(ArrayList::<span class="keyword">new</span>));</span><br><span class="line">HashSet&lt;String&gt; hashSet = stream.collect(Collectors.toCollection(HashSet::<span class="keyword">new</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ol start="2"><li>åˆ°æ•°ç»„ä¸­: toArray()&#x2F;toArray(int[]::new)</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testStreamToArray</span><span class="params">()</span> &#123;</span><br><span class="line">Stream&lt;String&gt; stream = Stream.of(<span class="string">&quot;aa&quot;</span>, <span class="string">&quot;bb&quot;</span>, <span class="string">&quot;cc&quot;</span>);</span><br><span class="line">String[] strings = stream.toArray(String[]::<span class="keyword">new</span>);</span><br><span class="line"><span class="keyword">for</span> (String str : strings) &#123;</span><br><span class="line">System.out.println(str);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ol start="3"><li>èšåˆè®¡ç®—:</li></ol><blockquote><p>Collectors.maxBy&#x2F;Collectors.minBy&#x2F;Collectors.counting&#x2F;Collectors.summingInt&#x2F;Collectors.averagingInt</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testStreamToOther</span><span class="params">()</span> &#123;</span><br><span class="line">Stream&lt;Student&gt; studentStream = Stream.of(</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;èµµä¸½é¢–&quot;</span>, <span class="number">58</span>, <span class="number">95</span>),</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;æ¨é¢–&quot;</span>, <span class="number">56</span>, <span class="number">88</span>),</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;è¿ªä¸½çƒ­å·´&quot;</span>, <span class="number">56</span>, <span class="number">99</span>),</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;æŸ³å²©&quot;</span>, <span class="number">52</span>, <span class="number">77</span>));</span><br><span class="line"><span class="comment">// è·å–æœ€å¤§å€¼</span></span><br><span class="line">Optional&lt;Student&gt; collect = studentStream.collect(Collectors.maxBy((o1, o2) -&gt;</span><br><span class="line">o1.getSocre() - o2.getSocre()));</span><br><span class="line"><span class="comment">// è·å–æœ€å°å€¼</span></span><br><span class="line">Optional&lt;Student&gt; collect = studentStream.collect(Collectors.minBy((o1, o2) -&gt;</span><br><span class="line">o1.getSocre() - o2.getSocre()));</span><br><span class="line">System.out.println(collect.get());</span><br><span class="line"><span class="comment">// æ±‚æ€»å’Œ</span></span><br><span class="line"><span class="type">int</span> <span class="variable">sumAge</span> <span class="operator">=</span> studentStream.collect(Collectors.summingInt(s -&gt; s.getAge()));</span><br><span class="line">System.out.println(<span class="string">&quot;sumAge = &quot;</span> + sumAge);</span><br><span class="line"><span class="comment">// å¹³å‡å€¼</span></span><br><span class="line"><span class="type">double</span> <span class="variable">avgScore</span> <span class="operator">=</span> studentStream.collect(Collectors.averagingInt(s -&gt;                                                        s.getSocre()));</span><br><span class="line">System.out.println(<span class="string">&quot;avgScore = &quot;</span> + avgScore);</span><br><span class="line"><span class="comment">// ç»Ÿè®¡æ•°é‡</span></span><br><span class="line"><span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> studentStream.collect(Collectors.counting());</span><br><span class="line">System.out.println(<span class="string">&quot;count = &quot;</span> + count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ol start="4"><li>åˆ†ç»„: Collectors.groupingBy</li></ol><blockquote><p>å½“æˆ‘ä»¬ä½¿ç”¨Streamæµå¤„ç†æ•°æ®åï¼Œå¯ä»¥æ ¹æ®æŸä¸ªå±æ€§å°†æ•°æ®åˆ†ç»„</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGroup</span><span class="params">()</span> &#123;</span><br><span class="line">Stream&lt;Student&gt; studentStream = Stream.of(</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;èµµä¸½é¢–&quot;</span>, <span class="number">52</span>, <span class="number">95</span>),</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;æ¨é¢–&quot;</span>, <span class="number">56</span>, <span class="number">88</span>),</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;è¿ªä¸½çƒ­å·´&quot;</span>, <span class="number">56</span>, <span class="number">55</span>),</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;æŸ³å²©&quot;</span>, <span class="number">52</span>, <span class="number">33</span>));</span><br><span class="line"><span class="comment">// Map&lt;Integer, List&lt;Student&gt;&gt; map =</span></span><br><span class="line">studentStream.collect(Collectors.groupingBy(Student::getAge));</span><br><span class="line"><span class="comment">// å°†åˆ†æ•°å¤§äº60çš„åˆ†ä¸ºä¸€ç»„,å°äº60åˆ†æˆå¦ä¸€ç»„</span></span><br><span class="line">Map&lt;String, List&lt;Student&gt;&gt; map = studentStream</span><br><span class="line">        .collect(Collectors.groupingBy((s) -&gt;&#123;</span><br><span class="line"><span class="keyword">if</span> (s.getSocre() &gt; <span class="number">60</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;åŠæ ¼&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;ä¸åŠæ ¼&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;));</span><br><span class="line">map.forEach((k, v) -&gt; &#123;</span><br><span class="line">System.out.println(k + <span class="string">&quot;::&quot;</span> + v);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä¸åŠæ ¼::[Student&#123;name=&#x27;è¿ªä¸½çƒ­å·´&#x27;, age=56, socre=55&#125;, Student&#123;name=&#x27;æŸ³å²©&#x27;, age=52, socre=33&#125;]</span><br><span class="line">åŠæ ¼::[Student&#123;name=&#x27;èµµä¸½é¢–&#x27;, age=52, socre=95&#125;, Student&#123;name=&#x27;æ¨é¢–&#x27;, age=56, socre=88&#125;]</span><br></pre></td></tr></table></figure><blockquote><p>å¤šçº§åˆ†ç»„</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCustomGroup</span><span class="params">()</span> &#123;</span><br><span class="line">Stream&lt;Student&gt; studentStream = Stream.of(</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;èµµä¸½é¢–&quot;</span>, <span class="number">52</span>, <span class="number">95</span>),</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;æ¨é¢–&quot;</span>, <span class="number">56</span>, <span class="number">88</span>),</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;è¿ªä¸½çƒ­å·´&quot;</span>, <span class="number">56</span>, <span class="number">99</span>),</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;æŸ³å²©&quot;</span>, <span class="number">52</span>, <span class="number">77</span>));</span><br><span class="line">Map&lt;Integer, Map&lt;String, List&lt;Student&gt;&gt;&gt; map =</span><br><span class="line">studentStream.collect(Collectors.groupingBy(s -&gt; s.getAge(), </span><br><span class="line">                                            Collectors.groupingBy(s -&gt; &#123;</span><br><span class="line"><span class="keyword">if</span> (s.getSocre() &gt;= <span class="number">90</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;ä¼˜ç§€&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (s.getSocre() &gt;= <span class="number">80</span> &amp;&amp; s.getSocre() &lt; <span class="number">90</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;è‰¯å¥½&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (s.getSocre() &gt;= <span class="number">80</span> &amp;&amp; s.getSocre() &lt; <span class="number">80</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;åŠæ ¼&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;ä¸åŠæ ¼&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)));</span><br><span class="line">map.forEach((k, v) -&gt; &#123;</span><br><span class="line">System.out.println(k + <span class="string">&quot; == &quot;</span> + v);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">52 == &#123;ä¸åŠæ ¼=[Student&#123;name=&#x27;æŸ³å²©&#x27;, age=52, socre=77&#125;], ä¼˜ç§€=[Student&#123;name=&#x27;èµµä¸½é¢–&#x27;, age=52,</span><br><span class="line">socre=95&#125;]&#125;</span><br><span class="line">56 == &#123;ä¼˜ç§€=[Student&#123;name=&#x27;è¿ªä¸½çƒ­å·´&#x27;, age=56, socre=99&#125;], è‰¯å¥½=[Student&#123;name=&#x27;æ¨é¢–&#x27;, age=56,</span><br><span class="line">socre=88&#125;]&#125;</span><br></pre></td></tr></table></figure><hr><ol start="5"><li>åˆ†åŒº: Collectors.partitionBy</li></ol><blockquote><p>Collectors.partitioningBy ä¼šæ ¹æ®å€¼æ˜¯å¦ä¸ºtrueï¼ŒæŠŠé›†åˆåˆ†å‰²ä¸ºä¸¤ä¸ªåˆ—è¡¨ï¼Œä¸€ä¸ªtrueåˆ—è¡¨ï¼Œä¸€ä¸ªfalseåˆ—è¡¨ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPartition</span><span class="params">()</span> &#123;</span><br><span class="line">Stream&lt;Student&gt; studentStream = Stream.of(</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;èµµä¸½é¢–&quot;</span>, <span class="number">52</span>, <span class="number">95</span>),</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;æ¨é¢–&quot;</span>, <span class="number">56</span>, <span class="number">88</span>),</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;è¿ªä¸½çƒ­å·´&quot;</span>, <span class="number">56</span>, <span class="number">99</span>),</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;æŸ³å²©&quot;</span>, <span class="number">52</span>, <span class="number">77</span>));</span><br><span class="line"><span class="comment">// partitioningByä¼šæ ¹æ®å€¼æ˜¯å¦ä¸ºtrueï¼ŒæŠŠé›†åˆåˆ†å‰²ä¸ºä¸¤ä¸ªåˆ—è¡¨ï¼Œä¸€ä¸ªtrueåˆ—è¡¨ï¼Œä¸€ä¸ªfalseåˆ—è¡¨ã€‚</span></span><br><span class="line">Map&lt;Boolean, List&lt;Student&gt;&gt; map = studentStream.collect(Collectors.partitioningBy(s -&gt;s.getSocre() &gt; <span class="number">90</span>));</span><br><span class="line">map.forEach((k, v) -&gt; &#123;</span><br><span class="line">System.out.println(k + <span class="string">&quot; == &quot;</span> + v);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">false == [Student&#123;name=&#x27;æ¨é¢–&#x27;, age=56, socre=88&#125;, Student&#123;name=&#x27;æŸ³å²©&#x27;, age=52, socre=77&#125;]</span><br><span class="line">true == [Student&#123;name=&#x27;èµµä¸½é¢–&#x27;, age=52, socre=95&#125;, Student&#123;name=&#x27;è¿ªä¸½çƒ­å·´&#x27;, age=56, socre=99&#125;]</span><br></pre></td></tr></table></figure><hr><ol start="6"><li>æ‹¼æ¥: Collectors.joinging</li></ol><blockquote><p>Collectors.joining ä¼šæ ¹æ®æŒ‡å®šçš„è¿æ¥ç¬¦ï¼Œå°†æ‰€æœ‰å…ƒç´ è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJoining</span><span class="params">()</span> &#123;</span><br><span class="line">Stream&lt;Student&gt; studentStream = Stream.of(</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;èµµä¸½é¢–&quot;</span>, <span class="number">52</span>, <span class="number">95</span>),</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;æ¨é¢–&quot;</span>, <span class="number">56</span>, <span class="number">88</span>),</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;è¿ªä¸½çƒ­å·´&quot;</span>, <span class="number">56</span>, <span class="number">99</span>),</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;æŸ³å²©&quot;</span>, <span class="number">52</span>, <span class="number">77</span>));</span><br><span class="line"><span class="type">String</span> <span class="variable">collect</span> <span class="operator">=</span> studentStream</span><br><span class="line">.map(Student::getName)</span><br><span class="line">.collect(Collectors.joining(<span class="string">&quot;&gt;_&lt;&quot;</span>, <span class="string">&quot;^_^&quot;</span>, <span class="string">&quot;^v^&quot;</span>));</span><br><span class="line">System.out.println(collect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^_^èµµä¸½é¢–&gt;_&lt;æ¨é¢–&gt;_&lt;è¿ªä¸½çƒ­å·´&gt;_&lt;æŸ³å²©^v^</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç‘å‰å¤–å–åç«¯ä»£ç å®ç°</title>
      <link href="/2022/12/31/Project-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0/"/>
      <url>/2022/12/31/Project-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>æœ¬äººå‚ç…§<a href="https://www.bilibili.com/video/BV13a411q753/?spm_id_from=333.999.0.0&vd_source=fa7ba4ae353f08f1d08d1bb24528e96c">é»‘é©¬ç¨‹åºå‘˜ç‘å‰å¤–å–</a>è§†é¢‘è¿›è¡Œå­¦ä¹ ï¼Œå¹¶å®Œå–„äº†å‰©ä½™åŠŸèƒ½ã€‚</p><h2 id="é¡¹ç›®æ­å»º"><a href="#é¡¹ç›®æ­å»º" class="headerlink" title="é¡¹ç›®æ­å»º"></a>é¡¹ç›®æ­å»º</h2><h3 id="ä¸»è¦ä½¿ç”¨çš„æŠ€æœ¯"><a href="#ä¸»è¦ä½¿ç”¨çš„æŠ€æœ¯" class="headerlink" title="ä¸»è¦ä½¿ç”¨çš„æŠ€æœ¯"></a>ä¸»è¦ä½¿ç”¨çš„æŠ€æœ¯</h3><blockquote><ul><li><p>åç«¯ï¼š<code>springbootï¼Œspringï¼Œspringmvcï¼Œmybatisï¼Œmybatis-plus </code></p></li><li><p>å‰ç«¯ï¼š<code>html,css,js,vue,elementui</code></p></li></ul></blockquote><h3 id="æ­å»ºæ•°æ®åº“ï¼ˆreggieï¼‰-è¡¨"><a href="#æ­å»ºæ•°æ®åº“ï¼ˆreggieï¼‰-è¡¨" class="headerlink" title="æ­å»ºæ•°æ®åº“ï¼ˆreggieï¼‰&#x2F;è¡¨"></a>æ­å»ºæ•°æ®åº“ï¼ˆreggieï¼‰&#x2F;è¡¨</h3><p><img src="/../assets/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8.png" alt="æ•°æ®åº“è¡¨å›¾"></p><p>å…·ä½“è¡¨ä¸­çš„å„ä¸ªå­—æ®µæ‰€ä»£è¡¨çš„æ„ä¹‰éƒ½å·²åœ¨æ•°æ®åº“è®¾è®¡è¡¨ä¸­çš„æ³¨é‡ŠæåŠ</p><table><thead><tr><th>è¡¨å</th><th>è¡¨çš„æè¿°</th></tr></thead><tbody><tr><td>employeeï¼ˆå‘˜å·¥è¡¨ï¼‰</td><td>ç”¨äºå­˜æ”¾åå°ç®¡ç†äººå‘˜çš„ä¿¡æ¯</td></tr><tr><td>categoryï¼ˆåˆ†ç±»è¡¨ï¼‰</td><td>åˆ†ç±»è¡¨ä¸­å­˜æ”¾çš„æ˜¯èœå“çš„åˆ†ç±»å’Œå¥—é¤çš„åˆ†ç±»</td></tr><tr><td>dishï¼ˆèœå“è¡¨ï¼‰</td><td>å­˜æ”¾çš„æ˜¯èœå“çš„ä¿¡æ¯ï¼Œä¸€ä¸ªèœå“å¿…å±äºä¸€ä¸ªèœå“åˆ†ç±»ï¼Œä¸€ä¸ªèœå“åˆ†ç±»ä¹Ÿå¯ä»¥æœ‰ä¸æ­¢ä¸€ç§èœå“</td></tr><tr><td>dish_flavorï¼ˆèœå“å£å‘³è¡¨ï¼‰</td><td>å­˜æ”¾çš„æ˜¯èœå“å£å‘³çš„ä¿¡æ¯ï¼Œä¸€ä¸ªèœå“å¯ä»¥æœ‰å¤šç§å£å‘³ï¼Œå¯¹åº”ç€å°±ä¼šæœ‰å¤šæ¡æ•°æ®æ˜¯éš¶å±äºä¸€ä¸ªèœå“çš„ï¼Œå…¶ä¸­å·²ç»ç”¨èœå“çš„<code>id</code>æŠŠå¯¹åº”çš„èœå“å’Œèœå“å£å‘³å…³è”å¥½</td></tr><tr><td>setmealï¼ˆå¥—é¤è¡¨ï¼‰</td><td>å­˜æ”¾çš„æ˜¯å¥—é¤çš„ä¿¡æ¯ï¼Œä¸€ä¸ªå¥—é¤å¿…å±äºä¸€ä¸ªå¥—é¤åˆ†ç±»ï¼Œä¸€ä¸ªå¥—é¤åˆ†ç±»ä¹Ÿå¯ä»¥æœ‰ä¸æ­¢ä¸€ç§å¥—é¤</td></tr><tr><td>setmeal_dishï¼ˆå¥—é¤èœå“å¯¹åº”è¡¨ï¼‰</td><td>å­˜æ”¾çš„æ˜¯å¥—é¤é‡Œæ‰€åŒ…å«çš„èœå“çš„ä¿¡æ¯ï¼ˆ<strong>å› ä¸ºä¸€ä¸ªå¥—é¤æ˜¯ç”±è‹¥å¹²ä¸ªèœå“ç›¸ç»„æˆçš„</strong>ï¼‰ï¼Œæ­¤å¤„å­˜æ”¾çš„ä¿¡æ¯å°±æ˜¯è¯¥å¥—é¤ä¸‹æ‰€åŒ…å«çš„æ˜¯å“ªäº›èœå“</td></tr><tr><td>ordersï¼ˆè®¢å•è¡¨ï¼‰</td><td>å­˜æ”¾çš„æ˜¯ç”¨æˆ·ä¸‹å•ä¹‹åçš„è®¢å•çš„ç®€å•ä¿¡æ¯ï¼ˆåŒ…æ‹¬è®¢å•å·ï¼Œè®¢å•çŠ¶æ€ï¼Œæ”¶è´§äººï¼Œè”ç³»ç”µè¯ï¼Œåœ°å€ï¼Œæ”¯ä»˜é‡‘é¢ï¼Œä¸‹å•æ—¶é—´ï¼‰</td></tr><tr><td>order_detailsï¼ˆè®¢å•æ˜ç»†è¡¨ï¼‰</td><td>å­˜æ”¾çš„æ˜¯ç”¨æˆ·ä¸‹å•ä¹‹åçš„è®¢å•çš„æ›´å¤šä¿¡æ¯ï¼ˆåŒ…å«äº†ç”¨æˆ·è´­ä¹°çš„æ˜¯å“ªäº›èœå“æˆ–å¥—é¤ï¼‰</td></tr><tr><td>address_bookï¼ˆåœ°å€ç°¿è¡¨ï¼‰</td><td>å­˜æ”¾çš„æ˜¯ç”¨æˆ·çš„åœ°å€ä¿¡æ¯ï¼Œä¹ŸåŒ…å«é»˜è®¤åœ°å€ç­‰</td></tr><tr><td>shoppingcartï¼ˆè´­ç‰©è½¦è¡¨ï¼‰</td><td>å­˜æ”¾çš„æ˜¯ç”¨æˆ·é€šè¿‡ç§»åŠ¨ç«¯ç‚¹å‡»å¯¹åº”çš„èœå“æˆ–å¥—é¤æ‰€åŠ å…¥çš„æ•°æ®ï¼Œæ¸…ç©ºè´­ç‰©è½¦è‡ªç„¶å°±æ˜¯æ¸…ç©º<strong>è¯¥ç”¨æˆ·</strong>çš„è´­ç‰©è½¦æ•°æ®</td></tr><tr><td>userï¼ˆç”¨æˆ·è¡¨ï¼‰</td><td>å­˜æ”¾çš„æ˜¯ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯</td></tr></tbody></table><hr><h3 id="Ideaä¸­çš„åŸºæœ¬é…ç½®"><a href="#Ideaä¸­çš„åŸºæœ¬é…ç½®" class="headerlink" title="Ideaä¸­çš„åŸºæœ¬é…ç½®"></a>Ideaä¸­çš„åŸºæœ¬é…ç½®</h3><blockquote><p>é€šè¿‡mybatis-plusæ¥é€†å‘åˆ›å»ºå¯¹åº”çš„pojoï¼Œmapperï¼Œserviceæ¥å£å’ŒserviceImplå®ä½“ç±»å³å¯ã€‚</p></blockquote><h4 id="åˆ›å»ºé€šç”¨çš„Rç±»ï¼ˆé€šç”¨è¿”å›ç»“æœç±»ï¼‰"><a href="#åˆ›å»ºé€šç”¨çš„Rç±»ï¼ˆé€šç”¨è¿”å›ç»“æœç±»ï¼‰" class="headerlink" title="åˆ›å»ºé€šç”¨çš„Rç±»ï¼ˆé€šç”¨è¿”å›ç»“æœç±»ï¼‰"></a>åˆ›å»ºé€šç”¨çš„Rç±»ï¼ˆé€šç”¨è¿”å›ç»“æœç±»ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€šç”¨è¿”å›ç»“æœï¼ŒæœåŠ¡ç«¯å“åº”çš„æ•°æ®æœ€ç»ˆéƒ½ä¼šå°è£…æˆæ­¤å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">R</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code; <span class="comment">//ç¼–ç ï¼š1æˆåŠŸï¼Œ0å’Œå…¶å®ƒæ•°å­—ä¸ºå¤±è´¥</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String msg; <span class="comment">//é”™è¯¯ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T data; <span class="comment">//æ•°æ®</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>(); <span class="comment">//åŠ¨æ€æ•°æ®</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">success</span><span class="params">(T object)</span> &#123;</span><br><span class="line">        R&lt;T&gt; r = <span class="keyword">new</span> <span class="title class_">R</span>&lt;T&gt;();</span><br><span class="line">        r.data = object;</span><br><span class="line">        r.code = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">error</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">R</span>();</span><br><span class="line">        r.msg = msg;</span><br><span class="line">        r.code = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> R&lt;T&gt; <span class="title function_">add</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.map.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><h4 id="è®¾ç½®é™æ€èµ„æºæ˜ å°„"><a href="#è®¾ç½®é™æ€èµ„æºæ˜ å°„" class="headerlink" title="è®¾ç½®é™æ€èµ„æºæ˜ å°„"></a>è®¾ç½®é™æ€èµ„æºæ˜ å°„</h4><blockquote><p>ä¸»è¦æ˜¯è®©Springå¯ä»¥æ‰«æ<code>backend</code>å’Œ<code>front</code>ä¸‹çš„é™æ€èµ„æºï¼ˆHTML,CSS.JSï¼‰</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfig</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®é™æ€èµ„æºæ˜ å°„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/backend/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/backend/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/front/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/front/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åå°å‘˜å·¥ç™»å½•ç™»å‡ºåŠŸèƒ½"><a href="#åå°å‘˜å·¥ç™»å½•ç™»å‡ºåŠŸèƒ½" class="headerlink" title="åå°å‘˜å·¥ç™»å½•ç™»å‡ºåŠŸèƒ½"></a>åå°å‘˜å·¥ç™»å½•ç™»å‡ºåŠŸèƒ½</h2><h3 id="å‘˜å·¥ç™»å½•åŠŸèƒ½"><a href="#å‘˜å·¥ç™»å½•åŠŸèƒ½" class="headerlink" title="å‘˜å·¥ç™»å½•åŠŸèƒ½"></a>å‘˜å·¥ç™»å½•åŠŸèƒ½</h3><blockquote><p><strong>å‘˜å·¥ç™»å½•åŠŸèƒ½</strong></p><ol><li><p>å°†é¡µé¢æäº¤è¿‡æ¥çš„<code>password</code>è¿›è¡Œ<code>md5</code>åŠ å¯†</p></li><li><p>æ ¹æ®ç”¨æˆ·æäº¤çš„ç”¨æˆ·åæŸ¥è¯¢æ•°æ®åº“</p></li><li><p>å¦‚æœç”¨æˆ·ä¸å­˜åœ¨åˆ™é€€å‡º</p></li><li><p>å¯†ç æ¯”å¯¹ï¼Œå¦‚æœä¸æˆåŠŸåˆ™é€€å‡º</p></li><li><p>æŸ¥çœ‹è´¦å·æ˜¯å¦å·²è¢«ç¦ç”¨</p></li><li><p>ç™»å½•æˆåŠŸï¼Œå°†å‘˜å·¥çš„<code>id</code>å­˜å…¥<code>Session</code>(é‡ç‚¹)ä¸­ï¼Œï¼ˆæ­¤å¤„è·å¾—è¿™ä¸ª<code>id</code>çš„ä½œç”¨æ˜¯è®©å‘˜å·¥ç®¡ç†ä¸šé¢å¯æ˜¾ç¤ºå‡ºæ­¤æ—¶ç™»å½•è€…çš„åå­—ï¼‰å¹¶è¿”å›ç™»å½•æˆåŠŸç»“æœ</p></li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;Employee&gt; <span class="title function_">login</span><span class="params">(HttpServletRequest request, <span class="meta">@RequestBody</span> Employee employee)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.å°†é¡µé¢æäº¤è¿‡æ¥çš„passwordè¿›è¡Œmd5åŠ å¯†</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> employee.getPassword();</span><br><span class="line">        password = DigestUtils.md5DigestAsHex(password.getBytes());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.æ ¹æ®ç”¨æˆ·æäº¤çš„ç”¨æˆ·åæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">        LambdaQueryWrapper&lt;Employee&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(Employee::getUsername, employee.getUsername());</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">emp</span> <span class="operator">=</span> employeeService.getOne(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.å¦‚æœç”¨æˆ·ä¸å­˜åœ¨åˆ™é€€å‡º</span></span><br><span class="line">        <span class="keyword">if</span> (emp == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;ç™»å½•å¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.å¯†ç æ¯”å¯¹ï¼Œå¦‚æœä¸æˆåŠŸåˆ™é€€å‡º</span></span><br><span class="line">        <span class="keyword">if</span> (!password.equals(emp.getPassword())) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;ç™»å½•å¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.æŸ¥çœ‹è´¦å·æ˜¯å¦å·²è¢«ç¦ç”¨</span></span><br><span class="line">        <span class="keyword">if</span> (emp.getStatus() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;è´¦å·å·²ç¦ç”¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ç™»å½•æˆåŠŸï¼Œå°†å‘˜å·¥çš„idå­˜å…¥Sessionä¸­ï¼Œå¹¶è¿”å›ç™»å½•æˆåŠŸç»“æœ</span></span><br><span class="line">        request.getSession().setAttribute(<span class="string">&quot;employee&quot;</span>, emp.getId());</span><br><span class="line">        <span class="keyword">return</span> R.success(emp);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="å‘˜å·¥ç™»å‡ºåŠŸèƒ½"><a href="#å‘˜å·¥ç™»å‡ºåŠŸèƒ½" class="headerlink" title="å‘˜å·¥ç™»å‡ºåŠŸèƒ½"></a>å‘˜å·¥ç™»å‡ºåŠŸèƒ½</h3><blockquote><ol><li><p>å°†ç™»å½•æ—¶å­˜åœ¨<code>Session</code>ä¸­çš„<code>id</code>é‡Šæ”¾å‡ºæ¥</p></li><li><p>è¿”å›ç»“æœï¼ˆæ³¨æ„ï¼šæ­¤æ—¶ä¸šé¢è·³è½¬ä¸æ˜¾ç¤º<strong>é€€å‡ºæˆåŠŸ</strong>çš„åŸå› æ˜¯ï¼šå› ä¸ºæ˜¾ç¤º<code>é€€å‡ºæˆåŠŸ</code>çš„<code>html</code>é¡µé¢å·²ç»å…³é—­ï¼Œæ•…åœ¨ç™»å½•é¡µçœ‹ä¸åˆ°<code>é€€å‡ºæˆåŠŸ</code>çš„æ˜¾ç¤ºï¼‰</p></li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/logout&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">logout</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">        request.getSession().removeAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;é€€å‡ºæˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="å®Œå–„å‘˜å·¥ç™»å½•ç™»å‡º"><a href="#å®Œå–„å‘˜å·¥ç™»å½•ç™»å‡º" class="headerlink" title="å®Œå–„å‘˜å·¥ç™»å½•ç™»å‡º"></a>å®Œå–„å‘˜å·¥ç™»å½•ç™»å‡º</h3><h4 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h4><blockquote><p>å› ä¸ºå¯ä»¥ä¸é€šè¿‡ç™»å½•è€Œç›´æ¥è®¿é—®å‘˜å·¥ç®¡ç†çš„é¡µé¢ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ï¼Œéœ€è¦é€šè¿‡è®¾ç½®ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œå»è®©ç”¨æˆ·å¿…é¡»å…ˆç™»å½•æ‰èƒ½è®¿é—®å‘˜å·¥ç®¡ç†é¡µé¢ã€‚</p><ol><li><p>è·å–æœ¬æ¬¡è¯·æ±‚çš„URI</p></li><li><p>å®šä¹‰ä¸éœ€è¦å¤„ç†çš„è¯·æ±‚è·¯å¾„ï¼ˆå³ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼‰</p></li><li><p>åˆ›å»ºä¸€ä¸ª<code>PATH_MATCHER</code>æ¥æ¯”å¯¹è·¯å¾„ä¸Šçš„é€šé…ç¬¦</p></li><li><p>åˆ¤æ–­æœ¬æ¬¡è¯·æ±‚æ˜¯å¦éœ€è¦å¤„ç†</p></li><li><p>å¦‚æœä¸éœ€è¦å¤„ç†ï¼Œåˆ™ç›´æ¥æ”¾è¡Œ</p></li><li><p>åˆ¤æ–­ç™»å½•çŠ¶æ€ï¼Œå¦‚æœå·²ç™»å½•ï¼Œåˆ™ç›´æ¥æ”¾è¡Œ</p></li><li><p>å¦‚æœæœªç™»å½•åˆ™è¿”å›æœªç™»å½•ç»“æœï¼Œé€šè¿‡è¾“å‡ºæµæ–¹å¼å‘å®¢æˆ·ç«¯é¡µé¢å“åº”æ•°æ®</p></li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç»å®Œæˆç™»å½•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebFilter(filterName = &quot;loginCheckFilter&quot;,urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginCheckFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span>&#123;</span><br><span class="line">    <span class="comment">//è·¯å¾„åŒ¹é…å™¨ï¼Œæ”¯æŒé€šé…ç¬¦</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AntPathMatcher</span> <span class="variable">PATH_MATCHER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AntPathMatcher</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse) servletResponse;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1ã€è·å–æœ¬æ¬¡è¯·æ±‚çš„URI</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">requestURI</span> <span class="operator">=</span> request.getRequestURI();<span class="comment">// /backend/index.html</span></span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;æ‹¦æˆªåˆ°è¯·æ±‚ï¼š&#123;&#125;&quot;</span>,requestURI);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å®šä¹‰ä¸éœ€è¦å¤„ç†çš„è¯·æ±‚è·¯å¾„</span></span><br><span class="line">        String[] urls = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;</span><br><span class="line">                <span class="string">&quot;/employee/login&quot;</span>,<span class="comment">//ç™»å½•çš„è¯·æ±‚è·¯å¾„</span></span><br><span class="line">                <span class="string">&quot;/employee/logout&quot;</span>,<span class="comment">//ç™»å‡ºçš„è¯·æ±‚è·¯å¾„</span></span><br><span class="line">                <span class="string">&quot;/backend/**&quot;</span>,<span class="comment">//åå°çš„é™æ€èµ„æº</span></span><br><span class="line">                <span class="string">&quot;/front/**&quot;</span><span class="comment">//ç§»åŠ¨ç«¯çš„é™æ€èµ„æº</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2ã€åˆ¤æ–­æœ¬æ¬¡è¯·æ±‚æ˜¯å¦éœ€è¦å¤„ç†</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">check</span> <span class="operator">=</span> check(urls, requestURI);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3ã€å¦‚æœä¸éœ€è¦å¤„ç†ï¼Œåˆ™ç›´æ¥æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span>(check)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;æœ¬æ¬¡è¯·æ±‚&#123;&#125;ä¸éœ€è¦å¤„ç†&quot;</span>,requestURI);</span><br><span class="line">            filterChain.doFilter(request,response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4ã€åˆ¤æ–­ç™»å½•çŠ¶æ€ï¼Œå¦‚æœå·²ç™»å½•ï¼Œåˆ™ç›´æ¥æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span>(request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>) != <span class="literal">null</span>)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;ç”¨æˆ·å·²ç™»å½•ï¼Œç”¨æˆ·idä¸ºï¼š&#123;&#125;&quot;</span>,request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>));</span><br><span class="line">            filterChain.doFilter(request,response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;ç”¨æˆ·æœªç™»å½•&quot;</span>);</span><br><span class="line">        <span class="comment">//5ã€å¦‚æœæœªç™»å½•åˆ™è¿”å›æœªç™»å½•ç»“æœï¼Œé€šè¿‡è¾“å‡ºæµæ–¹å¼å‘å®¢æˆ·ç«¯é¡µé¢å“åº”æ•°æ®</span></span><br><span class="line">        response.getWriter().write(JSON.toJSONString(R.error(<span class="string">&quot;NOTLOGIN&quot;</span>)));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·¯å¾„åŒ¹é…ï¼Œæ£€æŸ¥æœ¬æ¬¡è¯·æ±‚æ˜¯å¦éœ€è¦æ”¾è¡Œ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> urls</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> requestURI</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(String[] urls,String requestURI)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String url : urls) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">match</span> <span class="operator">=</span> PATH_MATCHER.match(url, requestURI);</span><br><span class="line">            <span class="keyword">if</span>(match)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="è¸©å‘ç‚¹"><a href="#è¸©å‘ç‚¹" class="headerlink" title="è¸©å‘ç‚¹"></a>è¸©å‘ç‚¹</h4><blockquote><p>è‹¥æ²¡åŠ <code>.getSession()</code>åˆ™ä¼šä½¿ç™»å½•æˆåŠŸåä¸€ç›´é‡æ–°å›åˆ°ç™»å½•é¡µé¢</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç™»å½•æˆåŠŸï¼Œå°†å‘˜å·¥çš„idå­˜å…¥Sessionä¸­ï¼Œå¹¶è¿”å›ç™»å½•æˆåŠŸç»“æœ</span></span><br><span class="line">request.getSession().setAttribute(<span class="string">&quot;employee&quot;</span>, emp.getId());</span><br><span class="line"><span class="keyword">return</span> R.success(emp);</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œå¯ä»¥å°è¯•å»æ¸…é™¤ä¸€ä¸‹æµè§ˆå™¨ç¼“å­˜</p></blockquote><hr><h2 id="æ–°å¢å‘˜å·¥"><a href="#æ–°å¢å‘˜å·¥" class="headerlink" title="æ–°å¢å‘˜å·¥"></a>æ–°å¢å‘˜å·¥</h2><h3 id="æ–°å¢å‘˜å·¥åŠŸèƒ½"><a href="#æ–°å¢å‘˜å·¥åŠŸèƒ½" class="headerlink" title="æ–°å¢å‘˜å·¥åŠŸèƒ½"></a>æ–°å¢å‘˜å·¥åŠŸèƒ½</h3><hr><blockquote><p><strong>éœ€æ±‚åˆ†æ</strong>ï¼šå› ä¸ºå‰ç«¯é¡µé¢å±•ç¤ºçš„è®©ç”¨æˆ·æ–°å¢å‘˜å·¥æ—¶æ‰€å¡«çš„ä¿¡æ¯æœ‰é™ï¼Œä¸€éƒ¨åˆ†<code>employee</code>åˆ†è£…å¯¹è±¡ä¸­çš„å±æ€§ï¼Œå³è¡¨ä¸­çš„å­—æ®µéœ€è¦<strong>å¡«å…¥é»˜è®¤å€¼</strong>ï¼Œæ•…è¯¥æ–¹æ³•ç”¨äºæ¥æ”¶å‰ç«¯é¡µé¢æ‰€ä¼ é€’è¿‡æ¥çš„åŒ…è£…å¥½çš„<code>employee</code>å¯¹è±¡ï¼Œå¹¶å°†<strong>è¯¥å¯¹è±¡å­˜è¿›è¡¨ä¸­</strong>ã€‚</p></blockquote><blockquote><p>åŠŸèƒ½åˆ†æï¼š</p><ol><li><p>è®¾ç½®é»˜è®¤å¯†ç (ä½¿ç”¨<code>md5</code>åŠ å¯†å¤„ç†)</p></li><li><p>è·å–ç™»å½•æ—¶ä¼ å…¥<code>Session</code>ä¸­çš„<code>id</code></p></li><li><p>æ·»åŠ åˆ›å»ºäººä¿¡æ¯ï¼ˆè¯¥åˆ›å»ºäººä¸º<code>Session</code>ä¸­å­˜å…¥çš„<code>id</code>ï¼‰</p></li><li><p>æ·»åŠ ä¿®æ”¹äººä¿¡æ¯ï¼ˆè¯¥ä¿®æ”¹äººä¸º<code>Session</code>ä¸­å­˜å…¥çš„<code>id</code>ï¼‰</p></li><li><p>æ·»åŠ åˆ›å»ºæ—¶é—´</p></li><li><p>æ·»åŠ æ›´æ–°æ—¶é—´</p></li><li><p>å°†è¯¥å¯¹è±¡çš„å±æ€§å­˜å…¥è¡¨ä¸­</p></li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(HttpServletRequest request, <span class="meta">@RequestBody</span> Employee employee)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®é»˜è®¤å¯†ç (ä½¿ç”¨md5åŠ å¯†å¤„ç†)</span></span><br><span class="line">        employee.setPassword(DigestUtils.md5DigestAsHex(<span class="string">&quot;123456&quot;</span>.getBytes()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–ç™»å½•æ—¶ä¼ å…¥Sessionä¸­çš„id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">empId</span> <span class="operator">=</span> (Long) request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line">        <span class="comment">//æ·»åŠ åˆ›å»ºäººä¿¡æ¯</span></span><br><span class="line">        employee.setCreateUser(empId);</span><br><span class="line">        <span class="comment">//æ·»åŠ ä¿®æ”¹äººä¿¡æ¯</span></span><br><span class="line">        employee.setUpdateUser(empId);</span><br><span class="line">        <span class="comment">//æ·»åŠ åˆ›å»ºæ—¶é—´</span></span><br><span class="line">        employee.setCreateTime(LocalDateTime.now());</span><br><span class="line">        <span class="comment">//æ·»åŠ æ›´æ–°æ—¶é—´</span></span><br><span class="line">        employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line">        <span class="comment">//å°†è¯¥å¯¹è±¡çš„å±æ€§å­˜å…¥è¡¨ä¸­</span></span><br><span class="line">        employeeService.save(employee);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;æ–°å¢å‘˜å·¥æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å®Œå–„æ–°å¢å‘˜å·¥åŠŸèƒ½"><a href="#å®Œå–„æ–°å¢å‘˜å·¥åŠŸèƒ½" class="headerlink" title="å®Œå–„æ–°å¢å‘˜å·¥åŠŸèƒ½"></a>å®Œå–„æ–°å¢å‘˜å·¥åŠŸèƒ½</h3><blockquote><p><strong>éœ€æ±‚åˆ†æ</strong>ï¼š</p><p>å› ä¸º<code>employee</code>è¡¨ä¸­çš„<code>username</code>å­—æ®µè¢«è®¾ç½®ä¸ºäº†å”¯ä¸€çš„çº¦æŸï¼Œæ•…åœ¨å‰ç«¯é¡µé¢å¡«å†™æ—¶è¾“å…¥ç›¸åŒçš„<code>username</code>ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ•…éœ€è¦åšå‡ºè§£å†³ï¼Œæå‡ºé”™è¯¯ä¿¡æ¯ã€‚</p></blockquote><blockquote><p><strong>åŠŸèƒ½å®ç°ï¼š</strong></p><ol><li><p>é…ç½®å…¨å±€å¼‚å¸¸çš„ä¸€ä¸ªç±»ï¼Œè®©æ‰€æœ‰<code>Controller</code>å±‚çš„ç±»çš„å¼‚å¸¸éƒ½ç»è¿‡è¯¥ç±»å¤„ç†ã€‚</p></li><li><p>è§£å†³ä¸Šè¿°ç´¢å¼•å”¯ä¸€çš„å¼‚å¸¸ï¼Œä¸ºå‰ç«¯å±•ç¤ºé”™è¯¯ä¿¡æ¯ã€‚</p></li></ol></blockquote><hr><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…¨å±€å¼‚å¸¸å¤„ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ControllerAdvice(annotations = &#123;RestController.class, Controller.class&#125;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¼‚å¸¸å¤„ç†æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(SQLIntegrityConstraintViolationException.class)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">exceptionHandler</span><span class="params">(SQLIntegrityConstraintViolationException ex)</span>&#123;</span><br><span class="line">        log.error(ex.getMessage());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(ex.getMessage().contains(<span class="string">&quot;Duplicate entry&quot;</span>))&#123;</span><br><span class="line">            String[] split = ex.getMessage().split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> split[<span class="number">2</span>] + <span class="string">&quot;å·²å­˜åœ¨&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> R.error(msg);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;æœªçŸ¥é”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><h2 id="å‘˜å·¥åˆ†é¡µæŸ¥è¯¢æ˜¾ç¤ºåˆ°å‰ç«¯"><a href="#å‘˜å·¥åˆ†é¡µæŸ¥è¯¢æ˜¾ç¤ºåˆ°å‰ç«¯" class="headerlink" title="å‘˜å·¥åˆ†é¡µæŸ¥è¯¢æ˜¾ç¤ºåˆ°å‰ç«¯"></a>å‘˜å·¥åˆ†é¡µæŸ¥è¯¢æ˜¾ç¤ºåˆ°å‰ç«¯</h2><h3 id="åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½"><a href="#åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½" class="headerlink" title="åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½"></a>åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½</h3><blockquote><p><strong>éœ€æ±‚åˆ†æï¼š</strong></p><p>å‰ç«¯å‘é€<code>get</code>è¯·æ±‚ï¼ŒæŠŠ<code>page</code>å½“å‰é¡µ,<code>pageSize</code>æ¯é¡µæ˜¾ç¤ºæ¡æ•°,<code>name</code>æŸ¥è¯¢åç­‰å‚æ•°ä¼ å…¥<code>controller</code>å±‚ï¼Œåç«¯è¿›è¡Œåˆ†é¡µæŸ¥è¯¢å’Œæ¡ä»¶æŸ¥è¯¢å¹¶æŠŠæŸ¥è¯¢å¯¹è±¡ä¼ å›ç»™å‰ç«¯</p></blockquote><blockquote><p><strong>åŠŸèƒ½å®ç°ï¼š</strong></p><ol><li>æ·»åŠ mybatis-plusçš„åˆ†é¡µæ’ä»¶</li><li>æ„é€ åˆ†é¡µæŸ¥è¯¢å™¨</li><li>æ„é€ æ¡ä»¶æŸ¥è¯¢å™¨</li><li>æ·»åŠ è¿‡æ»¤æ¡ä»¶ï¼ˆè¿™é‡Œä½¿ç”¨<code>like</code>è€Œä¸æ˜¯<code>eq</code>ï¼‰</li><li>æ·»åŠ æ’åºæ¡ä»¶</li><li>æ‰§è¡ŒæŸ¥è¯¢ï¼Œè¿”å›ç»“æœï¼ˆç»“æœä¸­è¿”å›çš„<code>pageInfo</code>å¯¹è±¡æ˜¯å› ä¸ºæŸ¥è¯¢å®Œåä¼šå°†æ•°æ®å°è£…åˆ°è¯¥å¯¹è±¡ä¸­ï¼Œå¹¶ä¸”ä¸å‰ç«¯ä¸­ç›¸å“åº”ï¼‰</li></ol></blockquote><hr><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é…ç½®MPçš„åˆ†é¡µæ’ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">mybatisPlusInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        mybatisPlusInterceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>());</span><br><span class="line">        <span class="keyword">return</span> mybatisPlusInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, String name)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ„é€ åˆ†é¡µæŸ¥è¯¢å™¨</span></span><br><span class="line">        Page&lt;Employee&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, pageSize);</span><br><span class="line">        <span class="comment">//æ„é€ æ¡ä»¶æŸ¥è¯¢å™¨</span></span><br><span class="line">        LambdaQueryWrapper&lt;Employee&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//æ·»åŠ è¿‡æ»¤æ¡ä»¶</span></span><br><span class="line">        queryWrapper.like(StringUtils.isNotBlank(name),Employee::getName,name);</span><br><span class="line">        <span class="comment">//æ·»åŠ æ’åºæ¡ä»¶</span></span><br><span class="line">        queryWrapper.orderByDesc(Employee::getUpdateTime);</span><br><span class="line">        <span class="comment">//æ‰§è¡ŒæŸ¥è¯¢</span></span><br><span class="line">        employeeService.page(pageInfo,queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(pageInfo);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><h3 id="è¡¥å……ç‚¹"><a href="#è¡¥å……ç‚¹" class="headerlink" title="è¡¥å……ç‚¹"></a>è¡¥å……ç‚¹</h3><p><img src="/../assets/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0/%E5%89%8D%E7%AB%AF%E5%88%86%E9%A1%B5%E6%9D%A1.png" alt="å‰ç«¯åˆ†é¡µæ¡"></p><blockquote><p>è¯¥å¤„å¯å»å‰ç«¯é¡µé¢ä¿®æ”¹<code>list.html</code></p></blockquote><hr><h2 id="å¯ç”¨-ç¦ç”¨å‘˜å·¥è´¦å·"><a href="#å¯ç”¨-ç¦ç”¨å‘˜å·¥è´¦å·" class="headerlink" title="å¯ç”¨&#x2F;ç¦ç”¨å‘˜å·¥è´¦å·"></a>å¯ç”¨&#x2F;ç¦ç”¨å‘˜å·¥è´¦å·</h2><h3 id="å¯ç”¨-ç¦ç”¨å‘˜å·¥è´¦å·åŠŸèƒ½å®ç°"><a href="#å¯ç”¨-ç¦ç”¨å‘˜å·¥è´¦å·åŠŸèƒ½å®ç°" class="headerlink" title="å¯ç”¨&#x2F;ç¦ç”¨å‘˜å·¥è´¦å·åŠŸèƒ½å®ç°"></a>å¯ç”¨&#x2F;ç¦ç”¨å‘˜å·¥è´¦å·åŠŸèƒ½å®ç°</h3><blockquote><p><strong>éœ€æ±‚åˆ†æï¼š</strong></p><p>ç®¡ç†å‘˜è´¦å·<code>admin</code>å¯ä»¥å¯¹å‘˜å·¥è´¦å·è¿›è¡Œå¯ç”¨å’Œç¦ç”¨æ“ä½œï¼Œè€Œå…¶ä»–ç”¨æˆ·ä¸å¯è¿›è¡Œè¯¥æ“ä½œ</p><p><strong>ä»£ç å®ç°ï¼š</strong></p><p>æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªupdateæ“ä½œï¼Œ<code>status</code>å’Œ<code>id</code>å·²ç»ä»å‰ç«¯ä¼ å…¥ï¼Œéœ€è¦é¢å¤–æ›´æ”¹çš„æ˜¯æ›´æ–°äººå’Œæ›´æ–°æ—¶é—´ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">update</span><span class="params">(HttpServletRequest request, <span class="meta">@RequestBody</span> Employee employee)</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">empId</span> <span class="operator">=</span> (Long) request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line">        employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line">        employee.setUpdateUser(empId);</span><br><span class="line">        employeeService.updateById(employee);</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;å‘˜å·¥ä¿¡æ¯ä¿®æ”¹æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><h3 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h3><blockquote><p><strong>åŸå› åˆ†æï¼š</strong></p><p><code>js</code>å¯¹<code>Long</code>ç±»å‹çš„æ•°æ®çš„å¤„ç†æ—¶ä¸¢å¤±äº†ç²¾åº¦ï¼Œå¯¼è‡´å‰ç«¯å‘é€è¿‡æ¥çš„<code>id</code>ä¸æ•°æ®åº“ä¸­çš„<code>id</code>ä¸ä¸€è‡´</p></blockquote><blockquote><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><p>å°†<code>json</code>ä¸­çš„<code>Long</code>å‹æ•°æ®è½¬æˆå­—ç¬¦ä¸²ï¼Œåœ¨é…ç½®ä¸­æ·»åŠ å¯¹åº”çš„æ–¹æ³•å³å¯ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯¹è±¡æ˜ å°„å™¨:åŸºäºjacksonå°†Javaå¯¹è±¡è½¬ä¸ºjsonï¼Œæˆ–è€…å°†jsonè½¬ä¸ºJavaå¯¹è±¡</span></span><br><span class="line"><span class="comment"> * å°†JSONè§£æä¸ºJavaå¯¹è±¡çš„è¿‡ç¨‹ç§°ä¸º [ä»JSONååºåˆ—åŒ–Javaå¯¹è±¡]</span></span><br><span class="line"><span class="comment"> * ä»Javaå¯¹è±¡ç”ŸæˆJSONçš„è¿‡ç¨‹ç§°ä¸º [åºåˆ—åŒ–Javaå¯¹è±¡åˆ°JSON]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JacksonObjectMapper</span> <span class="keyword">extends</span> <span class="title class_">ObjectMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_DATE_FORMAT</span> <span class="operator">=</span> <span class="string">&quot;yyyy-MM-dd&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_DATE_TIME_FORMAT</span> <span class="operator">=</span> <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_TIME_FORMAT</span> <span class="operator">=</span> <span class="string">&quot;HH:mm:ss&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JacksonObjectMapper</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="comment">//æ”¶åˆ°æœªçŸ¥å±æ€§æ—¶ä¸æŠ¥å¼‚å¸¸</span></span><br><span class="line">        <span class="built_in">this</span>.configure(FAIL_ON_UNKNOWN_PROPERTIES, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ååºåˆ—åŒ–æ—¶ï¼Œå±æ€§ä¸å­˜åœ¨çš„å…¼å®¹å¤„ç†</span></span><br><span class="line">        <span class="built_in">this</span>.getDeserializationConfig().withoutFeatures(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">SimpleModule</span> <span class="variable">simpleModule</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleModule</span>()</span><br><span class="line">                .addDeserializer(LocalDateTime.class, <span class="keyword">new</span> <span class="title class_">LocalDateTimeDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)))</span><br><span class="line">                .addDeserializer(LocalDate.class, <span class="keyword">new</span> <span class="title class_">LocalDateDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)))</span><br><span class="line">                .addDeserializer(LocalTime.class, <span class="keyword">new</span> <span class="title class_">LocalTimeDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)))</span><br><span class="line"></span><br><span class="line">                .addSerializer(BigInteger.class, ToStringSerializer.instance)</span><br><span class="line">                .addSerializer(Long.class, ToStringSerializer.instance)</span><br><span class="line">                .addSerializer(LocalDateTime.class, <span class="keyword">new</span> <span class="title class_">LocalDateTimeSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)))</span><br><span class="line">                .addSerializer(LocalDate.class, <span class="keyword">new</span> <span class="title class_">LocalDateSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)))</span><br><span class="line">                .addSerializer(LocalTime.class, <span class="keyword">new</span> <span class="title class_">LocalTimeSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ³¨å†ŒåŠŸèƒ½æ¨¡å— ä¾‹å¦‚ï¼Œå¯ä»¥æ·»åŠ è‡ªå®šä¹‰åºåˆ—åŒ–å™¨å’Œååºåˆ—åŒ–å™¨</span></span><br><span class="line">        <span class="built_in">this</span>.registerModule(simpleModule);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰©å±•mvcæ¡†æ¶çš„æ¶ˆæ¯è½¬æ¢å™¨ï¼ˆå†™åœ¨WebMVCConfigä¸­ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> converters</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ‰©å±•æ¶ˆæ¯è½¬æ¢å™¨...&quot;</span>);</span><br><span class="line">        <span class="comment">//åˆ›å»ºæ¶ˆæ¯è½¬æ¢å™¨å¯¹è±¡</span></span><br><span class="line">        <span class="type">MappingJackson2HttpMessageConverter</span> <span class="variable">messageConverter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MappingJackson2HttpMessageConverter</span>();</span><br><span class="line">        <span class="comment">//è®¾ç½®å¯¹è±¡è½¬æ¢å™¨ï¼Œåº•å±‚ä½¿ç”¨Jacksonå°†Javaå¯¹è±¡è½¬ä¸ºjson</span></span><br><span class="line">        messageConverter.setObjectMapper(<span class="keyword">new</span> <span class="title class_">JacksonObjectMapper</span>());</span><br><span class="line">        <span class="comment">//å°†ä¸Šé¢çš„æ¶ˆæ¯è½¬æ¢å™¨å¯¹è±¡è¿½åŠ åˆ°mvcæ¡†æ¶çš„è½¬æ¢å™¨é›†åˆä¸­</span></span><br><span class="line">        converters.add(<span class="number">0</span>,messageConverter);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ç¼–è¾‘å‘˜å·¥ä¿¡æ¯åŠŸèƒ½"><a href="#ç¼–è¾‘å‘˜å·¥ä¿¡æ¯åŠŸèƒ½" class="headerlink" title="ç¼–è¾‘å‘˜å·¥ä¿¡æ¯åŠŸèƒ½"></a>ç¼–è¾‘å‘˜å·¥ä¿¡æ¯åŠŸèƒ½</h2><h3 id="ç¼–è¾‘å‘˜å·¥ä¿¡æ¯åŠŸèƒ½å®ç°"><a href="#ç¼–è¾‘å‘˜å·¥ä¿¡æ¯åŠŸèƒ½å®ç°" class="headerlink" title="ç¼–è¾‘å‘˜å·¥ä¿¡æ¯åŠŸèƒ½å®ç°"></a>ç¼–è¾‘å‘˜å·¥ä¿¡æ¯åŠŸèƒ½å®ç°</h3><blockquote><p><strong>éœ€æ±‚åˆ†æï¼š</strong></p><p>ç”¨æˆ·ç‚¹å‡»ç¼–è¾‘æ—¶è¿›å…¥ç¼–è¾‘ç•Œé¢ï¼Œæ­¤æ—¶ç™»å½•é¡µé¢æ—¶å¯ä»¥çœ‹åˆ°ç”¨æˆ·åŸæœ¬çš„ä¿¡æ¯ï¼Œå†ç»è¿‡ä¿®æ”¹ä¿¡æ¯åä¿å­˜åˆ°æ•°æ®åº“ã€‚</p></blockquote><hr><h4 id="å›æ˜¾åŠŸèƒ½å®ç°ï¼ˆè¿›å…¥ç¼–è¾‘é¡µé¢å¯çœ‹åˆ°ç”¨æˆ·åŸå§‹ä¿¡æ¯ï¼‰"><a href="#å›æ˜¾åŠŸèƒ½å®ç°ï¼ˆè¿›å…¥ç¼–è¾‘é¡µé¢å¯çœ‹åˆ°ç”¨æˆ·åŸå§‹ä¿¡æ¯ï¼‰" class="headerlink" title="å›æ˜¾åŠŸèƒ½å®ç°ï¼ˆè¿›å…¥ç¼–è¾‘é¡µé¢å¯çœ‹åˆ°ç”¨æˆ·åŸå§‹ä¿¡æ¯ï¼‰"></a>å›æ˜¾åŠŸèƒ½å®ç°ï¼ˆè¿›å…¥ç¼–è¾‘é¡µé¢å¯çœ‹åˆ°ç”¨æˆ·åŸå§‹ä¿¡æ¯ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;Employee&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> employeeService.getById(id);</span><br><span class="line">        <span class="keyword">if</span> (employee!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> R.success(employee);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;æ²¡æœ‰æŸ¥è¯¢åˆ°å‘˜å·¥ä¿¡æ¯&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><h4 id="ç¼–è¾‘åŠŸèƒ½å®ç°"><a href="#ç¼–è¾‘åŠŸèƒ½å®ç°" class="headerlink" title="ç¼–è¾‘åŠŸèƒ½å®ç°"></a>ç¼–è¾‘åŠŸèƒ½å®ç°</h4><blockquote><p>æ³¨æ„ï¼šæ­¤å¤„ç›´æ¥è°ƒç”¨çš„æ˜¯å¯ç”¨&#x2F;ç¦ç”¨å‘˜å·¥è´¦å·æ—¶çš„æ–¹æ³•ï¼Œå› ä¸ºä¼ å…¥çš„æ˜¯ä¸€ä¸ª<code>employee</code>å¯¹è±¡ï¼Œæ•…è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªé€šç”¨çš„  æ›´æ–°æ–¹æ³•ã€‚</p></blockquote><hr><h2 id="å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……"><a href="#å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……" class="headerlink" title="å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……"></a>å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……</h2><h3 id="ä¸ºä»€ä¹ˆè¦å¯¹å…¬å…±å­—æ®µå¡«å……"><a href="#ä¸ºä»€ä¹ˆè¦å¯¹å…¬å…±å­—æ®µå¡«å……" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å¯¹å…¬å…±å­—æ®µå¡«å……"></a>ä¸ºä»€ä¹ˆè¦å¯¹å…¬å…±å­—æ®µå¡«å……</h3><blockquote><p>å› ä¸ºä¸è®ºæ˜¯åœ¨å‘˜å·¥ç®¡ç†å¤„è¿˜æ˜¯èœå“æˆ–è€…å¥—é¤ç®¡ç†å¤„éƒ½éœ€è¦æ·»åŠ è¯¸å¦‚<code>createTime</code>ï¼Œ<code>updateTime</code>ï¼Œ<code>createUser</code>ï¼Œä»¥åŠ<code>updateUser</code>è¿™å››ä¸ªå­—æ®µï¼Œæ•…å¯ä»¥ä½¿ç”¨<code>mybatis-plus</code>æä¾›çš„å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……æ–¹æ³•ï¼Œçœå»æ‰‹åŠ¨ä¸ºç”¨æˆ·å¡«å†™è¿™å››ä¸ªä¿¡æ¯ã€‚</p></blockquote><h3 id="å¦‚ä½•å®ç°"><a href="#å¦‚ä½•å®ç°" class="headerlink" title="å¦‚ä½•å®ç°"></a>å¦‚ä½•å®ç°</h3><hr><h4 id="1-åœ¨employeeè¡¨ä¸­è¿™å››ä¸ªå­—æ®µä¸Šæ·»åŠ ç›¸åº”å±æ€§"><a href="#1-åœ¨employeeè¡¨ä¸­è¿™å››ä¸ªå­—æ®µä¸Šæ·»åŠ ç›¸åº”å±æ€§" class="headerlink" title="1.åœ¨employeeè¡¨ä¸­è¿™å››ä¸ªå­—æ®µä¸Šæ·»åŠ ç›¸åº”å±æ€§"></a>1.åœ¨<code>employee</code>è¡¨ä¸­è¿™å››ä¸ªå­—æ®µä¸Šæ·»åŠ ç›¸åº”å±æ€§</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;<span class="comment">//æ­¤å¤„è¦ä¿®æ”¹ä¸ºLocalDateTimeï¼Œå› ä¸ºæ•°æ®åº“ä¸­ä¸è¿™é‡Œä½¿ç”¨çš„ç±»å‹ä¸ä¸€è‡´</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°æ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;<span class="comment">//ä¸ä¸ŠåŒç†</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºäºº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createUser;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹äºº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateUser;</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„</strong>ï¼š<code>updateTime</code>å’Œ<code>updateUser</code>éœ€è¦åœ¨åˆ›å»ºå’Œæ›´æ”¹æ—¶éƒ½åšæ›´æ”¹</p></blockquote><hr><h4 id="2-å¯å°†åŸæ–°å¢å‘˜å·¥åŠŸèƒ½åŠæ›´æ”¹å‘˜å·¥ä¿¡æ¯åŠŸèƒ½å¤„çš„ç›¸åº”çš„æ–¹æ³•æ³¨é‡Šå»"><a href="#2-å¯å°†åŸæ–°å¢å‘˜å·¥åŠŸèƒ½åŠæ›´æ”¹å‘˜å·¥ä¿¡æ¯åŠŸèƒ½å¤„çš„ç›¸åº”çš„æ–¹æ³•æ³¨é‡Šå»" class="headerlink" title="2.å¯å°†åŸæ–°å¢å‘˜å·¥åŠŸèƒ½åŠæ›´æ”¹å‘˜å·¥ä¿¡æ¯åŠŸèƒ½å¤„çš„ç›¸åº”çš„æ–¹æ³•æ³¨é‡Šå»"></a>2.å¯å°†åŸæ–°å¢å‘˜å·¥åŠŸèƒ½åŠæ›´æ”¹å‘˜å·¥ä¿¡æ¯åŠŸèƒ½å¤„çš„ç›¸åº”çš„æ–¹æ³•æ³¨é‡Šå»</h4><hr><h4 id="3-åŸºäºThreadLocalå°è£…å·¥å…·ç±»ï¼Œç”¨æˆ·ä¿å­˜å’Œè·å–å½“å‰ç™»å½•ç”¨æˆ·id"><a href="#3-åŸºäºThreadLocalå°è£…å·¥å…·ç±»ï¼Œç”¨æˆ·ä¿å­˜å’Œè·å–å½“å‰ç™»å½•ç”¨æˆ·id" class="headerlink" title="3.åŸºäºThreadLocalå°è£…å·¥å…·ç±»ï¼Œç”¨æˆ·ä¿å­˜å’Œè·å–å½“å‰ç™»å½•ç”¨æˆ·id"></a>3.åŸºäºThreadLocalå°è£…å·¥å…·ç±»ï¼Œç”¨æˆ·ä¿å­˜å’Œè·å–å½“å‰ç™»å½•ç”¨æˆ·id</h4><blockquote><p>åˆ›å»ºè¯¥å·¥å…·ç±»ï¼Œå› ä¸ºåœ¨ä¸€æ¬¡Httpè¯·æ±‚ä¸­çº¿ç¨‹æ˜¯å”¯ä¸€çš„ï¼Œæ•…å¯ä»¥é€šè¿‡è¯¥æ–¹å¼å¾—åˆ°å­˜å…¥Sessionä¸­å­˜æ”¾çš„idã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŸºäºThreadLocalå°è£…å·¥å…·ç±»ï¼Œç”¨æˆ·ä¿å­˜å’Œè·å–å½“å‰ç™»å½•ç”¨æˆ·id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;Long&gt; threadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setCurrentId</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        threadLocal.set(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">getCurrentId</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> threadLocal.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="4-è‡ªå®šä¹‰å…ƒæ•°æ®å¯¹è±¡å¤„ç†å™¨ï¼ˆå³å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……ç±»ï¼‰"><a href="#4-è‡ªå®šä¹‰å…ƒæ•°æ®å¯¹è±¡å¤„ç†å™¨ï¼ˆå³å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……ç±»ï¼‰" class="headerlink" title="4.è‡ªå®šä¹‰å…ƒæ•°æ®å¯¹è±¡å¤„ç†å™¨ï¼ˆå³å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……ç±»ï¼‰"></a>4.è‡ªå®šä¹‰å…ƒæ•°æ®å¯¹è±¡å¤„ç†å™¨ï¼ˆå³å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……ç±»ï¼‰</h4><blockquote><p>è¯¥ç±»ä¸­é‡å†™ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«ç”¨äºæ’å…¥æ“ä½œå’Œæ›´æ–°æ“ä½œæ—¶çš„è‡ªåŠ¨å¡«å……ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰å…ƒæ•°æ®å¯¹è±¡å¤„ç†å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjecthandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ’å…¥æ“ä½œï¼Œè‡ªåŠ¨å¡«å……</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> metaObject</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……[insert]...&quot;</span>);</span><br><span class="line">        log.info(metaObject.toString());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;createTime&quot;</span>, LocalDateTime.now());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateTime&quot;</span>,LocalDateTime.now());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;createUser&quot;</span>,BaseContext.getCurrentId());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateUser&quot;</span>,BaseContext.getCurrentId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°æ“ä½œï¼Œè‡ªåŠ¨å¡«å……</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> metaObject</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……[update]...&quot;</span>);</span><br><span class="line">        log.info(metaObject.toString());</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> Thread.currentThread().getId();</span><br><span class="line">        log.info(<span class="string">&quot;çº¿ç¨‹idä¸ºï¼š&#123;&#125;&quot;</span>,id);</span><br><span class="line"></span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateTime&quot;</span>,LocalDateTime.now());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateUser&quot;</span>,BaseContext.getCurrentId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="5-å°†Sessionä¸­å­˜æ”¾çš„idå­˜å…¥çº¿ç¨‹ä¸­"><a href="#5-å°†Sessionä¸­å­˜æ”¾çš„idå­˜å…¥çº¿ç¨‹ä¸­" class="headerlink" title="5.å°†Sessionä¸­å­˜æ”¾çš„idå­˜å…¥çº¿ç¨‹ä¸­"></a>5.å°†Sessionä¸­å­˜æ”¾çš„idå­˜å…¥çº¿ç¨‹ä¸­</h4><blockquote><p>åœ¨å·²ç™»å½•çš„æƒ…å†µä¸‹å°†Sessionä¸­å­˜æ”¾çš„idå­˜å…¥çº¿ç¨‹ä¸­ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//4ã€åˆ¤æ–­ç™»å½•çŠ¶æ€ï¼Œå¦‚æœå·²ç™»å½•ï¼Œåˆ™ç›´æ¥æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> (request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;ç”¨æˆ·å·²ç™»å½•ï¼Œç”¨æˆ·idä¸ºï¼š&#123;&#125;&quot;</span>, request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>));</span><br><span class="line">            <span class="type">Long</span> <span class="variable">empId</span> <span class="operator">=</span> (Long) request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line">            BaseContext.setCurrentId(empId);</span><br><span class="line">            filterChain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h3 id="å°ç»“ï¼ˆé€»è¾‘ï¼‰"><a href="#å°ç»“ï¼ˆé€»è¾‘ï¼‰" class="headerlink" title="å°ç»“ï¼ˆé€»è¾‘ï¼‰"></a>å°ç»“ï¼ˆé€»è¾‘ï¼‰</h3><blockquote><p>åœ¨ä¸€æ¬¡Httpè¯·æ±‚ä¸­çº¿ç¨‹æ˜¯ä¸ä¼šå‘ç”Ÿæ”¹å˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å‘é€è¯·æ±‚ç»™åç«¯æ—¶ï¼Œç»è¿‡è¿‡æ»¤å™¨ï¼Œå†ç»è¿‡Controllerï¼Œæœ€ååœ¨MyMetaObjecthandlerå®ç°è‡ªåŠ¨å¡«å……æ–¹æ³•æ—¶çš„çº¿ç¨‹çš„idéƒ½æ˜¯ä¸ä¼šå‘ç”Ÿæ”¹å˜çš„ã€‚</p><p>éœ€è¦ä½¿ç”¨åˆ°çº¿ç¨‹çš„åŸå› æ˜¯å› ä¸ºåœ¨è‡ªåŠ¨å¡«å……æ›´æ–°äººå’Œåˆ›å»ºäººçš„æ—¶å€™ï¼Œéœ€è¦å°†ç”¨æˆ·çš„idä¼ å…¥ï¼Œä½†åœ¨MyMetaObjecthandlerç±»ä¸­æ— æ³•ç›´æ¥è·å¾—åˆ°Sessionä¸­çš„idï¼Œæ•…éœ€è¦ä½¿ç”¨è¯¥æ–¹æ³•ã€‚</p></blockquote><hr><h2 id="æ–°å¢åˆ†ç±»"><a href="#æ–°å¢åˆ†ç±»" class="headerlink" title="æ–°å¢åˆ†ç±»"></a>æ–°å¢åˆ†ç±»</h2><h3 id="æ–°å¢åˆ†ç±»åŠŸèƒ½å®ç°"><a href="#æ–°å¢åˆ†ç±»åŠŸèƒ½å®ç°" class="headerlink" title="æ–°å¢åˆ†ç±»åŠŸèƒ½å®ç°"></a>æ–°å¢åˆ†ç±»åŠŸèƒ½å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> Category category)</span> &#123;</span><br><span class="line">        categoryService.save(category);</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;æ–°å¢åˆ†ç±»æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><h2 id="åˆ†ç±»åˆ†é¡µæŸ¥è¯¢æ˜¾ç¤ºæ•°æ®åˆ°é¡µé¢ä¸Š"><a href="#åˆ†ç±»åˆ†é¡µæŸ¥è¯¢æ˜¾ç¤ºæ•°æ®åˆ°é¡µé¢ä¸Š" class="headerlink" title="åˆ†ç±»åˆ†é¡µæŸ¥è¯¢æ˜¾ç¤ºæ•°æ®åˆ°é¡µé¢ä¸Š"></a>åˆ†ç±»åˆ†é¡µæŸ¥è¯¢æ˜¾ç¤ºæ•°æ®åˆ°é¡µé¢ä¸Š</h2><h3 id="åˆ†ç±»åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½å®ç°"><a href="#åˆ†ç±»åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½å®ç°" class="headerlink" title="åˆ†ç±»åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½å®ç°"></a>åˆ†ç±»åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page,<span class="type">int</span> pageSize)</span>&#123;</span><br><span class="line">        Page&lt;Category&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page,pageSize);</span><br><span class="line">        LambdaQueryWrapper&lt;Category&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.orderByAsc(Category::getSort);</span><br><span class="line">        categoryService.page(pageInfo,queryWrapper);</span><br><span class="line">        <span class="keyword">return</span> R.success(pageInfo);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><h2 id="åˆ é™¤åˆ†ç±»"><a href="#åˆ é™¤åˆ†ç±»" class="headerlink" title="åˆ é™¤åˆ†ç±»"></a>åˆ é™¤åˆ†ç±»</h2><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><blockquote><p><strong>æ³¨æ„</strong>ï¼šå› ä¸ºåˆ†ç±»è¡¨ä¸­åŒ…å«ç€èœå“åˆ†ç±»å’Œå¥—é¤åˆ†ç±»ï¼Œè€Œå¯¹åº”çš„èœå“è¡¨å’Œå¥—é¤è¡¨ä¸­å­˜åœ¨ç€ä¸€äº›å…³è”ï¼Œæ•…è§„å®šèœå“è¡¨ï¼ˆå¥—é¤è¡¨ï¼‰ä¸­å­˜åœ¨å…³è”çš„åˆ†ç±»ä¸å…è®¸åˆ é™¤ã€‚</p></blockquote><h3 id="ä»£ç åŠŸèƒ½å®ç°"><a href="#ä»£ç åŠŸèƒ½å®ç°" class="headerlink" title="ä»£ç åŠŸèƒ½å®ç°"></a>ä»£ç åŠŸèƒ½å®ç°</h3><ul><li><strong>åœ¨<code>CategoryController</code>ç±»ä¸­è°ƒç”¨è‡ªå®šä¹‰æ–¹æ³•</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">delete</span><span class="params">(Long ids)</span>&#123;</span><br><span class="line">        categoryService.remove(ids);</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;åˆ é™¤åˆ†ç±»æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><ul><li><strong>åœ¨<code>CategoryService</code>æ¥å£ä¸­åˆ›å»ºè‡ªå®šä¹‰æ–¹æ³•<code>remove</code></strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Category&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Long ids)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ul><li><p><strong>åœ¨<code>CategoryServiceImpl</code>å®ç°ç±»ä¸­å®ç°æ–¹æ³•</strong></p><blockquote><p>é€šè¿‡æŸ¥è¯¢èœå“è¡¨æˆ–å•†å“è¡¨ä¸­<code>CategoryId</code>ä¸ä¼ å…¥çš„<code>id</code>ç›¸ç­‰çš„æ•°é‡ï¼Œè‹¥å¤§äºé›¶åˆ™è¯æ˜å­˜åœ¨å…³è”ï¼Œåˆ™ä¸å…è®¸åˆ é™¤ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªè‡ªå®šä¹‰çš„å¼‚å¸¸</p></blockquote></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;CategoryMapper, Category&gt; <span class="keyword">implements</span> <span class="title class_">CategoryService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DishService dishService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SetmealService setmealService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idåˆ é™¤ï¼Œåˆ é™¤å‰éœ€åˆ¤æ–­æ¡ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Long ids)</span> &#123;</span><br><span class="line">        <span class="comment">//æŸ¥çœ‹æ˜¯å¦å…³è”èœå“</span></span><br><span class="line">        LambdaQueryWrapper&lt;Dish&gt; dishLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        dishLambdaQueryWrapper.eq(Dish::getCategoryId, ids);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count1</span> <span class="operator">=</span> dishService.count(dishLambdaQueryWrapper);</span><br><span class="line">        <span class="keyword">if</span> (count1 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;å½“å‰åˆ†ç±»ä¸‹å…³è”äº†èœå“ï¼Œä¸èƒ½åˆ é™¤&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æŸ¥çœ‹æ˜¯å¦å…³è”å¥—é¤</span></span><br><span class="line">        LambdaQueryWrapper&lt;Setmeal&gt; setmealLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        setmealLambdaQueryWrapper.eq(Setmeal::getCategoryId, ids);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count2</span> <span class="operator">=</span> setmealService.count(setmealLambdaQueryWrapper);</span><br><span class="line">        <span class="keyword">if</span> (count2 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;å½“å‰åˆ†ç±»ä¸‹å…³è”äº†å¥—é¤ï¼Œä¸èƒ½åˆ é™¤&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ— å…³è”åˆ™è¿›è¡Œåˆ é™¤</span></span><br><span class="line">        <span class="built_in">super</span>.removeById(ids);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ul><li><strong>è‡ªå®šä¹‰å¼‚å¸¸ç±»<code>CustomException</code></strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CustomException</span><span class="params">(String message)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ul><li><strong>å°†è¯¥å¼‚å¸¸äº¤äºä¹‹å‰å®šä¹‰çš„å…¨å±€å¼‚å¸¸å¤„ç†å™¨å¤„ç†</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¼‚å¸¸å¤„ç†æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(CustomException.class)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">exceptionHandler</span><span class="params">(CustomException ex)</span>&#123;</span><br><span class="line">        log.error(ex.getMessage());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.error(ex.getMessage());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ä¿®æ”¹åˆ†ç±»"><a href="#ä¿®æ”¹åˆ†ç±»" class="headerlink" title="ä¿®æ”¹åˆ†ç±»"></a>ä¿®æ”¹åˆ†ç±»</h2><h3 id="ä¿®æ”¹åˆ†ç±»åŠŸèƒ½å®ç°"><a href="#ä¿®æ”¹åˆ†ç±»åŠŸèƒ½å®ç°" class="headerlink" title="ä¿®æ”¹åˆ†ç±»åŠŸèƒ½å®ç°"></a>ä¿®æ”¹åˆ†ç±»åŠŸèƒ½å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> Category category)</span>&#123;</span><br><span class="line">        categoryService.updateById(category);</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;ä¿®æ”¹åˆ†ç±»æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><h2 id="æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½"><a href="#æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½"></a>æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½</h2><h3 id="åŠŸèƒ½åˆ†æ"><a href="#åŠŸèƒ½åˆ†æ" class="headerlink" title="åŠŸèƒ½åˆ†æ"></a>åŠŸèƒ½åˆ†æ</h3><blockquote><p>ç”¨äºæ–°å¢èœå“æ—¶çš„å›¾ç‰‡çš„ä¸Šä¼ å’Œå›æ˜¾</p></blockquote><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/common&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;reggie.path&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String basePath;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">upload</span><span class="params">(MultipartFile file)</span>&#123;</span><br><span class="line">        <span class="comment">//fileæ˜¯ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œéœ€è¦è½¬å­˜åˆ°æŒ‡å®šä½ç½®ï¼Œå¦åˆ™æœ¬æ¬¡è¯·æ±‚å®Œæˆåä¸´æ—¶æ–‡ä»¶ä¼šåˆ é™¤</span></span><br><span class="line">        log.info(file.toString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åŸå§‹æ–‡ä»¶å</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();<span class="comment">//abc.jpg</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä½¿ç”¨UUIDé‡æ–°ç”Ÿæˆæ–‡ä»¶åï¼Œé˜²æ­¢æ–‡ä»¶åç§°é‡å¤é€ æˆæ–‡ä»¶è¦†ç›–</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> UUID.randomUUID().toString() + suffix;<span class="comment">//dfsdfdfd.jpg</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªç›®å½•å¯¹è±¡</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(basePath);</span><br><span class="line">        <span class="comment">//åˆ¤æ–­å½“å‰ç›®å½•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span>(!dir.exists())&#123;</span><br><span class="line">            <span class="comment">//ç›®å½•ä¸å­˜åœ¨ï¼Œéœ€è¦åˆ›å»º</span></span><br><span class="line">            dir.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//å°†ä¸´æ—¶æ–‡ä»¶è½¬å­˜åˆ°æŒ‡å®šä½ç½®</span></span><br><span class="line">            file.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(basePath + fileName));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.success(fileName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡ä»¶ä¸‹è½½</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/download&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">download</span><span class="params">(String name, HttpServletResponse response)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//è¾“å…¥æµï¼Œé€šè¿‡è¾“å…¥æµè¯»å–æ–‡ä»¶å†…å®¹</span></span><br><span class="line">            <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(basePath + name));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//è¾“å‡ºæµï¼Œé€šè¿‡è¾“å‡ºæµå°†æ–‡ä»¶å†™å›æµè§ˆå™¨</span></span><br><span class="line">            <span class="type">ServletOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line"></span><br><span class="line">            response.setContentType(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">while</span> ((len = fileInputStream.read(bytes)) != -<span class="number">1</span>)&#123;</span><br><span class="line">                outputStream.write(bytes,<span class="number">0</span>,len);</span><br><span class="line">                outputStream.flush();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å…³é—­èµ„æº</span></span><br><span class="line">            outputStream.close();</span><br><span class="line">            fileInputStream.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ–°å¢èœå“"><a href="#æ–°å¢èœå“" class="headerlink" title="æ–°å¢èœå“"></a>æ–°å¢èœå“</h2><h3 id="åŠŸèƒ½åˆ†æ-1"><a href="#åŠŸèƒ½åˆ†æ-1" class="headerlink" title="åŠŸèƒ½åˆ†æ"></a>åŠŸèƒ½åˆ†æ</h3><blockquote><p><strong>ç‚¹å‡»æ–°å»ºèœå“åï¼Œé¡µé¢ä¼šç«‹å³å‘é€ä¸€ä¸ªè¯·æ±‚ï¼ˆè·å–èœå“åˆ†ç±»ä¿¡æ¯åˆ—è¡¨ï¼‰</strong></p><p><strong>èœå“å›¾ç‰‡å¾—ä¸Šä¼ å’Œå›æ˜¾ç”±ä¹‹å‰å®Œæˆ</strong></p><p><strong>æ­¤å¤„æ–°å¢èœå“æ‰€ä¸Šä¼ å¾—æ•°æ®ä¸åªæœ‰èœå“è¡¨çš„ä¿¡æ¯ï¼Œè¿˜æœ‰èœå“å£å‘³è¡¨çš„ä¿¡æ¯ï¼Œæ•…æ¥å—æ•°æ®éœ€è¦ä¸€ä¸ªæ–°çš„ç±»</strong></p></blockquote><h3 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><ul><li><strong>èœå“åˆ†ç±»å±•ç¤ºä¸ºä¸‹æ‹‰åˆ—è¡¨</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢èœå“(å¥—é¤)æ—¶ä¸‹æ‹‰èœå“ï¼ˆå¥—é¤ï¼‰åˆ†ç±»åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> category</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;List&lt;Category&gt;&gt; <span class="title function_">list</span><span class="params">(Category category)</span>&#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Category&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(category.getType()!=<span class="literal">null</span>,Category::getType,category.getType());</span><br><span class="line">        queryWrapper.orderByAsc(Category::getSort).orderByDesc(Category::getUpdateTime);</span><br><span class="line">        List&lt;Category&gt; list = categoryService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(list);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li><strong>æ–°å»ºä¸€ä¸ªç±»ç”¨äºæ¥å—å‰ç«¯å‘é€çš„æ•°æ®</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishDto</span> <span class="keyword">extends</span> <span class="title class_">Dish</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;DishFlavor&gt; flavors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();<span class="comment">//èœå“å£å‘³åˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String categoryName;<span class="comment">//åˆ†ç±»åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer copies;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>æ–°æ·»åŠ ä¸€ä¸ªæ–¹æ³•ç”¨äºä¸€æ¬¡ä¿®æ”¹ä¸¤å¼ è¡¨</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DishService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Dish&gt; &#123;</span><br><span class="line">    <span class="comment">//æ–°å¢èœå“ï¼Œéœ€è¦åŒæ—¶æ“ä½œä¸¤å¼ è¡¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithFlavor</span><span class="params">(DishDto dishDto)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><strong>å®ç°è¯¥æ–¹æ³•</strong></p><blockquote><p><strong>æ³¨æ„ï¼šæ­¤å¤„éœ€è¦å¼€å§‹äº‹åŠ¡ï¼Œå¹¶ä¸”ç”±å‰ç«¯ä¼ å…¥çš„èœå“å£å‘³æ•°æ®ä¸­æ²¡æœ‰ä¸ä¹‹å¯¹åº”çš„èœå“<code>id</code>ï¼Œæ•…éœ€è¦æ‹¿åˆ°èœå“å£å‘³çš„åˆ—è¡¨é›†åˆè¿›è¡Œ<code>id</code>çš„èµ‹å€¼ã€‚</strong></p></blockquote></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;DishMapper, Dish&gt; <span class="keyword">implements</span> <span class="title class_">DishService</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DishFlavorService dishFlavorService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithFlavor</span><span class="params">(DishDto dishDto)</span> &#123;</span><br><span class="line">        <span class="comment">//å°†èœå“ä¿¡æ¯ä¿å­˜åˆ°èœå“è¡¨ä¸­</span></span><br><span class="line">        <span class="built_in">this</span>.save(dishDto);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å°†èœå“å£å‘³å­˜å…¥èœå“å£å‘³è¡¨</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> dishDto.getId();</span><br><span class="line"></span><br><span class="line">        List&lt;DishFlavor&gt; flavors = dishDto.getFlavors();</span><br><span class="line">        <span class="keyword">for</span> (DishFlavor flavor : flavors) &#123;</span><br><span class="line">            flavor.setDishId(dishId);</span><br><span class="line">        &#125;</span><br><span class="line">        dishFlavorService.saveBatch(flavors);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="èœå“åˆ†é¡µå±•ç¤º"><a href="#èœå“åˆ†é¡µå±•ç¤º" class="headerlink" title="èœå“åˆ†é¡µå±•ç¤º"></a>èœå“åˆ†é¡µå±•ç¤º</h2><h3 id="åŠŸèƒ½åˆ†æ-2"><a href="#åŠŸèƒ½åˆ†æ-2" class="headerlink" title="åŠŸèƒ½åˆ†æ"></a>åŠŸèƒ½åˆ†æ</h3><blockquote><p><strong>ä¸å‘˜å·¥å’Œåˆ†ç±»çš„æŸ¥è¯¢çš„ä¸åŒä¹‹å¤„åœ¨äºï¼š<code>Dish</code>è¡¨ä¸­æ‰€æœ‰çš„åªæ˜¯åˆ†ç±»çš„<code>id</code>è€Œä¸æ˜¯åˆ†ç±»çš„åç§°ï¼Œä½†å‰ç«¯é¡µé¢éœ€è¦å±•ç¤ºçš„æ˜¯åˆ†ç±»çš„åç§°è€Œä¸æ˜¯<code>id</code>ã€‚</strong></p></blockquote><h3 id="ä»£ç å®ç°-2"><a href="#ä»£ç å®ç°-2" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><blockquote><p>åœ¨åŸºç¡€ä¸ŠåŠ ä»¥æ”¹å˜</p><ul><li>å°†åˆ†é¡µå¯¹è±¡pageInfoæ‹·è´ç»™dishDtoPageï¼Œä½†ä¸æ‹·è´recordsè¿™ä¸ªé›†åˆï¼ˆè¯¥é›†åˆå­˜å‚¨çš„æ˜¯å‰ç«¯ä¼ å…¥çš„æ•°æ®ï¼‰</li><li>å°†List<Dish>ä¼ ç»™List<DishDto>çš„åŒæ—¶ï¼Œå°†åˆ†ç±»çš„åç§°ä¹Ÿä¼ å…¥List<DishDto></li><li>å®ç°æ–¹å¼ä¸ºç”¨åˆ—è¡¨å­˜å‚¨å¤šä¸ªDishDtoå¯¹è±¡ï¼Œé€šè¿‡åˆ†ç±»idå¾—åˆ°åˆ†ç±»å¯¹è±¡ï¼Œå†é€šè¿‡åˆ†ç±»å¯¹è±¡å¾—åˆ°åˆ†ç±»åç§°ï¼Œå°†åˆ†ç±»åç§°æ”¾å…¥DishDtoå¯¹è±¡ä¸­ï¼Œå¹¶å°†Dishä¸­çš„å…¶ä»–å±æ€§æ‹·è´è‡³DishDtoä¸­ï¼Œæœ€åç»Ÿä¸€ç”±listæ”¶é›†DishDtoå¯¹è±¡ã€‚</li><li>å°†listå¯¹è±¡ä¼ å…¥åˆ†é¡µå¯¹è±¡çš„recodeså±æ€§ä¸­ã€‚</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page,<span class="type">int</span> pageSize,String name)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ„é€ åˆ†é¡µæ„é€ å™¨å¯¹è±¡</span></span><br><span class="line">        Page&lt;Dish&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page,pageSize);</span><br><span class="line">        Page&lt;DishDto&gt; dishDtoPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¡ä»¶æ„é€ å™¨</span></span><br><span class="line">        LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//æ·»åŠ è¿‡æ»¤æ¡ä»¶</span></span><br><span class="line">        queryWrapper.like(name != <span class="literal">null</span>,Dish::getName,name);</span><br><span class="line">        <span class="comment">//æ·»åŠ æ’åºæ¡ä»¶</span></span><br><span class="line">        queryWrapper.orderByDesc(Dish::getUpdateTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ‰§è¡Œåˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line">        dishService.page(pageInfo,queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¯¹è±¡æ‹·è´</span></span><br><span class="line">        BeanUtils.copyProperties(pageInfo,dishDtoPage,<span class="string">&quot;records&quot;</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;Dish&gt; records = pageInfo.getRecords();</span><br><span class="line"></span><br><span class="line">        List&lt;DishDto&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Dish record : records) &#123;</span><br><span class="line">   <span class="comment">//æ¯è½®å¾ªç¯åˆ›é€ ä¸€ä¸ªæ–°çš„disDtoå¯¹è±¡</span></span><br><span class="line">            <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line">            <span class="comment">//å¾—åˆ°åˆ†ç±»id</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">categoryId</span> <span class="operator">=</span> record.getCategoryId();</span><br><span class="line">            <span class="comment">//æ ¹æ®idå¾—åˆ°å¯¹åº”çš„åˆ†ç±»å¯¹è±¡</span></span><br><span class="line">            <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(categoryId);</span><br><span class="line">            <span class="keyword">if</span>(category!=<span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//æ ¹æ®è¯¥å¯¹è±¡å¾—åˆ°åˆ†ç±»çš„åç§°</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">categoryName</span> <span class="operator">=</span> category.getName();</span><br><span class="line">                <span class="comment">//å°†åˆ†ç±»åç§°å­˜å…¥dishDtoå¯¹è±¡ä¸­</span></span><br><span class="line">                dishDto.setCategoryName(categoryName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å°†å…¶ä½™å±æ€§æ‹·è´åˆ°è¯¥å¯¹è±¡ä¸­</span></span><br><span class="line">            BeanUtils.copyProperties(record,dishDto);</span><br><span class="line"></span><br><span class="line">            list.add(dishDto);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        List&lt;DishDto&gt; list = records.stream().map((item) -&gt; &#123;</span></span><br><span class="line"><span class="comment">//            DishDto dishDto = new DishDto();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            BeanUtils.copyProperties(item,dishDto);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            Long categoryId = item.getCategoryId();//åˆ†ç±»id</span></span><br><span class="line"><span class="comment">//            //æ ¹æ®idæŸ¥è¯¢åˆ†ç±»å¯¹è±¡</span></span><br><span class="line"><span class="comment">//            Category category = categoryService.getById(categoryId);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            if(category != null)&#123;</span></span><br><span class="line"><span class="comment">//                String categoryName = category.getName();</span></span><br><span class="line"><span class="comment">//                dishDto.setCategoryName(categoryName);</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//            return dishDto;</span></span><br><span class="line"><span class="comment">//        &#125;).collect(Collectors.toList());</span></span><br><span class="line"></span><br><span class="line">        dishDtoPage.setRecords(list);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(dishDtoPage);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><h2 id="èœå“çš„æ‰¹é‡èµ·å”®å’Œåœå”®"><a href="#èœå“çš„æ‰¹é‡èµ·å”®å’Œåœå”®" class="headerlink" title="èœå“çš„æ‰¹é‡èµ·å”®å’Œåœå”®"></a>èœå“çš„æ‰¹é‡èµ·å”®å’Œåœå”®</h2><blockquote><p>éœ€è¦ä¿®æ”¹ï¼šè‹¥èœå“å…³è”äº†å¥—é¤ï¼Œåˆ™ä¸å…è®¸åœå”®</p></blockquote><h3 id="éœ€æ±‚åˆ†æ-1"><a href="#éœ€æ±‚åˆ†æ-1" class="headerlink" title="éœ€æ±‚åˆ†æ"></a><strong>éœ€æ±‚åˆ†æ</strong></h3><p><img src="/../assets/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0/%E8%AF%B7%E6%B1%82%E8%B7%AF%E5%BE%84.png" alt="è¯·æ±‚è·¯å¾„"></p><blockquote><h6 id="æ³¨æ„ç‚¹ï¼š-PathVariableçš„ä½¿ç”¨ï¼Œåœ¨æœ‰å¤šä¸ªå‚æ•°æ—¶éœ€åŠ ä¸Šå ä½ç¬¦çš„å€¼æ‰èƒ½è®©å€¼ä¼ å…¥"><a href="#æ³¨æ„ç‚¹ï¼š-PathVariableçš„ä½¿ç”¨ï¼Œåœ¨æœ‰å¤šä¸ªå‚æ•°æ—¶éœ€åŠ ä¸Šå ä½ç¬¦çš„å€¼æ‰èƒ½è®©å€¼ä¼ å…¥" class="headerlink" title="æ³¨æ„ç‚¹ï¼š@PathVariableçš„ä½¿ç”¨ï¼Œåœ¨æœ‰å¤šä¸ªå‚æ•°æ—¶éœ€åŠ ä¸Šå ä½ç¬¦çš„å€¼æ‰èƒ½è®©å€¼ä¼ å…¥"></a><strong>æ³¨æ„ç‚¹ï¼š<code>@PathVariable</code>çš„ä½¿ç”¨ï¼Œåœ¨æœ‰å¤šä¸ªå‚æ•°æ—¶éœ€åŠ ä¸Šå ä½ç¬¦çš„å€¼æ‰èƒ½è®©å€¼ä¼ å…¥</strong></h6></blockquote><hr><h3 id="ä»£ç å®ç°-3"><a href="#ä»£ç å®ç°-3" class="headerlink" title="ä»£ç å®ç°"></a><strong>ä»£ç å®ç°</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">changeStatus</span><span class="params">(<span class="meta">@PathVariable(&quot;status&quot;)</span> Integer status, Long[] ids)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">            <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> dishService.getById(id);</span><br><span class="line">            <span class="keyword">if</span> (dish != <span class="literal">null</span>) &#123;</span><br><span class="line">                dish.setStatus(status);</span><br><span class="line">                dishService.updateById(dish);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;èœå“å”®å–çŠ¶æ€ä¿®æ”¹æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ä¿®æ”¹èœå“ä¿¡æ¯"><a href="#ä¿®æ”¹èœå“ä¿¡æ¯" class="headerlink" title="ä¿®æ”¹èœå“ä¿¡æ¯"></a>ä¿®æ”¹èœå“ä¿¡æ¯</h2><h3 id="èœå“ä¿¡æ¯å›æ˜¾åŠŸèƒ½"><a href="#èœå“ä¿¡æ¯å›æ˜¾åŠŸèƒ½" class="headerlink" title="èœå“ä¿¡æ¯å›æ˜¾åŠŸèƒ½"></a>èœå“ä¿¡æ¯å›æ˜¾åŠŸèƒ½</h3><ul><li><strong>åŠŸèƒ½åˆ†æ</strong></li></ul><blockquote><p><strong>å°†å·²æœ‰çš„èœå“ä¿¡æ¯å’Œèœå“å£å‘³ä¿¡æ¯æŸ¥è¯¢å‡ºæ¥ä¼ å›å‰ç«¯ã€‚</strong></p></blockquote><ul><li><strong>ä»£ç å®ç°</strong></li><li><strong>åœ¨<code>DishService</code>æ¥å£ä¸­åˆ›å»ºä¸€ä¸ªæ–¹æ³•ç”¨äºä¸€æ¬¡æŸ¥ä¸¤å¼ è¡¨ã€‚</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ ¹æ®idæŸ¥è¯¢ä¸¤å¼ è¡¨</span></span><br><span class="line">    DishDto <span class="title function_">getByIdWithFlavor</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><hr><ul><li><p><strong>å®ç°è¯¥æ–¹æ³•</strong></p><blockquote><p>å°†ä¸¤å¼ è¡¨çš„æ•°æ®åˆ†åˆ«æŸ¥å‡ºï¼Œå†å­˜å…¥åŒä¸€ä¸ªdishDtoå¯¹è±¡ä¸­</p></blockquote></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> DishDto <span class="title function_">getByIdWithFlavor</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(id);</span><br><span class="line"></span><br><span class="line">        <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line"></span><br><span class="line">        BeanUtils.copyProperties(dish, dishDto);</span><br><span class="line"></span><br><span class="line">        LambdaQueryWrapper&lt;DishFlavor&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(DishFlavor::getDishId, id);</span><br><span class="line">        List&lt;DishFlavor&gt; list = dishFlavorService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">        dishDto.setFlavors(list);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dishDto;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><ul><li><strong>controllerå±‚è°ƒç”¨è¯¥æ–¹æ³•</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;DishDto&gt; <span class="title function_">get</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> dishService.getByIdWithFlavor(id);</span><br><span class="line">        <span class="keyword">if</span> (dishDto != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.success(dishDto);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;æ²¡æœ‰æŸ¥è¯¢åˆ°èœå“ä¿¡æ¯&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ä¿®æ”¹èœå“åŠŸèƒ½"><a href="#ä¿®æ”¹èœå“åŠŸèƒ½" class="headerlink" title="ä¿®æ”¹èœå“åŠŸèƒ½"></a>ä¿®æ”¹èœå“åŠŸèƒ½</h3><ul><li><strong>åœ¨<code>DishService</code>æ¥å£ä¸­åˆ›å»ºä¸€ä¸ªæ–¹æ³•ç”¨äºä¸€æ¬¡ä¿®æ”¹ä¸¤å¼ è¡¨ã€‚</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¿®æ”¹èœå“ï¼Œéœ€è¦åŒæ—¶æ“ä½œä¸¤å¼ è¡¨</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateWithFlavor</span><span class="params">(DishDto dishDto)</span>;</span><br></pre></td></tr></table></figure><hr><ul><li><strong>å®ç°è¯¥æ–¹æ³•</strong></li></ul><blockquote><ol><li><p>æ›´æ–°èœå“åŸºæœ¬ä¿¡æ¯</p></li><li><p>åˆ é™¤èœå“å£å‘³åŸæœ‰ä¿¡æ¯</p></li><li><p>æ–°å¢èœå“å£å‘³ä¿¡æ¯</p></li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateWithFlavor</span><span class="params">(DishDto dishDto)</span> &#123;</span><br><span class="line">        <span class="comment">//å°†èœå“ä¿¡æ¯æ›´æ–°åˆ°èœå“è¡¨ä¸­</span></span><br><span class="line">        <span class="built_in">this</span>.updateById(dishDto);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å…ˆå°†å£å‘³è¡¨çš„æ•°æ®æ¸…ç©º</span></span><br><span class="line">        LambdaQueryWrapper&lt;DishFlavor&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(DishFlavor::getDishId, dishDto.getId());</span><br><span class="line">        dishFlavorService.remove(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å†å°†èœå“å£å‘³å­˜å…¥èœå“å£å‘³è¡¨</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> dishDto.getId();</span><br><span class="line"></span><br><span class="line">        List&lt;DishFlavor&gt; flavors = dishDto.getFlavors();</span><br><span class="line">        <span class="keyword">for</span> (DishFlavor flavor : flavors) &#123;</span><br><span class="line">            flavor.setDishId(dishId);</span><br><span class="line">        &#125;</span><br><span class="line">        dishFlavorService.updateBatchById(flavors);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><h2 id="èœå“çš„æ‰¹é‡åˆ é™¤ï¼ˆé€»è¾‘åˆ é™¤ï¼‰"><a href="#èœå“çš„æ‰¹é‡åˆ é™¤ï¼ˆé€»è¾‘åˆ é™¤ï¼‰" class="headerlink" title="èœå“çš„æ‰¹é‡åˆ é™¤ï¼ˆé€»è¾‘åˆ é™¤ï¼‰"></a>èœå“çš„æ‰¹é‡åˆ é™¤ï¼ˆé€»è¾‘åˆ é™¤ï¼‰</h2><h3 id="éœ€æ±‚åˆ†æ-2"><a href="#éœ€æ±‚åˆ†æ-2" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><blockquote><p><strong>éœ€æ³¨æ„ï¼šè‹¥è¯¥èœå“æ­£å¤„äºèµ·å”®çŠ¶æ€ä¸èƒ½åˆ é™¤ï¼Œè‹¥è¯¥èœå“å…³è”äº†å…¶ä»–å¥—é¤ä¸èƒ½åˆ é™¤</strong></p></blockquote><h3 id="ä»£ç å®ç°-4"><a href="#ä»£ç å®ç°-4" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><p><strong>ä¸»è¦ä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeByIdWithFlavor</span><span class="params">(Long[] ids)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">            <span class="comment">//éœ€æ³¨æ„ï¼šè‹¥è¯¥èœå“æ­£å¤„äºèµ·å”®çŠ¶æ€ä¸èƒ½åˆ é™¤ï¼Œè‹¥è¯¥èœå“å…³è”äº†å…¶ä»–å¥—é¤ä¸èƒ½åˆ é™¤</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//åˆ é™¤èœå“</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//è‹¥è¯¥èœå“æ­£å¤„äºèµ·å”®çŠ¶æ€ä¸èƒ½åˆ é™¤(æŠ›å¼‚å¸¸)</span></span><br><span class="line">            <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(id);</span><br><span class="line">            <span class="keyword">if</span> (dish.getStatus().equals(<span class="number">1</span>))&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;è¯¥èœå“æ­£å¤„äºèµ·å”®çŠ¶æ€ä¸èƒ½åˆ é™¤&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//è‹¥è¯¥èœå“å…³è”äº†å…¶ä»–å¥—é¤ä¸èƒ½åˆ é™¤ï¼ˆæŠ›å¼‚å¸¸ï¼‰</span></span><br><span class="line">            List&lt;SetmealDish&gt; list = setmealDishService.list();</span><br><span class="line">            <span class="keyword">for</span> (SetmealDish setmealDish : list) &#123;</span><br><span class="line">                <span class="keyword">if</span> (id.equals(setmealDish.getDishId()))&#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;è¯¥èœå“å…³è”äº†å…¶ä»–å¥—é¤ä¸èƒ½åˆ é™¤&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">            queryWrapper.eq(id != <span class="literal">null</span>, Dish::getId, id);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">this</span>.remove(queryWrapper);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åˆ é™¤èœå“å£å‘³</span></span><br><span class="line">            LambdaQueryWrapper&lt;DishFlavor&gt; queryWrapper1 = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            queryWrapper1.eq(DishFlavor::getDishId, id);</span><br><span class="line">            dishFlavorService.remove(queryWrapper1);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><h2 id="æ–°å¢å¥—é¤"><a href="#æ–°å¢å¥—é¤" class="headerlink" title="æ–°å¢å¥—é¤"></a>æ–°å¢å¥—é¤</h2><h3 id="éœ€æ±‚åˆ†æ-3"><a href="#éœ€æ±‚åˆ†æ-3" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><blockquote><ol><li><p>è¦è·å¾—ä¸€ä¸ªå¥—é¤åˆ†ç±»çš„ä¸‹æ‹‰åˆ—è¡¨</p></li><li><p>å°†èœå“åˆ†ç±»çš„idå°†èœå“ç»„æŸ¥è¯¢å‡ºæ¥ï¼ˆæ³¨æ„åªæŸ¥è¯¢å‡ºèµ·å”®çŠ¶æ€çš„èœå“ï¼‰</p></li><li><p>å°†å¥—é¤ä¿¡æ¯ä¿å­˜è‡³æ•°æ®åº“ä¸­ï¼ˆä¿å­˜å¥—é¤çš„åŸºæœ¬ä¿¡æ¯ï¼Œä¿å­˜å¥—é¤æ‰€åŒ…å«çš„èœå“çš„ä¿¡æ¯ï¼‰</p></li></ol></blockquote><hr><h3 id="ä»£ç å®ç°-5"><a href="#ä»£ç å®ç°-5" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><ul><li><strong>è·å¾—ä¸€ä¸ªå¥—é¤åˆ†ç±»çš„ä¸‹æ‹‰åˆ—è¡¨</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–°å¢èœå“(å¥—é¤)æ—¶ä¸‹æ‹‰èœå“ï¼ˆå¥—é¤ï¼‰åˆ†ç±»åˆ—è¡¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> category</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;List&lt;Category&gt;&gt; <span class="title function_">list</span><span class="params">(Category category)</span>&#123;</span><br><span class="line">    LambdaQueryWrapper&lt;Category&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(category.getType()!=<span class="literal">null</span>,Category::getType,category.getType());</span><br><span class="line">    queryWrapper.orderByAsc(Category::getSort).orderByDesc(Category::getUpdateTime);</span><br><span class="line">    List&lt;Category&gt; list = categoryService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ul><li><strong>å°†èœå“åˆ†ç±»çš„idå°†èœå“ç»„æŸ¥è¯¢å‡ºæ¥ï¼ˆæ³¨æ„åªæŸ¥è¯¢å‡ºèµ·å”®çŠ¶æ€çš„èœå“ï¼‰</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;List&lt;Dish&gt;&gt; <span class="title function_">list</span><span class="params">(Dish dish)</span>&#123;</span><br><span class="line">    <span class="comment">//æ„é€ æ¡ä»¶</span></span><br><span class="line">    LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    queryWrapper.eq(dish.getCategoryId()!=<span class="literal">null</span>,Dish::getCategoryId,dish.getCategoryId());</span><br><span class="line">    <span class="comment">//åªæŸ¥è¯¢èµ·å”®çš„èœå“</span></span><br><span class="line">    queryWrapper.eq(Dish::getStatus,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    queryWrapper.orderByAsc(Dish::getSort).orderByDesc(Dish::getUpdateTime);</span><br><span class="line"></span><br><span class="line">    List&lt;Dish&gt; list = dishService.list(queryWrapper);</span><br><span class="line">    <span class="keyword">return</span> R.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ul><li><strong>å°†å¥—é¤ä¿¡æ¯ä¿å­˜è‡³æ•°æ®åº“ä¸­</strong>ï¼ˆä¸»è¦ä»£ç ï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithDish</span><span class="params">(SetmealDto setmealDto)</span> &#123;</span><br><span class="line">    <span class="comment">//ä¿å­˜å¥—é¤åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">    <span class="built_in">this</span>.save(setmealDto);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¿å­˜å¥—é¤åŒ…å«çš„èœå“</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> String.valueOf(setmealDto.getId());</span><br><span class="line"></span><br><span class="line">    List&lt;SetmealDish&gt; setmealDishes = setmealDto.getSetmealDishes();</span><br><span class="line">    <span class="keyword">for</span> (SetmealDish setmealDish : setmealDishes) &#123;</span><br><span class="line">        setmealDish.setSetmealId(id);</span><br><span class="line">    &#125;</span><br><span class="line">    setmealDishService.saveBatch(setmealDishes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="å¥—é¤åˆ†é¡µå±•ç¤º"><a href="#å¥—é¤åˆ†é¡µå±•ç¤º" class="headerlink" title="å¥—é¤åˆ†é¡µå±•ç¤º"></a>å¥—é¤åˆ†é¡µå±•ç¤º</h2><h3 id="éœ€æ±‚åˆ†æ-4"><a href="#éœ€æ±‚åˆ†æ-4" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><blockquote><p><strong>ä¸èœå“çš„åˆ†é¡µå±•ç¤ºé€»è¾‘ç›¸åŒï¼Œéƒ½éœ€è¦ç‰¹åˆ«æ³¨æ„å‰ç«¯éœ€è¦çš„æ˜¯å¥—é¤çš„åç§°è€Œä¸æ˜¯<code>id</code></strong></p></blockquote><h3 id="ä»£ç å®ç°-6"><a href="#ä»£ç å®ç°-6" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page,<span class="type">int</span> pageSize,String name)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ„é€ åˆ†é¡µæ„é€ å™¨å¯¹è±¡</span></span><br><span class="line">        Page&lt;Setmeal&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page,pageSize);</span><br><span class="line">        Page&lt;SetmealDto&gt; setmealDtoPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¡ä»¶æ„é€ å™¨</span></span><br><span class="line">        LambdaQueryWrapper&lt;Setmeal&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//æ·»åŠ è¿‡æ»¤æ¡ä»¶</span></span><br><span class="line">        queryWrapper.like(name != <span class="literal">null</span>, Setmeal::getName, name);</span><br><span class="line">        <span class="comment">//æ·»åŠ æ’åºæ¡ä»¶</span></span><br><span class="line">        queryWrapper.orderByDesc(Setmeal::getUpdateTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ‰§è¡Œåˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line">        setmealService.page(pageInfo,queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¯¹è±¡æ‹·è´</span></span><br><span class="line">        BeanUtils.copyProperties(pageInfo, setmealDtoPage, <span class="string">&quot;records&quot;</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;Setmeal&gt; records = pageInfo.getRecords();</span><br><span class="line"></span><br><span class="line">        List&lt;SetmealDto&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Setmeal record : records) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">SetmealDto</span> <span class="variable">setmealDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SetmealDto</span>();</span><br><span class="line">            <span class="comment">//å¾—åˆ°åˆ†ç±»id</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">categoryId</span> <span class="operator">=</span> record.getCategoryId();</span><br><span class="line">            <span class="comment">//æ ¹æ®idå¾—åˆ°å¯¹åº”çš„åˆ†ç±»å¯¹è±¡</span></span><br><span class="line">            <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(categoryId);</span><br><span class="line">            <span class="keyword">if</span> (category != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//æ ¹æ®è¯¥å¯¹è±¡å¾—åˆ°åˆ†ç±»çš„åç§°</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">categoryName</span> <span class="operator">=</span> category.getName();</span><br><span class="line">                <span class="comment">//å°†åˆ†ç±»åç§°å­˜å…¥dishDtoå¯¹è±¡ä¸­</span></span><br><span class="line">                setmealDto.setCategoryName(categoryName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å°†å…¶ä½™å±æ€§æ‹·è´åˆ°è¯¥å¯¹è±¡ä¸­</span></span><br><span class="line">            BeanUtils.copyProperties(record, setmealDto);</span><br><span class="line"></span><br><span class="line">            list.add(setmealDto);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        setmealDtoPage.setRecords(list);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(setmealDtoPage);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="å¥—é¤çš„æ‰¹é‡èµ·å”®å’Œåœå”®"><a href="#å¥—é¤çš„æ‰¹é‡èµ·å”®å’Œåœå”®" class="headerlink" title="å¥—é¤çš„æ‰¹é‡èµ·å”®å’Œåœå”®"></a>å¥—é¤çš„æ‰¹é‡èµ·å”®å’Œåœå”®</h2><h3 id="éœ€æ±‚åˆ†æ-5"><a href="#éœ€æ±‚åˆ†æ-5" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><blockquote><p><strong>ä¸èœå“çš„æ‰¹é‡èµ·å”®å’Œåœå”®åŠŸèƒ½é€»è¾‘ç›¸åŒ</strong></p></blockquote><h3 id="ä»£ç å®ç°-7"><a href="#ä»£ç å®ç°-7" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">changeStatus</span><span class="params">(<span class="meta">@PathVariable(&quot;status&quot;)</span> Integer status, Long[] ids)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">            <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> setmealService.getById(id);</span><br><span class="line">            <span class="keyword">if</span> (setmeal != <span class="literal">null</span>) &#123;</span><br><span class="line">                setmeal.setStatus(status);</span><br><span class="line">                setmealService.updateById(setmeal);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;å¥—é¤å”®å–çŠ¶æ€ä¿®æ”¹æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ä¿®æ”¹å¥—é¤åŠŸèƒ½"><a href="#ä¿®æ”¹å¥—é¤åŠŸèƒ½" class="headerlink" title="ä¿®æ”¹å¥—é¤åŠŸèƒ½"></a>ä¿®æ”¹å¥—é¤åŠŸèƒ½</h2><h3 id="å¥—é¤ä¿¡æ¯å›æ˜¾åŠŸèƒ½"><a href="#å¥—é¤ä¿¡æ¯å›æ˜¾åŠŸèƒ½" class="headerlink" title="å¥—é¤ä¿¡æ¯å›æ˜¾åŠŸèƒ½"></a>å¥—é¤ä¿¡æ¯å›æ˜¾åŠŸèƒ½</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="comment">//ï¼ˆå¥—é¤å›æ˜¾åŠŸèƒ½ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> SetmealDto <span class="title function_">getByIdWithDish</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(id);</span><br><span class="line"></span><br><span class="line">    <span class="type">SetmealDto</span> <span class="variable">setmealDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SetmealDto</span>();</span><br><span class="line"></span><br><span class="line">    BeanUtils.copyProperties(setmeal, setmealDto);</span><br><span class="line"></span><br><span class="line">    LambdaQueryWrapper&lt;SetmealDish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(id != <span class="literal">null</span>, SetmealDish::getSetmealId, id);</span><br><span class="line">    List&lt;SetmealDish&gt; list = setmealDishService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">    setmealDto.setSetmealDishes(list);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> setmealDto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ä¿®æ”¹å¥—é¤åŠŸèƒ½-1"><a href="#ä¿®æ”¹å¥—é¤åŠŸèƒ½-1" class="headerlink" title="ä¿®æ”¹å¥—é¤åŠŸèƒ½"></a>ä¿®æ”¹å¥—é¤åŠŸèƒ½</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateWithDish</span><span class="params">(SetmealDto setmealDto)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°†å¥—é¤ä¿¡æ¯æ›´æ–°åˆ°èœå“è¡¨ä¸­</span></span><br><span class="line">    <span class="built_in">this</span>.updateById(setmealDto);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…ˆå°†å¥—é¤èœå“å…³ç³»è¡¨çš„æ•°æ®æ¸…ç©º</span></span><br><span class="line">    LambdaQueryWrapper&lt;SetmealDish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(SetmealDish::getSetmealId, setmealDto.getId());</span><br><span class="line">    setmealDishService.remove(queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å†å°†å¥—é¤èœå“å…³ç³»å¡«å…¥è¡¨ä¸­</span></span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> String.valueOf(setmealDto.getId());</span><br><span class="line"></span><br><span class="line">    List&lt;SetmealDish&gt; setmealDishes = setmealDto.getSetmealDishes();</span><br><span class="line">    <span class="keyword">for</span> (SetmealDish setmealDish : setmealDishes) &#123;</span><br><span class="line">        setmealDish.setSetmealId(id);</span><br><span class="line">    &#125;</span><br><span class="line">    setmealDishService.saveBatch(setmealDishes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="å¥—é¤çš„æ‰¹é‡åˆ é™¤"><a href="#å¥—é¤çš„æ‰¹é‡åˆ é™¤" class="headerlink" title="å¥—é¤çš„æ‰¹é‡åˆ é™¤"></a>å¥—é¤çš„æ‰¹é‡åˆ é™¤</h2><h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h3><blockquote><p><strong>å¤„äºèµ·å”®çŠ¶æ€çš„å¥—é¤ä¸èƒ½åˆ é™¤ï¼Œä¸èœå“åˆ é™¤ä¸åŒçš„æ˜¯ï¼Œåˆ é™¤å¥—é¤å¯ä¸ç”¨åˆ é™¤èœå“</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeByIdWithDish</span><span class="params">(Long[] ids)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">        <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(id);</span><br><span class="line">        <span class="keyword">if</span> (setmeal.getStatus() == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;å­˜åœ¨å¥—é¤æ­£å¤„äºèµ·å”®çŠ¶æ€ä¸èƒ½åˆ é™¤&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.removeById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><h2 id="è®¢å•æ˜ç»†"><a href="#è®¢å•æ˜ç»†" class="headerlink" title="è®¢å•æ˜ç»†"></a>è®¢å•æ˜ç»†</h2><blockquote><p>è§39.åå°æŒ‰æ¡ä»¶æŸ¥çœ‹è®¢å•</p></blockquote><h2 id="ç§»åŠ¨ç«¯çŸ­ä¿¡éªŒè¯ç™»å½•ï¼ˆç™»å‡ºï¼‰"><a href="#ç§»åŠ¨ç«¯çŸ­ä¿¡éªŒè¯ç™»å½•ï¼ˆç™»å‡ºï¼‰" class="headerlink" title="ç§»åŠ¨ç«¯çŸ­ä¿¡éªŒè¯ç™»å½•ï¼ˆç™»å‡ºï¼‰"></a>ç§»åŠ¨ç«¯çŸ­ä¿¡éªŒè¯ç™»å½•ï¼ˆç™»å‡ºï¼‰</h2><h3 id="è·å–éªŒè¯ç "><a href="#è·å–éªŒè¯ç " class="headerlink" title="è·å–éªŒè¯ç "></a>è·å–éªŒè¯ç </h3><ul><li>å¯¼å…¥mavenåæ ‡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.aliyun&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;aliyun-java-sdk-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">4.5</span><span class="number">.16</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.aliyun&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;aliyun-java-sdk-dysmsapi&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.1</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><hr><ul><li>ä¿®æ”¹<code>LoginCheckFilter</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰ä¸éœ€è¦å¤„ç†çš„è¯·æ±‚è·¯å¾„</span></span><br><span class="line">String[] urls = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;</span><br><span class="line">        <span class="string">&quot;/employee/login&quot;</span>,</span><br><span class="line">        <span class="string">&quot;/employee/logout&quot;</span>,</span><br><span class="line">        <span class="string">&quot;/backend/**&quot;</span>,</span><br><span class="line">        <span class="string">&quot;/front/**&quot;</span>,</span><br><span class="line">        <span class="string">&quot;/user/sendMsg&quot;</span>,</span><br><span class="line">        <span class="string">&quot;/user/login&quot;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><hr><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//4-2ã€åˆ¤æ–­ç™»å½•çŠ¶æ€ï¼Œå¦‚æœå·²ç™»å½•ï¼Œåˆ™ç›´æ¥æ”¾è¡Œ</span></span><br><span class="line"><span class="keyword">if</span> (request.getSession().getAttribute(<span class="string">&quot;user&quot;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">    log.info(<span class="string">&quot;ç”¨æˆ·å·²ç™»å½•ï¼Œç”¨æˆ·idä¸ºï¼š&#123;&#125;&quot;</span>, request.getSession().getAttribute(<span class="string">&quot;user&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> (Long) request.getSession().getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    BaseContext.setCurrentId(userId);</span><br><span class="line">    filterChain.doFilter(request, response);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ul><li>è·å–éªŒè¯ç </li></ul><blockquote><p><strong>æ³¨æ„ï¼šæ­¤å¤„å› ä¸ºæ²¡æœ‰é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡çš„ç­¾åï¼Œæ‰€ä»¥çœŸå®å‘é€çŸ­ä¿¡çš„æ­¥éª¤å°±æ³¨é‡Šäº†ï¼Œä½†ç”Ÿæˆçš„éªŒè¯ç å¯åœ¨æ§åˆ¶å°é€šè¿‡æ—¥å¿—çš„å½¢å¼æŸ¥çœ‹ã€‚</strong></p><ol><li><p>è·å–æ‰‹æœºå·</p></li><li><p>ç”Ÿæˆéšæœºçš„å››ä½éªŒè¯ç </p></li><li><p>è°ƒç”¨é˜¿é‡Œäº‘çš„çŸ­ä¿¡æœåŠ¡APIå‘é€çŸ­ä¿¡ï¼ˆå·²æ³¨é‡Šï¼‰</p></li><li><p>å°†éªŒè¯ç å­˜å…¥Session</p></li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/sendMsg&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@RequestBody</span> User user, HttpSession session)</span> &#123;</span><br><span class="line">    <span class="comment">//è·å–æ‰‹æœºå·</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> user.getPhone();</span><br><span class="line">    <span class="keyword">if</span> (phone != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//ç”Ÿæˆéšæœºçš„å››ä½éªŒè¯ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> String.valueOf(ValidateCodeUtils.generateValidateCode(<span class="number">4</span>));</span><br><span class="line">        log.info(<span class="string">&quot;code=&#123;&#125;&quot;</span>, code);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è°ƒç”¨é˜¿é‡Œäº‘çš„çŸ­ä¿¡æœåŠ¡APIå‘é€çŸ­ä¿¡</span></span><br><span class="line">        <span class="comment">//SMSUtils.sendMessage(&quot;ç‘å‰å¤–å–&quot;,&quot;&quot;,phone,code);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//å°†éªŒè¯ç å­˜å…¥Session</span></span><br><span class="line">        session.setAttribute(phone, code);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;çŸ­ä¿¡éªŒè¯ç å‘é€æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.error(<span class="string">&quot;çŸ­ä¿¡éªŒè¯ç å‘é€å¤±è´¥&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ç™»å½•ç§»åŠ¨ç«¯"><a href="#ç™»å½•ç§»åŠ¨ç«¯" class="headerlink" title="ç™»å½•ç§»åŠ¨ç«¯"></a>ç™»å½•ç§»åŠ¨ç«¯</h3><ul><li><strong>å…·ä½“æµç¨‹</strong></li></ul><blockquote><ol><li><p>è·å–å‰ç«¯å‘é€è¿‡æ¥çš„æ‰‹æœºå·</p></li><li><p>è·å–å‰ç«¯å‘é€è¿‡æ¥çš„éªŒè¯ç </p></li><li><p>ä»sessionä¸­å–å‡ºç”Ÿæˆçš„éªŒè¯ç </p></li><li><p>å¦‚æœèƒ½æ¯”å¯¹æˆåŠŸï¼Œè¯æ˜ç™»å½•æˆåŠŸ</p></li><li><p>æ ¹æ®æ‰‹æœºå·åˆ¤æ–­æ˜¯å¦ä¸ºæ–°ç”¨æˆ·ï¼Œè‹¥æ˜¯æ–°ç”¨æˆ·åˆ™è‡ªåŠ¨æ³¨å†Œ</p></li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;User&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> Map map, HttpSession session)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–æ‰‹æœºå·</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> map.get(<span class="string">&quot;phone&quot;</span>).toString();</span><br><span class="line">    <span class="comment">//è·å–éªŒè¯ç </span></span><br><span class="line">    <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> map.get(<span class="string">&quot;code&quot;</span>).toString();</span><br><span class="line">    <span class="comment">//ä»sessionä¸­å–å‡ºç”Ÿæˆçš„éªŒè¯ç </span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">codeInSession</span> <span class="operator">=</span> session.getAttribute(phone);</span><br><span class="line">    <span class="comment">//æ¯”å¯¹éªŒè¯ç æ˜¯å¦ç›¸åŒ</span></span><br><span class="line">    <span class="keyword">if</span> (codeInSession != <span class="literal">null</span> &amp;&amp; codeInSession.equals(code)) &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœèƒ½æ¯”å¯¹æˆåŠŸï¼Œè¯æ˜ç™»å½•æˆåŠŸ</span></span><br><span class="line"></span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(phone != <span class="literal">null</span>, User::getPhone, phone);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getOne(queryWrapper);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//æ ¹æ®æ‰‹æœºå·åˆ¤æ–­æ˜¯å¦ä¸ºæ–°ç”¨æˆ·ï¼Œè‹¥æ˜¯æ–°ç”¨æˆ·åˆ™è‡ªåŠ¨æ³¨å†Œ</span></span><br><span class="line">            user = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">            user.setPhone(phone);</span><br><span class="line">            userService.save(user);</span><br><span class="line">        &#125;</span><br><span class="line">        session.setAttribute(<span class="string">&quot;user&quot;</span>, user.getId());</span><br><span class="line">        <span class="keyword">return</span> R.success(user);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.error(<span class="string">&quot;ç™»å½•å¤±è´¥&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ç™»å‡ºç§»åŠ¨ç«¯"><a href="#ç™»å‡ºç§»åŠ¨ç«¯" class="headerlink" title="ç™»å‡ºç§»åŠ¨ç«¯"></a>ç™»å‡ºç§»åŠ¨ç«¯</h3><blockquote><p>æ³¨æ„è¦é‡Šæ”¾session</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/loginout&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">loginout</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">    <span class="comment">//é‡Šæ”¾session</span></span><br><span class="line">    request.getSession().removeAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;é€€å‡ºæˆåŠŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="æ–°å¢åœ°å€"><a href="#æ–°å¢åœ°å€" class="headerlink" title="æ–°å¢åœ°å€"></a>æ–°å¢åœ°å€</h2><h3 id="éœ€æ±‚åˆ†æ-6"><a href="#éœ€æ±‚åˆ†æ-6" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><blockquote><p><strong>æ³¨æ„ï¼šè¦è®¾ç½®åœ°å€å¯¹åº”çš„ç”¨æˆ·<code>id</code></strong></p></blockquote><h3 id="ä»£ç å®ç°-8"><a href="#ä»£ç å®ç°-8" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> AddressBook addressBook)</span>&#123;</span><br><span class="line">    addressBook.setUserId(BaseContext.getCurrentId());</span><br><span class="line">    addressBookService.save(addressBook);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;æ–°å¢åœ°å€æˆåŠŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="åœ°å€åˆ—è¡¨æ˜¾ç¤º"><a href="#åœ°å€åˆ—è¡¨æ˜¾ç¤º" class="headerlink" title="åœ°å€åˆ—è¡¨æ˜¾ç¤º"></a>åœ°å€åˆ—è¡¨æ˜¾ç¤º</h2><h3 id="éœ€æ±‚åˆ†æ-7"><a href="#éœ€æ±‚åˆ†æ-7" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><blockquote><p>å°†å½“å‰ç™»å½•ç”¨æˆ·çš„æ‰€æœ‰åœ°å€æ˜¾ç¤ºä¸ºåˆ—è¡¨å±•ç¤ºåˆ°ç§»åŠ¨ç«¯é¡µé¢</p><p><strong>æ³¨æ„ï¼šè¦è®¾ç½®åœ°å€å¯¹åº”çš„ç”¨æˆ·<code>id</code></strong></p></blockquote><hr><h3 id="ä»£ç å®ç°-9"><a href="#ä»£ç å®ç°-9" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;List&lt;AddressBook&gt;&gt; <span class="title function_">list</span><span class="params">(AddressBook addressBook)</span> &#123;</span><br><span class="line">    <span class="comment">//è®¾ç½®åœ°å€å¯¹åº”çš„ç”¨æˆ·id</span></span><br><span class="line">    addressBook.setUserId(BaseContext.getCurrentId());</span><br><span class="line">    LambdaQueryWrapper&lt;AddressBook&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(addressBook.getUserId() != <span class="literal">null</span>, AddressBook::getUserId, addressBook.getUserId());</span><br><span class="line">    queryWrapper.orderByDesc(AddressBook::getUpdateTime);</span><br><span class="line">    List&lt;AddressBook&gt; list = addressBookService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="è®¾ç½®é»˜è®¤åœ°å€"><a href="#è®¾ç½®é»˜è®¤åœ°å€" class="headerlink" title="è®¾ç½®é»˜è®¤åœ°å€"></a>è®¾ç½®é»˜è®¤åœ°å€</h2><h3 id="éœ€æ±‚åˆ†æ-8"><a href="#éœ€æ±‚åˆ†æ-8" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><blockquote><ol><li><p>å…ˆæŠŠè¯¥ç”¨æˆ·çš„æ‰€æœ‰åœ°å€éƒ½ä¸è®¾ç½®ä¸ºé»˜è®¤åœ°å€ï¼ˆæ•…æŠŠæ‰€æœ‰è¯¥ç”¨æˆ·çš„<code>is_default</code>å­—æ®µéƒ½è®¾ç½®ä¸º0ï¼‰</p></li><li><p>è®¾ç½®è¯¥ç”¨æˆ·æ‰€é€‰æ‹©çš„åœ°å€ä¸ºé»˜è®¤åœ°å€</p></li></ol></blockquote><hr><h3 id="ä»£ç å®ç°-10"><a href="#ä»£ç å®ç°-10" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@PutMapping(&quot;/default&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;AddressBook&gt; <span class="title function_">setDefault</span><span class="params">(<span class="meta">@RequestBody</span> AddressBook addressBook)</span> &#123;</span><br><span class="line">        <span class="comment">//å°†è¯¥ç”¨æˆ·çš„æ‰€æœ‰åœ°å€éƒ½ä¸è®¾ç½®ä¸ºé»˜è®¤åœ°å€</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">        LambdaUpdateWrapper&lt;AddressBook&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">        updateWrapper.eq(userId != <span class="literal">null</span>, AddressBook::getUserId, userId);</span><br><span class="line">        updateWrapper.set(AddressBook::getIsDefault, <span class="number">0</span>);</span><br><span class="line">        addressBookService.update(updateWrapper);</span><br><span class="line">        <span class="comment">//å°†é€‰æ‹©çš„è¯¥ç”¨æˆ·çš„åœ°å€è®¾ç½®ä¸ºé»˜è®¤å€¼</span></span><br><span class="line">        addressBook.setIsDefault(<span class="number">1</span>);</span><br><span class="line">        addressBookService.updateById(addressBook);</span><br><span class="line">        <span class="keyword">return</span> R.success(addressBook);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="æŸ¥è¯¢ç”¨æˆ·çš„é»˜è®¤åœ°å€"><a href="#æŸ¥è¯¢ç”¨æˆ·çš„é»˜è®¤åœ°å€" class="headerlink" title="æŸ¥è¯¢ç”¨æˆ·çš„é»˜è®¤åœ°å€"></a>æŸ¥è¯¢ç”¨æˆ·çš„é»˜è®¤åœ°å€</h2><h3 id="ä»£ç å®ç°-11"><a href="#ä»£ç å®ç°-11" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/default&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;AddressBook&gt; <span class="title function_">getDefault</span><span class="params">()</span> &#123;</span><br><span class="line">    LambdaQueryWrapper&lt;AddressBook&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(AddressBook::getUserId, BaseContext.getCurrentId());</span><br><span class="line">    queryWrapper.eq(AddressBook::getIsDefault, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//SQL:select * from address_book where user_id = ? and is_default = 1</span></span><br><span class="line">    <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookService.getOne(queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> == addressBook) &#123;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;æ²¡æœ‰æ‰¾åˆ°è¯¥å¯¹è±¡&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.success(addressBook);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ä¿®æ”¹åœ°å€ï¼ˆéœ€ä¿®æ”¹ï¼‰"><a href="#ä¿®æ”¹åœ°å€ï¼ˆéœ€ä¿®æ”¹ï¼‰" class="headerlink" title="ä¿®æ”¹åœ°å€ï¼ˆéœ€ä¿®æ”¹ï¼‰"></a>ä¿®æ”¹åœ°å€ï¼ˆéœ€ä¿®æ”¹ï¼‰</h2><h3 id="åœ°å€çš„å›æ˜¾åŠŸèƒ½"><a href="#åœ°å€çš„å›æ˜¾åŠŸèƒ½" class="headerlink" title="åœ°å€çš„å›æ˜¾åŠŸèƒ½"></a>åœ°å€çš„å›æ˜¾åŠŸèƒ½</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;AddressBook&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookService.getById(id);</span><br><span class="line">    <span class="keyword">if</span> (addressBook != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> R.success(addressBook);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.error(<span class="string">&quot;æ²¡æœ‰æŸ¥è¯¢åˆ°è¯¥ç”¨æˆ·åœ°å€&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ä¿®æ”¹åœ°å€åŠŸèƒ½"><a href="#ä¿®æ”¹åœ°å€åŠŸèƒ½" class="headerlink" title="ä¿®æ”¹åœ°å€åŠŸèƒ½"></a>ä¿®æ”¹åœ°å€åŠŸèƒ½</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> AddressBook addressBook)</span> &#123;</span><br><span class="line">    addressBookService.updateById(addressBook);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;ä¿®æ”¹æ”¶è´§åœ°å€æˆåŠŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="åˆ é™¤åœ°å€"><a href="#åˆ é™¤åœ°å€" class="headerlink" title="åˆ é™¤åœ°å€"></a>åˆ é™¤åœ°å€</h2><h3 id="éœ€æ±‚åˆ†æ-9"><a href="#éœ€æ±‚åˆ†æ-9" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><blockquote><p>æ­¤å¤„æ— è¿‡å¤šçš„é€»è¾‘åˆ†æï¼Œå³ä½¿æ˜¯é»˜è®¤åœ°å€ä¹Ÿå¯ä»¥è¿›è¡Œåˆ é™¤ã€‚</p></blockquote><hr><h3 id="ä»£ç å®ç°-12"><a href="#ä»£ç å®ç°-12" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">delete</span><span class="params">(Long ids)</span> &#123;</span><br><span class="line">    addressBookService.removeById(ids);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;åˆ é™¤æ”¶è´§åœ°å€æˆåŠŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ç§»åŠ¨ç«¯ä¸»é¡µå±•ç¤ºï¼ˆèœå“ã€å¥—é¤ï¼‰"><a href="#ç§»åŠ¨ç«¯ä¸»é¡µå±•ç¤ºï¼ˆèœå“ã€å¥—é¤ï¼‰" class="headerlink" title="ç§»åŠ¨ç«¯ä¸»é¡µå±•ç¤ºï¼ˆèœå“ã€å¥—é¤ï¼‰"></a>ç§»åŠ¨ç«¯ä¸»é¡µå±•ç¤ºï¼ˆèœå“ã€å¥—é¤ï¼‰</h2><h3 id="æ³¨æ„ç‚¹-1"><a href="#æ³¨æ„ç‚¹-1" class="headerlink" title="æ³¨æ„ç‚¹"></a><strong>æ³¨æ„ç‚¹</strong></h3><blockquote><ol><li><p>èœå“ï¼Œå¥—é¤çš„åˆ†ç±»åŠŸèƒ½åœ¨å‰é¢å·²ç»å†™è¿‡äº†ã€‚ç§»åŠ¨ç«¯å±•ç¤ºä¸»é¡µé¢éœ€è¦è¯¥åˆ†ç±»åŠŸèƒ½å’Œè´­ç‰©è½¦å±•ç¤ºåŠŸèƒ½åŒæ—¶æˆåŠŸæ‰èƒ½å±•ç¤ºå‡ºæ¥ã€‚</p></li><li><p>ç‚¹å‡»å¯¹åº”çš„èœå“åˆ†ç±»å¯æŸ¥è¯¢å‡ºè¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰èœå“ï¼Œæ³¨æ„è¯¥æ–¹æ³•å·²ç»åœ¨ä¹‹å‰æ–°å¢å¥—é¤æ—¶çš„åŠŸèƒ½2ä¸­ç¼–å†™ï¼Œä½†æ˜¯å½“æ—¶åªæ˜¯è®©<code>DishDto</code>å¯¹è±¡ä¸­æ–°ä¿å­˜äº†èœå“çš„åç§°ï¼Œæ²¡æœ‰ä¿å­˜èœå“çš„å£å‘³ï¼Œæ•…éœ€è¦å¯¹è¯¥æ–¹æ³•è¿›è¡ŒåŠ å¼ºã€‚</p></li><li><p>ç‚¹å‡»å¯¹åº”çš„å¥—é¤åˆ†ç±»å¯æŸ¥è¯¢å‡ºè¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰å¥—é¤ï¼Œéœ€è¦æ·»åŠ è¯¥æ–¹æ³•ã€‚</p></li></ol></blockquote><hr><h3 id="é‡æ–°ç¼–å†™æŸ¥è¯¢å½“å‰åˆ†ç±»ä¸‹çš„æ‰€æœ‰èœå“åŠŸèƒ½"><a href="#é‡æ–°ç¼–å†™æŸ¥è¯¢å½“å‰åˆ†ç±»ä¸‹çš„æ‰€æœ‰èœå“åŠŸèƒ½" class="headerlink" title="é‡æ–°ç¼–å†™æŸ¥è¯¢å½“å‰åˆ†ç±»ä¸‹çš„æ‰€æœ‰èœå“åŠŸèƒ½"></a>é‡æ–°ç¼–å†™æŸ¥è¯¢å½“å‰åˆ†ç±»ä¸‹çš„æ‰€æœ‰èœå“åŠŸèƒ½</h3><blockquote><p><strong>æ³¨æ„ï¼šåªæ˜¯æ–°å¢äº†èœå“å£å‘³çš„åŠŸèƒ½ï¼Œä¸å½±å“å‰é¢ä½¿ç”¨çš„åŠŸèƒ½ï¼ˆä»…ä»…æ˜¯å¯¹åŠŸèƒ½åŠ å¼ºï¼‰</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;List&lt;DishDto&gt;&gt; <span class="title function_">list</span><span class="params">(Dish dish)</span> &#123;</span><br><span class="line">    <span class="comment">//æ„é€ æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line">    LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(dish.getCategoryId() != <span class="literal">null</span>, Dish::getCategoryId, dish.getCategoryId());</span><br><span class="line">    <span class="comment">//æ·»åŠ æ¡ä»¶ï¼ŒæŸ¥è¯¢çŠ¶æ€ä¸º1ï¼ˆèµ·å”®çŠ¶æ€ï¼‰çš„èœå“</span></span><br><span class="line">    queryWrapper.eq(Dish::getStatus, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ·»åŠ æ’åºæ¡ä»¶</span></span><br><span class="line">    queryWrapper.orderByAsc(Dish::getSort).orderByDesc(Dish::getUpdateTime);</span><br><span class="line"></span><br><span class="line">    List&lt;Dish&gt; list = dishService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">    List&lt;DishDto&gt; dishDtoList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Dish dish1 : list) &#123;</span><br><span class="line">        <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line">        BeanUtils.copyProperties(dish1, dishDto);</span><br><span class="line">        <span class="comment">//è·å¾—èœå“åˆ†ç±»çš„id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">categoryId</span> <span class="operator">=</span> dish1.getCategoryId();</span><br><span class="line">        <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(categoryId);</span><br><span class="line">        <span class="comment">//æ ¹æ®idæŸ¥è¯¢åˆ†ç±»å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">if</span> (category != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">categoryName</span> <span class="operator">=</span> category.getName();</span><br><span class="line">            dishDto.setCategoryName(categoryName);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è·å–å½“å‰èœå“çš„id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> dish1.getId();</span><br><span class="line">        LambdaQueryWrapper&lt;DishFlavor&gt; queryWrapper1 = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper1.eq(DishFlavor::getDishId,dishId);</span><br><span class="line">        List&lt;DishFlavor&gt; list1 = dishFlavorService.list(queryWrapper1);</span><br><span class="line">        dishDto.setFlavors(list1);</span><br><span class="line"></span><br><span class="line">        dishDtoList.add(dishDto);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(dishDtoList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ç¼–å†™æŸ¥è¯¢å½“å‰åˆ†ç±»ä¸‹çš„æ‰€æœ‰å¥—é¤åŠŸèƒ½"><a href="#ç¼–å†™æŸ¥è¯¢å½“å‰åˆ†ç±»ä¸‹çš„æ‰€æœ‰å¥—é¤åŠŸèƒ½" class="headerlink" title="ç¼–å†™æŸ¥è¯¢å½“å‰åˆ†ç±»ä¸‹çš„æ‰€æœ‰å¥—é¤åŠŸèƒ½"></a>ç¼–å†™æŸ¥è¯¢å½“å‰åˆ†ç±»ä¸‹çš„æ‰€æœ‰å¥—é¤åŠŸèƒ½</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;List&lt;Setmeal&gt;&gt; <span class="title function_">list</span><span class="params">(Setmeal setmeal)</span> &#123;</span><br><span class="line">    LambdaQueryWrapper&lt;Setmeal&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(setmeal.getCategoryId() != <span class="literal">null</span>, Setmeal::getCategoryId, setmeal.getCategoryId());</span><br><span class="line">    queryWrapper.eq(setmeal.getStatus() != <span class="literal">null</span>, Setmeal::getStatus, setmeal.getStatus());</span><br><span class="line">    queryWrapper.orderByDesc(Setmeal::getUpdateTime);</span><br><span class="line"></span><br><span class="line">    List&lt;Setmeal&gt; list = setmealService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="æ·»åŠ è´­ç‰©è½¦"><a href="#æ·»åŠ è´­ç‰©è½¦" class="headerlink" title="æ·»åŠ è´­ç‰©è½¦"></a>æ·»åŠ è´­ç‰©è½¦</h2><h3 id="éœ€æ±‚åˆ†æ-10"><a href="#éœ€æ±‚åˆ†æ-10" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><blockquote><ol><li><p>è®¾ç½®å½“å‰è´­ç‰©è½¦æ˜¯å“ªä¸ªç”¨æˆ·çš„</p></li><li><p>åˆ¤æ–­æ·»åŠ çš„æ˜¯èœå“è¿˜æ˜¯å¥—é¤</p></li><li><p>å¦‚æœèƒ½æŸ¥æ‰¾å‡ºæ¥å¯¹åº”çš„ç¬¦åˆè¯¥ç”¨æˆ·ä¸”ç¬¦åˆè¯¥èœå“ï¼ˆå¥—é¤ï¼‰è¿™ä¸¤ä¸ªæ¡ä»¶çš„è´­ç‰©è½¦å¯¹è±¡ï¼Œåˆ™åœ¨æ•°é‡ä¸ŠåŠ ä¸€</p></li><li><p>å¦‚æœæŸ¥è¯¢ä¸å‡ºæ¥ï¼Œåˆ™æ–°å¢è¯¥è´­ç‰©è½¦å¯¹è±¡ï¼Œå¹¶è®¾ç½®æ•°é‡ä¸º1,ä¸”è®¾ç½®åˆ›å»ºæ—¶é—´</p></li></ol></blockquote><hr><h3 id="ä»£ç å®ç°-13"><a href="#ä»£ç å®ç°-13" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/add&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;ShoppingCart&gt; <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> ShoppingCart shoppingCart)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;è´­ç‰©è½¦æ•°æ®ï¼š&#123;&#125;&quot;</span>, shoppingCart);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¾ç½®å½“å‰è´­ç‰©è½¦æ˜¯å“ªä¸ªç”¨æˆ·çš„</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">    shoppingCart.setUserId(userId);</span><br><span class="line"></span><br><span class="line">    LambdaQueryWrapper&lt;ShoppingCart&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(ShoppingCart::getUserId, userId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ·»åŠ çš„æ˜¯èœå“è¿˜æ˜¯å¥—é¤</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> shoppingCart.getDishId();</span><br><span class="line">    <span class="keyword">if</span> (dishId != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//æ·»åŠ çš„æ˜¯èœå“</span></span><br><span class="line">        queryWrapper.eq(ShoppingCart::getDishId, dishId);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//æ·»åŠ çš„æ˜¯å¥—é¤</span></span><br><span class="line">        queryWrapper.eq(ShoppingCart::getSetmealId, shoppingCart.getSetmealId());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ShoppingCart</span> <span class="variable">shoppingCartOne</span> <span class="operator">=</span> shoppingCartService.getOne(queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (shoppingCartOne != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœå­˜åœ¨è¯¥å¯¹è±¡ï¼Œåˆ™æ•°é‡åŠ ä¸€</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">number</span> <span class="operator">=</span> shoppingCartOne.getNumber();</span><br><span class="line">        shoppingCartOne.setNumber(number + <span class="number">1</span>);</span><br><span class="line">        shoppingCartService.updateById(shoppingCartOne);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœä¸å­˜åœ¨è¯¥å¯¹è±¡ï¼Œåˆ™æ–°å¢è¯¥è´­ç‰©è½¦å¯¹è±¡ï¼Œå¹¶è®¾ç½®æ•°é‡ä¸º1,ä¸”è®¾ç½®åˆ›å»ºæ—¶é—´</span></span><br><span class="line">        shoppingCart.setNumber(<span class="number">1</span>);</span><br><span class="line">        shoppingCart.setCreateTime(LocalDateTime.now());</span><br><span class="line">        shoppingCartService.save(shoppingCart);</span><br><span class="line">        shoppingCartOne = shoppingCart;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.success(shoppingCartOne);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><h2 id="æŸ¥çœ‹è´­ç‰©è½¦"><a href="#æŸ¥çœ‹è´­ç‰©è½¦" class="headerlink" title="æŸ¥çœ‹è´­ç‰©è½¦"></a>æŸ¥çœ‹è´­ç‰©è½¦</h2><h3 id="éœ€æ±‚åˆ†æ-11"><a href="#éœ€æ±‚åˆ†æ-11" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><blockquote><p>æ ¹æ®æ¯ä¸ªç”¨æˆ·çš„<code>id</code>æ¥æŸ¥ï¼Œæ¯ä¸ªç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±çš„è´­ç‰©è½¦</p></blockquote><hr><h3 id="ä»£ç å®ç°-14"><a href="#ä»£ç å®ç°-14" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;List&lt;ShoppingCart&gt;&gt; <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">    LambdaQueryWrapper&lt;ShoppingCart&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(userId != <span class="literal">null</span>, ShoppingCart::getUserId, userId);</span><br><span class="line">    queryWrapper.orderByAsc(ShoppingCart::getCreateTime);</span><br><span class="line">    List&lt;ShoppingCart&gt; list = shoppingCartService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="æ¸…ç©ºè´­ç‰©è½¦"><a href="#æ¸…ç©ºè´­ç‰©è½¦" class="headerlink" title="æ¸…ç©ºè´­ç‰©è½¦"></a>æ¸…ç©ºè´­ç‰©è½¦</h2><h3 id="éœ€æ±‚åˆ†æ-12"><a href="#éœ€æ±‚åˆ†æ-12" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><blockquote><p>æ³¨æ„ï¼šä»…åˆ é™¤è¯¥ç”¨æˆ·çš„æ‰€æœ‰è´­ç‰©è½¦æ•°æ®</p></blockquote><hr><h3 id="ä»£ç å®ç°-15"><a href="#ä»£ç å®ç°-15" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/clean&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">clean</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">    LambdaQueryWrapper&lt;ShoppingCart&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(userId != <span class="literal">null</span>, ShoppingCart::getUserId, userId);</span><br><span class="line">    shoppingCartService.remove(queryWrapper);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;æ¸…ç©ºè´­ç‰©è½¦æˆåŠŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="åˆ å‡è´­ç‰©è½¦"><a href="#åˆ å‡è´­ç‰©è½¦" class="headerlink" title="åˆ å‡è´­ç‰©è½¦"></a>åˆ å‡è´­ç‰©è½¦</h2><h3 id="éœ€æ±‚åˆ†æ-13"><a href="#éœ€æ±‚åˆ†æ-13" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><blockquote><ol><li><p>è®¾ç½®å½“å‰è´­ç‰©è½¦æ˜¯å“ªä¸ªç”¨æˆ·çš„</p></li><li><p>åˆ¤æ–­åˆ å‡çš„æ˜¯èœå“è¿˜æ˜¯å¥—é¤ï¼ˆå› ä¸ºå‰ç«¯å‘é€è¿‡æ¥çš„æ•°æ®è¦ä¹ˆä¸º<code>DishId</code>ï¼Œè¦ä¹ˆä¸º<code>SetmealId</code>ï¼‰</p></li><li><p>åˆ¤æ–­è¦åˆ å‡çš„è¯¥å¯¹è±¡çš„æ•°é‡æ˜¯å¦ä¸º1</p></li><li><p>è‹¥ä¸º1ï¼Œåˆ™åˆ é™¤è¯¥æ•°æ®</p></li><li><p>è‹¥ä¸ä¸º1ï¼Œåˆ™å°†æ•°é‡å‡ä¸€</p></li></ol></blockquote><hr><h3 id="ä»£ç å®ç°-16"><a href="#ä»£ç å®ç°-16" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/sub&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">sub</span><span class="params">(<span class="meta">@RequestBody</span> ShoppingCart shoppingCart)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;æ•°æ®ï¼š&#123;&#125;&quot;</span>, shoppingCart);</span><br><span class="line">    <span class="comment">//è®¾ç½®å½“å‰è´­ç‰©è½¦æ˜¯å“ªä¸ªç”¨æˆ·çš„</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">    shoppingCart.setUserId(userId);</span><br><span class="line">    LambdaQueryWrapper&lt;ShoppingCart&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(ShoppingCart::getUserId, userId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ¤æ–­åˆ å‡çš„æ˜¯èœå“è¿˜æ˜¯å¥—é¤</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> shoppingCart.getDishId();</span><br><span class="line">    <span class="keyword">if</span> (dishId != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//åˆ å‡çš„æ˜¯èœå“</span></span><br><span class="line">        queryWrapper.eq(ShoppingCart::getDishId, dishId);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ å‡çš„æ˜¯å¥—é¤</span></span><br><span class="line">        queryWrapper.eq(ShoppingCart::getSetmealId, shoppingCart.getSetmealId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">ShoppingCart</span> <span class="variable">shoppingCartOne</span> <span class="operator">=</span> shoppingCartService.getOne(queryWrapper);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">number</span> <span class="operator">=</span> shoppingCartOne.getNumber();</span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ•°é‡æ˜¯å¦ä¸º1æˆ–å¤§äº1</span></span><br><span class="line">    <span class="keyword">if</span> (number == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">//æ•°é‡ä¸º1åˆ™åˆ é™¤è¯¥è¯¥èœå“ï¼ˆå¥—é¤ï¼‰ä¿¡æ¯</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> shoppingCartOne.getId();</span><br><span class="line">        shoppingCartService.removeById(id);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//æ•°é‡ä¸ä¸º1åˆ™è¯¥èœå“ï¼ˆå¥—é¤ï¼‰æ•°é‡å‡1</span></span><br><span class="line">        shoppingCartOne.setNumber(number - <span class="number">1</span>);</span><br><span class="line">        shoppingCartService.updateById(shoppingCartOne);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;åˆ å‡å•†å“æˆåŠŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ä¸‹å•"><a href="#ä¸‹å•" class="headerlink" title="ä¸‹å•"></a>ä¸‹å•</h2><h3 id="éœ€æ±‚åˆ†æ-14"><a href="#éœ€æ±‚åˆ†æ-14" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><blockquote><p><strong>å‰æ</strong>ï¼šç‚¹å‡»å»æ”¯ä»˜å</p><ol><li><p>å‰ç«¯é¡µé¢è‡ªåŠ¨è®¿é—®æŸ¥è¯¢é»˜è®¤åœ°å€åŠŸèƒ½ï¼ˆå‰é¢å·²å†™å¥½ï¼‰</p></li><li><p>å‰ç«¯é¡µé¢è‡ªåŠ¨è®¿é—®æŸ¥è¯¢è´­ç‰©è½¦ä¿¡æ¯åŠŸèƒ½ï¼ˆå‰é¢å·²å†™å¥½ï¼‰</p></li></ol></blockquote><blockquote><p><strong>å…·ä½“æ­¥éª¤</strong>ï¼š</p><ol><li><p>è·å¾—å½“å‰ç”¨æˆ·id</p></li><li><p>æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„è´­ç‰©è½¦æ•°æ®</p></li><li><p>è‹¥è´­ç‰©è½¦ä¸ºç©ºï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</p></li><li><p>æŸ¥è¯¢ç”¨æˆ·æ•°æ®</p></li><li><p>æŸ¥è¯¢åœ°å€æ•°æ®</p></li><li><p>å°è£…è®¢å•è¡¨æ•°æ®ï¼ˆ1æ¡ï¼‰</p></li><li><p>å°è£…è®¢å•æ˜ç»†è¡¨æ•°æ®ï¼ˆå¤šæ¡ï¼šåŸè´­ç‰©è½¦æœ‰å‡ æ¡æ•°æ®è¿™é‡Œå°±æœ‰å‡ æ¡ï¼‰</p></li><li><p>å‘è®¢å•è¡¨æ’å…¥æ•°æ®ï¼Œä¸€æ¡æ•°æ®</p></li><li><p>å‘è®¢å•æ˜ç»†è¡¨æ’å…¥æ•°æ®ï¼Œå¤šæ¡æ•°æ®</p></li><li><p>æ¸…ç©ºè´­ç‰©è½¦æ•°æ®</p></li></ol></blockquote><hr><h3 id="ä»£ç å®ç°-17"><a href="#ä»£ç å®ç°-17" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">submit</span><span class="params">(Orders orders)</span> &#123;</span><br><span class="line">    <span class="comment">//è·å¾—å½“å‰ç”¨æˆ·id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„è´­ç‰©è½¦æ•°æ®</span></span><br><span class="line">    LambdaQueryWrapper&lt;ShoppingCart&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper.eq(ShoppingCart::getUserId,userId);</span><br><span class="line">    List&lt;ShoppingCart&gt; shoppingCarts = shoppingCartService.list(wrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(shoppingCarts == <span class="literal">null</span> || shoppingCarts.size() == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;è´­ç‰©è½¦ä¸ºç©ºï¼Œä¸èƒ½ä¸‹å•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŸ¥è¯¢ç”¨æˆ·æ•°æ®</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(userId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŸ¥è¯¢åœ°å€æ•°æ®</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">addressBookId</span> <span class="operator">=</span> orders.getAddressBookId();</span><br><span class="line">    <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookService.getById(addressBookId);</span><br><span class="line">    <span class="keyword">if</span>(addressBook == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;ç”¨æˆ·åœ°å€ä¿¡æ¯æœ‰è¯¯ï¼Œä¸èƒ½ä¸‹å•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> IdWorker.getId();<span class="comment">//è®¢å•å·</span></span><br><span class="line"></span><br><span class="line">    <span class="type">AtomicInteger</span> <span class="variable">amount</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    List&lt;OrderDetail&gt; orderDetails = shoppingCarts.stream().map((item) -&gt; &#123;</span><br><span class="line">        <span class="type">OrderDetail</span> <span class="variable">orderDetail</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderDetail</span>();</span><br><span class="line">        orderDetail.setOrderId(orderId);</span><br><span class="line">        orderDetail.setNumber(item.getNumber());</span><br><span class="line">        orderDetail.setDishFlavor(item.getDishFlavor());</span><br><span class="line">        orderDetail.setDishId(item.getDishId());</span><br><span class="line">        orderDetail.setSetmealId(item.getSetmealId());</span><br><span class="line">        orderDetail.setName(item.getName());</span><br><span class="line">        orderDetail.setImage(item.getImage());</span><br><span class="line">        orderDetail.setAmount(item.getAmount());</span><br><span class="line">        amount.addAndGet(item.getAmount().multiply(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(item.getNumber())).intValue());</span><br><span class="line">        <span class="keyword">return</span> orderDetail;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    orders.setId(orderId);</span><br><span class="line">    orders.setOrderTime(LocalDateTime.now());</span><br><span class="line">    orders.setCheckoutTime(LocalDateTime.now());</span><br><span class="line">    orders.setStatus(<span class="number">2</span>);</span><br><span class="line">    orders.setAmount(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(amount.get()));<span class="comment">//æ€»é‡‘é¢</span></span><br><span class="line">    orders.setUserId(userId);</span><br><span class="line">    orders.setNumber(String.valueOf(orderId));</span><br><span class="line">    orders.setUserName(user.getName());</span><br><span class="line">    orders.setConsignee(addressBook.getConsignee());</span><br><span class="line">    orders.setPhone(addressBook.getPhone());</span><br><span class="line">    orders.setAddress((addressBook.getProvinceName() == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : addressBook.getProvinceName())</span><br><span class="line">            + (addressBook.getCityName() == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : addressBook.getCityName())</span><br><span class="line">            + (addressBook.getDistrictName() == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : addressBook.getDistrictName())</span><br><span class="line">            + (addressBook.getDetail() == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : addressBook.getDetail()));</span><br><span class="line">    <span class="comment">//å‘è®¢å•è¡¨æ’å…¥æ•°æ®ï¼Œä¸€æ¡æ•°æ®</span></span><br><span class="line">    <span class="built_in">this</span>.save(orders);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘è®¢å•æ˜ç»†è¡¨æ’å…¥æ•°æ®ï¼Œå¤šæ¡æ•°æ®</span></span><br><span class="line">    orderDetailService.saveBatch(orderDetails);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¸…ç©ºè´­ç‰©è½¦æ•°æ®</span></span><br><span class="line">    shoppingCartService.remove(wrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ç”¨æˆ·æŸ¥çœ‹è‡ªå·±çš„è®¢å•"><a href="#ç”¨æˆ·æŸ¥çœ‹è‡ªå·±çš„è®¢å•" class="headerlink" title="ç”¨æˆ·æŸ¥çœ‹è‡ªå·±çš„è®¢å•"></a>ç”¨æˆ·æŸ¥çœ‹è‡ªå·±çš„è®¢å•</h2><h3 id="éœ€æ±‚åˆ†æ-15"><a href="#éœ€æ±‚åˆ†æ-15" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><blockquote><p>éœ€å°†è®¢å•æ˜ç»†è¡¨ä¸­çš„æ•°æ®ä¹ŸæŸ¥è¯¢å‡ºæ¥ï¼Œæ•…è¿™é‡Œéœ€è¦ä½¿ç”¨<code>OrderDto</code></p><p>éœ€æ³¨æ„ï¼šåœ¨éå†çš„æ—¶å€™ç›´æ¥ä½¿ç”¨æ„é€ æ¡ä»¶æ¥æŸ¥è¯¢å¯¼è‡´<code>eq</code>å åŠ ï¼Œä»è€Œå¯¼è‡´åé¢æŸ¥è¯¢çš„æ•°æ®éƒ½æ˜¯nullï¼Œæ‰€æœ‰è¯¥å¤„é€‰æ‹©å°†æ–¹æ³•æ–¹æ³•å¤–é¢è¿›è¡Œè°ƒç”¨</p></blockquote><hr><h3 id="ä»£ç å®ç°-18"><a href="#ä»£ç å®ç°-18" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é¿å…åœ¨éå†çš„æ—¶å€™ç›´æ¥ä½¿ç”¨æ„é€ æ¡ä»¶æ¥æŸ¥è¯¢å¯¼è‡´eqå åŠ ï¼Œä»è€Œå¯¼è‡´åé¢æŸ¥è¯¢çš„æ•°æ®éƒ½æ˜¯null</span></span><br><span class="line">   <span class="keyword">public</span> List&lt;OrderDetail&gt; <span class="title function_">getOrderDetailListByOrderId</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">       LambdaQueryWrapper&lt;OrderDetail&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       queryWrapper.eq(OrderDetail::getOrderId, orderId);</span><br><span class="line">       List&lt;OrderDetail&gt; orderDetailList = orderDetailService.list(queryWrapper);</span><br><span class="line">       <span class="keyword">return</span> orderDetailList;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//ç§»åŠ¨ç«¯åˆ†é¡µå±•ç¤ºè®¢å•</span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/userPage&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">list</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize)</span> &#123;</span><br><span class="line">       Page&lt;Orders&gt; ordersPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, pageSize);</span><br><span class="line">       Page&lt;OrdersDto&gt; ordersDtoPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">       LambdaQueryWrapper&lt;Orders&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       queryWrapper.orderByAsc(Orders::getOrderTime);</span><br><span class="line">       queryWrapper.eq(Orders::getUserId, BaseContext.getCurrentId());</span><br><span class="line">       ordersService.page(ordersPage, queryWrapper);</span><br><span class="line"></span><br><span class="line">       List&lt;Orders&gt; records = ordersPage.getRecords();</span><br><span class="line"></span><br><span class="line">       ArrayList&lt;OrdersDto&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span> (Orders record : records) &#123;</span><br><span class="line"></span><br><span class="line">           <span class="type">OrdersDto</span> <span class="variable">ordersDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrdersDto</span>();</span><br><span class="line">           <span class="comment">//è·å–è®¢å•id</span></span><br><span class="line">           <span class="type">Long</span> <span class="variable">orderId</span> <span class="operator">=</span> record.getId();</span><br><span class="line"></span><br><span class="line">           List&lt;OrderDetail&gt; list1 = <span class="built_in">this</span>.getOrderDetailListByOrderId(orderId);</span><br><span class="line"></span><br><span class="line">           BeanUtils.copyProperties(record, ordersDto);</span><br><span class="line">           ordersDto.setOrderDetails(list1);</span><br><span class="line"></span><br><span class="line">           list.add(ordersDto);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       ordersDtoPage.setRecords(list);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> R.success(ordersDtoPage);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><hr><h2 id="åå°æŒ‰æ¡ä»¶æŸ¥çœ‹è®¢å•"><a href="#åå°æŒ‰æ¡ä»¶æŸ¥çœ‹è®¢å•" class="headerlink" title="åå°æŒ‰æ¡ä»¶æŸ¥çœ‹è®¢å•"></a>åå°æŒ‰æ¡ä»¶æŸ¥çœ‹è®¢å•</h2><h3 id="éœ€æ±‚åˆ†æ-16"><a href="#éœ€æ±‚åˆ†æ-16" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><blockquote><p>æ­¤å¤„éœ€è¦æ·»åŠ ä¸‰ä¸ªæ¡ä»¶ï¼š</p><ol><li><p>è®¢å•å·æ¨¡ç³ŠæŸ¥è¯¢</p></li><li><p>å¤§äºæŸæ—¶é—´</p></li><li><p>å°äºæŸæ—¶é—´</p></li></ol></blockquote><hr><h3 id="ä»£ç å®ç°-19"><a href="#ä»£ç å®ç°-19" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, String number, String beginTime, String endTime)</span> &#123;</span><br><span class="line">    Page&lt;Orders&gt; ordersPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, pageSize);</span><br><span class="line">    LambdaQueryWrapper&lt;Orders&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.orderByAsc(Orders::getOrderTime)</span><br><span class="line">            .like(number != <span class="literal">null</span>, Orders::getId, number)</span><br><span class="line">            .ge(beginTime != <span class="literal">null</span>, Orders::getOrderTime, beginTime)</span><br><span class="line">            .le(endTime != <span class="literal">null</span>, Orders::getOrderTime, endTime);</span><br><span class="line"></span><br><span class="line">    ordersService.page(ordersPage, queryWrapper);</span><br><span class="line">    <span class="keyword">return</span> R.success(ordersPage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="åå°ä¿®æ”¹è®¢å•çŠ¶æ€"><a href="#åå°ä¿®æ”¹è®¢å•çŠ¶æ€" class="headerlink" title="åå°ä¿®æ”¹è®¢å•çŠ¶æ€"></a>åå°ä¿®æ”¹è®¢å•çŠ¶æ€</h2><h3 id="éœ€æ±‚åˆ†æ-17"><a href="#éœ€æ±‚åˆ†æ-17" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><blockquote><p>å‰ç«¯å‘é€è¿‡æ¥çš„æ•°æ®åŒ…å«éœ€æ”¹å˜çš„<code>status</code>å’Œè®¢å•<code>id</code>ï¼Œæ•…å¯ç›´æ¥æ›´æ”¹è®¢å•çŠ¶æ€ã€‚</p></blockquote><hr><h3 id="ä»£ç å®ç°-20"><a href="#ä»£ç å®ç°-20" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">changeStatus</span><span class="params">(<span class="meta">@RequestBody</span> Orders orders)</span> &#123;</span><br><span class="line">    ordersService.updateById(orders);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;ä¿®æ”¹è®¢å•çŠ¶æ€æˆåŠŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ç§»åŠ¨ç«¯ç‚¹å‡»å¥—é¤å›¾ç‰‡æŸ¥çœ‹å¥—é¤å…·ä½“èœå“"><a href="#ç§»åŠ¨ç«¯ç‚¹å‡»å¥—é¤å›¾ç‰‡æŸ¥çœ‹å¥—é¤å…·ä½“èœå“" class="headerlink" title="ç§»åŠ¨ç«¯ç‚¹å‡»å¥—é¤å›¾ç‰‡æŸ¥çœ‹å¥—é¤å…·ä½“èœå“"></a>ç§»åŠ¨ç«¯ç‚¹å‡»å¥—é¤å›¾ç‰‡æŸ¥çœ‹å¥—é¤å…·ä½“èœå“</h2><h3 id="éœ€æ±‚åˆ†æ-18"><a href="#éœ€æ±‚åˆ†æ-18" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><blockquote><ol><li><p>é€šè¿‡å‰ç«¯ä¼ å…¥çš„å¥—é¤idåœ¨å¥—é¤èœå“å…³ç³»è¡¨ä¸­æŸ¥è¯¢å‡ºè¯¥å¥—é¤ä¸‹çš„æ‰€æœ‰èœå“</p></li><li><p>å°†dishå¯¹è±¡æ‹·è´ç»™<code>dishDto</code>å¯¹è±¡</p></li><li><p>å°†å­˜<code>dishDto</code>å¯¹è±¡çš„é›†åˆä¼ å›å‰ç«¯</p></li></ol></blockquote><hr><h3 id="ä»£ç å®ç°-21"><a href="#ä»£ç å®ç°-21" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@GetMapping(&quot;/dish/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;List&lt;DishDto&gt;&gt; <span class="title function_">dish</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;SetmealDish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(SetmealDish::getSetmealId, id);</span><br><span class="line">        <span class="comment">//è·å–è¯¥å¥—é¤ä¸‹çš„æ‰€æœ‰èœå“</span></span><br><span class="line">        List&lt;SetmealDish&gt; list = setmealDishService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">        List&lt;DishDto&gt; dishDtos = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (SetmealDish setmealDish : list) &#123;</span><br><span class="line">            <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line">            <span class="type">String</span> <span class="variable">dishId</span> <span class="operator">=</span> setmealDish.getDishId();</span><br><span class="line">            <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> dishService.getById(dishId);</span><br><span class="line">            BeanUtils.copyProperties(dish, dishDto);</span><br><span class="line"></span><br><span class="line">            dishDtos.add(dishDto);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(dishDtos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="å†æ¥ä¸€å•åŠŸèƒ½"><a href="#å†æ¥ä¸€å•åŠŸèƒ½" class="headerlink" title="å†æ¥ä¸€å•åŠŸèƒ½"></a>å†æ¥ä¸€å•åŠŸèƒ½</h2><h3 id="éœ€æ±‚åˆ†æ-19"><a href="#éœ€æ±‚åˆ†æ-19" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><blockquote><p>åªæœ‰è®¢å•è¡¨ä¸­çš„statusä¸º4 çš„æ—¶å€™æ‰èƒ½æœ‰å†æ¥ä¸€å•çš„åŠŸèƒ½</p><p>ç‚¹å‡»å†æ¥ä¸€å•æŒ‰é’®å‰ç«¯é¡µé¢ä¼šç›´æ¥è·³è½¬åˆ°è´­ç‰©è½¦é¡µé¢</p><p>æ ¹æ®<code>userId</code>ï¼Œåˆ é™¤è¯¥ç”¨æˆ·æ­¤æ—¶æ‰€å‰©çš„è´­ç‰©è½¦æ•°æ®ï¼ˆæ¸…ç©ºè´­ç‰©è½¦ï¼‰</p><p>éœ€è¦å°†åŸæ¥è´­ç‰©è½¦æ•°æ®å¤åˆ¶åˆ°è´­ç‰©è½¦ä¸­</p></blockquote><hr><h3 id="ä»£ç å®ç°-22"><a href="#ä»£ç å®ç°-22" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/again&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">again</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;String,String&gt; map)</span> &#123;</span><br><span class="line">    <span class="comment">//å‰ç«¯é¡µé¢ä¼šç›´æ¥è·³è½¬åˆ°è´­ç‰©è½¦é¡µé¢</span></span><br><span class="line">    <span class="comment">//æ•…éœ€è¦å…ˆå°†è´­ç‰©è½¦ä¸­æ•°æ®æ¸…é™¤</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¹æ®userIdï¼Œåˆ é™¤è¯¥ç”¨æˆ·æ­¤æ—¶æ‰€å‰©çš„è´­ç‰©è½¦æ•°æ®(æ¸…ç©ºè´­ç‰©è½¦)</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">    LambdaQueryWrapper&lt;ShoppingCart&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(userId != <span class="literal">null</span>, ShoppingCart::getUserId, userId);</span><br><span class="line">    shoppingCartService.remove(queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éœ€è¦å°†åŸæ¥è´­ç‰©è½¦æ•°æ®å¤åˆ¶åˆ°è´­ç‰©è½¦ä¸­</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> map.get(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    LambdaQueryWrapper&lt;OrderDetail&gt; queryWrapper1 = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper1.eq(OrderDetail::getOrderId,id);</span><br><span class="line">    List&lt;OrderDetail&gt; list = orderDetailService.list(queryWrapper1);</span><br><span class="line"></span><br><span class="line">    ArrayList&lt;ShoppingCart&gt; shoppingCartsLists = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (OrderDetail orderDetail : list) &#123;</span><br><span class="line">        <span class="type">ShoppingCart</span> <span class="variable">shoppingCart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line">        shoppingCart.setUserId(userId);</span><br><span class="line">        shoppingCart.setImage(orderDetail.getImage());</span><br><span class="line">        <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> orderDetail.getDishId();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">setmealId</span> <span class="operator">=</span> orderDetail.getSetmealId();</span><br><span class="line">        <span class="keyword">if</span> (dishId != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœæ˜¯èœå“é‚£å°±æ·»åŠ èœå“çš„æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line">            shoppingCart.setDishId(dishId);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//æ·»åŠ åˆ°è´­ç‰©è½¦çš„æ˜¯å¥—é¤</span></span><br><span class="line">            shoppingCart.setSetmealId(setmealId);</span><br><span class="line">        &#125;</span><br><span class="line">        shoppingCart.setName(orderDetail.getName());</span><br><span class="line">        shoppingCart.setDishFlavor(orderDetail.getDishFlavor());</span><br><span class="line">        shoppingCart.setNumber(orderDetail.getNumber());</span><br><span class="line">        shoppingCart.setAmount(orderDetail.getAmount());</span><br><span class="line">        shoppingCart.setCreateTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">        shoppingCartsLists.add(shoppingCart);</span><br><span class="line">    &#125;</span><br><span class="line">    shoppingCartService.saveBatch(shoppingCartsLists);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;æ“ä½œæˆåŠŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="å†™åœ¨åé¢"><a href="#å†™åœ¨åé¢" class="headerlink" title="å†™åœ¨åé¢"></a>å†™åœ¨åé¢</h2><blockquote><p>è¯¥é¡¹ç›®åç»­å¯ç”¨<code>redis</code>ï¼Œ<code>mysql</code>ä¸»ä»å¤åˆ¶ï¼Œ<code>nginx</code>ç­‰æŠ€æœ¯ä¼˜åŒ–ï¼Œè¿˜éœ€åç»­å®Œå–„â€¦â€¦.</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç‘å‰å¤–å– </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
